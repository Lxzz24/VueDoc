import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,d as e}from"./app-CvlAI_tu.js";const t={},p=e(`<h1 id="systemd-journald-service-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#systemd-journald-service-ç®€ä»‹" aria-hidden="true">#</a> systemd-journald.service ç®€ä»‹</h1><p>ä»¥å‰åªæœ‰ rsyslogd çš„æ—¶å€™ï¼Œç”±äº rsyslogd å¿…é¡»è¦å¼€æœºå®Œæˆä¸”æ‰§è¡Œäº† rsyslogd daemon åï¼Œæ—¥å¿—æ–‡ä»¶æ‰ä¼šå¼€å§‹è®°å½•ã€‚æ‰€ä»¥ï¼Œæ ¸å¿ƒè¿˜éœ€è¦è‡ªå·±äº§ç”Ÿä¸€ä¸ª klogd çš„æœåŠ¡ï¼Œæ‰èƒ½å°†ç³»ç»Ÿåœ¨å¼€æœºè¿‡ç¨‹ã€å¯åŠ¨æœåŠ¡çš„è¿‡ç¨‹ä¸­çš„ä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œç„¶åç­‰ rsyslogd å¯åŠ¨åä¼ é€ç»™å®ƒå¤„ç†</p><p>æœ‰äº† systemd åï¼Œç”±äºå®ƒæ˜¯æ ¸å¿ƒå”¤é†’çš„ï¼Œåˆæ˜¯ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„è½¯ä»¶ï¼Œå®ƒå¯ä»¥ä¸»åŠ¨è°ƒç”¨ systemd-journald æ¥ååŠ©è®°å½•æ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤åœ¨å¼€æœºè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯åŠ¨æœåŠ¡äºæœåŠ¡è‹¥å¯åŠ¨å¤±è´¥çš„æƒ…å†µç­‰ï¼Œéƒ½å¯ä»¥ç›´æ¥è¢«è®°å½•åˆ° systemd-journald sé‡Œ</p><p>systemd-journald è®°å½•åˆ°å†…å­˜ä¸­ï¼Œå†ç»™ rsyslogd è®°å½•åˆ°ç¡¬ç›˜ä¸­</p><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>linux çš„å†…å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿæœ‰å¯¹åº”çš„æ–‡ä»¶å½¢æ€åœ¨ /run/log/ ä¸‹ï¼Œåªæ˜¯äººçœ¼çœ‹ä¸æ‡‚å°±æ˜¯äº†ï¼Œé‡å¯åï¼Œè¯¥æ•°æ®å°±æ²¡æœ‰äº†</p></div><h2 id="ğŸ€-ä½¿ç”¨-journalctl-è§‚å¯Ÿæ—¥å¿—ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-journalctl-è§‚å¯Ÿæ—¥å¿—ä¿¡æ¯" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ journalctl è§‚å¯Ÿæ—¥å¿—ä¿¡æ¯</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>journalct <span class="token punctuation">[</span>-nrpf<span class="token punctuation">]</span> <span class="token punctuation">[</span>--since TIME<span class="token punctuation">]</span> <span class="token punctuation">[</span>--until TIME<span class="token punctuation">]</span> _optional

é€‰é¡¹ä¸å‚æ•°ï¼š
	é¢„è®¾ä¼šæ˜¾ç¤ºå…¨éƒ¨çš„ log å†…å®¹ï¼Œä»æ—§çš„è¾“å‡ºåˆ°æœ€æ–°çš„ä¿¡æ¯
	-nï¼šæ˜¾ç¤ºæœ€è¿‘ n è¡Œçš„ä¿¡æ¯ï¼Œæ‰¾æœ€æ–°ä¿¡æ¯æ—¶æœ‰ç”¨
	-rï¼šåå‘è¾“å‡ºï¼Œä»æœ€æ–°çš„è¾“å‡ºåˆ°æœ€æ—§çš„è¾“å‡º
	-pï¼šæ˜¾ç¤ºåé¢æ¥çš„ä¿¡æ¯é‡è¦æ€§æ’åºï¼Œå‰ä¸€ç« è®²è§£çš„æ—¥å¿—çº§åˆ«
	-fï¼šç±»ä¼¼ <span class="token function">tail</span> <span class="token parameter variable">-f</span> åŠŸèƒ½ï¼ŒæŒç»­æ˜¾ç¤º journal æ—¥å¿—å†…å®¹
	<span class="token parameter variable">--since</span> --unitlï¼šè®¾ç½®å¼€å§‹ä¸ç»“æŸæ—¶é—´ï¼Œåªæ˜¾ç¤ºæŸæ®µæ—¶é—´èŒƒå›´å†…çš„æ•°æ®
	<span class="token assign-left variable">_SYSTEMD_UNIT</span><span class="token operator">=</span>unit.serviceï¼šåªè¾“å‡ºæŸä¸ªæœåŠ¡çš„ä¿¡æ¯
	<span class="token assign-left variable">_COMM</span><span class="token operator">=</span>bashï¼šåªè¾“å‡ºä¸ <span class="token function">bash</span> æœ‰å…³çš„ä¿¡æ¯
	<span class="token assign-left variable">_PID</span><span class="token operator">=</span>pidï¼šåªè¾“å‡ºæŸä¸ª PID çš„ä¿¡æ¯
	<span class="token assign-left variable">_UID</span><span class="token operator">=</span>uidï¼šåªè¾“å‡ºæŸä¸ª uid çš„ä¿¡æ¯
	<span class="token assign-left variable">SYSLOG_FACILITY</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span>-23<span class="token punctuation">]</span>ï¼šä½¿ç”¨ syslog.h è§„èŒƒçš„æœåŠ¡ç›¸å¯¹åº”çš„åºå·æ¥æ˜¾ç¤ºæŒ‡å®šæ•°æ®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼š æ˜¾ç¤ºç›®å‰ç³»ç»Ÿä¸­æ‰€æœ‰çš„  journal æ—¥å¿—æ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl </span>
-- Logs begin at Sun <span class="token number">2020</span>-03-15 <span class="token number">20</span>:13:33 CST, end at Mon <span class="token number">2020</span>-03-16 00:50:01 CST. --
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode systemd-journal<span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">]</span>: Runtime journal is using <span class="token number">7</span>.2M <span class="token punctuation">(</span>max allowed <span class="token number">58</span>.1M, trying to leave <span class="token number">87</span>.
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: Initializing cgroup subsys cpuset
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: Initializing cgroup subsys cpu
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: Initializing cgroup subsys cpuacct
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: Linux version <span class="token number">3.10</span>.0-1062.el7.x86_64 <span class="token punctuation">(</span>mockbuild@kbuilder.bsys.centos.org<span class="token punctuation">)</span> <span class="token punctuation">(</span>gcc ver
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: Command line: <span class="token assign-left variable">BOOT_IMAGE</span><span class="token operator">=</span>/vmlinuz-3.10.0-1062.el7.x86_64 <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/mapper/centos-r
Mar <span class="token number">15</span> <span class="token number">20</span>:13:33 study.centos.mrcode kernel: e820: BIOS-provided physical RAM map:
<span class="token comment"># ä»å½“æ¬¡å¼€æœºä»¥æ¥çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œé€šè¿‡ less ä¸€é¡µé¡µæ˜¾ç¤ºï¼Œæ•°æ®æµå¾ˆå¤§</span>

<span class="token comment"># èŒƒä¾‹ 2ï¼šä»…æ˜¾ç¤º 2020/03/22 æ•´å¤©ã€æ˜¨å¤© çš„æ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl --since &quot;2020-03-16 00:00:00&quot; --until &quot;2020-03-16 23:59:59&quot;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl --since today		# ä»Šå¤©</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl --since yesterday --unitl today		# æ˜¨å¤©åˆ°ä»Šå¤©</span>

<span class="token comment"># èŒƒä¾‹ 3ï¼šåªæ‹›æ•° crond.service çš„æ•°æ®ï¼Œ åŒæ—¶åªåˆ—å‡ºæœ€æ–°çš„ 10 è¡Œä¿¡æ¯</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl _SYSTEMD_UNIT=crond.service -n 10</span>

<span class="token comment"># èŒƒä¾‹ 4ï¼šæ‰¾å‡º suã€login æ‰§è¡Œçš„çš„æ—¥å¿—ï¼ŒåŒæ—¶åªåˆ—å‡ºæœ€æ–°çš„ 10 è¡Œæ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl _COMM=su _COMM=login -n 10</span>

<span class="token comment"># èŒƒä¾‹ 5ï¼šæ‰¾å‡ºä¿¡æ¯ä¸¥é‡ç­‰çº§ä¸º error çš„ä¿¡æ¯</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl -p err</span>

<span class="token comment"># èŒƒä¾‹ 6ï¼šæ‰¾å‡ºä¸ç™»å½•æœåŠ¡ authã€authpriv æœ‰å…³çš„æ—¥å¿—æ–‡ä»¶ä¿¡æ¯</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl SYSLOG_FACILITY=4 SYSLOG_FACILITY=10</span>
<span class="token comment"># å…³äº  SYSLOG_FACILITY çš„å¯¹åº”ï¼Œå‚è€ƒå‰é¢çš„ç« èŠ‚</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å®ƒçš„ <code>-f</code> å®æ—¶æ˜¾ç¤ºåŠŸèƒ½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ç¬¬ä¸€ä¸ªç»ˆç«¯æœº</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl -f</span>
<span class="token punctuation">..</span>. ä¸‹é¢çš„ä¿¡æ¯æ˜¯ï¼Œ2 å·ç»ˆç«¯æœºæ‰§è¡ŒæŒ‡ä»¤åæ˜¾ç¤ºçš„ä¿¡æ¯
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/pickup<span class="token punctuation">[</span><span class="token number">14953</span><span class="token punctuation">]</span>: 827B31075: <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token operator">&lt;</span>mrcode<span class="token operator">&gt;</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/cleanup<span class="token punctuation">[</span><span class="token number">20434</span><span class="token punctuation">]</span>: 827B31075: message-id<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token number">20200315171525</span>.827B31075@study.centos.mrcode<span class="token operator">&gt;</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/qmgr<span class="token punctuation">[</span><span class="token number">1618</span><span class="token punctuation">]</span>: 827B31075: <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token operator">&lt;</span>mrcode@study.centos.mrcode<span class="token operator">&gt;</span>, <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token number">449</span>, <span class="token assign-left variable">nrcpt</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">(</span>queue active<span class="token punctuation">)</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/local<span class="token punctuation">[</span><span class="token number">20436</span><span class="token punctuation">]</span>: 827B31075: <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token operator">&lt;</span>dmtsai@study.centos.mrcode<span class="token operator">&gt;</span>, <span class="token assign-left variable">orig_to</span><span class="token operator">=</span><span class="token operator">&lt;</span>dmtsai<span class="token operator">&gt;</span>, <span class="token assign-left variable">relay</span><span class="token operator">=</span>local, <span class="token assign-left variable">delay</span><span class="token operator">=</span><span class="token number">0.02</span>, <span class="token assign-left variable">delays</span><span class="token operator">=</span><span class="token number">0.02</span>/0/0/0, <span class="token assign-left variable">dsn</span><span class="token operator">=</span><span class="token number">5.1</span>.1, <span class="token assign-left variable">status</span><span class="token operator">=</span>bounced <span class="token punctuation">(</span>unknown user: <span class="token string">&quot;dmtsai&quot;</span><span class="token punctuation">)</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/cleanup<span class="token punctuation">[</span><span class="token number">20434</span><span class="token punctuation">]</span>: 87ED81076: message-id<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token number">20200315171525</span>.87ED81076@study.centos.mrcode<span class="token operator">&gt;</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/bounce<span class="token punctuation">[</span><span class="token number">20437</span><span class="token punctuation">]</span>: 827B31075: sender non-delivery notification: 87ED81076
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/qmgr<span class="token punctuation">[</span><span class="token number">1618</span><span class="token punctuation">]</span>: 827B31075: removed
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/qmgr<span class="token punctuation">[</span><span class="token number">1618</span><span class="token punctuation">]</span>: 87ED81076: <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token operator">&lt;&gt;</span>, <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token number">2291</span>, <span class="token assign-left variable">nrcpt</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">(</span>queue active<span class="token punctuation">)</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/local<span class="token punctuation">[</span><span class="token number">20436</span><span class="token punctuation">]</span>: 87ED81076: <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token operator">&lt;</span>mrcode@study.centos.mrcode<span class="token operator">&gt;</span>, <span class="token assign-left variable">relay</span><span class="token operator">=</span>local, <span class="token assign-left variable">delay</span><span class="token operator">=</span><span class="token number">0.01</span>, <span class="token assign-left variable">delays</span><span class="token operator">=</span><span class="token number">0</span>/0/0/0, <span class="token assign-left variable">dsn</span><span class="token operator">=</span><span class="token number">2.0</span>.0, <span class="token assign-left variable">status</span><span class="token operator">=</span>sent <span class="token punctuation">(</span>delivered to mailbox<span class="token punctuation">)</span>
Mar <span class="token number">16</span> 01:15:25 study.centos.mrcode postfix/qmgr<span class="token punctuation">[</span><span class="token number">1618</span><span class="token punctuation">]</span>: 87ED81076: removed


<span class="token comment"># ç¬¬äºŒä¸ªç»ˆç«¯æœº</span>
<span class="token punctuation">[</span>mrcode@study ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;test&quot;</span> <span class="token operator">|</span> mail <span class="token parameter variable">-s</span> <span class="token string">&#39;test&#39;</span> dmtsai

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ€-logger-æŒ‡ä»¤çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#ğŸ€-logger-æŒ‡ä»¤çš„åº”ç”¨" aria-hidden="true">#</a> ğŸ€ logger æŒ‡ä»¤çš„åº”ç”¨</h2><p>journalctl æŒ‡ä»¤æ˜¯æŸ¥é˜…ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ logger æŠŠä½ çš„æ•°æ®å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œä¸‹é¢ä»‹ç»æœ€ç®€å•çš„æœ¬æœºä¿¡æ¯ä¼ é€’ï¼Œæ›´å¤šçš„æ–¹æ³•è¯·è‡ªè¡ŒæŸ¥é˜… man logger</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>logger <span class="token punctuation">[</span>-p æœåŠ¡åç§°.ç­‰çº§<span class="token punctuation">]</span> <span class="token string">&quot;ä¿¡æ¯&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼š è®© dmtsai ä½¿ç”¨ logger æ¥ä¼ é€æ•°æ®åˆ°æ—¥å¿—æ–‡ä»¶</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span>$ logger <span class="token parameter variable">-p</span> user.info <span class="token string">&quot;I will check logger command&quot;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl SYSLOG_FACILITY=1 -n 3</span>
-- Logs begin at Sun <span class="token number">2020</span>-03-15 <span class="token number">20</span>:13:33 CST, end at Mon <span class="token number">2020</span>-03-16 01:20:43 CST. --
Mar <span class="token number">15</span> <span class="token number">20</span>:13:50 study.centos.mrcode spice-vdagent<span class="token punctuation">[</span><span class="token number">1860</span><span class="token punctuation">]</span>: Cannot access vdagent virtio channel /dev/virtio-ports/com.redhat.spi
Mar <span class="token number">15</span> <span class="token number">20</span>:13:50 study.centos.mrcode spice-streaming-agent<span class="token punctuation">[</span><span class="token number">1867</span><span class="token punctuation">]</span>: Failed to <span class="token function">open</span> the streaming device &quot;/dev/virtio-ports/org.sp
Mar <span class="token number">16</span> 01:20:43 study.centos.mrcode mrcode<span class="token punctuation">[</span><span class="token number">13699</span><span class="token punctuation">]</span>: I will check logger <span class="token builtin class-name">command</span>
<span class="token comment"># å¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»ä¼ è¾“åˆ°äº†</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹å‰å†™çš„ backup.service æœåŠ¡ä¸­ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨æ–¹å¼æ¥å¤‡ä»½ï¼Œå³æ‰‹åŠ¨æ‰§è¡Œ <code>/backups/backup.sh log</code> æ¥å¤‡ä»½æ—¶ï¼Œé€šè¿‡ logger è®°å½•å¤‡ä»½å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /backups/backup.sh</span>
<span class="token comment">#!/bin/bash</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${1}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&#39;log&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	logger <span class="token parameter variable">-p</span> syslog.info <span class="token string">&quot;backup.sh is starting&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">source</span><span class="token operator">=</span><span class="token string">&quot;/etc /home /root /var/lib /var/spool/{cron,at,mail}&quot;</span>
<span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token string">&quot;/backups/backup-system-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">)</span></span>.tar.gz&quot;</span>

<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> /backups <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> /backups

<span class="token function">tar</span> <span class="token parameter variable">-zcvf</span> <span class="token variable">\${target}</span> <span class="token variable">\${source}</span> $<span class="token operator">&gt;</span> /backups/backup.log

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${1}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&#39;log&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	logger <span class="token parameter variable">-p</span> syslog.info <span class="token string">&quot;backup.sh is finished&quot;</span>
<span class="token keyword">fi</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># /backups/backup.sh log</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># journalctl SYSLOG_FACILITY=5 -n 3</span>
-- Logs begin at Sun <span class="token number">2020</span>-03-15 <span class="token number">20</span>:13:33 CST, end at Mon <span class="token number">2020</span>-03-16 01:28:54 CST. --
Mar <span class="token number">16</span> 00:42:45 study.centos.mrcode rsyslogd<span class="token punctuation">[</span><span class="token number">7107</span><span class="token punctuation">]</span>:  <span class="token punctuation">[</span>origin <span class="token assign-left variable">software</span><span class="token operator">=</span><span class="token string">&quot;rsyslogd&quot;</span> <span class="token assign-left variable">swVersion</span><span class="token operator">=</span><span class="token string">&quot;8.24.0-38.el7&quot;</span> x-pid<span class="token operator">=</span><span class="token string">&quot;7107&quot;</span> x-info
Mar <span class="token number">16</span> 01:28:27 study.centos.mrcode mrcode<span class="token punctuation">[</span><span class="token number">17659</span><span class="token punctuation">]</span>: backup.sh is starting
Mar <span class="token number">16</span> 01:28:54 study.centos.mrcode mrcode<span class="token punctuation">[</span><span class="token number">19555</span><span class="token punctuation">]</span>: backup.sh is finished

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æŒ‡ä»¤æ˜¯ç±»ä¼¼ä¸€ä¸ªæ—¥å¿—æœåŠ¡æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæŠŠæ—¥å¿—ä¿¡æ¯è®°å½•ä¸‹æ¥</p><h2 id="ğŸ€-ä¿å­˜-journal-çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¿å­˜-journal-çš„æ–¹å¼" aria-hidden="true">#</a> ğŸ€ ä¿å­˜ journal çš„æ–¹å¼</h2><p>systemd-journald.service çš„ä¿¡æ¯åœ¨å†…å­˜ä¸­ï¼Œè€ŒæŒä¹…åŒ–åˆ°ç¡¬ç›˜çš„æ•°æ®æ˜¯é€šè¿‡ rsyslogd æ¥åšçš„ï¼Œå¦‚æœä½ æƒ³è¦ä¿å­˜ä¸‹ journald å¤„ç†çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼</p><p>åŸºæœ¬ä¸Š systemd-journald.service çš„é…ç½®æ–‡ä»¶ä¸»è¦å‚è€ƒ <code>/etc/systemd/journald.conf</code> çš„å†…å®¹ï¼Œé»˜è®¤é…ç½®åŸºæœ¬ä¸Šæ»¡è¶³éœ€æ±‚ï¼Œå¦‚æœ‰å®šåˆ¶ä¿¡æ¯ï¼Œè¯·é€šè¿‡ man 5 journald.conf æŸ¥é˜…</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å¤„ç†æ‰€éœ€è¦çš„ç›®å½•ä¸ç›¸å…³æƒé™è®¾ç½®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/log/journal</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chown root:systemd-journal /var/log/journal/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chmod 2775 /var/log/journal/</span>

<span class="token comment"># 2. é‡æ–°å¯åŠ¨ systemd-journald å¹¶è§‚å¯Ÿå¤‡ä»½çš„æ—¥å¿—æ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart systemd-journald.service </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /var/log/journal/</span>
total <span class="token number">0</span>
drwxr-sr-x. <span class="token number">2</span> root systemd-journal <span class="token number">28</span> Mar <span class="token number">16</span> 01:35 f228ab37c368416c84c6b27971ba45a9

<span class="token comment"># é…ç½®é¢„è®¾çš„ç›®å½•åï¼ŒæœåŠ¡é‡å¯åï¼Œä¼šè‡ªåŠ¨å¤åˆ¶ä¸€ä»½åˆ°è¯¥ç›®å½•ä¸‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½œè€…å»ºè®®ï¼›æœ‰ rsyslog.service ä»¥åŠ logrotate çš„å­˜åœ¨ï¼Œæ‰€ä»¥è¿™é‡Œäº§ç”Ÿçš„ä¿¡æ¯å¯ä»¥ä¸ç”¨å­˜æ¡£</p>`,22),o=[p];function l(c,i){return n(),a("div",null,o)}const d=s(t,[["render",l],["__file","04.html.vue"]]);export{d as default};
