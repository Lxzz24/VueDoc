import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as e,o as t,c as o,a as n,b as c,w as p,d as l,e as i}from"./app-CvlAI_tu.js";const d={},u={class:"hint-container details"},r=n("summary",null,"ç›®å½•",-1),k={class:"table-of-contents"},v=l(`<p>Java çš„ <code>java.util.concurrent</code> åŒ…é™¤äº†æä¾›åº•å±‚é”ã€å¹¶å‘é›†åˆå¤–ï¼Œè¿˜æä¾›äº†ä¸€ç»„åŸå­æ“ä½œçš„å°è£…ç±»ï¼Œå®ƒä»¬ä½äº <code>java.util.concurrent.atomic</code> åŒ…ã€‚</p><p>æˆ‘ä»¬ä»¥ <code>AtomicInteger</code> ä¸ºä¾‹ï¼Œå®ƒæä¾›çš„ä¸»è¦æ“ä½œæœ‰ï¼š</p><ul><li>å¢åŠ å€¼å¹¶è¿”å›æ–°å€¼ï¼š<code>int addAndGet(int delta)</code></li><li>åŠ  1 åè¿”å›æ–°å€¼ï¼š<code>int incrementAndGet()</code></li><li>è·å–å½“å‰å€¼ï¼š<code>int get()</code></li><li>ç”¨ CAS æ–¹å¼è®¾ç½®ï¼š<code>int compareAndSet(int expect, int update)</code></li></ul><p>Atomic ç±»æ˜¯é€šè¿‡æ— é”ï¼ˆlock-freeï¼‰çš„æ–¹å¼å®ç°çš„çº¿ç¨‹å®‰å…¨ï¼ˆthread-safeï¼‰è®¿é—®ã€‚å®ƒçš„ä¸»è¦åŸç†æ˜¯åˆ©ç”¨äº† CASï¼šCompare and Setã€‚</p><p>å¦‚æœæˆ‘ä»¬è‡ªå·±é€šè¿‡ CAS ç¼–å†™ <code>incrementAndGet()</code>ï¼Œå®ƒå¤§æ¦‚é•¿è¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token class-name">AtomicInteger</span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> prev<span class="token punctuation">,</span> next<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        prev <span class="token operator">=</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        next <span class="token operator">=</span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CAS æ˜¯æŒ‡ï¼Œåœ¨è¿™ä¸ªæ“ä½œä¸­ï¼Œå¦‚æœ <code>AtomicInteger</code> çš„å½“å‰å€¼æ˜¯ <code>prev</code>ï¼Œé‚£ä¹ˆå°±æ›´æ–°ä¸º <code>next</code>ï¼Œè¿”å› <code>true</code>ã€‚å¦‚æœ <code>AtomicInteger</code> çš„å½“å‰å€¼ä¸æ˜¯ <code>prev</code>ï¼Œå°±ä»€ä¹ˆä¹Ÿä¸å¹²ï¼Œè¿”å› <code>false</code>ã€‚é€šè¿‡ CAS æ“ä½œå¹¶é…åˆ <code>do ... while</code> å¾ªç¯ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº† <code>AtomicInteger</code> çš„å€¼ï¼Œæœ€ç»ˆçš„ç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚</p><p>æˆ‘ä»¬åˆ©ç”¨ <code>AtomicLong</code> å¯ä»¥ç¼–å†™ä¸€ä¸ªå¤šçº¿ç¨‹å®‰å…¨çš„å…¨å±€å”¯ä¸€ ID ç”Ÿæˆå™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">IdGenerator</span> <span class="token punctuation">{</span>
    <span class="token class-name">AtomicLong</span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç›´æ¥ç”¨ <code>do ... while</code> å¾ªç¯è°ƒç”¨ <code>compareAndSet</code> å®ç°å¤æ‚çš„å¹¶å‘æ“ä½œï¼Œè€Œæ˜¯ç”¨ <code>incrementAndGet()</code> è¿™æ ·çš„å°è£…å¥½çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚</p><p>åœ¨é«˜åº¦ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Java 8 æä¾›çš„ <code>LongAdder</code> å’Œ <code>LongAccumulator</code>ã€‚</p><h2 id="ğŸ€-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å°ç»“" aria-hidden="true">#</a> ğŸ€ å°ç»“</h2><p>ä½¿ç”¨ <code>java.util.concurrent.atomic</code> æä¾›çš„åŸå­æ“ä½œå¯ä»¥ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼š</p><ul><li>åŸå­æ“ä½œå®ç°äº†æ— é”çš„çº¿ç¨‹å®‰å…¨ï¼›</li><li>é€‚ç”¨äºè®¡æ•°å™¨ï¼Œç´¯åŠ å™¨ç­‰ã€‚</li></ul>`,14);function m(b,A){const a=e("router-link");return t(),o("div",null,[n("details",u,[r,n("nav",k,[n("ul",null,[n("li",null,[c(a,{to:"#ğŸ€-å°ç»“"},{default:p(()=>[i("ğŸ€ å°ç»“")]),_:1})])])])]),v])}const w=s(d,[["render",m],["__file","16.html.vue"]]);export{w as default};
