import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as l,o as p,c as o,a as i,e as s,b as c,w as r,d as a}from"./app-CvlAI_tu.js";const d="/VueDoc/assets/image-20200301205307039-W505f4uy.png",v="/VueDoc/assets/image-20200301205826020-peJgPJiI.png",n="/VueDoc/assets/image-20200302221604971-DgEM6yu6.png",u={},m=a('<h1 id="é€»è¾‘æ»šåŠ¨æ¡ç®¡ç†å‘˜-logical-volume-manager" tabindex="-1"><a class="header-anchor" href="#é€»è¾‘æ»šåŠ¨æ¡ç®¡ç†å‘˜-logical-volume-manager" aria-hidden="true">#</a> é€»è¾‘æ»šåŠ¨æ¡ç®¡ç†å‘˜ï¼ˆLogical Volume Managerï¼‰</h1><p>æœ‰ä¸€ä¸ªåœºæ™¯ï¼šå½“åˆè§„åˆ’ä¸»æœºçš„æ—¶å€™ï¼Œåªç»™äº† <code>/home</code> ç›®å½• 50Gï¼Œåç»­ä¸å¤Ÿç”¨äº†ï¼Œè¦æ€ä¹ˆåŠï¼Ÿ</p><p>å¾ˆå¤šäººä¼šè¿™æ ·åšï¼šåŠ ä¸€å—æ–°ç¡¬ç›˜ï¼Œé‡æ–°åˆ†åŒºã€æ ¼å¼åŒ–ï¼Œå°† <code>/home</code> çš„æ•°æ®å®Œæ•´å¤åˆ¶è¿‡å»ï¼Œå°†åŸæœ¬çš„ partition å¸è½½é‡æ–°æŒ‚è½½æ–°çš„ partitionã€‚</p><p>ä¸‡ä¸€ç¬¬äºŒæ¬¡åˆåˆ†å¤šäº†ï¼Œå¯¼è‡´å®¹é‡æµªè´¹äº†ï¼Œåˆè¦å‡æ‰ä¸€éƒ¨åˆ†å®¹é‡ï¼Ÿæ˜¯ä¸æ˜¯è¿˜éœ€è¦é‡æ¥ä¸€æ¬¡ï¼Ÿ</p><p>æœ‰æ›´ç®€å•çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½¿ç”¨ LVMï¼Œå®ƒçš„é‡ç‚¹åœ¨äºã€Œå¯ä»¥å¼¹æ€§çš„è°ƒæ•´ filesystem çš„å®¹é‡ï¼Œå¹¶éåœ¨äºæ•ˆèƒ½ä¸æ•°æ®ä¿å…¨ä¸Šé¢ã€‚</p><p>LVM å¯ä»¥æ•´åˆå¤šä¸ªå®ä½“ partition åœ¨ä¸€èµ·ï¼Œè®©è¿™äº› partitions çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªç£ç›˜ä¸€æ ·ï¼Œè€Œä¸”å¯ä»¥åœ¨æœªæ¥æ–°å¢æˆ–ç§»é™¤å…¶ä»–çš„å®ä½“ partition åˆ°è¿™ä¸ª LVM ç®¡ç†çš„ç£ç›˜ä¸­ã€‚</p><h2 id="ğŸ€-ä¸Šé¢æ˜¯-lvm-pvã€peã€vgã€lv-çš„æ„ä¹‰" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¸Šé¢æ˜¯-lvm-pvã€peã€vgã€lv-çš„æ„ä¹‰" aria-hidden="true">#</a> ğŸ€ ä¸Šé¢æ˜¯ LVMï¼šPVã€PEã€VGã€LV çš„æ„ä¹‰</h2><p>Logical Volume Manager ç¿»è¯‘ä¸ºé€»è¾‘æ»šåŠ¨æ¡ç®¡ç†å‘˜ï¼Œç®€ç§° LVMã€‚LVM å°†å‡ ä¸ªå®ä½“çš„ partitionsï¼ˆæˆ– diskï¼‰é€šè¿‡è½¯ä»¶ç»„åˆæˆä¸€å—çœ‹èµ·æ¥æ˜¯ç‹¬ç«‹çš„å¤§ç£ç›˜ï¼ˆ<strong>VG</strong>ï¼‰,ç„¶åå°†è¿™å—å¤§ç£ç›˜å†ç»è¿‡åˆ†åŒºæˆä¸ºå¯ä½¿ç”¨åˆ†åŒºæ§½ï¼ˆ<strong>LV</strong>ï¼‰ï¼Œæœ€ç»ˆå°±èƒ½æŒ‚è½½ä½¿ç”¨äº†ã€‚</p><p>ä½†æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·çš„ç³»ç»Ÿå¯ä»¥è¿›è¡Œ filesystem çš„æ‰©å……æˆ–ç¼©å°å‘¢ï¼Ÿå®ƒä¸ä¸€ä¸ªç§°ä¸º <strong>PE</strong> çš„é¡¹ç›®æœ‰å…³</p><h3 id="physical-volume-pv-å®ä½“æ»šåŠ¨æ¡" tabindex="-1"><a class="header-anchor" href="#physical-volume-pv-å®ä½“æ»šåŠ¨æ¡" aria-hidden="true">#</a> Physical Volume PV å®ä½“æ»šåŠ¨æ¡</h3><p>å®é™…çš„ partitionï¼ˆæˆ– DISKï¼‰éœ€è¦è°ƒæ•´ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆsystem IDï¼‰æˆä¸º 8eï¼ˆLVM çš„æ ‡è¯†ç¬¦ï¼‰ï¼Œå†ç»è¿‡ pvcreate çš„æŒ‡ä»¤å°†ä»–è½¬æˆ LVM æœ€åº•å±‚çš„å®ä½“æ»šåŠ¨æ¡ï¼ˆLVï¼‰ï¼Œä¹‹åæ‰å¯ä»¥å°†è¿™äº› PV åŠ ä»¥åˆ©ç”¨ï¼Œè°ƒæ•´ system ID çš„æ–¹å¼æ˜¯é€šè¿‡ gdisk</p><h3 id="volume-group-vg-æ»šåŠ¨æ¡ç»„" tabindex="-1"><a class="header-anchor" href="#volume-group-vg-æ»šåŠ¨æ¡ç»„" aria-hidden="true">#</a> Volume Group VG æ»šåŠ¨æ¡ç»„</h3><p>LVM å¤§ç£ç›˜æ˜¯å°†è®¸å¤š PV æ•´åˆæˆè¿™ä¸ª VG ï¼Œæ‰€ä»¥ VG æ˜¯ LVM ç»„åˆèµ·æ¥çš„æ‰“ç£ç›˜ã€‚åœ¨é¢„è®¾æƒ…å†µä¸‹ï¼Œä½¿ç”¨ 32 ä½çš„ Linux ç³»ç»Ÿæ—¶ï¼ŒåŸºæœ¬ä¸Š LV æœ€å¤§ä»…èƒ½æ”¯æŒåˆ° 65534 ä¸ª PE ï¼Œè‹¥ä½¿ç”¨é¢„è®¾çš„ PE ä¸º 4MB çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§å®¹é‡å¯ä»¥è¾¾åˆ°çº¦ 256Gbï¼Œè€Œåœ¨ 64 ä½çš„ Linux ä¸Šï¼ŒLV å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå®¹é‡é™åˆ¶äº†</p><h3 id="physical-extent-pe-å®ä½“èŒƒå›´åŒºå—" tabindex="-1"><a class="header-anchor" href="#physical-extent-pe-å®ä½“èŒƒå›´åŒºå—" aria-hidden="true">#</a> Physical Extent PE å®ä½“èŒƒå›´åŒºå—</h3><p>LVM é¢„è®¾ä½¿ç”¨ 4MB çš„ PE åŒºå—ï¼ŒLV åœ¨ 32 ä½ç³»ç»Ÿä¸Šæœ€å¤šæœ‰ 65534 ä¸ª PEï¼ˆlvml çš„æ ¼å¼ï¼‰ï¼Œå› æ­¤é¢„è®¾çš„ LVM çš„ LV æœ‰ 4M*65534/1024M=256G.</p><p>PE æ˜¯æ•´ä¸ª LVM æœ€å°çš„å­˜å‚¨å—ï¼Œæˆ‘ä»¬å†™å…¥çš„æ•°æ®éƒ½æ˜¯å†™å…¥ PE çš„ï¼Œç®€å•è¯´ï¼ŒPE ç±»ä¼¼ç³»ç»Ÿé‡Œé¢çš„ blockã€‚</p><p>æ‰€ä»¥è°ƒæ•´ PE ä¼šå½±å“åˆ° LVM çš„æœ€å¤§å®¹é‡ï¼Œä¸è¿‡åœ¨ CentOS 6.x ä»¥åï¼Œç›´æ¥ä½¿ç”¨ lvm2 çš„å„é¡¹æ ¼å¼åŠŸèƒ½ï¼Œä»¥åŠç³»ç»Ÿå˜æˆäº† 64 ä½ï¼Œå› æ­¤æ•´ä¸ªé™åˆ¶ä»¥åŠä¸å­˜åœ¨äº†</p><h3 id="logical-volume-lv-é€»è¾‘æ»šåŠ¨æ¡" tabindex="-1"><a class="header-anchor" href="#logical-volume-lv-é€»è¾‘æ»šåŠ¨æ¡" aria-hidden="true">#</a> Logical Volume LV é€»è¾‘æ»šåŠ¨æ¡</h3><p>æœ€ç»ˆçš„ VG è¿˜ä¼šè¢«è¢«åˆ‡æˆ LVï¼ŒLV æ˜¯æœ€åå¯ä»¥è¢«æ ¼å¼åŒ–ä½¿ç”¨çš„ç±»ä¼¼åˆ†åŒºæ§½çš„ä¸œè¥¿ï¼Œç”±äº PE æ˜¯æ•´ä¸ª LVM çš„æœ€å°å­˜å‚¨å•ä½ï¼Œé‚£ä¹ˆ LV çš„å¤§å°å°±ä¸ LV å†…çš„ PE æ€»æ•°æœ‰å…³ã€‚ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åˆ©ç”¨ LVM æ¥ç®¡ç†å…¶ç³»ç»Ÿï¼Œå› æ­¤ LV çš„è£…ç½®æ–‡ä»¶åé€šå¸¸æŒ‡å®šä¸º <code>/dev/vgname/lvname</code>çš„æ ·å¼</p><p>LVM å¯å¼¹æ€§çš„å˜æ›´ filesystem çš„å®¹é‡æ˜¯é€šè¿‡ã€Œäº¤æ¢ PEã€æ¥è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œå°†åŸæœ¬ LV å†…çš„ PE è½¬ç§»åˆ°å…¶ä»–è£…ç½®ä¸­ä»¥é™ä½ LV å®¹é‡ï¼Œæˆ–å°†å…¶ä»–è£…ç½®çš„ PE åŠ åˆ°æ­¤ LV ä¸­ä»¥åŠ å¤§å®¹é‡ã€‚VGã€LV ä¸ PE çš„å…³ç³»ç±»ä¼¼ä¸‹å›¾ï¼š</p><figure><img src="'+d+'" alt="image-20200301205307039" tabindex="0" loading="lazy"><figcaption>image-20200301205307039</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼ŒVG å†…çš„ PE ä¼šåˆ†ç»™è™šçº¿éƒ¨åˆ†çš„ LVï¼Œå¦‚æœæœªæ¥è¿™ä¸ª VG è¦æ‰©å……çš„è¯ï¼ŒåŠ ä¸Šå…¶ä»–çš„ PV å³å¯ã€‚è€Œæœ€é‡è¦çš„ LV å¦‚æœè¦æ‰©å……çš„è¯ï¼Œä¹Ÿæ˜¯é€šè¿‡åŠ å…¥ VG å†…æ²¡æœ‰ä½¿ç”¨åˆ°çš„ PE æ¥æ‰©å……çš„</p><h3 id="å®æ“æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å®æ“æµç¨‹" aria-hidden="true">#</a> å®æ“æµç¨‹</h3><p>é€šè¿‡ PVã€VGã€LV çš„è§„åˆ’ä¹‹åï¼Œå†åˆ©ç”¨ mkfs å°† LV æ ¼å¼åŒ–ä¸ºå¯ä»¥åˆ©ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å®¹é‡åœ¨æœªæ¥è¿˜å¯ä»¥æ‰©å……æˆ–å‡å°‘ï¼Œè€Œä¸”é‡Œé¢çš„æ•°æ®è¿˜ä¸ä¼šè¢«å½±å“ï¼Œæ•´ä¸ªæµç¨‹ç”±åŸºç¡€åˆ°æœ€ç»ˆçš„ç»“æœå¯ä»¥è¿™æ ·çœ‹ï¼š</p><figure><img src="'+v+'" alt="image-20200301205826020" tabindex="0" loading="lazy"><figcaption>image-20200301205826020</figcaption></figure><p>å½“æ•°æ®å†™å…¥ LV æ—¶ï¼Œæœ‰ä¸¤ç§æœºåˆ¶å†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼š</p><ul><li><p>çº¿æ€§æ¨¡å¼ï¼ˆlinearï¼‰</p><p>å‡å¦‚å°† <code>/dev/vda1ã€/dev/vdb1</code> è¿™ä¸¤ä¸ª parition å‡å¦‚åˆ° VG ä¸­ï¼Œå¹¶ä¸”æ•´ä¸ª VG åªæœ‰ä¸€ä¸ª LV æ—¶ï¼Œé‚£ä¹ˆçº¿æ€§æ¨¡å¼å°±æ˜¯ï¼šå½“ <code>/dev/vda1</code> çš„å®¹é‡ç”¨å®Œä¹‹åï¼Œ<code>/dev/vdb1</code>çš„ç¡¬ç›˜æ‰ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å»ºè®®çš„æ¨¡å¼</p></li><li><p>äº¤é”™æ¨¡å¼ï¼ˆtripedï¼‰</p><p>å°±å¥½ç†è§£äº†ï¼Œä¸€ä»½æ•°æ®åˆ†å‰²åœ¨å¤šä¸ªç¡¬ç›˜ä¸Šï¼Œç†è®ºä¸Šè¯»å†™æ•ˆç‡ä¼šå¥½ç‚¹</p></li></ul><p>åŸºæœ¬ä¸Šï¼Œ<strong>LVM æœ€ä¸»è¦çš„ç”¨é€”æ˜¯å®ç°ä¸€ä¸ªå¯ä»¥å¼¹æ€§è°ƒæ•´å®¹é‡çš„æ–‡ä»¶ç³»ç»Ÿä¸Š</strong>ï¼Œè€Œä¸æ˜¯å»ºç«‹ä¸€ä¸ªæœ‰æ•ˆç‡ä¸ºä¸»çš„ç£ç›˜ï¼›å› ä¸ºæ•°æ®åˆ†å‰²åœ¨å¤šä¸ªç¡¬ç›˜ä¸Šï¼Œåªè¦åæ‰ä¸€å—ç¡¬ç›˜ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šä¼šæŸå¤±æ‰å¾ˆå¤šæ•°æ®ã€‚ä¸é€‚åˆ LVM</p><h2 id="ğŸ€-lvm-å®éªŒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-lvm-å®éªŒæµç¨‹" aria-hidden="true">#</a> ğŸ€ LVM å®éªŒæµç¨‹</h2><p>LVM å¿…é¡»æ ¸å¿ƒæœ‰æ”¯æŒä¸”éœ€è¦å®‰è£… lvm2 è½¯ä»¶ï¼Œè¾ƒæ–°çš„ distribution å·²ç»é¢„è®¾ LVM ç›¸å…³è½¯ä»¶å®‰è£…äº†ã€‚</p><p>ä¸Šä¸€èŠ‚å®éªŒ RAID æœ‰ 5 ä¸ªåˆ†åŒºï¼Œè¿™é‡Œè¿˜æ˜¯å»ºè®®ä¿®æ”¹ä¸‹ systemID æ¯”è¾ƒå¥½ï¼Œå°† RAID çš„ fd æ”¹ä¸º LVM çš„ 8eï¼Œå®éªŒæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä½¿ç”¨ 4 ä¸ª partitionï¼Œæ¯ä¸ª partition å®¹é‡ä¸º 1GBï¼Œä¸” system ID éœ€è¦ä¸º 8e</li><li>å…¨éƒ¨çš„ partition æ•´åˆä¸ºä¸€ä¸ª VGï¼ŒVG åç§°è®¾ç½®ä¸º vmrcodeï¼›ä¸” PE çš„å¤§å°ä¸º 16MB</li><li>å»ºç«‹ä¸€ä¸ªåä¸º vmrcode çš„ LVï¼Œå®¹é‡å¤§çº¦ 2G</li><li>æœ€ç»ˆè¿™ä¸ª LV æ ¼å¼åŒ– xfs çš„æ–‡ä»¶ç³»ç»Ÿä¸”æŒ‚è½½ <code>/srv/lvm</code> ä¸­</li></ul><ol start="0"><li>disk é˜¶æ®µï¼Œå®é™…çš„ç£ç›˜</li></ol>',33),k=a(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æœ€ç»ˆåˆ†åŒºå‡ºæ¥çš„ä¿¡æ¯å¦‚ä¸‹</span>
Number  Start <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>    End <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>  Size       Code  Name
   <span class="token number">1</span>            <span class="token number">2048</span>            <span class="token number">6143</span>   <span class="token number">2.0</span> MiB     EF02  
   <span class="token number">2</span>            <span class="token number">6144</span>         <span class="token number">2103295</span>   <span class="token number">1024.0</span> MiB  0700  
   <span class="token number">3</span>         <span class="token number">2103296</span>        <span class="token number">65026047</span>   <span class="token number">30.0</span> GiB    8E00  
   <span class="token number">4</span>        <span class="token number">65026048</span>        <span class="token number">67123199</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">5</span>        <span class="token number">67123200</span>        <span class="token number">69220351</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">6</span>        <span class="token number">69220352</span>        <span class="token number">71317503</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
 <span class="token number">7</span>        <span class="token number">71317504</span>        <span class="token number">73414655</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">8</span>        <span class="token number">73414656</span>        <span class="token number">75511807</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM

<span class="token comment"># å‰é¢è¯´çš„ 8e å°±æ˜¯è¿™é‡Œçš„ Code å­—æ®µï¼Œæ˜¯åœ¨å»ºç«‹åˆ†åŒºçš„æ—¶å€™æŒ‡å®šçš„ 8E00,ä¹Ÿå°±æ˜¯ LVM æ ¼å¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>PV é˜¶æ®µ</p><p>ä¸‹é¢æ˜¯ä¸ PV æœ‰å…³çš„æŒ‡ä»¤</p><ul><li>pvcreateï¼šå°†å®ä½“ partition å»ºç«‹æˆä¸º PV</li><li>pvscanï¼šæœç´¢ç›®å‰ç³»ç»Ÿé‡Œé¢ä»»ä½•å…·æœ‰ PV çš„ç£ç›˜</li><li>pvdisplayï¼šæ˜¾ç¤ºç›®å‰ç³»ç»Ÿä¸Š PV çŠ¶æ€</li><li>pvremoveï¼šå°† PV å±æ€§ç§»é™¤ï¼Œè®©è¯¥ partition ä¸å…·æœ‰ PV å±æ€§</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ£€æŸ¥æœ‰æ—  PV åœ¨ç³»ç»Ÿä¸Š</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># pvscan </span>
  PV /dev/sda3   VG centos          lvm2 <span class="token punctuation">[</span><span class="token number">30.00</span> GiB / <span class="token number">14.00</span> GiB free<span class="token punctuation">]</span>
  Total: <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">30.00</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> use: <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">30.00</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> no VG: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">0</span>   <span class="token punctuation">]</span>
<span class="token comment"># åœ¨å®‰è£…çš„æ—¶å€™å°±ä½¿ç”¨äº† LVM äº†ï¼Œ /dev/sda3 å°±æ˜¯</span>

<span class="token comment"># å°† /dev/sda{4-7} å»ºç«‹æˆä¸º pv æ ¼å¼</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sda{4,5,6,7}</span>
  Physical volume <span class="token string">&quot;/dev/sda4&quot;</span> successfully created.
  Physical volume <span class="token string">&quot;/dev/sda5&quot;</span> successfully created.
  Physical volume <span class="token string">&quot;/dev/sda6&quot;</span> successfully created.
  Physical volume <span class="token string">&quot;/dev/sda7&quot;</span> successfully created.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># pvscan </span>
  PV /dev/sda3   VG centos          lvm2 <span class="token punctuation">[</span><span class="token number">30.00</span> GiB / <span class="token number">14.00</span> GiB free<span class="token punctuation">]</span>
  PV /dev/sda6                      lvm2 <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
  PV /dev/sda4                      lvm2 <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
  PV /dev/sda5                      lvm2 <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
  PV /dev/sda7                      lvm2 <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
  Total: <span class="token number">5</span> <span class="token punctuation">[</span><span class="token number">34.00</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> use: <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">30.00</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> no VG: <span class="token number">4</span> <span class="token punctuation">[</span><span class="token number">4.00</span> GiB<span class="token punctuation">]</span>
 <span class="token comment"># æœ€åä¸€è¡Œæ˜¾ç¤ºæ•´ä½“ PV çš„é‡ / å·²ç»è¢«ä½¿ç”¨åˆ°çš„ VG çš„ PV é‡ / å‰©ä½™ PV é‡</span>
  
 <span class="token comment"># æ›´è¯¦ç»†çš„åˆ—å‡ºç³»ç»Ÿä¸Šæ¯ä¸ª PV çš„ä¸ªåˆ«ä¿¡æ¯</span>
 <span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># pvdisplay /dev/sda4</span>
  <span class="token string">&quot;/dev/sda4&quot;</span> is a new physical volume of <span class="token string">&quot;1.00 GiB&quot;</span>
  --- NEW Physical volume ---
  PV Name               /dev/sda4		<span class="token comment"># å®é™…çš„ partition è£…ç½®åç§°</span>
  VG Name               				  <span class="token comment"># å› ä¸ºå°šæœªåˆ†é…å‡ºå»ï¼Œæ‰€ä»¥ç©ºç™½çš„</span>
  PV Size               <span class="token number">1.00</span> GiB		<span class="token comment"># å®¹é‡</span>
  Allocatable           NO				<span class="token comment"># æ˜¯å¦å·²è¢«åˆ†é…</span>
  PE Size               <span class="token number">0</span>   			 <span class="token comment"># æ­¤ PV å†… PE çš„å¤§å°</span>
  Total PE              <span class="token number">0</span>				  <span class="token comment"># å…±åˆ†åŒºå‡ºå‡ ä¸ª PE</span>
  Free PE               <span class="token number">0</span>				  <span class="token comment"># æ²¡è¢« LV ç”¨æ‰çš„ PE</span>
  Allocated PE          <span class="token number">0</span>				  <span class="token comment"># å¯ä»¥è¢«åˆ†é…å‡ºå»çš„ PE æ•°é‡	</span>
  PV UUID               ecfFVZ-Qesj-6xhF-3p0w-9GCO-ULGG-q9Kpg9
  <span class="token comment"># ç”±äº PE æ˜¯å»ºç«‹ VG æ—¶æ‰ç»™äºˆçš„å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹åˆ°çš„ PE éƒ½ä¼šæ˜¯ 0</span>
  <span class="token comment"># è€Œä¸”ä¹Ÿæ²¡æœ‰å¤šä½™çš„ PE å¯å…±åˆ†é…ï¼ˆallocatableï¼‰</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>VG é˜¶æ®µ</p><p>ä¸ VG ç›¸å…³æŒ‡ä»¤æœ‰ï¼š</p><ul><li>vgcreateï¼šä¸»è¦å»ºç«‹ VG çš„æŒ‡ä»¤ï¼Œå‚æ•°è¾ƒå¤š</li><li>vgscanï¼šæœç´¢ç³»ç»Ÿä¸Šçš„ VG</li><li>vgdisplayï¼šæ˜¾ç¤º VG çŠ¶æ€</li><li>vgextendï¼šåœ¨ VG å†…å¢åŠ é¢å¤–çš„ PV</li><li>vgreduceï¼šåœ¨ VG å†…ç§»é™¤ PV</li><li>vgchangeï¼šè®¾ç½® VG æ˜¯å¦å¯åŠ¨ï¼ˆactiveï¼‰</li><li>vgremoveï¼šåˆ é™¤ä¸€ä¸ª VG</li></ul><p>PV çš„åç§°å…¶å®å°±æ˜¯ partition çš„è£…ç½®æ–‡ä»¶åï¼Œè€Œ VG çš„åç§°æ˜¯è‡ªå®šä¹‰çš„ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vgcreate <span class="token punctuation">[</span>-s N<span class="token punctuation">[</span>mgt<span class="token punctuation">]</span><span class="token punctuation">]</span> VGåç§° PVåç§°

é€‰é¡¹ä¸å‚æ•°ï¼š
	-sï¼šåé¢æ¥ PE çš„å¤§å° siteï¼Œå•ä½å¯ä»¥æ˜¯ mã€gã€t å¤§å°å†™å‡å¯
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å°† /dev/sda4-6 å»ºç«‹ä¸ºä¸€ä¸ª VGï¼Œä¸”æŒ‡å®š PE ä¸º 16MB</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgcreate -s 16M vmcrcodevg /dev/sda{4,5,6}</span>
  Volume group <span class="token string">&quot;vmcrcodevg&quot;</span> successfully created
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># pvscan </span>
  PV /dev/sda4   VG vmcrcodevg      lvm2 <span class="token punctuation">[</span><span class="token number">1008.00</span> MiB / <span class="token number">1008.00</span> MiB free<span class="token punctuation">]</span>
  PV /dev/sda5   VG vmcrcodevg      lvm2 <span class="token punctuation">[</span><span class="token number">1008.00</span> MiB / <span class="token number">1008.00</span> MiB free<span class="token punctuation">]</span>
  PV /dev/sda6   VG vmcrcodevg      lvm2 <span class="token punctuation">[</span><span class="token number">1008.00</span> MiB / <span class="token number">1008.00</span> MiB free<span class="token punctuation">]</span>
  PV /dev/sda3   VG centos          lvm2 <span class="token punctuation">[</span><span class="token number">30.00</span> GiB / <span class="token number">14.00</span> GiB free<span class="token punctuation">]</span>
  PV /dev/sda7                      lvm2 <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
  Total: <span class="token number">5</span> <span class="token punctuation">[</span><span class="token number">33.95</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> use: <span class="token number">4</span> <span class="token punctuation">[</span><span class="token number">32.95</span> GiB<span class="token punctuation">]</span> / <span class="token keyword">in</span> no VG: <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span>
<span class="token comment"># å¯ä»¥å‘ç°æœ‰ 3 ä¸ª PVè¢«åˆ†æ‰äº†</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay vmcrcodevg</span>
  --- Volume group ---
  VG Name               vmcrcodevg
  System ID             
  Format                lvm2
  Metadata Areas        <span class="token number">3</span>
  Metadata Sequence No  <span class="token number">1</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">0</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">3</span>
  Act PV                <span class="token number">3</span>
  VG Size               <span class="token number">2.95</span> GiB		<span class="token comment"># æ•´ä½“ VG å®¹é‡å¤§å°</span>
  PE Size               <span class="token number">16.00</span> MiB		<span class="token comment"># å†…éƒ¨æ¯ä¸ª PE çš„å¤§å°</span>
  Total PE              <span class="token number">189</span>				<span class="token comment"># æ€»å…± PE çš„æ•°é‡</span>
  Alloc PE / Size       <span class="token number">0</span> / <span class="token number">0</span>   
  Free  PE / Size       <span class="token number">189</span> / <span class="token number">2.95</span> GiB		<span class="token comment"># å¯é…ç½®ç»™ LV çš„ PE æ•°é‡/ æ€»å®¹é‡</span>
  VG UUID               JQP2VZ-ilbN-MBuw-jccl-do84-tHu6-BInUXS

<span class="token comment"># å‰©ä½™çš„ PV /dev/sda7 åˆ†é…ä¸ª ç»™ vmcrcodevg</span>
<span class="token comment"># åœ¨ VG å†…å¢åŠ é¢å¤–çš„ PV</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgextend vmcrcodevg /dev/sda7</span>
  Volume group <span class="token string">&quot;vmcrcodevg&quot;</span> successfully extended
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay vmcrcodevg</span>
  --- Volume group ---
  VG Name               vmcrcodevg
  System ID             
  Format                lvm2
  Metadata Areas        <span class="token number">4</span>
  Metadata Sequence No  <span class="token number">2</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">0</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">4</span>
  Act PV                <span class="token number">4</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">3.94</span> GiB
  PE Size               <span class="token number">16.00</span> MiB
  Total PE              <span class="token number">252</span>				<span class="token comment"># PE å˜å¤§äº†ï¼Œå¯ç”¨å®¹é‡ä¹Ÿå˜å¤§äº†</span>
  Alloc PE / Size       <span class="token number">0</span> / <span class="token number">0</span>   
  Free  PE / Size       <span class="token number">252</span> / <span class="token operator">&lt;</span><span class="token number">3.94</span> GiB
  VG UUID               JQP2VZ-ilbN-MBuw-jccl-do84-tHu6-BInUXS

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>LV é˜¶æ®µ</p><p>æœ‰äº† VG è¿™ä¸ªå¤§ç£ç›˜ä¹‹åï¼Œå°±å¯ä»¥å»ºç«‹åˆ†åŒºäº†ã€‚å…ˆäº†è§£ä¸ LV ç›¸å…³çš„æŒ‡ä»¤ï¼š</p><ul><li>lvcreateï¼šå»ºç«‹ LV</li><li>lvscanï¼šæŸ¥è¯¢ç³»ç»Ÿä¸Šçš„ LV</li><li>lvdisplayï¼šæ˜¾ç¤ºç³»ç»Ÿä¸Šé¢çš„ LV çŠ¶æ€</li><li>lvextendï¼šåœ¨ LV é‡Œé¢å¢åŠ å®¹é‡</li><li>lvreduceï¼šåœ¨ LV é‡Œé¢å‡å°‘å®¹é‡</li><li>lvremoveï¼šåˆ é™¤ä¸€ä¸ª LV</li><li>lvresizeï¼šå¯¹ LV è¿›è¡Œå®¹é‡å¤§å°è°ƒæ•´</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>lvcreate <span class="token punctuation">[</span>-L N<span class="token punctuation">[</span>mgt<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-n lvåç§°<span class="token punctuation">]</span> VGåç§°
lvcreate <span class="token punctuation">[</span>-l n<span class="token punctuation">]</span> <span class="token punctuation">[</span>-n lvåç§°<span class="token punctuation">]</span> VGåç§°

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Lï¼šåé¢æ¥å®¹é‡ï¼Œè¦æ³¨æ„ï¼šæœ€å°å•ä½ä¸º PEï¼Œä¹Ÿå°±æ˜¯å¿…é¡»çš„ PE çš„å€æ•°ï¼Œå¦‚æœä¸æ˜¯ï¼Œç³»ç»Ÿåˆ™è‡ªè¡Œè®¡ç®—æœ€ç›¸è¿‘çš„å®¹é‡
	-lï¼šåé¢æ¥ PE çš„ä¸ªæ•°ï¼Œè‹¥è¦è¿™ä¹ˆåšï¼Œéœ€è¦è‡ªè¡Œè®¡ç®— PE æ•°
	-nï¼šåé¢æ¥ LV çš„åç§°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å°† vmcrcodevg åˆ† 2GB ç»™ vmmrcodelv</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvcreate -L 2G -n vmmrcodelv vmcrcodevg</span>
  Logical volume <span class="token string">&quot;vmmrcodelv&quot;</span> created.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvscan </span>
  ACTIVE            <span class="token string">&#39;/dev/vmcrcodevg/vmmrcodelv&#39;</span> <span class="token punctuation">[</span><span class="token number">2.00</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/root&#39;</span> <span class="token punctuation">[</span><span class="token number">10.00</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/home&#39;</span> <span class="token punctuation">[</span><span class="token number">5.00</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/swap&#39;</span> <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span> inherit
<span class="token comment"># ç”±äºæœ¬åˆ—ä¸­æ¯ä¸ª PE ä¸º 16Mï¼Œå¦‚æœè¦ç”¨ PE çš„æ•°é‡æ¥å¤„ç†çš„è¯ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤</span>
<span class="token comment"># lvcreate -l 128 -n vmmrcodelv vmcrcodevg</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvdisplay /dev/vmcrcodevg/vmmrcodelv </span>
  --- Logical volume ---
  LV Path                /dev/vmcrcodevg/vmmrcodelv		<span class="token comment"># lv å…¨å</span>
  LV Name                vmmrcodelv
  VG Name                vmcrcodevg
  LV UUID                V0WB3Y-SQr3-4hLb-D5IC-8fN6-6PEY-NPdJxz
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> study.centos.mrcode, <span class="token number">2020</span>-03-01 <span class="token number">22</span>:03:40 +0800
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">2.00</span> GiB		<span class="token comment"># å®¹é‡</span>
  Current LE             <span class="token number">128</span>
  Segments               <span class="token number">3</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:3

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ–‡ä»¶ç³»ç»Ÿé˜¶æ®µ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs /dev/vmcrcodevg/vmmrcodelv </span>
meta-data<span class="token operator">=</span>/dev/vmcrcodevg/vmmrcodelv <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">131072</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">524288</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/vmcrcodevg/vmmrcodelv /srv/lvm/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/lvm/</span>
æ–‡ä»¶ç³»ç»Ÿ                          ç±»å‹  å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.0G   33M  <span class="token number">2</span>.0G    <span class="token number">2</span>% /srv/lvm

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°±å»ºç«‹å¥½ä¸€ä¸ª LV äº†ï¼Œå¯ä»¥ä½¿ç”¨ /srv/lvm äº†</p></li></ol><h2 id="ğŸ€-æ”¾å¤§-lv-å®¹é‡" tabindex="-1"><a class="header-anchor" href="#ğŸ€-æ”¾å¤§-lv-å®¹é‡" aria-hidden="true">#</a> ğŸ€ æ”¾å¤§ LV å®¹é‡</h2><p>LVM æœ€å¤§çš„ç‰¹è‰²æ˜¯å¼¹æ€§è°ƒæ•´ç£ç›˜å®¹é‡ï¼Œå‰é¢è¯´åˆ°ï¼Œæ”¾å¤§ LV éœ€è¦æœ‰ä¸‹é¢è¿™äº›æµç¨‹ï¼š</p><ol><li><p>VG é˜¶æ®µéœ€è¦æœ‰å‰©ä½™çš„å®¹é‡</p><p>å¦‚æœ VG é˜¶æ®µæ²¡æœ‰å¤šä½™çš„å®¹é‡ï¼Œé‚£ä¹ˆå°±å¢åŠ ç¡¬ç›˜ç­‰æ‰‹æ®µåˆ›å»º PVï¼Œç„¶åå¢åŠ åˆ° VG ä¸­ï¼Œå¯åˆ©ç”¨ pvcreate å’Œ vgextedn æ¥æ“ä½œ</p></li><li><p>LV é˜¶æ®µäº§ç”Ÿæ›´å¤šå¯ç”¨å®¹é‡</p><p>æœ‰äº†è¶³å¤Ÿçš„ VGï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ lvresize æŒ‡ä»¤å°†å‰©ä½™å®¹é‡åŠ å…¥åˆ° LV ä¸­</p></li><li><p>æ–‡ä»¶ç³»ç»Ÿé˜¶æ®µæ”¾å¤§</p><p>Linux å®é™…ä½¿ç”¨çš„å…¶å®ä¸æ˜¯ LVï¼Œè€Œæ˜¯ LV è¿™ä¸ªè£…ç½®å†…çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸€åˆ‡æœ€ç»ˆè¿˜æ˜¯ä»¥æ–‡ä»¶ç³»ç»Ÿä¸ºä¾å½’ã€‚ç›®å‰åœ¨ Linux ä¸‹ï¼Œä½œè€…æµ‹è¯•è¿‡å¯ä»¥æ”¾å¤§çš„æ–‡ä»¶ç³»ç»Ÿæœ‰ XFS å’Œ EXT å®¶æ—ï¼Œè‡³äºç¼©å°åˆ™åªæœ‰ EXT å®¶æ—ï¼Œç›®å‰ XFS æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿçš„å®¹é‡ç¼©å°</p><p>xfs æ”¾å¤§å¯ä»¥é€šè¿‡ xfs_growfs æŒ‡ä»¤</p></li></ol><p>æœ€åä¸€ä¸ªæ­¥éª¤æœ€é‡è¦ï¼Œåœ¨ç¬¬ 7 ç« ä¸­çŸ¥é“ï¼Œæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿåœ¨æœ€åˆæ ¼å¼åŒ–çš„æ—¶å€™å°±å»ºç«‹äº† inodeã€blockã€superblock ç­‰ä¿¡æ¯ï¼Œè¦æ”¹å˜è¿™äº›ä¿¡æ¯å¾ˆéš¾ï¼Œä¸è¿‡å› ä¸ºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–çš„æ—¶å€™å»ºç«‹çš„æ˜¯å¤šä¸ª block groupï¼Œå› æ­¤å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å¢åŠ  block group çš„æ–¹å¼æ¥å¢å‡æ–‡ä»¶ç³»ç»Ÿçš„é‡ï¼Œè€Œå¢åŠ  block group å°±æ˜¯åˆ©ç”¨ xfs_growfs æŒ‡ä»¤</p><p>å¦å¤–ï¼Œä¸¥æ ¼è¯´èµ·æ¥ï¼Œæ”¾å¤§æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸æ˜¯æ²¡æœ‰è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ–çš„ä½ç½®åœ¨äºè¯¥è£…ç½®åæ¥æ–°å¢çš„éƒ¨åˆ†ï¼Œè£…ç½®çš„å‰é¢å·²ç»å­˜åœ¨çš„æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚æ–°å¢çš„æ ¼å¼åŒ–è¿‡çš„æ•°æ®ï¼Œå†åé¦ˆå›åŸæœ¬çš„ supberblock ã€‚</p><p>è¿™é‡Œé’ˆå¯¹ <code>/srv/lvm</code> å¢åŠ  500MB å®¹é‡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ£€æŸ¥ VG</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay vmcrcodevg </span>
  --- Volume group ---
  VG Name               vmcrcodevg
  System ID             
  Format                lvm2
  Metadata Areas        <span class="token number">4</span>
  Metadata Sequence No  <span class="token number">3</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">1</span>
  Open LV               <span class="token number">1</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">4</span>
  Act PV                <span class="token number">4</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">3.94</span> GiB
  PE Size               <span class="token number">16.00</span> MiB
  Total PE              <span class="token number">252</span>
  Alloc PE / Size       <span class="token number">128</span> / <span class="token number">2.00</span> GiB
  Free  PE / Size       <span class="token number">124</span> / <span class="token operator">&lt;</span><span class="token number">1.94</span> GiB	<span class="token comment"># è¿™é‡Œè¿˜æœ‰å‰©ä½™çš„ PE æœªä½¿ç”¨</span>
  VG UUID               JQP2VZ-ilbN-MBuw-jccl-do84-tHu6-BInUXS
  
<span class="token comment"># ç›´æ¥æ”¾å¤§ LV</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvresize -L +500 /dev/vmcrcodevg/vmmrcodelv </span>
  Rounding size to boundary between physical extents: <span class="token number">512.00</span> MiB.
  Size of logical volume vmcrcodevg/vmmrcodelv changed from <span class="token number">2.00</span> GiB <span class="token punctuation">(</span><span class="token number">128</span> extents<span class="token punctuation">)</span> to <span class="token number">2.50</span> GiB <span class="token punctuation">(</span><span class="token number">160</span> extents<span class="token punctuation">)</span>.
  Logical volume vmcrcodevg/vmmrcodelv successfully resized.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvscan </span>
  ACTIVE            <span class="token string">&#39;/dev/vmcrcodevg/vmmrcodelv&#39;</span> <span class="token punctuation">[</span><span class="token number">2.50</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/root&#39;</span> <span class="token punctuation">[</span><span class="token number">10.00</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/home&#39;</span> <span class="token punctuation">[</span><span class="token number">5.00</span> GiB<span class="token punctuation">]</span> inherit
  ACTIVE            <span class="token string">&#39;/dev/centos/swap&#39;</span> <span class="token punctuation">[</span><span class="token number">1.00</span> GiB<span class="token punctuation">]</span> inherit
<span class="token comment"># å¯ä»¥çœ‹åˆ° lv å˜å¤§äº†</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/lvm/</span>
Filesystem                        Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.0G   33M  <span class="token number">2</span>.0G   <span class="token number">2</span>% /srv/lvm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ° LV å¢åŠ åˆ°äº† 2.5Gï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»Ÿè¿˜æœªå¢åŠ ã€‚ä¸‹é¢ç»§ç»­å¤„ç†æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å®¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹åŸæ–‡ä»¶ç³»ç»Ÿå†…çš„ superblock è®°å½•</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># xfs_info /srv/lvm/</span>
meta-data<span class="token operator">=</span>/dev/mapper/vmcrcodevg-vmmrcodelv <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">131072</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">spinodes</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">524288</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal               <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># agcount=4ï¼Œblocks=524288</span>

<span class="token comment"># å¾ˆå…³é”®çš„ä¸€æ­¥æ¥äº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># xfs_growfs /srv/lvm/</span>
meta-data<span class="token operator">=</span>/dev/mapper/vmcrcodevg-vmmrcodelv <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">131072</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">spinodes</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">524288</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal               <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
data blocks changed from <span class="token number">524288</span> to <span class="token number">655360</span>
<span class="token comment"># è¿™é‡Œçš„ blocks æ”¹å˜åˆ° 655360 äº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># xfs_info /srv/lvm/</span>
meta-data<span class="token operator">=</span>/dev/mapper/vmcrcodevg-vmmrcodelv <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">5</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">131072</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">spinodes</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">655360</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal               <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># ç°åœ¨ agcount=5ï¼Œblocks=655360 äº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th  /srv/lvm/</span>
Filesystem                        Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/lvm

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä¸Šå±•ç¤ºäº†ï¼Œåœ¨ä¸åœæœºçš„æƒ…å†µä¸‹å¯ä»¥è¿›è¡Œæ‰©å®¹ï¼Œå¾ˆæ£’çš„ç‰¹æ€§ï¼›</p><p>æœ€åæ³¨æ„ï¼Œç›®å‰çš„ XFS æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ²¡æœ‰ç¼©å°æ–‡ä»¶ç³»ç»Ÿå®¹é‡çš„è®¾è®¡ã€‚åªæœ‰ EXT å®¶æ—å¯ä»¥</p><h2 id="ğŸ€-ä½¿ç”¨-lvm-thin-volume-è®©-lvm-åŠ¨æ€è‡ªåŠ¨è°ƒæ•´ç£ç›˜ä½¿ç”¨ç‡" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-lvm-thin-volume-è®©-lvm-åŠ¨æ€è‡ªåŠ¨è°ƒæ•´ç£ç›˜ä½¿ç”¨ç‡" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ LVM thin Volume è®© LVM åŠ¨æ€è‡ªåŠ¨è°ƒæ•´ç£ç›˜ä½¿ç”¨ç‡</h2><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæœ‰ä¸ªç›®å½•æœªæ¥ä¼šä½¿ç”¨åˆ°å¤§çº¦ 5T çš„å®¹é‡ï¼Œä½†æ˜¯ç›®å‰ä½ çš„ç£ç›˜åªæœ‰ 3Tï¼Œä½†æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæœˆä½ çš„ç³»ç»Ÿéƒ½ä¸ä¼šè¶…è¿‡ 3T çš„å®¹é‡ï¼Œä½†æ˜¯ä½ è¦è®©ç”¨æˆ·çŸ¥é“ï¼Œä»–æœ€æœ€å¤šæœ‰ 5T çš„ç©ºé—´å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸”åœ¨ä¸€ä¸ªæœˆå†…ä½ ç¡®å®å¯ä»¥å°†ç³»ç»Ÿæå‡åˆ° 5T ä»¥ä¸Šçš„å®¹é‡ï¼Œåˆä¸æƒ³åœ¨æå‡å®¹é‡åæ‰æ”¾å¤§åˆ° 5Tï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ï¼šå®é™…ç”¨å¤šå°‘æ‰åˆ†é…å¤šå°‘å®¹é‡ç»™ LV çš„ LVM Thin Volume åŠŸèƒ½</p><p>å†è€ƒè™‘ä¸€ä¸ªç¯å¢ƒï¼šä½ éœ€è¦ 3 ä¸ª 10GB çš„ç¡¬ç›˜è¿›è¡ŒæŸäº›æµ‹è¯•ï¼Œä½†æ˜¯ä½ çš„ç¯å¢ƒåªæœ‰ 5Gb çš„å‰©ä½™å®¹é‡ï¼Œåœ¨ä¼ ç»Ÿçš„ LVM ç¯å¢ƒä¸‹ï¼ŒLV çš„å®¹é‡æ˜¯ä¸€å¼€å§‹å°±åˆ†é…å¥½çš„ï¼Œå› æ­¤ä½ æ²¡æœ‰åŠæ³•åœ¨è¿™æ ·çš„ç¯å¢ƒä¸­äº§ç”Ÿå‡º 3 ä¸ª 10GB çš„è£…ç½®ï¼Œè€Œä¸” 10GB çš„è£…ç½®å…¶å®æ¯ä¸ªå®é™…ä½¿ç”¨ç‡éƒ½æ²¡æœ‰è¶…è¿‡ 10%ï¼Œä¹Ÿå°±æ˜¯æ€»ç”¨é‡ç›®å‰åªç”¨åˆ° 3GBï¼Œä½ å®é™…æœ‰ 5GBçš„å®¹é‡ï¼Œé‚£ä¹ˆä¹…å¯ä»¥ä½¿ç”¨ LVM Thin Volume åšå‡º 3 ä¸ªåªç”¨ 1GB çš„ 10GB è£…ç½®</p><p>LVM thin Volume çš„æ¦‚å¿µæ˜¯ï¼šå…ˆå»ºç«‹ä¸€ä¸ªå¯ä»¥å®æ”¯å®ä»˜ã€ç”¨å¤šå°‘å®¹é‡æ‰åˆ†é…å®é™…å†™å…¥å¤šå°‘å®¹é‡çš„ç£ç›˜å®¹é‡å­˜å‚¨æ± ï¼ˆthin poolï¼‰ï¼Œç„¶åå†ç”±è¿™ä¸ª thin pool å»äº§ç”Ÿä¸€ä¸ªã€ŒæŒ‡å®šè¦å›ºå®šå®¹é‡å¤§å°çš„ LV è£…ç½®ã€ï¼Œä½†æ˜¯è¿™ä¸ª LV åœ¨å£°æ˜ä¸Šï¼Œä»–çš„å®¹é‡å¯èƒ½æœ‰ 10GBï¼Œä½†å®é™…ä¸Šï¼Œè¯¥è£…ç½®ç”¨åˆ°å¤šå°‘å®¹é‡æ—¶ï¼Œæ‰ä¼šä» thin pool å»å®é™…å–å¾—æ‰€éœ€çš„å®¹é‡ã€</p><p>thin pool åªæœ‰ 1GB çš„å®é™…å®¹é‡ï¼Œä½†æ˜¯å¯ä»¥åˆ†é…ä¸€ä¸ª 10GB çš„ LV è£…ç½®ï¼Œè¯¥è£…ç½®å®é™…ç”¨åˆ° 500M æ—¶ï¼Œthin pool ä¹Ÿå°±åªæœ‰ 500M åˆ†é…ç»™ä»–ï¼Œä½†æ˜¯ç”± thin pool åˆ†é…å‡ºæ¥çš„ LV æ€»å®é™…ä½¿ç”¨é‡ç»å¯¹ä¸èƒ½è¶…è¿‡ thin pool çš„æœ€å¤§å®é™…å®¹é‡</p><p>ç®€å•å¯ä»¥ç†è§£ä¸ºï¼šå®é™…ä¸Šä½ åªæœ‰ 1G ç‰©ç†å®¹é‡ï¼Œä½†æ˜¯ä½ åˆ†é…ä¸€ä¸ª 10G çš„ lvï¼Œåªæ˜¯è¿™ä¸ª 10G çš„ lv æœ€å¤§å®é™…å®¹é‡ä¹Ÿå°±åªæœ‰ 1G</p><p>ä¸‹é¢ä½¿ç”¨å‰©ä½™çš„å®¹é‡ï¼Œæ¥å®è·µç»ƒä¹ ï¼š</p><ol><li>ç”± vmcrcodevg çš„å‰©ä½™å®¹é‡å–å‡º 1GB æ¥åšå‡ºä¸€ä¸ªåä¸º vmrcodetpool çš„ thin pool LV è£…ç½®ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç£ç›˜å®¹é‡å­˜å‚¨æ±  thin pool</li><li>ç”± vmcrcodevg å†…çš„ vmrcodetpool äº§ç”Ÿä¸€ä¸ªåä¸º vmrcodethin1 çš„ 10GB LV è£…ç½®</li><li>å°†æ­¤è£…ç½®å®é™…æ ¼å¼åŒ–ä¸º XFS æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”æŒ‚è½½åˆ° <code>/srv/thin</code> ç›®å½•å†…</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åˆ›å»º thin pool</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvcreate -L 1G -T vmcrcodevg/vmrcodetpool</span>
  Thin pool volume with chunk size <span class="token number">64.00</span> KiB can address at <span class="token function">most</span> <span class="token number">15.81</span> TiB of data.
  Logical volume <span class="token string">&quot;vmrcodetpool&quot;</span> created.

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvdisplay /dev/vmcrcodevg/vmrcodetpool </span>
  --- Logical volume ---
  LV Name                vmrcodetpool
  VG Name                vmcrcodevg
  LV UUID                163HRB-1gOB-6SOS-Dion-g29K-uOZr-deGTyl
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> study.centos.mrcode, <span class="token number">2020</span>-03-01 <span class="token number">22</span>:40:42 +0800
  LV Pool metadata       vmrcodetpool_tmeta
  LV Pool data           vmrcodetpool_tdata
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">1.00</span> GiB		<span class="token comment"># æ€»å…±å¯åˆ†é…å‡ºå»å®¹é‡</span>
  Allocated pool data    <span class="token number">0.00</span>%			<span class="token comment"># ä»¥åˆ†é…çš„å®¹é‡ç™¾åˆ†æ¯”</span>
  Allocated metadata     <span class="token number">10.23</span>%			<span class="token comment"># ä»¥åˆ†é…çš„æ•°æ®ç™¾åˆ†æ¯”</span>
  Current LE             <span class="token number">64</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:6

<span class="token comment"># è¯­æ³•ä¸º lvs VGname</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvs vmcrcodevg</span>
  LV           VG         Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  vmmrcodelv   vmcrcodevg -wi-ao---- <span class="token number">2</span>.50g                                                    
  vmrcodetpool vmcrcodevg twi-a-tz-- <span class="token number">1</span>.00g             <span class="token number">0.00</span>   <span class="token number">10.23</span> 
  
<span class="token comment"># å¼€å§‹å»ºç«‹ 10GB çš„è£…ç½®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvcreate -V 10G -T vmcrcodevg/vmrcodetpool -n vmrcrodethin1</span>
  WARNING: Sum of all thin volume sizes <span class="token punctuation">(</span><span class="token number">10.00</span> GiB<span class="token punctuation">)</span> exceeds the size of thin pool vmcrcodevg/vmrcodetpool and the size of whole volume group <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">3.94</span> GiB<span class="token punctuation">)</span>.
  WARNING: You have not turned on protection against thin pools running out of space.
  WARNING: Set activation/thin_pool_autoextend_threshold below <span class="token number">100</span> to trigger automatic extension of thin pools before they get full.
  Logical volume <span class="token string">&quot;vmrcrodethin1&quot;</span> created.
  
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvs vmcrcodevg</span>
  LV            VG         Attr       LSize  Pool         Origin Data%  Meta%  Move Log Cpy%Sync Convert
  vmmrcodelv    vmcrcodevg -wi-ao----  <span class="token number">2</span>.50g                                                            
  vmrcodetpool  vmcrcodevg twi-aotz--  <span class="token number">1</span>.00g                     <span class="token number">0.00</span>   <span class="token number">10.25</span>                           
  vmrcrodethin1 vmcrcodevg Vwi-a-tz-- <span class="token number">10</span>.00g vmrcodetpool        <span class="token number">0.00</span> 
<span class="token comment"># å¤šäº†ä¸€ä¸ª vmrcrodethin1 è¿˜ä½¿ç”¨äº† Poolï¼Œå¹¶ä¸”æ˜¯ 10Gb çš„</span>

<span class="token comment"># åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs /dev/vmcrcodevg/vmrcrodethin1 </span>
meta-data<span class="token operator">=</span>/dev/vmcrcodevg/vmrcrodethin1 <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">163840</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2621440</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">16</span>     <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">16</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">16</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /srv/thin</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/vmcrcodevg/vmrcrodethin1 /srv/thin/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/thin/</span>
Filesystem                           Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmrcrodethin1 xfs    10G   33M   10G   <span class="token number">1</span>% /srv/thin
<span class="token comment"># å¯ä»¥çœ‹åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­æ˜¾ç¤ºæœ‰ 10GB çš„å®¹é‡</span>

<span class="token comment"># æµ‹è¯•ä¸‹å®¹é‡çš„ä½¿ç”¨ï¼Œå»ºç«‹ 500MB çš„æ–‡ä»¶</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/zero of=/srv/thin/test.img bs=1M count=500</span>
<span class="token number">500</span>+0 records <span class="token keyword">in</span>
<span class="token number">500</span>+0 records out
<span class="token number">524288000</span> bytes <span class="token punctuation">(</span><span class="token number">524</span> MB<span class="token punctuation">)</span> copied, <span class="token number">2.17685</span> s, <span class="token number">241</span> MB/s
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/thin/</span>
Filesystem                           Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmrcrodethin1 xfs    10G  533M  <span class="token number">9</span>.5G   <span class="token number">6</span>% /srv/thin

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvs vmcrcodevg</span>
  LV            VG         Attr       LSize  Pool         Origin Data%  Meta%  Move Log Cpy%Sync Convert
  vmmrcodelv    vmcrcodevg -wi-ao----  <span class="token number">2</span>.50g                                                            
  vmrcodetpool  vmcrcodevg twi-aotz--  <span class="token number">1</span>.00g                     <span class="token number">49.92</span>  <span class="token number">11.82</span>                           
  vmrcrodethin1 vmcrcodevg Vwi-aotz-- <span class="token number">10</span>.00g vmrcodetpool        <span class="token number">4.99</span> 
<span class="token comment"># è¿™æ—¶å·²ç»åˆ†é…å‡ºå» 49.92 çš„å®¹é‡äº†ï¼Œè€Œ vmrcrodethin1 å´åªçœ‹åˆ°ç”¨æ‰äº† 4.99% è€Œå·²</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ thin pool éå¸¸å¥½ç”¨ï¼Œä½†æ˜¯åœ¨ç®¡ç†ä¸Šï¼Œè¦ç‰¹åˆ«çš„ç•™æ„</p><p>åŸºæœ¬ä¸Š thin pool ï¼Œå¯ä»¥ç”¨æ¥éª—äººï¼Œä¸€ä¸ªç£ç›˜å¯ä»¥ä»¿çœŸå‡ºå¾ˆå¤šå®¹é‡æ¥ï¼Œå®é™…å¯ç”¨å®¹é‡åªæœ‰ç‰©ç†ç£ç›˜çš„å®¹é‡ï¼Œå¦‚æœè¶…è¿‡è¯¥å®¹é‡ï¼Œè¿™ä¸ª thin pool ä¸­çš„èµ„æ–™ä¼šæŸå</p><h2 id="ğŸ€-lvm-çš„-lv-ç£ç›˜å¿«ç…§" tabindex="-1"><a class="header-anchor" href="#ğŸ€-lvm-çš„-lv-ç£ç›˜å¿«ç…§" aria-hidden="true">#</a> ğŸ€ LVM çš„ LV ç£ç›˜å¿«ç…§</h2><p>LVM è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„èƒ½åŠ›ï¼Œå°±æ˜¯ç£ç›˜å¿«ç…§ï¼šå°†å½“æ—¶çš„ç³»ç»Ÿä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œå°±å¥½åƒç…§ç›¸è®°å½•ä¸€èˆ¬ï¼Œæœªæ¥è‹¥æœ‰ä»»ä½•èµ„æ–™å˜åŠ¨äº†ï¼Œåˆ™åŸå§‹èµ„æ–™ä¼šè¢«æ¬ç§»åˆ°å¿«ç…§åŒºï¼Œæ²¡æœ‰è¢«å˜åŠ¨çš„åŒºåŸŸåˆ™ç”±å¿«ç…§åŒºä¸æ–‡ä»¶ç³»ç»Ÿå…±äº«ã€‚</p><figure><img src="`+n+`" alt="image-20200302221604971" tabindex="0" loading="lazy"><figcaption>image-20200302221604971</figcaption></figure><p>ä¸Šå›¾å¾ˆå½¢è±¡äº†ï¼Œå»ºç«‹ LVM ä¼šé¢„ç•™ä¸€ä¸ªåŒºåŸŸï¼ˆå·¦å›¾çš„ä¸‰ä¸ª PE å—ï¼‰ä½œä¸ºå¿«ç…§æ•°æ®çš„å­˜æ”¾ã€‚</p><p>ç”±äºå¿«ç…§åŒºä¸åŸæœ¬çš„ LV å…±äº«å¾ˆå¤š PE åŒºå—ï¼Œå› æ­¤ <strong>å¿«ç…§åŒºä¸è¢«å¿«ç…§çš„ LV å¿…é¡»è¦åœ¨åŒä¸€ä¸ª VG ä¸Š</strong></p><p>å¦å¤–ï¼Œä¸å»ºè®®ä½¿ç”¨ thin pool æ¥åˆ¶ä½œå¿«ç…§ï¼Œé™åˆ¶å¤ªå¤šäº†ï¼›</p><p>ä¸‹é¢é’ˆå¯¹ä¼ ç»Ÿçš„ LV ç£ç›˜è¿›è¡Œå¿«ç…§çš„é…ç½®ï¼Œå¤§è‡´æµç¨‹ä¸ºï¼š</p><ul><li>é¢„è®¡è¢«æ‹¿æ¥å¤‡ä»½çš„åŸå§‹ LV ä¸º <code>/dev/vmcrcodevg/vmmrcodelv</code></li><li>ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼å¿«ç…§å»ºç«‹ï¼ŒåŸå§‹ç£ç›˜ä¸º <code>/dev/vmcrcodevg/vmmrcodelv</code>ï¼Œå¿«ç…§åç§°ä¸º vmrcodesnap1ï¼Œå®¹é‡ä¸º vmcrcodevg çš„æ‰€æœ‰å‰©ä½™å®¹é‡</li></ul><h3 id="ä¼ ç»Ÿå¿«ç…§åŒºçš„å»ºç«‹" tabindex="-1"><a class="header-anchor" href="#ä¼ ç»Ÿå¿«ç…§åŒºçš„å»ºç«‹" aria-hidden="true">#</a> ä¼ ç»Ÿå¿«ç…§åŒºçš„å»ºç«‹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è§‚å¯Ÿ VG å‰©ä½™å®¹é‡</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># vgdisplay vmcrcodevg </span>
  --- Volume group ---
  VG Name               vmcrcodevg
  System ID             
  Format                lvm2
  Metadata Areas        <span class="token number">4</span>
  Metadata Sequence No  <span class="token number">9</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">3</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">4</span>
  Act PV                <span class="token number">4</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">3.94</span> GiB
  PE Size               <span class="token number">16.00</span> MiB
  Total PE              <span class="token number">252</span>
  Alloc PE / Size       <span class="token number">226</span> / <span class="token number">3.53</span> GiB
  Free  PE / Size       <span class="token number">26</span> / <span class="token number">416.00</span> MiB			<span class="token comment"># è¿˜æœ‰ 26 ä¸ªPE</span>
  VG UUID               JQP2VZ-ilbN-MBuw-jccl-do84-tHu6-BInUXS
  
  
 <span class="token comment"># åˆ›å»ºå¿«ç…§åŒº</span>
 <span class="token comment"># æ³¨æ„ï¼š-n åé¢æ˜¯ç»™å¿«ç…§åŒºå–åï¼Œç¬”è€…è¿™é‡Œçœ‹é”™äº†ï¼Œç”¨äº† vg çš„åç§°</span>
 <span class="token comment"># æœ¬åº”è¯¥ä¸ä¹¦ä¸Šçš„ vmrcodesnap1 ä½œä¸ºå¿«ç…§åç§°çš„</span>
 <span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># lvcreate -s -l 26 -n vmcrcodevg /dev/vmcrcodevg/vmmrcodelv </span>
  WARNING: Sum of all thin volume sizes <span class="token punctuation">(</span><span class="token number">10.00</span> GiB<span class="token punctuation">)</span> exceeds the size of thin pools and the size of whole volume group <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">3.94</span> GiB<span class="token punctuation">)</span>.
  WARNING: You have not turned on protection against thin pools running out of space.
  WARNING: Set activation/thin_pool_autoextend_threshold below <span class="token number">100</span> to trigger automatic extension of thin pools before they get full.
  Logical volume <span class="token string">&quot;vmcrcodevg&quot;</span> created.
<span class="token comment"># -s è¡¨ç¤º  snapshot åŠŸèƒ½ï¼Œ -n åé¢åˆ™æ˜¯å¿«ç…§åŒºåç§°ï¼Œå†åé¢æ˜¯åœ¨å“ªä¸ª lv ä¸Šåˆ›å»ºå¿«ç…§</span>
<span class="token comment"># -l åé¢åˆ™è¡¨ç¤ºä½¿ç”¨å¤šå°‘ä¸ª PE æ¥ä½œä¸ºæ•´ä¸ªå¿«ç…§åŒºä½¿ç”¨</span>

<span class="token comment"># ä¸è¿‡è¿˜å¥½ï¼Œä½¿ç”¨äº† vg</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># lvdisplay /dev/vmcrcodevg/vmcrcodevg </span>
  --- Logical volume ---
  LV Path                /dev/vmcrcodevg/vmcrcodevg
  LV Name                vmcrcodevg
  VG Name                vmcrcodevg
  LV UUID                gprMsU-6fXb-mAhu-xehC-jksk-rj4M-0na11O
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> study.centos.mrcode, <span class="token number">2020</span>-03-02 <span class="token number">22</span>:26:19 +0800
  LV snapshot status     active destination <span class="token keyword">for</span> vmmrcodelv
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">2.50</span> GiB				<span class="token comment"># åŸå§‹ç¢Ÿ  lv çš„å®¹é‡</span>
  Current LE             <span class="token number">160</span>
  COW-table size         <span class="token number">416.00</span> MiB			<span class="token comment"># è¿™ä¸ªå¿«ç…§èƒ½å¤Ÿè®°å½•çš„æœ€å¤§å®¹é‡</span>
  COW-table LE           <span class="token number">26</span>
  Allocated to snapshot  <span class="token number">0.00</span>%					<span class="token comment"># ç›®å‰å·²è¢«ä½¿ç”¨æ‰çš„å®¹é‡</span>
  Snapshot chunk size    <span class="token number">4.00</span> KiB
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:11

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¿«ç…§åŒºè¢«å»ºç«‹èµ·æ¥äº†ï¼Œä»”ç»†çœ‹ä»–çš„ VG Name ä¸åŸæœ¬çš„ LV æ‰€åœ¨ VG ç›¸åŒã€‚</p><p>ä¸‹é¢æ¥æŒ‚è½½è¿™ä¸ªå¿«ç…§åŒºï¼ŒæŒ‚è½½ä¹‹åï¼Œä½ ä¼šå‘ç°é‡Œé¢çš„æ•°æ®ä¸åŸæ¥çš„ LV çš„æ•°æ®æ˜¯ä¸€æ ·çš„</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># mkdir /srv/snapshot1</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># mount -o nouuid /dev/vmcrcodevg/vmcrcodevg /srv/snapshot1/</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/lvm/ /srv/snapshot1/</span>
Filesystem                        Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/lvm
/dev/mapper/vmcrcodevg-vmcrcodevg xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/snapshot1

<span class="token comment"># å¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæˆ‘ä»¬éƒ½æ²¡æœ‰åŠ¨è¿‡è¯¥æ•°æ®</span>
<span class="token comment"># å¿«ç…§åŒºä¼šä¸»åŠ¨è®°å½•å‘˜ lv çš„å†…å®¹</span>
<span class="token comment"># nouui å‚æ•°ï¼šXFS ä¸å…è®¸ç›¸åŒçš„ UUID æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šè®©å®ƒå¿½ç•¥ç›¸åŒçš„ UUID æ‰€é€ æˆçš„é—®é¢˜</span>
<span class="token comment"># å› ä¸ºå¿«ç…§å‡ºæ¥çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€æ¨¡ä¸€æ ·çš„</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ©ç”¨å¿«ç…§åŒºå¤åŸç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#åˆ©ç”¨å¿«ç…§åŒºå¤åŸç³»ç»Ÿ" aria-hidden="true">#</a> åˆ©ç”¨å¿«ç…§åŒºå¤åŸç³»ç»Ÿ</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¦å¤åŸçš„æ•°æ®é‡ä¸èƒ½é«˜äºå¿«ç…§åŒºæ‰€èƒ½è´Ÿè½½çš„å®é™…å®¹é‡ã€‚å¦åˆ™å¿«ç…§åŒºè‚¯å®šè£…ä¸ä¸‹ï¼Œå°±ä¼šå¤±æ•ˆ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å¢åŠ ä¸€äº›å†…å®¹åˆ° lvm ï¼ŒæŸ¥çœ‹ä¸¤ä¸ªåŒºå—çš„å˜åŒ–</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/lvm/ /srv/snapshot1/</span>
Filesystem                        Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/lvm
/dev/mapper/vmcrcodevg-vmcrcodevg xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/snapshot1

<span class="token comment"># ç”±äºä¹‹å‰æˆ‘å¿˜è®°æ‹·è´ä¸€äº›æ•°æ®åˆ° lvm ä¸‹äº†ï¼Œçœ‹ç›®å½•ä¸‹é¢æ˜¯ç©ºçš„å†…å®¹</span>
<span class="token comment"># è¿™é‡Œç›´æ¥ copy æ•°æ®åˆ°è¯¥ç›®å½•ä¸‹</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># cp -a /etc/ /srv/lvm/</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/lvm/ /srv/snapshot1/</span>
Filesystem                        Type  Size  Used Avail Use% Mounted on
/dev/mapper/vmcrcodevg-vmmrcodelv xfs   <span class="token number">2</span>.5G   92M  <span class="token number">2</span>.5G   <span class="token number">4</span>% /srv/lvm
/dev/mapper/vmcrcodevg-vmcrcodevg xfs   <span class="token number">2</span>.5G   33M  <span class="token number">2</span>.5G   <span class="token number">2</span>% /srv/snapshot1

<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># ll /srv/lvm /srv/snapshot1/</span>
/srv/lvm:
total <span class="token number">12</span>
drwxr-xr-x. <span class="token number">143</span> root root <span class="token number">8192</span> Mar  <span class="token number">1</span> <span class="token number">17</span>:29 etc

/srv/snapshot1/:
total <span class="token number">0</span>

<span class="token comment"># ç°åœ¨ä¸¤ä¸ªç›®å½•ä¸ä¸€æ ·äº†ï¼Œæ£€æµ‹ä¸€ä¸‹å¿«ç…§ LV</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># lvdisplay /dev/vmcrcodevg/vmcrcodevg </span>
  --- Logical volume ---
  LV Path                /dev/vmcrcodevg/vmcrcodevg
  LV Name                vmcrcodevg
  VG Name                vmcrcodevg
  LV UUID                gprMsU-6fXb-mAhu-xehC-jksk-rj4M-0na11O
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> study.centos.mrcode, <span class="token number">2020</span>-03-02 <span class="token number">22</span>:26:19 +0800
  LV snapshot status     active destination <span class="token keyword">for</span> vmmrcodelv
  LV Status              available
  <span class="token comment"># open                 1</span>
  LV Size                <span class="token number">2.50</span> GiB
  Current LE             <span class="token number">160</span>
  COW-table size         <span class="token number">416.00</span> MiB
  COW-table LE           <span class="token number">26</span>
  Allocated to snapshot  <span class="token number">11.05</span>%		<span class="token comment"># ç›®å‰è¢«ä½¿ç”¨æ‰çš„å®¹é‡</span>
  Snapshot chunk size    <span class="token number">4.00</span> KiB
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:11

<span class="token comment"># 2. åˆ©ç”¨å¿«ç…§åŒºå°†åŸæœ¬çš„ filesystem å¤‡ä»½ï¼Œä½¿ç”¨ xfsdump æ¥å¤„ç†</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># xfsdump -l 0 -L lvm1 -M lvm1 -f /home/lvm.dump /srv/snapshot1 </span>
xfsdump: using <span class="token function">file</span> dump <span class="token punctuation">(</span>drive_simple<span class="token punctuation">)</span> strategy
xfsdump: version <span class="token number">3.1</span>.7 <span class="token punctuation">(</span>dump <span class="token function">format</span> <span class="token number">3.0</span><span class="token punctuation">)</span> - <span class="token builtin class-name">type</span> ^C <span class="token keyword">for</span> status and control
xfsdump: level <span class="token number">0</span> dump of study.centos.mrcode:/srv/snapshot1
xfsdump: dump date: Mon Mar  <span class="token number">2</span> <span class="token number">22</span>:48:52 <span class="token number">2020</span>
xfsdump: session id: cf94cc10-3823-4138-b016-cc7e4c3b8964
xfsdump: session label: <span class="token string">&quot;lvm1&quot;</span>
xfsdump: ino map phase <span class="token number">1</span>: constructing initial dump list
xfsdump: ino map phase <span class="token number">2</span>: skipping <span class="token punctuation">(</span>no pruning necessary<span class="token punctuation">)</span>
xfsdump: ino map phase <span class="token number">3</span>: skipping <span class="token punctuation">(</span>only one dump stream<span class="token punctuation">)</span>
xfsdump: ino map construction complete
xfsdump: estimated dump size: <span class="token number">20800</span> bytes
xfsdump: creating dump session media <span class="token function">file</span> <span class="token number">0</span> <span class="token punctuation">(</span>media <span class="token number">0</span>, <span class="token function">file</span> <span class="token number">0</span><span class="token punctuation">)</span>
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files
xfsdump: ending media <span class="token function">file</span>
xfsdump: media <span class="token function">file</span> size <span class="token number">21016</span> bytes
xfsdump: dump size <span class="token punctuation">(</span>non-dir files<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">0</span> bytes
xfsdump: dump complete: <span class="token number">0</span> seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream <span class="token number">0</span> /home/lvm.dump OK <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
xfsdump: Dump Status: SUCCESS

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºä»€ä¹ˆè¦å¤‡ä»½ï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥æ ¼å¼åŒ–ï¼Ÿå‰é¢è¯´åˆ°è¿‡ï¼Œå¿«ç…§åªä¼šå­˜å‚¨å˜åŒ–çš„æ•°æ®ï¼Œå¦‚æœæ ¼å¼åŒ–ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°æ®éƒ½ä¼šå­˜åˆ°å¿«ç…§åŒºçš„ã€‚å¿«ç…§åŒºé‚£ä¹ˆå°ï¼Œä¸€èˆ¬éƒ½ä¸å¤Ÿå­˜å‚¨çš„</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 3. å°† /srv/snapshot1 å¸è½½å¹¶ç§»é™¤ï¼ˆå› ä¸ºé‡Œé¢çš„å†…å®¹ä»¥åŠå¤‡ä»½èµ·æ¥äº†ï¼‰</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># umount /srv/snapshot1/</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># lvremove /dev/vmcrcodevg/vmcrcodevg </span>
Do you really want to remove active logical volume vmcrcodevg/vmcrcodevg? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">&quot;vmcrcodevg&quot;</span> successfully removed
<span class="token comment"># æŠŠå¿«ç…§åŠŸèƒ½å¸é™¤ä¹‹åï¼ŒæŠŠåŸå§‹ç›˜æ ¼å¼åŒ–</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs -f /dev/vmcrcodevg/vmmrcodelv </span>
meta-data<span class="token operator">=</span>/dev/vmcrcodevg/vmmrcodelv <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">163840</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">655360</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># é‡æ–°æŒ‚è½½ï¼Œç›¸å½“äºå·²ç»æ²¡æœ‰æ•°æ®äº†ï¼Œ</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># mount /dev/vmcrcodevg/vmmrcodelv /srv/lvm/</span>
<span class="token comment"># è¿™é‡Œä»å¤‡ä»½çš„å¿«ç…§é‡Œé¢æŠŠæ•°æ®æ¢å¤å›å»</span>
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># xfsrestore -f /home/lvm.dump -L lvm1 /srv/lvm/</span>
xfsrestore: using <span class="token function">file</span> dump <span class="token punctuation">(</span>drive_simple<span class="token punctuation">)</span> strategy
xfsrestore: version <span class="token number">3.1</span>.7 <span class="token punctuation">(</span>dump <span class="token function">format</span> <span class="token number">3.0</span><span class="token punctuation">)</span> - <span class="token builtin class-name">type</span> ^C <span class="token keyword">for</span> status and control
xfsrestore: using online session inventory
xfsrestore: searching media <span class="token keyword">for</span> directory dump
xfsrestore: examining media <span class="token function">file</span> <span class="token number">0</span>
xfsrestore: reading directories
xfsrestore: <span class="token number">1</span> directories and <span class="token number">0</span> entries processed
xfsrestore: directory post-processing
xfsrestore: restore complete: <span class="token number">0</span> seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream <span class="token number">0</span> /home/lvm.dump OK <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
xfsrestore: Restore Status: SUCCESS
<span class="token punctuation">[</span>root@study vmcrcodevg<span class="token punctuation">]</span><span class="token comment"># ll /srv/lvm</span>
total <span class="token number">0</span>

<span class="token comment"># è¿™é‡Œå˜æˆäº† 0ï¼Œä»è¿™é‡Œæˆ‘å¤§æ¦‚æ˜ç™½äº†è¿™ä¸ªå¿«ç…§çš„æµç¨‹äº†</span>
<span class="token comment"># 1. åˆ›å»ºå¿«ç…§çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯æŠŠå½“æ—¶é‚£ä¸€åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°äº†å¿«ç…§åŒºï¼Œç”±äºå®é™…æ•°æ®å°äºå¿«ç…§åŒºï¼Œæ‰€ä»¥å¯ä»¥æ”¾ä¸‹</span>
<span class="token comment"># 2. å¯¹åŸå§‹ç›˜ä¿®æ”¹çš„æ—¶å€™ï¼Œåªè¦ä¸åˆ›å»ºå¿«ç…§ï¼Œæ•°æ®å°±ä¸ä¼šè¢«åŒæ­¥è¿‡å»</span>
<span class="token comment"># 3. è¿™é‡Œå¤‡ä»½å¿«ç…§åŒºï¼Œå†ä»å¿«ç…§åŒºæ¢å¤åˆ›å»ºå¿«ç…§æ—¶çš„æ•°æ®</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ©ç”¨å¿«ç…§åŒºè¿›è¡Œå„é¡¹ç»ƒä¹ ä¸æµ‹è¯•çš„ä»»åŠ¡ï¼Œå†ä»¥åŸç³»ç»Ÿè¿˜åŸå¿«ç…§ï¼šå¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼Œå°†åŸå§‹æ•°æ®å½“æˆå¤‡ä»½ï¼Œå¿«ç…§å‡ºæ¥çš„å¿«ç…§åŒºè¿›è¡Œæµ‹è¯•ï¼ˆå½“æˆçœŸæ­£çš„ç›®å½•ä¸€æ ·ä½¿ç”¨ï¼‰ï¼Œè¦è¿˜åŸçš„æ—¶å€™å°±ç›´æ¥åˆ æ‰å¿«ç…§åŒºï¼Œå†åˆ›å»ºä¸€ä¸ªå¿«ç…§å³å¯ã€‚</p><p>è¿™é‡Œçš„æ€è·¯å’Œæˆ‘ä¸Šé¢è‡ªå·±ç†è§£çš„è²Œä¼¼ç±»ä¼¼ï¼Œä½†æ˜¯ä¸‹é¢è¿™å¼ å›¾è²Œä¼¼å°±è¯´ä¸é€šäº†</p><figure><img src="`+n+`" alt="image-20200302221604971" tabindex="0" loading="lazy"><figcaption>image-20200302221604971</figcaption></figure><p>å› ä¸ºä¸Šé¢æˆ‘ä»¬å¿«ç…§äº†æ•°æ®ï¼Œä¼šå‘ç°å¿«ç…§å’ŒåŸå§‹æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œåœ¨ä¿®æ”¹åŸå§‹æ•°æ®åï¼Œå¿«ç…§åŒºæ•°æ®å¹¶è¯¶å‘¦å˜åŒ–ï¼Œç„¶åæˆ‘ä»¬å¤‡ä»½äº†å¿«ç…§åŒºçš„æ•°æ®ï¼Œå¹¶åˆ é™¤äº†å¿«ç…§åŒºï¼›ç„¶åå†æ ¼å¼åŒ–äº†åŸå§‹ç¢Ÿï¼Œé‚£ä¹ˆè¿™é‡Œå…¬ç”¨çš„ PE æ˜¯ä¸æ˜¯è²Œä¼¼å°±è¯´ä¸é€šäº†? æˆ–åˆ™æ¢ä¸ªè¯´æ³•æ¥è¯´ï¼Œå¿«ç…§åŒºå¤‡ä»½å®é™…ä¸Šæ˜¯æŠŠåˆ›å»ºå¿«ç…§é‚£ä¸€åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å¤‡ä»½äº†ï¼ˆå°±æ˜¯è¯´æ˜¯æ‰€æœ‰çš„åŸå§‹æ•°æ®ï¼Œå› ä¸ºåœ¨åˆ›å»ºå¿«ç…§å“ªä¸€ä¸ªç‚¹çš„æ‰€æœ‰æ•°æ®ï¼‰ï¼Œä½†å…¶å®å¦‚æœä¸ç”¨å¤‡ä»½çš„è¯ï¼Œæ˜¯æ²¡æ³•æ¢å¤å¿«ç…§çš„ï¼Œå› ä¸ºè¿™é‡Œå…¬ç”¨äº† PE çš„é—®é¢˜ï¼›å¿«ç…§ä¼šåŒºåˆ†å˜åŒ–çš„æ–‡ä»¶ï¼Œå¤‡ä»½çš„æ—¶å€™å›æ’é™¤æ‰å˜åŒ–çš„æ–‡ä»¶ã€‚</p><p>ä¸Šé¢çš„è§£é‡Šè²Œä¼¼å¯ä»¥é€šäº†</p><h2 id="ğŸ€-lvm-ç›¸å…³æŒ‡ä»¤æ±‡æ€»ä¸-lvm-çš„å…³é—­" tabindex="-1"><a class="header-anchor" href="#ğŸ€-lvm-ç›¸å…³æŒ‡ä»¤æ±‡æ€»ä¸-lvm-çš„å…³é—­" aria-hidden="true">#</a> ğŸ€ LVM ç›¸å…³æŒ‡ä»¤æ±‡æ€»ä¸ LVM çš„å…³é—­</h2><table><thead><tr><th style="text-align:center;">ä»»åŠ¡</th><th style="text-align:center;">PV é˜¶æ®µ</th><th style="text-align:center;">VG é˜¶æ®µ</th><th style="text-align:center;">LV é˜¶æ®µ</th><th style="text-align:center;">filesystem-xfs</th><th style="text-align:center;">filesystem-ext4</th></tr></thead><tbody><tr><td style="text-align:center;">æœç´¢<code>scan</code></td><td style="text-align:center;">pvscan</td><td style="text-align:center;">vgscan</td><td style="text-align:center;">lvscan</td><td style="text-align:center;">lsblkã€blkid</td><td style="text-align:center;">lsblkã€blkid</td></tr><tr><td style="text-align:center;">åˆ›å»º<code>create</code></td><td style="text-align:center;">pvcreate</td><td style="text-align:center;">vgcreate</td><td style="text-align:center;">lvcreate</td><td style="text-align:center;">mkfs.xfs</td><td style="text-align:center;">mkfs.ext4</td></tr><tr><td style="text-align:center;">åˆ—å‡º<code>display</code></td><td style="text-align:center;">pvdisplay</td><td style="text-align:center;">vgdisplay</td><td style="text-align:center;">lvdisplay</td><td style="text-align:center;">dfã€mount</td><td style="text-align:center;">dfã€mount</td></tr><tr><td style="text-align:center;">å¢åŠ <code>extend</code></td><td style="text-align:center;"></td><td style="text-align:center;">vgextend</td><td style="text-align:center;">lvextend(lvresize)</td><td style="text-align:center;">xfs_growfs</td><td style="text-align:center;">resize2fs</td></tr><tr><td style="text-align:center;">å‡å°‘<code>reduce</code></td><td style="text-align:center;"></td><td style="text-align:center;">vgreduce</td><td style="text-align:center;">lvreduce(lvresize)</td><td style="text-align:center;">ä¸æ”¯æŒ</td><td style="text-align:center;">resize2fs</td></tr><tr><td style="text-align:center;">åˆ é™¤<code>remove</code></td><td style="text-align:center;">pvremove</td><td style="text-align:center;">vgremove</td><td style="text-align:center;">lvremove</td><td style="text-align:center;">umountã€é‡æ–°æ ¼å¼åŒ–</td><td style="text-align:center;">umountã€é‡æ–°æ ¼å¼åŒ–</td></tr><tr><td style="text-align:center;">æ”¹å˜å®¹é‡<code>resize</code></td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">lvresize</td><td style="text-align:center;">xfs_grows</td><td style="text-align:center;">resize2fs</td></tr><tr><td style="text-align:center;">æ”¹å˜å±æ€§<code>attribute</code></td><td style="text-align:center;">pvchange</td><td style="text-align:center;">vgchange</td><td style="text-align:center;">lvchange</td><td style="text-align:center;">/etc/fstabã€remount</td><td style="text-align:center;">/etc/fstabã€remount</td></tr></tbody></table><p>æ–‡ä»¶ç³»ç»Ÿé˜¶æ®µçš„æ ¼å¼åŒ–å¤„ç†ï¼Œéœ€è¦ä»¥ xfs_growfs æ¥ä¿®æ­£æ–‡ä»¶ç³»ç»Ÿå®é™…çš„å¤§å°ã€‚</p><p>ä¼šè§„åˆ’ LVM è¿˜ä¸è¡Œï¼Œè¿˜éœ€è¦ä¼šç§»é™¤ LVMï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å…ˆå¸è½½ç³»ç»Ÿä¸Šé¢çš„ LVM æ–‡ä»¶ç³»ç»Ÿï¼ˆåŒ…æ‹¬å¿«ç…§ä¸æ‰€æœ‰ LVï¼‰</li><li>ä½¿ç”¨ lvremove ç§»é™¤ LV</li><li>ä½¿ç”¨ <code>vgchange -a n VGname</code> è®© VGname è¿™ä¸ª VG ä¸å…·æœ‰ Active æ ‡å¿—</li><li>ä½¿ç”¨ vgremove ç§»é™¤ VG</li><li>ä½¿ç”¨ pvremove ç§»é™¤ PV</li><li>ä½¿ç”¨ fsidk ä¿®æ”¹ IDï¼Œæ”¹å›æ¥</li></ol><p>ä¸‹é¢è¿›è¡Œå¸è½½ç»ƒä¹ </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># umount /srv/lvm/ /srv/thin/ /srv/snapshot1/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvs vmcrcodevg</span>
  LV            VG         Attr       LSize  Pool         Origin Data%  Meta%  Move Log Cpy%Sync Convert
  vmmrcodelv    vmcrcodevg -wi-a-----  <span class="token number">2</span>.50g                                                            
  vmrcodetpool  vmcrcodevg twi-aotz--  <span class="token number">1</span>.00g                     <span class="token number">49.92</span>  <span class="token number">11.82</span>                           
  vmrcrodethin1 vmcrcodevg Vwi-a-tz-- <span class="token number">10</span>.00g vmrcodetpool        <span class="token number">4.99</span> 
  
<span class="token comment"># æ³¨æ„ï¼Œåˆ é™¤é¡ºåºæ˜¯ï¼švmrcrodethin1 &gt; vmrcrodethin1 &gt; vmmrcodelv</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvremove /dev/vmcrcodevg/vmrcrodethin1  /dev/vmcrcodevg/vmrcodetpool </span>
Removing pool <span class="token string">&quot;vmrcodetpool&quot;</span> will remove <span class="token number">1</span> dependent volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span>. Proceed? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
Do you really want to remove active logical volume vmcrcodevg/vmrcrodethin1? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">&quot;vmrcrodethin1&quot;</span> successfully removed
Do you really want to remove active logical volume vmcrcodevg/vmrcodetpool? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">&quot;vmrcodetpool&quot;</span> successfully removed
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lvremove /dev/vmcrcodevg/vmmrcodelv </span>
Do you really want to remove active logical volume vmcrcodevg/vmmrcodelv? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">&quot;vmmrcodelv&quot;</span> successfully removed
  
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgchange -a n vmcrcodevg </span>
  <span class="token number">0</span> logical volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> volume group <span class="token string">&quot;vmcrcodevg&quot;</span> now active
  
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vgremove vmcrcodevg </span>
  Volume group <span class="token string">&quot;vmcrcodevg&quot;</span> successfully removed

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åå†ä½¿ç”¨ gdisk å°†ç£ç›˜çš„ ID ç»™æ”¹å›æ¥ 83 å°±å¯ä»¥äº†</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gdisk /dev/sda
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p
Number  Start <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>    End <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>  Size       Code  Name
   <span class="token number">1</span>            <span class="token number">2048</span>            <span class="token number">6143</span>   <span class="token number">2.0</span> MiB     EF02  
   <span class="token number">2</span>            <span class="token number">6144</span>         <span class="token number">2103295</span>   <span class="token number">1024.0</span> MiB  0700  
   <span class="token number">3</span>         <span class="token number">2103296</span>        <span class="token number">65026047</span>   <span class="token number">30.0</span> GiB    8E00  
   <span class="token number">4</span>        <span class="token number">65026048</span>        <span class="token number">67123199</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">5</span>        <span class="token number">67123200</span>        <span class="token number">69220351</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">6</span>        <span class="token number">69220352</span>        <span class="token number">71317503</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">7</span>        <span class="token number">71317504</span>        <span class="token number">73414655</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
   <span class="token number">8</span>        <span class="token number">73414656</span>        <span class="token number">75511807</span>   <span class="token number">1024.0</span> MiB  8E00  Linux LVM
<span class="token comment"># ä¿®æ”¹ ID ä¹Ÿå°±æ˜¯è¿™é‡Œçš„ Codeï¼Œå¯ä»¥çœ‹åˆ°è¿™å‡ ä¸ªåˆ†åŒºè¿˜æ˜¯ 8E00</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,57);function b(g,f){const e=l("RouterLink");return p(),o("div",null,[m,i("p",null,[s("è¿™é‡Œéœ€è¦å‡†å¤‡æŠŠä¹‹å‰çš„ 5 ä¸ªåˆ†åŒºåˆ æ‰ï¼Œé‡æ–°æ ¼å¼åŒ–å‡ºæ¥ï¼›æœ‰å…³åˆ†åŒºç›¸å…³æ“ä½œè¯·å‚è€ƒ"),c(e,{to:"/99-tools/Linux/07/03/"},{default:r(()=>[s("ç¬¬ 7 ç« çš„ç¡¬ç›˜åˆ†åŒºã€æ ¼å¼åŒ–ç« èŠ‚")]),_:1})]),k])}const y=t(u,[["render",b],["__file","03.html.vue"]]);export{y as default};
