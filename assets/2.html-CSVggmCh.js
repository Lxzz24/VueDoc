import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as i,a as n,b as a,w as t,d as l,e}from"./app-CvlAI_tu.js";const u="/VueDoc/assets/image-20231220171947674-CG9MOUPB.png",k="/VueDoc/assets/l-20231220171655657-BL2qO-aa.jpeg",r="/VueDoc/assets/image-20231220172005588-DojMW4oV.png",d="/VueDoc/assets/l-20231220171655613-U-XJDgIo.jpeg",v={},m={class:"hint-container details"},g=n("summary",null,"ç›®å½•",-1),b={class:"table-of-contents"},S=l(`<p>åœ¨ Web åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è¦è·Ÿè¸ªç”¨æˆ·èº«ä»½ã€‚å½“ä¸€ä¸ªç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå¦‚æœä»–ç»§ç»­è®¿é—®å…¶ä»–é¡µé¢ï¼ŒWeb ç¨‹åºå¦‚ä½•æ‰èƒ½è¯†åˆ«å‡ºè¯¥ç”¨æˆ·èº«ä»½ï¼Ÿ</p><p>å› ä¸º HTTP åè®®æ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œå³ Web åº”ç”¨ç¨‹åºæ— æ³•åŒºåˆ†æ”¶åˆ°çš„ä¸¤ä¸ª HTTP è¯·æ±‚æ˜¯å¦æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºçš„ã€‚ä¸ºäº†è·Ÿè¸ªç”¨æˆ·çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘æµè§ˆå™¨åˆ†é…ä¸€ä¸ªå”¯ä¸€ IDï¼Œå¹¶ä»¥ Cookie çš„å½¢å¼å‘é€åˆ°æµè§ˆå™¨ï¼Œæµè§ˆå™¨åœ¨åç»­è®¿é—®æ—¶æ€»æ˜¯é™„å¸¦æ­¤ Cookieï¼Œè¿™æ ·ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è¯†åˆ«ç”¨æˆ·èº«ä»½ã€‚</p><h2 id="ğŸ€-session" tabindex="-1"><a class="header-anchor" href="#ğŸ€-session" aria-hidden="true">#</a> ğŸ€ Session</h2><p>æˆ‘ä»¬æŠŠè¿™ç§åŸºäºå”¯ä¸€ ID è¯†åˆ«ç”¨æˆ·èº«ä»½çš„æœºåˆ¶ç§°ä¸º Sessionã€‚æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨åï¼Œä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª Session IDã€‚å¦‚æœç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆ Session ä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œä¸‹æ¬¡å³ä½¿å¸¦ç€ä¸Šæ¬¡åˆ†é…çš„ Session ID è®¿é—®ï¼ŒæœåŠ¡å™¨ä¹Ÿè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œä¼šåˆ†é…æ–°çš„ Session IDã€‚</p><p>JavaEE çš„ Servlet æœºåˆ¶å†…å»ºäº†å¯¹ Session çš„æ”¯æŒã€‚æˆ‘ä»¬ä»¥ç™»å½•ä¸ºä¾‹ï¼Œå½“ä¸€ä¸ªç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªç”¨æˆ·çš„åå­—æ”¾å…¥ä¸€ä¸ª <code>HttpSession</code> å¯¹è±¡ï¼Œä»¥ä¾¿åç»­è®¿é—®å…¶ä»–é¡µé¢çš„æ—¶å€™ï¼Œèƒ½ç›´æ¥ä» <code>HttpSession</code> å–å‡ºç”¨æˆ·åï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">&quot;/signin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SignInServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¨¡æ‹Ÿä¸€ä¸ªæ•°æ®åº“:</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tomcat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// GET è¯·æ±‚æ—¶æ˜¾ç¤ºç™»å½•é¡µ:</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;Sign In&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;form action=\\&quot;/signin\\&quot;method=\\&quot;post\\&quot;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;Username: &lt;input name=\\&quot;username\\&quot;&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;Password: &lt;input name=\\&quot;password\\&quot;type=\\&quot;password\\&quot;&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;&lt;button type=\\&quot;submit\\&quot;&gt;Sign In&lt;/button&gt; &lt;a href=\\&quot;/\\&quot;&gt;Cancel&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/form&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// POST è¯·æ±‚æ—¶å¤„ç†ç”¨æˆ·ç™»å½•:</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> expectedPassword <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>expectedPassword <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> expectedPassword<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ç™»å½•æˆåŠŸ:</span>
            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            resp<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿° <code>SignInServlet</code> åœ¨åˆ¤æ–­ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç«‹åˆ»å°†ç”¨æˆ·åæ”¾å…¥å½“å‰ <code>HttpSession</code> ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>IndexServlet</code> ä¸­ï¼Œå¯ä»¥ä» <code>HttpSession</code> å–å‡ºç”¨æˆ·åï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä» HttpSession è·å–å½“å‰ç”¨æˆ·å:</span>
        <span class="token class-name">String</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Powered-By&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JavaEE Servlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;Welcome,&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> user <span class="token operator">:</span> <span class="token string">&quot;Guest&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é“¾æ¥:</span>
            pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;&lt;a href=\\&quot;/signin\\&quot;&gt;Sign In&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å·²ç™»å½•ï¼Œæ˜¾ç¤ºç™»å‡ºé“¾æ¥:</span>
            pw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;&lt;a href=\\&quot;/signout\\&quot;&gt;Sign Out&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œå¯ä»¥é€šè¿‡è®¿é—® <code>/signout</code> ç™»å‡ºã€‚ç™»å‡ºé€»è¾‘å°±æ˜¯ä» <code>HttpSession</code> ä¸­ç§»é™¤ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">&quot;/signout&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SignOutServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä» HttpSession ç§»é™¤ç”¨æˆ·å:</span>
        req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äº Web åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯é€šè¿‡ <code>HttpSession</code> è¿™ä¸ªé«˜çº§æ¥å£è®¿é—®å½“å‰ Sessionã€‚å¦‚æœè¦æ·±å…¥ç†è§£ Session åŸç†ï¼Œå¯ä»¥è®¤ä¸º Web æœåŠ¡å™¨åœ¨å†…å­˜ä¸­è‡ªåŠ¨ç»´æŠ¤äº†ä¸€ä¸ª ID åˆ° <code>HttpSession</code> çš„æ˜ å°„è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p><figure><img src="`+u+'" alt="image-20231220171947674" tabindex="0" loading="lazy"><figcaption>image-20231220171947674</figcaption></figure><p>è€ŒæœåŠ¡å™¨è¯†åˆ« Session çš„å…³é”®å°±æ˜¯ä¾é ä¸€ä¸ªåä¸º <code>JSESSIONID</code> çš„ Cookieã€‚åœ¨ Servlet ä¸­ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>req.getSession()</code> æ—¶ï¼ŒServlet å®¹å™¨è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session IDï¼Œç„¶åé€šè¿‡ä¸€ä¸ªåä¸º <code>JSESSIONID</code> çš„ Cookie å‘é€ç»™æµè§ˆå™¨ï¼š</p><figure><img src="'+k+`" alt="session" tabindex="0" loading="lazy"><figcaption>session</figcaption></figure><p>è¿™é‡Œè¦æ³¨æ„çš„å‡ ç‚¹æ˜¯ï¼š</p><ul><li><code>JSESSIONID</code> æ˜¯ç”± Servlet å®¹å™¨è‡ªåŠ¨åˆ›å»ºçš„ï¼Œç›®çš„æ˜¯ç»´æŠ¤ä¸€ä¸ªæµè§ˆå™¨ä¼šè¯ï¼Œå®ƒå’Œæˆ‘ä»¬çš„ç™»å½•é€»è¾‘æ²¡æœ‰å…³ç³»ï¼›</li><li>ç™»å½•å’Œç™»å‡ºçš„ä¸šåŠ¡é€»è¾‘æ˜¯æˆ‘ä»¬è‡ªå·±æ ¹æ® <code>HttpSession</code> æ˜¯å¦å­˜åœ¨ä¸€ä¸ª <code>&quot;user&quot;</code> çš„ Key åˆ¤æ–­çš„ï¼Œç™»å‡ºåï¼ŒSession ID å¹¶ä¸ä¼šæ”¹å˜ï¼›</li><li>å³ä½¿æ²¡æœ‰ç™»å½•åŠŸèƒ½ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ <code>HttpSession</code> è¿½è¸ªç”¨æˆ·ï¼Œä¾‹å¦‚ï¼Œæ”¾å…¥ä¸€äº›ç”¨æˆ·é…ç½®ä¿¡æ¯ç­‰ã€‚</li></ul><p>é™¤äº†ä½¿ç”¨ Cookie æœºåˆ¶å¯ä»¥å®ç° Session å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡éšè—è¡¨å•ã€URL æœ«å°¾é™„åŠ  ID æ¥è¿½è¸ª Sessionã€‚è¿™äº›æœºåˆ¶å¾ˆå°‘ä½¿ç”¨ï¼Œæœ€å¸¸ç”¨çš„ Session æœºåˆ¶ä»ç„¶æ˜¯ Cookieã€‚</p><p>ä½¿ç”¨ Session æ—¶ï¼Œç”±äºæœåŠ¡å™¨æŠŠæ‰€æœ‰ç”¨æˆ·çš„ Session éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœé‡åˆ°å†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œå°±éœ€è¦æŠŠéƒ¨åˆ†ä¸æ´»åŠ¨çš„ Session åºåˆ—åŒ–åˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¼šå¤§å¤§é™ä½æœåŠ¡å™¨çš„è¿è¡Œæ•ˆç‡ï¼Œå› æ­¤ï¼Œæ”¾å…¥ Session çš„å¯¹è±¡è¦å°ï¼Œé€šå¸¸æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªç®€å•çš„ <code>User</code> å¯¹è±¡å°±è¶³å¤Ÿäº†ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span> <span class="token comment">// å”¯ä¸€æ ‡è¯†</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨å¤šå°æœåŠ¡å™¨æ„æˆé›†ç¾¤æ—¶ï¼Œä½¿ç”¨ Session ä¼šé‡åˆ°ä¸€äº›é¢å¤–çš„é—®é¢˜ã€‚é€šå¸¸ï¼Œå¤šå°æœåŠ¡å™¨é›†ç¾¤ä½¿ç”¨åå‘ä»£ç†ä½œä¸ºç½‘ç«™å…¥å£ï¼š</p><figure><img src="`+r+`" alt="image-20231220172005588" tabindex="0" loading="lazy"><figcaption>image-20231220172005588</figcaption></figure><p>å¦‚æœå¤šå° Web Server é‡‡ç”¨æ— çŠ¶æ€é›†ç¾¤ï¼Œé‚£ä¹ˆåå‘ä»£ç†æ€»æ˜¯ä»¥è½®è¯¢æ–¹å¼å°†è¯·æ±‚ä¾æ¬¡è½¬å‘ç»™æ¯å° Web Serverï¼Œè¿™ä¼šé€ æˆä¸€ä¸ªç”¨æˆ·åœ¨ Web Server 1 å­˜å‚¨çš„ Session ä¿¡æ¯ï¼Œåœ¨ Web Server 2 å’Œ 3 ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œå³ä» Web Server 1 ç™»å½•åï¼Œå¦‚æœåç»­è¯·æ±‚è¢«è½¬å‘åˆ° Web Server 2 æˆ– 3ï¼Œé‚£ä¹ˆç”¨æˆ·çœ‹åˆ°çš„ä»ç„¶æ˜¯æœªç™»å½•çŠ¶æ€ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ–¹æ¡ˆä¸€æ˜¯åœ¨æ‰€æœ‰ Web Server ä¹‹é—´è¿›è¡Œ Session å¤åˆ¶ï¼Œä½†è¿™æ ·ä¼šä¸¥é‡æ¶ˆè€—ç½‘ç»œå¸¦å®½ï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ª Web Server çš„å†…å­˜å‡å­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„ Sessionï¼Œå†…å­˜ä½¿ç”¨ç‡å¾ˆä½ã€‚</p><p>å¦ä¸€ä¸ªæ–¹æ¡ˆæ˜¯é‡‡ç”¨ç²˜æ»ä¼šè¯ï¼ˆSticky Sessionï¼‰æœºåˆ¶ï¼Œå³åå‘ä»£ç†åœ¨è½¬å‘è¯·æ±‚çš„æ—¶å€™ï¼Œæ€»æ˜¯æ ¹æ® JSESSIONID çš„å€¼åˆ¤æ–­ï¼Œç›¸åŒçš„ JSESSIONID æ€»æ˜¯è½¬å‘åˆ°å›ºå®šçš„ Web Serverï¼Œä½†è¿™éœ€è¦åå‘ä»£ç†çš„æ”¯æŒã€‚</p><p>æ— è®ºé‡‡ç”¨ä½•ç§æ–¹æ¡ˆï¼Œä½¿ç”¨ Session æœºåˆ¶ï¼Œä¼šä½¿å¾— Web Server çš„é›†ç¾¤å¾ˆéš¾æ‰©å±•ï¼Œå› æ­¤ï¼ŒSession é€‚ç”¨äºä¸­å°å‹ Web åº”ç”¨ç¨‹åºã€‚å¯¹äºå¤§å‹ Web åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé€šå¸¸éœ€è¦é¿å…ä½¿ç”¨ Session æœºåˆ¶ã€‚</p><h2 id="ğŸ€-cookie" tabindex="-1"><a class="header-anchor" href="#ğŸ€-cookie" aria-hidden="true">#</a> ğŸ€ Cookie</h2><p>å®é™…ä¸Šï¼ŒServlet æä¾›çš„ <code>HttpSession</code> æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º <code>JSESSIONID</code> çš„ Cookie æ¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„ã€‚é™¤äº†è¿™ä¸ªåç§°å¤–ï¼Œå…¶ä»–åç§°çš„ Cookie æˆ‘ä»¬å¯ä»¥ä»»æ„ä½¿ç”¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸€ä¸ª Cookieï¼Œä¾‹å¦‚ï¼Œè®°å½•ç”¨æˆ·é€‰æ‹©çš„è¯­è¨€ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ª <code>LanguageServlet</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">&quot;/pref&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LanguageServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">LANGUAGES</span> <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> lang <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;lang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LANGUAGES</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Cookie:</span>
            <span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;lang&quot;</span><span class="token punctuation">,</span> lang<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¯¥ Cookie ç”Ÿæ•ˆçš„è·¯å¾„èŒƒå›´:</span>
            cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¯¥ Cookie æœ‰æ•ˆæœŸ:</span>
            cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">8640000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8640000 ç§’ = 100 å¤©</span>
            <span class="token comment">// å°†è¯¥ Cookie æ·»åŠ åˆ°å“åº”:</span>
            resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºä¸€ä¸ªæ–° Cookie æ—¶ï¼Œé™¤äº†æŒ‡å®šåç§°å’Œå€¼ä»¥å¤–ï¼Œé€šå¸¸éœ€è¦è®¾ç½® <code>setPath(&quot;/&quot;)</code>ï¼Œæµè§ˆå™¨æ ¹æ®æ­¤å‰ç¼€å†³å®šæ˜¯å¦å‘é€ Cookieã€‚å¦‚æœä¸€ä¸ª Cookie è°ƒç”¨äº† <code>setPath(&quot;/user/&quot;)</code>ï¼Œé‚£ä¹ˆæµè§ˆå™¨åªæœ‰åœ¨è¯·æ±‚ä»¥ <code>/user/</code> å¼€å¤´çš„è·¯å¾„æ—¶æ‰ä¼šé™„åŠ æ­¤ Cookieã€‚é€šè¿‡ <code>setMaxAge()</code> è®¾ç½® Cookie çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ï¼Œæœ€åé€šè¿‡ <code>resp.addCookie()</code> æŠŠå®ƒæ·»åŠ åˆ°å“åº”ã€‚</p><p>å¦‚æœè®¿é—®çš„æ˜¯ https ç½‘é¡µï¼Œè¿˜éœ€è¦è°ƒç”¨ <code>setSecure(true)</code>ï¼Œå¦åˆ™æµè§ˆå™¨ä¸ä¼šå‘é€è¯¥ Cookieã€‚</p><p>å› æ­¤ï¼ŒåŠ¡å¿…æ³¨æ„ï¼šæµè§ˆå™¨åœ¨è¯·æ±‚æŸä¸ª URL æ—¶ï¼Œæ˜¯å¦æºå¸¦æŒ‡å®šçš„ Cookieï¼Œå–å†³äº Cookie æ˜¯å¦æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰è¦æ±‚ï¼š</p><ul><li>URL å‰ç¼€æ˜¯è®¾ç½® Cookie æ—¶çš„ Pathï¼›</li><li>Cookie åœ¨æœ‰æ•ˆæœŸå†…ï¼›</li><li>Cookie è®¾ç½®äº† secure æ—¶å¿…é¡»ä»¥ https è®¿é—®ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ°æœåŠ¡å™¨å‘é€çš„ Cookieï¼š</p><figure><img src="`+d+`" alt="cookie" tabindex="0" loading="lazy"><figcaption>cookie</figcaption></figure><p>å¦‚æœæˆ‘ä»¬è¦è¯»å– Cookieï¼Œä¾‹å¦‚ï¼Œåœ¨ <code>IndexServlet</code> ä¸­ï¼Œè¯»å–åä¸º <code>lang</code> çš„ Cookie ä»¥è·å–ç”¨æˆ·è®¾ç½®çš„è¯­è¨€ï¼Œå¯ä»¥å†™ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">parseLanguageFromCookie</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–è¯·æ±‚é™„å¸¦çš„æ‰€æœ‰ Cookie:</span>
    <span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœè·å–åˆ° Cookie:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¾ªç¯æ¯ä¸ª Cookie:</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœ Cookie åç§°ä¸º lang:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;lang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å› Cookie çš„å€¼:</span>
                <span class="token keyword">return</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è¿”å›é»˜è®¤å€¼:</span>
    <span class="token keyword">return</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œè¯»å– Cookie ä¸»è¦ä¾é éå† <code>HttpServletRequest</code> é™„å¸¦çš„æ‰€æœ‰ Cookieã€‚</p><h2 id="ğŸ€-ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#ğŸ€-ç»ƒä¹ " aria-hidden="true">#</a> ğŸ€ ç»ƒä¹ </h2><h2 id="ğŸ€-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å°ç»“" aria-hidden="true">#</a> ğŸ€ å°ç»“</h2><p>Servlet å®¹å™¨æä¾›äº† Session æœºåˆ¶ä»¥è·Ÿè¸ªç”¨æˆ·ï¼›</p><p>é»˜è®¤çš„ Session æœºåˆ¶æ˜¯ä»¥ Cookie å½¢å¼å®ç°çš„ï¼ŒCookie åç§°ä¸º <code>JSESSIONID</code>ï¼›</p><p>é€šè¿‡è¯»å†™ Cookie å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¾ç½®ç”¨æˆ·åå¥½ç­‰ã€‚</p>`,45);function q(f,w){const s=o("router-link");return c(),i("div",null,[n("details",m,[g,n("nav",b,[n("ul",null,[n("li",null,[a(s,{to:"#ğŸ€-session"},{default:t(()=>[e("ğŸ€ Session")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-cookie"},{default:t(()=>[e("ğŸ€ Cookie")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-ç»ƒä¹ "},{default:t(()=>[e("ğŸ€ ç»ƒä¹ ")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-å°ç»“"},{default:t(()=>[e("ğŸ€ å°ç»“")]),_:1})])])])]),S])}const C=p(v,[["render",q],["__file","2.html.vue"]]);export{C as default};
