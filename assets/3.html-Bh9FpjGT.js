import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as l,o as u,c as d,a as s,b as a,w as e,e as n,d as p}from"./app-CvlAI_tu.js";const r="/VueDoc/assets/0-jYkB8wOE.gif",k={},v={class:"hint-container details"},m=s("summary",null,"ç›®å½•",-1),b={class:"table-of-contents"},g=p('<ul><li><a href="#%E4%BD%BF%E7%94%A8-JDBC">â˜˜ï¸ ä½¿ç”¨ JDBC</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1">â˜˜ï¸ ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡</a></li><li><a href="#%E4%BD%BF%E7%94%A8-DAO">â˜˜ï¸ ä½¿ç”¨ DAO</a></li><li><a href="#%E9%9B%86%E6%88%90-Hibernate">â˜˜ï¸ é›†æˆ Hibernate</a></li><li><a href="#%E9%9B%86%E6%88%90-JPA">â˜˜ï¸ é›†æˆ JPA</a></li><li><a href="#%E9%9B%86%E6%88%90-MyBatis">â˜˜ï¸ é›†æˆ MyBatis</a></li><li><a href="#%E8%AE%BE%E8%AE%A1-ORM">â˜˜ï¸ è®¾è®¡ ORM</a></li></ul><p>æ•°æ®åº“åŸºæœ¬ä¸Šæ˜¯ç°ä»£åº”ç”¨ç¨‹åºçš„æ ‡å‡†å­˜å‚¨ï¼Œç»å¤§å¤šæ•°ç¨‹åºéƒ½æŠŠè‡ªå·±çš„ä¸šåŠ¡æ•°æ®å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œå¯è§ï¼Œè®¿é—®æ•°æ®åº“å‡ ä¹æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºå¿…å¤‡èƒ½åŠ›ã€‚</p><p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»ä»‹ç»äº† Java ç¨‹åºè®¿é—®æ•°æ®åº“çš„æ ‡å‡†æ¥å£ JDBCï¼Œå®ƒçš„å®ç°æ–¹å¼éå¸¸ç®€æ´ï¼Œå³ï¼šJava æ ‡å‡†åº“å®šä¹‰æ¥å£ï¼Œå„æ•°æ®åº“å‚å•†ä»¥ â€œé©±åŠ¨â€ çš„å½¢å¼å®ç°æ¥å£ã€‚åº”ç”¨ç¨‹åºè¦ä½¿ç”¨å“ªä¸ªæ•°æ®åº“ï¼Œå°±æŠŠè¯¥æ•°æ®åº“å‚å•†çš„é©±åŠ¨ä»¥ jar åŒ…å½¢å¼å¼•å…¥è¿›æ¥ï¼ŒåŒæ—¶è‡ªèº«ä»…ä½¿ç”¨ JDBC æ¥å£ï¼Œç¼–è¯‘æœŸå¹¶ä¸éœ€è¦ç‰¹å®šå‚å•†çš„é©±åŠ¨ã€‚</p><p>ä½¿ç”¨ JDBC è™½ç„¶ç®€å•ï¼Œä½†ä»£ç æ¯”è¾ƒç¹çã€‚Spring ä¸ºäº†ç®€åŒ–æ•°æ®åº“è®¿é—®ï¼Œä¸»è¦åšäº†ä»¥ä¸‹å‡ ç‚¹å·¥ä½œï¼š</p><ul><li>æä¾›äº†ç®€åŒ–çš„è®¿é—® JDBC çš„æ¨¡æ¿ç±»ï¼Œä¸å¿…æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼›</li><li>æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ DAO ç±»ä»¥å®ç° Data Access Object æ¨¡å¼ï¼›</li><li>æŠŠ <code>SQLException</code> å°è£…ä¸º <code>DataAccessException</code>ï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯ä¸€ä¸ª <code>RuntimeException</code>ï¼Œå¹¶ä¸”è®©æˆ‘ä»¬èƒ½åŒºåˆ† SQL å¼‚å¸¸çš„åŸå› ï¼Œä¾‹å¦‚ï¼Œ<code>DuplicateKeyException</code> è¡¨ç¤ºè¿åäº†ä¸€ä¸ªå”¯ä¸€çº¦æŸï¼›</li><li>èƒ½æ–¹ä¾¿åœ°é›†æˆ Hibernateã€JPA å’Œ MyBatis è¿™äº›æ•°æ®åº“è®¿é—®æ¡†æ¶ã€‚</li></ul><p>æœ¬ç« æˆ‘ä»¬å°†è¯¦ç»†è®²è§£åœ¨ Spring ä¸­è®¿é—®æ•°æ®åº“çš„æœ€ä½³å®è·µã€‚</p><h2 id="ğŸ€-ä½¿ç”¨-jdbc" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-jdbc" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ JDBC</h2>',7),y={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1255943820274272",target:"_blank",rel:"noopener noreferrer"},w=p("<ul><li>åˆ›å»ºå…¨å±€ <code>DataSource</code> å®ä¾‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥æ± ï¼›</li><li>åœ¨éœ€è¦è¯»å†™æ•°æ®åº“çš„æ–¹æ³•å†…éƒ¨ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤è®¿é—®æ•°æ®åº“ï¼š <ul><li>ä»å…¨å±€ <code>DataSource</code> å®ä¾‹è·å– <code>Connection</code> å®ä¾‹ï¼›</li><li>é€šè¿‡ <code>Connection</code> å®ä¾‹åˆ›å»º <code>PreparedStatement</code> å®ä¾‹ï¼›</li><li>æ‰§è¡Œ SQL è¯­å¥ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™é€šè¿‡ <code>ResultSet</code> è¯»å–ç»“æœé›†ï¼Œå¦‚æœæ˜¯ä¿®æ”¹ï¼Œåˆ™è·å¾— <code>int</code> ç»“æœã€‚</li></ul></li></ul><p>æ­£ç¡®ç¼–å†™ JDBC ä»£ç çš„å…³é”®æ˜¯ä½¿ç”¨ <code>try ... finally</code> é‡Šæ”¾èµ„æºï¼Œæ¶‰åŠåˆ°äº‹åŠ¡çš„ä»£ç éœ€è¦æ­£ç¡®æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p>",2),f=s("code",null,"DataSource",-1),h=s("code",null,"JdbcTemplate",-1),S=s("code",null,"JdbcTemplate",-1),q={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1281319636041762",target:"_blank",rel:"noopener noreferrer"},j={href:"http://hsqldb.org/",target:"_blank",rel:"noopener noreferrer"},T=p(`<p>æˆ‘ä»¬ä»¥å®é™…å·¥ç¨‹ä¸ºä¾‹ï¼Œå…ˆåˆ›å»º Maven å·¥ç¨‹ <code>spring-data-jdbc</code>ï¼Œç„¶åå¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-context:6.0.0</li><li>org.springframework:spring-jdbc:6.0.0</li><li>jakarta.annotation:jakarta.annotation-api:2.1.1</li><li>com.zaxxer:HikariCP:5.0.1</li><li>org.hsqldb:hsqldb:2.7.1</li></ul><p>åœ¨ <code>AppConfig</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä»¥ä¸‹å‡ ä¸ªå¿…é¡»çš„ Beanï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jdbc.url}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> jdbcUrl<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jdbc.username}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> jdbcUsername<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jdbc.password}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> jdbcPassword<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HikariConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span>jdbcUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>jdbcUsername<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>jdbcPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addDataSourceProperty</span><span class="token punctuation">(</span><span class="token string">&quot;autoCommit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addDataSourceProperty</span><span class="token punctuation">(</span><span class="token string">&quot;connectionTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addDataSourceProperty</span><span class="token punctuation">(</span><span class="token string">&quot;idleTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">JdbcTemplate</span> <span class="token function">createJdbcTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼š</p><ol><li>é€šè¿‡ <code>@PropertySource(&quot;jdbc.properties&quot;)</code> è¯»å–æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼›</li><li>é€šè¿‡ <code>@Value(&quot;\${jdbc.url}&quot;)</code> æ³¨å…¥é…ç½®æ–‡ä»¶çš„ç›¸å…³é…ç½®ï¼›</li><li>åˆ›å»ºä¸€ä¸ª DataSource å®ä¾‹ï¼Œå®ƒçš„å®é™…ç±»å‹æ˜¯ <code>HikariDataSource</code>ï¼Œåˆ›å»ºæ—¶éœ€è¦ç”¨åˆ°æ³¨å…¥çš„é…ç½®ï¼›</li><li>åˆ›å»ºä¸€ä¸ª JdbcTemplate å®ä¾‹ï¼Œå®ƒéœ€è¦æ³¨å…¥ <code>DataSource</code>ï¼Œè¿™æ˜¯é€šè¿‡æ–¹æ³•å‚æ•°å®Œæˆæ³¨å…¥çš„ã€‚</li></ol><p>æœ€åï¼Œé’ˆå¯¹ HSQLDB å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>jdbc.properties</code>ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>## ğŸ€ æ•°æ®åº“æ–‡ä»¶åä¸º testdb:
jdbc.url=jdbc:hsqldb:file:testdb

## ğŸ€ Hsqldb é»˜è®¤çš„ç”¨æˆ·åæ˜¯ saï¼Œå£ä»¤æ˜¯ç©ºå­—ç¬¦ä¸²:
jdbc.username=sa
jdbc.password=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é€šè¿‡ HSQLDB è‡ªå¸¦çš„å·¥å…·æ¥åˆå§‹åŒ–æ•°æ®åº“è¡¨ï¼Œè¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ª Beanï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>users</code> è¡¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseInitializer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE TABLE IF NOT EXISTS users (&quot;</span> <span class="token comment">//</span>
                <span class="token operator">+</span> <span class="token string">&quot;id BIGINT IDENTITY NOT NULL PRIMARY KEY,&quot;</span> <span class="token comment">//</span>
                <span class="token operator">+</span> <span class="token string">&quot;email VARCHAR(100) NOT NULL,&quot;</span> <span class="token comment">//</span>
                <span class="token operator">+</span> <span class="token string">&quot;password VARCHAR(100) NOT NULL,&quot;</span> <span class="token comment">//</span>
                <span class="token operator">+</span> <span class="token string">&quot;name VARCHAR(100) NOT NULL,&quot;</span> <span class="token comment">//</span>
                <span class="token operator">+</span> <span class="token string">&quot;UNIQUE (email))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ‰€æœ‰å‡†å¤‡å·¥ä½œéƒ½å·²å®Œæ¯•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦è®¿é—®æ•°æ®åº“çš„ Bean ä¸­ï¼Œæ³¨å…¥ <code>JdbcTemplate</code> å³å¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jdbctemplate-ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#jdbctemplate-ç”¨æ³•" aria-hidden="true">#</a> JdbcTemplate ç”¨æ³•</h3><p>Spring æä¾›çš„ <code>JdbcTemplate</code> é‡‡ç”¨ Template æ¨¡å¼ï¼Œæä¾›äº†ä¸€ç³»åˆ—ä»¥å›è°ƒä¸ºç‰¹ç‚¹çš„å·¥å…·æ–¹æ³•ï¼Œç›®çš„æ˜¯é¿å…ç¹ççš„ <code>try...catch</code> è¯­å¥ã€‚</p><p>æˆ‘ä»¬ä»¥å…·ä½“çš„ç¤ºä¾‹æ¥è¯´æ˜ JdbcTemplate çš„ç”¨æ³•ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹ <code>T execute(ConnectionCallback&lt;T&gt; action)</code> æ–¹æ³•ï¼Œå®ƒæä¾›äº† Jdbc çš„ <code>Connection</code> ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ³¨æ„ä¼ å…¥çš„æ˜¯ ConnectionCallback:</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨ conn å®ä¾‹ï¼Œä¸è¦é‡Šæ”¾å®ƒï¼Œå›è°ƒç»“æŸå JdbcTemplate è‡ªåŠ¨é‡Šæ”¾:</span>
        <span class="token comment">// åœ¨å†…éƒ¨æ‰‹åŠ¨åˆ›å»ºçš„ PreparedStatementã€ResultSet å¿…é¡»ç”¨ try(...) é‡Šæ”¾:</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token keyword">var</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span> <span class="token comment">// new User object:</span>
                            rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// id</span>
                            rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// email</span>
                            rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
                            rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;user not found by id.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šè¿°å›è°ƒæ–¹æ³•å…è®¸è·å– Connectionï¼Œç„¶ååšä»»ä½•åŸºäº Connection çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬å†çœ‹ <code>T execute(String sql, PreparedStatementCallback&lt;T&gt; action)</code> çš„ç”¨æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// éœ€è¦ä¼ å…¥ SQL è¯­å¥ï¼Œä»¥åŠ PreparedStatementCallback:</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE name = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// PreparedStatement å®ä¾‹å·²ç»ç”± JdbcTemplate åˆ›å»ºï¼Œå¹¶åœ¨å›è°ƒåè‡ªåŠ¨é‡Šæ”¾:</span>
        ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token keyword">var</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span> <span class="token comment">// new User object:</span>
                        rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// id</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// email</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;user not found by id.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ <code>T queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, Object... args)</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¼ å…¥ SQLï¼Œå‚æ•°å’Œ RowMapper å®ä¾‹:</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE email = ?&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// å°† ResultSet çš„å½“å‰è¡Œæ˜ å°„ä¸ºä¸€ä¸ª JavaBean:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span> <span class="token comment">// new User object:</span>
                        rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// id</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// email</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>queryForObject()</code> æ–¹æ³•ä¸­ï¼Œä¼ å…¥ SQL ä»¥åŠ SQL å‚æ•°åï¼Œ<code>JdbcTemplate</code> ä¼šè‡ªåŠ¨åˆ›å»º <code>PreparedStatement</code>ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å› <code>ResultSet</code>ï¼Œæˆ‘ä»¬æä¾›çš„ <code>RowMapper</code> éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠ <code>ResultSet</code> çš„å½“å‰è¡Œæ˜ å°„æˆä¸€ä¸ª JavaBean å¹¶è¿”å›ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>Connection</code>ã€<code>PreparedStatement</code> å’Œ <code>ResultSet</code> éƒ½ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†ã€‚</p><p><code>RowMapper</code> ä¸ä¸€å®šè¿”å› JavaBeanï¼Œå®é™…ä¸Šå®ƒå¯ä»¥è¿”å›ä»»ä½• Java å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>SELECT COUNT(*)</code> æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥è¿”å› <code>Long</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT COUNT(*) FROM users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// SELECT COUNT(*) æŸ¥è¯¢åªæœ‰ä¸€åˆ—ï¼Œå–ç¬¬ä¸€åˆ—æ•°æ®:</span>
        <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬æœŸæœ›è¿”å›å¤šè¡Œè®°å½•ï¼Œè€Œä¸æ˜¯ä¸€è¡Œï¼Œå¯ä»¥ç”¨ <code>query()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> limit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> offset <span class="token operator">=</span> limit <span class="token operator">*</span> <span class="token punctuation">(</span>pageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users LIMIT ? OFFSET ?&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            limit<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿° <code>query()</code> æ–¹æ³•ä¼ å…¥çš„å‚æ•°ä»ç„¶æ˜¯ SQLã€SQL å‚æ•°ä»¥åŠ <code>RowMapper</code> å®ä¾‹ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Spring æä¾›çš„ <code>BeanPropertyRowMapper</code>ã€‚å¦‚æœæ•°æ®åº“è¡¨çš„ç»“æ„æ°å¥½å’Œ JavaBean çš„å±æ€§åç§°ä¸€è‡´ï¼Œé‚£ä¹ˆ <code>BeanPropertyRowMapper</code> å°±å¯ä»¥ç›´æ¥æŠŠä¸€è¡Œè®°å½•æŒ‰åˆ—åè½¬æ¢ä¸º JavaBeanã€‚</p><p>å¦‚æœæˆ‘ä»¬æ‰§è¡Œçš„ä¸æ˜¯æŸ¥è¯¢ï¼Œè€Œæ˜¯æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>update()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¼ å…¥ SQLï¼ŒSQL å‚æ•°ï¼Œè¿”å›æ›´æ–°çš„è¡Œæ•°:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">!=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE users SET name = ? WHERE id = ?&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found by id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åªæœ‰ä¸€ç§ <code>INSERT</code> æ“ä½œæ¯”è¾ƒç‰¹æ®Šï¼Œé‚£å°±æ˜¯å¦‚æœæŸä¸€åˆ—æ˜¯è‡ªå¢åˆ—ï¼ˆä¾‹å¦‚è‡ªå¢ä¸»é”®ï¼‰ï¼Œé€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦è·å–æ’å…¥åçš„è‡ªå¢å€¼ã€‚<code>JdbcTemplate</code> æä¾›äº†ä¸€ä¸ª <code>KeyHolder</code> æ¥ç®€åŒ–è¿™ä¸€æ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ª KeyHolder:</span>
    <span class="token class-name">KeyHolder</span> holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratedKeyHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">!=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
        <span class="token comment">// å‚æ•° 1:PreparedStatementCreator</span>
        <span class="token punctuation">(</span>conn<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ›å»º PreparedStatement æ—¶ï¼Œå¿…é¡»æŒ‡å®š RETURN_GENERATED_KEYS:</span>
            <span class="token keyword">var</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users(email, password, name) VALUES(?, ?, ?)&quot;</span><span class="token punctuation">,</span>
                    <span class="token class-name">Statement</span><span class="token punctuation">.</span><span class="token constant">RETURN_GENERATED_KEYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ps<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// å‚æ•° 2:KeyHolder</span>
        holder<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Insert failed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä» KeyHolder ä¸­è·å–è¿”å›çš„è‡ªå¢å€¼:</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>holder<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JdbcTemplate</code> è¿˜æœ‰è®¸å¤šé‡è½½æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ä¸€ä¸€ä»‹ç»ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ<code>JdbcTemplate</code> åªæ˜¯å¯¹ JDBC æ“ä½œçš„ä¸€ä¸ªç®€å•å°è£…ï¼Œå®ƒçš„ç›®çš„æ˜¯å°½é‡å‡å°‘æ‰‹åŠ¨ç¼–å†™ <code>try(resource) {...}</code> çš„ä»£ç ï¼Œå¯¹äºæŸ¥è¯¢ï¼Œä¸»è¦é€šè¿‡ <code>RowMapper</code> å®ç°äº† JDBC ç»“æœé›†åˆ° Java å¯¹è±¡çš„è½¬æ¢ã€‚</p><p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ <code>JdbcTemplate</code> çš„ç”¨æ³•ï¼Œé‚£å°±æ˜¯ï¼š</p><ul><li>é’ˆå¯¹ç®€å•æŸ¥è¯¢ï¼Œä¼˜é€‰ <code>query()</code> å’Œ <code>queryForObject()</code>ï¼Œå› ä¸ºåªéœ€æä¾› SQL è¯­å¥ã€å‚æ•°å’Œ <code>RowMapper</code>ï¼›</li><li>é’ˆå¯¹æ›´æ–°æ“ä½œï¼Œä¼˜é€‰ <code>update()</code>ï¼Œå› ä¸ºåªéœ€æä¾› SQL è¯­å¥å’Œå‚æ•°ï¼›</li><li>ä»»ä½•å¤æ‚çš„æ“ä½œï¼Œæœ€ç»ˆä¹Ÿå¯ä»¥é€šè¿‡ <code>execute(ConnectionCallback)</code> å®ç°ï¼Œå› ä¸ºæ‹¿åˆ° <code>Connection</code> å°±å¯ä»¥åšä»»ä½• JDBC æ“ä½œã€‚</li></ul><p>å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„ä»ç„¶æ˜¯å„ç§æŸ¥è¯¢ã€‚å¦‚æœåœ¨è®¾è®¡è¡¨ç»“æ„çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå’Œ JavaBean çš„å±æ€§ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ <code>BeanPropertyRowMapper</code> å°±å¾ˆæ–¹ä¾¿ã€‚å¦‚æœè¡¨ç»“æ„å’Œ JavaBean ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿé‚£å°±éœ€è¦ç¨å¾®æ”¹å†™ä¸€ä¸‹æŸ¥è¯¢ï¼Œä½¿ç»“æœé›†çš„ç»“æ„å’Œ JavaBean ä¿æŒä¸€è‡´ã€‚</p><p>ä¾‹å¦‚ï¼Œè¡¨çš„åˆ—åæ˜¯ <code>office_address</code>ï¼Œè€Œ JavaBean å±æ€§æ˜¯ <code>workAddress</code>ï¼Œå°±éœ€è¦æŒ‡å®šåˆ«åï¼Œæ”¹å†™æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> email<span class="token punctuation">,</span> office_address <span class="token keyword">AS</span> workAddress<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> email <span class="token operator">=</span> ?
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ " aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h3><p>Spring æä¾›äº† <code>JdbcTemplate</code> æ¥ç®€åŒ– JDBC æ“ä½œï¼›</p><p>ä½¿ç”¨ <code>JdbcTemplate</code> æ—¶ï¼Œæ ¹æ®éœ€è¦ä¼˜å…ˆé€‰æ‹©é«˜çº§æ–¹æ³•ï¼›</p><p>ä»»ä½• JDBC æ“ä½œéƒ½å¯ä»¥ä½¿ç”¨ä¿åº•çš„ <code>execute(ConnectionCallback)</code> æ–¹æ³•ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡</h2>`,44),E={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1321748500840481",target:"_blank",rel:"noopener noreferrer"},B=p(`<p>Spring æä¾›äº†ä¸€ä¸ª <code>PlatformTransactionManager</code> æ¥è¡¨ç¤ºäº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½ç”±å®ƒè´Ÿè´£ç®¡ç†ã€‚è€Œäº‹åŠ¡ç”± <code>TransactionStatus</code> è¡¨ç¤ºã€‚å¦‚æœæ‰‹å†™äº‹åŠ¡ä»£ç ï¼Œä½¿ç”¨ <code>try...catch</code> å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TransactionStatus</span> tx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼€å¯äº‹åŠ¡:</span>
    tx <span class="token operator">=</span> txManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultTransactionDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç›¸å…³ JDBC æ“ä½œ:</span>
    jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æäº¤äº‹åŠ¡:</span>
    txManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å›æ»šäº‹åŠ¡:</span>
    txManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring ä¸ºå•¥è¦æŠ½è±¡å‡º <code>PlatformTransactionManager</code> å’Œ <code>TransactionStatus</code>ï¼ŸåŸå› æ˜¯ JavaEE é™¤äº†æä¾› JDBC äº‹åŠ¡å¤–ï¼Œå®ƒè¿˜æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ JTAï¼ˆJava Transaction APIï¼‰ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡å¤šä¸ªæ•°æ®æºï¼ˆæ¯”å¦‚å¤šä¸ªæ•°æ®åº“ï¼Œå¤šä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼‰è¦åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°äº‹åŠ¡çš„æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆå®ç°ã€‚åˆ†å¸ƒå¼äº‹åŠ¡å®ç°èµ·æ¥éå¸¸å¤æ‚ï¼Œç®€å•åœ°è¯´å°±æ˜¯é€šè¿‡ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨å®ç°ä¸¤é˜¶æ®µæäº¤ï¼Œä½†æœ¬èº«æ•°æ®åº“äº‹åŠ¡å°±ä¸å¿«ï¼ŒåŸºäºæ•°æ®åº“äº‹åŠ¡å®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡å°±æ…¢å¾—éš¾ä»¥å¿å—ï¼Œæ‰€ä»¥ä½¿ç”¨ç‡ä¸é«˜ã€‚</p><p>Spring ä¸ºäº†åŒæ—¶æ”¯æŒ JDBC å’Œ JTA ä¸¤ç§äº‹åŠ¡æ¨¡å‹ï¼Œå°±æŠ½è±¡å‡º <code>PlatformTransactionManager</code>ã€‚å› ä¸ºæˆ‘ä»¬çš„ä»£ç åªéœ€è¦ JDBC äº‹åŠ¡ï¼Œå› æ­¤ï¼Œåœ¨ <code>AppConfig</code> ä¸­ï¼Œéœ€è¦å†å®šä¹‰ä¸€ä¸ª <code>PlatformTransactionManager</code> å¯¹åº”çš„ Beanï¼Œå®ƒçš„å®é™…ç±»å‹æ˜¯ <code>DataSourceTransactionManager</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">PlatformTransactionManager</span> <span class="token function">createTxManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ç¼–ç¨‹çš„æ–¹å¼ä½¿ç”¨ Spring äº‹åŠ¡ä»ç„¶æ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡å£°æ˜å¼äº‹åŠ¡æ¥å®ç°ã€‚ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡éå¸¸ç®€å•ï¼Œé™¤äº†åœ¨ <code>AppConfig</code> ä¸­è¿½åŠ ä¸€ä¸ªä¸Šè¿°å®šä¹‰çš„ <code>PlatformTransactionManager</code> å¤–ï¼Œå†åŠ ä¸€ä¸ª <code>@EnableTransactionManagement</code> å°±å¯ä»¥å¯ç”¨å£°æ˜å¼äº‹åŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span> <span class="token comment">// å¯ç”¨å£°æ˜å¼</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œå¯¹éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ–¹æ³•ï¼ŒåŠ ä¸€ä¸ª <code>@Transactional</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ­¤ public æ–¹æ³•è‡ªåŠ¨å…·æœ‰äº‹åŠ¡æ”¯æŒ:</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…æ›´ç®€å•ä¸€ç‚¹ï¼Œç›´æ¥åœ¨ Bean çš„ <code>class</code> å¤„åŠ ä¸Šï¼Œè¡¨ç¤ºæ‰€æœ‰ <code>public</code> æ–¹æ³•éƒ½å…·æœ‰äº‹åŠ¡æ”¯æŒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring å¯¹ä¸€ä¸ªå£°æ˜å¼äº‹åŠ¡çš„æ–¹æ³•ï¼Œå¦‚ä½•å¼€å¯äº‹åŠ¡æ”¯æŒï¼ŸåŸç†ä»ç„¶æ˜¯ AOP ä»£ç†ï¼Œå³é€šè¿‡è‡ªåŠ¨åˆ›å»º Bean çš„ Proxy å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span>$$<span class="token class-name">EnhancerBySpringCGLIB</span> <span class="token keyword">extends</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserService</span> target <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">PlatformTransactionManager</span> txManager <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TransactionStatus</span> tx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            tx <span class="token operator">=</span> txManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultTransactionDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            target<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            txManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            txManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå£°æ˜äº† <code>@EnableTransactionManagement</code> åï¼Œä¸å¿…é¢å¤–æ·»åŠ  <code>@EnableAspectJAutoProxy</code>ã€‚</p><h3 id="å›æ»šäº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#å›æ»šäº‹åŠ¡" aria-hidden="true">#</a> å›æ»šäº‹åŠ¡</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå‘ç”Ÿäº† <code>RuntimeException</code>ï¼ŒSpring çš„å£°æ˜å¼äº‹åŠ¡å°†è‡ªåŠ¨å›æ»šã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä¸­ï¼Œå¦‚æœç¨‹åºåˆ¤æ–­éœ€è¦å›æ»šäº‹åŠ¡ï¼Œåªéœ€æŠ›å‡º <code>RuntimeException</code>ï¼Œä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token function">buyProducts</span><span class="token punctuation">(</span><span class="token keyword">long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store <span class="token operator">&lt;</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åº“å­˜ä¸å¤Ÿï¼Œè´­ä¹°å¤±è´¥:</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;No enough products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦é’ˆå¯¹ Checked Exception å›æ»šäº‹åŠ¡ï¼Œéœ€è¦åœ¨ <code>@Transactional</code> æ³¨è§£ä¸­å†™å‡ºæ¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token function">buyProducts</span><span class="token punctuation">(</span><span class="token keyword">long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è¡¨ç¤ºåœ¨æŠ›å‡º <code>RuntimeException</code> æˆ– <code>IOException</code> æ—¶ï¼Œäº‹åŠ¡å°†å›æ»šã€‚</p><p>ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸šåŠ¡å¼‚å¸¸ä½“ç³»ä» <code>RuntimeException</code> æ´¾ç”Ÿï¼Œè¿™æ ·å°±ä¸å¿…å£°æ˜ä»»ä½•ç‰¹æ®Šå¼‚å¸¸å³å¯è®© Spring çš„å£°æ˜å¼äº‹åŠ¡æ­£å¸¸å·¥ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusinessException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginException</span> <span class="token keyword">extends</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentException</span> <span class="token keyword">extends</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="äº‹åŠ¡è¾¹ç•Œ" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡è¾¹ç•Œ" aria-hidden="true">#</a> äº‹åŠ¡è¾¹ç•Œ</h3><p>åœ¨ä½¿ç”¨äº‹åŠ¡çš„æ—¶å€™ï¼Œæ˜ç¡®äº‹åŠ¡è¾¹ç•Œéå¸¸é‡è¦ã€‚å¯¹äºå£°æ˜å¼äº‹åŠ¡ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ <code>register()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// äº‹åŠ¡å¼€å§‹</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span> <span class="token comment">// äº‹åŠ¡ç»“æŸ</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„äº‹åŠ¡è¾¹ç•Œå°±æ˜¯ <code>register()</code> æ–¹æ³•å¼€å§‹å’Œç»“æŸã€‚</p><p>ç±»ä¼¼çš„ï¼Œä¸€ä¸ªè´Ÿè´£ç»™ç”¨æˆ·å¢åŠ ç§¯åˆ†çš„ <code>addBonus()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BonusService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addBonus</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">,</span> <span class="token keyword">int</span> bonus<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// äº‹åŠ¡å¼€å§‹</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span> <span class="token comment">// äº‹åŠ¡ç»“æŸ</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„äº‹åŠ¡è¾¹ç•Œå°±æ˜¯ <code>addBonus()</code> æ–¹æ³•å¼€å§‹å’Œç»“æŸã€‚</p><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œé—®é¢˜æ€»æ˜¯è¦å¤æ‚ä¸€ç‚¹ç‚¹ã€‚ç”¨æˆ·æ³¨å†Œåï¼Œèƒ½è‡ªåŠ¨è·å¾— 100 ç§¯åˆ†ï¼Œå› æ­¤ï¼Œå®é™…ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">BonusService</span> bonusService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ’å…¥ç”¨æˆ·è®°å½•:</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¢åŠ  100 ç§¯åˆ†:</span>
        bonusService<span class="token punctuation">.</span><span class="token function">addBonus</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼šè°ƒç”¨æ–¹ï¼ˆæ¯”å¦‚ <code>RegisterController</code>ï¼‰è°ƒç”¨ <code>UserService.register()</code> è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œå®ƒåœ¨å†…éƒ¨åˆè°ƒç”¨äº† <code>BonusService.addBonus()</code> è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œä¸€å…±æœ‰å‡ ä¸ªäº‹åŠ¡ï¼Ÿå¦‚æœ <code>addBonus()</code> æŠ›å‡ºäº†å¼‚å¸¸éœ€è¦å›æ»šäº‹åŠ¡ï¼Œ<code>register()</code> æ–¹æ³•çš„äº‹åŠ¡æ˜¯å¦ä¹Ÿè¦å›æ»šï¼Ÿ</p><p>é—®é¢˜çš„å¤æ‚åº¦æ˜¯ä¸æ˜¯ä¸€ä¸‹å­æé«˜äº† 10 å€ï¼Ÿ</p><h3 id="äº‹åŠ¡ä¼ æ’­" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡ä¼ æ’­" aria-hidden="true">#</a> äº‹åŠ¡ä¼ æ’­</h3><p>è¦è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰äº‹åŠ¡çš„ä¼ æ’­æ¨¡å‹ã€‚</p><p>å‡è®¾ç”¨æˆ·æ³¨å†Œçš„å…¥å£æ˜¯ <code>RegisterController</code>ï¼Œå®ƒæœ¬èº«æ²¡æœ‰äº‹åŠ¡ï¼Œä»…ä»…æ˜¯è°ƒç”¨ <code>UserService.register()</code> è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegisterController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> email <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› æ­¤ï¼Œ<code>UserService.register()</code> è¿™ä¸ªäº‹åŠ¡æ–¹æ³•çš„èµ·å§‹å’Œç»“æŸï¼Œå°±æ˜¯äº‹åŠ¡çš„èŒƒå›´ã€‚</p><p>æˆ‘ä»¬éœ€è¦å…³å¿ƒçš„é—®é¢˜æ˜¯ï¼Œåœ¨ <code>UserService.register()</code> è¿™ä¸ªäº‹åŠ¡æ–¹æ³•å†…ï¼Œè°ƒç”¨ <code>BonusService.addBonus()</code>ï¼Œæˆ‘ä»¬æœŸå¾…çš„äº‹åŠ¡è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// äº‹åŠ¡å·²å¼€å¯:</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ???:</span>
    bonusService<span class="token punctuation">.</span><span class="token function">addBonus</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">// äº‹åŠ¡ç»“æŸ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºå¤§å¤šæ•°ä¸šåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬æœŸå¾… <code>BonusService.addBonus()</code> çš„è°ƒç”¨ï¼Œå’Œ <code>UserService.register()</code> åº”å½“èåˆåœ¨ä¸€èµ·ï¼Œå®ƒçš„è¡Œä¸ºåº”è¯¥å¦‚ä¸‹ï¼š</p><p><code>UserService.register()</code> å·²ç»å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆåœ¨å†…éƒ¨è°ƒç”¨ <code>BonusService.addBonus()</code> æ—¶ï¼Œ<code>BonusService.addBonus()</code> æ–¹æ³•å°±æ²¡å¿…è¦å†å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œç›´æ¥åŠ å…¥åˆ° <code>BonusService.register()</code> çš„äº‹åŠ¡é‡Œå°±å¥½äº†ã€‚</p><p>å…¶å®å°±ç›¸å½“äºï¼š</p><ol><li><code>UserService.register()</code> å…ˆæ‰§è¡Œäº†ä¸€æ¡ INSERT è¯­å¥ï¼š<code>INSERT INTO users ...</code></li><li><code>BonusService.addBonus()</code> å†æ‰§è¡Œä¸€æ¡ INSERT è¯­å¥ï¼š<code>INSERT INTO bonus ...</code></li></ol><p>å› æ­¤ï¼ŒSpring çš„å£°æ˜å¼äº‹åŠ¡ä¸ºäº‹åŠ¡ä¼ æ’­å®šä¹‰äº†å‡ ä¸ªçº§åˆ«ï¼Œé»˜è®¤ä¼ æ’­çº§åˆ«å°±æ˜¯ REQUIREDï¼Œå®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬è§‚å¯Ÿ <code>UserService.register()</code> æ–¹æ³•ï¼Œå®ƒåœ¨ <code>RegisterController</code> ä¸­æ‰§è¡Œï¼Œå› ä¸º <code>RegisterController</code> æ²¡æœ‰äº‹åŠ¡ï¼Œå› æ­¤ï¼Œ<code>UserService.register()</code> æ–¹æ³•ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚</p><p>åœ¨ <code>UserService.register()</code> æ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨ <code>BonusService.addBonus()</code> æ–¹æ³•æ—¶ï¼Œå› ä¸º <code>BonusService.addBonus()</code> æ£€æµ‹åˆ°å½“å‰å·²ç»æœ‰äº‹åŠ¡äº†ï¼Œå› æ­¤ï¼Œå®ƒä¼šåŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p><p>å› æ­¤ï¼Œæ•´ä¸ªä¸šåŠ¡æµç¨‹çš„äº‹åŠ¡è¾¹ç•Œå°±æ¸…æ™°äº†ï¼šå®ƒåªæœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”èŒƒå›´å°±æ˜¯ <code>UserService.register()</code> æ–¹æ³•ã€‚</p><p>æœ‰çš„ç«¥é‹ä¼šé—®ï¼šæŠŠ <code>BonusService.addBonus()</code> æ–¹æ³•çš„ <code>@Transactional</code> å»æ‰ï¼Œå˜æˆä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œé‚£ä¸å°±è§„é¿äº†å¤æ‚çš„ä¼ æ’­æ¨¡å‹å—ï¼Ÿ</p><p>å»æ‰ <code>BonusService.addBonus()</code> æ–¹æ³•çš„ <code>@Transactional</code>ï¼Œä¼šå¼•æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼Œå³å…¶ä»–åœ°æ–¹å¦‚æœè°ƒç”¨ <code>BonusService.addBonus()</code> æ–¹æ³•ï¼Œé‚£å°±æ²¡æ³•ä¿è¯äº‹åŠ¡äº†ã€‚ä¾‹å¦‚ï¼Œè§„å®šç”¨æˆ·ç™»å½•æ—¶ç§¯åˆ† + 5ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">BonusService</span> bonusService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        bonusService<span class="token punctuation">.</span><span class="token function">addBonus</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œ<code>BonusService.addBonus()</code> æ–¹æ³•å¿…é¡»è¦æœ‰ <code>@Transactional</code>ï¼Œå¦åˆ™ï¼Œç™»å½•åç§¯åˆ†å°±æ— æ³•æ·»åŠ äº†ã€‚</p><p>é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­çº§åˆ«æ˜¯ <code>REQUIRED</code>ï¼Œå®ƒæ»¡è¶³ç»å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¼ æ’­çº§åˆ«ï¼š</p><p><code>SUPPORTS</code>ï¼šè¡¨ç¤ºå¦‚æœæœ‰äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹Ÿä¸å¼€å¯äº‹åŠ¡æ‰§è¡Œã€‚è¿™ç§ä¼ æ’­çº§åˆ«å¯ç”¨äºæŸ¥è¯¢æ–¹æ³•ï¼Œå› ä¸º SELECT è¯­å¥æ—¢å¯ä»¥åœ¨äº‹åŠ¡å†…æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸éœ€è¦äº‹åŠ¡ï¼›</p><p><code>MANDATORY</code>ï¼šè¡¨ç¤ºå¿…é¡»è¦å­˜åœ¨å½“å‰äº‹åŠ¡å¹¶åŠ å…¥æ‰§è¡Œï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ç§ä¼ æ’­çº§åˆ«å¯ç”¨äºæ ¸å¿ƒæ›´æ–°é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æˆ·ä½™é¢å˜æ›´ï¼Œå®ƒæ€»æ˜¯è¢«å…¶ä»–äº‹åŠ¡æ–¹æ³•è°ƒç”¨ï¼Œä¸èƒ½ç›´æ¥ç”±éäº‹åŠ¡æ–¹æ³•è°ƒç”¨ï¼›</p><p><code>REQUIRES_NEW</code>ï¼šè¡¨ç¤ºä¸ç®¡å½“å‰æœ‰æ²¡æœ‰äº‹åŠ¡ï¼Œéƒ½å¿…é¡»å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡æ‰§è¡Œã€‚å¦‚æœå½“å‰å·²ç»æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡ä¼šæŒ‚èµ·ï¼Œç­‰æ–°äº‹åŠ¡å®Œæˆåï¼Œå†æ¢å¤æ‰§è¡Œï¼›</p><p><code>NOT_SUPPORTED</code>ï¼šè¡¨ç¤ºä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡ä¼šæŒ‚èµ·ï¼Œç­‰è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå†æ¢å¤æ‰§è¡Œï¼›</p><p><code>NEVER</code>ï¼šå’Œ <code>NOT_SUPPORTED</code> ç›¸æ¯”ï¼Œå®ƒä¸ä½†ä¸æ”¯æŒäº‹åŠ¡ï¼Œè€Œä¸”åœ¨ç›‘æµ‹åˆ°å½“å‰æœ‰äº‹åŠ¡æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸æ‹’ç»æ‰§è¡Œï¼›</p><p><code>NESTED</code>ï¼šè¡¨ç¤ºå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œåˆ™å¼€å¯ä¸€ä¸ªåµŒå¥—çº§åˆ«äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚</p><p>ä¸Šé¢è¿™ä¹ˆå¤šç§äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Œå…¶å®é»˜è®¤çš„ <code>REQUIRED</code> å·²ç»æ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œ<code>SUPPORTS</code> å’Œ <code>REQUIRES_NEW</code> åœ¨å°‘æ•°æƒ…å†µä¸‹ä¼šç”¨åˆ°ï¼Œå…¶ä»–åŸºæœ¬ä¸ä¼šç”¨åˆ°ï¼Œå› ä¸ºæŠŠäº‹åŠ¡æå¾—è¶Šå¤æ‚ï¼Œä¸ä»…é€»è¾‘è·Ÿç€å¤æ‚ï¼Œè€Œä¸”é€Ÿåº¦ä¹Ÿä¼šè¶Šæ…¢ã€‚</p><p>å®šä¹‰äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ä¹Ÿæ˜¯å†™åœ¨ <code>@Transactional</code> æ³¨è§£é‡Œçš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨åªå‰©æœ€åä¸€ä¸ªé—®é¢˜äº†ï¼šSpring æ˜¯å¦‚ä½•ä¼ æ’­äº‹åŠ¡çš„ï¼Ÿ</p>`,63),x=p(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// å…³é—­è‡ªåŠ¨æäº¤:</span>
    conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰§è¡Œå¤šæ¡ SQL è¯­å¥:</span>
    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æäº¤äº‹åŠ¡:</span>
    conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å›æ»šäº‹åŠ¡:</span>
    conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ï¼Œæœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡æ‰§è¡Œ JDBC äº‹åŠ¡æ¥å®ç°åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œå¦‚ä½•è·çŸ¥å½“å‰æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Ÿ</p>`,2),U=s("code",null,"Connection",-1),C=s("code",null,"TransactionStatus",-1),M=s("code",null,"ThreadLocal",-1),A=s("code",null,"ThreadLocal",-1),J=s("code",null,"ThreadLocal",-1),R=s("code",null,"TransactionStatus",-1),L=p(`<p>å› æ­¤ï¼Œäº‹åŠ¡èƒ½æ­£ç¡®ä¼ æ’­çš„å‰ææ˜¯ï¼Œæ–¹æ³•è°ƒç”¨æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…æ‰è¡Œã€‚å¦‚æœåƒä¸‹é¢è¿™æ ·å†™ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// BEGIN TX-A</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// BEGIN TX-B:</span>
        bonusService<span class="token punctuation">.</span><span class="token function">addBonus</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// END TX-B</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">// END TX-A</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ <code>BonusService.addBonus()</code>ï¼Œå®ƒæ ¹æœ¬è·å–ä¸åˆ°å½“å‰äº‹åŠ¡ï¼Œå› æ­¤ï¼Œ<code>UserService.register()</code> å’Œ <code>BonusService.addBonus()</code> ä¸¤ä¸ªæ–¹æ³•ï¼Œå°†åˆ†åˆ«å¼€å¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„äº‹åŠ¡ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œäº‹åŠ¡åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¼ æ’­ï¼Œæ— æ³•è·¨çº¿ç¨‹ä¼ æ’­ã€‚</p><p>é‚£å¦‚æœæˆ‘ä»¬æƒ³å®ç°è·¨çº¿ç¨‹ä¼ æ’­äº‹åŠ¡å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯è¦æƒ³åŠæ³•æŠŠå½“å‰çº¿ç¨‹ç»‘å®šåˆ° <code>ThreadLocal</code> çš„ <code>Connection</code> å’Œ <code>TransactionStatus</code> å®ä¾‹ä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œä½†å®ç°èµ·æ¥éå¸¸å¤æ‚ï¼Œæ ¹æ®å¼‚å¸¸å›æ»šæ›´åŠ å¤æ‚ï¼Œä¸æ¨èè‡ªå·±å»å®ç°ã€‚</p><h3 id="ç»ƒä¹ -1" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -1" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1" aria-hidden="true">#</a> å°ç»“</h3><p>Spring æä¾›çš„å£°æ˜å¼äº‹åŠ¡æå¤§åœ°æ–¹ä¾¿äº†åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨äº‹åŠ¡ï¼Œæ­£ç¡®ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡çš„å…³é”®åœ¨äºç¡®å®šå¥½äº‹åŠ¡è¾¹ç•Œï¼Œç†è§£äº‹åŠ¡ä¼ æ’­çº§åˆ«ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨-dao" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-dao" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ DAO</h2><p>åœ¨ä¼ ç»Ÿçš„å¤šå±‚åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸æ˜¯ Web å±‚è°ƒç”¨ä¸šåŠ¡å±‚ï¼Œä¸šåŠ¡å±‚è°ƒç”¨æ•°æ®è®¿é—®å±‚ã€‚ä¸šåŠ¡å±‚è´Ÿè´£å¤„ç†å„ç§ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ•°æ®è®¿é—®å±‚åªè´Ÿè´£å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚å› æ­¤ï¼Œå®ç°æ•°æ®è®¿é—®å±‚å°±æ˜¯ç”¨ <code>JdbcTemplate</code> å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p><p>ç¼–å†™æ•°æ®è®¿é—®å±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ DAO æ¨¡å¼ã€‚DAO å³ Data Access Object çš„ç¼©å†™ï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆç¥ç§˜ä¹‹å¤„ï¼Œå®ç°èµ·æ¥åŸºæœ¬å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">User</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">User</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring æä¾›äº†ä¸€ä¸ª <code>JdbcDaoSupport</code> ç±»ï¼Œç”¨äºç®€åŒ– DAO çš„å®ç°ã€‚è¿™ä¸ª <code>JdbcDaoSupport</code> æ²¡ä»€ä¹ˆå¤æ‚çš„ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æŒæœ‰ä¸€ä¸ª <code>JdbcTemplate</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">extends</span> <span class="token class-name">DaoSupport</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
        <span class="token function">initTemplateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„æ„å›¾æ˜¯å­ç±»ç›´æ¥ä» <code>JdbcDaoSupport</code> ç»§æ‰¿åï¼Œå¯ä»¥éšæ—¶è°ƒç”¨ <code>getJdbcTemplate()</code> è·å¾— <code>JdbcTemplate</code> çš„å®ä¾‹ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå› ä¸º <code>JdbcDaoSupport</code> çš„ <code>jdbcTemplate</code> å­—æ®µæ²¡æœ‰æ ‡è®° <code>@Autowired</code>ï¼Œæ‰€ä»¥ï¼Œå­ç±»æƒ³è¦æ³¨å…¥ <code>JdbcTemplate</code>ï¼Œè¿˜å¾—è‡ªå·±æƒ³ä¸ªåŠæ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setJdbcTemplate</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰çš„ç«¥é‹å¯èƒ½çœ‹å‡ºæ¥äº†ï¼šæ—¢ç„¶ <code>UserDao</code> éƒ½å·²ç»æ³¨å…¥äº† <code>JdbcTemplate</code>ï¼Œé‚£å†æŠŠå®ƒæ”¾åˆ°çˆ¶ç±»é‡Œï¼Œé€šè¿‡ <code>getJdbcTemplate()</code> è®¿é—®å²‚ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p><p>å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„ XML é…ç½®ï¼Œå¹¶ä¸éœ€è¦ç¼–å†™ <code>@Autowired JdbcTemplate jdbcTemplate</code>ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç°åœ¨åŸºæœ¬ä¸Šæ˜¯ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª <code>AbstractDao</code>ï¼Œä¸“é—¨è´Ÿè´£æ³¨å…¥ <code>JdbcTemplate</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractDao</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setJdbcTemplate</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå­ç±»çš„ä»£ç å°±éå¸¸å¹²å‡€ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ <code>getJdbcTemplate()</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>
                <span class="token string">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                id
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å€˜è‹¥è‚¯å†å¤šå†™ä¸€ç‚¹æ ·æ¿ä»£ç ï¼Œå°±å¯ä»¥æŠŠ <code>AbstractDao</code> æ”¹æˆæ³›å‹ï¼Œå¹¶å®ç° <code>getById()</code>ï¼Œ<code>getAll()</code>ï¼Œ<code>deleteById()</code> è¿™æ ·çš„é€šç”¨æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> table<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entityClass<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rowMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AbstractDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–å½“å‰ç±»å‹çš„æ³›å‹ç±»å‹:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>entityClass <span class="token operator">=</span> <span class="token function">getParameterizedType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entityClass<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rowMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>entityClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM&quot;</span> <span class="token operator">+</span> table <span class="token operator">+</span> <span class="token string">&quot;WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowMapper<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> limit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> offset <span class="token operator">=</span> limit <span class="token operator">*</span> <span class="token punctuation">(</span>pageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM&quot;</span> <span class="token operator">+</span> table <span class="token operator">+</span> <span class="token string">&quot;LIMIT ? OFFSET ?&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> limit<span class="token punctuation">,</span> offset<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>rowMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM&quot;</span> <span class="token operator">+</span> table <span class="token operator">+</span> <span class="token string">&quot;WHERE id = ?&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæ¯ä¸ªå­ç±»å°±è‡ªåŠ¨è·å¾—äº†è¿™äº›é€šç”¨æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// å·²ç»æœ‰äº†:</span>
    <span class="token comment">// User getById(long)</span>
    <span class="token comment">// List&lt;User&gt; getAll(int)</span>
    <span class="token comment">// void deleteById(long)</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDao</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// å·²ç»æœ‰äº†:</span>
    <span class="token comment">// Book getById(long)</span>
    <span class="token comment">// List&lt;Book&gt; getAll(int)</span>
    <span class="token comment">// void deleteById(long)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼ŒDAO æ¨¡å¼å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®è®¿é—®æ¨¡å¼ï¼Œæ˜¯å¦ä½¿ç”¨ DAOï¼Œæ ¹æ®å®é™…æƒ…å†µå†³å®šï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ï¼Œç›´æ¥åœ¨ Service å±‚æ“ä½œæ•°æ®åº“ä¹Ÿæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p><h3 id="ç»ƒä¹ -2" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -2" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2" aria-hidden="true">#</a> å°ç»“</h3><p>Spring æä¾›äº† <code>JdbcDaoSupport</code> æ¥ä¾¿äºæˆ‘ä»¬å®ç° DAO æ¨¡å¼ï¼›</p><p>å¯ä»¥åŸºäºæ³›å‹å®ç°æ›´é€šç”¨ã€æ›´ç®€æ´çš„ DAO æ¨¡å¼ã€‚</p><h2 id="ğŸ€-é›†æˆ-hibernate" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é›†æˆ-hibernate" aria-hidden="true">#</a> ğŸ€ é›†æˆ Hibernate</h2><p>ä½¿ç”¨ <code>JdbcTemplate</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„æ–¹æ³•å°±æ˜¯ <code>List&lt;T&gt; query(String, RowMapper, Object...)</code>ã€‚è¿™ä¸ª <code>RowMapper</code> çš„ä½œç”¨å°±æ˜¯æŠŠ <code>ResultSet</code> çš„ä¸€è¡Œè®°å½•æ˜ å°„ä¸º Java Beanã€‚</p><p>è¿™ç§æŠŠå…³ç³»æ•°æ®åº“çš„è¡¨è®°å½•æ˜ å°„ä¸º Java å¯¹è±¡çš„è¿‡ç¨‹å°±æ˜¯ ORMï¼šObject-Relational Mappingã€‚ORM æ—¢å¯ä»¥æŠŠè®°å½•è½¬æ¢æˆ Java å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŠŠ Java å¯¹è±¡è½¬æ¢ä¸ºè¡Œè®°å½•ã€‚</p>`,33),_=s("code",null,"JdbcTemplate",-1),D=s("code",null,"RowMapper",-1),P={href:"https://hibernate.org/",target:"_blank",rel:"noopener noreferrer"},O=p(`<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ Spring ä¸­é›†æˆ Hibernateã€‚</p><p>Hibernate ä½œä¸º ORM æ¡†æ¶ï¼Œå®ƒå¯ä»¥æ›¿ä»£ <code>JdbcTemplate</code>ï¼Œä½† Hibernate ä»ç„¶éœ€è¦ JDBC é©±åŠ¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ JDBC é©±åŠ¨ã€è¿æ¥æ± ï¼Œä»¥åŠ Hibernate æœ¬èº«ã€‚åœ¨ Maven ä¸­ï¼Œæˆ‘ä»¬åŠ å…¥ä»¥ä¸‹ä¾èµ–é¡¹ï¼š</p><ul><li>org.springframework:spring-context:6.0.0</li><li>org.springframework:spring-orm:6.0.0</li><li>jakarta.annotation:jakarta.annotation-api:2.1.1</li><li>jakarta.persistence:jakarta.persistence-api:3.1.0</li><li>org.hibernate:hibernate-core:6.1.4.Final</li><li>com.zaxxer:HikariCP:5.0.1</li><li>org.hsqldb:hsqldb:2.7.1</li></ul><p>åœ¨ <code>AppConfig</code> ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»º <code>DataSource</code>ã€å¼•å…¥ JDBC é…ç½®æ–‡ä»¶ï¼Œä»¥åŠå¯ç”¨å£°æ˜å¼äº‹åŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†å¯ç”¨ Hibernateï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>LocalSessionFactoryBean</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">LocalSessionFactoryBean</span> <span class="token function">createSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.hbm2ddl.auto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨</span>
        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.dialect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.hibernate.dialect.HSQLDialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.show_sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> sessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ‰«ææŒ‡å®šçš„ package è·å–æ‰€æœ‰ entity class:</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.itranswarp.learnjava.entity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setHibernateProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sessionFactoryBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),H=s("code",null,"FactoryBean",-1),I=s("code",null,"LocalSessionFactoryBean",-1),F=s("code",null,"FactoryBean",-1),N=s("code",null,"SessionFactory",-1),Q=s("code",null,"Session",-1),W=s("code",null,"Connection",-1),V=s("code",null,"SessionFactory",-1),z=s("code",null,"DataSource",-1),G=s("code",null,"SessionFactory",-1),X=s("code",null,"SessionFactory",-1),K=s("code",null,"Session",-1),Y=s("code",null,"Connection",-1),$=s("code",null,"SessionFactory",-1),Z=s("code",null,"LocalSessionFactoryBean",-1),nn=s("code",null,"SessionFactory",-1),sn=s("code",null,"LocalSessionFactoryBean",-1),an=s("code",null,"Properties",-1),en=s("code",null,"SessionFactory",-1),tn={href:"https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations",target:"_blank",rel:"noopener noreferrer"},pn=p(`<ul><li><code>hibernate.hbm2ddl.auto=update</code>ï¼šè¡¨ç¤ºè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œæ³¨æ„ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨ï¼›</li><li><code>hibernate.dialect=org.hibernate.dialect.HSQLDialect</code>ï¼šæŒ‡ç¤º Hibernate ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ HSQLDBã€‚Hibernate ä½¿ç”¨ä¸€ç§ HQL çš„æŸ¥è¯¢è¯­å¥ï¼Œå®ƒå’Œ SQL ç±»ä¼¼ï¼Œä½†çœŸæ­£åœ¨ â€œç¿»è¯‘â€ æˆ SQL æ—¶ï¼Œä¼šæ ¹æ®è®¾å®šçš„æ•°æ®åº“ â€œæ–¹è¨€â€ æ¥ç”Ÿæˆé’ˆå¯¹æ•°æ®åº“ä¼˜åŒ–çš„ SQLï¼›</li><li><code>hibernate.show_sql=true</code>ï¼šè®© Hibernate æ‰“å°æ‰§è¡Œçš„ SQLï¼Œè¿™å¯¹äºè°ƒè¯•éå¸¸æœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°çœ‹åˆ° Hibernate ç”Ÿæˆçš„ SQL è¯­å¥æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</li></ul><p>é™¤äº†è®¾ç½® <code>DataSource</code> å’Œ <code>Properties</code> ä¹‹å¤–ï¼Œæ³¨æ„åˆ° <code>setPackagesToScan()</code> æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ª <code>package</code> åç§°ï¼Œå®ƒæŒ‡ç¤º Hibernate æ‰«æè¿™ä¸ªåŒ…ä¸‹é¢çš„æ‰€æœ‰ Java ç±»ï¼Œè‡ªåŠ¨æ‰¾å‡ºèƒ½æ˜ å°„ä¸ºæ•°æ®åº“è¡¨è®°å½•çš„ JavaBeanã€‚åé¢æˆ‘ä»¬ä¼šä»”ç»†è®¨è®ºå¦‚ä½•ç¼–å†™ç¬¦åˆ Hibernate è¦æ±‚çš„ JavaBeanã€‚</p><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»º <code>HibernateTransactionManager</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">PlatformTransactionManager</span> <span class="token function">createTxManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">SessionFactory</span> sessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HibernateTransactionManager</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>HibernateTransactionManager</code> æ˜¯é…åˆ Hibernate ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡æ‰€å¿…é¡»çš„ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„é…ç½®éƒ½å®šä¹‰å®Œæ¯•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å°†æ•°æ®åº“è¡¨ç»“æ„æ˜ å°„ä¸º Java å¯¹è±¡ã€‚</p><p>è€ƒå¯Ÿå¦‚ä¸‹çš„æ•°æ®åº“è¡¨ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">user</span>
    id <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    password <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    createdAt <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">\`</span>email<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>email<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œ<code>id</code> æ˜¯è‡ªå¢ä¸»é”®ï¼Œ<code>email</code>ã€<code>password</code>ã€<code>name</code> æ˜¯ <code>VARCHAR</code> ç±»å‹ï¼Œ<code>email</code> å¸¦å”¯ä¸€ç´¢å¼•ä»¥ç¡®ä¿å”¯ä¸€æ€§ï¼Œ<code>createdAt</code> å­˜å‚¨æ•´å‹ç±»å‹çš„æ—¶é—´æˆ³ã€‚ç”¨ JavaBean è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> createdAt<span class="token punctuation">;</span>

    <span class="token comment">// getters and setters</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ˜ å°„å…³ç³»ååˆ†æ˜“æ‡‚ï¼Œä½†æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£æ¥å‘Šè¯‰ Hibernate å¦‚ä½•æŠŠ <code>User</code> ç±»æ˜ å°„åˆ°è¡¨è®°å½•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getCreatedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸€ä¸ª JavaBean è¢«ç”¨äºæ˜ å°„ï¼Œæˆ‘ä»¬å°±æ ‡è®°ä¸€ä¸ª <code>@Entity</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜ å°„çš„è¡¨åæ˜¯ <code>user</code>ï¼Œå¦‚æœå®é™…çš„è¡¨åä¸åŒï¼Œä¾‹å¦‚å®é™…è¡¨åæ˜¯ <code>users</code>ï¼Œå¯ä»¥è¿½åŠ ä¸€ä¸ª <code>@Table(name=&quot;users&quot;)</code> è¡¨ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªå±æ€§åˆ°æ•°æ®åº“åˆ—çš„æ˜ å°„ç”¨ <code>@Column()</code> æ ‡è¯†ï¼Œ<code>nullable</code> æŒ‡ç¤ºåˆ—æ˜¯å¦å…è®¸ä¸º <code>NULL</code>ï¼Œ<code>updatable</code> æŒ‡ç¤ºè¯¥åˆ—æ˜¯å¦å…è®¸è¢«ç”¨åœ¨ <code>UPDATE</code> è¯­å¥ï¼Œ<code>length</code> æŒ‡ç¤º <code>String</code> ç±»å‹çš„åˆ—çš„é•¿åº¦ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯ <code>255</code>ï¼‰ã€‚</p><p>å¯¹äºä¸»é”®ï¼Œè¿˜éœ€è¦ç”¨ <code>@Id</code> æ ‡è¯†ï¼Œè‡ªå¢ä¸»é”®å†è¿½åŠ ä¸€ä¸ª <code>@GeneratedValue</code>ï¼Œä»¥ä¾¿ Hibernate èƒ½è¯»å–åˆ°è‡ªå¢ä¸»é”®çš„å€¼ã€‚</p><p>ç»†å¿ƒçš„ç«¥é‹å¯èƒ½è¿˜æ³¨æ„åˆ°ï¼Œä¸»é”® <code>id</code> å®šä¹‰çš„ç±»å‹ä¸æ˜¯ <code>long</code>ï¼Œè€Œæ˜¯ <code>Long</code>ã€‚è¿™æ˜¯å› ä¸º Hibernate å¦‚æœæ£€æµ‹åˆ°ä¸»é”®ä¸º <code>null</code>ï¼Œå°±ä¸ä¼šåœ¨ <code>INSERT</code> è¯­å¥ä¸­æŒ‡å®šä¸»é”®çš„å€¼ï¼Œè€Œæ˜¯è¿”å›ç”±æ•°æ®åº“ç”Ÿæˆçš„è‡ªå¢å€¼ï¼Œå¦åˆ™ï¼ŒHibernate è®¤ä¸ºæˆ‘ä»¬çš„ç¨‹åºæŒ‡å®šäº†ä¸»é”®çš„å€¼ï¼Œä¼šåœ¨ <code>INSERT</code> è¯­å¥ä¸­ç›´æ¥åˆ—å‡ºã€‚<code>long</code> å‹å­—æ®µæ€»æ˜¯å…·æœ‰é»˜è®¤å€¼ <code>0</code>ï¼Œå› æ­¤ï¼Œæ¯æ¬¡æ’å…¥çš„ä¸»é”®å€¼æ€»æ˜¯ 0ï¼Œå¯¼è‡´é™¤ç¬¬ä¸€æ¬¡å¤–åç»­æ’å…¥éƒ½å°†å¤±è´¥ã€‚</p><p><code>createdAt</code> è™½ç„¶æ˜¯æ•´å‹ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ <code>long</code>ï¼Œè€Œæ˜¯ <code>Long</code>ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨åŸºæœ¬ç±»å‹ä¼šå¯¼è‡´ findByExample æŸ¥è¯¢ä¼šæ·»åŠ æ„å¤–çš„æ¡ä»¶ï¼Œè¿™é‡Œåªéœ€ç‰¢è®°ï¼Œä½œä¸ºæ˜ å°„ä½¿ç”¨çš„ JavaBeanï¼Œæ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨åŒ…è£…ç±»å‹è€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚</p><blockquote><p>[!WARNNING] ä½¿ç”¨ Hibernate æ—¶ï¼Œä¸è¦ä½¿ç”¨åŸºæœ¬ç±»å‹çš„å±æ€§ï¼Œæ€»æ˜¯ä½¿ç”¨åŒ…è£…ç±»å‹ï¼Œå¦‚ Long æˆ– Integerã€‚</p></blockquote><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ª <code>Book</code> ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getCreatedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä»”ç»†è§‚å¯Ÿ <code>User</code> å’Œ <code>Book</code>ï¼Œä¼šå‘ç°å®ƒä»¬å®šä¹‰çš„ <code>id</code>ã€<code>createdAt</code> å±æ€§æ˜¯ä¸€æ ·çš„ï¼Œè¿™åœ¨æ•°æ®åº“è¡¨ç»“æ„çš„è®¾è®¡ä¸­å¾ˆå¸¸è§ï¼šå¯¹äºæ¯ä¸ªè¡¨ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šç»Ÿä¸€ä½¿ç”¨ä¸€ç§ä¸»é”®ç”Ÿæˆæœºåˆ¶ï¼Œå¹¶æ·»åŠ  <code>createdAt</code> è¡¨ç¤ºåˆ›å»ºæ—¶é—´ï¼Œ<code>updatedAt</code> è¡¨ç¤ºä¿®æ”¹æ—¶é—´ç­‰é€šç”¨å­—æ®µã€‚</p><p>ä¸å¿…åœ¨ <code>User</code> å’Œ <code>Book</code> ä¸­é‡å¤å®šä¹‰è¿™äº›é€šç”¨å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æåˆ°ä¸€ä¸ªæŠ½è±¡ç±»ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MappedSuperclass</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractEntity</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> createdAt<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getCreatedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Transient</span>
    <span class="token keyword">public</span> <span class="token class-name">ZonedDateTime</span> <span class="token function">getCreatedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">ofEpochMilli</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>createdAt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PrePersist</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setCreatedAt</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äº <code>AbstractEntity</code> æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ ‡æ³¨ä¸€ä¸ª <code>@MappedSuperclass</code> è¡¨ç¤ºå®ƒç”¨äºç»§æ‰¿ã€‚æ­¤å¤–ï¼Œæ³¨æ„åˆ°æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>@Transient</code> æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ª â€œè™šæ‹Ÿâ€ çš„å±æ€§ã€‚å› ä¸º <code>getCreatedDateTime()</code> æ˜¯è®¡ç®—å¾—å‡ºçš„å±æ€§ï¼Œè€Œä¸æ˜¯ä»æ•°æ®åº“è¡¨è¯»å‡ºçš„å€¼ï¼Œå› æ­¤å¿…é¡»è¦æ ‡æ³¨ <code>@Transient</code>ï¼Œå¦åˆ™ Hibernate ä¼šå°è¯•ä»æ•°æ®åº“è¯»å–åä¸º <code>createdDateTime</code> è¿™ä¸ªä¸å­˜åœ¨çš„å­—æ®µä»è€Œå‡ºé”™ã€‚</p><p>å†æ³¨æ„åˆ° <code>@PrePersist</code> æ ‡è¯†çš„æ–¹æ³•ï¼Œå®ƒè¡¨ç¤ºåœ¨æˆ‘ä»¬å°†ä¸€ä¸ª JavaBean æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¹‹å‰ï¼ˆå³æ‰§è¡Œ INSERT è¯­å¥ï¼‰ï¼ŒHibernate ä¼šå…ˆæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è‡ªåŠ¨è®¾ç½®å¥½ <code>createdAt</code> å±æ€§ã€‚</p><p>æœ‰äº† <code>AbstractEntity</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤§å¹…ç®€åŒ– <code>User</code> å’Œ <code>Book</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEntity</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°ä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£å‡æ¥è‡ª <code>jakarta.persistence</code>ï¼Œå®ƒæ˜¯ JPA è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚è¿™é‡Œæˆ‘ä»¬åªä»‹ç»ä½¿ç”¨æ³¨è§£çš„æ–¹å¼é…ç½® Hibernate æ˜ å°„å…³ç³»ï¼Œä¸å†ä»‹ç»ä¼ ç»Ÿçš„æ¯”è¾ƒç¹ççš„ XML é…ç½®ã€‚é€šè¿‡ Spring é›†æˆ Hibernate æ—¶ï¼Œä¹Ÿä¸å†éœ€è¦ <code>hibernate.cfg.xml</code> é…ç½®æ–‡ä»¶ï¼Œç”¨ä¸€å¥è¯æ€»ç»“ï¼š</p><p>ä½¿ç”¨ Spring é›†æˆ Hibernateï¼Œé…åˆ JPA æ³¨è§£ï¼Œæ— éœ€ä»»ä½•é¢å¤–çš„ XML é…ç½®ã€‚</p><p>ç±»ä¼¼ <code>User</code>ã€<code>Book</code> è¿™æ ·çš„ç”¨äº ORM çš„ Java Beanï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸º Entity Beanã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœå¯¹ <code>user</code> è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚å› ä¸ºä½¿ç”¨äº† Hibernateï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¦åšçš„ï¼Œå®é™…ä¸Šæ˜¯å¯¹ <code>User</code> è¿™ä¸ª JavaBean è¿›è¡Œ â€œå¢åˆ æ”¹æŸ¥â€ã€‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª <code>UserService</code>ï¼Œæ³¨å…¥ <code>SessionFactory</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">SessionFactory</span> sessionFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="insert-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#insert-æ“ä½œ" aria-hidden="true">#</a> Insert æ“ä½œ</h3><p>è¦æŒä¹…åŒ–ä¸€ä¸ª <code>User</code> å®ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ <code>persist()</code> æ–¹æ³•ã€‚ä»¥ <code>register()</code> æ–¹æ³•ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ª User å¯¹è±¡:</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¾ç½®å¥½å„ä¸ªå±æ€§:</span>
    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸è¦è®¾ç½® idï¼Œå› ä¸ºä½¿ç”¨äº†è‡ªå¢ä¸»é”®</span>
    <span class="token comment">// ä¿å­˜åˆ°æ•°æ®åº“:</span>
    sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç°åœ¨å·²ç»è‡ªåŠ¨è·å¾—äº† id:</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delete-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#delete-æ“ä½œ" aria-hidden="true">#</a> Delete æ“ä½œ</h3><p>åˆ é™¤ä¸€ä¸ª <code>User</code> ç›¸å½“äºä»è¡¨ä¸­åˆ é™¤å¯¹åº”çš„è®°å½•ã€‚æ³¨æ„ Hibernate æ€»æ˜¯ç”¨ <code>id</code> æ¥åˆ é™¤è®°å½•ï¼Œå› æ­¤ï¼Œè¦æ­£ç¡®è®¾ç½® <code>User</code> çš„ <code>id</code> å±æ€§æ‰èƒ½æ­£å¸¸åˆ é™¤è®°å½•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">byId</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸»é”®åˆ é™¤è®°å½•æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨æ³•æ˜¯å…ˆæ ¹æ®ä¸»é”®åŠ è½½è¯¥è®°å½•ï¼Œå†åˆ é™¤ã€‚æ³¨æ„åˆ°å½“è®°å½•ä¸å­˜åœ¨æ—¶ï¼Œ<code>load()</code> è¿”å› <code>null</code>ã€‚</p><h3 id="update-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#update-æ“ä½œ" aria-hidden="true">#</a> Update æ“ä½œ</h3><p>æ›´æ–°è®°å½•ç›¸å½“äºå…ˆæ›´æ–° <code>User</code> çš„æŒ‡å®šå±æ€§ï¼Œç„¶åè°ƒç”¨ <code>merge()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">byId</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰é¢æˆ‘ä»¬åœ¨å®šä¹‰ <code>User</code> æ—¶ï¼Œå¯¹æœ‰çš„å±æ€§æ ‡æ³¨äº† <code>@Column(updatable=false)</code>ã€‚Hibernate åœ¨æ›´æ–°è®°å½•æ—¶ï¼Œå®ƒåªä¼šæŠŠ <code>@Column(updatable=true)</code> çš„å±æ€§åŠ å…¥åˆ° <code>UPDATE</code> è¯­å¥ä¸­ï¼Œè¿™æ ·å¯ä»¥æä¾›ä¸€å±‚é¢å¤–çš„å®‰å…¨æ€§ï¼Œå³å¦‚æœä¸å°å¿ƒä¿®æ”¹äº† <code>User</code> çš„ <code>email</code>ã€<code>createdAt</code> ç­‰å±æ€§ï¼Œæ‰§è¡Œ <code>update()</code> æ—¶å¹¶ä¸ä¼šæ›´æ–°å¯¹åº”çš„æ•°æ®åº“åˆ—ã€‚ä½†ä¹Ÿå¿…é¡»ç‰¢è®°ï¼šè¿™ä¸ªåŠŸèƒ½æ˜¯ Hibernate æä¾›çš„ï¼Œå¦‚æœç»•è¿‡ Hibernate ç›´æ¥é€šè¿‡ JDBC æ‰§è¡Œ <code>UPDATE</code> è¯­å¥ä»ç„¶å¯ä»¥æ›´æ–°æ•°æ®åº“çš„ä»»æ„åˆ—çš„å€¼ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ç¼–å†™çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å„ç§å„æ ·çš„æŸ¥è¯¢ã€‚æ ¹æ® <code>id</code> æŸ¥è¯¢æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ <code>load()</code>ï¼Œå¦‚æœè¦ä½¿ç”¨æ¡ä»¶æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> email <span class="token operator">=</span> ? <span class="token operator">AND</span> password <span class="token operator">=</span> ?
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¯ä»¥ä½¿ç”¨ä»€ä¹ˆæŸ¥è¯¢ã€‚</p><h3 id="ä½¿ç”¨-hql-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-hql-æŸ¥è¯¢" aria-hidden="true">#</a> ä½¿ç”¨ HQL æŸ¥è¯¢</h3><p>ä¸€ç§å¸¸ç”¨çš„æŸ¥è¯¢æ˜¯ç›´æ¥ç¼–å†™ Hibernate å†…ç½®çš„ HQL æŸ¥è¯¢ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;from User u where u.email = ?1 and u.password = ?2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,49),on={href:"https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#query-language",target:"_blank",rel:"noopener noreferrer"},cn=p(`<p>é™¤äº†å¯ä»¥ç›´æ¥ä¼ å…¥ HQL å­—ç¬¦ä¸²å¤–ï¼ŒHibernate è¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§ <code>NamedQuery</code>ï¼Œå®ƒç»™æŸ¥è¯¢èµ·ä¸ªåå­—ï¼Œç„¶åä¿å­˜åœ¨æ³¨è§£ä¸­ã€‚ä½¿ç”¨ <code>NamedQuery</code> æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆåœ¨ <code>User</code> ç±»æ ‡æ³¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@NamedQueries</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@NamedQuery</span><span class="token punctuation">(</span>
        <span class="token comment">// æŸ¥è¯¢åç§°:</span>
        name <span class="token operator">=</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// æŸ¥è¯¢è¯­å¥:</span>
        query <span class="token operator">=</span> <span class="token string">&quot;SELECT u FROM User u WHERE u.email = :e AND u.password = :pwd&quot;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEntity</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°å¼•å…¥çš„ <code>NamedQuery</code> æ˜¯ <code>jakarta.persistence.NamedQuery</code>ï¼Œå®ƒå’Œç›´æ¥ä¼ å…¥ HQL æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œå ä½ç¬¦ä½¿ç”¨ <code>:e</code> å’Œ <code>:pwd</code>ã€‚</p><p>ä½¿ç”¨ <code>NamedQuery</code> åªéœ€è¦å¼•å…¥æŸ¥è¯¢åå’Œå‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">createNamedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»º NamedQuery</span>
        <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span> <span class="token comment">// ç»‘å®š e å‚æ•°</span>
        <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span> <span class="token comment">// ç»‘å®š pwd å‚æ•°</span>
        <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›´æ¥å†™ HQL å’Œä½¿ç”¨ <code>NamedQuery</code> å„æœ‰ä¼˜åŠ£ã€‚å‰è€…å¯ä»¥åœ¨ä»£ç ä¸­ç›´è§‚åœ°çœ‹åˆ°æŸ¥è¯¢è¯­å¥ï¼Œåè€…å¯ä»¥åœ¨ <code>User</code> ç±»ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç›¸å…³æŸ¥è¯¢ã€‚</p><h3 id="ç»ƒä¹ -3" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -3" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3" aria-hidden="true">#</a> å°ç»“</h3><p>åœ¨ Spring ä¸­é›†æˆ Hibernate éœ€è¦é…ç½®çš„ Bean å¦‚ä¸‹ï¼š</p><ul><li>DataSourceï¼›</li><li>LocalSessionFactoryï¼›</li><li>HibernateTransactionManagerã€‚</li></ul><p>æ¨èä½¿ç”¨ Annotation é…ç½®æ‰€æœ‰çš„ Entity Beanã€‚</p><h2 id="ğŸ€-é›†æˆ-jpa" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é›†æˆ-jpa" aria-hidden="true">#</a> ğŸ€ é›†æˆ JPA</h2><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²äº†åœ¨ Spring ä¸­é›†æˆ Hibernateã€‚Hibernate æ˜¯ç¬¬ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„ ORM æ¡†æ¶ï¼Œä½†æ˜¯å¾ˆå¤šå°ä¼™ä¼´è¿˜å¬è¯´è¿‡ JPAï¼šJava Persistence APIï¼Œè¿™åˆæ˜¯å•¥ï¼Ÿ</p><p>åœ¨è®¨è®º JPA ä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ³¨æ„åˆ° JavaEE æ—©åœ¨ 1999 å¹´å°±å‘å¸ƒäº†ï¼Œå¹¶ä¸”æœ‰ Servletã€JMS ç­‰è¯¸å¤šæ ‡å‡†ã€‚å’Œå…¶ä»–å¹³å°ä¸åŒï¼ŒJava ä¸–ç•Œæ—©æœŸéå¸¸çƒ­è¡·äºæ ‡å‡†å…ˆè¡Œï¼Œå„å®¶è·Ÿè¿›ï¼šå¤§å®¶å…ˆåä¸‹æ¥æŠŠæ¥å£å®šäº†ï¼Œç„¶åï¼Œå„è‡ªå›å®¶å¹²æ´»å»å®ç°æ¥å£ï¼Œè¿™æ ·ï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨ä¸åŒçš„å‚å®¶æä¾›çš„äº§å“è¿›è¡Œé€‰æ‹©ï¼Œè¿˜å¯ä»¥éšæ„åˆ‡æ¢ï¼Œå› ä¸ºç”¨æˆ·ç¼–å†™ä»£ç çš„æ—¶å€™åªéœ€è¦å¼•ç”¨æ¥å£ï¼Œå¹¶ä¸éœ€è¦å¼•ç”¨å…·ä½“çš„åº•å±‚å®ç°ï¼ˆæƒ³æƒ³ JDBCï¼‰ã€‚</p><p>JPA å°±æ˜¯ JavaEE çš„ä¸€ä¸ª ORM æ ‡å‡†ï¼Œå®ƒçš„å®ç°å…¶å®å’Œ Hibernate æ²¡å•¥æœ¬è´¨åŒºåˆ«ï¼Œä½†æ˜¯ç”¨æˆ·å¦‚æœä½¿ç”¨ JPAï¼Œé‚£ä¹ˆå¼•ç”¨çš„å°±æ˜¯ <code>jakarta.persistence</code> è¿™ä¸ª â€œæ ‡å‡†â€ åŒ…ï¼Œè€Œä¸æ˜¯ <code>org.hibernate</code> è¿™æ ·çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚å› ä¸º JPA åªæ˜¯æ¥å£ï¼Œæ‰€ä»¥ï¼Œè¿˜éœ€è¦é€‰æ‹©ä¸€ä¸ªå®ç°äº§å“ï¼Œè·Ÿ JDBC æ¥å£å’Œ MySQL é©±åŠ¨ä¸€ä¸ªé“ç†ã€‚</p>`,15),ln={href:"https://www.eclipse.org/eclipselink/",target:"_blank",rel:"noopener noreferrer"},un=p(`<p>å’Œä½¿ç”¨ Hibernate ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-context:6.0.0</li><li>org.springframework:spring-orm:6.0.0</li><li>jakarta.annotation:jakarta.annotation-api:2.1.1</li><li>jakarta.persistence:jakarta.persistence-api:3.1.0</li><li>org.hibernate:hibernate-core:6.1.4.Final</li><li>com.zaxxer:HikariCP:5.0.1</li><li>org.hsqldb:hsqldb:2.7.1</li></ul><p>å®é™…ä¸Šæˆ‘ä»¬è¿™é‡Œå¼•å…¥çš„ä¾èµ–å’Œä¸Šä¸€èŠ‚é›†æˆ Hibernate å¼•å…¥çš„ä¾èµ–å®Œå…¨ä¸€æ ·ï¼Œå› ä¸º Hibernate æ—¢æä¾›äº†å®ƒè‡ªå·±çš„æ¥å£ï¼Œä¹Ÿæä¾›äº† JPA æ¥å£ï¼Œæˆ‘ä»¬ç”¨ JPA æ¥å£å°±ç›¸å½“äºé€šè¿‡ JPA æ“ä½œ Hibernateã€‚</p><p>ç„¶åï¼Œåœ¨ <code>AppConfig</code> ä¸­å¯ç”¨å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œåˆ›å»º <code>DataSource</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ Hibernate æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>LocalSessionFactoryBean</code>ï¼Œå¹¶è®©å®ƒå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>SessionFactory</code>ã€‚ä½¿ç”¨ JPA ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿåˆ›å»ºä¸€ä¸ª <code>LocalContainerEntityManagerFactoryBean</code>ï¼Œå¹¶è®©å®ƒå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>EntityManagerFactory</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">createEntityManagerFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> emFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ³¨å…¥ DataSource:</span>
    emFactory<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰«ææŒ‡å®šçš„ package è·å–æ‰€æœ‰ entity class:</span>
    emFactory<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token class-name">AbstractEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä½¿ç”¨ Hibernate ä½œä¸º JPA å®ç°:</span>
    emFactory<span class="token punctuation">.</span><span class="token function">setJpaVendorAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HibernateJpaVendorAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å…¶ä»–é…ç½®é¡¹:</span>
    <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.hbm2ddl.auto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨</span>
    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.dialect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.hibernate.dialect.HSQLDialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;hibernate.show_sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emFactory<span class="token punctuation">.</span><span class="token function">setJpaProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> emFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œé™¤äº†éœ€è¦æ³¨å…¥ <code>DataSource</code> å’Œè®¾å®šè‡ªåŠ¨æ‰«æçš„ <code>package</code> å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®š JPA çš„æä¾›å•†ï¼Œè¿™é‡Œä½¿ç”¨ Spring æä¾›çš„ä¸€ä¸ª <code>HibernateJpaVendorAdapter</code>ï¼Œæœ€åï¼Œé’ˆå¯¹ Hibernate è‡ªå·±éœ€è¦çš„é…ç½®ï¼Œä»¥ <code>Properties</code> çš„å½¢å¼æ³¨å…¥ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª <code>JpaTransactionManager</code>ï¼Œä»¥å®ç°å£°æ˜å¼äº‹åŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">PlatformTransactionManager</span> <span class="token function">createTxManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">EntityManagerFactory</span> entityManagerFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JpaTransactionManager</span><span class="token punctuation">(</span>entityManagerFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº† JPA çš„å…¨éƒ¨åˆå§‹åŒ–å·¥ä½œã€‚æœ‰äº›ç«¥é‹å¯èƒ½ä»ç½‘ä¸Šæœç´¢å¾—çŸ¥ JPA éœ€è¦ <code>persistence.xml</code> é…ç½®æ–‡ä»¶ï¼Œä»¥åŠå¤æ‚çš„ <code>orm.xml</code> æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬è´Ÿè´£åœ°å‘Šè¯‰å¤§å®¶ï¼Œä½¿ç”¨ Spring+Hibernate ä½œä¸º JPA å®ç°ï¼Œæ— éœ€ä»»ä½•é…ç½®æ–‡ä»¶ã€‚</p><p>æ‰€æœ‰ Entity Bean çš„é…ç½®å’Œä¸Šä¸€èŠ‚å®Œå…¨ç›¸åŒï¼Œå…¨éƒ¨é‡‡ç”¨ Annotation æ ‡æ³¨ã€‚æˆ‘ä»¬ç°åœ¨åªéœ€å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡ç±»å¦‚ä½•é€šè¿‡ JPA æ¥å£æ“ä½œæ•°æ®åº“ã€‚</p><p>è¿˜æ˜¯ä»¥ <code>UserService</code> ä¸ºä¾‹ï¼Œé™¤äº†æ ‡æ³¨ <code>@Component</code> å’Œ <code>@Transactional</code> å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥ä¸€ä¸ª <code>EntityManager</code>ï¼Œä½†æ˜¯ä¸è¦ä½¿ç”¨ <code>Autowired</code>ï¼Œè€Œæ˜¯ <code>@PersistenceContext</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@PersistenceContext</span>
    <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ JDBCã€Hibernate å’Œ JPA æä¾›çš„æ¥å£ï¼Œå®é™…ä¸Šï¼Œå®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left;">JDBC</th><th style="text-align:left;">Hibernate</th><th style="text-align:left;">JPA</th></tr></thead><tbody><tr><td style="text-align:left;">DataSource</td><td style="text-align:left;">SessionFactory</td><td style="text-align:left;">EntityManagerFactory</td></tr><tr><td style="text-align:left;">Connection</td><td style="text-align:left;">Session</td><td style="text-align:left;">EntityManager</td></tr></tbody></table><p><code>SessionFactory</code> å’Œ <code>EntityManagerFactory</code> ç›¸å½“äº <code>DataSource</code>ï¼Œ<code>Session</code> å’Œ <code>EntityManager</code> ç›¸å½“äº <code>Connection</code>ã€‚æ¯æ¬¡éœ€è¦è®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦è·å–æ–°çš„ <code>Session</code> å’Œ <code>EntityManager</code>ï¼Œç”¨å®Œåå†å…³é—­ã€‚</p><p>ä½†æ˜¯ï¼Œæ³¨æ„åˆ° <code>UserService</code> æ³¨å…¥çš„ä¸æ˜¯ <code>EntityManagerFactory</code>ï¼Œè€Œæ˜¯ <code>EntityManager</code>ï¼Œå¹¶ä¸”æ ‡æ³¨äº† <code>@PersistenceContext</code>ã€‚éš¾é“ä½¿ç”¨ JPA å¯ä»¥å…è®¸å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª <code>EntityManager</code>ï¼Ÿ</p><p>å®é™…ä¸Šè¿™é‡Œæ³¨å…¥çš„å¹¶ä¸æ˜¯çœŸæ­£çš„ <code>EntityManager</code>ï¼Œè€Œæ˜¯ä¸€ä¸ª <code>EntityManager</code> çš„ä»£ç†ç±»ï¼Œç›¸å½“äºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EntityManagerProxy</span> <span class="token keyword">implements</span> <span class="token class-name">EntityManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">EntityManagerFactory</span> emf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring é‡åˆ°æ ‡æ³¨äº† <code>@PersistenceContext</code> çš„ <code>EntityManager</code> ä¼šè‡ªåŠ¨æ³¨å…¥ä»£ç†ï¼Œè¯¥ä»£ç†ä¼šåœ¨å¿…è¦çš„æ—¶å€™è‡ªåŠ¨æ‰“å¼€ <code>EntityManager</code>ã€‚æ¢å¥è¯è¯´ï¼Œå¤šçº¿ç¨‹å¼•ç”¨çš„ <code>EntityManager</code> è™½ç„¶æ˜¯åŒä¸€ä¸ªä»£ç†ç±»ï¼Œä½†è¯¥ä»£ç†ç±»å†…éƒ¨é’ˆå¯¹ä¸åŒçº¿ç¨‹ä¼šåˆ›å»ºä¸åŒçš„ <code>EntityManager</code> å®ä¾‹ã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œæ ‡æ³¨äº† <code>@PersistenceContext</code> çš„ <code>EntityManager</code> å¯ä»¥è¢«å¤šçº¿ç¨‹å®‰å…¨åœ°å…±äº«ã€‚</p><p>å› æ­¤ï¼Œåœ¨ <code>UserService</code> çš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•é‡Œï¼Œç›´æ¥ä½¿ç”¨ <code>EntityManager</code> å°±å¾ˆæ–¹ä¾¿ã€‚ä»¥ä¸»é”®æŸ¥è¯¢ä¸ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found by id:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ HQL æŸ¥è¯¢ç±»ä¼¼ï¼ŒJPA ä½¿ç”¨ JPQL æŸ¥è¯¢ï¼Œå®ƒçš„è¯­æ³•å’Œ HQL åŸºæœ¬å·®ä¸å¤šï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">fetchUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// JPQL æŸ¥è¯¢:</span>
    <span class="token class-name">TypedQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT u FROM User u WHERE u.email = :e&quot;</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ ·çš„ï¼ŒJPA ä¹Ÿæ”¯æŒ <code>NamedQuery</code>ï¼Œå³å…ˆç»™æŸ¥è¯¢èµ·ä¸ªåå­—ï¼Œå†æŒ‰åå­—åˆ›å»ºæŸ¥è¯¢ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TypedQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createNamedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>NamedQuery</code> é€šè¿‡æ³¨è§£æ ‡æ³¨åœ¨ <code>User</code> ç±»ä¸Šï¼Œå®ƒçš„å®šä¹‰å’Œä¸Šä¸€èŠ‚çš„ <code>User</code> ç±»ä¸€æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@NamedQueries</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@NamedQuery</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span>
        query <span class="token operator">=</span> <span class="token string">&quot;SELECT u FROM User u WHERE u.email=:e AND u.password=:pwd&quot;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹çš„æ“ä½œï¼Œå¯ä»¥åˆ†åˆ«ä½¿ç”¨ <code>persist()</code>ã€<code>remove()</code> å’Œ <code>merge()</code> æ–¹æ³•ï¼Œå‚æ•°å‡ä¸º Entity Bean æœ¬èº«ï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼Œè¿™é‡Œä¸å†å¤šè¿°ã€‚</p><h3 id="ç»ƒä¹ -4" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -4" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4" aria-hidden="true">#</a> å°ç»“</h3><p>åœ¨ Spring ä¸­é›†æˆ JPA è¦é€‰æ‹©ä¸€ä¸ªå®ç°ï¼Œå¯ä»¥é€‰æ‹© Hibernate æˆ– EclipseLinkï¼›</p><p>ä½¿ç”¨ JPA ä¸ Hibernate ç±»ä¼¼ï¼Œä½†æ³¨å…¥çš„æ ¸å¿ƒèµ„æºæ˜¯å¸¦æœ‰ <code>@PersistenceContext</code> æ³¨è§£çš„ <code>EntityManager</code> ä»£ç†ç±»ã€‚</p><h2 id="ğŸ€-é›†æˆ-mybatis" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é›†æˆ-mybatis" aria-hidden="true">#</a> ğŸ€ é›†æˆ MyBatis</h2><p>ä½¿ç”¨ Hibernate æˆ– JPA æ“ä½œæ•°æ®åº“æ—¶ï¼Œè¿™ç±» ORM å¹²çš„ä¸»è¦å·¥ä½œå°±æ˜¯æŠŠ ResultSet çš„æ¯ä¸€è¡Œå˜æˆ Java Beanï¼Œæˆ–è€…æŠŠ Java Bean è‡ªåŠ¨è½¬æ¢åˆ° INSERT æˆ– UPDATE è¯­å¥çš„å‚æ•°ä¸­ï¼Œä»è€Œå®ç° ORMã€‚</p><p>è€Œ ORM æ¡†æ¶ä¹‹æ‰€ä»¥çŸ¥é“å¦‚ä½•æŠŠè¡Œæ•°æ®æ˜ å°„åˆ° Java Beanï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ Java Bean çš„å±æ€§ä¸Šç»™äº†è¶³å¤Ÿçš„æ³¨è§£ä½œä¸ºå…ƒæ•°æ®ï¼ŒORM æ¡†æ¶è·å– Java Bean çš„æ³¨è§£åï¼Œå°±çŸ¥é“å¦‚ä½•è¿›è¡ŒåŒå‘æ˜ å°„ã€‚</p><p>é‚£ä¹ˆï¼ŒORM æ¡†æ¶æ˜¯å¦‚ä½•è·Ÿè¸ª Java Bean çš„ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨ <code>update()</code> æ“ä½œä¸­æ›´æ–°å¿…è¦çš„å±æ€§ï¼Ÿ</p>`,39),dn={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1281319432618017",target:"_blank",rel:"noopener noreferrer"},rn=p(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProxy</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> _isNameChanged<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _isNameChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä»£ç†ç±»å¯ä»¥è·Ÿè¸ªåˆ°æ¯ä¸ªå±æ€§çš„å˜åŒ–ã€‚</p><p>é’ˆå¯¹ä¸€å¯¹å¤šæˆ–å¤šå¯¹ä¸€å…³ç³»æ—¶ï¼Œä»£ç†ç±»å¯ä»¥ç›´æ¥é€šè¿‡ getter æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProxy</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token class-name">Session</span> _session<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> _isNameChanged<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _isNameChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">/</span>
     <span class="token operator">*</span> è·å– <span class="token class-name">User</span> å¯¹è±¡å…³è”çš„ <span class="token class-name">Address</span> å¯¹è±¡<span class="token operator">:</span>
     <span class="token operator">*</span><span class="token operator">/</span>
    <span class="token keyword">public</span> <span class="token class-name">Address</span> <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> q <span class="token operator">=</span> _session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;from Address where userId = :userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        q<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†å®ç°è¿™æ ·çš„æŸ¥è¯¢ï¼ŒUserProxy å¿…é¡»ä¿å­˜ Hibernate çš„å½“å‰ Sessionã€‚ä½†æ˜¯ï¼Œå½“äº‹åŠ¡æäº¤åï¼ŒSession è‡ªåŠ¨å…³é—­ï¼Œæ­¤æ—¶å†è·å– <code>getAddress()</code> å°†æ— æ³•è®¿é—®æ•°æ®åº“ï¼Œæˆ–è€…è·å–çš„ä¸æ˜¯äº‹åŠ¡ä¸€è‡´çš„æ•°æ®ã€‚å› æ­¤ï¼ŒORM æ¡†æ¶æ€»æ˜¯å¼•å…¥äº† Attached/Detached çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰æ­¤ Java Bean åˆ°åº•æ˜¯åœ¨ Session çš„èŒƒå›´å†…ï¼Œè¿˜æ˜¯è„±ç¦»äº† Session å˜æˆäº†ä¸€ä¸ª â€œæ¸¸ç¦»â€ å¯¹è±¡ã€‚å¾ˆå¤šåˆå­¦è€…æ— æ³•æ­£ç¡®ç†è§£çŠ¶æ€å˜åŒ–å’Œäº‹åŠ¡è¾¹ç•Œï¼Œå°±ä¼šé€ æˆå¤§é‡çš„ <code>PersistentObjectException</code> å¼‚å¸¸ã€‚è¿™ç§éšå¼çŠ¶æ€ä½¿å¾—æ™®é€š Java Bean çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¤æ‚ã€‚</p><p>æ­¤å¤–ï¼ŒHibernate å’Œ JPA ä¸ºäº†å®ç°å…¼å®¹å¤šç§æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨ HQL æˆ– JPQL æŸ¥è¯¢ï¼Œç»è¿‡ä¸€é“è½¬æ¢ï¼Œå˜æˆç‰¹å®šæ•°æ®åº“çš„ SQLï¼Œç†è®ºä¸Šè¿™æ ·å¯ä»¥åšåˆ°æ— ç¼åˆ‡æ¢æ•°æ®åº“ï¼Œä½†è¿™ä¸€å±‚è‡ªåŠ¨è½¬æ¢é™¤äº†å°‘è®¸çš„æ€§èƒ½å¼€é”€å¤–ï¼Œç»™ SQL çº§åˆ«çš„ä¼˜åŒ–å¸¦æ¥äº†éº»çƒ¦ã€‚</p><p>æœ€åï¼ŒORM æ¡†æ¶é€šå¸¸æä¾›äº†ç¼“å­˜ï¼Œå¹¶ä¸”è¿˜åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜æ˜¯æŒ‡åœ¨ä¸€ä¸ª Session èŒƒå›´å†…çš„ç¼“å­˜ï¼Œå¸¸è§çš„æƒ…æ™¯æ˜¯æ ¹æ®ä¸»é”®æŸ¥è¯¢æ—¶ï¼Œä¸¤æ¬¡æŸ¥è¯¢å¯ä»¥è¿”å›åŒä¸€å®ä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">User</span> user1 <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">User</span> user2 <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>äºŒçº§ç¼“å­˜æ˜¯æŒ‡è·¨ Session çš„ç¼“å­˜ï¼Œä¸€èˆ¬é»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚äºŒçº§ç¼“å­˜æå¤§çš„å¢åŠ äº†æ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼ŒåŸå› åœ¨äº SQL éå¸¸çµæ´»ï¼Œå¸¸å¸¸ä¼šå¯¼è‡´æ„å¤–çš„æ›´æ–°ã€‚ä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// çº¿ç¨‹ 1 è¯»å–:</span>
<span class="token class-name">User</span> user1 <span class="token operator">=</span> session1<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// ä¸€æ®µæ—¶é—´åï¼Œçº¿ç¨‹ 2 è¯»å–:</span>
<span class="token class-name">User</span> user2 <span class="token operator">=</span> session2<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“äºŒçº§ç¼“å­˜ç”Ÿæ•ˆçš„æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹è¯»å–çš„ User å®ä¾‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ï¼Œæ•°æ®åº“å¯¹åº”çš„è¡Œè®°å½•å®Œå…¨å¯èƒ½è¢«ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- ç»™è€ç”¨æˆ·å¢åŠ  100 ç§¯åˆ†:</span>
<span class="token keyword">UPDATE</span> users <span class="token keyword">SET</span> bonus <span class="token operator">=</span> bonus <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> createdAt <span class="token operator">&lt;=</span> ?
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ORM æ— æ³•åˆ¤æ–­ <code>id=123</code> çš„ç”¨æˆ·æ˜¯å¦å—è¯¥ <code>UPDATE</code> è¯­å¥å½±å“ã€‚è€ƒè™‘åˆ°æ•°æ®åº“é€šå¸¸ä¼šæ”¯æŒå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ­¤ UPDATE è¯­å¥å¯èƒ½ç”±å…¶ä»–è¿›ç¨‹æ‰§è¡Œï¼ŒORM æ¡†æ¶å°±æ›´ä¸çŸ¥é“äº†ã€‚</p><p>æˆ‘ä»¬æŠŠè¿™ç§ ORM æ¡†æ¶ç§°ä¹‹ä¸ºå…¨è‡ªåŠ¨ ORM æ¡†æ¶ã€‚</p><p>å¯¹æ¯” Spring æä¾›çš„ JdbcTemplateï¼Œå®ƒå’Œ ORM æ¡†æ¶ç›¸æ¯”ï¼Œä¸»è¦æœ‰å‡ ç‚¹å·®åˆ«ï¼š</p><ol><li>æŸ¥è¯¢åéœ€è¦æ‰‹åŠ¨æä¾› Mapper å®ä¾‹ä»¥ä¾¿æŠŠ ResultSet çš„æ¯ä¸€è¡Œå˜ä¸º Java å¯¹è±¡ï¼›</li><li>å¢åˆ æ”¹æ“ä½œæ‰€éœ€çš„å‚æ•°åˆ—è¡¨ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥ï¼Œå³æŠŠ User å®ä¾‹å˜ä¸º [user.id, user.name, user.email] è¿™æ ·çš„åˆ—è¡¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</li></ol><p>ä½†æ˜¯ JdbcTemplate çš„ä¼˜åŠ¿åœ¨äºå®ƒçš„ç¡®å®šæ€§ï¼šå³æ¯æ¬¡è¯»å–æ“ä½œä¸€å®šæ˜¯æ•°æ®åº“æ“ä½œè€Œä¸æ˜¯ç¼“å­˜ï¼Œæ‰€æ‰§è¡Œçš„ SQL æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œç¼ºç‚¹å°±æ˜¯ä»£ç æ¯”è¾ƒç¹çï¼Œæ„é€  <code>INSERT INTO users VALUES (?,?,?)</code> æ›´æ˜¯å¤æ‚ã€‚</p>`,17),kn={href:"https://mybatis.org/",target:"_blank",rel:"noopener noreferrer"},vn=p(`<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ Spring ä¸­é›†æˆ MyBatisã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¼•å…¥ MyBatis æœ¬èº«ï¼Œå…¶æ¬¡ï¼Œç”±äº Spring å¹¶æ²¡æœ‰åƒ Hibernate é‚£æ ·å†…ç½®å¯¹ MyBatis çš„é›†æˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å†å¼•å…¥ MyBatis å®˜æ–¹è‡ªå·±å¼€å‘çš„ä¸€ä¸ªä¸ Spring é›†æˆçš„åº“ï¼š</p><ul><li>org.mybatis:mybatis:3.5.11</li><li>org.mybatis:mybatis-spring:3.0.0</li></ul><p>å’Œå‰é¢ä¸€æ ·ï¼Œå…ˆåˆ›å»º <code>DataSource</code> æ˜¯å¿…ä¸å¯å°‘çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†å›é¡¾ä¸€ä¸‹ Hibernate å’Œ JPA çš„ <code>SessionFactory</code> ä¸ <code>EntityManagerFactory</code>ï¼ŒMyBatis ä¸ä¹‹å¯¹åº”çš„æ˜¯ <code>SqlSessionFactory</code> å’Œ <code>SqlSession</code>ï¼š</p><table><thead><tr><th style="text-align:left;">JDBC</th><th style="text-align:left;">Hibernate</th><th style="text-align:left;">JPA</th><th style="text-align:left;">MyBatis</th></tr></thead><tbody><tr><td style="text-align:left;">DataSource</td><td style="text-align:left;">SessionFactory</td><td style="text-align:left;">EntityManagerFactory</td><td style="text-align:left;">SqlSessionFactory</td></tr><tr><td style="text-align:left;">Connection</td><td style="text-align:left;">Session</td><td style="text-align:left;">EntityManager</td><td style="text-align:left;">SqlSession</td></tr></tbody></table><p>å¯è§ï¼ŒORM çš„è®¾è®¡å¥—è·¯éƒ½æ˜¯ç±»ä¼¼çš„ã€‚ä½¿ç”¨ MyBatis çš„æ ¸å¿ƒå°±æ˜¯åˆ›å»º <code>SqlSessionFactory</code>ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æ˜¯ <code>SqlSessionFactoryBean</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">SqlSessionFactoryBean</span> <span class="token function">createSqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sqlSessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlSessionFactoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sqlSessionFactoryBean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º MyBatis å¯ä»¥ç›´æ¥ä½¿ç”¨ Spring ç®¡ç†çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå› æ­¤ï¼Œåˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å’Œä½¿ç”¨ JDBC æ˜¯ä¸€æ ·çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">PlatformTransactionManager</span> <span class="token function">createTxManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å’Œ Hibernate ä¸åŒçš„æ˜¯ï¼ŒMyBatis ä½¿ç”¨ Mapper æ¥å®ç°æ˜ å°„ï¼Œè€Œä¸” Mapper å¿…é¡»æ˜¯æ¥å£ã€‚æˆ‘ä»¬ä»¥ <code>User</code> ç±»ä¸ºä¾‹ï¼Œåœ¨ <code>User</code> ç±»å’Œ <code>users</code> è¡¨ä¹‹é—´æ˜ å°„çš„ <code>UserMapper</code> ç¼–å†™å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id = #{id}&quot;</span><span class="token punctuation">)</span>
	<span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šè¿™é‡Œçš„ Mapper ä¸æ˜¯ <code>JdbcTemplate</code> çš„ <code>RowMapper</code> çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å®šä¹‰è®¿é—® <code>users</code> è¡¨çš„æ¥å£æ–¹æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>User getById(long)</code> çš„ä¸»é”®æŸ¥è¯¢æ–¹æ³•ï¼Œä¸ä»…è¦å®šä¹‰æ¥å£æ–¹æ³•æœ¬èº«ï¼Œè¿˜è¦æ˜ç¡®å†™å‡ºæŸ¥è¯¢çš„ SQLï¼Œè¿™é‡Œç”¨æ³¨è§£ <code>@Select</code> æ ‡è®°ã€‚SQL è¯­å¥çš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¸æ–¹æ³•å‚æ•°æŒ‰åç§°å¯¹åº”ã€‚ä¾‹å¦‚ï¼Œæ–¹æ³•å‚æ•° id çš„åå­—é€šè¿‡æ³¨è§£ <code>@Param()</code> æ ‡è®°ä¸º <code>id</code>ï¼Œåˆ™ SQL è¯­å¥é‡Œå°†æ¥æ›¿æ¢çš„å ä½ç¬¦å°±æ˜¯ <code>#{id}</code>ã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªå‚æ•°å‘½ååç›´æ¥åœ¨ SQL ä¸­å†™å‡ºå¯¹åº”çš„å ä½ç¬¦å³å¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users LIMIT #{offset}, #{maxResults}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;offset&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;maxResults&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> maxResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šMyBatis æ‰§è¡ŒæŸ¥è¯¢åï¼Œå°†æ ¹æ®æ–¹æ³•çš„è¿”å›ç±»å‹è‡ªåŠ¨æŠŠ ResultSet çš„æ¯ä¸€è¡Œè½¬æ¢ä¸º User å®ä¾‹ï¼Œè½¬æ¢è§„åˆ™å½“ç„¶æ˜¯æŒ‰åˆ—åå’Œå±æ€§åå¯¹åº”ã€‚å¦‚æœåˆ—åå’Œå±æ€§åä¸åŒï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ç¼–å†™ SELECT è¯­å¥çš„åˆ«åï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- åˆ—åæ˜¯ created_timeï¼Œå±æ€§åæ˜¯ createdAt:</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> created_time <span class="token keyword">AS</span> createdAt <span class="token keyword">FROM</span> users
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ INSERT è¯­å¥å°±ç¨å¾®éº»çƒ¦ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¼ å…¥ User å®ä¾‹ï¼Œå› æ­¤ï¼Œå®šä¹‰çš„æ–¹æ³•æ¥å£ä¸ <code>@Insert</code> æ³¨è§£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°æ–¹æ³•ä¼ å…¥çš„å‚æ•°åç§°æ˜¯ <code>user</code>ï¼Œå‚æ•°ç±»å‹æ˜¯ User ç±»ï¼Œåœ¨ SQL ä¸­å¼•ç”¨çš„æ—¶å€™ï¼Œä»¥ <code>#{obj.property}</code> çš„æ–¹å¼å†™å ä½ç¬¦ã€‚å’Œ Hibernate è¿™æ ·çš„å…¨è‡ªåŠ¨åŒ– ORM ç›¸æ¯”ï¼ŒMyBatis å¿…é¡»å†™å‡ºå®Œæ•´çš„ INSERT è¯­å¥ã€‚</p><p>å¦‚æœ <code>users</code> è¡¨çš„ <code>id</code> æ˜¯è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨ SQL ä¸­ä¸ä¼ å…¥ <code>id</code>ï¼Œä½†å¸Œæœ›è·å–æ’å…¥åçš„ä¸»é”®ï¼Œéœ€è¦å†åŠ ä¸€ä¸ª <code>@Options</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> keyColumn <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>keyProperty</code> å’Œ <code>keyColumn</code> åˆ†åˆ«æŒ‡å‡º JavaBean çš„å±æ€§å’Œæ•°æ®åº“çš„ä¸»é”®åˆ—åã€‚</p><p>æ‰§è¡Œ <code>UPDATE</code> å’Œ <code>DELETE</code> è¯­å¥ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE users SET name = #{user.name}, createdAt = #{user.createdAt} WHERE id = #{user.id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM users WHERE id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº† <code>UserMapper</code> æ¥å£ï¼Œè¿˜éœ€è¦å¯¹åº”çš„å®ç°ç±»æ‰èƒ½çœŸæ­£æ‰§è¡Œè¿™äº›æ•°æ®åº“æ“ä½œçš„æ–¹æ³•ã€‚è™½ç„¶å¯ä»¥è‡ªå·±å†™å®ç°ç±»ï¼Œä½†æˆ‘ä»¬é™¤äº†ç¼–å†™ <code>UserMapper</code> æ¥å£å¤–ï¼Œè¿˜æœ‰ <code>BookMapper</code>ã€<code>BonusMapper</code>â€¦â€¦ ä¸€ä¸ªä¸€ä¸ªå†™å¤ªéº»çƒ¦ï¼Œå› æ­¤ï¼ŒMyBatis æä¾›äº†ä¸€ä¸ª <code>MapperFactoryBean</code> æ¥è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰ Mapper çš„å®ç°ç±»ã€‚å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æ³¨è§£æ¥å¯ç”¨å®ƒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.itranswarp.learnjava.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> å…¶ä»–æ³¨è§£<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº† <code>@MapperScan</code>ï¼Œå°±å¯ä»¥è®© MyBatis è‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…çš„æ‰€æœ‰ Mapper å¹¶åˆ›å»ºå®ç°ç±»ã€‚åœ¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ³¨å…¥ UserMapper:</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è°ƒç”¨ Mapper æ–¹æ³•:</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found by id.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œä¸šåŠ¡é€»è¾‘ä¸»è¦å°±æ˜¯é€šè¿‡ <code>XxxMapper</code> å®šä¹‰çš„æ•°æ®åº“æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“ã€‚</p><h3 id="xml-é…ç½®" tabindex="-1"><a class="header-anchor" href="#xml-é…ç½®" aria-hidden="true">#</a> XML é…ç½®</h3><p>ä¸Šè¿°åœ¨ Spring ä¸­é›†æˆ MyBatis çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨åˆ°æ³¨è§£ï¼Œå¹¶æ²¡æœ‰ä»»ä½• XML é…ç½®æ–‡ä»¶ã€‚MyBatis ä¹Ÿå…è®¸ä½¿ç”¨ XML é…ç½®æ˜ å°„å…³ç³»å’Œ SQL è¯­å¥ï¼Œä¾‹å¦‚ï¼Œæ›´æ–° <code>User</code> æ—¶æ ¹æ®å±æ€§å€¼æ„é€ åŠ¨æ€ SQLï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  UPDATE users SET
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.name != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> name = #{user.name} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.hobby != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> hobby = #{user.hobby} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.summary != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> summary = #{user.summary} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
  WHERE id = #{user.id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,34),mn={href:"https://mybatis.org/mybatis-3/zh/configuration.html",target:"_blank",rel:"noopener noreferrer"},bn=p(`<p>ä½¿ç”¨ MyBatis æœ€å¤§çš„é—®é¢˜æ˜¯æ‰€æœ‰ SQL éƒ½éœ€è¦å…¨éƒ¨æ‰‹å†™ï¼Œä¼˜ç‚¹æ˜¯æ‰§è¡Œçš„ SQL å°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ SQLï¼Œå¯¹ SQL è¿›è¡Œä¼˜åŒ–éå¸¸ç®€å•ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä»»æ„å¤æ‚çš„ SQLï¼Œæˆ–è€…ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šè¯­æ³•ï¼Œä½†åˆ‡æ¢æ•°æ®åº“å¯èƒ½å°±ä¸å¤ªå®¹æ˜“ã€‚å¥½æ¶ˆæ¯æ˜¯å¤§éƒ¨åˆ†é¡¹ç›®å¹¶æ²¡æœ‰åˆ‡æ¢æ•°æ®åº“çš„éœ€æ±‚ï¼Œå®Œå…¨å¯ä»¥é’ˆå¯¹æŸä¸ªæ•°æ®åº“ç¼–å†™å°½å¯èƒ½ä¼˜åŒ–çš„ SQLã€‚</p><h3 id="ç»ƒä¹ -5" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -5" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-5" tabindex="-1"><a class="header-anchor" href="#å°ç»“-5" aria-hidden="true">#</a> å°ç»“</h3><p>MyBatis æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–çš„ ORM æ¡†æ¶ï¼Œéœ€è¦æ‰‹å†™ SQL è¯­å¥ï¼Œæ²¡æœ‰è‡ªåŠ¨åŠ è½½ä¸€å¯¹å¤šæˆ–å¤šå¯¹ä¸€å…³ç³»çš„åŠŸèƒ½ã€‚</p><h2 id="ğŸ€-è®¾è®¡-orm" tabindex="-1"><a class="header-anchor" href="#ğŸ€-è®¾è®¡-orm" aria-hidden="true">#</a> ğŸ€ è®¾è®¡ ORM</h2><p>æˆ‘ä»¬ä»å‰å‡ èŠ‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“ ORMï¼Œä¹Ÿæ˜¯å»ºç«‹åœ¨ JDBC çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ ResultSet åˆ° JavaBean çš„æ˜ å°„ï¼Œå®ç°å„ç§æŸ¥è¯¢ã€‚æœ‰è‡ªåŠ¨è·Ÿè¸ª Entity ä¿®æ”¹çš„å…¨è‡ªåŠ¨åŒ– ORM å¦‚ Hibernate å’Œ JPAï¼Œéœ€è¦ä¸ºæ¯ä¸ª Entity åˆ›å»ºä»£ç†ï¼Œä¹Ÿæœ‰å®Œå…¨è‡ªå·±æ˜ å°„ï¼Œè¿ INSERT å’Œ UPDATE è¯­å¥éƒ½éœ€è¦æ‰‹åŠ¨ç¼–å†™çš„ MyBatisï¼Œä½†æ²¡æœ‰ä»»ä½•é€æ˜çš„ Proxyã€‚</p><p>è€ŒæŸ¥è¯¢æ˜¯æ¶‰åŠåˆ°æ•°æ®åº“ä½¿ç”¨æœ€å¹¿æ³›çš„æ“ä½œï¼Œéœ€è¦æœ€å¤§çš„çµæ´»æ€§ã€‚å„ç§ ORM è§£å†³æ–¹æ¡ˆå„ä¸ç›¸åŒï¼ŒHibernate å’Œ JPA è‡ªå·±å®ç°äº† HQL å’Œ JPQL æŸ¥è¯¢è¯­æ³•ï¼Œç”¨ä»¥ç”Ÿæˆæœ€ç»ˆçš„ SQLï¼Œè€Œ MyBatis åˆ™å®Œå…¨æ‰‹å†™ï¼Œæ¯å¢åŠ ä¸€ä¸ªæŸ¥è¯¢éƒ½éœ€è¦å…ˆç¼–å†™ SQL å¹¶å¢åŠ æ¥å£æ–¹æ³•ã€‚</p><p>è¿˜æœ‰ä¸€ç§ Hibernate å’Œ JPA æ”¯æŒçš„ Criteria æŸ¥è¯¢ï¼Œç”¨ Hibernate å†™å‡ºæ¥ç±»ä¼¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DetachedCriteria</span> criteria <span class="token operator">=</span> <span class="token class-name">DetachedCriteria</span><span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> hibernateTemplate<span class="token punctuation">.</span><span class="token function">findByCriteria</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿° Criteria æŸ¥è¯¢å†™æ³•å¤æ‚ï¼Œä½†å’Œ JPA ç›¸æ¯”ï¼Œè¿˜æ˜¯å°å·«è§å¤§å·«äº†ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> cb <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> q <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cb<span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TypedQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œæ˜¯å¦æ”¯æŒè‡ªåŠ¨è¯»å–ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€å…³ç³»ä¹Ÿæ˜¯å…¨è‡ªåŠ¨åŒ– ORM æ¡†æ¶çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½ã€‚</p><p>å¦‚æœæˆ‘ä»¬è‡ªå·±æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ª ORMï¼Œåº”è¯¥å¸å–è¿™äº› ORM çš„å“ªäº›ç‰¹è‰²ï¼Œç„¶åé«˜æ•ˆå®ç°å‘¢ï¼Ÿ</p><h3 id="è®¾è®¡-orm-æ¥å£" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡-orm-æ¥å£" aria-hidden="true">#</a> è®¾è®¡ ORM æ¥å£</h3><p>ä»»ä½•è®¾è®¡ï¼Œéƒ½å¿…é¡»æ˜ç¡®è®¾è®¡ç›®æ ‡ã€‚è¿™é‡Œæˆ‘ä»¬å‡†å¤‡å®ç°çš„ ORM å¹¶ä¸æƒ³è¦å…¨è‡ªåŠ¨ ORM é‚£ç§è‡ªåŠ¨è¯»å–ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€å…³ç³»çš„åŠŸèƒ½ï¼Œä¹Ÿä¸æƒ³ç»™ Entity åŠ ä¸Šå¤æ‚çš„çŠ¶æ€ï¼Œå› æ­¤ï¼Œå¯¹äº Entity æ¥è¯´ï¼Œå®ƒå°±æ˜¯çº¯ç²¹çš„ JavaBeanï¼Œæ²¡æœ‰ä»»ä½• Proxyã€‚</p><p>æ­¤å¤–ï¼ŒORM è¦å…¼é¡¾æ˜“ç”¨æ€§å’Œé€‚ç”¨æ€§ã€‚æ˜“ç”¨æ€§æ˜¯æŒ‡èƒ½è¦†ç›– 95% çš„åº”ç”¨åœºæ™¯ï¼Œä½†æ€»æœ‰ä¸€äº›å¤æ‚çš„ SQLï¼Œå¾ˆéš¾ç”¨ ORM å»è‡ªåŠ¨ç”Ÿæˆï¼Œå› æ­¤ï¼Œä¹Ÿè¦ç»™å‡ºåŸç”Ÿçš„ JDBC æ¥å£ï¼Œèƒ½æ”¯æŒ 5% çš„ç‰¹æ®Šéœ€æ±‚ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›è®¾è®¡çš„æ¥å£è¦æ˜“äºç¼–å†™ï¼Œå¹¶ä½¿ç”¨æµå¼ API ä¾¿äºé˜…è¯»ã€‚ä¸ºäº†é…åˆç¼–è¯‘å™¨æ£€æŸ¥ï¼Œè¿˜åº”è¯¥æ”¯æŒæ³›å‹ï¼Œé¿å…å¼ºåˆ¶è½¬å‹ã€‚</p><p>ä»¥ User ç±»ä¸ºä¾‹ï¼Œæˆ‘ä»¬è®¾è®¡çš„æŸ¥è¯¢æ¥å£å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æŒ‰ä¸»é”®æŸ¥è¯¢: SELECT * FROM users WHERE id = ?</span>
<span class="token class-name">User</span> u <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ¡ä»¶æŸ¥è¯¢å”¯ä¸€è®°å½•: SELECT * FROM users WHERE email = ? AND password = ?</span>
<span class="token class-name">User</span> u <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;email=? AND password=?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob123&quot;</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ¡ä»¶æŸ¥è¯¢å¤šæ¡è®°å½•: SELECT * FROM users WHERE id &lt; ? ORDER BY email LIMIT ?, ?</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> us <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id &lt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æŸ¥è¯¢ç‰¹å®šåˆ—: SELECT id, name FROM users WHERE email = ?</span>
<span class="token class-name">User</span> u <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;email = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·çš„æµå¼ API ä¾¿äºé˜…è¯»ï¼Œä¹Ÿéå¸¸å®¹æ˜“æ¨å¯¼å‡ºæœ€ç»ˆç”Ÿæˆçš„ SQLã€‚</p><p>å¯¹äºæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå°±ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ’å…¥ User:</span>
db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æŒ‰ä¸»é”®æ›´æ–°æ›´æ–° User:</span>
db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æŒ‰ä¸»é”®åˆ é™¤ User:</span>
db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äº Entity æ¥è¯´ï¼Œé€šå¸¸ä¸€ä¸ªè¡¨å¯¹åº”ä¸€ä¸ªã€‚æ‰‹åŠ¨åˆ—å‡ºæ‰€æœ‰ Entity æ˜¯éå¸¸éº»çƒ¦çš„ï¼Œä¸€å®šè¦ä¼ å…¥ package è‡ªåŠ¨æ‰«æã€‚</p><p>æœ€åï¼ŒORM æ€»æ˜¯éœ€è¦å…ƒæ•°æ®æ‰èƒ½çŸ¥é“å¦‚ä½•æ˜ å°„ã€‚æˆ‘ä»¬ä¸æƒ³ç¼–å†™å¤æ‚çš„ XML é…ç½®ï¼Œä¹Ÿæ²¡å¿…è¦è‡ªå·±å»å®šä¹‰ä¸€å¥—è§„åˆ™ï¼Œç›´æ¥ä½¿ç”¨ JPA çš„æ³¨è§£å°±è¡Œã€‚</p><h3 id="å®ç°-orm" tabindex="-1"><a class="header-anchor" href="#å®ç°-orm" aria-hidden="true">#</a> å®ç° ORM</h3><p>æˆ‘ä»¬å¹¶ä¸éœ€è¦ä» JDBC åº•å±‚å¼€å§‹ç¼–å†™ï¼Œå¹¶ä¸”ï¼Œè¿˜è¦è€ƒè™‘åˆ°äº‹åŠ¡ï¼Œæœ€å¥½èƒ½ç›´æ¥ä½¿ç”¨ Spring çš„å£°æ˜å¼äº‹åŠ¡ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå…¨å±€ <code>DbTemplate</code>ï¼Œå®ƒæ³¨å…¥äº† Spring çš„ <code>JdbcTemplate</code>ï¼Œæ¶‰åŠåˆ°æ•°æ®åº“æ“ä½œæ—¶ï¼Œå…¨éƒ¨é€šè¿‡ <code>JdbcTemplate</code> å®Œæˆï¼Œè‡ªç„¶å¤©ç”Ÿæ”¯æŒ Spring çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå› ä¸ºè¿™ä¸ª ORM åªæ˜¯åœ¨ <code>JdbcTemplate</code> çš„åŸºç¡€ä¸Šåšäº†ä¸€å±‚å°è£…ã€‚</p><p>åœ¨ <code>AppConfig</code> ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–æ‰€æœ‰ Bean å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">JdbcTemplate</span> <span class="token function">createJdbcTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DbTemplate</span> <span class="token function">createDbTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DbTemplate</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">,</span> <span class="token string">&quot;com.itranswarp.learnjava.entity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">PlatformTransactionManager</span> <span class="token function">createTxManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æ‰€éœ€çš„æ‰€æœ‰é…ç½®ã€‚</p><p>ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ <code>UserService</code>ï¼Œå†™å‡ºæ¥åƒè¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">DbTemplate</span> db<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;email = ?&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> pageSize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setCreatedAt</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç»™å‡ºäº† ORM çš„æ¥å£ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ä½¿ç”¨ ORMã€‚ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯å¦‚ä½•å®ç°è¿™ä¸ª <code>DbTemplate</code>ã€‚è¿™é‡Œæˆ‘ä»¬åªç»™å‡ºæ¡†æ¶ä»£ç ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªå·±å®ç°æ ¸å¿ƒä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbTemplate</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token comment">// ä¿å­˜ Entity Class åˆ° Mapper çš„æ˜ å°„:</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> classMapping<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapper <span class="token operator">=</span> <span class="token function">getMapper</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span>selectSQL<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span> mapper<span class="token punctuation">.</span>rowMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">T</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°é“¾å¼ API çš„æ ¸å¿ƒä»£ç æ˜¯ç¬¬ä¸€æ­¥ä» <code>DbTemplate</code> è°ƒç”¨ <code>select()</code> æˆ– <code>from()</code> æ—¶å®ä¾‹åŒ–ä¸€ä¸ª <code>CriteriaQuery</code> å®ä¾‹ï¼Œå¹¶åœ¨åç»­çš„é“¾å¼è°ƒç”¨ä¸­è®¾ç½®å®ƒçš„å­—æ®µï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbTemplate</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token class-name">Select</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> selectFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Select</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> selectFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">From</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entityClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapper <span class="token operator">=</span> <span class="token function">getMapper</span><span class="token punctuation">(</span>entityClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">From</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä»¥æ­¤å®šä¹‰ <code>Select</code>ã€<code>From</code>ã€<code>Where</code>ã€<code>OrderBy</code>ã€<code>Limit</code> ç­‰ã€‚åœ¨ <code>From</code> ä¸­å¯ä»¥è®¾ç½® Class ç±»å‹ã€è¡¨åç­‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">From</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">From</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> criteria<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// from å¯ä»¥è®¾ç½® classã€tableName:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>mapper <span class="token operator">=</span> mapper<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>clazz <span class="token operator">=</span> mapper<span class="token punctuation">.</span>entityClass<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>table <span class="token operator">=</span> mapper<span class="token punctuation">.</span>tableName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Where</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">where</span><span class="token punctuation">(</span><span class="token class-name">String</span> clause<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Where</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">,</span> clause<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>Where</code> ä¸­å¯ä»¥è®¾ç½®æ¡ä»¶å‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Where</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Where</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> criteria<span class="token punctuation">,</span> <span class="token class-name">String</span> clause<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>where <span class="token operator">=</span> clause<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>whereParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// add:</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> param <span class="token operator">:</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>criteria<span class="token punctuation">.</span>whereParams<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œé“¾å¼è°ƒç”¨çš„å°½å¤´æ˜¯è°ƒç”¨ <code>list()</code> è¿”å›ä¸€ç»„ç»“æœï¼Œè°ƒç”¨ <code>unique()</code> è¿”å›å”¯ä¸€ç»“æœï¼Œè°ƒç”¨ <code>first()</code> è¿”å›é¦–ä¸ªç»“æœã€‚</p><p>åœ¨ IDE ä¸­ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°é“¾å¼è°ƒç”¨ï¼š</p><figure><img src="`+r+'" alt="warpdb" tabindex="0" loading="lazy"><figcaption>warpdb</figcaption></figure><p>éœ€è¦å¤æ‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ€»æ˜¯å¯ä»¥ä½¿ç”¨ <code>JdbcTemplate</code> æ‰§è¡Œä»»æ„å¤æ‚çš„ SQLã€‚</p><h3 id="ç»ƒä¹ -6" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -6" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-6" tabindex="-1"><a class="header-anchor" href="#å°ç»“-6" aria-hidden="true">#</a> å°ç»“</h3><p>ORM æ¡†æ¶å°±æ˜¯è‡ªåŠ¨æ˜ å°„æ•°æ®åº“è¡¨ç»“æ„åˆ° JavaBean çš„å·¥å…·ï¼Œè®¾è®¡å¹¶å®ç°ä¸€ä¸ªç®€å•é«˜æ•ˆçš„ ORM æ¡†æ¶å¹¶ä¸å›°éš¾ã€‚</p>',46);function gn(yn,wn){const t=l("router-link"),o=l("ExternalLinkIcon"),c=l("RouterLink");return u(),d("div",null,[s("details",v,[m,s("nav",b,[s("ul",null,[s("li",null,[a(t,{to:"#ğŸ€-ä½¿ç”¨-jdbc"},{default:e(()=>[n("ğŸ€ ä½¿ç”¨ JDBC")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#jdbctemplate-ç”¨æ³•"},{default:e(()=>[n("JdbcTemplate ç”¨æ³•")]),_:1})]),s("li",null,[a(t,{to:"#ç»ƒä¹ "},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡"},{default:e(()=>[n("ğŸ€ ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#å›æ»šäº‹åŠ¡"},{default:e(()=>[n("å›æ»šäº‹åŠ¡")]),_:1})]),s("li",null,[a(t,{to:"#äº‹åŠ¡è¾¹ç•Œ"},{default:e(()=>[n("äº‹åŠ¡è¾¹ç•Œ")]),_:1})]),s("li",null,[a(t,{to:"#äº‹åŠ¡ä¼ æ’­"},{default:e(()=>[n("äº‹åŠ¡ä¼ æ’­")]),_:1})]),s("li",null,[a(t,{to:"#ç»ƒä¹ -1"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-1"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-ä½¿ç”¨-dao"},{default:e(()=>[n("ğŸ€ ä½¿ç”¨ DAO")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#ç»ƒä¹ -2"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-2"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-é›†æˆ-hibernate"},{default:e(()=>[n("ğŸ€ é›†æˆ Hibernate")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#insert-æ“ä½œ"},{default:e(()=>[n("Insert æ“ä½œ")]),_:1})]),s("li",null,[a(t,{to:"#delete-æ“ä½œ"},{default:e(()=>[n("Delete æ“ä½œ")]),_:1})]),s("li",null,[a(t,{to:"#update-æ“ä½œ"},{default:e(()=>[n("Update æ“ä½œ")]),_:1})]),s("li",null,[a(t,{to:"#ä½¿ç”¨-hql-æŸ¥è¯¢"},{default:e(()=>[n("ä½¿ç”¨ HQL æŸ¥è¯¢")]),_:1})]),s("li",null,[a(t,{to:"#ç»ƒä¹ -3"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-3"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-é›†æˆ-jpa"},{default:e(()=>[n("ğŸ€ é›†æˆ JPA")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#ç»ƒä¹ -4"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-4"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-é›†æˆ-mybatis"},{default:e(()=>[n("ğŸ€ é›†æˆ MyBatis")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#xml-é…ç½®"},{default:e(()=>[n("XML é…ç½®")]),_:1})]),s("li",null,[a(t,{to:"#ç»ƒä¹ -5"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-5"},{default:e(()=>[n("å°ç»“")]),_:1})])])]),s("li",null,[a(t,{to:"#ğŸ€-è®¾è®¡-orm"},{default:e(()=>[n("ğŸ€ è®¾è®¡ ORM")]),_:1}),s("ul",null,[s("li",null,[a(t,{to:"#è®¾è®¡-orm-æ¥å£"},{default:e(()=>[n("è®¾è®¡ ORM æ¥å£")]),_:1})]),s("li",null,[a(t,{to:"#å®ç°-orm"},{default:e(()=>[n("å®ç° ORM")]),_:1})]),s("li",null,[a(t,{to:"#ç»ƒä¹ -6"},{default:e(()=>[n("ç»ƒä¹ ")]),_:1})]),s("li",null,[a(t,{to:"#å°ç»“-6"},{default:e(()=>[n("å°ç»“")]),_:1})])])])])])]),g,s("p",null,[n("æˆ‘ä»¬åœ¨å‰é¢ä»‹ç» "),s("a",y,[n("JDBC ç¼–ç¨‹"),a(o)]),n(" æ—¶å·²ç»è®²è¿‡ï¼ŒJava ç¨‹åºä½¿ç”¨ JDBC æ¥å£è®¿é—®å…³ç³»æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š")]),w,s("p",null,[n("åœ¨ Spring ä½¿ç”¨ JDBCï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡ IoC å®¹å™¨åˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ª "),f,n(" å®ä¾‹ï¼Œç„¶åï¼ŒSpring æä¾›äº†ä¸€ä¸ª "),h,n("ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®©æˆ‘ä»¬æ“ä½œ JDBCï¼Œå› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå®ä¾‹åŒ–ä¸€ä¸ª "),S,n("ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç±»ä¸»è¦ä½¿ç”¨äº† "),s("a",q,[n("Template æ¨¡å¼"),a(o)]),n("ã€‚")]),s("p",null,[n("ç¼–å†™ç¤ºä¾‹ä»£ç æˆ–è€…æµ‹è¯•ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èä½¿ç”¨ "),s("a",j,[n("HSQLDB"),a(o)]),n(" è¿™ä¸ªæ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨ Java ç¼–å†™çš„å…³ç³»æ•°æ®åº“ï¼Œå¯ä»¥ä»¥å†…å­˜æ¨¡å¼æˆ–è€…æ–‡ä»¶æ¨¡å¼è¿è¡Œï¼Œæœ¬èº«åªæœ‰ä¸€ä¸ª jar åŒ…ï¼Œéå¸¸é€‚åˆæ¼”ç¤ºä»£ç æˆ–è€…æµ‹è¯•ä»£ç ã€‚")]),T,s("p",null,[n("ä½¿ç”¨ Spring æ“ä½œ JDBC è™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å‰é¢è®¨è®º JDBC çš„æ—¶å€™ï¼Œè®²åˆ°è¿‡ "),s("a",E,[n("JDBC äº‹åŠ¡"),a(o)]),n("ï¼Œå¦‚æœè¦åœ¨ Spring ä¸­æ“ä½œäº‹åŠ¡ï¼Œæ²¡å¿…è¦æ‰‹å†™ JDBC äº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ Spring æä¾›çš„é«˜çº§æ¥å£æ¥æ“ä½œäº‹åŠ¡ã€‚")]),B,s("p",null,[n("æˆ‘ä»¬ "),a(c,{to:"/1-Java/17_JDBC%E7%BC%96%E7%A8%8B/4.html"},{default:e(()=>[n("åœ¨ JDBC ä¸­ä½¿ç”¨äº‹åŠ¡")]),_:1}),n(" çš„æ—¶å€™ï¼Œæ˜¯è¿™ä¹ˆä¸ªå†™æ³•ï¼š")]),x,s("p",null,[n("ç­”æ¡ˆæ˜¯ "),a(c,{to:"/1-Java/13_%E5%A4%9A%E7%BA%BF%E7%A8%8B/22.html"},{default:e(()=>[n("ä½¿ç”¨ ThreadLocal")]),_:1}),n("ã€‚Spring æ€»æ˜¯æŠŠ JDBC ç›¸å…³çš„ "),U,n(" å’Œ "),C,n(" å®ä¾‹ç»‘å®šåˆ° "),M,n("ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä» "),A,n(" æœªå–åˆ°äº‹åŠ¡ï¼Œé‚£ä¹ˆå®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„ JDBC è¿æ¥ï¼ŒåŒæ—¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦åˆ™ï¼Œå®ƒå°±ç›´æ¥ä½¿ç”¨ä» "),J,n(" è·å–çš„ JDBC è¿æ¥ä»¥åŠ "),R,n("ã€‚")]),L,s("p",null,[n("ä½¿ç”¨ "),_,n(" é…åˆ "),D,n(" å¯ä»¥çœ‹ä½œæ˜¯æœ€åŸå§‹çš„ ORMã€‚å¦‚æœè¦å®ç°æ›´è‡ªåŠ¨åŒ–çš„ ORMï¼Œå¯ä»¥é€‰æ‹©æˆç†Ÿçš„ ORM æ¡†æ¶ï¼Œä¾‹å¦‚ "),s("a",P,[n("Hibernate"),a(o)]),n("ã€‚")]),O,s("p",null,[n("æ³¨æ„æˆ‘ä»¬åœ¨ "),a(c,{to:"/1-Java/21_Spring%E5%BC%80%E5%8F%91/1.html#%E5%AE%9A%E5%88%B6-Bean"},{default:e(()=>[n("å®šåˆ¶ Bean")]),_:1}),n(" ä¸­è®²åˆ°è¿‡ "),H,n("ï¼Œ"),I,n(" æ˜¯ä¸€ä¸ª "),F,n("ï¼Œå®ƒä¼šå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª "),N,n("ï¼Œåœ¨ Hibernate ä¸­ï¼Œ"),Q,n(" æ˜¯å°è£…äº†ä¸€ä¸ª JDBC "),W,n(" çš„å®ä¾‹ï¼Œè€Œ "),V,n(" æ˜¯å°è£…äº† JDBC "),z,n(" çš„å®ä¾‹ï¼Œå³ "),G,n(" æŒæœ‰è¿æ¥æ± ï¼Œæ¯æ¬¡éœ€è¦æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œ"),X,n(" åˆ›å»ºä¸€ä¸ªæ–°çš„ "),K,n("ï¼Œç›¸å½“äºä»è¿æ¥æ± è·å–åˆ°ä¸€ä¸ªæ–°çš„ "),Y,n("ã€‚"),$,n(" å°±æ˜¯ Hibernate æä¾›çš„æœ€æ ¸å¿ƒçš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½† "),Z,n(" æ˜¯ Spring æä¾›çš„ä¸ºäº†è®©æˆ‘ä»¬æ–¹ä¾¿åˆ›å»º "),nn,n(" çš„ç±»ã€‚")]),s("p",null,[n("æ³¨æ„åˆ°ä¸Šé¢åˆ›å»º "),sn,n(" çš„ä»£ç ï¼Œé¦–å…ˆç”¨ "),an,n(" æŒæœ‰ Hibernate åˆå§‹åŒ– "),en,n(" æ—¶ç”¨åˆ°çš„æ‰€æœ‰è®¾ç½®ï¼Œå¸¸ç”¨çš„è®¾ç½®è¯·å‚è€ƒ "),s("a",tn,[n("Hibernate æ–‡æ¡£"),a(o)]),n("ï¼Œè¿™é‡Œæˆ‘ä»¬åªå®šä¹‰äº† 3 ä¸ªè®¾ç½®ï¼š")]),pn,s("p",null,[n("å’Œ SQL ç›¸æ¯”ï¼ŒHQL ä½¿ç”¨ç±»åå’Œå±æ€§åï¼Œç”± Hibernate è‡ªåŠ¨è½¬æ¢ä¸ºå®é™…çš„è¡¨åå’Œåˆ—åã€‚è¯¦ç»†çš„ HQL è¯­æ³•å¯ä»¥å‚è€ƒ "),s("a",on,[n("Hibernate æ–‡æ¡£"),a(o)]),n("ã€‚")]),cn,s("p",null,[n("æˆ‘ä»¬ä½¿ç”¨ JPA æ—¶ä¹Ÿå®Œå…¨å¯ä»¥é€‰æ‹© Hibernate ä½œä¸ºåº•å±‚å®ç°ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒçš„ JPA æä¾›æ–¹ï¼Œæ¯”å¦‚ "),s("a",ln,[n("EclipseLink"),a(o)]),n("ã€‚Spring å†…ç½®äº† JPA çš„é›†æˆï¼Œå¹¶æ”¯æŒé€‰æ‹© Hibernate æˆ– EclipseLink ä½œä¸ºå®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä»ç„¶ä»¥ä¸»æµçš„ Hibernate ä½œä¸º JPA å®ç°ä¸ºä¾‹å­ï¼Œæ¼”ç¤º JPA çš„åŸºæœ¬ç”¨æ³•ã€‚")]),un,s("p",null,[n("ç­”æ¡ˆæ˜¯ä½¿ç”¨ "),s("a",dn,[n("Proxy æ¨¡å¼"),a(o)]),n("ï¼Œä» ORM æ¡†æ¶è¯»å–çš„ User å®ä¾‹å®é™…ä¸Šå¹¶ä¸æ˜¯ User ç±»ï¼Œè€Œæ˜¯ä»£ç†ç±»ï¼Œä»£ç†ç±»ç»§æ‰¿è‡ª User ç±»ï¼Œä½†é’ˆå¯¹æ¯ä¸ª setter æ–¹æ³•åšäº†è¦†å†™ï¼š")]),rn,s("p",null,[n("æ‰€ä»¥ï¼Œä»‹äºå…¨è‡ªåŠ¨ ORM å¦‚ Hibernate å’Œæ‰‹å†™å…¨éƒ¨å¦‚ JdbcTemplate ä¹‹é—´ï¼Œè¿˜æœ‰ä¸€ç§åŠè‡ªåŠ¨çš„ ORMï¼Œå®ƒåªè´Ÿè´£æŠŠ ResultSet è‡ªåŠ¨æ˜ å°„åˆ° Java Beanï¼Œæˆ–è€…è‡ªåŠ¨å¡«å…… Java Bean å‚æ•°ï¼Œä½†ä»éœ€è‡ªå·±å†™å‡º SQLã€‚"),s("a",kn,[n("MyBatis"),a(o)]),n(" å°±æ˜¯è¿™æ ·ä¸€ç§åŠè‡ªåŠ¨åŒ– ORM æ¡†æ¶ã€‚")]),vn,s("p",null,[n("ç¼–å†™ XML é…ç½®çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç»„è£…å‡ºåŠ¨æ€ SQLï¼Œå¹¶ä¸”æŠŠæ‰€æœ‰ SQL æ“ä½œé›†ä¸­åœ¨ä¸€èµ·ã€‚ç¼ºç‚¹æ˜¯é…ç½®èµ·æ¥å¤ªç¹çï¼Œè°ƒç”¨æ–¹æ³•æ—¶å¦‚æœæƒ³æŸ¥çœ‹ SQL è¿˜éœ€è¦å®šä½åˆ° XML é…ç½®ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ä»‹ç» XML çš„é…ç½®æ–¹å¼ï¼Œéœ€è¦äº†è§£çš„ç«¥é‹è¯·è‡ªè¡Œé˜…è¯» "),s("a",mn,[n("å®˜æ–¹æ–‡æ¡£"),a(o)]),n("ã€‚")]),bn])}const Sn=i(k,[["render",gn],["__file","3.html.vue"]]);export{Sn as default};
