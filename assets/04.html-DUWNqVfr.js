import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,d as e}from"./app-CvlAI_tu.js";const t={},i=e(`<h1 id="systemctl-é’ˆå¯¹-timer-çš„é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#systemctl-é’ˆå¯¹-timer-çš„é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> systemctl é’ˆå¯¹ timer çš„é…ç½®æ–‡ä»¶</h1><p>æŸäº›æ—¶å€™éœ€è¦å®šæœŸæ‰§è¡ŒæŸé¡¹å·¥ä½œï¼Œæˆ–åˆ™æ˜¯å¼€æœºåæ‰§è¡Œï¼Œæˆ–åˆ™æ˜¯æŸæœåŠ¡å¯åŠ¨å¤šä¹…åæ‰§è¡Œç­‰ç­‰çš„éœ€æ±‚ã€‚åœ¨ä»¥å‰å¯ä»¥ä½¿ç”¨ crond æ¥å®šæœŸå¤„ç†ï¼Œå¦‚ä»Šæœ‰ systemd è¿™ä¸ªé•¿æœŸé©»ç•™åœ¨å†…å­˜ä¸­å¥½ç”¨çš„æœåŠ¡ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€ä¸ªååŠ›æœåŠ¡ timers.target ï¼Œå®ƒå¯ä»¥ååŠ©å®šæœŸå¤„ç†å„ç§ä»»åŠ¡</p><h2 id="ğŸ€-systemd-timer-çš„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ğŸ€-systemd-timer-çš„ä¼˜åŠ¿" aria-hidden="true">#</a> ğŸ€ systemd.timer çš„ä¼˜åŠ¿</h2><p>åœ¨ archlinux çš„å®˜ç½‘ wiki ä¸Šæœ‰æåˆ°ï¼Œä¸ºå•¥è¦ç”¨ systemd.timer ?</p><ul><li>ç”±äºæ‰€æœ‰çš„ systemd çš„æœåŠ¡äº§ç”Ÿçš„ä¿¡æ¯éƒ½ä¼šè¢«è®°å½•ï¼ˆlogï¼‰ï¼Œå› æ­¤æ¯” crond åœ¨ debug ä¸Šè¦æ›´æ¸…æ¥šæ–¹ä¾¿</li><li>å„é¡¹ timer çš„å·¥ä½œå¯ä»¥è·Ÿ systemd çš„æœåŠ¡ç›¸ç»“åˆ</li><li>å„é¡¹ timer çš„å·¥ä½œå¯ä»¥è·Ÿ control groupï¼ˆcgroup ç”¨æ¥å–ä»£ /etc/secure/limit.conf çš„åŠŸèƒ½ï¼‰ç»“åˆï¼Œæ¥é™åˆ¶è¯¥å·¥ä½œçš„èµ„æºåˆ©ç”¨</li><li>æ—¶é—´å®‰æ’å¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’çš„å•ä½</li></ul><p>å¼±ç‚¹å°±æ˜¯ï¼šæ²¡æœ‰ email é€šçŸ¥åŠŸèƒ½ï¼ˆé™¤éè‡ªå·±å®ç° email é€šçŸ¥ï¼‰ï¼Œä¹Ÿæ²¡æœ‰ç±»ä¼¼ anacron ä¸€æ®µæ—¶é—´å†…çš„éšæœºå–æ ·åŠŸèƒ½ï¼ˆrandom_delayï¼‰</p><h2 id="ğŸ€-ä»»åŠ¡éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä»»åŠ¡éœ€æ±‚" aria-hidden="true">#</a> ğŸ€ ä»»åŠ¡éœ€æ±‚</h2><p>æƒ³è¦ç”¨ systemd çš„ timer åŠŸèƒ½ï¼Œå¿…é¡»æœ‰å¦‚ä¸‹æ¡ä»¶ï¼š</p><ul><li>ç³»ç»Ÿçš„ timer.target å¿…é¡»å¯åŠ¨</li><li>è¦æœ‰ sname.service çš„æœåŠ¡å­˜åœ¨ï¼šsname æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„åç§°</li><li>è¦æœ‰ sname.timer çš„æ—¶é—´å¯åŠ¨æœåŠ¡å­˜åœ¨</li></ul><p>ä½¿ç”¨å‰ä¸€å°èŠ‚å†™å¥½çš„ backup.service æ¥æµ‹è¯•</p><h2 id="ğŸ€-sname-timer-çš„è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ€-sname-timer-çš„è®¾ç½®" aria-hidden="true">#</a> ğŸ€ sname.timer çš„è®¾ç½®</h2><p><code>[Timer]</code> éƒ¨åˆ†</p><ul><li><p>OnActiveSecï¼šå½“ timers.target å¯åŠ¨å¤šä¹…åæ‰æ‰§è¡Œè¯¥ unit</p></li><li><p>OnBootSecï¼šå½“å¼€æœºåå¤šä¹…ä¹‹åæ‰æ‰§è¡Œ</p></li><li><p>OnStartupSecï¼šå½“ systemd ç¬¬ä¸€æ¬¡å¯åŠ¨åå¤šä¹…æ‰æ‰§è¡Œ</p></li><li><p>OnUnitActiveSecï¼šè¿™ä¸ª timer é…ç½®æ–‡ä»¶æ‰€ç®¡ç†çš„é‚£ä¸ª unit æœåŠ¡åœ¨æœ€åä¸€æ¬¡å¯åŠ¨åï¼Œç›¸éš”å¤šä¹…åå†æ‰§è¡Œä¸€æ¬¡</p></li><li><p>OnUnitInactiveSecï¼šè¿™ä¸ª timer é…ç½®æ–‡ä»¶æ‰€ç®¡ç†çš„é‚£ä¸ª unit æœåŠ¡åœ¨æœ€åä¸€æ¬¡åœæ­¢åï¼Œéš”å¤šä¹…å†æ‰§è¡Œä¸€æ¬¡</p></li><li><p>OnCalendarï¼šä½¿ç”¨å®é™…æ—¶é—´ï¼ˆéå¾ªç¯æ—¶é—´ï¼‰çš„æ–¹å¼æ¥å¯åŠ¨æœåŠ¡ã€‚æ—¶é—´æ ¼å¼åç»­è®²è§£</p></li><li><p>Unitï¼š</p><p>ä¸€èˆ¬æ¥è¯´ä¸å¤ªéœ€è¦è®¾ç½®ï¼Œå½“ä½ çš„ sname.service ä¸ sname.timer ä¸­çš„ sname ä¸ä¸€è‡´æ—¶ï¼Œè¿™é‡ŒæŒ‡å‘çš„ service unit</p></li><li><p>Persistent</p><p>å½“ä½¿ç”¨ OnCalendar çš„è®¾ç½®æ—¶ï¼ŒæŒ‡å®šè¯¥åŠŸèƒ½è¦ä¸è¦æŒç»­è¿›è¡Œã€‚é€šå¸¸è®¾ç½®ä¸º yesï¼Œæ¯”è¾ƒèƒ½æ»¡è¶³ç±»ä¼¼ anacron çš„åŠŸèƒ½</p></li></ul><h2 id="ğŸ€-ä½¿ç”¨-oncalendar-çš„æ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-oncalendar-çš„æ—¶é—´" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ OnCalendar çš„æ—¶é—´</h2><p>æƒ³è¦ä» crontab è½¬æˆ timer çš„åŠŸèƒ½ï¼Œå¯¹äºæ—¶é—´æ ¼å¼éœ€è¦äº†è§£ï¼ŒåŸºæœ¬ä¸Šçš„æ ¼å¼å¦‚ä¸‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>è¯­æ³•ï¼šè‹±æ–‡å‘¨å YYYY-MM-DD HH:MM:SS
èŒƒä¾‹ï¼šThu	  <span class="token number">2020</span>-03-20 <span class="token number">10</span>:00:00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ—¶é—´é—´éš”æ—¶é—´æ¥å¤„ç†ï¼Œå¸¸ç”¨çš„æ—¶é—´é—´éš”å•ä½æœ‰ï¼š</p><ul><li>us æˆ– usecï¼šå¾®ç§’</li><li>ms æˆ– msecï¼šæ¯«ç§’</li><li>sã€secã€secondã€seconds</li><li>mã€minã€minuteã€minutes</li><li>hã€hrã€hourã€hours</li><li>dã€dayã€days</li><li>wã€weekã€weeks</li><li>monthã€months</li><li>yã€yearã€years</li></ul><p>å¸¸è§çš„èŒƒä¾‹æœ‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>éš” <span class="token number">3</span> å°æ—¶ï¼š				3h æˆ– 3hr æˆ– 3hours
éš” <span class="token number">300</span> åˆ†é’Ÿè¿‡ <span class="token number">10</span> ç§’ï¼š	   10s 300m	
éš” <span class="token number">5</span> å¤©åˆ <span class="token number">100</span> åˆ†é’Ÿï¼š	   100m 5day
<span class="token comment"># é€šå¸¸è‹±æ–‡çš„å†™æ³•ï¼šå°å•ä½å†™åœ¨å‰é¢ï¼Œå¤§å•ä½å†™åé¢ã€å…ˆç§’ã€åˆ†ã€å°æ—¶ã€å¤©ç­‰</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‹±æ–‡å¸¸ç”¨çš„å£è¯­åŒ–æ—¥æœŸä»£è¡¨ï¼Œä¾‹å¦‚ todayã€tomorrow ç­‰ï¼Œå‡è®¾ä»Šå¤©æ˜¯ 2015-08-13 13:50:00 é‚£ä¹ˆ</p><ul><li>nowï¼šThu 2015-08-13 13:50:00</li><li>todayï¼šThu 2015-08-13 00:00:00</li><li>tomorrowï¼šThu 2015-08-14 00:00:00</li><li>hourlyï¼š<code>*-*-* *:00:00</code></li><li>dailyï¼š<code>*-*-* 00:00:00</code></li><li>weeklyï¼š<code>Mon *-*-* 00:00:00</code></li><li>monthlyï¼š<code>*-*-01 00:00:00</code></li><li>+3h10mï¼šThu 2015-08-13 17:00:00</li><li>2015-08-16ï¼šSun 2015-08-16 00:00:00</li></ul><h2 id="ğŸ€-ä¸€ä¸ªå¾ªç¯æ—¶é—´è¿è¡Œçš„æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¸€ä¸ªå¾ªç¯æ—¶é—´è¿è¡Œçš„æ¡ˆä¾‹" aria-hidden="true">#</a> ğŸ€ ä¸€ä¸ªå¾ªç¯æ—¶é—´è¿è¡Œçš„æ¡ˆä¾‹</h2><p>éœ€æ±‚å¦‚ä¸‹ï¼š</p><ul><li>å¼€æœºå 2 å°æ—¶å¼€å§‹æ‰§è¡Œä¸€æ¬¡ backup.service</li><li>è‡ªä»ç¬¬ä¸€æ¬¡æ‰§è¡Œåï¼Œæœªæ¥æ¯ä¸¤å¤©æ‰§è¡Œä¸€æ¬¡ backup.service</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/systemd/system/backup.timer</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>backup my server timer

<span class="token punctuation">[</span>Timer<span class="token punctuation">]</span>
<span class="token assign-left variable">OnBootSec</span><span class="token operator">=</span>2hrs
<span class="token assign-left variable">OnUnitActiveSec</span><span class="token operator">=</span>2days

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable backup.timer</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/backup.timer to /etc/systemd/system/backup.timer.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart backup.timer    </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl list-unit-files | grep backup</span>
backup.service                                disabled		<span class="token comment"># åªéœ€è¦ timer å¯åŠ¨å°± ok</span>
backup.timer                                  enabled

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl show timers.target </span>
<span class="token assign-left variable">ConditionTimestamp</span><span class="token operator">=</span>Tue <span class="token number">2020</span>-03-17 <span class="token number">10</span>:49:38 CST		<span class="token comment"># timer è¿™ä¸ª unit å¯åŠ¨çš„æ—¶é—´</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl show backup.service | grep ExecMainStartTimestamp</span>
<span class="token assign-left variable">ExecMainStartTimestamp</span><span class="token operator">=</span>Fri <span class="token number">2020</span>-03-20 09:38:19 CST	<span class="token comment"># backup.service ä¸Šä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl show backup.timer | grep NextElapseUSecMonotonic </span>
<span class="token assign-left variable">NextElapseUSecMonotonic</span><span class="token operator">=</span>4d 22h 48min <span class="token number">56</span>.756775s		<span class="token comment"># ä¸‹ä¸€æ¬¡æ‰§è¡Œè·ç¦» timers.target çš„æ—¶é—´</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äºè¿™ä¸ª NextElapseUSecMonotonic å€¼å¾—è¯´æ˜ï¼Œä¸Šæ¬¡æ‰§è¡Œ backup.service çš„æ—¶é—´åœ¨ 2020-03-20 09:38:19ï¼Œç”±äº 2 å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´åº”è¯¥æ˜¯ 2020-03-22 09:38:19 æ‰å¯¹ï¼Œä½†æ˜¯ç”±äº timer æ˜¯ç”± timers.target è¿™ä¸ª unit æ‰€ç®¡ç†çš„ï¼Œè€Œè¿™ä¸ª timers.target å¯åŠ¨æ—¶é—´æ˜¯åœ¨ 2020-03-17 10:49:38ï¼Œæ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª NextElapseUSecMonotonic è®°å½•çš„ä¸‹æ¬¡è¿è¡Œçš„æ—¶é—´ï¼Œå…¶å®æ˜¯ä¸ timers.target æ‰€è®°å½•çš„æ—¶é—´å·®ï¼Œå› æ­¤æ˜¯ <code>2020-03-22 09:38:19 -</code> 2020-03-17 10:49:38\` ç»“æœå°±æ˜¯ç›¸å·® 4d 22h 48min;</p><p>è®¡ç®—å…¬å¼ï¼šNextElapseUSecMonotonic = å®é™…ä¸‹ä¸€æ¬¡è¿è¡Œçš„æ—¶é—´ - timers.target çš„å¯åŠ¨æ—¶é—´</p><h2 id="ğŸ€-ä¸€ä¸ªå›ºå®šæ—¥æœŸè¿è¡Œçš„æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¸€ä¸ªå›ºå®šæ—¥æœŸè¿è¡Œçš„æ¡ˆä¾‹" aria-hidden="true">#</a> ğŸ€ ä¸€ä¸ªå›ºå®šæ—¥æœŸè¿è¡Œçš„æ¡ˆä¾‹</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/systemd/system/backup2.timer</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>backup my server timer2

<span class="token punctuation">[</span>Timer<span class="token punctuation">]</span>
<span class="token assign-left variable">OnCalendar</span><span class="token operator">=</span>Sun *-*-* 02:00:00
<span class="token assign-left variable">Persistent</span><span class="token operator">=</span>true
<span class="token assign-left variable">Unit</span><span class="token operator">=</span>backup.service		<span class="token comment"># è¿™é‡Œçš„ timer åç§°ä¸åŸæ¥çš„ service ä¸ä¸€è‡´ï¼Œè¿™é‡ŒæŒ‡å®šä¸‹</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable backup2.timer</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/backup2.timer to /etc/systemd/system/backup2.timer.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart backup2.timer </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl list-unit-files | grep backup</span>
backup.service                                disabled
backup.timer                                  enabled 
backup2.timer                                 enabled 
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl show timers.target | grep ConditionTimestamp</span>
<span class="token assign-left variable">ConditionTimestamp</span><span class="token operator">=</span>Tue <span class="token number">2020</span>-03-17 <span class="token number">10</span>:49:38 CST
<span class="token assign-left variable">ConditionTimestampMonotonic</span><span class="token operator">=</span><span class="token number">15862087</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment">#  systemctl show backup.service | grep ExecMainStartTimestamp</span>
<span class="token assign-left variable">ExecMainStartTimestamp</span><span class="token operator">=</span>Fri <span class="token number">2020</span>-03-20 09:38:19 CST
<span class="token assign-left variable">ExecMainStartTimestampMonotonic</span><span class="token operator">=</span><span class="token number">254936756737</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl show backup2.timer | grep NextElapseUSecRealtime</span>
<span class="token assign-left variable">NextElapseUSecRealtime</span><span class="token operator">=</span>50y 2month 2w 5d 9h
<span class="token comment"># ç”±äºåªæœ‰ä¸€æ¬¡è¿è¡Œï¼Œæ‰€ä»¥æ²¡æœ‰ NextElapseUSecMonotonic å€¼äº†ã€‚</span>
<span class="token comment"># è¿™é‡Œçš„æ—¶é—´æ˜¯ Unix æ ‡å‡†æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ˜¯ 1970-01-01 00:00:00 å»æ¯”è¾ƒçš„</span>
<span class="token comment"># è¿™é‡Œæ˜¯ 50 å¹´ 2ä¸ªæœˆ 2å‘¨ 5å¤© 9å°æ—¶æ‰ä¼šæ‰§è¡Œï¼Œè¿™ä¸ªæ˜¯å¯¹æ¯”çš„æ—¥å†æ—¶é—´ï¼ˆ1970-01-01 00:00:00ï¼‰</span>
<span class="token comment"># æ—¶é—´çš„åŸºå‡†å€¼ä¸ä¸€æ ·ã€‚ä¸€å®šè¦æ³¨æ„</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,30),l=[i];function c(p,o){return n(),a("div",null,l)}const d=s(t,[["render",c],["__file","04.html.vue"]]);export{d as default};
