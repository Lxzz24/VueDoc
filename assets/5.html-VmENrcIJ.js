import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as l,c as u,a as n,b as a,w as t,e as s,d as i}from"./app-CvlAI_tu.js";const d="/VueDoc/assets/l-20231221154625091-CmjCtvmc.png",r="/VueDoc/assets/l-20231221154624489-BbPS5C5x.png",v="/VueDoc/assets/l-20231221154624050-BooDriyF.png",k="/VueDoc/assets/l-20231221154624316-DvJhDtMq.png",m="/VueDoc/assets/l-20231221154623976-Dlvrw9Ln.png",b="/VueDoc/assets/l-20231221154624767-DR2-_4N4.png",g={},M={class:"hint-container details"},h=n("summary",null,"ç›®å½•",-1),f={class:"table-of-contents"},S=n("p",null,"Spring æ¡†æ¶ä¸ä»…æä¾›äº†æ ‡å‡†çš„ IoC å®¹å™¨ã€AOP æ”¯æŒã€æ•°æ®åº“è®¿é—®ä»¥åŠ WebMVC ç­‰æ ‡å‡†åŠŸèƒ½ï¼Œè¿˜å¯ä»¥éå¸¸æ–¹ä¾¿åœ°é›†æˆè®¸å¤šå¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼š",-1),_=n("ul",null,[n("li",null,"å¯ä»¥é›†æˆ JavaMail å‘é€é‚®ä»¶ï¼›"),n("li",null,"å¯ä»¥é›†æˆ JMS æ¶ˆæ¯æœåŠ¡ï¼›"),n("li",null,"å¯ä»¥é›†æˆ Quartz å®ç°å®šæ—¶ä»»åŠ¡ï¼›"),n("li",null,"å¯ä»¥é›†æˆ Redis ç­‰æœåŠ¡ã€‚")],-1),x=n("p",null,"æœ¬ç« æˆ‘ä»¬ä»‹ç»å¦‚ä½•åœ¨ Spring ä¸­ç®€å•å¿«æ·åœ°é›†æˆè¿™äº›ç¬¬ä¸‰æ–¹ç»„ä»¶ã€‚",-1),w=n("h2",{id:"ğŸ€-é›†æˆ-javamail",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ğŸ€-é›†æˆ-javamail","aria-hidden":"true"},"#"),s(" ğŸ€ é›†æˆ JavaMail")],-1),y={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1319099923693601",target:"_blank",rel:"noopener noreferrer"},J={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1319099948859426",target:"_blank",rel:"noopener noreferrer"},C=i(`<p>å› ä¸ºåœ¨æœåŠ¡å™¨ç«¯ï¼Œä¸»è¦ä»¥å‘é€é‚®ä»¶ä¸ºä¸»ï¼Œä¾‹å¦‚åœ¨æ³¨å†ŒæˆåŠŸã€ç™»å½•æ—¶ã€è´­ç‰©ä»˜æ¬¾åé€šçŸ¥ç”¨æˆ·ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šé‡åˆ°æ¥æ”¶ç”¨æˆ·é‚®ä»¶çš„æƒ…å†µï¼Œæ‰€ä»¥æœ¬èŠ‚æˆ‘ä»¬åªè®¨è®ºå¦‚ä½•åœ¨ Spring ä¸­å‘é€é‚®ä»¶ã€‚</p><p>åœ¨ Spring ä¸­ï¼Œå‘é€é‚®ä»¶æœ€ç»ˆä¹Ÿæ˜¯éœ€è¦ JavaMailï¼ŒSpring åªå¯¹ JavaMail åšäº†ä¸€ç‚¹ç®€å•çš„å°è£…ï¼Œç›®çš„æ˜¯ç®€åŒ–ä»£ç ã€‚ä¸ºäº†åœ¨ Spring ä¸­é›†æˆ JavaMailï¼Œæˆ‘ä»¬åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-context-support:6.0.0</li><li>jakarta.mail:jakarta.mail-api:2.0.1</li><li>com.sun.mail:jakarta.mail:2.0.1</li></ul><p>ä»¥åŠå…¶ä»– Web ç›¸å…³ä¾èµ–ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·åœ¨æ³¨å†ŒæˆåŠŸåèƒ½æ”¶åˆ°æ³¨å†Œé‚®ä»¶ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª <code>JavaMailSender</code> çš„ Beanï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">JavaMailSender</span> <span class="token function">createJavaMailSender</span><span class="token punctuation">(</span>
        <span class="token comment">// smtp.properties:</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.host}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> host<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.port}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> port<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.auth}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> auth<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.username}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.password}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.debug:true}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> debug<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> mailSender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaMailSenderImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mailSender<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mailSender<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mailSender<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mailSender<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Properties</span> props <span class="token operator">=</span> mailSender<span class="token punctuation">.</span><span class="token function">getJavaMailProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.transport.protocol&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;smtp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.smtp.auth&quot;</span><span class="token punctuation">,</span> auth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>port <span class="token operator">==</span> <span class="token number">587</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.smtp.starttls.enable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>port <span class="token operator">==</span> <span class="token number">465</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.smtp.socketFactory.port&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;465&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.smtp.socketFactory.class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.debug&quot;</span><span class="token punctuation">,</span> debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mailSender<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª <code>JavaMailSender</code> æ¥å£çš„å®ç°ç±»æ˜¯ <code>JavaMailSenderImpl</code>ï¼Œåˆå§‹åŒ–æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸ JavaMail æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><p>å¦å¤–æ³¨æ„åˆ°éœ€è¦æ³¨å…¥çš„å±æ€§æ˜¯ä» <code>smtp.properties</code> ä¸­è¯»å–çš„ï¼Œå› æ­¤ï¼Œ<code>AppConfig</code> å¯¼å…¥çš„å°±ä¸æ­¢ä¸€ä¸ª <code>.properties</code> æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å…¥å¤šä¸ªï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;classpath:/jdbc.properties&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/smtp.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹ä¸€æ­¥æ˜¯å°è£…ä¸€ä¸ª <code>MailService</code>ï¼Œå¹¶å®šä¹‰ <code>sendRegistrationMail()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.from}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> from<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JavaMailSender</span> mailSender<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendRegistrationMail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">MimeMessage</span> mimeMessage <span class="token operator">=</span> mailSender<span class="token punctuation">.</span><span class="token function">createMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MimeMessageHelper</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>mimeMessage<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to Java course!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> html <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;p&gt;Hi, %s,&lt;/p&gt;&lt;p&gt;Welcome to Java course!&lt;/p&gt;&lt;p&gt;Sent at %s&lt;/p&gt;&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>mimeMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MessagingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œ<code>MimeMessage</code> æ˜¯ JavaMail çš„é‚®ä»¶å¯¹è±¡ï¼Œè€Œ <code>MimeMessageHelper</code> æ˜¯ Spring æä¾›çš„ç”¨äºç®€åŒ–è®¾ç½® MimeMessage çš„ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾ç½® HTML é‚®ä»¶å°±å¯ä»¥ç›´æ¥è°ƒç”¨ <code>setText(String text, boolean html)</code> æ–¹æ³•ï¼Œè€Œä¸å¿…å†è°ƒç”¨æ¯”è¾ƒç¹ççš„ JavaMail æ¥å£æ–¹æ³•ã€‚</p><p>æœ€åä¸€æ­¥æ˜¯è°ƒç”¨ <code>JavaMailSender.send()</code> æ–¹æ³•æŠŠé‚®ä»¶å‘é€å‡ºå»ã€‚</p><p>åœ¨ MVC çš„æŸä¸ª Controller æ–¹æ³•ä¸­ï¼Œå½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¼‚æ­¥å‘é€é‚®ä»¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;user registered: {}&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// send registration mail:</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    mailService<span class="token punctuation">.</span><span class="token function">sendRegistrationMail</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºå‘é€é‚®ä»¶æ˜¯ä¸€ç§è€—æ—¶çš„ä»»åŠ¡ï¼Œä»å‡ ç§’åˆ°å‡ åˆ†é’Ÿä¸ç­‰ï¼Œå› æ­¤ï¼Œå¼‚æ­¥å‘é€æ˜¯ä¿è¯é¡µé¢èƒ½å¿«é€Ÿæ˜¾ç¤ºçš„å¿…è¦æªæ–½ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä½†å®é™…ä¸Šè¿˜æœ‰æ›´ä¼˜åŒ–çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºã€‚</p><h3 id="ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ " aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h3><p>Spring å¯ä»¥é›†æˆ JavaMailï¼Œé€šè¿‡ç®€å•çš„å°è£…ï¼Œèƒ½ç®€åŒ–é‚®ä»¶å‘é€ä»£ç ã€‚å…¶æ ¸å¿ƒæ˜¯å®šä¹‰ä¸€ä¸ª <code>JavaMailSender</code> çš„ Beanï¼Œç„¶åè°ƒç”¨å…¶ <code>send()</code> æ–¹æ³•ã€‚</p><h2 id="ğŸ€-é›†æˆ-jms" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é›†æˆ-jms" aria-hidden="true">#</a> ğŸ€ é›†æˆ JMS</h2><p>JMS å³ Java Message Serviceï¼Œæ˜¯ JavaEE çš„æ¶ˆæ¯æœåŠ¡æ¥å£ã€‚JMS ä¸»è¦æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š1.1 å’Œ 2.0ã€‚2.0 å’Œ 1.1 ç›¸æ¯”ï¼Œä¸»è¦æ˜¯ç®€åŒ–äº†æ”¶å‘æ¶ˆæ¯çš„ä»£ç ã€‚</p><p>æ‰€è°“æ¶ˆæ¯æœåŠ¡ï¼Œå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´ï¼Œé€šè¿‡æ¶ˆæ¯æœåŠ¡å™¨ä¼ é€’æ¶ˆæ¯ï¼š</p><div class="language-ascii line-numbers-mode" data-ext="ascii"><pre class="language-ascii"><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Producerâ”‚â”€â”€â”€&gt;â”‚Message Serverâ”‚â”€â”€â”€&gt;â”‚Consumerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨æ¶ˆæ¯æœåŠ¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å¯¹æ–¹çš„ APIï¼Œå®ƒçš„å¥½å¤„æ˜¯ï¼š</p><ul><li>åŒæ–¹å„è‡ªæ— éœ€çŸ¥æ™“å¯¹æ–¹çš„å­˜åœ¨ï¼Œæ¶ˆæ¯å¯ä»¥å¼‚æ­¥å¤„ç†ï¼Œå› ä¸ºæ¶ˆæ¯æœåŠ¡å™¨ä¼šåœ¨ Consumer ç¦»çº¿çš„æ—¶å€™è‡ªåŠ¨ç¼“å­˜æ¶ˆæ¯ï¼›</li><li>å¦‚æœ Producer å‘é€çš„æ¶ˆæ¯é¢‘ç‡é«˜äº Consumer çš„å¤„ç†èƒ½åŠ›ï¼Œæ¶ˆæ¯å¯ä»¥ç§¯å‹åœ¨æ¶ˆæ¯æœåŠ¡å™¨ï¼Œä¸è‡³äºå‹å® Consumerï¼›</li><li>é€šè¿‡ä¸€ä¸ªæ¶ˆæ¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿æ¥å¤šä¸ª Producer å’Œå¤šä¸ª Consumerã€‚</li></ul>`,25),j={href:"https://activemq.apache.org/",target:"_blank",rel:"noopener noreferrer"},q=n("p",null,"ç°åœ¨é—®é¢˜æ¥äº†ï¼šä»å®˜ç½‘ä¸‹è½½ ActiveMQ æ—¶ï¼Œè¹¦å‡ºä¸€ä¸ªé¡µé¢ï¼Œè®©æˆ‘ä»¬é€‰æ‹© ActiveMQ Classic æˆ–è€… ActiveMQ Artemisï¼Œè¿™ä¸¤ä¸ªæ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ",-1),B={href:"https://hornetq.jboss.org/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://activemq.apache.org/components/artemis/download/",target:"_blank",rel:"noopener noreferrer"},T=n("code",null,"ARTEMIS_HOME",-1),E=n("code",null,"C:\\Apps\\artemis",-1),P=n("code",null,"ARTEMIS_HOME/bin",-1),L=i(`<ul><li>Windows ä¸‹æ·»åŠ  <code>%ARTEMIS_HOME%\\bin</code> åˆ° Path è·¯å¾„ï¼›</li><li>Mac å’Œ Linux ä¸‹æ·»åŠ  <code>$ARTEMIS_HOME/bin</code> åˆ° PATH è·¯å¾„ã€‚</li></ul><p>Artemis æœ‰ä¸ªå¾ˆå¥½çš„è®¾è®¡ï¼Œå°±æ˜¯å®ƒæŠŠç¨‹åºå’Œæ•°æ®å®Œå…¨åˆ†ç¦»äº†ã€‚æˆ‘ä»¬è§£å‹åçš„ <code>ARTEMIS_HOME</code> ç›®å½•æ˜¯ç¨‹åºç›®å½•ï¼Œè¦å¯åŠ¨ä¸€ä¸ª Artemis æœåŠ¡ï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®ç›®å½•ã€‚æˆ‘ä»¬æŠŠæ•°æ®ç›®å½•ç›´æ¥è®¾å®šåœ¨é¡¹ç›® <code>spring-integration-jms</code> çš„ <code>jms-data</code> ç›®å½•ä¸‹ã€‚æ‰§è¡Œå‘½ä»¤ <code>artemis create jms-data</code>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">pwd</span>
/Users/liaoxuefeng/workspace/spring-integration-jms

$ artemis create jms-data
Creating ActiveMQ Artemis instance at: /Users/liaoxuefeng/workspace/spring-integration-jms/jms-data

--user: is a mandatory property<span class="token operator">!</span>
Please provide the default username:
admin

--password: is mandatory with this configuration:
Please provide the default password:
********

--allow-anonymous <span class="token operator">|</span> --require-login: is a mandatory property<span class="token operator">!</span>
Allow anonymous access?, valid values are Y,N,True,False
N

Auto tuning journal <span class="token punctuation">..</span>.
done<span class="token operator">!</span> Your system can <span class="token function">make</span> <span class="token number">0.09</span> writes per millisecond, your journal-buffer-timeout will be <span class="token number">11392000</span>

You can now start the broker by executing:

   <span class="token string">&quot;/Users/liaoxuefeng/workspace/spring-integration-jms/jms-data/bin/artemis&quot;</span> run

Or you can run the broker <span class="token keyword">in</span> the background using:

   <span class="token string">&quot;/Users/liaoxuefeng/workspace/spring-integration-jms/jms-data/bin/artemis-service&quot;</span> start

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¼šè¦æ±‚è¾“å…¥è¿æ¥ç”¨æˆ·å’Œå£ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾å®š <code>admin</code> å’Œ <code>password</code>ï¼Œä»¥åŠæ˜¯å¦å…è®¸åŒ¿åè®¿é—®ï¼ˆè¿™é‡Œé€‰æ‹© <code>N</code>ï¼‰ã€‚</p><p>æ­¤æ•°æ®ç›®å½• <code>jms-data</code> ä¸ä»…åŒ…å«æ¶ˆæ¯æ•°æ®ã€æ—¥å¿—ï¼Œè¿˜è‡ªåŠ¨åˆ›å»ºäº†ä¸¤ä¸ªå¯åŠ¨æœåŠ¡çš„å‘½ä»¤ <code>bin/artemis</code> å’Œ <code>bin/artemis-service</code>ï¼Œå‰è€…åœ¨å‰å°å¯åŠ¨è¿è¡Œï¼ŒæŒ‰ Ctrl+C ç»“æŸï¼Œåè€…ä¼šä¸€ç›´åœ¨åå°è¿è¡Œã€‚</p><p>æˆ‘ä»¬æŠŠç›®å½•åˆ‡æ¢åˆ° <code>jms-data/bin</code>ï¼Œç›´æ¥è¿è¡Œ <code>artemis run</code> å³å¯å¯åŠ¨ Artemis æœåŠ¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ ./artemis run
     _        _               _
    / <span class="token punctuation">\\</span>  ____<span class="token operator">|</span> <span class="token operator">|</span>_  ___ __  __<span class="token punctuation">(</span>_<span class="token punctuation">)</span> _____
   / _ <span class="token punctuation">\\</span><span class="token operator">|</span>  _ <span class="token punctuation">\\</span> __<span class="token operator">|</span>/ _ <span class="token punctuation">\\</span>  <span class="token punctuation">\\</span>/  <span class="token operator">|</span> <span class="token operator">|</span>/  __/
  / ___ <span class="token punctuation">\\</span> <span class="token operator">|</span> <span class="token punctuation">\\</span>/ <span class="token operator">|</span>_/  __/ <span class="token operator">|</span><span class="token punctuation">\\</span>/<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span><span class="token punctuation">\\</span>___ <span class="token punctuation">\\</span>
 /_/   <span class="token punctuation">\\</span>_<span class="token punctuation">\\</span><span class="token operator">|</span>   <span class="token punctuation">\\</span>__<span class="token punctuation">\\</span>____<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>/___ /
 Apache ActiveMQ Artemis <span class="token number">2.13</span>.0

<span class="token punctuation">..</span>.

<span class="token number">2020</span>-06-02 07:50:21,718 INFO  <span class="token punctuation">[</span>org.apache.activemq.artemis<span class="token punctuation">]</span> AMQ241001: HTTP Server started at http://localhost:8161
<span class="token number">2020</span>-06-02 07:50:21,718 INFO  <span class="token punctuation">[</span>org.apache.activemq.artemis<span class="token punctuation">]</span> AMQ241002: Artemis Jolokia REST API available at http://localhost:8161/console/jolokia
<span class="token number">2020</span>-06-02 07:50:21,719 INFO  <span class="token punctuation">[</span>org.apache.activemq.artemis<span class="token punctuation">]</span> AMQ241004: Artemis Console available at http://localhost:8161/console

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æˆåŠŸåï¼ŒArtemis æç¤ºå¯ä»¥é€šè¿‡ URL<code>http://localhost:8161/console</code> è®¿é—®ç®¡ç†åå°ã€‚æ³¨æ„ <em>ä¸è¦å…³é—­å‘½ä»¤è¡Œçª—å£</em>ã€‚</p><p>å¦‚æœ Artemis å¯åŠ¨æ—¶æ˜¾ç¤ºè­¦å‘Šï¼š<code>AMQ222212: Disk Full! ... Clients will report blocked.</code> è¿™æ˜¯å› ä¸ºç£ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥åœ¨ <code>etc/broker.xml</code> é…ç½®ä¸­æ‰¾åˆ° <code>&lt;max-disk-usage&gt;</code> å¹¶æ”¹ä¸º 99ã€‚</p><p>åœ¨ç¼–å†™ JMS ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ç†è§£ JMS çš„æ¶ˆæ¯æ¨¡å‹ã€‚JMS æŠŠç”Ÿäº§æ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¸º Producerï¼Œå¤„ç†æ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¸º Consumerã€‚æœ‰ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯é€šé“ï¼Œä¸€ç§æ˜¯ Queueï¼š</p><div class="language-ascii line-numbers-mode" data-ext="ascii"><pre class="language-ascii"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Producerâ”‚â”€â”€â”€&gt;â”‚ Queue  â”‚â”€â”€â”€&gt;â”‚Consumerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ç§æ˜¯ Topicï¼š</p><div class="language-ascii line-numbers-mode" data-ext="ascii"><pre class="language-ascii"><code>                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”Œâ”€&gt;â”‚Consumerâ”‚
                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Producerâ”‚â”€â”€â”€&gt;â”‚ Topic  â”‚â”€â”¼â”€&gt;â”‚Consumerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                         â””â”€&gt;â”‚Consumerâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼ŒQueue æ˜¯ä¸€ç§ä¸€å¯¹ä¸€çš„é€šé“ï¼Œå¦‚æœ Consumer ç¦»çº¿æ— æ³•å¤„ç†æ¶ˆæ¯æ—¶ï¼ŒQueue ä¼šæŠŠæ¶ˆæ¯å­˜èµ·æ¥ï¼Œç­‰ Consumer å†æ¬¡è¿æ¥çš„æ—¶å€™å‘ç»™å®ƒã€‚è®¾å®šäº†æŒä¹…åŒ–æœºåˆ¶çš„ Queue ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å¦‚æœæœ‰å¤šä¸ª Consumer æ¥å…¥åŒä¸€ä¸ª Queueï¼Œé‚£ä¹ˆå®ƒä»¬ç­‰æ•ˆäºä»¥é›†ç¾¤æ–¹å¼å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼Œå‘é€æ–¹å‘é€çš„æ¶ˆæ¯æ˜¯ Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼ŒFï¼Œä¸¤ä¸ª Consumer å¯èƒ½åˆ†åˆ«æ”¶åˆ° Aï¼ŒCï¼ŒE å’Œ Bï¼ŒDï¼ŒFï¼Œå³æ¯ä¸ªæ¶ˆæ¯åªä¼šäº¤ç»™å…¶ä¸­ä¸€ä¸ª Consumer å¤„ç†ã€‚</p><p>Topic åˆ™æ˜¯ä¸€ç§ä¸€å¯¹å¤šé€šé“ã€‚ä¸€ä¸ª Producer å‘å‡ºçš„æ¶ˆæ¯ï¼Œä¼šè¢«å¤šä¸ª Consumer åŒæ—¶æ”¶åˆ°ï¼Œå³æ¯ä¸ª Consumer éƒ½ä¼šæ”¶åˆ°ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯æµã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚æœæŸä¸ª Consumer æš‚æ—¶ç¦»çº¿ï¼Œè¿‡ä¸€æ®µæ—¶é—´ååˆä¸Šçº¿äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒç¦»çº¿æœŸé—´äº§ç”Ÿçš„æ¶ˆæ¯è¿˜èƒ½ä¸èƒ½æ”¶åˆ°å‘¢ï¼Ÿ</p><p>è¿™å–å†³äºæ¶ˆæ¯æœåŠ¡å™¨å¯¹ Topic ç±»å‹æ¶ˆæ¯çš„æŒä¹…åŒ–æœºåˆ¶ã€‚å¦‚æœæ¶ˆæ¯æœåŠ¡å™¨ä¸å­˜å‚¨ Topic æ¶ˆæ¯ï¼Œé‚£ä¹ˆç¦»çº¿çš„ Consumer ä¼šä¸¢å¤±éƒ¨åˆ†ç¦»çº¿æ—¶æœŸçš„æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æœåŠ¡å™¨å­˜å‚¨äº† Topic æ¶ˆæ¯ï¼Œé‚£ä¹ˆç¦»çº¿çš„ Consumer å¯ä»¥æ”¶åˆ°è‡ªä¸Šæ¬¡ç¦»çº¿æ—¶åˆ»å¼€å§‹åäº§ç”Ÿçš„æ‰€æœ‰æ¶ˆæ¯ã€‚JMS è§„èŒƒé€šè¿‡ Consumer æŒ‡å®šä¸€ä¸ªæŒä¹…åŒ–è®¢é˜…å¯ä»¥åœ¨ä¸Šçº¿åæ”¶å–æ‰€æœ‰ç¦»çº¿æœŸé—´çš„æ¶ˆæ¯ï¼Œå¦‚æœæŒ‡å®šçš„æ˜¯éæŒä¹…åŒ–è®¢é˜…ï¼Œé‚£ä¹ˆç¦»çº¿æœŸé—´çš„æ¶ˆæ¯ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚</p><p>ç»†å¿ƒçš„ç«¥é‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœä¸€ä¸ª Topic çš„æ¶ˆæ¯å…¨éƒ¨éƒ½æŒä¹…åŒ–äº†ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ª Consumerï¼Œé‚£ä¹ˆå®ƒå’Œ Queue å…¶å®æ˜¯ä¸€æ ·çš„ã€‚å®é™…ä¸Šï¼Œå¾ˆå¤šæ¶ˆæ¯æœåŠ¡å™¨å†…éƒ¨éƒ½åªæœ‰ Topic ç±»å‹çš„æ¶ˆæ¯æ¶æ„ï¼ŒQueue å¯ä»¥é€šè¿‡ Topicâ€œæ¨¡æ‹Ÿâ€ å‡ºæ¥ã€‚</p><p>æ— è®ºæ˜¯ Queue è¿˜æ˜¯ Topicï¼Œå¯¹ Producer æ²¡æœ‰ä»€ä¹ˆè¦æ±‚ã€‚å¤šä¸ª Producer ä¹Ÿå¯ä»¥å†™å…¥åŒä¸€ä¸ª Queue æˆ–è€… Topicï¼Œæ­¤æ—¶æ¶ˆæ¯æœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨æ’åºç¡®ä¿æ¶ˆæ¯æ€»æ˜¯æœ‰åºçš„ã€‚</p><p>ä»¥ä¸Šæ˜¯æ¶ˆæ¯æœåŠ¡çš„åŸºæœ¬æ¨¡å‹ã€‚å…·ä½“åˆ°æŸä¸ªæ¶ˆæ¯æœåŠ¡å™¨æ—¶ï¼ŒProducer å’Œ Consumer é€šå¸¸æ˜¯é€šè¿‡ TCP è¿æ¥æ¶ˆæ¯æœåŠ¡å™¨ï¼Œåœ¨ç¼–å†™ JMS ç¨‹åºæ—¶ï¼Œåˆä¼šé‡åˆ° <code>ConnectionFactory</code>ã€<code>Connection</code>ã€<code>Session</code> ç­‰æ¦‚å¿µï¼Œå…¶å®è¿™å’Œ JDBC è¿æ¥æ˜¯ç±»ä¼¼çš„ï¼š</p><ul><li>ConnectionFactoryï¼šä»£è¡¨ä¸€ä¸ªåˆ°æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥æ± ï¼Œç±»ä¼¼ JDBC çš„ DataSourceï¼›</li><li>Connectionï¼šä»£è¡¨ä¸€ä¸ªåˆ°æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥ï¼Œç±»ä¼¼ JDBC çš„ Connectionï¼›</li><li>Sessionï¼šä»£è¡¨ä¸€ä¸ªç»è¿‡è®¤è¯åçš„è¿æ¥ä¼šè¯ï¼›</li><li>Messageï¼šä»£è¡¨ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ã€‚</li></ul><p>åœ¨ JMS 1.1 ä¸­ï¼Œå‘é€æ¶ˆæ¯çš„å…¸å‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥:</span>
        connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä¼šè¯:</span>
        <span class="token class-name">Session</span> session <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token constant">AUTO_ACKNOWLEDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ª Producer å¹¶å…³è”åˆ°æŸä¸ª Queue:</span>
        <span class="token class-name">MessageProducer</span> messageProducer <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯:</span>
        <span class="token class-name">TextMessage</span> textMessage <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘é€æ¶ˆæ¯:</span>
        messageProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>textMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…³é—­è¿æ¥:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JMSException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç† JMS å¼‚å¸¸</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JMS 2.0 æ”¹è¿›äº†ä¸€äº› API æ¥å£ï¼Œå‘é€æ¶ˆæ¯å˜å¾—æ›´ç®€å•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">JMSContext</span> context <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JMSContext</code> å®ç°äº† <code>AutoCloseable</code> æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ <code>try(resource)</code> è¯­æ³•ï¼Œä»£ç æ›´ç®€å•ã€‚</p><p>æœ‰äº†ä»¥ä¸Šé¢„å¤‡çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¼€å‘ JMS åº”ç”¨äº†ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-jms:6.0.0</li><li>org.apache.activemq:artemis-jakarta-client:2.27.0</li></ul><p>Artemis çš„ Client æ¥å£ä¾èµ–äº† <code>jakarta.jms:jakarta.jms-api</code>ï¼Œå› æ­¤ä¸å¿…å†å¼•å…¥ JMS API çš„ä¾èµ–ã€‚</p><p>åœ¨ AppConfig ä¸­ï¼Œé€šè¿‡ <code>@EnableJms</code> è®© Spring è‡ªåŠ¨æ‰«æ JMS ç›¸å…³çš„ Beanï¼Œå¹¶åŠ è½½ JMS é…ç½®æ–‡ä»¶ <code>jms.properties</code>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Configuration
@ComponentScan
@EnableWebMvc
@EnableJms // å¯ç”¨ JMS
@EnableTransactionManagement
@PropertySource({&quot;classpath:/jdbc.properties&quot;, &quot;classpath:/jms.properties&quot;})
public class AppConfig {
    ...
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆè¦åˆ›å»ºçš„ Bean æ˜¯ <code>ConnectionFactory</code>ï¼Œå³è¿æ¥æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥æ± ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">ConnectionFactory</span> <span class="token function">createJMSConnectionFactory</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jms.uri:tcp://localhost:61616}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> uri<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jms.username:admin}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${jms.password:password}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ActiveMQJMSConnectionFactory</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ¶ˆæ¯æœåŠ¡å™¨æ˜¯ ActiveMQ Artemisï¼Œæ‰€ä»¥ <code>ConnectionFactory</code> çš„å®ç°ç±»å°±æ˜¯æ¶ˆæ¯æœåŠ¡å™¨æä¾›çš„ <code>ActiveMQJMSConnectionFactory</code>ï¼Œå®ƒéœ€è¦çš„å‚æ•°å‡ç”±é…ç½®æ–‡ä»¶è¯»å–åä¼ å…¥ï¼Œå¹¶è®¾ç½®äº†é»˜è®¤å€¼ã€‚</p><p>æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ª <code>JmsTemplate</code>ï¼Œå®ƒæ˜¯ Spring æä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå’Œ <code>JdbcTemplate</code> ç±»ä¼¼ï¼Œå¯ä»¥ç®€åŒ–å‘é€æ¶ˆæ¯çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">JmsTemplate</span> <span class="token function">createJmsTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JmsTemplate</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹ä¸€æ­¥è¦åˆ›å»ºçš„æ˜¯ <code>JmsListenerContainerFactory</code>ï¼Œ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;jmsListenerContainerFactory&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">DefaultJmsListenerContainerFactory</span> <span class="token function">createJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†å¿…é¡»æŒ‡å®š Bean çš„åç§°ä¸º <code>jmsListenerContainerFactory</code> å¤–ï¼Œè¿™ä¸ª Bean çš„ä½œç”¨æ˜¯å¤„ç†å’Œ Consumer ç›¸å…³çš„ Beanã€‚æˆ‘ä»¬å…ˆè·³è¿‡å®ƒçš„åŸç†ï¼Œç»§ç»­ç¼–å†™ <code>MessagingService</code> æ¥å‘é€æ¶ˆæ¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessagingService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">JmsTemplate</span> jmsTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMailMessage</span><span class="token punctuation">(</span><span class="token class-name">MailMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jmsTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;jms/queue/mail&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">createMessage</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> session<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JMS çš„æ¶ˆæ¯ç±»å‹æ”¯æŒä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>TextMessageï¼šæ–‡æœ¬æ¶ˆæ¯ï¼›</li><li>BytesMessageï¼šäºŒè¿›åˆ¶æ¶ˆæ¯ï¼›</li><li>MapMessageï¼šåŒ…å«å¤šä¸ª Key-Value å¯¹çš„æ¶ˆæ¯ï¼›</li><li>ObjectMessageï¼šç›´æ¥åºåˆ—åŒ– Java å¯¹è±¡çš„æ¶ˆæ¯ï¼›</li><li>StreamMessageï¼šä¸€ä¸ªåŒ…å«åŸºæœ¬ç±»å‹åºåˆ—çš„æ¶ˆæ¯ã€‚</li></ul><p>æœ€å¸¸ç”¨çš„æ˜¯å‘é€åŸºäº JSON çš„æ–‡æœ¬æ¶ˆæ¯ï¼Œä¸Šè¿°ä»£ç é€šè¿‡ <code>JmsTemplate</code> åˆ›å»ºä¸€ä¸ª <code>TextMessage</code> å¹¶å‘é€åˆ°åç§°ä¸º <code>jms/queue/mail</code> çš„ Queueã€‚</p><p>æ³¨æ„ï¼šArtemis æ¶ˆæ¯æœåŠ¡å™¨é»˜è®¤é…ç½®ä¸‹ä¼šè‡ªåŠ¨åˆ›å»º Queueï¼Œå› æ­¤ä¸å¿…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º <code>jms/queue/mail</code> çš„ Queueï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ¶ˆæ¯æœåŠ¡å™¨éƒ½ä¼šè‡ªåŠ¨åˆ›å»º Queueï¼Œç”Ÿäº§ç¯å¢ƒçš„æ¶ˆæ¯æœåŠ¡å™¨é€šå¸¸ä¼šå…³é—­è‡ªåŠ¨åˆ›å»ºåŠŸèƒ½ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º Queueã€‚</p><p>å†æ³¨æ„åˆ° <code>MailMessage</code> æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ä¸€ä¸ª JavaBeanï¼ŒçœŸæ­£çš„ JMS æ¶ˆæ¯æ˜¯åˆ›å»ºçš„ <code>TextMessage</code>ï¼Œå®ƒçš„å†…å®¹æ˜¯ JSONã€‚</p><p>å½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°±è°ƒç”¨ <code>MessagingService.sendMailMessage()</code> å‘é€ä¸€æ¡ JMS æ¶ˆæ¯ï¼Œæ­¤ä»£ç ååˆ†ç®€å•ï¼Œè¿™é‡Œä¸å†è´´å‡ºã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¦è¯¦ç»†è®¨è®ºçš„æ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œå³ç¼–å†™ Consumerã€‚ä»ç†è®ºä¸Šè®²ï¼Œå¯ä»¥åˆ›å»ºå¦ä¸€ä¸ª Java è¿›ç¨‹æ¥å¤„ç†æ¶ˆæ¯ï¼Œä½†å¯¹äºæˆ‘ä»¬è¿™ä¸ªç®€å•çš„ Web ç¨‹åºæ¥è¯´æ²¡æœ‰å¿…è¦ï¼Œç›´æ¥åœ¨åŒä¸€ä¸ª Web åº”ç”¨ä¸­æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯å³å¯ã€‚</p><p>å¤„ç†æ¶ˆæ¯çš„æ ¸å¿ƒä»£ç æ˜¯ç¼–å†™ä¸€ä¸ª Beanï¼Œå¹¶åœ¨å¤„ç†æ–¹æ³•ä¸Šæ ‡æ³¨ <code>@JmsListener</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailMessageListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MailService</span> mailService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@JmsListener</span><span class="token punctuation">(</span>destination <span class="token operator">=</span> <span class="token string">&quot;jms/queue/mail&quot;</span><span class="token punctuation">,</span> concurrency <span class="token operator">=</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMailMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;received message:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token keyword">instanceof</span> <span class="token class-name">TextMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TextMessage</span><span class="token punctuation">)</span> message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MailMessage</span> mm <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token class-name">MailMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mailService<span class="token punctuation">.</span><span class="token function">sendRegistrationMail</span><span class="token punctuation">(</span>mm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;unable to process non-text message!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ° <code>@JmsListener</code> æŒ‡å®šäº† Queue çš„åç§°ï¼Œå› æ­¤ï¼Œå‡¡æ˜¯å‘åˆ°æ­¤ Queue çš„æ¶ˆæ¯éƒ½ä¼šè¢«è¿™ä¸ª <code>onMailMessageReceived()</code> æ–¹æ³•å¤„ç†ï¼Œæ–¹æ³•å‚æ•°æ˜¯ JMS çš„ <code>Message</code> æ¥å£ï¼Œæˆ‘ä»¬é€šè¿‡å¼ºåˆ¶è½¬å‹ä¸º <code>TextMessage</code> å¹¶æå– JSONï¼Œååºåˆ—åŒ–åè·å¾—è‡ªå®šä¹‰çš„ JavaBeanï¼Œä¹Ÿå°±è·å¾—äº†å‘é€é‚®ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>ä¸‹é¢é—®é¢˜æ¥äº†ï¼šSpring å¤„ç† JMS æ¶ˆæ¯çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨ JMS çš„ API æ¥å¤„ç†æ¶ˆæ¯ï¼Œé‚£ä¹ˆç¼–å†™çš„ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åˆ›å»º JMS è¿æ¥:</span>
<span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆ›å»ºä¼šè¯:</span>
<span class="token class-name">Session</span> session <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token constant">AUTO_ACKNOWLEDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆ›å»ºä¸€ä¸ª Consumer:</span>
<span class="token class-name">MessageConsumer</span> consumer <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createConsumer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸º Consumer æŒ‡å®šä¸€ä¸ªæ¶ˆæ¯å¤„ç†å™¨:</span>
consumer<span class="token punctuation">.</span><span class="token function">setMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åœ¨æ­¤å¤„ç†æ¶ˆæ¯...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¯åŠ¨æ¥æ”¶æ¶ˆæ¯çš„å¾ªç¯:</span>
connection<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ <code>MailMessageListener.onMailMessageReceived()</code> ç›¸å½“äºæ¶ˆæ¯å¤„ç†å™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>consumer<span class="token punctuation">.</span><span class="token function">setMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mailMessageListener<span class="token punctuation">.</span><span class="token function">onMailMessageReceived</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼ŒSpring æ ¹æ® <code>AppConfig</code> çš„æ³¨è§£ <code>@EnableJms</code> è‡ªåŠ¨æ‰«æå¸¦æœ‰ <code>@JmsListener</code> çš„ Bean æ–¹æ³•ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºä¸€ä¸ª <code>MessageListener</code> æŠŠå®ƒåŒ…è£…èµ·æ¥ã€‚</p><p>æ³¨æ„åˆ°å‰é¢æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª <code>JmsListenerContainerFactory</code> çš„ Beanï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸ºæ¯ä¸ª <code>MessageListener</code> åˆ›å»º <code>MessageConsumer</code> å¹¶å¯åŠ¨æ¶ˆæ¯æ¥æ”¶å¾ªç¯ã€‚</p><p>å†æ³¨æ„åˆ° <code>@JmsListener</code> è¿˜æœ‰ä¸€ä¸ª <code>concurrency</code> å‚æ•°ï¼Œ10 è¡¨ç¤ºå¯ä»¥æœ€å¤šåŒæ—¶å¹¶å‘å¤„ç† 10 ä¸ªæ¶ˆæ¯ï¼Œ<code>5-10</code> è¡¨ç¤ºå¹¶å‘å¤„ç†çš„çº¿ç¨‹å¯ä»¥åœ¨ 5~10 ä¹‹é—´è°ƒæ•´ã€‚</p><p>å› æ­¤ï¼ŒSpring åœ¨é€šè¿‡ <code>MessageListener</code> æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨ <code>mailMessageListener.onMailMessageReceived()</code>ï¼Œè€Œæ˜¯ç”¨çº¿ç¨‹æ± è°ƒç”¨ï¼Œå› æ­¤ï¼Œè¦æ—¶åˆ»ç‰¢è®°ï¼Œ<code>onMailMessageReceived()</code> æ–¹æ³•å¯èƒ½è¢«å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä¸€å®šè¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ Spring æ¥æ”¶æ¶ˆæ¯çš„æ­¥éª¤ï¼š</p><p>é€šè¿‡ <code>JmsListenerContainerFactory</code> é…åˆ <code>@EnableJms</code> æ‰«ææ‰€æœ‰ <code>@JmsListener</code> æ–¹æ³•ï¼Œè‡ªåŠ¨åˆ›å»º <code>MessageConsumer</code>ã€<code>MessageListener</code> ä»¥åŠçº¿ç¨‹æ± ï¼Œå¯åŠ¨æ¶ˆæ¯å¾ªç¯æ¥æ”¶å¤„ç†æ¶ˆæ¯ï¼Œæœ€ç»ˆç”±æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ <code>@JmsListener</code> æ–¹æ³•å¤„ç†æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šç”±å¤šçº¿ç¨‹åŒæ—¶å¹¶å‘å¤„ç†ã€‚</p><p>è¦éªŒè¯æ¶ˆæ¯å‘é€å’Œå¤„ç†ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—è¾“å‡ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2020-06-02 08:04:27 INFO  c.i.learnjava.web.UserController - user registered: bob@example.com
2020-06-02 08:04:27 INFO  c.i.l.service.MailMessageListener - received message: ActiveMQMessage[ID:9fc5...]:PERSISTENT/ClientMessageImpl[messageID=983, durable=true, address=jms/queue/mail, ...]
2020-06-02 08:04:27 INFO  c.i.learnjava.service.MailService - [send mail] sending registration mail to bob@example.com...
2020-06-02 08:04:30 INFO  c.i.learnjava.service.MailService - [send mail] registration mail was sent to bob@example.com.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œæ¶ˆæ¯è¢«æˆåŠŸå‘é€åˆ° Artemisï¼Œç„¶ååœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¢«æ¥æ”¶å¤„ç†äº†ã€‚</p><p>ä½¿ç”¨æ¶ˆæ¯æœåŠ¡å¯¹å‘é€ Email è¿›è¡Œæ”¹é€ çš„å¥½å¤„æ˜¯ï¼Œå‘é€ Email çš„èƒ½åŠ›é€šå¸¸æ˜¯æœ‰é™çš„ï¼Œé€šè¿‡ JMS æ¶ˆæ¯æœåŠ¡ï¼Œå¦‚æœçŸ­æ—¶é—´å†…éœ€è¦ç»™å¤§é‡ç”¨æˆ·å‘é€ Emailï¼Œå¯ä»¥å…ˆæŠŠæ¶ˆæ¯å †ç§¯åœ¨ JMS æœåŠ¡å™¨ä¸Šæ…¢æ…¢å‘é€ï¼Œå¯¹äºæ‰¹é‡å‘é€é‚®ä»¶ã€çŸ­ä¿¡ç­‰å°¤å…¶æœ‰ç”¨ã€‚</p><h3 id="ç»ƒä¹ -1" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -1" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1" aria-hidden="true">#</a> å°ç»“</h3><p>JMS æ˜¯ Java æ¶ˆæ¯æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ JMS æœåŠ¡å™¨å®ç°æ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†ã€‚</p><p>æ¶ˆæ¯æœåŠ¡ä¸»è¦è§£å†³ Producer å’Œ Consumer ç”Ÿäº§å’Œå¤„ç†é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨-scheduler" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-scheduler" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ Scheduler</h2><p>åœ¨å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ï¼Œç»å¸¸éœ€è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ¯å¤©æˆ–æ¯æœˆç»™ç”¨æˆ·å‘é€è´¦æˆ·æ±‡æ€»æŠ¥è¡¨ï¼Œå®šæœŸæ£€æŸ¥å¹¶å‘é€ç³»ç»ŸçŠ¶æ€æŠ¥å‘Šï¼Œç­‰ç­‰ã€‚</p>`,71),D={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1306581130018849",target:"_blank",rel:"noopener noreferrer"},Q=i(`<p>æˆ‘ä»¬è¿˜æ˜¯ä»¥å®é™…ä»£ç ä¸ºä¾‹ï¼Œå»ºç«‹å·¥ç¨‹ <code>spring-integration-schedule</code>ï¼Œæ— éœ€é¢å¤–çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ <code>AppConfig</code> ä¸­åŠ ä¸Š <code>@EnableScheduling</code> å°±å¼€å¯äº†å®šæ—¶ä»»åŠ¡çš„æ”¯æŒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@EnableScheduling</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;classpath:/jdbc.properties&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/task.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ª Bean ä¸­ç¼–å†™ä¸€ä¸ª <code>public void</code> æ— å‚æ•°æ–¹æ³•ï¼Œç„¶ååŠ ä¸Š <code>@Scheduled</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskService</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>initialDelay <span class="token operator">=</span> <span class="token number">60_000</span><span class="token punctuation">,</span> fixedRate <span class="token operator">=</span> <span class="token number">60_000</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkSystemStatusEveryMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Start check system status...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°æ³¨è§£æŒ‡å®šäº†å¯åŠ¨å»¶è¿Ÿ 60 ç§’ï¼Œå¹¶ä»¥ 60 ç§’çš„é—´éš”æ‰§è¡Œä»»åŠ¡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å®šæ—¶ä»»åŠ¡æ‰“å°çš„æ—¥å¿—ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2020</span>-06-03 <span class="token number">18</span>:47:32 INFO  <span class="token punctuation">[</span>pool-1-thread-1<span class="token punctuation">]</span> c.i.learnjava.service.TaskService - Start check system status<span class="token punctuation">..</span>.
<span class="token number">2020</span>-06-03 <span class="token number">18</span>:48:32 INFO  <span class="token punctuation">[</span>pool-1-thread-1<span class="token punctuation">]</span> c.i.learnjava.service.TaskService - Start check system status<span class="token punctuation">..</span>.
<span class="token number">2020</span>-06-03 <span class="token number">18</span>:49:32 INFO  <span class="token punctuation">[</span>pool-1-thread-1<span class="token punctuation">]</span> c.i.learnjava.service.TaskService - Start check system status<span class="token punctuation">..</span>.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ²¡æœ‰çœ‹åˆ°å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—ï¼Œéœ€è¦æ£€æŸ¥ï¼š</p><ul><li>æ˜¯å¦å¿˜è®°äº†åœ¨ <code>AppConfig</code> ä¸­æ ‡æ³¨ <code>@EnableScheduling</code>ï¼›</li><li>æ˜¯å¦å¿˜è®°äº†åœ¨å®šæ—¶ä»»åŠ¡çš„æ–¹æ³•æ‰€åœ¨çš„ class æ ‡æ³¨ <code>@Component</code>ã€‚</li></ul>`,8),F=n("code",null,"fixedRate",-1),I=n("code",null,"fixedDelay",-1),O={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1306581130018849",target:"_blank",rel:"noopener noreferrer"},V=i(`<p>æœ‰çš„ç«¥é‹åœ¨å®é™…å¼€å‘ä¸­ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸º Java çš„æ³¨è§£å…¨éƒ¨æ˜¯å¸¸é‡ï¼Œå†™æ­»äº† <code>fixedDelay=30000</code>ï¼Œå¦‚æœæ ¹æ®å®é™…æƒ…å†µè¦æ”¹æˆ 60 ç§’æ€ä¹ˆåŠï¼Œåªèƒ½é‡æ–°ç¼–è¯‘ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥æŠŠå®šæ—¶ä»»åŠ¡çš„é…ç½®æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ <code>task.properties</code>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>task.checkDiskSpace=30000

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±å¯ä»¥éšæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶è€Œæ— éœ€åŠ¨ä»£ç ã€‚ä½†æ˜¯åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ <code>fixedDelayString</code> å–ä»£ <code>fixedDelay</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>initialDelay <span class="token operator">=</span> <span class="token number">30_000</span><span class="token punctuation">,</span> fixedDelayString <span class="token operator">=</span> <span class="token string">&quot;\${task.checkDiskSpace:30000}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkDiskSpaceEveryMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Start check disk space...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°ä¸Šè¿°ä»£ç çš„æ³¨è§£å‚æ•° <code>fixedDelayString</code> æ˜¯ä¸€ä¸ªå±æ€§å ä½ç¬¦ï¼Œå¹¶é…æœ‰é»˜è®¤å€¼ 30000ï¼ŒSpring åœ¨å¤„ç† <code>@Scheduled</code> æ³¨è§£æ—¶ï¼Œå¦‚æœé‡åˆ° <code>String</code>ï¼Œä¼šæ ¹æ®å ä½ç¬¦è‡ªåŠ¨ç”¨é…ç½®é¡¹æ›¿æ¢ï¼Œè¿™æ ·å°±å¯ä»¥çµæ´»åœ°ä¿®æ”¹å®šæ—¶ä»»åŠ¡çš„é…ç½®ã€‚</p><p>æ­¤å¤–ï¼Œ<code>fixedDelayString</code> è¿˜å¯ä»¥ä½¿ç”¨æ›´æ˜“è¯»çš„ <code>Duration</code>ï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Scheduled(initialDelay = 30_000, fixedDelayString = &quot;\${task.checkDiskSpace:PT2M30S}&quot;)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,8),X=n("code",null,"PT2M30S",-1),R=n("code",null,"Duration",-1),N={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1303871087444002",target:"_blank",rel:"noopener noreferrer"},H=i(`<p>å¤šä¸ª <code>@Scheduled</code> æ–¹æ³•å®Œå…¨å¯ä»¥æ”¾åˆ°ä¸€ä¸ª Bean ä¸­ï¼Œè¿™æ ·ä¾¿äºç»Ÿä¸€ç®¡ç†å„ç±»å®šæ—¶ä»»åŠ¡ã€‚</p><h3 id="ä½¿ç”¨-cron-ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-cron-ä»»åŠ¡" aria-hidden="true">#</a> ä½¿ç”¨ Cron ä»»åŠ¡</h3><p>è¿˜æœ‰ä¸€ç±»å®šæ—¶ä»»åŠ¡ï¼Œå®ƒä¸æ˜¯ç®€å•çš„é‡å¤æ‰§è¡Œï¼Œè€Œæ˜¯æŒ‰æ—¶é—´è§¦å‘ï¼Œæˆ‘ä»¬æŠŠè¿™ç±»ä»»åŠ¡ç§°ä¸º Cron ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p><ul><li>æ¯å¤©å‡Œæ™¨ 2:15 æ‰§è¡ŒæŠ¥è¡¨ä»»åŠ¡ï¼›</li><li>æ¯ä¸ªå·¥ä½œæ—¥ 12:00 æ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼›</li><li>...</li></ul><p>Cron æºè‡ª Unix/Linux ç³»ç»Ÿè‡ªå¸¦çš„ crond å®ˆæŠ¤è¿›ç¨‹ï¼Œä»¥ä¸€ä¸ªç®€æ´çš„è¡¨è¾¾å¼å®šä¹‰ä»»åŠ¡è§¦å‘æ—¶é—´ã€‚åœ¨ Spring ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Cron è¡¨è¾¾å¼æ¥æ‰§è¡Œ Cron ä»»åŠ¡ï¼Œåœ¨ Spring ä¸­ï¼Œå®ƒçš„æ ¼å¼æ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ç§’ åˆ† å°æ—¶ å¤© æœˆä»½ æ˜ŸæœŸ å¹´

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹´æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œé€šå¸¸ä¸å†™ã€‚æ¯å¤©å‡Œæ™¨ 2:15 æ‰§è¡Œçš„ Cron è¡¨è¾¾å¼å°±æ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0 15 2 * * *

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªå·¥ä½œæ—¥ 12:00 æ‰§è¡Œçš„ Cron è¡¨è¾¾å¼å°±æ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0 0 12 * * MON-FRI

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªæœˆ 1 å·ï¼Œ2 å·ï¼Œ3 å·å’Œ 10 å· 12:00 æ‰§è¡Œçš„ Cron è¡¨è¾¾å¼å°±æ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0 0 12 1-3,10 * *

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Spring ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¯å¤©å‡Œæ™¨ 2:15 æ‰§è¡Œçš„ä»»åŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;\${task.report:0 15 2 * * *}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cronDailyReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Start daily report task...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cron ä»»åŠ¡åŒæ ·å¯ä»¥ä½¿ç”¨å±æ€§å ä½ç¬¦ï¼Œè¿™æ ·ä¿®æ”¹èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</p><p>Cron è¡¨è¾¾å¼è¿˜å¯ä»¥è¡¨è¾¾æ¯ 10 åˆ†é’Ÿæ‰§è¡Œï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0 */10 * * * *

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œåœ¨æ¯ä¸ªå°æ—¶çš„ 0:00ï¼Œ10:00ï¼Œ20:00ï¼Œ30:00ï¼Œ40:00ï¼Œ50:00 å‡ä¼šæ‰§è¡Œä»»åŠ¡ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥å–ä»£ <code>fixedRate</code> ç±»å‹çš„å®šæ—¶ä»»åŠ¡ã€‚</p><h3 id="é›†æˆ-quartz" tabindex="-1"><a class="header-anchor" href="#é›†æˆ-quartz" aria-hidden="true">#</a> é›†æˆ Quartz</h3><p>åœ¨ Spring ä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡å’Œ Cron ä»»åŠ¡éƒ½ååˆ†ç®€å•ï¼Œä½†æ˜¯è¦æ³¨æ„åˆ°ï¼Œè¿™äº›ä»»åŠ¡çš„è°ƒåº¦éƒ½æ˜¯åœ¨æ¯ä¸ª JVM è¿›ç¨‹ä¸­çš„ã€‚å¦‚æœåœ¨æœ¬æœºå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œæˆ–è€…åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨åº”ç”¨ï¼Œè¿™äº›è¿›ç¨‹çš„å®šæ—¶ä»»åŠ¡å’Œ Cron ä»»åŠ¡éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œäº’ä¸å½±å“ã€‚</p>`,20),W={href:"https://www.quartz-scheduler.org/",target:"_blank",rel:"noopener noreferrer"},z=n("p",null,"Quartz å¯ä»¥é…ç½®ä¸€ä¸ª JDBC æ•°æ®æºï¼Œä»¥ä¾¿å­˜å‚¨æ‰€æœ‰çš„ä»»åŠ¡è°ƒåº¦è®¡åˆ’ä»¥åŠä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å†…å­˜æ¥è°ƒåº¦ä»»åŠ¡ï¼Œä½†è¿™æ ·é…ç½®å°±å’Œä½¿ç”¨ Spring çš„è°ƒåº¦æ²¡å•¥åŒºåˆ«äº†ï¼Œé¢å¤–é›†æˆ Quartz çš„æ„ä¹‰å°±ä¸å¤§ã€‚",-1),$={href:"https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling-quartz",target:"_blank",rel:"noopener noreferrer"},U=i(`<p>æ€è€ƒï¼šå¦‚æœä¸ä½¿ç”¨ Quartz çš„ JDBC é…ç½®ï¼Œå¤šä¸ª Spring åº”ç”¨åŒæ—¶è¿è¡Œæ—¶ï¼Œå¦‚ä½•ä¿è¯æŸä¸ªä»»åŠ¡åªåœ¨æŸä¸€å°æœºå™¨æ‰§è¡Œï¼Ÿ</p><h3 id="ç»ƒä¹ -2" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -2" aria-hidden="true">#</a> ç»ƒä¹ </h3><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2" aria-hidden="true">#</a> å°ç»“</h3><p>Spring å†…ç½®å®šæ—¶ä»»åŠ¡å’Œ Cron ä»»åŠ¡çš„æ”¯æŒï¼Œç¼–å†™è°ƒåº¦ä»»åŠ¡ååˆ†æ–¹ä¾¿ã€‚</p><h2 id="ğŸ€-é›†æˆ-jmx" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é›†æˆ-jmx" aria-hidden="true">#</a> ğŸ€ é›†æˆ JMX</h2><p>åœ¨ Spring ä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°é›†æˆ JMXã€‚</p><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼šä»€ä¹ˆæ˜¯ JMXï¼Ÿ</p><p>JMX æ˜¯ Java Management Extensionsï¼Œå®ƒæ˜¯ä¸€ä¸ª Java å¹³å°çš„ç®¡ç†å’Œç›‘æ§æ¥å£ã€‚ä¸ºä»€ä¹ˆè¦æ JMX å‘¢ï¼Ÿå› ä¸ºåœ¨æ‰€æœ‰çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯¹è¿è¡Œä¸­çš„ç¨‹åºè¿›è¡Œç›‘æ§éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼ŒJava åº”ç”¨ç¨‹åºä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘ä»¬è‚¯å®šå¸Œæœ›çŸ¥é“ Java åº”ç”¨ç¨‹åºå½“å‰çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå ç”¨äº†å¤šå°‘å†…å­˜ï¼Œåˆ†é…äº†å¤šå°‘å†…å­˜ï¼Œå½“å‰æœ‰å¤šå°‘æ´»åŠ¨çº¿ç¨‹ï¼Œæœ‰å¤šå°‘ä¼‘çœ çº¿ç¨‹ç­‰ç­‰ã€‚å¦‚ä½•è·å–è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿ</p><p>ä¸ºäº†æ ‡å‡†åŒ–ç®¡ç†å’Œç›‘æ§ï¼ŒJava å¹³å°ä½¿ç”¨ JMX ä½œä¸ºç®¡ç†å’Œç›‘æ§çš„æ ‡å‡†æ¥å£ï¼Œä»»ä½•ç¨‹åºï¼Œåªè¦æŒ‰ JMX è§„èŒƒè®¿é—®è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è·å–æ‰€æœ‰ç®¡ç†ä¸ç›‘æ§ä¿¡æ¯ã€‚</p><p>å®é™…ä¸Šï¼Œå¸¸ç”¨çš„è¿ç»´ç›‘æ§å¦‚ Zabbixã€Nagios ç­‰å·¥å…·å¯¹ JVM æœ¬èº«çš„ç›‘æ§éƒ½æ˜¯é€šè¿‡ JMX è·å–çš„ä¿¡æ¯ã€‚</p><p>å› ä¸º JMX æ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œä¸ä½†å¯ä»¥ç”¨äºç®¡ç† JVMï¼Œè¿˜å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºè‡ªèº«ã€‚ä¸‹å›¾æ˜¯ JMX çš„æ¶æ„ï¼š</p><div class="language-ascii line-numbers-mode" data-ext="ascii"><pre class="language-ascii"><code>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚jconsole â”‚  â”‚   Web   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚
â”Œ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”¼ â”€ â”€ â”€ â”€
 JVM     â–¼            â–¼        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”Œâ”€â”¤Connectorâ”œâ”€â”€â”¤ Adaptor â”œâ”€â” â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚       MBeanServer        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
  â””â”€â”¤MBean1â”œâ”¤MBean2â”œâ”¤MBean3â”œâ”€â”˜ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
 â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JMX æŠŠæ‰€æœ‰è¢«ç®¡ç†çš„èµ„æºéƒ½ç§°ä¸º MBeanï¼ˆManaged Beanï¼‰ï¼Œè¿™äº› MBean å…¨éƒ¨ç”± MBeanServer ç®¡ç†ï¼Œå¦‚æœè¦è®¿é—® MBeanï¼Œå¯ä»¥é€šè¿‡ MBeanServer å¯¹å¤–æä¾›çš„è®¿é—®æ¥å£ï¼Œä¾‹å¦‚é€šè¿‡ RMI æˆ– HTTP è®¿é—®ã€‚</p><p>æ³¨æ„åˆ°ä½¿ç”¨ JMX ä¸éœ€è¦å®‰è£…ä»»ä½•é¢å¤–ç»„ä»¶ï¼Œä¹Ÿä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ï¼Œå› ä¸º MBeanServer å·²ç»å†…ç½®åœ¨ JavaSE æ ‡å‡†åº“ä¸­äº†ã€‚JavaSE è¿˜æä¾›äº†ä¸€ä¸ª <code>jconsole</code> ç¨‹åºï¼Œç”¨äºé€šè¿‡ RMI è¿æ¥åˆ° MBeanServerï¼Œè¿™æ ·å°±å¯ä»¥ç®¡ç†æ•´ä¸ª Java è¿›ç¨‹ã€‚</p><p>é™¤äº† JVM ä¼šæŠŠè‡ªèº«çš„å„ç§èµ„æºä»¥ MBean æ³¨å†Œåˆ° JMX ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±çš„é…ç½®ã€ç›‘æ§ä¿¡æ¯ä¹Ÿå¯ä»¥ä½œä¸º MBean æ³¨å†Œåˆ° JMXï¼Œè¿™æ ·ï¼Œç®¡ç†ç¨‹åºå°±å¯ä»¥ç›´æ¥æ§åˆ¶æˆ‘ä»¬æš´éœ²çš„ MBeanã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ JMXï¼Œåªéœ€è¦ä¸¤æ­¥ï¼š</p><ol><li>ç¼–å†™ MBean æä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ï¼›</li><li>æ³¨å†Œ MBeanã€‚</li></ol><p>åœ¨ Spring åº”ç”¨ç¨‹åºä¸­ï¼Œä½¿ç”¨ JMX åªéœ€è¦ä¸€æ­¥ï¼š</p><ol><li>ç¼–å†™ MBean æä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ã€‚</li></ol><p>ç¬¬äºŒæ­¥æ³¨å†Œçš„è¿‡ç¨‹ç”± Spring è‡ªåŠ¨å®Œæˆã€‚æˆ‘ä»¬ä»¥å®é™…å·¥ç¨‹ä¸ºä¾‹ï¼Œé¦–å…ˆåœ¨ <code>AppConfig</code> ä¸­åŠ ä¸Š <code>@EnableMBeanExport</code> æ³¨è§£ï¼Œå‘Šè¯‰ Spring è‡ªåŠ¨æ³¨å†Œ MBeanï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Configuration
@ComponentScan
@EnableWebMvc
@EnableMBeanExport // è‡ªåŠ¨æ³¨å†Œ MBean
@EnableTransactionManagement
@PropertySource({&quot;classpath:/jdbc.properties&quot;})
public class AppConfig {
    ...
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰©ä¸‹çš„å…¨éƒ¨å·¥ä½œå°±æ˜¯ç¼–å†™ MBeanã€‚æˆ‘ä»¬ä»¥å®é™…é—®é¢˜ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›ç»™åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ª IP é»‘åå•åŠŸèƒ½ï¼Œå‡¡æ˜¯åœ¨é»‘åå•ä¸­çš„ IP ç¦æ­¢è®¿é—®ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨çš„æ—¶å€™è¯»å–ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>## ğŸ€ blacklist.txt
1.2.3.4
5.6.7.8
2.2.3.4
...

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ä¿®æ”¹é»‘åå•æ€ä¹ˆåŠï¼Ÿä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯åº”ç”¨ç¨‹åºã€‚</p><p>ä½†æ˜¯æ¯æ¬¡éƒ½é‡å¯åº”ç”¨ç¨‹åºå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½ä¸é‡å¯åº”ç”¨ç¨‹åºï¼Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå®šæ—¶è¯»å–é…ç½®æ–‡ä»¶çš„åŠŸèƒ½ï¼Œæ£€æµ‹åˆ°æ–‡ä»¶æ”¹åŠ¨æ—¶è‡ªåŠ¨é‡æ–°è¯»å–ã€‚</p><p>ä¸Šè¿°éœ€æ±‚æœ¬è´¨ä¸Šæ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´å¯¹å‚æ•°ã€é…ç½®ç­‰è¿›è¡Œçƒ­æ›´æ–°å¹¶è¦æ±‚å°½å¿«ç”Ÿæ•ˆã€‚å¦‚æœä»¥ JMX çš„æ–¹å¼å®ç°ï¼Œæˆ‘ä»¬ä¸å¿…è‡ªå·±ç¼–å†™è‡ªåŠ¨é‡æ–°è¯»å–ç­‰ä»»ä½•ä»£ç ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªç¬¦åˆ JMX æ ‡å‡†çš„ MBean æ¥å­˜å‚¨é…ç½®å³å¯ã€‚</p><p>è¿˜æ˜¯ä»¥ IP é»‘åå•ä¸ºä¾‹ï¼ŒJMX çš„ MBean é€šå¸¸ä»¥ MBean ç»“å°¾ï¼Œå› æ­¤æˆ‘ä»¬éµå¾ªæ ‡å‡†å‘½åè§„èŒƒï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ª <code>BlacklistMBean</code>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public class BlacklistMBean {
    private Set&lt;String&gt; ips = new HashSet&lt;&gt;();

    public String[] getBlacklist() {
        return ips.toArray(String[]::new);
    }

    public void addBlacklist(String ip) {
        ips.add(ip);
    }

    public void removeBlacklist(String ip) {
        ips.remove(ip);
    }

    public boolean shouldBlock(String ip) {
        return ips.contains(ip);
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª MBean æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œå®ƒçš„é€»è¾‘å’Œæ™®é€š Java ç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ JMX çš„å®¢æˆ·ç«¯æ¥å®æ—¶çƒ­æ›´æ–°è¿™ä¸ª MBeanï¼Œæ‰€ä»¥è¦ç»™å®ƒåŠ ä¸Šä¸€äº›æ³¨è§£ï¼Œè®© Spring èƒ½æ ¹æ®æ³¨è§£è‡ªåŠ¨æŠŠç›¸å…³æ–¹æ³•æ³¨å†Œåˆ° MBeanServer ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ManagedResource</span><span class="token punctuation">(</span>objectName <span class="token operator">=</span> <span class="token string">&quot;sample:name=blacklist&quot;</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">&quot;Blacklist of IP addresses&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlacklistMBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ips <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManagedAttribute</span><span class="token punctuation">(</span>description <span class="token operator">=</span> <span class="token string">&quot;Get IP addresses in blacklist&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBlacklist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ips<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ManagedOperation</span>
    <span class="token annotation punctuation">@ManagedOperationParameter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;ip&quot;</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">&quot;Target IP address that will be added to blacklist&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addBlacklist</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ips<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ManagedOperation</span>
    <span class="token annotation punctuation">@ManagedOperationParameter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;ip&quot;</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">&quot;Target IP address that will be removed from blacklist&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeBlacklist</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ips<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">shouldBlock</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ips<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œ<code>BlacklistMBean</code> é¦–å…ˆæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Spring ç®¡ç†çš„ Beanï¼Œå…¶æ¬¡ï¼Œæ·»åŠ äº† <code>@ManagedResource</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª MBeanï¼Œå°†è¦è¢«æ³¨å†Œåˆ° JMXã€‚objectName æŒ‡å®šäº†è¿™ä¸ª MBean çš„åå­—ï¼Œé€šå¸¸ä»¥ <code>company:name=Xxx</code> æ¥åˆ†ç±» MBeanã€‚</p><p>å¯¹äºå±æ€§ï¼Œä½¿ç”¨ <code>@ManagedAttribute</code> æ³¨è§£æ ‡æ³¨ã€‚ä¸Šè¿° MBean åªæœ‰ get å±æ€§ï¼Œæ²¡æœ‰ set å±æ€§ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ã€‚</p><p>å¯¹äºæ“ä½œï¼Œä½¿ç”¨ <code>@ManagedOperation</code> æ³¨è§£æ ‡å‡†ã€‚ä¸Šè¿° MBean å®šä¹‰äº†ä¸¤ä¸ªæ“ä½œï¼š<code>addBlacklist()</code> å’Œ <code>removeBlacklist()</code>ï¼Œå…¶ä»–æ–¹æ³•å¦‚ <code>shouldBlock()</code> ä¸ä¼šè¢«æš´éœ²ç»™ JMXã€‚</p><p>ä½¿ç”¨ MBean å’Œæ™®é€š Bean æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ <code>BlacklistInterceptor</code> å¯¹ IP è¿›è¡Œé»‘åå•æ‹¦æˆªï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Order(1)
@Component
public class BlacklistInterceptor implements HandlerInterceptor {
    final Logger logger = LoggerFactory.getLogger(getClass());

    @Autowired
    BlacklistMBean blacklistMBean;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
            throws Exception {
        String ip = request.getRemoteAddr();
        logger.info(&quot;check ip address {}...&quot;, ip);
        // æ˜¯å¦åœ¨é»‘åå•ä¸­:
        if (blacklistMBean.shouldBlock(ip)) {
            logger.warn(&quot;will block ip {} for it is in blacklist.&quot;, ip);
            // å‘é€ 403 é”™è¯¯å“åº”:
            response.sendError(403);
            return false;
        }
        return true;
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ­£å¸¸å¯åŠ¨ Web åº”ç”¨ç¨‹åºï¼Œä¸è¦å…³é—­å®ƒï¼Œæˆ‘ä»¬æ‰“å¼€å¦ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥ <code>jconsole</code> å¯åŠ¨ JavaSE è‡ªå¸¦çš„ä¸€ä¸ª JMX å®¢æˆ·ç«¯ç¨‹åºï¼š</p><figure><img src="`+d+'" alt="jconsole" tabindex="0" loading="lazy"><figcaption>jconsole</figcaption></figure><p>é€šè¿‡ jconsole è¿æ¥åˆ°ä¸€ä¸ª Java è¿›ç¨‹æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨ Local Process ä¸­æ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„ <code>AppConfig</code>ï¼Œç‚¹å‡» Connect å³å¯è¿æ¥åˆ°æˆ‘ä»¬å½“å‰æ­£åœ¨è¿è¡Œçš„ Web åº”ç”¨ï¼Œåœ¨ jconsole ä¸­å¯ç›´æ¥çœ‹åˆ°å†…å­˜ã€CPU ç­‰èµ„æºçš„ç›‘æ§ã€‚</p><p>æˆ‘ä»¬ç‚¹å‡» MBeanï¼Œå·¦ä¾§æŒ‰åˆ†ç±»åˆ—å‡ºæ‰€æœ‰ MBeanï¼Œå¯ä»¥åœ¨ <code>java.lang</code> æŸ¥çœ‹å†…å­˜ç­‰ä¿¡æ¯ï¼š</p><figure><img src="'+r+'" alt="mbean" tabindex="0" loading="lazy"><figcaption>mbean</figcaption></figure><p>ç»†å¿ƒçš„ç«¥é‹å¯ä»¥çœ‹åˆ° HikariCP è¿æ¥æ± ä¹Ÿæ˜¯é€šè¿‡ JMX ç›‘æ§çš„ã€‚</p><p>åœ¨ <code>sample</code> ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå·±çš„ MBeanï¼Œç‚¹å‡»å¯æŸ¥çœ‹å±æ€§ <code>blacklist</code>ï¼š</p><figure><img src="'+v+'" alt="mbean-value" tabindex="0" loading="lazy"><figcaption>mbean-value</figcaption></figure><p>ç‚¹å‡» <code>Operations</code>-<code>addBlacklist</code>ï¼Œå¯ä»¥å¡«å…¥ <code>127.0.0.1</code> å¹¶ç‚¹å‡» <code>addBlacklist</code> æŒ‰é’®ï¼Œç›¸å½“äº jconsole é€šè¿‡ JMX æ¥å£ï¼Œè°ƒç”¨äº†æˆ‘ä»¬è‡ªå·±çš„ <code>BlacklistMBean</code> çš„ <code>addBlacklist()</code> æ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°å°±æ˜¯å¡«å…¥çš„ <code>127.0.0.1</code>ï¼š</p><figure><img src="'+k+'" alt="mbean-invoke-ok" tabindex="0" loading="lazy"><figcaption>mbean-invoke-ok</figcaption></figure><p>å†æ¬¡æŸ¥çœ‹å±æ€§ <code>blacklist</code>ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœå·²ç»æ›´æ–°äº†ï¼š</p><figure><img src="'+m+'" alt="mbean-modified" tabindex="0" loading="lazy"><figcaption>mbean-modified</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸€ä¸‹é»‘åå•åŠŸèƒ½æ˜¯å¦å·²ç”Ÿæ•ˆï¼š</p><figure><img src="'+b+`" alt="403" tabindex="0" loading="lazy"><figcaption>403</figcaption></figure><p>å¯è§ï¼Œ<code>127.0.0.1</code> ç¡®å®è¢«æ·»åŠ åˆ°äº†é»‘åå•ï¼Œåå°æ—¥å¿—æ‰“å°å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2020-06-06 20:22:12 INFO  c.i.l.web.BlacklistInterceptor - check ip address 127.0.0.1...
2020-06-06 20:22:12 WARN  c.i.l.web.BlacklistInterceptor - will block ip 127.0.0.1 for it is in blacklist.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨ IPv6ï¼Œé‚£ä¹ˆéœ€è¦æŠŠ <code>0:0:0:0:0:0:0:1</code> è¿™ä¸ªæœ¬æœºåœ°å€åŠ åˆ°é»‘åå•ã€‚</p><p>å¦‚æœä» jconsole ä¸­è°ƒç”¨ <code>removeBlacklist</code> ç§»é™¤ <code>127.0.0.1</code>ï¼Œåˆ·æ–°æµè§ˆå™¨å¯ä»¥çœ‹åˆ°åˆå…è®¸è®¿é—®äº†ã€‚</p><p>ä½¿ç”¨ jconsole ç›´æ¥é€šè¿‡ Local Process è¿æ¥ JVM æœ‰ä¸ªé™åˆ¶ï¼Œå°±æ˜¯ jconsole å’Œæ­£åœ¨è¿è¡Œçš„ JVM å¿…é¡»åœ¨åŒä¸€å°æœºå™¨ã€‚å¦‚æœè¦è¿œç¨‹è¿æ¥ï¼Œé¦–å…ˆè¦æ‰“å¼€ JMX ç«¯å£ã€‚æˆ‘ä»¬åœ¨å¯åŠ¨ <code>AppConfig</code> æ—¶ï¼Œéœ€è¦ä¼ å…¥ä»¥ä¸‹ JVM å¯åŠ¨å‚æ•°ï¼š</p><ul><li>-Dcom.sun.management.jmxremote.port=19999</li><li>-Dcom.sun.management.jmxremote.authenticate=false</li><li>-Dcom.sun.management.jmxremote.ssl=false</li></ul>`,55),G={href:"https://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html#gdeum",target:"_blank",rel:"noopener noreferrer"},K=n("code",null,"ip:19999",-1),Y=i(`<p>è®¸å¤š JavaEE æœåŠ¡å™¨å¦‚ JBoss çš„ç®¡ç†åå°éƒ½æ˜¯é€šè¿‡ JMX æä¾›ç®¡ç†æ¥å£ï¼Œå¹¶ç”± Web æ–¹å¼è®¿é—®ï¼Œå¯¹ç”¨æˆ·æ›´åŠ å‹å¥½ã€‚</p><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šè¿‡ JMX å®ç°é…ç½®çš„å®æ—¶æ›´æ–°å…¶å®å¹¶ä¸å¸¸ç”¨ï¼ŒJMX æ›´å¤šåœ°ç”¨äºæ”¶é›† JVM çš„è¿è¡ŒçŠ¶æ€å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½æ•°æ®ï¼Œç„¶åé€šè¿‡ç›‘æ§æœåŠ¡å™¨æ±‡æ€»æ•°æ®åå®ç°ç›‘æ§ä¸æŠ¥è­¦ã€‚ä¸€ä¸ªå…¸å‹çš„ç›‘æ§ç³»ç»Ÿæ¶æ„å¦‚ä¸‹ï¼š</p><div class="language-ascii line-numbers-mode" data-ext="ascii"><pre class="language-ascii"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Console  â”‚â—€â”€â”€â”‚Metrics Server â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
   â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
   â”‚ â”‚      App      â”‚      â”‚    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¤   â”Œâ”€â”€â”€â”€â”€â”
   â”‚ â”‚         â”‚ JMX â”‚â”€â”€â–¶â”‚Agentâ”‚ â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”¤   â””â”€â”€â”€â”€â”€â”˜
   â”‚ â”‚      JVM      â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),Z={href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"},nn={href:"https://www.datadoghq.com/",target:"_blank",rel:"noopener noreferrer"},sn=i('<h3 id="ç»ƒä¹ -3" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -3" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>ç¼–å†™ä¸€ä¸ª MBean ç»Ÿè®¡å½“å‰æ³¨å†Œç”¨æˆ·æ•°é‡ï¼Œå¹¶åœ¨ jconsole ä¸­æŸ¥çœ‹ï¼š</p><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3" aria-hidden="true">#</a> å°ç»“</h3><p>åœ¨ Spring ä¸­ä½¿ç”¨ JMX éœ€è¦ï¼š</p><ul><li>é€šè¿‡ <code>@EnableMBeanExport</code> å¯ç”¨è‡ªåŠ¨æ³¨å†Œ MBeanï¼›</li><li>ç¼–å†™ MBean å¹¶å®ç°ç®¡ç†å±æ€§å’Œç®¡ç†æ“ä½œã€‚</li></ul>',5);function an(en,tn){const e=o("router-link"),p=o("ExternalLinkIcon");return l(),u("div",null,[n("details",M,[h,n("nav",f,[n("ul",null,[n("li",null,[a(e,{to:"#ğŸ€-é›†æˆ-javamail"},{default:t(()=>[s("ğŸ€ é›†æˆ JavaMail")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#ç»ƒä¹ "},{default:t(()=>[s("ç»ƒä¹ ")]),_:1})]),n("li",null,[a(e,{to:"#å°ç»“"},{default:t(()=>[s("å°ç»“")]),_:1})])])]),n("li",null,[a(e,{to:"#ğŸ€-é›†æˆ-jms"},{default:t(()=>[s("ğŸ€ é›†æˆ JMS")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#ç»ƒä¹ -1"},{default:t(()=>[s("ç»ƒä¹ ")]),_:1})]),n("li",null,[a(e,{to:"#å°ç»“-1"},{default:t(()=>[s("å°ç»“")]),_:1})])])]),n("li",null,[a(e,{to:"#ğŸ€-ä½¿ç”¨-scheduler"},{default:t(()=>[s("ğŸ€ ä½¿ç”¨ Scheduler")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#ä½¿ç”¨-cron-ä»»åŠ¡"},{default:t(()=>[s("ä½¿ç”¨ Cron ä»»åŠ¡")]),_:1})]),n("li",null,[a(e,{to:"#é›†æˆ-quartz"},{default:t(()=>[s("é›†æˆ Quartz")]),_:1})]),n("li",null,[a(e,{to:"#ç»ƒä¹ -2"},{default:t(()=>[s("ç»ƒä¹ ")]),_:1})]),n("li",null,[a(e,{to:"#å°ç»“-2"},{default:t(()=>[s("å°ç»“")]),_:1})])])]),n("li",null,[a(e,{to:"#ğŸ€-é›†æˆ-jmx"},{default:t(()=>[s("ğŸ€ é›†æˆ JMX")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#ç»ƒä¹ -3"},{default:t(()=>[s("ç»ƒä¹ ")]),_:1})]),n("li",null,[a(e,{to:"#å°ç»“-3"},{default:t(()=>[s("å°ç»“")]),_:1})])])])])])]),S,_,x,w,n("p",null,[s("æˆ‘ä»¬åœ¨ "),n("a",y,[s("å‘é€ Email"),a(p)]),s(" å’Œ "),n("a",J,[s("æ¥æ”¶ Email"),a(p)]),s(" ä¸­å·²ç»ä»‹ç»äº†å¦‚ä½•é€šè¿‡ JavaMail æ¥æ”¶å‘ç”µå­é‚®ä»¶ã€‚åœ¨ Spring ä¸­ï¼ŒåŒæ ·å¯ä»¥é›†æˆ JavaMailã€‚")]),C,n("p",null,[s("å› ä¸ºæ¶ˆæ¯æœåŠ¡åœ¨å„ç±»åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ï¼Œæ‰€ä»¥ JavaEE ä¸“é—¨å®šä¹‰äº† JMS è§„èŒƒã€‚æ³¨æ„åˆ° JMS æ˜¯ä¸€ç»„æ¥å£å®šä¹‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ JMSï¼Œè¿˜éœ€è¦é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„ JMS äº§å“ã€‚å¸¸ç”¨çš„ JMS æœåŠ¡å™¨æœ‰å¼€æºçš„ "),n("a",j,[s("ActiveMQ"),a(p)]),s("ï¼Œå•†ä¸šæœåŠ¡å™¨å¦‚ WebLogicã€WebSphere ç­‰ä¹Ÿå†…ç½®äº† JMS æ”¯æŒã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¼€æºçš„ ActiveMQ ä½œä¸º JMS æœåŠ¡å™¨ï¼Œå› æ­¤ï¼Œåœ¨å¼€å‘ JMS ä¹‹å‰æˆ‘ä»¬å¿…é¡»é¦–å…ˆå®‰è£… ActiveMQã€‚")]),q,n("p",null,[s("å®é™…ä¸Š ActiveMQ Classic åŸæ¥å°±å« ActiveMQï¼Œæ˜¯ Apache å¼€å‘çš„åŸºäº JMS 1.1 çš„æ¶ˆæ¯æœåŠ¡å™¨ï¼Œç›®å‰ç¨³å®šç‰ˆæœ¬å·æ˜¯ 5.xï¼Œè€Œ ActiveMQ Artemis æ˜¯ç”± RedHat æèµ çš„ "),n("a",B,[s("HornetQ"),a(p)]),s(" æœåŠ¡å™¨ä»£ç çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œç›®å‰ç¨³å®šç‰ˆæœ¬å·æ˜¯ 2.xã€‚å’Œ ActiveMQ Classic ç›¸æ¯”ï¼ŒArtemis ç‰ˆçš„ä»£ç ä¸ Classic å®Œå…¨ä¸åŒï¼Œå¹¶ä¸”ï¼Œå®ƒæ”¯æŒ JMS 2.0ï¼Œä½¿ç”¨åŸºäº Netty çš„å¼‚æ­¥ IOï¼Œå¤§å¤§æå‡äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒArtemis ä¸ä»…æä¾›äº† JMS æ¥å£ï¼Œå®ƒè¿˜æä¾›äº† AMQP æ¥å£ï¼ŒSTOMP æ¥å£å’Œç‰©è”ç½‘ä½¿ç”¨çš„ MQTT æ¥å£ã€‚é€‰æ‹© Artemisï¼Œç›¸å½“äºä¸€é±¼å››åƒã€‚")]),n("p",null,[s("æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥é€‰æ‹© ActiveMQ Artemisã€‚ä»å®˜ç½‘ "),n("a",A,[s("ä¸‹è½½"),a(p)]),s(" æœ€æ–°çš„ 2.x ç‰ˆæœ¬ï¼Œè§£å‹åè®¾ç½®ç¯å¢ƒå˜é‡ "),T,s("ï¼ŒæŒ‡å‘ Artemis æ ¹ç›®å½•ï¼Œä¾‹å¦‚ "),E,s("ï¼Œç„¶åï¼ŒæŠŠ "),P,s(" åŠ å…¥ PATH ç¯å¢ƒå˜é‡ï¼š")]),L,n("p",null,[s("å®šæ—¶ä»»åŠ¡æˆ‘ä»¬åœ¨ "),n("a",D,[s("ä½¿ç”¨çº¿ç¨‹æ± "),a(p)]),s(" ä¸€èŠ‚ä¸­å·²ç»è®²åˆ°äº†ï¼ŒJava æ ‡å‡†åº“æœ¬èº«å°±æä¾›äº†å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚åœ¨ Spring ä¸­ï¼Œä½¿ç”¨å®šæ—¶ä»»åŠ¡æ›´ç®€å•ï¼Œä¸éœ€è¦æ‰‹å†™çº¿ç¨‹æ± ç›¸å…³ä»£ç ï¼Œåªéœ€è¦ä¸¤ä¸ªæ³¨è§£å³å¯ã€‚")]),Q,n("p",null,[s("é™¤äº†å¯ä»¥ä½¿ç”¨ "),F,s(" å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ "),I,s("ï¼Œä¸¤è€…çš„åŒºåˆ«æˆ‘ä»¬å·²ç»åœ¨ "),n("a",O,[s("ä½¿ç”¨çº¿ç¨‹æ± "),a(p)]),s(" ä¸€èŠ‚ä¸­è®²è¿‡ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚")]),V,n("p",null,[s("ä»¥å­—ç¬¦ä¸² "),X,s(" è¡¨ç¤ºçš„ "),R,s(" å°±æ˜¯ 2 åˆ† 30 ç§’ï¼Œè¯·å‚è€ƒ "),n("a",N,[s("LocalDateTime"),a(p)]),s(" ä¸€èŠ‚çš„ Duration ç›¸å…³éƒ¨åˆ†ã€‚")]),H,n("p",null,[s("å¦‚æœä¸€äº›å®šæ—¶ä»»åŠ¡è¦ä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œï¼Œä¾‹å¦‚æ¯å¤© 23:00 æ‰§è¡Œæ£€æŸ¥ä»»åŠ¡ï¼Œåªéœ€è¦é›†ç¾¤ä¸­çš„ä¸€å°è¿è¡Œå³å¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ "),n("a",W,[s("Quartz"),a(p)]),s("ã€‚")]),z,n("p",null,[s("Quartz çš„ JDBC é…ç½®æ¯”è¾ƒå¤æ‚ï¼ŒSpring å¯¹å…¶ä¹Ÿæœ‰ä¸€å®šçš„æ”¯æŒã€‚è¦è¯¦ç»†äº†è§£ Quartz çš„é›†æˆï¼Œè¯·å‚è€ƒ "),n("a",$,[s("Spring çš„æ–‡æ¡£"),a(p)]),s("ã€‚")]),U,n("p",null,[s("ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºåœ¨ 19999 ç«¯å£ç›‘å¬ JMX è¿æ¥ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ— éœ€éªŒè¯ï¼Œä¸ä½¿ç”¨ SSL è¿æ¥ï¼Œåœ¨å¼€å‘æµ‹è¯•é˜¶æ®µæ¯”è¾ƒæ–¹ä¾¿ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»æŒ‡å®šéªŒè¯æ–¹å¼å¹¶å¯ç”¨ SSLã€‚è¯¦ç»†å‚æ•°å¯å‚è€ƒ Oracle"),n("a",G,[s("å®˜æ–¹æ–‡æ¡£"),a(p)]),s("ã€‚è¿™æ · jconsole å¯ä»¥ç”¨ "),K,s(" çš„è¿œç¨‹æ–¹å¼è¿æ¥ JMXã€‚è¿æ¥åçš„æ“ä½œæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚")]),Y,n("p",null,[s("å…¶ä¸­ï¼ŒApp è‡ªèº«å’Œ JVM çš„çš„ç»Ÿè®¡æ•°æ®éƒ½é€šè¿‡ JMX æ”¶é›†å¹¶å‘é€ç»™æœ¬æœºçš„ä¸€ä¸ª Agentï¼ŒAgent å†å°†æ•°æ®å‘é€è‡³ç›‘æ§æœåŠ¡å™¨ï¼Œæœ€åä»¥å¯è§†åŒ–çš„å½¢å¼å°†ç›‘æ§æ•°æ®é€šè¿‡ Web ç­‰å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ã€‚å¸¸ç”¨çš„ç›‘æ§ç³»ç»Ÿæœ‰å¼€æºçš„ "),n("a",Z,[s("Prometheus"),a(p)]),s(" å’Œä»¥äº‘æœåŠ¡æ–¹å¼æä¾›çš„ "),n("a",nn,[s("DataDog"),a(p)]),s(" ç­‰ã€‚")]),sn])}const cn=c(g,[["render",an],["__file","5.html.vue"]]);export{cn as default};
