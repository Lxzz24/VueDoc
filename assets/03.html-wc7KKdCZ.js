import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,d as e}from"./app-CvlAI_tu.js";const t={},p=e(`<h1 id="systemctl-é’ˆå¯¹-service-ç±»å‹çš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#systemctl-é’ˆå¯¹-service-ç±»å‹çš„é…ç½®" aria-hidden="true">#</a> systemctl é’ˆå¯¹ service ç±»å‹çš„é…ç½®</h1><p>ä»¥å‰éœ€è¦å»ºç«‹ç³»ç»ŸæœåŠ¡ï¼Œéœ€è¦åœ¨ <code>/etc/init.d/</code> åˆ›å»ºå¯¹åº”çš„ bash shell script æ¥å¤„ç†ï¼Œå¦‚ä»Šåœ¨ systemd ç¯å¢ƒä¸‹ï¼Œè¯¥æ€ä¹ˆè®¾ç½®ç›¸å…³çš„æœåŠ¡å¯åŠ¨ç¯å¢ƒï¼Ÿ</p><h2 id="ğŸ€-é…ç½®æ–‡ä»¶ç›¸å…³ç›®å½•ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é…ç½®æ–‡ä»¶ç›¸å…³ç›®å½•ç®€ä»‹" aria-hidden="true">#</a> ğŸ€ é…ç½®æ–‡ä»¶ç›¸å…³ç›®å½•ç®€ä»‹</h2><p>systemd çš„é…ç½®æ–‡ä»¶å¤§éƒ¨åˆ†åœ¨ <code>/usr/lib/systemd/system/</code> ç›®å½•å†…ï¼ŒRed Hat å®˜æ–¹æ–‡ä»¶æŒ‡å‡ºï¼Œè¯¥ç›®å½•çš„æ–‡ä»¶ä¸»è¦æ˜¯åŸæœ¬è½¯ä»¶æ‰€æä¾›çš„è®¾ç½®ï¼Œå»ºè®®ä¸è¦ä¿®æ”¹ã€‚ä¿®æ”¹çš„ä½ç½®åœ¨ <code>/etc/systemd/system/</code> ç›®å½•å†…</p><p>æ¯”å¦‚ï¼šæƒ³è¦é¢å¤–ä¿®æ”¹ vsftpd.service ï¼Œå»ºè®®æ”¾åˆ°çš„ä½ç½®å¦‚ä¸‹ï¼š</p><ul><li><p><code>/usr/lib/systemd/vsftpd.service</code> ï¼šå®˜æ–¹çš„é¢„è®¾é…ç½®æ–‡ä»¶</p></li><li><p><code>/etc/systemd/system/vsftp.service.d/custom.conf</code>ï¼š</p><p>å»ºç«‹åŒåå¹¶å·² <code>.d</code> åç¼€ç»“å°¾çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šã€Œç´¯åŠ å…¶ä»–è®¾ç½®ã€è¿›å…¥ <code>/usr/lib/systemd/vsftpd.service</code></p><p>æ„æ€åº”è¯¥æ˜¯ï¼šè¿™é‡Œæ˜¯é…ç½®ä¼šè¦†ç›–æ‰ <code>/usr/lib/systemd/vsftpd.service</code> ä¸­çš„åŒåé…ç½®</p></li><li><p><code>/etc/systemd/system/vsftpd.service.wants/*</code></p><p>æ­¤ç›®å½•å†…çš„æ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œè®¾ç½®ç›¸ä¾æœåŠ¡çš„é“¾æ¥ã€‚ä½œç”¨æ˜¯å¯åŠ¨äº† vsftpd.service åï¼Œæœ€å¥½å†åŠ ä¸Šè¯¥ç›®å½•ä¸‹çš„å»ºè®®æœåŠ¡</p></li><li><p><code>/etc/systemd/system/vsftpd.service.requires/*</code></p><p>æ­¤ç›®å½•å†…çš„æ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œè®¾ç½®ç›¸ä¾æœåŠ¡çš„é“¾æ¥ã€‚ä½œç”¨æ˜¯ï¼Œåœ¨å¯åŠ¨ vsftpd.service ä¹‹å‰ï¼Œéœ€è¦äº‹å…ˆå¯åŠ¨å“ªäº›æœåŠ¡</p></li></ul><p>åŸºæœ¬ä¸Šåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥è‡ªç”±è®¾ç½®ç›¸ä¾æœåŠ¡çš„æ£€æŸ¥ï¼Œå¹¶ä¸”è®¾ç½®åŠ å…¥åˆ°å“ªäº› target é‡Œã€‚å°±æ˜¯å»ºè®®ä¸è¦ä¿®æ”¹åŸå§‹çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸Šè¿°å»ºè®®ç›®å½•ä¸‹å»æ“ä½œä¿®æ”¹</p><h2 id="ğŸ€-é…ç½®æ–‡ä»¶çš„è®¾ç½®é¡¹ç›®ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-é…ç½®æ–‡ä»¶çš„è®¾ç½®é¡¹ç›®ç®€ä»‹" aria-hidden="true">#</a> ğŸ€ é…ç½®æ–‡ä»¶çš„è®¾ç½®é¡¹ç›®ç®€ä»‹</h2><p>è¿™æ¬¡é€šè¿‡ sshd.service çš„é…ç½®æ–‡ä»¶æ¥è®²è§£é…ç½®æ–‡ä»¶çš„å†…å®¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/sshd.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>OpenSSH server daemon
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:sshd<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> man:sshd_config<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target sshd-keygen.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>sshd-keygen.service

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>		<span class="token comment"># è¯¥é¡¹ç›®äºå®é™…æ‰§è¡Œçš„æŒ‡ä»¤å‚æ•°æœ‰å…³</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>notify
<span class="token assign-left variable">EnvironmentFile</span><span class="token operator">=</span>/etc/sysconfig/sshd
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/sshd <span class="token parameter variable">-D</span> <span class="token variable">$OPTIONS</span>
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span> <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span>42s

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>		<span class="token comment"># æ­¤ unit è¦æŒ‚è½½åˆ°å“ªä¸ª target ä¸‹</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†æä¸Šè¿°æ–‡ä»¶ï¼Œå¤§æ¦‚åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p><code>[Unit]</code></p><p>unit æœ¬èº«çš„è¯´æ˜ï¼Œä»¥åŠå…¶ä»–ç›¸ä¾ daemon çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åœ¨ä»€ä¹ˆæœåŠ¡ä¹‹åæ‰å¯åŠ¨æ­¤ unit ä¹‹ç±»çš„è®¾ç½®</p></li><li><p><code>[Service]ã€[Socket][Timer][Mount][Path]...</code></p><p>ä¸åŒçš„ unit type éœ€è¦ä½¿ç”¨å¯¹åº”çš„è®¾ç½®é¡¹ç›®ã€‚å¯¹äº service æ¥è¯´ï¼Œä¸»è¦åœ¨è§„èŒƒæœåŠ¡å¯åŠ¨è„šæœ¬ã€ç¯å¢ƒé…ç½®æ–‡ä»¶åã€é‡æ–°å¯åŠ¨çš„æ–¹å¼ç­‰</p></li><li><p><code>[Install]</code>ï¼šå°†æ­¤ unit å®‰è£…åˆ°å“ªä¸ª target é‡Œé¢</p></li></ul><p>é…ç½®æ–‡ä»¶å†…æœ‰äº›è®¾ç½®è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><p>è®¾ç½®é¡¹ç›®é€šå¸¸æ˜¯å¯ä»¥é‡å¤çš„</p><p>ä¾‹å¦‚å¯ä»¥è®¾ç½®ä¸¤ä¸ª After åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸è¿‡ï¼Œåé¢çš„è®¾ç½®ä¼šå–ä»£å‰é¢çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>After=</code> çš„æ–¹å¼ï¼Œå°†è¯¥é¡¹æ¸…ç©ºå½’é›¶</p></li><li><p>å¦‚æœè®¾ç½®å‚æ•°éœ€è¦æœ‰ã€Œæ˜¯/å¦ boolean ç±»å‹å€¼ã€çš„é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ 1ã€yesã€trueã€on ä»£è¡¨å¯åŠ¨ï¼Œ0ã€noã€falseã€off ä»£è¡¨å…³é—­</p></li><li><p>ç©ºç™½è¡Œã€å¼€å¤´ä¸º <code>#</code> æˆ– <code>;</code> éƒ½è¡¨ç¤ºæ‰¹æ³¨ä¿¡æ¯</p></li></ul><p>æ¯ä¸ªéƒ¨åˆ†çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><h3 id="unit-éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#unit-éƒ¨åˆ†" aria-hidden="true">#</a> <code>[unit]</code> éƒ¨åˆ†</h3><ul><li><p>Description</p><p>ä½¿ç”¨ systemctl list-units æ—¶ï¼Œå±•ç¤ºå‡ºæ¥çš„ç®€æ˜“è¯´æ˜ã€‚systemctl status ä¸­è¾“å‡ºçš„æœåŠ¡è¯´æ˜ä¹Ÿæ˜¯è¯¥å€¼</p></li><li><p>Documentation</p><p>æä¾›ç®¡ç†å‘˜èƒ½å¤Ÿè¿›ä¸€æ­¥çš„æ–‡ä»¶æŸ¥è¯¢åŠŸèƒ½ï¼Œæä¾›çš„æ–‡ä»¶å¯ä»¥æ˜¯å¦‚ä¸‹çš„èµ„æ–™</p><ul><li><code>=http://www..</code></li><li><code>=man:sshd(8)</code></li><li><code>=file:/etc/ssh/sshd_config</code></li></ul></li><li><p>Afterï¼šè¯´æ˜æ­¤ unit æ˜¯åœ¨å“ªä¸ª daemon å¯åŠ¨ä¹‹åæ‰èƒ½å¯åŠ¨ã€‚</p><p>åŸºæœ¬ä¸Šä»…æ˜¯è¯´æ˜å¯åŠ¨é¡ºåºï¼Œå¹¶æ— å¼ºåˆ¶è¦æ±‚é‡Œé¢çš„æœåŠ¡ä¸€å®šè¦å¯åŠ¨åæ­¤ unit æ‰èƒ½å¯åŠ¨ã€‚å®ƒä¸ Requires çš„è®¾ç½®å«ä¹‰æ˜¯æœ‰å·®å¼‚çš„ã€‚</p></li><li><p>Beforeï¼šåœ¨ä»€ä¹ˆæœåŠ¡å¯åŠ¨å‰ï¼Œå¯åŠ¨æœ¬æœåŠ¡</p><p>åŒæ ·ï¼Œå¹¶éå¼ºåˆ¶æ€§çš„</p></li><li><p>Rrquiresï¼šç›¸ä¾æ€§é…ç½®</p><p>æ˜ç¡®å®šä¹‰æ­¤ unit éœ€è¦åœ¨å“ªä¸ª daemon å¯åŠ¨åæ‰èƒ½å¯åŠ¨ã€‚å¦‚æœä¾èµ–çš„æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œåˆ™è¯¥æœåŠ¡ä¸ä¼šè¢«å¯åŠ¨</p></li><li><p>Wantsï¼š</p><p>æ­¤ unit å¯åŠ¨ä¹‹åï¼Œè¿˜éœ€è¦å¯åŠ¨å“ªäº›æœåŠ¡ã€‚ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯å¸Œæœ›å»ºç«‹è®©ä½¿ç”¨è€…æ¯”è¾ƒå¥½çš„æ“ä½œç¯å¢ƒ</p></li><li><p>Conflictsï¼šå†²çªæœåŠ¡</p><p>å¦‚æœè¿™é‡Œç”³æ˜çš„æœåŠ¡å·²ç»å¯åŠ¨ï¼Œé‚£ä¹ˆæœ¬ unit å°±ä¸èƒ½å¯åŠ¨ã€‚å¦‚æœæˆ‘ä»¬çš„ unit æœ‰å¯åŠ¨ï¼Œé‚£ä¹ˆè¿™é‡Œå®šä¹‰çš„æœåŠ¡ä¸èƒ½å¯åŠ¨ã€‚</p></li></ul><h3 id="service-éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#service-éƒ¨åˆ†" aria-hidden="true">#</a> <code>[service]</code> éƒ¨åˆ†</h3><ul><li><p>Typeï¼šå¯åŠ¨æ–¹å¼ï¼Œä¼šå½±å“åˆ° ExecStartã€‚ä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ç§</p><ul><li><p>simpleï¼šé»˜è®¤å€¼ï¼Œä¸»è¦ç”± ExecStart å®šä¹‰çš„æŒ‡ä»¤ä¸²æ¥å¯åŠ¨ï¼Œå¯åŠ¨åå¸¸é©»äºå†…å­˜ä¸­</p></li><li><p>forkingï¼š</p><p>ç”± ExecStart å¯åŠ¨çš„ç¨‹åºé€šè¿‡ spawns å»¶ä¼¸å‡ºå…¶ä»–å­ç¨‹åºæ¥ä½œä¸ºæ­¤ daemon çš„ä¸»è¦æœåŠ¡ã€‚åŸç”Ÿçš„çˆ¶ç¨‹åºåœ¨å¯åŠ¨ç»“æŸåå°±ä¼šç»ˆæ­¢è¿è¡Œã€‚ä¼ ç»Ÿçš„ unit æœåŠ¡å¤§å¤šå±äºè¿™ç§é¡¹ç›®ã€‚</p><p>ä¾‹å¦‚ï¼šhttpd è¿™ä¸ª www æœåŠ¡ï¼Œå½“ httpd çš„ç¨‹åºå› ä¸ºè¿è¡Œè¿‡ä¹…å› æ­¤å³å°†ç»ˆç»“äº†ï¼Œåˆ™ systemd ä¼šå†é‡æ–°ç”Ÿå‡ºå¦ä¸€ä¸ªå­ç¨‹åºæŒç»­è¿è¡Œåï¼Œå†å°†çˆ¶ç¨‹åºåˆ é™¤ã€‚æ®è¯´è¿™æ ·çš„æ•ˆç‡æ¯”è¾ƒå¥½</p></li><li><p>oneshotï¼šä¸ simple ç±»ä¼¼ï¼Œä¸è¿‡è¯¥ç¨‹åºå·¥ä½œå®Œæ¯•åå°±ç»“æŸäº†ï¼Œä¸ä¼šå¸¸é©»å†…å­˜ä¸­</p></li><li><p>dbusï¼šä¸ simple ç±»ä¼¼ï¼Œä½†æ˜¯è¿™ä¸ª daemon å¿…é¡»è¦åœ¨å–å¾—ä¸€ä¸ª D-Bus çš„åç§°åï¼Œæ‰ä¼šç»§ç»­è¿è¡Œï¼Œå› æ­¤è®¾ç½®è¯¥é¡¹ç›®æ—¶ï¼Œé€šå¸¸ä¹Ÿè¦è®¾ç½® BusName æ‰è¡Œ</p></li><li><p>idleï¼šä¸ simple ç±»ä¼¼ï¼Œè¦æ‰§è¡Œè¿™ä¸ª daemon å¿…é¡»è¦æ‰€æœ‰çš„å·¥ä½œéƒ½é¡ºåˆ©æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæ‰§è¡Œï¼Œè¿™é‡Œçš„ daemon é€šå¸¸æ˜¯å¼€æœºåˆ°æœ€åæ‰æ‰§è¡Œçš„æœåŠ¡</p></li></ul><p>æ¯”è¾ƒé‡è¦çš„ simpleã€forking ä¸ oneshotï¼Œå¾ˆå¤šæœåŠ¡éœ€è¦å­ç¨‹åº forkingï¼Œè¿˜æœ‰å¾ˆå¤šæœåŠ¡åªéœ€è¦åœ¨å¼€æœºçš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ oneshot</p></li><li><p>EnvironmentFileï¼šæŒ‡å®šå¯åŠ¨è„šæœ¬çš„ç¯å¢ƒé…ç½®æ–‡ä»¶</p><p>ä¾‹å¦‚ï¼šsshd.service çš„é…ç½®æ–‡ä»¶å†™å…¥åˆ° <code>/etc/sysconfig/sshd</code> ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¯¥é¡¹åé¢ç”¨å¤šä¸ªä¸åŒçš„ Shell å˜é‡æ¥è®¾ç½®</p></li><li><p>ExecStartï¼šå®é™…æ‰§è¡Œæ­¤ daemon çš„æŒ‡ä»¤æˆ–è„šæœ¬ç¨‹åº</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ ExecStartPreï¼ˆä¹‹å‰ï¼‰ ä»¥åŠ ExecStartPostï¼ˆä¹‹åï¼‰åœ¨å®é™…å¯åŠ¨æœåŠ¡å‰åè¿›è¡Œé¢å¤–çš„æŒ‡ä»¤è¡Œä¸ºã€‚ä½†æ˜¯ä»…æ”¯æŒã€ŒæŒ‡ä»¤ å‚æ•° å‚æ•°...ã€æ ¼å¼ï¼Œä¸èƒ½æ¥å— <code>&lt; &gt; &gt;&gt; | &amp; </code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¾ˆå¤š bash è¯­æ³•ä¹Ÿä¸æ”¯æŒï¼Œå¦‚æœéœ€è¦è¿™äº›ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œæœ€å¥½ç›´æ¥å†™åˆ°æŒ‡ä»¤è„šæœ¬é‡Œé¢ã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼å¯ä»¥æ”¯æŒå®Œæ•´çš„è¯­æ³•ï¼›å°† Type=oneshot å°±å¯ä»¥äº†</p></li><li><p>ExecStopï¼šä¸ systemctl stop çš„æ‰§è¡Œæœ‰å…³ï¼Œå…³é—­æ­¤æœåŠ¡æ—¶æ‰€æ‰§è¡Œçš„æŒ‡ä»¤</p></li><li><p>ExecReloadï¼šä¸ systemctl reload æœ‰å…³çš„æŒ‡ä»¤è¡Œä¸º</p></li><li><p>Restartï¼š</p><p>å½“è®¾ç½® Restart=1 æ—¶ï¼Œå½“æ­¤ daemon æœåŠ¡ç»ˆæ­¢åï¼Œä¼šå†æ¬¡å¯åŠ¨è¯¥æœåŠ¡</p><p>é™¤éä½¿ç”¨ systemctl å¼ºåˆ¶å°†æ­¤æœåŠ¡å…³é—­ï¼Œå¦åˆ™è¯¥åŠŸèƒ½ä¼šä¸€ç›´ç”Ÿæ•ˆ</p></li><li><p>RemainAfterExit</p><p>å½“å€¼è®¾ç½®ä¸º 1 æ—¶ï¼Œ å½“è¯¥ daemon æ‰€å±çš„æ‰€æœ‰ç¨‹åºéƒ½ç»ˆæ­¢åï¼Œæ­¤æœåŠ¡ä¼šå†å°è¯•å¯åŠ¨ã€‚è¿™å¯¹äº Type=oneshot çš„æœåŠ¡æœ‰å¸®åŠ©</p></li><li><p>TimeoutSecï¼šè‹¥è¿™ä¸ªæœåŠ¡åœ¨å¯åŠ¨æˆ–æ˜¯å…³é—­æ—¶ï¼Œå› ä¸ºæŸäº›ç¼˜æ•…å¯¼è‡´æ— æ³•é¡ºåˆ©ã€Œæ­£å¸¸å¯åŠ¨æˆ–æ­£å¸¸ç»“æŸã€çš„æƒ…å†µä¸‹ï¼Œåˆ™éœ€è¦ç­‰å¾…å¤šä¹…æ‰è¿›å…¥ã€Œå¼ºåˆ¶ç»“æŸã€çš„çŠ¶æ€</p></li><li><p>KillMode</p><p>å¯ä»¥æ˜¯ processã€control-groupã€none å…¶ä¸­çš„ä¸€ç§ï¼š</p><ul><li>processï¼šç»ˆæ­¢æ—¶ï¼Œåªä¼šç»ˆæ­¢ä¸»è¦çš„ç¨‹åºï¼ˆExecStart åé¢æŒ‡ä»¤ä¸²å¯åŠ¨çš„ï¼‰</li><li>control-groupï¼šåˆ™ç”±æ­¤ daemon æ‰€äº§ç”Ÿçš„å…¶ä»– control-group çš„ç¨‹åºï¼Œä¹Ÿä¼šè¢«å…³é—­</li><li>oneï¼šæ²¡æœ‰ç¨‹åºä¼šè¢«å…³é—­</li></ul></li><li><p>RestartSecï¼š</p><p>ä¸ Restart æœ‰ç›¸å…³æ€§ï¼Œå¦‚æœè¯¥æœåŠ¡è¢«å…³é—­ï¼Œéœ€è¦é‡æ–°å¯åŠ¨æ—¶ï¼Œå¤§æ¦‚è¦ sleep å¤šå°‘æ—¶é—´å†é‡æ–°å¯åŠ¨ã€‚é¢„è®¾æ˜¯ 100ms</p></li></ul><h3 id="install-éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#install-éƒ¨åˆ†" aria-hidden="true">#</a> <code>[Install]</code> éƒ¨åˆ†</h3><ul><li><p>WantedByï¼šè¯¥ unit æœ¬èº«æ˜¯é™„æŒ‚åœ¨å“ªä¸€ä¸ª target unit ä¸‹</p><p>è¯¥é¡¹è®¾ç½®å¤§éƒ¨åˆ†éƒ½æ˜¯ <code>*.target unit</code> ã€‚å¤§å¤šæ•°æœåŠ¡æ€§è´¨çš„ unit éƒ½æ˜¯é™„æŒ‚åœ¨ multi-user.target ä¸‹</p></li><li><p>Alsoï¼šç›¸ä¾æ€§ enable</p><p>å½“å‰ unit æœ¬èº«è¢« enable æ—¶ï¼ŒAlso å£°æ˜çš„ unit ä¹Ÿ enable</p></li><li><p>Aliasï¼šåˆ«å</p><p>å½“ systemctl enable ç›¸å…³çš„æœåŠ¡æ—¶ï¼Œæ­¤æœåŠ¡ä¼šè¿›è¡Œè¿æ¥æ–‡ä»¶çš„å»ºç«‹ï¼Œä»¥ <code>multi-user.target</code> ä¸ºä¾‹ï¼Œå®ƒæ˜¯ç”¨æ¥é¢„è®¾æ“ä½œç¯å¢ƒ default.target çš„è§„åˆ’ï¼Œå› æ­¤å½“è®¾ç½®ç”¨ default.target æ—¶ï¼Œ <code>/etc/systed/system/default.target</code> å°±ä¼šè¿ç»“åˆ° <code>/usr/lib/systemd/system/multi-user.target</code></p></li></ul><p>é…ç½®è®²è§£ä¹‹åï¼Œä¸‹é¢ç”¨è¿™äº›çŸ¥è¯†ç‚¹æ¥ç»ƒä¹ </p><h2 id="ğŸ€-ä¸¤ä¸ª-vsftpd-è¿è¡Œçš„å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¸¤ä¸ª-vsftpd-è¿è¡Œçš„å®ä¾‹" aria-hidden="true">#</a> ğŸ€ ä¸¤ä¸ª vsftpd è¿è¡Œçš„å®ä¾‹</h2><p>åœ¨ä¸Šä¸€ç« å°† vsftpd çš„ port ä¿®æ”¹æˆäº† 555ã€‚è¿™é‡Œå†è¿è¡Œä¸€ä¸ªç«¯å£ä¸º 21 çš„ vsftpd ç¨‹åºï¼Œéœ€è¦ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä»¥åŠä¸¤ä¸ªå¯åŠ¨è„šæœ¬æ¥è®¾ç½®äº†ï¼š</p><ul><li>port 21: <ul><li><code>/etc/vsftpd/vsftpd.conf</code> é…ç½®æ–‡ä»¶</li><li><code>/usr/lib/systemd/system/vsftpd.service</code> å¯åŠ¨è„šæœ¬</li></ul></li><li>port 555: <ul><li><code>/etc/vsftpd/vsftpd2.conf</code> é…ç½®æ–‡ä»¶</li><li><code>/usr/lib/systemd/system/vsftpd2.service</code> å¯åŠ¨è„šæœ¬</li></ul></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å»ºç«‹å¥½éœ€è¦çš„é…ç½®æ–‡ä»¶</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/vsftpd/</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">20</span>
-rw-------. <span class="token number">1</span> root root  <span class="token number">125</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> ftpusers
-rw-------. <span class="token number">1</span> root root  <span class="token number">361</span> Mar <span class="token number">17</span> <span class="token number">21</span>:59 user_list
-rw-------. <span class="token number">1</span> root root <span class="token number">5199</span> Mar <span class="token number">17</span> <span class="token number">23</span>:02 vsftpd.conf
-rwxr--r--. <span class="token number">1</span> root root  <span class="token number">338</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> vsftpd_conf_migrate.sh
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># cp vsftpd.conf vsftpd2.conf</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># vim vsftpd.conf</span>
<span class="token comment"># listen_port=555</span>
<span class="token comment"># æŠŠç«¯å£æ³¨é‡Šæ‰ï¼Œä»–é»˜è®¤çš„ç«¯å£æ˜¯ 21.</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># diff vsftpd.conf vsftpd2.conf</span>
131c131
<span class="token operator">&lt;</span> <span class="token comment"># listen_port=555</span>
---
<span class="token operator">&gt;</span> <span class="token assign-left variable">listen_port</span><span class="token operator">=</span><span class="token number">555</span>
<span class="token comment"># é€šè¿‡å¯¹æ¯”ï¼Œä¸¤ä¸ªæ–‡ä»¶åªæœ‰ç«¯å£å·ä¸åŒ</span>

<span class="token comment"># 2. å¼€å§‹å¤„ç†å¯åŠ¨è„šæœ¬è®¾ç½®</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># cd /etc/systemd/system/</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># ll | grep vsftp</span>
<span class="token comment"># ç”±äºæˆ‘ä»¬æ²¡æœ‰é¢å¤–ä¿®æ”¹è¿‡å¯åŠ¨è„šæœ¬ï¼Œæ‰€ä»¥è¯¥ç›®å½•ä¸‹æ˜¯æ²¡æœ‰ vsftp ç›¸å…³çš„è„šæœ¬çš„</span>
<span class="token comment"># ä»åŸå§‹çš„å¯åŠ¨è„šæœ¬ç›®å½•å¤åˆ¶ä¸€ä»½è¿‡æ¥</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># cp /usr/lib/systemd/system/vsftpd.service vsftpd2.service</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># vim vsftpd2.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Vsftpd2 <span class="token function">ftp</span> daemon
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/vsftpd /etc/vsftpd/vsftpd2.conf

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
<span class="token comment"># é‡ç‚¹åªæ˜¯ä¿®æ”¹ ExecStart åé¢çš„é…ç½®æ–‡ä»¶</span>

<span class="token comment"># 3. é‡æ–°åŠ è½½ systemd çš„è„šæœ¬é…ç½®æ–‡ä»¶å†…å®¹</span>
<span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl list-unit-files --all | grep vsftpd</span>
vsftpd.service                                enabled
vsftpd2.service                               disabled		<span class="token comment"># å·²ç»èƒ½æ‰¾åˆ°äº†</span>
vsftpd@.service                               disabled
vsftpd.target                                 disabled
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl status vsftpd2.service</span>
* vsftpd2.service - Vsftpd2 <span class="token function">ftp</span> daemon
   Loaded: loaded <span class="token punctuation">(</span>/etc/systemd/system/vsftpd2.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: inactive <span class="token punctuation">(</span>dead<span class="token punctuation">)</span>

<span class="token comment"># ç”±äºä¹‹å‰ç›´æ¥ä¿®æ”¹çš„ vsftp çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ vsftp ä¹Ÿéœ€è¦é‡æ–°å¯åŠ¨</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl restart vsftpd.service vsftpd2.service</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl enable vsftpd.service vsftpd2.service</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd2.service to /etc/systemd/system/vsftpd2.service.
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl status vsftpd.service vsftpd2.service</span>
* vsftpd.service - Vsftpd <span class="token function">ftp</span> daemon
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/vsftpd.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Thu <span class="token number">2020</span>-03-19 <span class="token number">16</span>:50:22 CST<span class="token punctuation">;</span> 27s ago
 Main PID: <span class="token number">5986</span> <span class="token punctuation">(</span>vsftpd<span class="token punctuation">)</span>
   CGroup: /system.slice/vsftpd.service
           <span class="token variable"><span class="token variable">\`</span><span class="token parameter variable">-5986</span> /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf

Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Stopped Vsftpd <span class="token function">ftp</span> daemon.
Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting Vsftpd <span class="token function">ftp</span> daemon<span class="token punctuation">..</span>.
Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started Vsftpd <span class="token function">ftp</span> daemon.

* vsftpd2.service - Vsftpd2 <span class="token function">ftp</span> daemon
   Loaded: loaded <span class="token punctuation">(</span>/etc/systemd/system/vsftpd2.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Thu <span class="token number">2020</span>-03-19 <span class="token number">16</span>:50:22 CST<span class="token punctuation">;</span> 27s ago
 Main PID: <span class="token number">5987</span> <span class="token punctuation">(</span>vsftpd<span class="token punctuation">)</span>
   CGroup: /system.slice/vsftpd2.service
           <span class="token variable">\`</span></span>-5987 /usr/sbin/vsftpd /etc/vsftpd/vsftpd2.conf

Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Stopped Vsftpd2 <span class="token function">ftp</span> daemon.
Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting Vsftpd2 <span class="token function">ftp</span> daemon<span class="token punctuation">..</span>.
Mar <span class="token number">19</span> <span class="token number">16</span>:50:22 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started Vsftpd2 <span class="token function">ftp</span> daemon.

<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># netstat -tlnp | grep vsftp</span>
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::555                  :::*                    LISTEN      <span class="token number">5987</span>/vsftpd         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::21                   :::*                    LISTEN      <span class="token number">5986</span>/vsftpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ä¸€ä¸ªå¯åŠ¨è„šæœ¬çš„å®Œæˆäº†</p><h2 id="ğŸ€-å¤šé‡çš„é‡å¤è®¾ç½®æ–¹å¼-ä»¥-getty-ä¸ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å¤šé‡çš„é‡å¤è®¾ç½®æ–¹å¼-ä»¥-getty-ä¸ºä¾‹" aria-hidden="true">#</a> ğŸ€ å¤šé‡çš„é‡å¤è®¾ç½®æ–¹å¼ï¼šä»¥ getty ä¸ºä¾‹</h2><p>CentOS 7 å¼€æœºåï¼Œæœ‰ 6 ä¸ªç»ˆç«¯æœºå¯ä»¥ä½¿ç”¨ï¼ˆtty1 ~ tty6ï¼‰ï¼Œæ˜¯ç”± agetty æŒ‡ä»¤æå®šçš„ã€‚ç»ˆç«¯æœºçš„åŠŸèƒ½æ¶‰åŠå¾ˆå¤šå±‚é¢ï¼Œä¸»è¦ç®¡ç†çš„æ˜¯ getty.target è¿™ä¸ª target unitï¼Œå®é™…äº§ç”Ÿ tty1~tty6 çš„åˆ™æ˜¯ç”± getty@.service æ‰€æä¾›çš„ã€‚</p><p>é€šè¿‡è¿™ä¸ª getty@.service çš„å¯åŠ¨è„šæœ¬æ¥è·å– @ æ˜¯å•¥å«ä¹‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/getty@.service</span>
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Getty on %I
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:agetty<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> man:systemd-getty-generator<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>http://0pointer.de/blog/projects/serial-console.html
<span class="token assign-left variable">After</span><span class="token operator">=</span>systemd-user-sessions.service plymouth-quit-wait.service getty-pre.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>rc-local.service

<span class="token comment"># If additional gettys are spawned during boot then we should make</span>
<span class="token comment"># sure that this is synchronized before getty.target, even though</span>
<span class="token comment"># getty.target didn&#39;t actually pull it in.</span>
<span class="token assign-left variable">Before</span><span class="token operator">=</span>getty.target
<span class="token assign-left variable">IgnoreOnIsolate</span><span class="token operator">=</span>yes

<span class="token comment"># On systems without virtual consoles, don&#39;t start any getty. Note</span>
<span class="token comment"># that serial gettys are covered by serial-getty@.service, not this</span>
<span class="token comment"># unit.</span>
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/dev/tty0

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token comment"># the VT is cleared by TTYVTDisallocate</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/sbin/agetty <span class="token parameter variable">--noclear</span> %I <span class="token environment constant">$TERM</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>idle
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">UtmpIdentifier</span><span class="token operator">=</span>%I
<span class="token assign-left variable">TTYPath</span><span class="token operator">=</span>/dev/%I
<span class="token assign-left variable">TTYReset</span><span class="token operator">=</span>yes
<span class="token assign-left variable">TTYVHangup</span><span class="token operator">=</span>yes
<span class="token assign-left variable">TTYVTDisallocate</span><span class="token operator">=</span>yes
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">IgnoreSIGPIPE</span><span class="token operator">=</span>no
<span class="token assign-left variable">SendSIGHUP</span><span class="token operator">=</span>yes

<span class="token comment"># Unset locale for the console getty since the console has problems</span>
<span class="token comment"># displaying some internationalized messages.</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token environment constant">LANG</span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span> <span class="token assign-left variable">LC_CTYPE</span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_NUMERIC</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_TIME</span></span><span class="token operator">=</span> <span class="token assign-left variable">LC_COLLATE</span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_MONETARY</span></span><span class="token operator">=</span> <span class="token assign-left variable">LC_MESSAGES</span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_PAPER</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_NAME</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_ADDRESS</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_TELEPHONE</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_MEASUREMENT</span></span><span class="token operator">=</span> <span class="token assign-left variable"><span class="token environment constant">LC_IDENTIFICATION</span></span><span class="token operator">=</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>getty.target
<span class="token assign-left variable">DefaultInstance</span><span class="token operator">=</span>tty1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡è¦é¡¹ï¼š ExecStartï¼Œé€šè¿‡ man agetty æ—¶å‘ç°å®ƒçš„è¯­æ³•åº”è¯¥æ˜¯ <code>agetty --noclear tty1</code> ï¼ˆç¬”è€…æ²¡æœ‰çœ‹æ‡‚é‡Œé¢å“ªé‡Œå†™çš„æœ‰è¿™ä¸ªï¼Œå†…å®¹æœ‰ç‚¹å¤šï¼‰ï¼Œé‚£ä¹ˆå¯åŠ¨ 6 ä¸ªçš„è¯ï¼Œå°±éœ€è¦æœ‰ 6 ä¸ª å¯åŠ¨é…ç½®æ¥åˆ†åˆ«é…ç½®å¯åŠ¨æŒ‡ä»¤ tty1~tty6ï¼Œæ˜¯åœ¨å¾ˆç¹çï¼Œè¿™å°±å‡ºç°äº† <code>getty@.service</code> ä¸­çš„ @ ã€‚å…ˆæ¥çœ‹çœ‹ä»–çš„ä¸Šæ¸¸ <code>Before=getty.target</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># systemctl show getty.target</span>
<span class="token assign-left variable">Id</span><span class="token operator">=</span>getty.target
<span class="token assign-left variable">Names</span><span class="token operator">=</span>getty.target
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>getty@tty1.service
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target
<span class="token assign-left variable">Before</span><span class="token operator">=</span>multi-user.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>getty@tty1.service
<span class="token comment"># è¿™é‡Œï¼Œç¬”è€…çš„ç¯å¢ƒä¸Šä¸ä¹¦ä¸Šä¸ä¸€è‡´äº†ï¼Œä¹¦ä¸Šæ˜¯ getty@tty1.service getty@tty2.service ç­‰ 6 ä¸ª</span>
<span class="token comment"># æ³¨æ„ï¼Œè¿™é‡Œç¬”è€…å‘ç°äº†ä¸ºä»€ä¹ˆä¸ä¸€æ ·</span>
<span class="token comment"># cat /usr/lib/systemd/system/getty.target é‡Œé¢å†…å®¹å¾ˆå°‘ï¼Œæ²¡æœ‰ä¸Šé¢è¿™äº›å®šä¹‰</span>
<span class="token comment"># ä½†æ˜¯ç”¨ show å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™ä¸ªä¹¦ä¸Šç›®å‰æ²¡æœ‰è®²è§£</span>
<span class="token comment"># ä½†æ˜¯ï¼Œé€šè¿‡åˆ‡æ¢åˆ° tty2 tty3 ä¸Šå»çš„æ—¶å€™ï¼Œä½¿ç”¨  systemctl show getty.target æŸ¥çœ‹çŠ¶æ€æ—¶ï¼ŒAfter åé¢å°±ä¼šå‡ºç°å·²ç»åˆ‡æ¢è¿‡ä¹‹åçš„ ttyã€‚å’Œä¹¦ä¸Šå±•ç¤ºæ˜¯ä¸€æ ·çš„æ•ˆæœ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹¦ä¸Šè¯´ï¼Œä¸Šé¢çš„ After çš„é…ç½®ï¼Œå½“ æ‰§è¡Œå®Œ getty.target ä¹‹åï¼Œä¼šæŒç»­è¦æ±‚ getty@tty1.service ç­‰ 6 ä¸ªæœåŠ¡ç»§ç»­å¯åŠ¨ã€‚é‚£ä¹ˆ systemd å°±ä¼šå¦‚ä¸‹åšï¼š</p><ul><li>å…ˆæŸ¥æ‰¾ <code>/usr/lib/systemd/system/</code>ã€<code>/etc/systemd/system/</code> æœ‰æ—  <code>getty@tty1.service</code> çš„è®¾ç½®ï¼Œè‹¥æœ‰å°±å¯åŠ¨ï¼Œæ²¡æœ‰åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥</li><li>æ‰¾åˆ° <code>getty@.service</code> çš„è®¾ç½®ï¼Œåˆ™å°† @ åé¢çš„æ•°æ®ä»£å…¥æˆ <code>%I</code> çš„å˜é‡ï¼Œè¿›å…¥ gett@.service æ‰§è¡Œ</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ <code>getty@tty1.service</code> å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>getty@.service</code> æ¥æ‰§è¡Œï¼Œæ¥ç®€åŒ–å¤šä¸ªæ‰§è¡Œçš„å¯åŠ¨è®¾ç½®ï¼Œä»–çš„å‘½åæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>æºæ–‡ä»¶ï¼šæ‰§è¡ŒæœåŠ¡åç§°@.service</li><li>æ‰§è¡Œæ–‡ä»¶ï¼šæ‰§è¡ŒæœåŠ¡åç§°@èŒƒä¾‹åç§°.service</li></ul><p><code>getty@.service</code> ä¸­çš„å¯åŠ¨æŒ‡ä»¤<code>ExecStart=-/sbin/agetty --noclear %I $TERM</code>ï¼Œæ ¹æ® getty.target çš„ä¿¡æ¯è¾“å‡ºæ¥çœ‹ï¼Œ<code>getty@tty1.service</code> çš„ <code>%I</code> çš„å€¼æ˜¯ tty1ï¼Œå› æ­¤æ‰§è¡Œè„šæœ¬ä¼šå˜æˆ <code>/sbin/agetty --noclear tty1</code></p><h3 id="å°†-tty-çš„æ•°é‡ç”±-6-ä¸ªé™ä½åˆ°-4-ä¸ª" tabindex="-1"><a class="header-anchor" href="#å°†-tty-çš„æ•°é‡ç”±-6-ä¸ªé™ä½åˆ°-4-ä¸ª" aria-hidden="true">#</a> å°† tty çš„æ•°é‡ç”± 6 ä¸ªé™ä½åˆ° 4 ä¸ª</h3><p>è¿™ä¸ªé…ç½®æ˜¯åœ¨ <code>/etc/systemd/logind.conf</code> é‡Œé¢é…ç½®çš„ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. æ‰“å¼€æ³¨é‡Šä¿¡æ¯ï¼Œå¹¶ä¿®æ”¹æˆ 4 ä¸ª</span>
<span class="token punctuation">[</span>root@study system<span class="token punctuation">]</span><span class="token comment"># vim /etc/systemd/logind.conf</span>
<span class="token punctuation">[</span>Login<span class="token punctuation">]</span>
<span class="token assign-left variable">NAutoVTs</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token assign-left variable">ReserveVT</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># 2. å¦‚æœä½ åˆ‡æ¢åˆ° tty5 å’Œ tty6 çš„è¯ï¼Œè¯·å°†ä»–ä»¬å…³é—­åé‡å¯ getty.target</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop getty@tty5.service</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop getty@tty6.service</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart systemd-logind.service</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ å›åˆ°æ¡Œé¢ç¯å¢ƒä¸‹ï¼Œå†åˆ‡æ¢åˆ° tty5 å’Œ tty6 æ—¶å°±åˆ‡æ¢ä¸è¿‡å»äº†ã€‚</p><p>åˆ°è¿™é‡Œç¬”è€…è²Œä¼¼è¿·ç³Šäº†ï¼Œgetty.target åªæ˜¯ä¸€ä¸ªå®šä¹‰ï¼Œç±»ä¼¼ç»„ï¼Œé‡Œé¢å¹¶æ²¡æœ‰å®šä¹‰ä»€ä¹ˆï¼Œè¢«å…¶ä»–çš„ unit é™„åŠ ã€‚æœ‰ç‚¹ä¸å¤ªæ˜ç™½å’Œè¿™é‡Œå¯åŠ¨ 1~6 ä¸ªæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™é‡Œå¯åŠ¨çš„æ˜¯ systemd-logind.service ï¼Œè€Œä¸”åˆ‡æ¢åªèƒ½åœ¨æ¡Œé¢ç¯å¢ƒä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´ tty1~tty6 çš„åˆ‡æ¢æ˜¯è¿™ä¸ªæŒ‡ä»¤çš„åŠŸèƒ½ï¼Œåªæ˜¯å®é™…å¯åŠ¨æ—¶ç”¨ getty@.service å¯åŠ¨çš„ã€‚ä½†æ˜¯å…·ä½“æ€ä¹ˆå…³è”ä¸Šçš„ï¼Œæ˜¯åœ¨æ˜¯è¿·ç³Šï¼Œçœ‹ä¸æ‡‚</p><p>é‚£ä¹ˆå…¶å®å¯ä»¥é€šè¿‡æŒ‡ä»¤æ–¹å¼ç›´æ¥å¯åŠ¨ä¸€ä¸ª ttyã€‚è€Œæ— éœ€å…¶ä»–çš„é…ç½®æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start getty@tty8.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœåªå•ç‹¬çœ‹è¿™é‡Œçš„æ¼”ç¤ºçš„è¯ï¼Œç¬”è€…èƒ½æ˜ç™½çš„å°±æ˜¯ getty@.service æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ @ ä¼ é€’å‚æ•°ç»™æœåŠ¡</p><h3 id="æš‚æ—¶æ–°å¢-vsftpd-åˆ°-2121-ç«¯å£" tabindex="-1"><a class="header-anchor" href="#æš‚æ—¶æ–°å¢-vsftpd-åˆ°-2121-ç«¯å£" aria-hidden="true">#</a> æš‚æ—¶æ–°å¢ vsftpd åˆ° 2121 ç«¯å£</h3><p>vsftpd ä¹Ÿæä¾›äº† @ çš„æœåŠ¡æ–¹å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /usr/lib/systemd/system | grep vsftpd</span>
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">171</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> vsftpd.service
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">89</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> vsftpd.target
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">184</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> vsftpd@.service		<span class="token comment"># è¿™é‡Œ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/vsftpd@.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Vsftpd <span class="token function">ftp</span> daemon
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token assign-left variable">PartOf</span><span class="token operator">=</span>vsftpd.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/vsftpd /etc/vsftpd/%i.conf

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>vsftpd.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä½¿ç”¨äº† <code>%i</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¤§å°å†™çš„çš„å˜é‡éƒ½å¯ä»¥ï¼Œè¿™é‡Œå¯åŠ¨æŒ‡ä»¤æ‹¼æ¥äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶è·¯å¾„ <code>/etc/vsftpd/%i.conf</code></p><p>é‚£ä¹ˆå…ˆåˆ›å»ºè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ @ æ–¹å¼å¯åŠ¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. åˆ¶ä½œä¸€ä¸ª vsftpd3.conf ï¼Œå¹¶å§ç«¯å£ä¿®æ”¹ä¸º 2121</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/vsftpd/    </span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">28</span>
-rw-------. <span class="token number">1</span> root root  <span class="token number">125</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> ftpusers
-rw-------. <span class="token number">1</span> root root  <span class="token number">361</span> Mar <span class="token number">17</span> <span class="token number">21</span>:59 user_list
-rw-------. <span class="token number">1</span> root root <span class="token number">5201</span> Mar <span class="token number">19</span> <span class="token number">16</span>:35 vsftpd.conf
-rw-------. <span class="token number">1</span> root root <span class="token number">5199</span> Mar <span class="token number">19</span> <span class="token number">16</span>:35 vsftpd2.conf
-rwxr--r--. <span class="token number">1</span> root root  <span class="token number">338</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> vsftpd_conf_migrate.sh
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># cp vsftpd.conf vsftpd3.conf</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># vim vsftpd3.conf</span>
<span class="token assign-left variable">listen_port</span><span class="token operator">=</span><span class="token number">2121</span>

<span class="token comment"># 2. æš‚æ—¶å¯åŠ¨ï¼Œä¸è¦å¼€æœºå¯åŠ¨</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># systemctl start vsftpd@vsftpd3.service</span>
<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># systemctl status vsftpd@vsftpd3.service</span>
* vsftpd@vsftpd3.service - Vsftpd <span class="token function">ftp</span> daemon
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/vsftpd@.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Thu <span class="token number">2020</span>-03-19 <span class="token number">17</span>:48:57 CST<span class="token punctuation">;</span> 5s ago
  Process: <span class="token number">7536</span> <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/vsftpd /etc/vsftpd/%i.conf <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
 Main PID: <span class="token number">7538</span> <span class="token punctuation">(</span>vsftpd<span class="token punctuation">)</span>
   CGroup: /system.slice/system-vsftpd.slice/vsftpd@vsftpd3.service
           \`-7538 /usr/sbin/vsftpd /etc/vsftpd/vsftpd3.conf

Mar <span class="token number">19</span> <span class="token number">17</span>:48:57 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting Vsftpd <span class="token function">ftp</span> daemon<span class="token punctuation">..</span>.
Mar <span class="token number">19</span> <span class="token number">17</span>:48:57 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started Vsftpd <span class="token function">ftp</span> daemon.

<span class="token punctuation">[</span>root@study vsftpd<span class="token punctuation">]</span><span class="token comment"># netstat -tlnp | grep vsftpd</span>
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::2121                 :::*                    LISTEN      <span class="token number">7538</span>/vsftpd         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::555                  :::*                    LISTEN      <span class="token number">5987</span>/vsftpd         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::21                   :::*                    LISTEN      <span class="token number">5986</span>/vsftpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°é€šè¿‡è¿™ç§ @ çš„æ–¹å¼ï¼Œèƒ½è®©æˆ‘ä»¬åˆ¶ä½œå¯åŠ¨è„šæœ¬çš„æ—¶å€™æ›´ä¸ºçµæ´»ä¸€ç‚¹</p><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>æœ‰ä¸€ä»¶äº‹æƒ…ï¼Œè¿™æ¬¡ä½¿ç”¨äº† 2121 ç«¯å£ï¼Œå´ä¸ç”¨ä¿®æ”¹ SELinuxï¼Ÿå› ä¸ºé»˜è®¤å¯åŠ¨å°äº 1024 ä»¥ä¸‹çš„ç«¯å£æ—¶ï¼Œéœ€è¦ä½¿ç”¨åˆ° root çš„æƒé™ï¼Œå¤§äº 2014 çš„ç›¸å¯¹æ¥è¯´å¯¹ç³»ç»Ÿçš„å½±å“å¯èƒ½å°ä¸€äº›ï¼Œå°±å¿½ç•¥äº† SELinux çš„é™åˆ¶äº†</p><p>ç¬”è€…çœ‹è¿™å¥è¯ï¼Œè²Œä¼¼è®°ä¸èµ·æœ‰å…³ SELinux ç«¯å£é™åˆ¶çš„çŸ¥è¯†äº†ï¼Ÿæ‡µé€¼çŠ¶æ€</p></div><h2 id="ğŸ€-è‡ªå·±çš„æœåŠ¡è‡ªå·±åš" tabindex="-1"><a class="header-anchor" href="#ğŸ€-è‡ªå·±çš„æœåŠ¡è‡ªå·±åš" aria-hidden="true">#</a> ğŸ€ è‡ªå·±çš„æœåŠ¡è‡ªå·±åš</h2><p>ä¸‹é¢æ¨¡æ‹Ÿè‡ªå·±åšä¸€ä¸ªæœåŠ¡ï¼šåˆ¶ä½œä¸€ä¸ªå¯ä»¥å¤‡ä»½è‡ªå·±ç³»ç»Ÿçš„æœåŠ¡ï¼Œè¿™è„šæœ¬æ”¾åœ¨ <code>/backups</code> ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /backups		# ä¸‹é¢è„šæœ¬ï¼Œä¸Šå±‚ç›®å½•ä¸å­˜åœ¨ï¼Œéƒ½æ— æ³•ä¿å­˜çš„</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /backups/backup.sh</span>
<span class="token comment">#!/bin/bash</span>

<span class="token assign-left variable">source</span><span class="token operator">=</span><span class="token string">&quot;/etc /home /root /var/lib /var/spool/{cron,at,mail}&quot;</span>
<span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token string">&quot;/backups/backup-system-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">)</span></span>.tar.gz&quot;</span>

<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> /backups <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> /backups

<span class="token function">tar</span> <span class="token parameter variable">-zcvf</span> <span class="token variable">\${target}</span> <span class="token variable">\${source}</span> $<span class="token operator">&gt;</span> /backups/backup.log

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chmod a+x /backups/backup.sh</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /backups/backup.sh</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">222</span> Mar <span class="token number">20</span> 09:24 /backups/backup.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡†å¤‡ backup.service çš„å¯åŠ¨è„šæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/systemd/system/backup.service</span>
<span class="token punctuation">[</span>unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>backup my server
<span class="token assign-left variable">Requires</span><span class="token operator">=</span>atd.service

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot; echo /backups/backup.sh | at now&quot;</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token comment"># å› ä¸º ExecStart é‡Œé¢ç”¨åˆ°äº† at æŒ‡ä»¤ï¼Œå› æ­¤ atd.service æ˜¯ä¸€å®šéœ€è¦çš„æœåŠ¡</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl start backup.service</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl status backup.service</span>
* backup.service - backup my server
   Loaded: loaded <span class="token punctuation">(</span>/etc/systemd/system/backup.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: inactive <span class="token punctuation">(</span>dead<span class="token punctuation">)</span>

Mar <span class="token number">20</span> 09:30:56 study.centos.mrcode systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started backup my server.
Mar <span class="token number">20</span> 09:30:56 study.centos.mrcode bash<span class="token punctuation">[</span><span class="token number">17748</span><span class="token punctuation">]</span>: job <span class="token number">8</span> at Fri Mar <span class="token number">20</span> 09:30:00 <span class="token number">2020</span>

<span class="token comment"># å¯ä»¥çœ‹åˆ°æœåŠ¡åœ¨æ‰§è¡Œäº†ï¼ŒçŠ¶æ€æ˜¯ inactive ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªé©»ç•™å†…å­˜çš„æœåŠ¡ï¼Œæ‰§è¡Œå®Œæˆå°±é€€å‡ºäº†</span>
<span class="token comment"># è¿™é‡Œç¬”è€…çœ‹ä¸æ‡‚ä¸ºå•¥ç”¨ echo /backups/backup.sh | at nowï¼› è€Œä¸æ˜¯ç›´æ¥ç›´æ¥ç»™å®šè„šæœ¬è·¯å¾„ï¼Œè€Œä¸”è²Œä¼¼è„šæœ¬é‡Œé¢çš„å†…å®¹æ‰§è¡Œä¹Ÿæœ‰é—®é¢˜</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,60),i=[p];function l(c,o){return n(),a("div",null,i)}const u=s(t,[["render",l],["__file","03.html.vue"]]);export{u as default};
