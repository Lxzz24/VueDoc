import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as c,o,c as l,a as n,b as a,w as t,d as u,e as p}from"./app-CvlAI_tu.js";const i="/VueDoc/assets/image-20231129161059148-D5Z4iLox.png",k="/VueDoc/assets/image-20231129161137834-CFiE7laV.png",r={},d={class:"hint-container details"},v=n("summary",null,"ç›®å½•",-1),m={class:"table-of-contents"},b=u('<p>è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadï¼‰æ˜¯ Java 19 å¼•å…¥çš„ä¸€ç§è½»é‡çº§çº¿ç¨‹ï¼Œå®ƒåœ¨å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­è¢«ç§°ä¸ºåç¨‹ã€çº¤ç¨‹ã€ç»¿è‰²çº¿ç¨‹ã€ç”¨æˆ·æ€çº¿ç¨‹ç­‰ã€‚</p><p>åœ¨ç†è§£è™šæ‹Ÿçº¿ç¨‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹çº¿ç¨‹çš„ç‰¹ç‚¹ï¼š</p><ul><li>çº¿ç¨‹æ˜¯ç”±æ“ä½œç³»ç»Ÿåˆ›å»ºå¹¶è°ƒåº¦çš„èµ„æºï¼›</li><li>çº¿ç¨‹åˆ‡æ¢ä¼šè€—è´¹å¤§é‡ CPU æ—¶é—´ï¼›</li><li>ä¸€ä¸ªç³»ç»Ÿèƒ½åŒæ—¶è°ƒåº¦çš„çº¿ç¨‹æ•°é‡æ˜¯æœ‰é™çš„ï¼Œé€šå¸¸åœ¨å‡ ç™¾è‡³å‡ åƒçº§åˆ«ã€‚</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬è¯´çº¿ç¨‹æ˜¯ä¸€ç§é‡é‡çº§èµ„æºã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œå¯¹ç”¨æˆ·è¯·æ±‚ï¼Œé€šå¸¸éƒ½å®ç°ä¸ºä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚ç”±äºç”¨æˆ·çš„è¯·æ±‚æ•°å¾€å¾€è¿œè¶…æ“ä½œç³»ç»Ÿèƒ½åŒæ—¶è°ƒåº¦çš„çº¿ç¨‹æ•°é‡ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨çº¿ç¨‹æ± æ¥å°½é‡å‡å°‘é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æˆæœ¬ã€‚</p><p>å¯¹äºéœ€è¦å¤„ç†å¤§é‡ IO è¯·æ±‚çš„ä»»åŠ¡æ¥è¯´ï¼Œä½¿ç”¨çº¿ç¨‹æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºä¸€æ—¦è¯»å†™ IOï¼Œçº¿ç¨‹å°±å¿…é¡»è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ° IO æ•°æ®è¿”å›ã€‚å¸¸è§çš„ IO æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>è¯»å†™æ–‡ä»¶ï¼›</li><li>è¯»å†™ç½‘ç»œï¼Œä¾‹å¦‚ HTTP è¯·æ±‚ï¼›</li><li>è¯»å†™æ•°æ®åº“ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ JDBC å®ç°ç½‘ç»œè°ƒç”¨ã€‚</li></ul><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå¤„ç† HTTP è¯·æ±‚çš„çº¿ç¨‹ï¼Œå®ƒåœ¨è¯»å†™ç½‘ç»œã€æ–‡ä»¶çš„æ—¶å€™å°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼š</p><figure><img src="'+i+'" alt="image-20231129161059148" tabindex="0" loading="lazy"><figcaption>image-20231129161059148</figcaption></figure><p>çœŸæ­£ç”± CPU æ‰§è¡Œçš„ä»£ç æ¶ˆè€—çš„æ—¶é—´éå¸¸å°‘ï¼Œçº¿ç¨‹çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾… IOã€‚æˆ‘ä»¬æŠŠè¿™ç±»ä»»åŠ¡ç§°ä¸º IO å¯†é›†å‹ä»»åŠ¡ã€‚</p><p>ä¸ºäº†èƒ½é«˜æ•ˆæ‰§è¡Œ IO å¯†é›†å‹ä»»åŠ¡ï¼ŒJava ä» 19 å¼€å§‹å¼•å…¥äº†è™šæ‹Ÿçº¿ç¨‹ã€‚è™šæ‹Ÿçº¿ç¨‹çš„æ¥å£å’Œæ™®é€šçº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œæ–¹å¼ä¸ä¸€æ ·ã€‚è™šæ‹Ÿçº¿ç¨‹ä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œè€Œæ˜¯ç”±æ™®é€šçº¿ç¨‹è°ƒåº¦ï¼Œå³æˆç™¾ä¸Šåƒä¸ªè™šæ‹Ÿçº¿ç¨‹å¯ä»¥ç”±ä¸€ä¸ªæ™®é€šçº¿ç¨‹è°ƒåº¦ã€‚ä»»ä½•æ—¶åˆ»ï¼Œåªèƒ½æ‰§è¡Œä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦è¯¥è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œä¸€ä¸ª IO æ“ä½œè¿›å…¥ç­‰å¾…æ—¶ï¼Œå®ƒä¼šè¢«ç«‹åˆ» â€œæŒ‚èµ·â€ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹ã€‚ä»€ä¹ˆæ—¶å€™ IO æ•°æ®è¿”å›äº†ï¼Œè¿™ä¸ªæŒ‚èµ·çš„è™šæ‹Ÿçº¿ç¨‹æ‰ä¼šè¢«å†æ¬¡è°ƒåº¦ã€‚å› æ­¤ï¼Œè‹¥å¹²ä¸ªè™šæ‹Ÿçº¿ç¨‹å¯ä»¥åœ¨ä¸€ä¸ªæ™®é€šçº¿ç¨‹ä¸­äº¤æ›¿è¿è¡Œï¼š</p><figure><img src="'+k+`" alt="image-20231129161137834" tabindex="0" loading="lazy"><figcaption>image-20231129161137834</figcaption></figure><p>å¦‚æœæˆ‘ä»¬å•ç‹¬çœ‹ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹çš„ä»£ç ï¼Œåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config <span class="token operator">=</span> <span class="token function">readConfigFile</span><span class="token punctuation">(</span><span class="token string">&quot;./config.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>useFullName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> req<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">insertInto</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #2</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶‰åŠåˆ° IO è¯»å†™çš„ #1ã€#2ã€#3 å¤„ï¼Œæ‰§è¡Œåˆ°è¿™äº›åœ°æ–¹çš„æ—¶å€™ï¼ˆè¿›å…¥ç›¸å…³çš„ JNI æ–¹æ³•å†…éƒ¨æ—¶ï¼‰ä¼šè‡ªåŠ¨æŒ‚èµ·ï¼Œå¹¶åˆ‡æ¢åˆ°å…¶ä»–è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œã€‚ç­‰åˆ°æ•°æ®è¿”å›åï¼Œå½“å‰è™šæ‹Ÿçº¿ç¨‹ä¼šå†æ¬¡è°ƒåº¦å¹¶æ‰§è¡Œï¼Œå› æ­¤ï¼Œä»£ç çœ‹èµ·æ¥æ˜¯åŒæ­¥æ‰§è¡Œï¼Œä½†å®é™…ä¸Šæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹</h2><p>è™šæ‹Ÿçº¿ç¨‹çš„æ¥å£å’Œæ™®é€šçº¿ç¨‹ä¸€æ ·ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äºåˆ›å»ºè™šæ‹Ÿçº¿ç¨‹åªèƒ½é€šè¿‡ç‰¹å®šæ–¹æ³•ã€‚</p><p>æ–¹æ³•ä¸€ï¼šç›´æ¥åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹å¹¶è¿è¡Œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä¼ å…¥ Runnable å®ä¾‹å¹¶ç«‹åˆ»è¿è¡Œ:</span>
<span class="token class-name">Thread</span> vt <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">startVirtualThread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start virtual thread...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;End virtual thread.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–¹æ³•äºŒï¼šåˆ›å»ºè™šæ‹Ÿçº¿ç¨‹ä½†ä¸è‡ªåŠ¨è¿è¡Œï¼Œè€Œæ˜¯æ‰‹åŠ¨è°ƒç”¨ <code>start()</code> å¼€å§‹è¿è¡Œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åˆ›å»º VirtualThread:</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">ofVirtual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unstarted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start virtual thread...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;End virtual thread.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¿è¡Œ:</span>
vt<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–¹æ³•ä¸‰ï¼šé€šè¿‡è™šæ‹Ÿçº¿ç¨‹çš„ ThreadFactory åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹ï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ <code>start()</code> å¼€å§‹è¿è¡Œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åˆ›å»º ThreadFactory:</span>
<span class="token class-name">ThreadFactory</span> tf <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">ofVirtual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆ›å»º VirtualThread:</span>
<span class="token class-name">Thread</span> vt <span class="token operator">=</span> tf<span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start virtual thread...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;End virtual thread.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¿è¡Œ:</span>
vt<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›´æ¥è°ƒç”¨ <code>start()</code> å®é™…ä¸Šæ˜¯ç”± <code>ForkJoinPool</code> çš„çº¿ç¨‹æ¥è°ƒåº¦çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºè°ƒåº¦çº¿ç¨‹ï¼Œç„¶åè¿è¡Œè™šæ‹Ÿçº¿ç¨‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åˆ›å»ºè°ƒåº¦å™¨:</span>
<span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newVirtualThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆ›å»ºå¤§é‡è™šæ‹Ÿçº¿ç¨‹å¹¶è°ƒåº¦:</span>
<span class="token class-name">ThreadFactory</span> tf <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">ofVirtual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> vt <span class="token operator">=</span> tf<span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>vt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥ Runnable æˆ– Callable:</span>
    executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Start virtual thread...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;End virtual thread.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºè™šæ‹Ÿçº¿ç¨‹å±äºéå¸¸è½»é‡çº§çš„èµ„æºï¼Œå› æ­¤ï¼Œç”¨æ—¶åˆ›å»ºï¼Œç”¨å®Œå°±æ‰”ï¼Œä¸è¦æ± åŒ–è™šæ‹Ÿçº¿ç¨‹ã€‚</p><p>æœ€åæ³¨æ„ï¼Œè™šæ‹Ÿçº¿ç¨‹åœ¨ Java 21 æ­£å¼å‘å¸ƒï¼Œåœ¨ Java 19/20 æ˜¯é¢„è§ˆåŠŸèƒ½ï¼Œé»˜è®¤å…³é—­ï¼Œéœ€è¦æ·»åŠ å‚æ•° <code>--enable-preview</code> å¯ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">--source</span> <span class="token number">19</span> --enable-preview Main.java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ğŸ€-ä½¿ç”¨é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨é™åˆ¶" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨é™åˆ¶</h2><p>æ³¨æ„åˆ°åªæœ‰ä»¥è™šæ‹Ÿçº¿ç¨‹æ–¹å¼è¿è¡Œçš„ä»£ç ï¼Œæ‰ä¼šåœ¨æ‰§è¡Œ IO æ“ä½œæ—¶è‡ªåŠ¨è¢«æŒ‚èµ·å¹¶åˆ‡æ¢åˆ°å…¶ä»–è™šæ‹Ÿçº¿ç¨‹ã€‚æ™®é€šçº¿ç¨‹çš„ IO æ“ä½œä»ç„¶ä¼šç­‰å¾…ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ <code>main()</code> æ–¹æ³•ä¸­è¯»å†™æ–‡ä»¶ï¼Œæ˜¯ä¸ä¼šæœ‰è°ƒåº¦å’Œè‡ªåŠ¨æŒ‚èµ·çš„ã€‚</p><p>å¯ä»¥è‡ªåŠ¨å¼•å‘è°ƒåº¦åˆ‡æ¢çš„æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>æ–‡ä»¶ IOï¼›</li><li>ç½‘ç»œ IOï¼›</li><li>ä½¿ç”¨ Concurrent åº“å¼•å‘ç­‰å¾…ï¼›</li><li>Thread.sleep() æ“ä½œã€‚</li></ul><p>è¿™æ˜¯å› ä¸º JDK ä¸ºäº†å®ç°è™šæ‹Ÿçº¿ç¨‹ï¼Œå·²ç»å¯¹åº•å±‚ç›¸å…³æ“ä½œè¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™æ ·åº”ç”¨å±‚çš„ Java ä»£ç æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ã€‚æ— æ³•è‡ªåŠ¨åˆ‡æ¢çš„è¯­è¨€éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨ <code>await</code> æ¥å®ç°å¼‚æ­¥æ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>async function <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    await <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    await <span class="token function">sendNetworkData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è™šæ‹Ÿçº¿ç¨‹ä¸­ï¼Œå¦‚æœç»•è¿‡ JDK çš„ IO æ¥å£ï¼Œç›´æ¥é€šè¿‡ JNI è¯»å†™æ–‡ä»¶æˆ–ç½‘ç»œæ˜¯æ— æ³•å®ç°è°ƒåº¦çš„ã€‚æ­¤å¤–ï¼Œåœ¨ <code>synchronized</code> å—å†…éƒ¨ä¹Ÿæ— æ³•è°ƒåº¦ã€‚</p><h2 id="ğŸ€-ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#ğŸ€-ç»ƒä¹ " aria-hidden="true">#</a> ğŸ€ ç»ƒä¹ </h2><p>ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹è°ƒåº¦ 10 ä¸‡ä¸ªä»»åŠ¡å¹¶è§‚å¯Ÿè€—æ—¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newVirtualThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†å°† <code>ExecutorService</code> æ”¹ä¸ºçº¿ç¨‹æ± æ¨¡å¼å¹¶å¯¹æ¯”ç»“æœã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itranswarp<span class="token punctuation">.</span>learnjava</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newVirtualThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;All virtual threads end at %s ms.\\n&quot;</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ€-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å°ç»“" aria-hidden="true">#</a> ğŸ€ å°ç»“</h2><p>Java 19 å¼•å…¥çš„è™šæ‹Ÿçº¿ç¨‹æ˜¯ä¸ºäº†è§£å†³ IO å¯†é›†å‹ä»»åŠ¡çš„ååé‡ï¼Œå®ƒå¯ä»¥é«˜æ•ˆé€šè¿‡å°‘æ•°çº¿ç¨‹å»è°ƒåº¦å¤§é‡è™šæ‹Ÿçº¿ç¨‹ï¼›</p><p>è™šæ‹Ÿçº¿ç¨‹åœ¨æ‰§è¡Œåˆ° IO æ“ä½œæˆ– Blocking æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œï¼Œä»è€Œé¿å…å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œèƒ½æœ€å¤§åŒ–çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ï¼›</p><p>è™šæ‹Ÿçº¿ç¨‹ä½¿ç”¨æ™®é€šçº¿ç¨‹ç›¸åŒçš„æ¥å£ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œå°±å¯ä»¥å°†ç°æœ‰çš„ IO æ“ä½œå¼‚æ­¥åŒ–è·å¾—æ›´å¤§çš„ååèƒ½åŠ›ã€‚</p><p>è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸åº”ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Œåªèƒ½é€šè¿‡å¢åŠ  CPU æ ¸å¿ƒè§£å†³ï¼Œæˆ–è€…åˆ©ç”¨åˆ†å¸ƒå¼è®¡ç®—èµ„æºã€‚</p>`,44);function f(g,h){const s=c("router-link");return o(),l("div",null,[n("details",d,[v,n("nav",m,[n("ul",null,[n("li",null,[a(s,{to:"#ğŸ€-ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹"},{default:t(()=>[p("ğŸ€ ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-ä½¿ç”¨é™åˆ¶"},{default:t(()=>[p("ğŸ€ ä½¿ç”¨é™åˆ¶")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-ç»ƒä¹ "},{default:t(()=>[p("ğŸ€ ç»ƒä¹ ")]),_:1})]),n("li",null,[a(s,{to:"#ğŸ€-å°ç»“"},{default:t(()=>[p("ğŸ€ å°ç»“")]),_:1})])])])]),b])}const x=e(r,[["render",f],["__file","22.html.vue"]]);export{x as default};
