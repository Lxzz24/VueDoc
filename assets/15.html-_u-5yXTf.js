import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as e,c as p,a as n,b as c,w as o,d as l,e as i}from"./app-CvlAI_tu.js";const u={},d={class:"hint-container details"},k=n("summary",null,"ç›®å½•",-1),r={class:"table-of-contents"},v=l(`<p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»é€šè¿‡ <code>ReentrantLock</code> å’Œ <code>Condition</code> å®ç°äº†ä¸€ä¸ª <code>BlockingQueue</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>BlockingQueue</code> çš„æ„æ€å°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¿™ä¸ª <code>TaskQueue</code> çš„ <code>getTask()</code> æ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•å†…éƒ¨å¯èƒ½ä¼šè®©çº¿ç¨‹å˜æˆç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°é˜Ÿåˆ—æ¡ä»¶æ»¡è¶³ä¸ä¸ºç©ºï¼Œçº¿ç¨‹è¢«å”¤é†’åï¼Œ<code>getTask()</code> æ–¹æ³•æ‰ä¼šè¿”å›ã€‚</p><p>å› ä¸º <code>BlockingQueue</code> éå¸¸æœ‰ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…è‡ªå·±ç¼–å†™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Java æ ‡å‡†åº“çš„ <code>java.util.concurrent</code> åŒ…æä¾›çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼š<code>ArrayBlockingQueue</code>ã€‚</p><p>é™¤äº† <code>BlockingQueue</code> å¤–ï¼Œé’ˆå¯¹ <code>List</code>ã€<code>Map</code>ã€<code>Set</code>ã€<code>Deque</code> ç­‰ï¼Œ<code>java.util.concurrent</code> åŒ…ä¹Ÿæä¾›äº†å¯¹åº”çš„å¹¶å‘é›†åˆç±»ã€‚æˆ‘ä»¬å½’çº³ä¸€ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left;">interface</th><th style="text-align:left;">non-thread-safe</th><th style="text-align:left;">thread-safe</th></tr></thead><tbody><tr><td style="text-align:left;">List</td><td style="text-align:left;">ArrayList</td><td style="text-align:left;">CopyOnWriteArrayList</td></tr><tr><td style="text-align:left;">Map</td><td style="text-align:left;">HashMap</td><td style="text-align:left;">ConcurrentHashMap</td></tr><tr><td style="text-align:left;">Set</td><td style="text-align:left;">HashSet / TreeSet</td><td style="text-align:left;">CopyOnWriteArraySet</td></tr><tr><td style="text-align:left;">Queue</td><td style="text-align:left;">ArrayDeque / LinkedList</td><td style="text-align:left;">ArrayBlockingQueue / LinkedBlockingQueue</td></tr><tr><td style="text-align:left;">Deque</td><td style="text-align:left;">ArrayDeque / LinkedList</td><td style="text-align:left;">LinkedBlockingDeque</td></tr></tbody></table><p>ä½¿ç”¨è¿™äº›å¹¶å‘é›†åˆä¸ä½¿ç”¨éçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»å®Œå…¨ç›¸åŒã€‚æˆ‘ä»¬ä»¥ <code>ConcurrentHashMap</code> ä¸ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åœ¨ä¸åŒçš„çº¿ç¨‹è¯»å†™:</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºæ‰€æœ‰çš„åŒæ­¥å’ŒåŠ é”çš„é€»è¾‘éƒ½åœ¨é›†åˆå†…éƒ¨å®ç°ï¼Œå¯¹å¤–éƒ¨è°ƒç”¨è€…æ¥è¯´ï¼Œåªéœ€è¦æ­£å¸¸æŒ‰æ¥å£å¼•ç”¨ï¼Œå…¶ä»–ä»£ç å’ŒåŸæ¥çš„éçº¿ç¨‹å®‰å…¨ä»£ç å®Œå…¨ä¸€æ ·ã€‚å³å½“æˆ‘ä»¬éœ€è¦å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼ŒæŠŠï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ”¹ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å°±å¯ä»¥äº†ã€‚</p><p><code>java.util.Collections</code> å·¥å…·ç±»è¿˜æä¾›äº†ä¸€ä¸ªæ—§çš„çº¿ç¨‹å®‰å…¨é›†åˆè½¬æ¢å™¨ï¼Œå¯ä»¥è¿™ä¹ˆç”¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Map</span> unsafeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span> threadSafeMap <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedMap</span><span class="token punctuation">(</span>unsafeMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯å®ƒå®é™…ä¸Šæ˜¯ç”¨ä¸€ä¸ªåŒ…è£…ç±»åŒ…è£…äº†éçº¿ç¨‹å®‰å…¨çš„ <code>Map</code>ï¼Œç„¶åå¯¹æ‰€æœ‰è¯»å†™æ–¹æ³•éƒ½ç”¨ <code>synchronized</code> åŠ é”ï¼Œè¿™æ ·è·å¾—çš„çº¿ç¨‹å®‰å…¨é›†åˆçš„æ€§èƒ½æ¯” <code>java.util.concurrent</code> é›†åˆè¦ä½å¾ˆå¤šï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨ã€‚</p><h2 id="ğŸ€-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å°ç»“" aria-hidden="true">#</a> ğŸ€ å°ç»“</h2><p>ä½¿ç”¨ <code>java.util.concurrent</code> åŒ…æä¾›çš„çº¿ç¨‹å®‰å…¨çš„å¹¶å‘é›†åˆå¯ä»¥å¤§å¤§ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼š</p><p>å¤šçº¿ç¨‹åŒæ—¶è¯»å†™å¹¶å‘é›†åˆæ˜¯å®‰å…¨çš„ï¼›</p><p>å°½é‡ä½¿ç”¨ Java æ ‡å‡†åº“æä¾›çš„å¹¶å‘é›†åˆï¼Œé¿å…è‡ªå·±ç¼–å†™åŒæ­¥ä»£ç ã€‚</p>`,20);function m(g,y){const s=t("router-link");return e(),p("div",null,[n("details",d,[k,n("nav",r,[n("ul",null,[n("li",null,[c(s,{to:"#ğŸ€-å°ç»“"},{default:o(()=>[i("ğŸ€ å°ç»“")]),_:1})])])])]),v])}const h=a(u,[["render",m],["__file","15.html.vue"]]);export{h as default};
