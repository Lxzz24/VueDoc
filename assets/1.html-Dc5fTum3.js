import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as i,c as u,a as n,b as s,w as t,e as a,d as o}from"./app-CvlAI_tu.js";const d="/VueDoc/assets/image-20231221141823078-P5LRYTDj.png",r="/VueDoc/assets/image-20231221141916813-CyQ50rVi.png",k="/VueDoc/assets/image-20231221142031735-B8Lr3fuV.png",v={},m={class:"hint-container details"},b=n("summary",null,"ç›®å½•",-1),g={class:"table-of-contents"},w=o(`<p>åœ¨å­¦ä¹  Spring æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„æ¦‚å¿µå°±æ˜¯å®¹å™¨ã€‚</p><p>ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿå®¹å™¨æ˜¯ä¸€ç§ä¸ºæŸç§ç‰¹å®šç»„ä»¶çš„è¿è¡Œæä¾›å¿…è¦æ”¯æŒçš„ä¸€ä¸ªè½¯ä»¶ç¯å¢ƒã€‚ä¾‹å¦‚ï¼ŒTomcat å°±æ˜¯ä¸€ä¸ª Servlet å®¹å™¨ï¼Œå®ƒå¯ä»¥ä¸º Servlet çš„è¿è¡Œæä¾›è¿è¡Œç¯å¢ƒã€‚ç±»ä¼¼ Docker è¿™æ ·çš„è½¯ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæä¾›äº†å¿…è¦çš„ Linux ç¯å¢ƒä»¥ä¾¿è¿è¡Œä¸€ä¸ªç‰¹å®šçš„ Linux è¿›ç¨‹ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨å®¹å™¨è¿è¡Œç»„ä»¶ï¼Œé™¤äº†æä¾›ä¸€ä¸ªç»„ä»¶è¿è¡Œç¯å¢ƒä¹‹å¤–ï¼Œå®¹å™¨è¿˜æä¾›äº†è®¸å¤šåº•å±‚æœåŠ¡ã€‚ä¾‹å¦‚ï¼ŒServlet å®¹å™¨åº•å±‚å®ç°äº† TCP è¿æ¥ï¼Œè§£æ HTTP åè®®ç­‰éå¸¸å¤æ‚çš„æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰å®¹å™¨æ¥æä¾›è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬å°±æ— æ³•ç¼–å†™åƒ Servlet è¿™æ ·ä»£ç ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§çš„ç»„ä»¶ã€‚æ—©æœŸçš„ JavaEE æœåŠ¡å™¨æä¾›çš„ EJB å®¹å™¨æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡å£°æ˜å¼äº‹åŠ¡æœåŠ¡ï¼Œä½¿å¾— EJB ç»„ä»¶çš„å¼€å‘äººå‘˜ä¸å¿…è‡ªå·±ç¼–å†™å†—é•¿çš„äº‹åŠ¡å¤„ç†ä»£ç ï¼Œæ‰€ä»¥æå¤§åœ°ç®€åŒ–äº†äº‹åŠ¡å¤„ç†ã€‚</p><p>Spring çš„æ ¸å¿ƒå°±æ˜¯æä¾›äº†ä¸€ä¸ª IoC å®¹å™¨ï¼Œå®ƒå¯ä»¥ç®¡ç†æ‰€æœ‰è½»é‡çº§çš„ JavaBean ç»„ä»¶ï¼Œæä¾›çš„åº•å±‚æœåŠ¡åŒ…æ‹¬ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é…ç½®å’Œç»„è£…æœåŠ¡ã€AOP æ”¯æŒï¼Œä»¥åŠå»ºç«‹åœ¨ AOP åŸºç¡€ä¸Šçš„å£°æ˜å¼äº‹åŠ¡æœåŠ¡ç­‰ã€‚</p><p>æœ¬ç« æˆ‘ä»¬è®¨è®ºçš„ IoC å®¹å™¨ï¼Œä¸»è¦ä»‹ç» Spring å®¹å™¨å¦‚ä½•å¯¹ç»„ä»¶è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œé…ç½®ç»„è£…æœåŠ¡ã€‚</p><h2 id="ğŸ€-ioc-åŸç†" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ioc-åŸç†" aria-hidden="true">#</a> ğŸ€ IoC åŸç†</h2><p>Spring æä¾›çš„å®¹å™¨åˆç§°ä¸º IoC å®¹å™¨ï¼Œä»€ä¹ˆæ˜¯ IoCï¼Ÿ</p><p>IoC å…¨ç§° Inversion of Controlï¼Œç›´è¯‘ä¸ºæ§åˆ¶åè½¬ã€‚é‚£ä¹ˆä½•è°“ IoCï¼Ÿåœ¨ç†è§£ IoC ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹é€šå¸¸çš„ Java ç»„ä»¶æ˜¯å¦‚ä½•åä½œçš„ã€‚</p><p>æˆ‘ä»¬å‡å®šä¸€ä¸ªåœ¨çº¿ä¹¦åº—ï¼Œé€šè¿‡ <code>BookService</code> è·å–ä¹¦ç±ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">HikariConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getBook</span><span class="token punctuation">(</span><span class="token keyword">long</span> bookId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token keyword">return</span> book<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†ä»æ•°æ®åº“æŸ¥è¯¢ä¹¦ç±ï¼Œ<code>BookService</code> æŒæœ‰ä¸€ä¸ª <code>DataSource</code>ã€‚ä¸ºäº†å®ä¾‹åŒ–ä¸€ä¸ª <code>HikariDataSource</code>ï¼Œåˆä¸å¾—ä¸å®ä¾‹åŒ–ä¸€ä¸ª <code>HikariConfig</code>ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­ç¼–å†™ <code>UserService</code> è·å–ç”¨æˆ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">HikariConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º <code>UserService</code> ä¹Ÿéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¹Ÿå®ä¾‹åŒ–ä¸€ä¸ª <code>HikariDataSource</code>ã€‚</p><p>åœ¨å¤„ç†ç”¨æˆ·è´­ä¹°çš„ <code>CartServlet</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ– <code>UserService</code> å’Œ <code>BookService</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BookService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> currentUserId <span class="token operator">=</span> <span class="token function">getFromCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> currentUser <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>currentUserId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">getBook</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;bookId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartService<span class="token punctuation">.</span><span class="token function">addToCart</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">,</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç±»ä¼¼çš„ï¼Œåœ¨è´­ä¹°å†å² <code>HistoryServlet</code> ä¸­ï¼Œä¹Ÿéœ€è¦å®ä¾‹åŒ– <code>UserService</code> å’Œ <code>BookService</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HistoryServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BookService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°æ¯ä¸ªç»„ä»¶éƒ½é‡‡ç”¨äº†ä¸€ç§ç®€å•çš„é€šè¿‡ <code>new</code> åˆ›å»ºå®ä¾‹å¹¶æŒæœ‰çš„æ–¹å¼ã€‚ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç°ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ol><li>å®ä¾‹åŒ–ä¸€ä¸ªç»„ä»¶å…¶å®å¾ˆéš¾ï¼Œä¾‹å¦‚ï¼Œ<code>BookService</code> å’Œ <code>UserService</code> è¦åˆ›å»º <code>HikariDataSource</code>ï¼Œå®é™…ä¸Šéœ€è¦è¯»å–é…ç½®ï¼Œæ‰èƒ½å…ˆå®ä¾‹åŒ– <code>HikariConfig</code>ï¼Œå†å®ä¾‹åŒ– <code>HikariDataSource</code>ã€‚</li><li>æ²¡æœ‰å¿…è¦è®© <code>BookService</code> å’Œ <code>UserService</code> åˆ†åˆ«åˆ›å»º <code>DataSource</code> å®ä¾‹ï¼Œå®Œå…¨å¯ä»¥å…±äº«åŒä¸€ä¸ª <code>DataSource</code>ï¼Œä½†è°è´Ÿè´£åˆ›å»º <code>DataSource</code>ï¼Œè°è´Ÿè´£è·å–å…¶ä»–ç»„ä»¶å·²ç»åˆ›å»ºçš„ <code>DataSource</code>ï¼Œä¸å¥½å¤„ç†ã€‚ç±»ä¼¼çš„ï¼Œ<code>CartServlet</code> å’Œ <code>HistoryServlet</code> ä¹Ÿåº”å½“å…±äº« <code>BookService</code> å®ä¾‹å’Œ <code>UserService</code> å®ä¾‹ï¼Œä½†ä¹Ÿä¸å¥½å¤„ç†ã€‚</li><li>å¾ˆå¤šç»„ä»¶éœ€è¦é”€æ¯ä»¥ä¾¿é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚ <code>DataSource</code>ï¼Œä½†å¦‚æœè¯¥ç»„ä»¶è¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¦‚ä½•ç¡®ä¿å®ƒçš„ä½¿ç”¨æ–¹éƒ½å·²ç»å…¨éƒ¨è¢«é”€æ¯ï¼Ÿ</li><li>éšç€æ›´å¤šçš„ç»„ä»¶è¢«å¼•å…¥ï¼Œä¾‹å¦‚ï¼Œä¹¦ç±è¯„è®ºï¼Œéœ€è¦å…±äº«çš„ç»„ä»¶å†™èµ·æ¥ä¼šæ›´å›°éš¾ï¼Œè¿™äº›ç»„ä»¶çš„ä¾èµ–å…³ç³»ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚</li><li>æµ‹è¯•æŸä¸ªç»„ä»¶ï¼Œä¾‹å¦‚ <code>BookService</code>ï¼Œæ˜¯å¤æ‚çš„ï¼Œå› ä¸ºå¿…é¡»è¦åœ¨çœŸå®çš„æ•°æ®åº“ç¯å¢ƒä¸‹æ‰§è¡Œã€‚</li></ol><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚</p><p>å› æ­¤ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯ï¼š</p><ol><li>è°è´Ÿè´£åˆ›å»ºç»„ä»¶ï¼Ÿ</li><li>è°è´Ÿè´£æ ¹æ®ä¾èµ–å…³ç³»ç»„è£…ç»„ä»¶ï¼Ÿ</li><li>é”€æ¯æ—¶ï¼Œå¦‚ä½•æŒ‰ä¾èµ–é¡ºåºæ­£ç¡®é”€æ¯ï¼Ÿ</li></ol><p>è§£å†³è¿™ä¸€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆå°±æ˜¯ IoCã€‚</p><p>ä¼ ç»Ÿçš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ§åˆ¶æƒåœ¨ç¨‹åºæœ¬èº«ï¼Œç¨‹åºçš„æ§åˆ¶æµç¨‹å®Œå…¨ç”±å¼€å‘è€…æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š</p><p><code>CartServlet</code> åˆ›å»ºäº† <code>BookService</code>ï¼Œåœ¨åˆ›å»º <code>BookService</code> çš„è¿‡ç¨‹ä¸­ï¼Œåˆåˆ›å»ºäº† <code>DataSource</code> ç»„ä»¶ã€‚è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€ä¸ªç»„ä»¶å¦‚æœè¦ä½¿ç”¨å¦ä¸€ä¸ªç»„ä»¶ï¼Œå¿…é¡»å…ˆçŸ¥é“å¦‚ä½•æ­£ç¡®åœ°åˆ›å»ºå®ƒã€‚</p><p>åœ¨ IoC æ¨¡å¼ä¸‹ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œå³ä»åº”ç”¨ç¨‹åºè½¬ç§»åˆ°äº† IoC å®¹å™¨ï¼Œæ‰€æœ‰ç»„ä»¶ä¸å†ç”±åº”ç”¨ç¨‹åºè‡ªå·±åˆ›å»ºå’Œé…ç½®ï¼Œè€Œæ˜¯ç”± IoC å®¹å™¨è´Ÿè´£ï¼Œè¿™æ ·ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥ä½¿ç”¨å·²ç»åˆ›å»ºå¥½å¹¶ä¸”é…ç½®å¥½çš„ç»„ä»¶ã€‚ä¸ºäº†èƒ½è®©ç»„ä»¶åœ¨ IoC å®¹å™¨ä¸­è¢« â€œè£…é…â€ å‡ºæ¥ï¼Œéœ€è¦æŸç§ â€œæ³¨å…¥â€ æœºåˆ¶ï¼Œä¾‹å¦‚ï¼Œ<code>BookService</code> è‡ªå·±å¹¶ä¸ä¼šåˆ›å»º <code>DataSource</code>ï¼Œè€Œæ˜¯ç­‰å¾…å¤–éƒ¨é€šè¿‡ <code>setDataSource()</code> æ–¹æ³•æ¥æ³¨å…¥ä¸€ä¸ª <code>DataSource</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ç›´æ¥ <code>new</code> ä¸€ä¸ª <code>DataSource</code>ï¼Œè€Œæ˜¯æ³¨å…¥ä¸€ä¸ª <code>DataSource</code>ï¼Œè¿™ä¸ªå°å°çš„æ”¹åŠ¨è™½ç„¶ç®€å•ï¼Œå´å¸¦æ¥äº†ä¸€ç³»åˆ—å¥½å¤„ï¼š</p><ol><li><code>BookService</code> ä¸å†å…³å¿ƒå¦‚ä½•åˆ›å»º <code>DataSource</code>ï¼Œå› æ­¤ï¼Œä¸å¿…ç¼–å†™è¯»å–æ•°æ®åº“é…ç½®ä¹‹ç±»çš„ä»£ç ï¼›</li><li><code>DataSource</code> å®ä¾‹è¢«æ³¨å…¥åˆ° <code>BookService</code>ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ³¨å…¥åˆ° <code>UserService</code>ï¼Œå› æ­¤ï¼Œå…±äº«ä¸€ä¸ªç»„ä»¶éå¸¸ç®€å•ï¼›</li><li>æµ‹è¯• <code>BookService</code> æ›´å®¹æ˜“ï¼Œå› ä¸ºæ³¨å…¥çš„æ˜¯ <code>DataSource</code>ï¼Œå¯ä»¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œè€Œä¸æ˜¯çœŸå®çš„ MySQL é…ç½®ã€‚</li></ol><p>å› æ­¤ï¼ŒIoC åˆç§°ä¸ºä¾èµ–æ³¨å…¥ï¼ˆDIï¼šDependency Injectionï¼‰ï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜ï¼šå°†ç»„ä»¶çš„åˆ›å»º + é…ç½®ä¸ç»„ä»¶çš„ä½¿ç”¨ç›¸åˆ†ç¦»ï¼Œå¹¶ä¸”ï¼Œç”± IoC å®¹å™¨è´Ÿè´£ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>å› ä¸º IoC å®¹å™¨è¦è´Ÿè´£å®ä¾‹åŒ–æ‰€æœ‰çš„ç»„ä»¶ï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦å‘Šè¯‰å®¹å™¨å¦‚ä½•åˆ›å»ºç»„ä»¶ï¼Œä»¥åŠå„ç»„ä»¶çš„ä¾èµ–å…³ç³»ã€‚ä¸€ç§æœ€ç®€å•çš„é…ç½®æ˜¯é€šè¿‡ XML æ–‡ä»¶æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HikariDataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BookService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿° XML é…ç½®æ–‡ä»¶æŒ‡ç¤º IoC å®¹å™¨åˆ›å»º 3 ä¸ª JavaBean ç»„ä»¶ï¼Œå¹¶æŠŠ id ä¸º <code>dataSource</code> çš„ç»„ä»¶é€šè¿‡å±æ€§ <code>dataSource</code>ï¼ˆå³è°ƒç”¨ <code>setDataSource()</code> æ–¹æ³•ï¼‰æ³¨å…¥åˆ°å¦å¤–ä¸¤ä¸ªç»„ä»¶ä¸­ã€‚</p><p>åœ¨ Spring çš„ IoC å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰ç»„ä»¶ç»Ÿç§°ä¸º JavaBeanï¼Œå³é…ç½®ä¸€ä¸ªç»„ä»¶å°±æ˜¯é…ç½®ä¸€ä¸ª Beanã€‚</p><h3 id="ä¾èµ–æ³¨å…¥æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–æ³¨å…¥æ–¹å¼" aria-hidden="true">#</a> ä¾èµ–æ³¨å…¥æ–¹å¼</h3><p>æˆ‘ä»¬ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œä¾èµ–æ³¨å…¥å¯ä»¥é€šè¿‡ <code>set()</code> æ–¹æ³•å®ç°ã€‚ä½†ä¾èµ–æ³¨å…¥ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•å®ç°ã€‚</p><p>å¾ˆå¤š Java ç±»éƒ½å…·æœ‰å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ <code>BookService</code> æ”¹é€ ä¸ºé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œé‚£ä¹ˆå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BookService</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring çš„ IoC å®¹å™¨åŒæ—¶æ”¯æŒå±æ€§æ³¨å…¥å’Œæ„é€ æ–¹æ³•æ³¨å…¥ï¼Œå¹¶å…è®¸æ··åˆä½¿ç”¨ã€‚</p><h3 id="æ— ä¾µå…¥å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#æ— ä¾µå…¥å®¹å™¨" aria-hidden="true">#</a> æ— ä¾µå…¥å®¹å™¨</h3><p>åœ¨è®¾è®¡ä¸Šï¼ŒSpring çš„ IoC å®¹å™¨æ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„æ— ä¾µå…¥å®¹å™¨ã€‚æ‰€è°“æ— ä¾µå…¥ï¼Œæ˜¯æŒ‡åº”ç”¨ç¨‹åºçš„ç»„ä»¶æ— éœ€å®ç° Spring çš„ç‰¹å®šæ¥å£ï¼Œæˆ–è€…è¯´ï¼Œç»„ä»¶æ ¹æœ¬ä¸çŸ¥é“è‡ªå·±åœ¨ Spring çš„å®¹å™¨ä¸­è¿è¡Œã€‚è¿™ç§æ— ä¾µå…¥çš„è®¾è®¡æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ol><li>åº”ç”¨ç¨‹åºç»„ä»¶æ—¢å¯ä»¥åœ¨ Spring çš„ IoC å®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä»£ç è‡ªè¡Œç»„è£…é…ç½®ï¼›</li><li>æµ‹è¯•çš„æ—¶å€™å¹¶ä¸ä¾èµ– Spring å®¹å™¨ï¼Œå¯å•ç‹¬è¿›è¡Œæµ‹è¯•ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li></ol><h2 id="ğŸ€-è£…é…-bean" tabindex="-1"><a class="header-anchor" href="#ğŸ€-è£…é…-bean" aria-hidden="true">#</a> ğŸ€ è£…é… Bean</h2><p>æˆ‘ä»¬å‰é¢è®¨è®ºäº†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Spring çš„ IoC å®¹å™¨ï¼Œå› ä¸ºè®©å®¹å™¨æ¥ä¸ºæˆ‘ä»¬åˆ›å»ºå¹¶è£…é… Bean èƒ½è·å¾—å¾ˆå¤§çš„å¥½å¤„ï¼Œé‚£ä¹ˆåˆ°åº•å¦‚ä½•ä½¿ç”¨ IoC å®¹å™¨ï¼Ÿè£…é…å¥½çš„ Bean åˆå¦‚ä½•ä½¿ç”¨ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ç”¨æˆ·æ³¨å†Œç™»å½•çš„ä¾‹å­ã€‚æ•´ä¸ªå·¥ç¨‹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="`+d+`" alt="image-20231221141823078" tabindex="0" loading="lazy"><figcaption>image-20231221141823078</figcaption></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ Maven åˆ›å»ºå·¥ç¨‹å¹¶å¼•å…¥ <code>spring-context</code> ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-context:6.0.0</li></ul><p>æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ª <code>MailService</code>ï¼Œç”¨äºåœ¨ç”¨æˆ·ç™»å½•å’Œæ³¨å†ŒæˆåŠŸåå‘é€é‚®ä»¶é€šçŸ¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ZoneId</span> zoneId <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setZoneId</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span> zoneId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>zoneId <span class="token operator">=</span> zoneId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">ISO_ZONED_DATE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendLoginMail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hi, %s! You are logged in at %s&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendRegistrationMail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome, %s!&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ç¼–å†™ä¸€ä¸ª <code>UserService</code>ï¼Œå®ç°ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">MailService</span> mailService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMailService</span><span class="token punctuation">(</span><span class="token class-name">MailService</span> mailService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailService <span class="token operator">=</span> mailService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span> <span class="token comment">// users:</span>
            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// bob</span>
            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;alice@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// alice</span>
            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;tom@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tom</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mailService<span class="token punctuation">.</span><span class="token function">sendLoginMail</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;login failed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-&gt;</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;email exist.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToLong</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mailService<span class="token punctuation">.</span><span class="token function">sendRegistrationMail</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ° <code>UserService</code> é€šè¿‡ <code>setMailService()</code> æ³¨å…¥äº†ä¸€ä¸ª <code>MailService</code>ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªç‰¹å®šçš„ <code>application.xml</code> é…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰ Spring çš„ IoC å®¹å™¨åº”è¯¥å¦‚ä½•åˆ›å»ºå¹¶ç»„è£… Beanï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itranswarp.learnjava.service.UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mailService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mailService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mailService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itranswarp.learnjava.service.MailService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è§‚å¯Ÿä¸Šè¿°é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ä¸ XML Schema ç›¸å…³çš„éƒ¨åˆ†æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬åªå…³æ³¨ä¸¤ä¸ª <code>&lt;bean ...&gt;</code> çš„é…ç½®ï¼š</p><ul><li>æ¯ä¸ª <code>&lt;bean ...&gt;</code> éƒ½æœ‰ä¸€ä¸ª <code>id</code> æ ‡è¯†ï¼Œç›¸å½“äº Bean çš„å”¯ä¸€ IDï¼›</li><li>åœ¨ <code>userService</code>Bean ä¸­ï¼Œé€šè¿‡ <code>&lt;property name=&quot;...&quot; ref=&quot;...&quot; /&gt;</code> æ³¨å…¥äº†å¦ä¸€ä¸ª Beanï¼›</li><li>Bean çš„é¡ºåºä¸é‡è¦ï¼ŒSpring æ ¹æ®ä¾èµ–å…³ç³»ä¼šè‡ªåŠ¨æ­£ç¡®åˆå§‹åŒ–ã€‚</li></ul><p>æŠŠä¸Šè¿° XML é…ç½®æ–‡ä»¶ç”¨ Java ä»£ç å†™å‡ºæ¥ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MailService</span> mailService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userService<span class="token punctuation">.</span><span class="token function">setMailService</span><span class="token punctuation">(</span>mailService<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åªä¸è¿‡ Spring å®¹å™¨æ˜¯é€šè¿‡è¯»å– XML æ–‡ä»¶åä½¿ç”¨åå°„å®Œæˆçš„ã€‚</p><p>å¦‚æœæ³¨å…¥çš„ä¸æ˜¯ Beanï¼Œè€Œæ˜¯ <code>boolean</code>ã€<code>int</code>ã€<code>String</code> è¿™æ ·çš„æ•°æ®ç±»å‹ï¼Œåˆ™é€šè¿‡ <code>value</code> æ³¨å…¥ï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª <code>HikariDataSource</code>ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.zaxxer.hikari.HikariDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>maximumPoolSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>autoCommit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Spring çš„ IoC å®¹å™¨å®ä¾‹ï¼Œç„¶ååŠ è½½é…ç½®æ–‡ä»¶ï¼Œè®© Spring å®¹å™¨ä¸ºæˆ‘ä»¬åˆ›å»ºå¹¶è£…é…å¥½é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ‰€æœ‰ Beanï¼Œè¿™åªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;application.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» Spring å®¹å™¨ä¸­ â€œå–å‡ºâ€ è£…é…å¥½çš„ Bean ç„¶åä½¿ç”¨å®ƒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// è·å– Bean:</span>
<span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ­£å¸¸è°ƒç”¨:</span>
<span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæ•´çš„ <code>main()</code> æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;application.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="applicationcontext" tabindex="-1"><a class="header-anchor" href="#applicationcontext" aria-hidden="true">#</a> ApplicationContext</h3><p>æˆ‘ä»¬ä»åˆ›å»º Spring å®¹å™¨çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;application.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒSpring å®¹å™¨å°±æ˜¯ <code>ApplicationContext</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰å¾ˆå¤šå®ç°ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© <code>ClassPathXmlApplicationContext</code>ï¼Œè¡¨ç¤ºå®ƒä¼šè‡ªåŠ¨ä» classpath ä¸­æŸ¥æ‰¾æŒ‡å®šçš„ XML é…ç½®æ–‡ä»¶ã€‚</p><p>è·å¾—äº† <code>ApplicationContext</code> çš„å®ä¾‹ï¼Œå°±è·å¾—äº† IoC å®¹å™¨çš„å¼•ç”¨ã€‚ä» <code>ApplicationContext</code> ä¸­æˆ‘ä»¬å¯ä»¥æ ¹æ® Bean çš„ ID è·å– Beanï¼Œä½†æ›´å¤šçš„æ—¶å€™æˆ‘ä»¬æ ¹æ® Bean çš„ç±»å‹è·å– Bean çš„å¼•ç”¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Spring è¿˜æä¾›å¦ä¸€ç§ IoC å®¹å™¨å« <code>BeanFactory</code>ï¼Œä½¿ç”¨æ–¹å¼å’Œ <code>ApplicationContext</code> ç±»ä¼¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">BeanFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;application.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MailService</span> mailService <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>BeanFactory</code> å’Œ <code>ApplicationContext</code> çš„åŒºåˆ«åœ¨äºï¼Œ<code>BeanFactory</code> çš„å®ç°æ˜¯æŒ‰éœ€åˆ›å»ºï¼Œå³ç¬¬ä¸€æ¬¡è·å– Bean æ—¶æ‰åˆ›å»ºè¿™ä¸ª Beanï¼Œè€Œ <code>ApplicationContext</code> ä¼šä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„ Beanã€‚å®é™…ä¸Šï¼Œ<code>ApplicationContext</code> æ¥å£æ˜¯ä» <code>BeanFactory</code> æ¥å£ç»§æ‰¿è€Œæ¥çš„ï¼Œå¹¶ä¸”ï¼Œ<code>ApplicationContext</code> æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶å’Œé€šçŸ¥æœºåˆ¶ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€»æ˜¯ä½¿ç”¨ <code>ApplicationContext</code>ï¼Œå¾ˆå°‘ä¼šè€ƒè™‘ä½¿ç”¨ <code>BeanFactory</code>ã€‚</p><h3 id="ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ " aria-hidden="true">#</a> ç»ƒä¹ </h3><p>åœ¨ä¸Šè¿°ç¤ºä¾‹çš„åŸºç¡€ä¸Šï¼Œç»§ç»­ç»™ <code>UserService</code> æ³¨å…¥ <code>DataSource</code>ï¼Œå¹¶æŠŠæ³¨å†Œå’Œç™»å½•åŠŸèƒ½é€šè¿‡æ•°æ®åº“å®ç°ã€‚</p><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h3><p>Spring çš„ IoC å®¹å™¨æ¥å£æ˜¯ <code>ApplicationContext</code>ï¼Œå¹¶æä¾›äº†å¤šç§å®ç°ç±»ï¼›</p><p>é€šè¿‡ XML é…ç½®æ–‡ä»¶åˆ›å»º IoC å®¹å™¨æ—¶ï¼Œä½¿ç”¨ <code>ClassPathXmlApplicationContext</code>ï¼›</p><p>æŒæœ‰ IoC å®¹å™¨åï¼Œé€šè¿‡ <code>getBean()</code> æ–¹æ³•è·å– Bean çš„å¼•ç”¨ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨-annotation-é…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-annotation-é…ç½®" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ Annotation é…ç½®</h2><p>ä½¿ç”¨ Spring çš„ IoC å®¹å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡ç±»ä¼¼ XML è¿™æ ·çš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠæˆ‘ä»¬è‡ªå·±çš„ Bean çš„ä¾èµ–å…³ç³»æè¿°å‡ºæ¥ï¼Œç„¶åè®©å®¹å™¨æ¥åˆ›å»ºå¹¶è£…é… Beanã€‚ä¸€æ—¦å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä»å®¹å™¨ä¸­è·å– Bean ä½¿ç”¨å®ƒä»¬ã€‚</p><p>ä½¿ç”¨ XML é…ç½®çš„ä¼˜ç‚¹æ˜¯æ‰€æœ‰çš„ Bean éƒ½èƒ½ä¸€ç›®äº†ç„¶åœ°åˆ—å‡ºæ¥ï¼Œå¹¶é€šè¿‡é…ç½®æ³¨å…¥èƒ½ç›´è§‚åœ°çœ‹åˆ°æ¯ä¸ª Bean çš„ä¾èµ–ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯å†™èµ·æ¥éå¸¸ç¹çï¼Œæ¯å¢åŠ ä¸€ä¸ªç»„ä»¶ï¼Œå°±å¿…é¡»æŠŠæ–°çš„ Bean é…ç½®åˆ° XML ä¸­ã€‚</p><p>æœ‰æ²¡æœ‰å…¶ä»–æ›´ç®€å•çš„é…ç½®æ–¹å¼å‘¢ï¼Ÿ</p><p>æœ‰ï¼æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Annotation é…ç½®ï¼Œå¯ä»¥å®Œå…¨ä¸éœ€è¦ XMLï¼Œè®© Spring è‡ªåŠ¨æ‰«æ Bean å¹¶ç»„è£…å®ƒä»¬ã€‚</p><p>æˆ‘ä»¬æŠŠä¸Šä¸€èŠ‚çš„ç¤ºä¾‹æ”¹é€ ä¸€ä¸‹ï¼Œå…ˆåˆ é™¤ XML é…ç½®æ–‡ä»¶ï¼Œç„¶åï¼Œç»™ <code>UserService</code> å’Œ <code>MailService</code> æ·»åŠ å‡ ä¸ªæ³¨è§£ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ <code>MailService</code> æ·»åŠ ä¸€ä¸ª <code>@Component</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª <code>@Component</code> æ³¨è§£å°±ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ª Beanï¼Œå®ƒæœ‰ä¸€ä¸ªå¯é€‰çš„åç§°ï¼Œé»˜è®¤æ˜¯ <code>mailService</code>ï¼Œå³å°å†™å¼€å¤´çš„ç±»åã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ç»™ <code>UserService</code> æ·»åŠ ä¸€ä¸ª <code>@Component</code> æ³¨è§£å’Œä¸€ä¸ª <code>@Autowired</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MailService</span> mailService<span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>@Autowired</code> å°±ç›¸å½“äºæŠŠæŒ‡å®šç±»å‹çš„ Bean æ³¨å…¥åˆ°æŒ‡å®šçš„å­—æ®µä¸­ã€‚å’Œ XML é…ç½®ç›¸æ¯”ï¼Œ<code>@Autowired</code> å¤§å¹…ç®€åŒ–äº†æ³¨å…¥ï¼Œå› ä¸ºå®ƒä¸ä½†å¯ä»¥å†™åœ¨ <code>set()</code> æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç›´æ¥å†™åœ¨å­—æ®µä¸Šï¼Œç”šè‡³å¯ä»¥å†™åœ¨æ„é€ æ–¹æ³•ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token class-name">MailService</span> mailService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MailService</span> mailService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailService <span class="token operator">=</span> mailService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¸€èˆ¬æŠŠ <code>@Autowired</code> å†™åœ¨å­—æ®µä¸Šï¼Œé€šå¸¸ä½¿ç”¨ package æƒé™çš„å­—æ®µï¼Œä¾¿äºæµ‹è¯•ã€‚</p><p>æœ€åï¼Œç¼–å†™ä¸€ä¸ª <code>AppConfig</code> ç±»å¯åŠ¨å®¹å™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;bob@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº† <code>main()</code> æ–¹æ³•å¤–ï¼Œ<code>AppConfig</code> æ ‡æ³¨äº† <code>@Configuration</code>ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå› ä¸ºæˆ‘ä»¬åˆ›å»º <code>ApplicationContext</code> æ—¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨çš„å®ç°ç±»æ˜¯ <code>AnnotationConfigApplicationContext</code>ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªæ ‡æ³¨äº† <code>@Configuration</code> çš„ç±»åã€‚</p><p>æ­¤å¤–ï¼Œ<code>AppConfig</code> è¿˜æ ‡æ³¨äº† <code>@ComponentScan</code>ï¼Œå®ƒå‘Šè¯‰å®¹å™¨ï¼Œè‡ªåŠ¨æœç´¢å½“å‰ç±»æ‰€åœ¨çš„åŒ…ä»¥åŠå­åŒ…ï¼ŒæŠŠæ‰€æœ‰æ ‡æ³¨ä¸º <code>@Component</code> çš„ Bean è‡ªåŠ¨åˆ›å»ºå‡ºæ¥ï¼Œå¹¶æ ¹æ® <code>@Autowired</code> è¿›è¡Œè£…é…ã€‚</p><p>æ•´ä¸ªå·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="`+r+`" alt="image-20231221141916813" tabindex="0" loading="lazy"><figcaption>image-20231221141916813</figcaption></figure><p>ä½¿ç”¨ Annotation é…åˆè‡ªåŠ¨æ‰«æèƒ½å¤§å¹…ç®€åŒ– Spring çš„é…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯ï¼š</p><ul><li>æ¯ä¸ª Bean è¢«æ ‡æ³¨ä¸º <code>@Component</code> å¹¶æ­£ç¡®ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥ï¼›</li><li>é…ç½®ç±»è¢«æ ‡æ³¨ä¸º <code>@Configuration</code> å’Œ <code>@ComponentScan</code>ï¼›</li><li>æ‰€æœ‰ Bean å‡åœ¨æŒ‡å®šåŒ…ä»¥åŠå­åŒ…å†…ã€‚</li></ul><p>ä½¿ç”¨ <code>@ComponentScan</code> éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«æ³¨æ„åŒ…çš„å±‚æ¬¡ç»“æ„ã€‚é€šå¸¸æ¥è¯´ï¼Œå¯åŠ¨é…ç½® <code>AppConfig</code> ä½äºè‡ªå®šä¹‰çš„é¡¶å±‚åŒ…ï¼ˆä¾‹å¦‚ <code>com.itranswarp.learnjava</code>ï¼‰ï¼Œå…¶ä»– Bean æŒ‰ç±»åˆ«æ”¾å…¥å­åŒ…ã€‚</p><h3 id="æ€è€ƒ" tabindex="-1"><a class="header-anchor" href="#æ€è€ƒ" aria-hidden="true">#</a> æ€è€ƒ</h3><p>å¦‚æœæˆ‘ä»¬æƒ³ç»™ <code>UserService</code> æ³¨å…¥ <code>HikariDataSource</code>ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½äº <code>com.zaxxer.hikari</code> åŒ…ä¸­ï¼Œå¹¶ä¸” <code>HikariDataSource</code> ä¹Ÿä¸å¯èƒ½æœ‰ <code>@Component</code> æ³¨è§£ï¼Œå¦‚ä½•å‘Šè¯‰ IoC å®¹å™¨åˆ›å»ºå¹¶é…ç½® <code>HikariDataSource</code>ï¼Ÿæˆ–è€…æ¢ä¸ªè¯´æ³•ï¼Œå¦‚ä½•åˆ›å»ºå¹¶é…ç½®ä¸€ä¸ªç¬¬ä¸‰æ–¹ Beanï¼Ÿ</p><h3 id="ç»ƒä¹ -1" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -1" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>ä½¿ç”¨ Annotation é…ç½® IoC å®¹å™¨</p><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1" aria-hidden="true">#</a> å°ç»“</h3><p>ä½¿ç”¨ Annotation å¯ä»¥å¤§å¹…ç®€åŒ–é…ç½®ï¼Œæ¯ä¸ª Bean é€šè¿‡ <code>@Component</code> å’Œ <code>@Autowired</code> æ³¨å…¥ï¼›</p><p>å¿…é¡»åˆç†è®¾è®¡åŒ…çš„å±‚æ¬¡ç»“æ„ï¼Œæ‰èƒ½å‘æŒ¥ <code>@ComponentScan</code> çš„å¨åŠ›ã€‚</p><h2 id="ğŸ€-å®šåˆ¶-bean" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å®šåˆ¶-bean" aria-hidden="true">#</a> ğŸ€ å®šåˆ¶ Bean</h2><h3 id="scope" tabindex="-1"><a class="header-anchor" href="#scope" aria-hidden="true">#</a> Scope</h3><p>å¯¹äº Spring å®¹å™¨æ¥è¯´ï¼Œå½“æˆ‘ä»¬æŠŠä¸€ä¸ª Bean æ ‡è®°ä¸º <code>@Component</code> åï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼ˆSingletonï¼‰ï¼Œå³å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»º Beanï¼Œå®¹å™¨å…³é—­å‰é”€æ¯ Beanã€‚åœ¨å®¹å™¨è¿è¡ŒæœŸé—´ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>getBean(Class)</code> è·å–åˆ°çš„ Bean æ€»æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>è¿˜æœ‰ä¸€ç§ Beanï¼Œæˆ‘ä»¬æ¯æ¬¡è°ƒç”¨ <code>getBean(Class)</code>ï¼Œå®¹å™¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè¿™ç§ Bean ç§°ä¸º Prototypeï¼ˆåŸå‹ï¼‰ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¾ç„¶å’Œ Singleton ä¸åŒã€‚å£°æ˜ä¸€ä¸ª Prototype çš„ Bean æ—¶ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ <code>@Scope</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span><span class="token constant">SCOPE_PROTOTYPE</span><span class="token punctuation">)</span> <span class="token comment">// @Scope(&quot;prototype&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailSession</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨å…¥-list" tabindex="-1"><a class="header-anchor" href="#æ³¨å…¥-list" aria-hidden="true">#</a> æ³¨å…¥ List</h3><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ç³»åˆ—æ¥å£ç›¸åŒï¼Œä¸åŒå®ç°ç±»çš„ Beanã€‚ä¾‹å¦‚ï¼Œæ³¨å†Œç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬è¦å¯¹ emailã€password å’Œ name è¿™ 3 ä¸ªå˜é‡è¿›è¡ŒéªŒè¯ã€‚ä¸ºäº†ä¾¿äºæ‰©å±•ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰éªŒè¯æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåˆ†åˆ«ä½¿ç”¨ 3 ä¸ª <code>Validator</code> å¯¹ç”¨æˆ·å‚æ•°è¿›è¡ŒéªŒè¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;^[a-z0-9]+\\\\@[a-z0-9]+\\\\.[a-z]{2,10}$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid email:&quot;</span> <span class="token operator">+</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>password<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;^.{6,20}$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NameValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid name:&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª <code>Validators</code> ä½œä¸ºå…¥å£è¿›è¡ŒéªŒè¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Validators</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Validator</span><span class="token punctuation">&gt;</span></span> validators<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> validator <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ° <code>Validators</code> è¢«æ³¨å…¥äº†ä¸€ä¸ª <code>List&lt;Validator&gt;</code>ï¼ŒSpring ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰ç±»å‹ä¸º <code>Validator</code> çš„ Bean è£…é…ä¸ºä¸€ä¸ª <code>List</code> æ³¨å…¥è¿›æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ¯æ–°å¢ä¸€ä¸ª <code>Validator</code> ç±»å‹ï¼Œå°±è‡ªåŠ¨è¢« Spring è£…é…åˆ° <code>Validators</code> ä¸­äº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>å› ä¸º Spring æ˜¯é€šè¿‡æ‰«æ classpath è·å–åˆ°æ‰€æœ‰çš„ Beanï¼Œè€Œ <code>List</code> æ˜¯æœ‰åºçš„ï¼Œè¦æŒ‡å®š <code>List</code> ä¸­ Bean çš„é¡ºåºï¼Œå¯ä»¥åŠ ä¸Š <code>@Order</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NameValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯é€‰æ³¨å…¥" tabindex="-1"><a class="header-anchor" href="#å¯é€‰æ³¨å…¥" aria-hidden="true">#</a> å¯é€‰æ³¨å…¥</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æ ‡è®°äº†ä¸€ä¸ª <code>@Autowired</code> åï¼ŒSpring å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”ç±»å‹çš„ Beanï¼Œå®ƒä¼šæŠ›å‡º <code>NoSuchBeanDefinitionException</code> å¼‚å¸¸ã€‚</p><p>å¯ä»¥ç»™ <code>@Autowired</code> å¢åŠ ä¸€ä¸ª <code>required = false</code> çš„å‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> zoneId <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‚æ•°å‘Šè¯‰ Spring å®¹å™¨ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªç±»å‹ä¸º <code>ZoneId</code> çš„ Beanï¼Œå°±æ³¨å…¥ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å¿½ç•¥ã€‚</p><p>è¿™ç§æ–¹å¼éå¸¸é€‚åˆæœ‰å®šä¹‰å°±ä½¿ç”¨å®šä¹‰ï¼Œæ²¡æœ‰å°±ä½¿ç”¨é»˜è®¤å€¼çš„æƒ…å†µã€‚</p><h3 id="åˆ›å»ºç¬¬ä¸‰æ–¹-bean" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç¬¬ä¸‰æ–¹-bean" aria-hidden="true">#</a> åˆ›å»ºç¬¬ä¸‰æ–¹ Bean</h3><p>å¦‚æœä¸€ä¸ª Bean ä¸åœ¨æˆ‘ä»¬è‡ªå·±çš„ package ç®¡ç†ä¹‹å†…ï¼Œä¾‹å¦‚ <code>ZoneId</code>ï¼Œå¦‚ä½•åˆ›å»ºå®ƒï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æˆ‘ä»¬è‡ªå·±åœ¨ <code>@Configuration</code> ç±»ä¸­ç¼–å†™ä¸€ä¸ª Java æ–¹æ³•åˆ›å»ºå¹¶è¿”å›å®ƒï¼Œæ³¨æ„ç»™æ–¹æ³•æ ‡è®°ä¸€ä¸ª <code>@Bean</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ª Bean:</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring å¯¹æ ‡è®°ä¸º <code>@Bean</code> çš„æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡ï¼Œå› æ­¤è¿”å›çš„ Bean ä»ç„¶æ˜¯å•ä¾‹ã€‚</p><h3 id="åˆå§‹åŒ–å’Œé”€æ¯" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–å’Œé”€æ¯" aria-hidden="true">#</a> åˆå§‹åŒ–å’Œé”€æ¯</h3><p>æœ‰äº›æ—¶å€™ï¼Œä¸€ä¸ª Bean åœ¨æ³¨å…¥å¿…è¦çš„ä¾èµ–åï¼Œéœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼ˆç›‘å¬æ¶ˆæ¯ç­‰ï¼‰ã€‚åœ¨å®¹å™¨å…³é—­æ—¶ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦æ¸…ç†èµ„æºï¼ˆå…³é—­è¿æ¥æ± ç­‰ï¼‰ã€‚æˆ‘ä»¬é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ª <code>init()</code> æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå®šä¹‰ä¸€ä¸ª <code>shutdown()</code> æ–¹æ³•è¿›è¡Œæ¸…ç†ï¼Œç„¶åï¼Œå¼•å…¥ JSR-250 å®šä¹‰çš„ Annotationï¼š</p><ul><li>jakarta.annotation:jakarta.annotation-api:2.1.1</li></ul><p>åœ¨ Bean çš„åˆå§‹åŒ–å’Œæ¸…ç†æ–¹æ³•ä¸Šæ ‡è®° <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> zoneId <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Init mail service with zoneId =&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PreDestroy</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Shutdown mail service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring å®¹å™¨ä¼šå¯¹ä¸Šè¿° Bean åšå¦‚ä¸‹åˆå§‹åŒ–æµç¨‹ï¼š</p><ul><li>è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»º <code>MailService</code> å®ä¾‹ï¼›</li><li>æ ¹æ® <code>@Autowired</code> è¿›è¡Œæ³¨å…¥ï¼›</li><li>è°ƒç”¨æ ‡è®°æœ‰ <code>@PostConstruct</code> çš„ <code>init()</code> æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><p>è€Œé”€æ¯æ—¶ï¼Œå®¹å™¨ä¼šé¦–å…ˆè°ƒç”¨æ ‡è®°æœ‰ <code>@PreDestroy</code> çš„ <code>shutdown()</code> æ–¹æ³•ã€‚</p><p>Spring åªæ ¹æ® Annotation æŸ¥æ‰¾ * æ— å‚æ•° * æ–¹æ³•ï¼Œå¯¹æ–¹æ³•åä¸ä½œè¦æ±‚ã€‚</p><h3 id="ä½¿ç”¨åˆ«å" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åˆ«å" aria-hidden="true">#</a> ä½¿ç”¨åˆ«å</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹ä¸€ç§ç±»å‹çš„ Beanï¼Œå®¹å™¨åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸€ç§ç±»å‹çš„ Bean åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼ŒåŒæ—¶è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œå°±å¿…é¡»åˆ›å»ºå¤šä¸ª <code>DataSource</code> å®ä¾‹ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ <code>@Configuration</code> ç±»ä¸­åˆ›å»ºäº†å¤šä¸ªåŒç±»å‹çš„ Beanï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfUTC8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;UTC+08:00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring ä¼šæŠ¥ <code>NoUniqueBeanDefinitionException</code> å¼‚å¸¸ï¼Œæ„æ€æ˜¯å‡ºç°äº†é‡å¤çš„ Bean å®šä¹‰ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ç»™æ¯ä¸ª Bean æ·»åŠ ä¸åŒçš„åå­—ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;utc8&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfUTC8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;UTC+08:00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥ç”¨ <code>@Bean(&quot;name&quot;)</code> æŒ‡å®šåˆ«åï¼Œä¹Ÿå¯ä»¥ç”¨ <code>@Bean</code>+<code>@Qualifier(&quot;name&quot;)</code> æŒ‡å®šåˆ«åã€‚</p><p>å­˜åœ¨å¤šä¸ªåŒç±»å‹çš„ Bean æ—¶ï¼Œæ³¨å…¥ <code>ZoneId</code> åˆä¼šæŠ¥é”™ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>NoUniqueBeanDefinitionException: No qualifying bean of <span class="token builtin class-name">type</span> <span class="token string">&#39;java.time.ZoneId&#39;</span> available: expected single matching bean but found <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ„æ€æ˜¯æœŸå¾…æ‰¾åˆ°å”¯ä¸€çš„ <code>ZoneId</code> ç±»å‹ Beanï¼Œä½†æ˜¯æ‰¾åˆ°ä¸¤ã€‚å› æ­¤ï¼Œæ³¨å…¥æ—¶ï¼Œè¦æŒ‡å®š Bean çš„åç§°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šæ³¨å…¥åç§°ä¸º &quot;z&quot; çš„ ZoneId</span>
	<span class="token class-name">ZoneId</span> zoneId <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯æŠŠå…¶ä¸­æŸä¸ª Bean æŒ‡å®šä¸º <code>@Primary</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span> <span class="token comment">// æŒ‡å®šä¸ºä¸»è¦ Bean</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;utc8&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneOfUTC8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;UTC+08:00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œåœ¨æ³¨å…¥æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å‡º Bean çš„åå­—ï¼ŒSpring ä¼šæ³¨å…¥æ ‡è®°æœ‰ <code>@Primary</code> çš„ Beanã€‚è¿™ç§æ–¹å¼ä¹Ÿå¾ˆå¸¸ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸»ä»ä¸¤ä¸ªæ•°æ®æºï¼Œé€šå¸¸å°†ä¸»æ•°æ®æºå®šä¹‰ä¸º <code>@Primary</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span>
    <span class="token class-name">DataSource</span> <span class="token function">createMasterDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;slave&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">DataSource</span> <span class="token function">createSlaveDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä»– Bean é»˜è®¤æ³¨å…¥çš„å°±æ˜¯ä¸»æ•°æ®æºã€‚å¦‚æœè¦æ³¨å…¥ä»æ•°æ®æºï¼Œé‚£ä¹ˆåªéœ€è¦æŒ‡å®šåç§°å³å¯ã€‚</p><h3 id="ä½¿ç”¨-factorybean" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-factorybean" aria-hidden="true">#</a> ä½¿ç”¨ FactoryBean</h3>`,169),S={href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1281319170474017",target:"_blank",rel:"noopener noreferrer"},y=o(`<p>ç”¨å·¥å‚æ¨¡å¼åˆ›å»º Bean éœ€è¦å®ç° <code>FactoryBean</code> æ¥å£ã€‚æˆ‘ä»¬è§‚å¯Ÿä¸‹é¢çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZoneIdFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ZoneId</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> zone <span class="token operator">=</span> <span class="token string">&quot;Z&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ZoneId</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸€ä¸ª Bean å®ç°äº† <code>FactoryBean</code> æ¥å£åï¼ŒSpring ä¼šå…ˆå®ä¾‹åŒ–è¿™ä¸ªå·¥å‚ï¼Œç„¶åè°ƒç”¨ <code>getObject()</code> åˆ›å»ºçœŸæ­£çš„ Beanã€‚<code>getObjectType()</code> å¯ä»¥æŒ‡å®šåˆ›å»ºçš„ Bean çš„ç±»å‹ï¼Œå› ä¸ºæŒ‡å®šç±»å‹ä¸ä¸€å®šä¸å®é™…ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ª <code>FactoryBean</code>ï¼Œè¦æ³¨æ„ Spring åˆ›å»ºçš„ Bean å®é™…ä¸Šæ˜¯è¿™ä¸ª <code>FactoryBean</code> çš„ <code>getObject()</code> æ–¹æ³•è¿”å›çš„ Beanã€‚ä¸ºäº†å’Œæ™®é€š Bean åŒºåˆ†ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä»¥ <code>XxxFactoryBean</code> å‘½åã€‚</p><p>ç”±äºå¯ä»¥ç”¨ <code>@Bean</code> æ–¹æ³•åˆ›å»ºç¬¬ä¸‰æ–¹ Beanï¼Œæœ¬è´¨ä¸Š <code>@Bean</code> æ–¹æ³•å°±æ˜¯å·¥å‚æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œ<code>FactoryBean</code> å·²ç»ç”¨å¾—è¶Šæ¥è¶Šå°‘äº†ã€‚</p><h3 id="ç»ƒä¹ -2" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -2" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>å®šåˆ¶ Bean</p><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2" aria-hidden="true">#</a> å°ç»“</h3><p>Spring é»˜è®¤ä½¿ç”¨ Singleton åˆ›å»º Beanï¼Œä¹Ÿå¯æŒ‡å®š Scope ä¸º Prototypeï¼›</p><p>å¯å°†ç›¸åŒç±»å‹çš„ Bean æ³¨å…¥ <code>List</code> æˆ–æ•°ç»„ï¼›</p><p>å¯ç”¨ <code>@Autowired(required=false)</code> å…è®¸å¯é€‰æ³¨å…¥ï¼›</p><p>å¯ç”¨å¸¦ <code>@Bean</code> æ ‡æ³¨çš„æ–¹æ³•åˆ›å»º Beanï¼›</p><p>å¯ä½¿ç”¨ <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code> å¯¹ Bean è¿›è¡Œåˆå§‹åŒ–å’Œæ¸…ç†ï¼›</p><p>ç›¸åŒç±»å‹çš„ Bean åªèƒ½æœ‰ä¸€ä¸ªæŒ‡å®šä¸º <code>@Primary</code>ï¼Œå…¶ä»–å¿…é¡»ç”¨ <code>@Qualifier(&quot;beanName&quot;)</code> æŒ‡å®šåˆ«åï¼›</p><p>æ³¨å…¥æ—¶ï¼Œå¯é€šè¿‡åˆ«å <code>@Qualifier(&quot;beanName&quot;)</code> æŒ‡å®šæŸä¸ª Beanï¼›</p><p>å¯ä»¥å®šä¹‰ <code>FactoryBean</code> æ¥ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»º Beanã€‚</p><h2 id="ğŸ€-ä½¿ç”¨-resource" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨-resource" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨ Resource</h2><p>åœ¨ Java ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ç­‰ã€‚ä½¿ç”¨ Spring å®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ â€œæ–‡ä»¶â€ æ³¨å…¥è¿›æ¥ï¼Œæ–¹ä¾¿ç¨‹åºè¯»å–ã€‚</p><p>ä¾‹å¦‚ï¼ŒAppService éœ€è¦è¯»å– <code>logo.txt</code> è¿™ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å†™å¾ˆå¤šç¹ççš„ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å®šä½æ–‡ä»¶ï¼Œæ‰“å¼€ InputStreamã€‚</p><p>Spring æä¾›äº†ä¸€ä¸ª <code>org.springframework.core.io.Resource</code>ï¼ˆæ³¨æ„ä¸æ˜¯ <code>jarkata.annotation.Resource</code> æˆ– <code>javax.annotation.Resource</code>ï¼‰ï¼Œå®ƒå¯ä»¥åƒ <code>String</code>ã€<code>int</code> ä¸€æ ·ä½¿ç”¨ <code>@Value</code> æ³¨å…¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/logo.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> logo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>logo <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨å…¥ <code>Resource</code> æœ€å¸¸ç”¨çš„æ–¹å¼æ˜¯é€šè¿‡ classpathï¼Œå³ç±»ä¼¼ <code>classpath:/logo.txt</code> è¡¨ç¤ºåœ¨ classpath ä¸­æœç´¢ <code>logo.txt</code> æ–‡ä»¶ï¼Œç„¶åï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ <code>Resource.getInputStream()</code> å°±å¯ä»¥è·å–åˆ°è¾“å…¥æµï¼Œé¿å…äº†è‡ªå·±æœç´¢æ–‡ä»¶çš„ä»£ç ã€‚</p><p>ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;file:/path/to/logo.txt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†ä½¿ç”¨ classpath æ˜¯æœ€ç®€å•çš„æ–¹å¼ã€‚ä¸Šè¿°å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="`+k+`" alt="image-20231221142031735" tabindex="0" loading="lazy"><figcaption>image-20231221142031735</figcaption></figure><p>ä½¿ç”¨ Maven çš„æ ‡å‡†ç›®å½•ç»“æ„ï¼Œæ‰€æœ‰èµ„æºæ–‡ä»¶æ”¾å…¥ <code>src/main/resources</code> å³å¯ã€‚</p><h3 id="ç»ƒä¹ -3" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -3" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>ä½¿ç”¨ Spring çš„ <code>Resource</code> æ³¨å…¥ <code>app.properties</code> æ–‡ä»¶ï¼Œç„¶åè¯»å–è¯¥é…ç½®æ–‡ä»¶ã€‚</p><h3 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3" aria-hidden="true">#</a> å°ç»“</h3><p>Spring æä¾›äº† Resource ç±»ä¾¿äºæ³¨å…¥èµ„æºæ–‡ä»¶ã€‚</p><p>æœ€å¸¸ç”¨çš„æ³¨å…¥æ˜¯é€šè¿‡ classpath ä»¥ <code>classpath:/path/to/file</code> çš„å½¢å¼æ³¨å…¥ã€‚</p><h2 id="ğŸ€-æ³¨å…¥é…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ€-æ³¨å…¥é…ç½®" aria-hidden="true">#</a> ğŸ€ æ³¨å…¥é…ç½®</h2><p>åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œç»å¸¸éœ€è¦è¯»å–é…ç½®æ–‡ä»¶ã€‚æœ€å¸¸ç”¨çš„é…ç½®æ–¹æ³•æ˜¯ä»¥ <code>key=value</code> çš„å½¢å¼å†™åœ¨ <code>.properties</code> æ–‡ä»¶ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>MailService</code> æ ¹æ®é…ç½®çš„ <code>app.zone=Asia/Shanghai</code> æ¥å†³å®šä½¿ç”¨å“ªä¸ªæ—¶åŒºã€‚è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šä¸€èŠ‚è®²åˆ°çš„ <code>Resource</code> æ¥è¯»å–ä½äº classpath ä¸‹çš„ä¸€ä¸ª <code>app.properties</code> æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä»ç„¶æ¯”è¾ƒç¹çã€‚</p><p>Spring å®¹å™¨è¿˜æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„ <code>@PropertySource</code> æ¥è‡ªåŠ¨è¯»å–é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ <code>@Configuration</code> é…ç½®ç±»ä¸Šå†æ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;app.properties&quot;</span><span class="token punctuation">)</span> <span class="token comment">// è¡¨ç¤ºè¯»å– classpath çš„ app.properties</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${app.zone:Z}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> zoneId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring å®¹å™¨çœ‹åˆ° <code>@PropertySource(&quot;app.properties&quot;)</code> æ³¨è§£åï¼Œè‡ªåŠ¨è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>@Value</code> æ­£å¸¸æ³¨å…¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${app.zone:Z}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> zoneId<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„æ³¨å…¥çš„å­—ç¬¦ä¸²è¯­æ³•ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li><code>&quot;\${app.zone}&quot;</code> è¡¨ç¤ºè¯»å– key ä¸º <code>app.zone</code> çš„ valueï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œå¯åŠ¨å°†æŠ¥é”™ï¼›</li><li><code>&quot;\${app.zone:Z}&quot;</code> è¡¨ç¤ºè¯»å– key ä¸º <code>app.zone</code> çš„ valueï¼Œä½†å¦‚æœ key ä¸å­˜åœ¨ï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼ <code>Z</code>ã€‚</li></ul><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ® <code>app.zone</code> çš„é…ç½®æ¥åˆ›å»º <code>ZoneId</code>ã€‚</p><p>è¿˜å¯ä»¥æŠŠæ³¨å…¥çš„æ³¨è§£å†™åˆ°æ–¹æ³•å‚æ•°ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${app.zone:Z}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> zoneId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œå…ˆä½¿ç”¨ <code>@PropertySource</code> è¯»å–é…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code>@Value</code> ä»¥ <code>\${key:defaultValue}</code> çš„å½¢å¼æ³¨å…¥ï¼Œå¯ä»¥æå¤§åœ°ç®€åŒ–è¯»å–é…ç½®çš„éº»çƒ¦ã€‚</p><p>å¦ä¸€ç§æ³¨å…¥é…ç½®çš„æ–¹å¼æ˜¯å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ JavaBean æŒæœ‰æ‰€æœ‰çš„é…ç½®ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ª <code>SmtpConfig</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmtpConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.host}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${smtp.port:25}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> host<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨éœ€è¦è¯»å–çš„åœ°æ–¹ï¼Œä½¿ç”¨ <code>#{smtpConfig.host}</code> æ³¨å…¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{smtpConfig.host}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> smtpHost<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{smtpConfig.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> smtpPort<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è§‚å¯Ÿ <code>#{}</code> è¿™ç§æ³¨å…¥è¯­æ³•ï¼Œå®ƒå’Œ <code>\${key}</code> ä¸åŒçš„æ˜¯ï¼Œ<code>#{}</code> è¡¨ç¤ºä» JavaBean è¯»å–å±æ€§ã€‚<code>&quot;#{smtpConfig.host}&quot;</code> çš„æ„æ€æ˜¯ï¼Œä»åç§°ä¸º <code>smtpConfig</code> çš„ Bean è¯»å– <code>host</code> å±æ€§ï¼Œå³è°ƒç”¨ <code>getHost()</code> æ–¹æ³•ã€‚ä¸€ä¸ª Class åä¸º <code>SmtpConfig</code> çš„ Beanï¼Œå®ƒåœ¨ Spring å®¹å™¨ä¸­çš„é»˜è®¤åç§°å°±æ˜¯ <code>smtpConfig</code>ï¼Œé™¤éç”¨ <code>@Qualifier</code> æŒ‡å®šäº†åç§°ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ JavaBean æŒæœ‰æ‰€æœ‰å±æ€§ï¼Œç„¶ååœ¨å…¶ä»– Bean ä¸­ä»¥ <code>#{bean.property}</code> æ³¨å…¥çš„å¥½å¤„æ˜¯ï¼Œå¤šä¸ª Bean éƒ½å¯ä»¥å¼•ç”¨åŒä¸€ä¸ª Bean çš„æŸä¸ªå±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>SmtpConfig</code> å†³å®šä»æ•°æ®åº“ä¸­è¯»å–ç›¸å…³é…ç½®é¡¹ï¼Œé‚£ä¹ˆ <code>MailService</code> æ³¨å…¥çš„ <code>@Value(&quot;#{smtpConfig.host}&quot;)</code> ä»ç„¶å¯ä»¥ä¸ä¿®æ”¹æ­£å¸¸è¿è¡Œã€‚</p><h3 id="ç»ƒä¹ -4" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -4" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>æ³¨å…¥ SMTP é…ç½®</p><h3 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4" aria-hidden="true">#</a> å°ç»“</h3><p>Spring å®¹å™¨å¯ä»¥é€šè¿‡ <code>@PropertySource</code> è‡ªåŠ¨è¯»å–é…ç½®ï¼Œå¹¶ä»¥ <code>@Value(&quot;\${key}&quot;)</code> çš„å½¢å¼æ³¨å…¥ï¼›</p><p>å¯ä»¥é€šè¿‡ <code>\${key:defaultValue}</code> æŒ‡å®šé»˜è®¤å€¼ï¼›</p><p>ä»¥ <code>#{bean.property}</code> å½¢å¼æ³¨å…¥æ—¶ï¼ŒSpring å®¹å™¨è‡ªåŠ¨æŠŠæŒ‡å®š Bean çš„æŒ‡å®šå±æ€§å€¼æ³¨å…¥ã€‚</p><h2 id="ğŸ€-ä½¿ç”¨æ¡ä»¶è£…é…" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä½¿ç”¨æ¡ä»¶è£…é…" aria-hidden="true">#</a> ğŸ€ ä½¿ç”¨æ¡ä»¶è£…é…</h2><p>å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¼€å‘ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å†…å­˜æ•°æ®åº“ä»¥ä¾¿å¿«é€Ÿå¯åŠ¨ã€‚è€Œè¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ MySQL æ•°æ®åº“ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è‡ªèº«çš„ç¯å¢ƒåšä¸€äº›é€‚é…ï¼Œæ— ç–‘ä¼šæ›´åŠ çµæ´»ã€‚</p><p>Spring ä¸ºåº”ç”¨ç¨‹åºå‡†å¤‡äº† Profile è¿™ä¸€æ¦‚å¿µï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒçš„ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ†åˆ«å®šä¹‰å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§è¿™ 3 ä¸ªç¯å¢ƒï¼š</p><ul><li>native</li><li>test</li><li>production</li></ul><p>åˆ›å»ºæŸä¸ª Bean æ—¶ï¼ŒSpring å®¹å™¨å¯ä»¥æ ¹æ®æ³¨è§£ <code>@Profile</code> æ¥å†³å®šæ˜¯å¦åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;!test&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ZoneId</span> <span class="token function">createZoneIdForTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;America/New_York&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœå½“å‰çš„ Profile è®¾ç½®ä¸º <code>test</code>ï¼Œåˆ™ Spring å®¹å™¨ä¼šè°ƒç”¨ <code>createZoneIdForTest()</code> åˆ›å»º <code>ZoneId</code>ï¼Œå¦åˆ™ï¼Œè°ƒç”¨ <code>createZoneId()</code> åˆ›å»º <code>ZoneId</code>ã€‚æ³¨æ„åˆ° <code>@Profile(&quot;!test&quot;)</code> è¡¨ç¤ºé test ç¯å¢ƒã€‚</p><p>åœ¨è¿è¡Œç¨‹åºæ—¶ï¼ŒåŠ ä¸Š JVM å‚æ•° <code>-Dspring.profiles.active=test</code> å°±å¯ä»¥æŒ‡å®šä»¥ <code>test</code> ç¯å¢ƒå¯åŠ¨ã€‚</p><p>å®é™…ä¸Šï¼ŒSpring å…è®¸æŒ‡å®šå¤šä¸ª Profileï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-Dspring.profiles.active=test,master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯ä»¥è¡¨ç¤º <code>test</code> ç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ <code>master</code> åˆ†æ”¯ä»£ç ã€‚</p><p>è¦æ»¡è¶³å¤šä¸ª Profile æ¡ä»¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// æ»¡è¶³ test æˆ– master</span>
<span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨-conditional" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-conditional" aria-hidden="true">#</a> ä½¿ç”¨ Conditional</h3><p>é™¤äº†æ ¹æ® <code>@Profile</code> æ¡ä»¶æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ª Bean å¤–ï¼ŒSpring è¿˜å¯ä»¥æ ¹æ® <code>@Conditional</code> å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ª Beanã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹ <code>SmtpMailService</code> æ·»åŠ å¦‚ä¸‹æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">OnSmtpEnvCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmtpMailService</span> <span class="token keyword">implements</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœæ»¡è¶³ <code>OnSmtpEnvCondition</code> çš„æ¡ä»¶ï¼Œæ‰ä¼šåˆ›å»º <code>SmtpMailService</code> è¿™ä¸ª Beanã€‚<code>OnSmtpEnvCondition</code> çš„æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnSmtpEnvCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;smtp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› æ­¤ï¼Œ<code>OnSmtpEnvCondition</code> çš„æ¡ä»¶æ˜¯å­˜åœ¨ç¯å¢ƒå˜é‡ <code>smtp</code>ï¼Œå€¼ä¸º <code>true</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥æ§åˆ¶æ˜¯å¦åˆ›å»º <code>SmtpMailService</code>ã€‚</p><p>Spring åªæä¾›äº† <code>@Conditional</code> æ³¨è§£ï¼Œå…·ä½“åˆ¤æ–­é€»è¾‘è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ã€‚Spring Boot æä¾›äº†æ›´å¤šä½¿ç”¨èµ·æ¥æ›´ç®€å•çš„æ¡ä»¶æ³¨è§£ï¼Œä¾‹å¦‚ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ <code>app.smtp=true</code>ï¼Œåˆ™åˆ›å»º <code>MailService</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;app.smtp&quot;</span><span class="token punctuation">,</span> havingValue<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœå½“å‰ classpath ä¸­å­˜åœ¨ç±» <code>javax.mail.Transport</code>ï¼Œåˆ™åˆ›å»º <code>MailService</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;javax.mail.Transport&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åç»­æˆ‘ä»¬ä¼šä»‹ç» Spring Boot çš„æ¡ä»¶è£…é…ã€‚æˆ‘ä»¬ä»¥æ–‡ä»¶å­˜å‚¨ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¿å­˜ç”¨æˆ·ä¸Šä¼ çš„å¤´åƒï¼Œå¹¶è¿”å›å­˜å‚¨è·¯å¾„ï¼Œåœ¨æœ¬åœ°å¼€å‘è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å­˜å‚¨åˆ°æ–‡ä»¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;app.storage&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploader</span> <span class="token keyword">implements</span> <span class="token class-name">Uploader</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠæ–‡ä»¶å­˜å‚¨åˆ°ç±»ä¼¼ AWS S3 ä¸Šï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;app.storage&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;s3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">S3Uploader</span> <span class="token keyword">implements</span> <span class="token class-name">Uploader</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä»–éœ€è¦å­˜å‚¨çš„æœåŠ¡åˆ™æ³¨å…¥ <code>Uploader</code>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserImageService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Uploader</span> uploader<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“åº”ç”¨ç¨‹åºæ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å­˜åœ¨ <code>app.storage=s3</code> æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ <code>S3Uploader</code>ï¼Œå¦‚æœå­˜åœ¨é…ç½® <code>app.storage=file</code>ï¼Œæˆ–è€…é…ç½® <code>app.storage</code> ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ <code>FileUploader</code>ã€‚</p><p>å¯è§ï¼Œä½¿ç”¨æ¡ä»¶æ³¨è§£ï¼Œèƒ½æ›´çµæ´»åœ°è£…é… Beanã€‚</p><h3 id="ç»ƒä¹ -5" tabindex="-1"><a class="header-anchor" href="#ç»ƒä¹ -5" aria-hidden="true">#</a> ç»ƒä¹ </h3><p>ä½¿ç”¨ @Profile è¿›è¡Œæ¡ä»¶è£…é…</p><h3 id="å°ç»“-5" tabindex="-1"><a class="header-anchor" href="#å°ç»“-5" aria-hidden="true">#</a> å°ç»“</h3><p>Spring å…è®¸é€šè¿‡ <code>@Profile</code> é…ç½®ä¸åŒçš„ Beanï¼›</p><p>Spring è¿˜æä¾›äº† <code>@Conditional</code> æ¥è¿›è¡Œæ¡ä»¶è£…é…ï¼ŒSpring Boot åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥æä¾›äº†åŸºäºé…ç½®ã€Classã€Bean ç­‰æ¡ä»¶è¿›è¡Œè£…é…ã€‚</p>`,94);function f(h,q){const e=p("router-link"),c=p("ExternalLinkIcon");return i(),u("div",null,[n("details",m,[b,n("nav",g,[n("ul",null,[n("li",null,[s(e,{to:"#ğŸ€-ioc-åŸç†"},{default:t(()=>[a("ğŸ€ IoC åŸç†")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#ä¾èµ–æ³¨å…¥æ–¹å¼"},{default:t(()=>[a("ä¾èµ–æ³¨å…¥æ–¹å¼")]),_:1})]),n("li",null,[s(e,{to:"#æ— ä¾µå…¥å®¹å™¨"},{default:t(()=>[a("æ— ä¾µå…¥å®¹å™¨")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-è£…é…-bean"},{default:t(()=>[a("ğŸ€ è£…é… Bean")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#applicationcontext"},{default:t(()=>[a("ApplicationContext")]),_:1})]),n("li",null,[s(e,{to:"#ç»ƒä¹ "},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“"},{default:t(()=>[a("å°ç»“")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-ä½¿ç”¨-annotation-é…ç½®"},{default:t(()=>[a("ğŸ€ ä½¿ç”¨ Annotation é…ç½®")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#æ€è€ƒ"},{default:t(()=>[a("æ€è€ƒ")]),_:1})]),n("li",null,[s(e,{to:"#ç»ƒä¹ -1"},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“-1"},{default:t(()=>[a("å°ç»“")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-å®šåˆ¶-bean"},{default:t(()=>[a("ğŸ€ å®šåˆ¶ Bean")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#scope"},{default:t(()=>[a("Scope")]),_:1})]),n("li",null,[s(e,{to:"#æ³¨å…¥-list"},{default:t(()=>[a("æ³¨å…¥ List")]),_:1})]),n("li",null,[s(e,{to:"#å¯é€‰æ³¨å…¥"},{default:t(()=>[a("å¯é€‰æ³¨å…¥")]),_:1})]),n("li",null,[s(e,{to:"#åˆ›å»ºç¬¬ä¸‰æ–¹-bean"},{default:t(()=>[a("åˆ›å»ºç¬¬ä¸‰æ–¹ Bean")]),_:1})]),n("li",null,[s(e,{to:"#åˆå§‹åŒ–å’Œé”€æ¯"},{default:t(()=>[a("åˆå§‹åŒ–å’Œé”€æ¯")]),_:1})]),n("li",null,[s(e,{to:"#ä½¿ç”¨åˆ«å"},{default:t(()=>[a("ä½¿ç”¨åˆ«å")]),_:1})]),n("li",null,[s(e,{to:"#ä½¿ç”¨-factorybean"},{default:t(()=>[a("ä½¿ç”¨ FactoryBean")]),_:1})]),n("li",null,[s(e,{to:"#ç»ƒä¹ -2"},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“-2"},{default:t(()=>[a("å°ç»“")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-ä½¿ç”¨-resource"},{default:t(()=>[a("ğŸ€ ä½¿ç”¨ Resource")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#ç»ƒä¹ -3"},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“-3"},{default:t(()=>[a("å°ç»“")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-æ³¨å…¥é…ç½®"},{default:t(()=>[a("ğŸ€ æ³¨å…¥é…ç½®")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#ç»ƒä¹ -4"},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“-4"},{default:t(()=>[a("å°ç»“")]),_:1})])])]),n("li",null,[s(e,{to:"#ğŸ€-ä½¿ç”¨æ¡ä»¶è£…é…"},{default:t(()=>[a("ğŸ€ ä½¿ç”¨æ¡ä»¶è£…é…")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#ä½¿ç”¨-conditional"},{default:t(()=>[a("ä½¿ç”¨ Conditional")]),_:1})]),n("li",null,[s(e,{to:"#ç»ƒä¹ -5"},{default:t(()=>[a("ç»ƒä¹ ")]),_:1})]),n("li",null,[s(e,{to:"#å°ç»“-5"},{default:t(()=>[a("å°ç»“")]),_:1})])])])])])]),w,n("p",null,[a("æˆ‘ä»¬åœ¨è®¾è®¡æ¨¡å¼çš„ "),n("a",S,[a("å·¥å‚æ–¹æ³•"),s(c)]),a(" ä¸­è®²åˆ°ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå¯¹è±¡ã€‚Spring ä¹Ÿæä¾›äº†å·¥å‚æ¨¡å¼ï¼Œå…è®¸å®šä¹‰ä¸€ä¸ªå·¥å‚ï¼Œç„¶åç”±å·¥å‚åˆ›å»ºçœŸæ­£çš„ Beanã€‚")]),y])}const B=l(v,[["render",f],["__file","1.html.vue"]]);export{B as default};
