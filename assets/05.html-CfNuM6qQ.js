import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as c,c as o,a as p,e as n,b as l,w as i,d as s}from"./app-CvlAI_tu.js";const u="/VueDoc/assets/image-20200316175339460-Dafcq2OR.png",r="/VueDoc/assets/image-20200317094948523-Bf2JjPw4.png",d="/VueDoc/assets/image-20200317115128966-C7yxuLu-.png",m="/VueDoc/assets/image-20200317132323274-Ea4f73Ko.png",v={},k=s('<h1 id="selinux-åˆæ¢" tabindex="-1"><a class="header-anchor" href="#selinux-åˆæ¢" aria-hidden="true">#</a> SELinux åˆæ¢</h1><p>CentOS 5.x ä¹‹åï¼ŒSELinux å·²ç»æ˜¯ä¸ªéå¸¸å®Œå¤‡çš„æ ¸å¿ƒæ¨¡å—äº†ï¼Œå°¤å…¶æ˜¯ CentOS æä¾›äº†å¾ˆå¤šç®¡ç† SELinux çš„æŒ‡ä»¤ä¸æœºåˆ¶ï¼Œå› æ­¤åœ¨æ•´ç†æ¶æ„ä¸Šé¢æ˜¯å•çº¯ä¸”å®¹æ˜“æ“ä½œç®¡ç†çš„ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰è‡ªè¡Œå¼€å‘ç½‘ç»œæœåŠ¡è½¯ä»¶ä»¥åŠä½¿ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹ååŠ›è½¯ä»¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯å…¨éƒ¨ä½¿ç”¨ CentOS å®˜æ–¹æä¾›çš„è½¯ä»¶æ¥ä½¿ç”¨æˆ‘ä»¬æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä¸è¦å…³é—­ SELinux</p><h2 id="ğŸ€-ä»€ä¹ˆæ˜¯-selinux" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä»€ä¹ˆæ˜¯-selinux" aria-hidden="true">#</a> ğŸ€ ä»€ä¹ˆæ˜¯ SELinux</h2><p>Security Enhanced Linux çš„ç¼©å†™ SELinuxï¼Œå­—é¢æ„æ€æ˜¯å®‰å…¨å¼ºåŒ–çš„ LInuxã€‚è‡³äºå¼ºåŒ–çš„æ˜¯å“ªä¸ªéƒ¨åˆ†ï¼Ÿä¸‹é¢æ¥äº†è§£ä¸‹</p><h3 id="å½“åˆè®¾è®¡çš„ç›®æ ‡-é¿å…èµ„æºçš„è¯¯ç”¨" tabindex="-1"><a class="header-anchor" href="#å½“åˆè®¾è®¡çš„ç›®æ ‡-é¿å…èµ„æºçš„è¯¯ç”¨" aria-hidden="true">#</a> å½“åˆè®¾è®¡çš„ç›®æ ‡ï¼šé¿å…èµ„æºçš„è¯¯ç”¨</h3><p>SELinux æ˜¯ç”±ç¾å›½å›½å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰å¼€å‘çš„ï¼Œéœ€æ±‚æ¥æºäºå†…éƒ¨å‘˜å·¥èµ„æºè¯¯ç”¨å¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜ï¼›</p><p>èµ„æºè¯¯ç”¨ï¼šå°†ä¸€ä¸ª <code>/var/www/html/</code> ç›®å½•æƒé™è®¾ç½®æˆ 777ï¼Œé‚£ä¹ˆå½“å¯åŠ¨ www æœåŠ¡å™¨è½¯ä»¶ï¼Œå°±æ„å‘³ç€è¿™ä¸ªè½¯ä»¶è§¦å‘çš„è¿›ç¨‹æ‹¥æœ‰å¯¹è¯¥ç›®å½•å†™å…¥çš„æƒé™ï¼Œåªè¦é€šè¿‡è¯¥è¿›ç¨‹æœåŠ¡å™¨å¯¹ç›®å½•å¤§é‡å†™å…¥ï¼Œå°±ä¼šå¯¼è‡´ç³»ç»Ÿç¡¬ç›˜èµ„æºè¢«çˆ†ç ´</p><p>SELinux æ˜¯åœ¨è¿›è¡Œè¿›ç¨‹ã€æ–‡ä»¶ç­‰è¥¿éƒ¨æƒé™è®¾ç½®ä¾æ®çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç”±äºå¯åŠ¨ç½‘ç»œæœåŠ¡çš„ä¹Ÿæ˜¯è¿›ç¨‹ï¼Œå› æ­¤åˆšå¥½ä¹Ÿèƒ½å¤Ÿæ§åˆ¶ç½‘ç»œæœåŠ¡æ˜¯å¦èƒ½å­˜å–ç³»ç»Ÿèµ„æºçš„ä¸€é“å…³å¡</p><p>åœ¨è®²è§£ SELinux ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹ä¹‹å‰è®²åˆ°çš„ï¼šç³»ç»Ÿæ–‡ä»¶æƒé™ä¸ç”¨æˆ·ä¹‹é—´çš„å…³ç³»</p><h3 id="ä¼ ç»Ÿçš„æ–‡ä»¶æƒé™ä¸è´¦æˆ·å…³ç³»-è‡ªä¸»å¼è®¿é—®æ§åˆ¶-dac" tabindex="-1"><a class="header-anchor" href="#ä¼ ç»Ÿçš„æ–‡ä»¶æƒé™ä¸è´¦æˆ·å…³ç³»-è‡ªä¸»å¼è®¿é—®æ§åˆ¶-dac" aria-hidden="true">#</a> ä¼ ç»Ÿçš„æ–‡ä»¶æƒé™ä¸è´¦æˆ·å…³ç³»ï¼šè‡ªä¸»å¼è®¿é—®æ§åˆ¶ DAC</h3><p>ç¬¬ 13 ç« ä¸­è®²åˆ°ï¼šç³»ç»Ÿè´¦æˆ·ä¸»è¦åˆ†ä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼ˆrootï¼‰ä¸ä¸€èˆ¬ç”¨æˆ·ï¼Œä»–ä»¬èƒ½å¦ä½¿ç”¨ç³»ç»Ÿä¸Šçš„æ–‡ä»¶èµ„æºä¸ rwx æƒé™è®¾ç½®æœ‰å…³ã€‚ï¼ˆå„ç§æƒé™è®¾ç½®å¯¹ root æ— æ•ˆï¼‰ã€‚å½“æŸä¸ªè¿›ç¨‹æƒ³è¦å¯¹æ–‡ä»¶è¿›è¡Œå­˜å–æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®è¯¥è¿›ç¨‹çš„æ‹¥æœ‰è€…ã€ç¾¤ç»„ï¼Œå¹¶æ¯”å¯¹æ–‡ä»¶çš„æƒé™ï¼Œè‹¥é€šè¿‡æƒé™æ£€æŸ¥ï¼Œå°±å¯ä»¥å­˜å–è¯¥æ–‡ä»¶</p><p>è¿™ç§å­˜å–æ–‡ä»¶çš„æ–¹å¼è¢«ç§°ä¸º <strong>è‡ªä¸»å¼è®¿é—®æ§åˆ¶ Discretionary Access Controller ç®€ç§° DAC</strong>ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¾æ®è¿›ç¨‹çš„æ‹¥æœ‰è€…ä¸æ–‡ä»¶èµ„æºçš„ rwx æƒé™æ¥å†³å®šæœ‰æ— å­˜å–çš„èƒ½åŠ›ã€‚DAC æœ‰å¦‚ä¸‹å›°æ‰°ï¼š</p><ul><li>root å…·æœ‰æœ€é«˜çš„æƒé™ï¼šåªè¦å–å¾—å±äº root çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå°±å¾ˆå±é™©</li><li>ä½¿ç”¨è€…å¯ä»¥å–å¾—è¿›ç¨‹æ¥å˜æ›´æ–‡ä»¶èµ„æºçš„è®¿é—®æƒé™ï¼šå¦‚æœå°†æŸä¸ªç›®å½•æƒé™ä¸å°å¿ƒè®¾ç½®ä¸º 777ï¼Œç”±äºå¯¹ä»»ä½•äººçš„æƒé™ä¼šå˜æˆ rwxï¼Œå› æ­¤è¯¥ç›®å½•å°±ä¼šè¢«ä»»ä½•äººæ‰€ä»»æ„å­˜å–</li></ul><h3 id="ä»¥æ”¿ç­–è§„åˆ™è§„å®šç‰¹å®šè¿›ç¨‹è¯»å–ç‰¹å®šæ–‡ä»¶-å§”ä»»å¼è®¿é—®æ§åˆ¶-mac" tabindex="-1"><a class="header-anchor" href="#ä»¥æ”¿ç­–è§„åˆ™è§„å®šç‰¹å®šè¿›ç¨‹è¯»å–ç‰¹å®šæ–‡ä»¶-å§”ä»»å¼è®¿é—®æ§åˆ¶-mac" aria-hidden="true">#</a> ä»¥æ”¿ç­–è§„åˆ™è§„å®šç‰¹å®šè¿›ç¨‹è¯»å–ç‰¹å®šæ–‡ä»¶ï¼šå§”ä»»å¼è®¿é—®æ§åˆ¶ MAC</h3><p>ä¸ºäº†é¿å… DAC çš„å›°æ‰°ï¼ŒSELinux å¯¼å…¥äº†å§”ä»»å¼è®¿é—®æ§åˆ¶ Mandatory Access Control ç®€ç§° MAC</p><p>MAC å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„è¿›ç¨‹ä¸ç‰¹å®šçš„æ–‡ä»¶èµ„æºæ¥è¿›è¡Œæƒé™çš„æ§åˆ¶ã€‚å³ä½¿ä½ æ˜¯ rootï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ä¸åŒçš„è¿›ç¨‹æ—¶ï¼Œä½ æ‰€èƒ½å–å¾—çš„æƒé™å¹¶ä¸ä¸€å®šæ˜¯ rootï¼Œè€Œéœ€è¦çœ‹å½“æ—¶è¯¥è¿›ç¨‹çš„è®¾ç½®ã€‚å¦‚æ­¤ä¸€æ¥é’ˆå¯¹æ§åˆ¶çš„ã€Œä¸»ä½“ã€å˜æˆäº†ã€Œè¿›ç¨‹ã€è€Œä¸æ˜¯ä½¿ç”¨è€…ï¼Œä½†æ˜¯çœŸä¸ªç³»ç»Ÿè¿›ç¨‹å¾ˆå¤šã€æ–‡ä»¶ä¹Ÿå¾ˆå¤šï¼Œä¸€é¡¹ä¸€é¡¹æ§åˆ¶å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥ SELinux ä¹Ÿæä¾›ä¸€äº›é¢„è®¾çš„æ”¿ç­– <strong>Policy</strong> ï¼Œå¹¶åœ¨è¯¥æ”¿ç­–å†…æä¾›å¤šä¸ªè§„åˆ™ <strong>rule</strong>ï¼Œè®©ä½ å¯ä»¥é€‰æ‹©æ˜¯å¦å¯ç”¨è¯¥æ§åˆ¶è§„åˆ™</p><p>åœ¨è¯¥ç§æ¨¡å¼ä¸‹ï¼Œè¿›ç¨‹èƒ½å¤Ÿæ´»åŠ¨çš„ç©ºå˜å°äº†ã€‚æ¯”å¦‚ï¼šwww æœåŠ¡å™¨è½¯ä»¶è¾¾æˆè¿›ç¨‹ä¸º httpd è¿™ä¸ªç¨‹åºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ httpd ä»…èƒ½åœ¨ <code>/var/www</code> ç›®å½•ä¸‹å­˜å–æ–‡ä»¶ï¼Œå¦‚æœ httpd è¿›ç¨‹è¦å»å…¶ä»–ç›®å½•å­˜å‚¨æ•°æ®æ—¶ï¼Œé™¤äº†è§„åˆ™è®¾ç½®è¦å¼€æ”¾å¤–ï¼Œç›®æ ‡ç›®å½•ä¹Ÿè¦è®¾ç½®æˆ httpd å¯è¯»å–çš„æ¨¡å¼ type æ‰è¡Œï¼Œé™åˆ¶éå¸¸å¤šï¼Œæ‰€ä»¥ï¼Œå³ä½¿ httpd è¿™ä¸ªè¿›ç¨‹è¢«é»‘å®¢å–å¾—äº†æ§åˆ¶æƒé™ï¼Œå®ƒä¹Ÿæ— æƒé™æµè§ˆå…¶ä»–çš„ç›®å½•æ–‡ä»¶</p><p>ç®€å•è¯´ï¼Œé’ˆå¯¹ Apache è¿™ä¸ª www ç½‘ç»œæœåŠ¡ä½¿ç”¨ DAC æˆ– MAC çš„ç»“æœæ¥è¯´ï¼Œä¸¤è€…çš„å…³ç³»å¯ç”¨ä¸‹å›¾æ¥è¯´æ˜</p><figure><img src="'+u+'" alt="image-20200316175339460" tabindex="0" loading="lazy"><figcaption>image-20200316175339460</figcaption></figure><p>åœ†ç¯è¡¨ç¤ºç”»åœ°ä¸ºç‰¢ï¼ŒDAC æ¨¡å¼ä¸‹ï¼Œç”±äºæ˜¯ rootï¼Œç‰¢æˆ¿å¯¹ root æ— æ•ˆã€‚åœ¨ MAC ä¸‹ï¼Œç‰¢æˆ¿å°±ç”Ÿæ•ˆäº†</p><h2 id="ğŸ€-selinux-çš„è¿ä½œæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ğŸ€-selinux-çš„è¿ä½œæ¨¡å¼" aria-hidden="true">#</a> ğŸ€ SELinux çš„è¿ä½œæ¨¡å¼</h2><p><strong>å¼ºè°ƒ</strong>ï¼šSELinux æ˜¯é€šè¿‡ MAC æ–¹å¼æ¥ç®¡æ§ <strong>è¿›ç¨‹</strong>ï¼Œè¿›ç¨‹æ˜¯ä¸»ä½“ï¼Œè€Œç›®æ ‡åˆ™æ˜¯è¯¥è¿›ç¨‹èƒ½å¦è¯»å–çš„æ–‡ä»¶èµ„æºã€‚</p><ul><li><p>ä¸»ä½“ Subjectï¼šå¯ä»¥çœ‹æˆå°±æ˜¯ è¿›ç¨‹</p></li><li><p>ç›®æ ‡ Objectï¼šç›®æ ‡èµ„æºï¼Œä¸€èˆ¬å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿ</p></li><li><p>æ”¿ç­– Policyï¼šä¼šæ ¹æ®æŸäº›æœåŠ¡æ¥åˆ¶å®šåŸºæœ¬çš„å­˜å–å®‰å…¨æ€§æ”¿ç­–ï¼Œæ”¿ç­–å†…è¿˜ä¼šæœ‰è¯¦ç»†çš„è§„åˆ™ rule æ¥æŒ‡å®šä¸åŒçš„æœåŠ¡å¼€æ”¾æŸäº›èµ„æºçš„å­˜å–ã€‚åœ¨ç›®å‰çš„ CentOS 7.x é‡Œé¢ä»…æä¾› 3 ä¸ªä¸»è¦çš„æ”¿ç­–ï¼š</p><ul><li>targetedï¼šé’ˆå¯¹ç½‘ç»œæœåŠ¡é™åˆ¶è¾ƒå¤šï¼Œé’ˆå¯¹æœ¬æœºé™åˆ¶è¾ƒå°‘ï¼Œæ˜¯é¢„è®¾çš„æ”¿ç­–</li><li>minimumï¼šç”± target ä¿®æ­£è€Œæ¥ï¼Œä»…é’ˆå¯¹é€‰æ‹©çš„è¿›ç¨‹æ¥ä¿æŠ¤</li><li>mlsï¼šå®Œæ•´çš„ SELinux é™åˆ¶ï¼Œé™åˆ¶æ–¹é¢è¾ƒä¸¥æ ¼</li></ul></li><li><p>å®‰å…¨æ€§æœ¬æ–‡ security context</p><p>ä¸»ä½“æ˜¯å¦èƒ½å­˜å–ç›®æ ‡é™¤äº†æ”¿ç­–æŒ‡å®šä¹‹å¤–ï¼Œ<strong>ä¸»ä½“ä¸ç›®æ ‡çš„å®‰å…¨æ€§æœ¬æ–‡å¿…é¡»ä¸€è‡´æ‰èƒ½å¤Ÿé¡ºåˆ©å­˜å–</strong></p><p>security context ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„ rwxï¼Œå¦‚æœè®¾ç½®é”™è¯¯ï¼Œä½ çš„æŸäº›æœåŠ¡ï¼ˆä¸»ä½“è¿›ç¨‹ï¼‰å°±æ— æ³•å­˜å–æ–‡ä»¶ç³»ç»Ÿï¼ˆç›®æ ‡èµ„æºï¼‰ï¼Œå°±ä¼šå‡ºç°æƒé™ä¸ç¬¦å¯¹çš„é”™è¯¯ä¿¡æ¯äº†</p></li></ul><p>ç”±äº SELinux é‡ç‚¹åœ¨ä¿æŠ¤è¿›ç¨‹è¯»å–æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ï¼Œä¸Šè¿°è¯´æ˜çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+r+`" alt="image-20200317094948523" tabindex="0" loading="lazy"><figcaption>image-20200317094948523</figcaption></figure><p>ä¼ ç»Ÿçš„è¿›ç¨‹ä¸æ–‡ä»¶çš„ rwx æ–¹å¼ï¼Œåœ¨è¿™ä¸­é—´å¢åŠ äº† SELinux æœˆ å®‰å…¨æ€§æœ¬æ–‡ <em>è§„åˆ™</em> ï¼Œé€šè¿‡äº†è¿™äº›è§„åˆ™ä¹‹åï¼Œæ‰å’Œä¼ ç»Ÿçš„è¿›ç¨‹ä¸æ–‡ä»¶çš„ rwx æ–¹å¼ä¸€è‡´ã€‚</p><p>ç¬”è€…ç†è§£ä¸ºæ˜¯é€šè¿‡æ‹¦æˆªå™¨çš„æ–¹å¼ï¼Œå‡ºå°äº† SELinux ï¼Œå‰é¢é€šè¿‡ SElinux æ‹¦æˆªç»†åŒ–æƒé™ï¼Œç¬¦åˆè¦æ±‚çš„å†å»åˆ°ä¼ ç»Ÿçš„æ–¹å¼ï¼Œè¿™æ ·ä¸€æ¥å°±å¯¹ä¼ ç»Ÿçš„åŠ å¼ºäº†</p><h3 id="å®‰å…¨æ€§æœ¬æ–‡-security-context" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨æ€§æœ¬æ–‡-security-context" aria-hidden="true">#</a> å®‰å…¨æ€§æœ¬æ–‡ Security Context</h3><p>CentOS 7.x çš„ target æ”¿ç­–æä¾›äº†éå¸¸å¤šçš„è§„åˆ™ï¼Œåªéœ€è¦å¦‚ä½•å¼€å¯å…³é—­æŸé¡¹è§„åˆ™å³å¯ã€‚</p><p>å®‰å…¨æ€§æœ¬æ–‡åˆ™éå¸¸éº»çƒ¦ï¼Œå¯èƒ½éœ€è¦è‡ªè¡Œé…ç½®å®ƒï¼Œæ¯”å¦‚ä½ å¸¸å¸¸è®¾ç½®æ–‡ä»¶çš„ rwx æƒé™ï¼Œé‚£ä¹ˆè¿™ä¸ªå®‰å…¨æ€§æœ¬æ–‡å°±ç±»ä¼¼ï¼Œå¯ä»¥çœ‹æˆæ˜¯ SELinux ä¸­çš„ rwx</p><p>å®‰å…¨æ€§æœ¬æ–‡å­˜åœ¨äºä¸»ä½“è¿›ç¨‹ä¸­ä¸ç›®æ ‡æ–‡ä»¶èµ„æºä¸­ï¼Œç‰©ç†ä½ç½®æ˜¯æ”¾åœ¨æ–‡ä»¶çš„ inode ä¸­ï¼Œå› æ­¤ä¸»ä½“è¿›ç¨‹æƒ³è¦è¯»å–ç›®æ ‡æ–‡ä»¶èµ„æºæ—¶ï¼ŒåŒæ ·éœ€è¦è¯»å– inodeï¼Œè¿™å°±å¯ä»¥å¯¹æ¯”å®‰å…¨æ€§æœ¬æ–‡ä¸€çº§ rwx ç­‰æƒé™æ˜¯å¦æ­£ç¡®äº†ã€‚</p><p>è§‚å¯Ÿå®‰å…¨æ€§æœ¬æ–‡å¯ä½¿ç”¨ <code>ls -Z</code> ï¼Œä½†æ˜¯å‰ææ˜¯éœ€è¦å¯åŠ¨ SELinux æ‰è¡Œï¼Œä¸‹ä¸ªå°èŠ‚ä¼šä»‹ç»å¦‚ä½•å¯åŠ¨ SELinuxï¼Œè¿™é‡Œå…ˆä»‹ç»çŸ¥è¯†ç‚¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ls -Z</span>
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 accountadd.sh
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 accountadd.txt
-rwxr--r--+ root root unconfined_u:object_r:admin_home_t:s0 acl_test1
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 addaccount2.sh
-rw-------. root root system_u:object_r:admin_home_t:s0 anaconda-ks.cfg
-rw-r--r--. root root system_u:object_r:admin_home_t:s0 initial-setup-ks.cfg
<span class="token comment"># ä¸Šè¿°å­—æ®µå¾ˆé•¿çš„é‚£ä¸€æ å°±æ˜¯å®‰å…¨æ€§æœ¬æ–‡äº†</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®‰å…¨æ€§æœ¬æ–‡ä¸»è¦ç”¨å†’å·åˆ†å‰²ä¸ºä¸‰ä¸ªå­—æ®µï¼Œå«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p>identifyï¼šèº«ä»½</p><p>ç›¸å½“äºè´¦æˆ·æ–¹é¢çš„èº«ä»½è¯†åˆ«ï¼Œå¸¸è§æœ‰å‡ ä¸‹å‡ ç§ç±»å‹</p><ul><li><p>unconfined_uï¼šä¸å—é™çš„ç”¨æˆ·</p><p>è¯¥æ–‡ä»¶æ¥è‡ªä¸å—é™çš„è¿›ç¨‹æ‰€äº§ç”Ÿçš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨å¯ç™»å½•è´¦å·æ¥å–å¾— bashï¼Œé¢„è®¾çš„ bash ç¯å¢ƒæ˜¯ä¸å— SELinux ç®¡åˆ¶çš„ï¼Œå› ä¸º bash å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹åˆ«çš„ç½‘ç»œæœåŠ¡ï¼Œå› æ­¤åœ¨è¯¥ bash è¿›ç¨‹æ‰€äº§ç”Ÿçš„æ–‡ä»¶ï¼Œå…¶èº«ä»½è¯†åˆ«å¤§å¤šå°±æ˜¯è¯¥ç±»å‹äº†</p></li><li><p>system_uï¼šç³»ç»Ÿç”¨æˆ·</p><p>åŸºæœ¬ä¸Šï¼Œå¦‚æœæ˜¯ç³»ç»Ÿä¼šè½¯ä»¶æœ¬èº«æ‰€æä¾›çš„æ–‡ä»¶ï¼Œå¤§å¤šå°±æ˜¯è¯¥ç±»å‹ï¼Œå¦‚æœæ˜¯ç”¨æˆ·é€šè¿‡ bash è‡ªå·±å»ºç«‹çš„æ–‡ä»¶ï¼Œå¤§å¤šåˆ™æ˜¯ä¸å—é™çš„ unconfined_u èº«ä»½ï¼Œå¦‚æœæ˜¯ç½‘ç»œæœåŠ¡æ‰€äº§ç”Ÿçš„æ–‡ä»¶ï¼Œæˆ–åˆ™æ˜¯ç³»ç»ŸæœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„æ–‡ä»¶ï¼Œåˆ™å¤§éƒ¨åˆ†æ˜¯ system_u</p></li></ul></li><li><p>roleï¼šè§’è‰²</p><p>é€šè¿‡è¯¥å­—æ®µï¼Œå¯ä»¥çŸ¥é“è¿™ä¸ªèµ„æ–™æ˜¯å±äºè¿›ç¨‹ã€æ–‡ä»¶èµ„æºè¿˜æ˜¯ä»£è¡¨ä½¿ç”¨è€…ï¼Œä¸€èˆ¬çš„è§’è‰²æœ‰ï¼š</p><ul><li>object_rï¼šä»£è¡¨çš„æ˜¯æ–‡ä»¶æˆ–ç›®å½•ç­‰æ–‡ä»¶èµ„æº</li><li>system_rï¼šä»£è¡¨çš„æ˜¯è¿›ç¨‹ï¼Œä¸è¿‡ä¸€èˆ¬ä½¿ç”¨è€…ä¹Ÿä¼šè¢«æŒ‡å®šä¸º system_r</li></ul></li><li><p>typeï¼šç±»å‹ï¼Œæœ€é‡è¦</p><p>åœ¨é¢„è®¾çš„ targeted æ”¿ç­–ä¸­ï¼Œ identify ä¸ role å­—æ®µåŸºæœ¬ä¸Šæ˜¯ä¸é‡è¦çš„ï¼Œè€Œ type æ˜¯æœ€é‡è¦çš„ï¼ŒåŸºæœ¬ä¸Šï¼Œä¸€ä¸ªä¸»ä½“è¿›ç¨‹èƒ½ä¸èƒ½è¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶èµ„æºï¼Œä¸ç±»å‹å­—æ®µæœ‰å…³ï¼Œè€Œç±»å‹å­—æ®µåœ¨æ–‡ä»¶ä¸è¿›ç¨‹çš„å®šä¹‰ä¸ç›¸åŒï¼š</p><ul><li>typeï¼šåœ¨æ–‡ä»¶èµ„æºï¼ˆobjectï¼‰ä¸Šé¢ç§°ä¸ºç±»å‹ï¼ˆtypeï¼‰</li><li>domainï¼šåœ¨ä¸»ä½“è¿›ç¨‹ï¼ˆsubjectï¼‰åˆ™ç§°ä¸ºé¢†åŸŸï¼ˆdomainï¼‰</li></ul><p>domain éœ€è¦ä¸ type æ­é…ï¼Œåˆ™è¯¥è¿›ç¨‹æ‰èƒ½å¤Ÿé¡ºåˆ©çš„è¯»å–æ–‡ä»¶èµ„æº</p><h2 id="è¿›ç¨‹ä¸æ–‡ä»¶-selinux-type-å­—æ®µçš„ç›¸å…³æ€§" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹ä¸æ–‡ä»¶-selinux-type-å­—æ®µçš„ç›¸å…³æ€§" aria-hidden="true">#</a> è¿›ç¨‹ä¸æ–‡ä»¶ SELinux type å­—æ®µçš„ç›¸å…³æ€§</h2><p>é€šè¿‡èº«ä»½è¯†åˆ«ä¸è§’è‰²å­—æ®µçš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚æŸä¸ªè¿›ç¨‹æ‰€ä»£è¡¨çš„æ„ä¹‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è§‚å¯Ÿä¸‹ç³»ç»Ÿ è¿›ç¨‹çš„ SELinux ç›¸å…³ä¿¡æ¯</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ps -eZ</span>
LABEL                             PID TTY          TIME CMD
system_u:system_r:init_t:s0         <span class="token number">1</span> ?        00:00:01 systemd
system_u:system_r:kernel_t:s0       <span class="token number">2</span> ?        00:00:00 kthreadd
system_u:system_r:kernel_t:s0       <span class="token number">4</span> ?        00:00:00 kworker/0:0H
system_u:system_r:kernel_t:s0       <span class="token number">5</span> ?        00:00:00 kworker/u2:0
<span class="token punctuation">..</span>.
system_u:system_r:sshd_t:s0-s0:c0.c1023 <span class="token number">2344</span> ? 00:00:00 sshd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2350</span> ? 00:00:00 sshd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2353</span> pts/0 00:00:00 <span class="token function">bash</span>
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2415</span> pts/0 00:00:00 <span class="token function">su</span>
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2424</span> pts/0 00:00:00 <span class="token function">bash</span>
system_u:system_r:kernel_t:s0    <span class="token number">2726</span> ?        00:00:00 kworker/u2:2
system_u:system_r:kernel_t:s0    <span class="token number">2778</span> ?        00:00:00 kworker/0:1
system_u:system_r:kernel_t:s0    <span class="token number">2836</span> ?        00:00:00 kworker/0:3
system_u:system_r:kernel_t:s0    <span class="token number">2877</span> ?        00:00:00 kworker/0:0
system_u:system_r:ksmtuned_t:s0  <span class="token number">2885</span> ?        00:00:00 <span class="token function">sleep</span>
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2886</span> pts/0 00:00:00 <span class="token function">ps</span>

<span class="token comment"># åŸºæœ¬ä¸Šè¿›ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œ</span>
<span class="token comment"># ä¸€ç§æ˜¯ç³»ç»Ÿæœ‰å—é™çš„ system_u:system_rï¼Œ</span>
<span class="token comment"># å¦ä¸€ç§å¯èƒ½æ˜¯ç”¨æˆ·è‡ªå·±çš„ï¼Œæ¯”è¾ƒä¸å—é™çš„è¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯æœ¬æœºç”¨æˆ·è‡ªå·±æ‰§è¡Œçš„ç¨‹åº ï¼‰ unconfined_u:unconfined_r</span>

<span class="token comment"># unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 2424 pts/0 00:00:00 bash</span>
<span class="token comment"># æ¯”å¦‚ä¸Šé¢è¿™ä¸ªè¿›ç¨‹ï¼Œå°±æ˜¯æˆ‘ä»¬è‡ªå·±æ‰§è¡Œå‘½ä»¤æ‰€åœ¨çš„ bash</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸºæœ¬ä¸Šï¼Œè¿™äº›å¯¹äºèµ„æ–™åœ¨ targeted æ”¿ç­–ä¸‹çš„å¯¹åº”å¯¹ä¸‹</p><table><thead><tr><th>èº«ä»½è¯†åˆ«</th><th>è§’è‰²</th><th>å¯¹åº”åœ¨ targeted çš„æ„ä¹‰</th></tr></thead><tbody><tr><td>unconfined_u</td><td>unconfined_r</td><td>ä¸€èˆ¬å¯ç™»é™†ä½¿ç”¨è€…çš„è¿›ç¨‹ï¼Œæ¯”è¾ƒæ²¡æœ‰å—é™çš„è¿›ç¨‹ã€‚å¤§å¤šæ•°éƒ½æ˜¯ç”¨æˆ·å·²ç»é¡ºåˆ©ç™»é™†ç³»ç»Ÿï¼ˆä¸è®ºæ˜¯ç½‘ç»œè¿˜æ˜¯æœ¬æœºç™»é™†æ¥å–å¾—å¯ç”¨çš„ shellï¼‰åï¼Œæ‰€ç”¨æ¥æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ï¼Œå¦‚ bash x window ç›¸å…³å¯Œå®‰å±…ç­‰</td></tr><tr><td>system_u</td><td>system_r</td><td>ç”±äºä¸ºç³»ç»Ÿè´¦æˆ·ï¼Œå› æ­¤æ˜¯éäº¤è°ˆå¼çš„ç³»ç»Ÿè¿è¡Œè¿›ç¨‹ï¼Œå¤§å¤šæ•°çš„ç³»ç»Ÿè¿›ç¨‹å‡æ˜¯è¿™ç§ç±»å‹</td></tr></tbody></table><p>å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨é¢„è®¾çš„ target æ”¿ç­–ä¸‹ï¼Œæœ€é‡è¦çš„æ˜¯ type å­—æ®µï¼Œä¸»ä½“ä¸ç›®æ ‡ä¹‹é—´æ˜¯å¦å…·æœ‰å¯è¯»å†™çš„æƒé™ï¼Œä¸è¿›ç¨‹çš„ domain ä¸æ–‡ä»¶çš„ type æœ‰å…³ã€‚è¿™ä¸¤è€…çš„å…³ç³»å¯ä»¥ä½¿ç”¨ crond ä»¥åŠä»–çš„é…ç½®æ–‡ä»¶æ¥è¯´æ˜</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å…ˆçœ‹çœ‹ crond è¿™ä¸ªè¿›ç¨‹çš„å®‰å…¨æœ¬æ–‡å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ps -eZ | grep cron</span>
system_u:system_r:crond_t:s0-s0:c0.c1023 <span class="token number">1398</span> ? 00:00:00 atd
system_u:system_r:crond_t:s0-s0:c0.c1023 <span class="token number">1400</span> ? 00:00:00 crond
<span class="token comment"># è¿™ä¸ªå®‰å…¨æœ¬æ–‡çš„ç±»å‹åç§°ä¸º crond_t æ ¼å¼</span>

<span class="token comment"># 2. çœ‹çœ‹ /usr/ssbin/crond ã€ /etc/cron.dã€/etc/cron.d æ–‡ä»¶çš„å®‰å…¨æœ¬æ–‡å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -Zd /usr/sbin/crond /etc/crontab /etc/cron.d</span>
drwxr-xr-x. root root system_u:object_r:system_cron_spool_t:s0 /etc/cron.d
-rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab
-rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ <code>/usr/ssbin/crond</code> åï¼Œè¯¥ç¨‹åºç¼–ç¨‹çš„è¿›ç¨‹ domain ç±»ä¼¼æ˜¯ crond_tï¼Œå®ƒèƒ½å¤Ÿè¯»å–çš„é…ç½®æ–‡ä»¶æ˜¯ <code>system_cron_spool_t</code> ç±»å‹ã€‚å› æ­¤æ— è®º <code>/etc/crontab</code>ä¸ <code>/etc/cron.d</code> ä»¥åŠ <code>/var/spool/cron</code> éƒ½ä¼šæ˜¯ç›¸å…³çš„ SELinux ç±»å‹ï¼ˆ<code>/var/spool/cron</code> ä¸º <code>user_cron_spool_t</code> ç±»å‹ï¼‰ã€‚ä¸‹é¢å›¾ç¤ºè¯´æ˜</p><figure><img src="`+d+`" alt="image-20200317115128966" tabindex="0" loading="lazy"><figcaption>image-20200317115128966</figcaption></figure></li></ul><ol><li>crond æ‰§è¡Œåï¼Œå…·æœ‰ crond_exec_t ç±»å‹</li><li>è¯¥æ–‡ä»¶ç±»å‹ä¼šé€ æˆä¸»ä½“è¿›ç¨‹ Subject å…·æœ‰ crond è¿™ä¸ªé¢†åŸŸ domainï¼Œæ”¿ç­–é’ˆå¯¹è¿™ä¸ªé¢†åŸŸæœ‰è®¸å¤šè§„åˆ™ï¼Œå…¶ä¸­å°±åŒ…æ‹¬å¯ä»¥è¯»å–çš„ç›®æ ‡èµ„æºç±»å‹</li><li>ç”±äº crond domain è¢«è®¾ç½®ä¸ºå¯ä»¥è¯»å– system_cron_spool_t ç±»å‹çš„ç›®æ ‡æ–‡ä»¶ objectï¼Œå› æ­¤ä½ çš„é…ç½®æ–‡ä»¶æ”¾åˆ° <code>/etc/cron.d/</code> ç›®å½•ä¸‹ï¼Œå°±èƒ½å¤Ÿè¢« crond è¿›ç¨‹è¯»å–äº†</li><li>ä½†æ˜¯æœ€ç»ˆèƒ½ä¸èƒ½è¯»åˆ°æ­£ç¡®çš„èµ„æ–™ï¼Œè¿˜éœ€è¦çœ‹ä¼ ç»Ÿçš„ rwx æ˜¯å¦ç¬¦åˆ Linux çš„æƒé™è§„èŒƒ</li></ol><p>ä¸‹é¢æ¥æµ‹è¯•ä¸Šè¿°è¯´æ˜</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å‡è®¾ä½ å› ä¸ºä¸ç†Ÿæ‚‰çš„ç¼˜æ•…ï¼Œå› æ­¤æ˜¯åœ¨ root å®¶ç›®å½•å»ºç«‹ä¸€ä¸ªå¦‚ä¸‹çš„ cron è®¾ç½®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim checktime</span>
<span class="token number">10</span> * * * * root <span class="token function">sleep</span> 60s

<span class="token comment"># 2. å‘ç°æ–‡ä»¶æ”¾é”™ç›®å½•äº†ï¼Œåˆä¸æƒ³è¦ä¿ç•™å‰¯æœ¬ï¼Œå› æ­¤ä½¿ç”¨ mv ç§»åŠ¨åˆ°æ­£ç¡®çš„ç›®å½•</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mv checktime /etc/cron.d/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /etc/cron.d/checktime </span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">26</span> Mar <span class="token number">17</span> <span class="token number">13</span>:12 /etc/cron.d/checktime
<span class="token comment"># æƒé™æ˜¯ 644ï¼Œä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥è¯»å–</span>

<span class="token comment"># 3. å¼ºåˆ¶é‡æ–°å¯åŠ¨ crondï¼Œç„¶åæŸ¥çœ‹ç™»å½•æ—¥å¿—</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart crond          </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># tail /var/log/cron</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:01:01 study run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3889</span><span class="token punctuation">]</span>: finished mcelog.cron
Mar <span class="token number">17</span> <span class="token number">13</span>:10:01 study CROND<span class="token punctuation">[</span><span class="token number">3972</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> CMD <span class="token punctuation">(</span>/usr/lib64/sa/sa1 <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:14:01 study crond<span class="token punctuation">[</span><span class="token number">1400</span><span class="token punctuation">]</span>: <span class="token variable"><span class="token punctuation">((</span>null<span class="token punctuation">))</span></span> Unauthorized SELinux <span class="token assign-left variable">context</span><span class="token operator">=</span>system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 <span class="token assign-left variable">file_context</span><span class="token operator">=</span>unconfined_u:object_r:admin_home_t:s0 <span class="token punctuation">(</span>/etc/cron.d/checktime<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:14:01 study crond<span class="token punctuation">[</span><span class="token number">1400</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> FAILED <span class="token punctuation">(</span>loading <span class="token function">cron</span> table<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">1400</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>Shutting down<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>RANDOM_DELAY will be scaled with factor <span class="token number">13</span>% <span class="token keyword">if</span> used.<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token variable"><span class="token punctuation">((</span>null<span class="token punctuation">))</span></span> Unauthorized SELinux <span class="token assign-left variable">context</span><span class="token operator">=</span>system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 <span class="token assign-left variable">file_context</span><span class="token operator">=</span>unconfined_u:object_r:admin_home_t:s0 <span class="token punctuation">(</span>/etc/cron.d/checktime<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> FAILED <span class="token punctuation">(</span>loading <span class="token function">cron</span> table<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>running with inotify support<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">13</span>:15:08 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>@reboot <span class="token function">jobs</span> will be run at computer&#39;s startup.<span class="token punctuation">)</span>

<span class="token comment"># ä¸Šè¿°æ—¥å¿—ä¸­æœ‰ Unauthorized çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºæœ‰é”™è¯¯ï¼Œå› ä¸ºåŸæœ¬çš„å®‰å…¨æœ¬æ–‡ä¸æ–‡ä»¶çš„å®é™…å®‰å…¨æœ¬æ–‡æ— æ³•æ­é…çš„ç¼˜æ•…ï¼Œ</span>
<span class="token comment"># ä¿¡æ¯è¿˜åˆ—å‡ºäº† SELinux context ä¸ file_context çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºçš„ç¡®ä¸åŒ¹é…</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»å¦‚ä¸Šçš„æµ‹è¯•æ¥çœ‹ï¼Œä¸Šè¿°æµ‹è¯•ç”±äºå®‰å…¨æœ¬æ–‡ä¸åŒ¹é…å¯¼è‡´è¿›ç¨‹æ— æ³•è¯»å–è¯¥æ–‡ä»¶</p><h2 id="ğŸ€-selinux-ä¸‰ç§æ¨¡å¼çš„å¯åŠ¨ã€å…³é—­ä¸è§‚å¯Ÿ" tabindex="-1"><a class="header-anchor" href="#ğŸ€-selinux-ä¸‰ç§æ¨¡å¼çš„å¯åŠ¨ã€å…³é—­ä¸è§‚å¯Ÿ" aria-hidden="true">#</a> ğŸ€ SELinux ä¸‰ç§æ¨¡å¼çš„å¯åŠ¨ã€å…³é—­ä¸è§‚å¯Ÿ</h2><p>å¹¶éæ‰€æœ‰çš„ Linux distribution éƒ½æ”¯æŒ SELinuxï¼ŒCentOS 7.x æœ¬èº«å°±æœ‰æ”¯æŒ SELinuxï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦è‡ªè¡Œç¼–è¯‘ SELinux åˆ°ä½ çš„ Linux æ ¸å¿ƒä¸­ã€‚ç›®å‰ SELinux æ˜¯å¦å¯åŠ¨æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li>enforcingï¼šå¼ºåˆ¶æ¨¡å¼ï¼Œè¡¨ç¤º SELinux è¿è¡Œä¸­ï¼Œä¸”å·²ç»æ­£ç¡®çš„å¼€å§‹é™åˆ¶ domain/type äº†</li><li>permissiveï¼šå®½å®¹æ¨¡å¼ï¼Œè¡¨ç¤º SELinux è¿è¡Œä¸­ï¼Œä¸è¿‡ä»…æœ‰è­¦å‘Šè¿›è¡Œå¹¶ä¸ä¼šå®é™…é™åˆ¶ domain/type çš„å­˜å–ã€‚è¿™ç§æ¨¡å¼å¯ä»¥ç”¨æ¥ debug SELinux çš„é…ç½®</li><li>disabledï¼šSELinux å…³é—­ä¸­</li></ul><p>ä¸‰ç§æ¨¡å¼çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="`+m+`" alt="image-20200317132323274" tabindex="0" loading="lazy"><figcaption>image-20200317132323274</figcaption></figure><p>æ³¨æ„ï¼šå¹¶éæœ‰æ‰€çš„è¿›ç¨‹éƒ½å— SELinux çš„ç®¡æ§ï¼Œæ³¨æ„æ˜¯æœ‰ <strong>å—é™çš„è¿›ç¨‹ä¸»ä½“</strong>ï¼Œå¯ä»¥é€šè¿‡ <code>ps -eZ</code> æ¥è§‚å¯Ÿè¯¥è¿›ç¨‹æ˜¯å¦æœ‰å—é™ï¼ˆconfinedï¼‰ã€‚ä¸‹é¢æ¥è§‚å¯Ÿ crond ä¸ bash ç¨‹åºæ˜¯å¦æœ‰è¢«é™åˆ¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ps -eZ | grep -E &#39;cron|bash&#39;</span>
system_u:system_r:crond_t:s0-s0:c0.c1023 <span class="token number">1398</span> ? 00:00:00 atd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2353</span> pts/0 00:00:00 <span class="token function">bash</span>
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span class="token number">2424</span> pts/0 00:00:00 <span class="token function">bash</span>
system_u:system_r:crond_t:s0-s0:c0.c1023 <span class="token number">4073</span> ? 00:00:00 crond
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºç›®å‰ target è¿™ä¸ªæ”¿ç­–ä¸‹ï¼Œåªæœ‰ç¬¬ 3 ä¸ªå­—æ®µ type ä¼šæœ‰å½±å“ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ° crond æœ‰ <code>crond_t</code> ç±»å‹ï¼Œæ˜¯å—é™çš„ï¼Œè€Œ bash æ˜¯ <code>unconfined_t</code> ç±»å‹ï¼Œæ˜¯ä¸å—é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ bash ä¸ä¼šç»è¿‡ä¸Šå›¾çš„æµç¨‹ï¼Œè€Œç›´æ¥å»åˆ¤å®š rwx</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å½“å‰çš„ SELinux æ¨¡å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># getenforce </span>
Enforcing
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥è¯¢å½“å‰ SELinux çš„æ”¿ç­–ï¼ˆPolicyï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sestatus <span class="token punctuation">[</span>-vb<span class="token punctuation">]</span>

é€‰é¡¹ä¸å‚æ•°ï¼š
	-vï¼šæ£€æŸ¥ /etc/sestatus.conf å†…çš„æ–‡ä»¶ä¸è¿›ç¨‹çš„å®‰å…¨æ€§æœ¬æ–‡å†…å®¹
	-bï¼šå°†ç›®å‰æ”¿ç­–çš„è§„åˆ™å¸ƒå°”å€¼åˆ—å‡ºï¼Œå³æŸäº›è§„åˆ™ rule æ˜¯å¦è¦å¯åŠ¨ï¼ˆ0/1ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šåˆ—å‡ºç›®å‰ SELinux ä½¿ç”¨çš„å“ªä¸ªæ”¿ç­– Policy</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sestatus   		</span>
SELinux status:                 enabled				<span class="token comment"># SELinux æ˜¯å¦å¯åŠ¨</span>
SELinuxfs mount:                /sys/fs/selinux		<span class="token comment"># SELinux çš„ç›¸å…³æ–‡ä»¶æ•°æ®æŒ‚è½½ç‚¹</span>
SELinux root directory:         /etc/selinux		<span class="token comment"># SELinux çš„æ ¹ç›®å½•æ‰€åœ¨</span>
Loaded policy name:             targeted			<span class="token comment"># å½“å‰çš„æ”¿ç­–</span>
Current mode:                   enforcing			<span class="token comment"># å½“å‰æ¨¡å¼</span>
Mode from config file:          enforcing			<span class="token comment"># ç›®å‰é…ç½®æ–‡ä»¶å†…è§„èŒƒçš„ SELinux æ¨¡å¼</span>
Policy MLS status:              enabled				<span class="token comment"># æ˜¯å¦å«æœ‰ MLS çš„æ¨¡å¼æœºåˆ¶</span>
Policy deny_unknown status:     allowed				<span class="token comment"># æ˜¯å¦é¢„è®¾æŠµæŒ¡æœªçŸ¥çš„ä¸»ä½“è¿›ç¨‹</span>
Max kernel policy version:      <span class="token number">31</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä¿¡æ¯ç§‘çŸ¥é“ï¼ŒSELinux ç›®å‰çš„æ”¿ç­–æ˜¯ targeted ï¼Œå¯é€šè¿‡å¦‚ä¸‹æ–¹å¼ä¿®æ”¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/selinux/config </span>
<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>enforcing		 	<span class="token comment"># å¯é€‰æ‹©ä¸ºä¸Šè¿° 3 ä¸ª</span>
<span class="token comment"># SELINUXTYPE= can take one of three values:</span>
<span class="token comment">#     targeted - Targeted processes are protected,</span>
<span class="token comment">#     minimum - Modification of targeted policy. Only selected processes are protected. </span>
<span class="token comment">#     mls - Multi Level Security protection.</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted		<span class="token comment"># å¯é€‰å€¼ä¸ºä¸Šè¿° 3 ä¸ª</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="selinux-çš„å¯åŠ¨ä¸å…³é—­" tabindex="-1"><a class="header-anchor" href="#selinux-çš„å¯åŠ¨ä¸å…³é—­" aria-hidden="true">#</a> SElinux çš„å¯åŠ¨ä¸å…³é—­</h3><p>ç”±äº SElinux æ˜¯æ•´åˆåˆ°æ ¸å¿ƒä¸­å»çš„ï¼Œå› æ­¤ä¿®æ”¹ä¸Šè¿°é…ç½®æ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡æ–°å¯åŠ¨ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœä» disable è½¬åˆ°å¯åŠ¨ SELinux çš„æ¨¡å¼æ—¶ï¼Œç”±äºç³»ç»Ÿå¿…é¡»è¦é’ˆå¯¹æ–‡ä»¶å†™å…¥å®‰å…¨æ€§æœ¬æ–‡ä¿¡æ¯ï¼Œå› æ­¤å¼€æœºè¿‡ç¨‹éœ€è¦è€—è´¹ä¸å°‘æ—¶é—´ç­‰å¾…é‡æ–°å†™å…¥ SELinux å®‰å…¨æ€§æœ¬æ–‡ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºSELinux Labelï¼‰ï¼Œè€Œä¸”åœ¨å†™å®Œä¹‹åè¿˜éœ€è¦é‡æ–°å¯åŠ¨ä¸€æ¬¡ï¼Œå¯åŠ¨æˆåŠŸä¹‹åï¼Œå†ä½¿ç”¨ <code>getenforce å’Œ sestatus</code> æ¥è§‚å¯Ÿæ˜¯å¦æœ‰æˆåŠŸå¯åŠ¨åˆ° Enforcing æ¨¡å¼</p><p>å¦‚æœå½“å‰å·²ç»æ˜¯ Enforcing æ¨¡å¼ï¼Œå¯èƒ½ç”±äºä¸€äº›è®¾ç½®é—®é¢˜å¤§é“è‡³ SELinux è®©æŸäº›æœåŠ¡æ— æ³•æ­£å¸¸çš„è¿è¡Œï¼Œæ­¤æ—¶å¯å°†æ¨¡å¼ä¿®æ”¹ä¸ºå®½å®¹æ¨¡å¼ï¼ˆpermissiveï¼‰ï¼Œè®© SELinux åªå‘å‡ºè­¦å‘Šä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>setenforce <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">]</span>

é€‰é¡¹ä¸å‚æ•°ï¼š
	<span class="token number">0</span>ï¼šè½¬æˆ permissive å®½å®¹æ¨¡å¼
	<span class="token number">1</span>ï¼šè½¬æˆ Enforcing å¼ºåˆ¶æ¨¡å¼
æ³¨æ„ï¼šæ— æ³•åœ¨ Disabled æ¨¡å¼ä¸‹è¿›ç¨‹æ¨¡å¼çš„åˆ‡æ¢	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸäº›æ—¶å€™ä» Disabled æ¢æˆ Enforcing ä¹‹åï¼Œæœ‰éƒ¨åˆ†æœåŠ¡å¯èƒ½æ— æ³•é¡ºåˆ©å¯åŠ¨ï¼Œå¯èƒ½ä¼šæŠ¥é”™ <code>/lib/xxx</code> æ•°æ®æ²¡æœ‰æƒé™è¯»å–çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™å¤§å¤šæ•°æ˜¯ç”±äºé‡æ–°å†™å…¥ Selinux typeï¼ˆRelabelï¼‰å‡ºé”™çš„åŸå› ï¼Œä½¿ç”¨ Permissive æ¨¡å¼å°±æ²¡æœ‰è¯¥é”™è¯¯ã€‚æœ€ç®€å•çš„åŠæ³•æ˜¯åœ¨ Permissive æ¨¡å¼ä¸‹ä½¿ç”¨æŒ‡ä»¤ <code>restorecon -Rv /</code> é‡æ–°è¿˜åŸæ‰€æœ‰ SELinux çš„ç±»å‹</p><h2 id="ğŸ€-selinux-æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ€-selinux-æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†" aria-hidden="true">#</a> ğŸ€ SELinux æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†</h2><h3 id="selinux-å„ä¸ªè§„åˆ™çš„å¸ƒå°”å€¼æŸ¥è¯¢-getsebool" tabindex="-1"><a class="header-anchor" href="#selinux-å„ä¸ªè§„åˆ™çš„å¸ƒå°”å€¼æŸ¥è¯¢-getsebool" aria-hidden="true">#</a> SELinux å„ä¸ªè§„åˆ™çš„å¸ƒå°”å€¼æŸ¥è¯¢ï¼šgetsebool</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>getsebool <span class="token punctuation">[</span>-a<span class="token punctuation">]</span> <span class="token punctuation">[</span>è§„åˆ™åç§°<span class="token punctuation">]</span>

é€‰é¡¹ä¸å‚æ•°ï¼š
	-aï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šæ‰€æœ‰ SELinux è§„åˆ™çš„å¸ƒå°”å€¼ä¸ºå¼€å¯æˆ–å…³é—­ï¼ˆon/offï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šæŸ¥è¯¢æ‰€æœ‰çš„å¸ƒå°”å€¼è®¾ç½®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># getsebool -a</span>
abrt_anon_write --<span class="token operator">&gt;</span> off
abrt_handle_event --<span class="token operator">&gt;</span> off
abrt_upload_watch_anon_write --<span class="token operator">&gt;</span> on
<span class="token punctuation">..</span>.
cron_can_relabel --<span class="token operator">&gt;</span> off		<span class="token comment"># è¿™ä¸ªä¸ cron æœ‰å…³</span>
cron_system_cronjob_use_shares --<span class="token operator">&gt;</span> off
cron_userdomain_transition --<span class="token operator">&gt;</span> on
<span class="token punctuation">..</span>.
httpd_anon_write --<span class="token operator">&gt;</span> off		<span class="token comment"># ä¸ç½‘é¡µ http æœ‰å…³</span>
httpd_builtin_scripting --<span class="token operator">&gt;</span> on
httpd_can_check_spam --<span class="token operator">&gt;</span> off
<span class="token comment"># æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªè§„åˆ™</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="selinux-å„ä¸ªè§„åˆ™è§„èŒƒçš„ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶-selinux-type-æŸ¥è¯¢-seinfoã€sesearch" tabindex="-1"><a class="header-anchor" href="#selinux-å„ä¸ªè§„åˆ™è§„èŒƒçš„ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶-selinux-type-æŸ¥è¯¢-seinfoã€sesearch" aria-hidden="true">#</a> SELinux å„ä¸ªè§„åˆ™è§„èŒƒçš„ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶ SELinux type æŸ¥è¯¢ seinfoã€sesearch</h3><p>ä¸Šè¿°æŒ‡ä»¤çŸ¥é“äº†æ‰€æœ‰çš„è§„åˆ™å¼€å¯æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ seinfoã€sesearch ç­‰å·¥å…·æ¥æŸ¥çœ‹æ¯ä¸ªè§„åˆ™å…·ä½“åœ¨é™åˆ¶ä»€ä¹ˆã€‚</p>`,66),b=s(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># blkid </span>
/dev/sr0: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;2019-09-11-18-50-31-00&quot;</span> <span class="token assign-left variable">LABEL</span><span class="token operator">=</span><span class="token string">&quot;CentOS 7 x86_64&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;iso9660&quot;</span> <span class="token assign-left variable">PTTYPE</span><span class="token operator">=</span><span class="token string">&quot;dos&quot;</span> 
/dev/sda1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;e9d54afb-2afe-42de-87fe-9f55d747fcd9&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;xfs&quot;</span> 
/dev/sda2: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;CNUXwS-J3Lh-0nDA-TssW-l1vT-90us-MHYnT1&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;LVM2_member&quot;</span> 
/dev/mapper/centos_study-root: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;d7e09bb4-2f04-4ed4-b377-91a22fe85ce7&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;xfs&quot;</span> 
/dev/mapper/centos_study-swap: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;684eebc0-3f70-4fc1-9a5d-d683f6a07cd0&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;swap&quot;</span> 
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sr0 /mnt/</span>
mount: /dev/sr0 is write-protected, mounting read-only
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># yum install /mnt/Packages/setools-console-*                               </span>
<span class="token punctuation">..</span>.
Complete<span class="token operator">!</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># umount /mnt/  # å¸è½½å…‰ç›˜</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>seinfo <span class="token punctuation">[</span>-Atrub<span class="token punctuation">]</span>

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Aï¼šåˆ—å‡º SELinux çš„çŠ¶æ€ã€è§„åˆ™å¸ƒå°”å€¼ã€èº«ä»½è¯†åˆ«ã€è§’è‰²ã€ç±»å‹ç­‰æ‰€æœ‰ä¿¡æ¯
	-uï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰èº«ä»½è¯†åˆ« user ç§ç±»
	-rï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰è§’è‰² role ç§ç±»
	-tï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰ç±»å‹ <span class="token builtin class-name">type</span> ç§ç±»
	-bï¼šåˆ—å‡ºæ‰€æœ‰è§„åˆ™çš„ç§ç±»ï¼ˆå¸ƒå°”å€¼ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šåˆ—å‡º SELinux åœ¨æ­¤æ”¿ç­–ä¸‹çš„ç»Ÿè®¡çŠ¶æ€</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># seinfo </span>

Statistics <span class="token keyword">for</span> policy file: /sys/fs/selinux/policy
Policy Version <span class="token operator">&amp;</span> Type: v.31 <span class="token punctuation">(</span>binary, mls<span class="token punctuation">)</span>

   Classes:           <span class="token number">130</span>    Permissions:       <span class="token number">272</span>
   Sensitivities:       <span class="token number">1</span>    Categories:       <span class="token number">1024</span>
   Types:            <span class="token number">4792</span>    Attributes:        <span class="token number">253</span>
   Users:               <span class="token number">8</span>    Roles:              <span class="token number">14</span>
   Booleans:          <span class="token number">316</span>    Cond. Expr.:       <span class="token number">362</span>
   Allow:          <span class="token number">107360</span>    Neverallow:          <span class="token number">0</span>
   Auditallow:        <span class="token number">157</span>    Dontaudit:       <span class="token number">10020</span>
   Type_trans:      <span class="token number">18129</span>    Type_change:        <span class="token number">74</span>
   Type_member:        <span class="token number">35</span>    Role allow:         <span class="token number">39</span>
   Role_trans:        <span class="token number">416</span>    Range_trans:      <span class="token number">5899</span>
   Constraints:       <span class="token number">143</span>    Validatetrans:       <span class="token number">0</span>
   Initial SIDs:       <span class="token number">27</span>    Fs_use:             <span class="token number">32</span>
   Genfscon:          <span class="token number">103</span>    Portcon:           <span class="token number">614</span>
   Netifcon:            <span class="token number">0</span>    Nodecon:             <span class="token number">0</span>
   Permissives:         <span class="token number">0</span>    Polcap:              <span class="token number">5</span>
   
<span class="token comment"># å½“å‰æ”¿ç­–æ˜¯ targeted ï¼Ÿ ï¼ˆå“ªé‡Œæ˜¾ç¤ºçš„ï¼Ÿï¼‰ï¼Œæ­¤æ”¿ç­–ä¸‹çš„ Types ç±»å‹æœ‰ 4792 ä¸ª</span>
<span class="token comment"># SELinux çš„è§„åˆ™ï¼ˆBooleansï¼‰æœ‰ 316 æ¡</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å‰é¢è®²åˆ°è¿‡å‡ ä¸ªèº«ä»½è¯†åˆ« user ä¸ è§’è‰² roleï¼Œseinfo å¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰çš„ç§ç±»ï¼Œå¯è‡ªè¡ŒæŸ¥è¯¢</p><p>åœ¨å‰é¢è®²åˆ° <code>/etc/cron.d/checktime</code> çš„ SElinux type ç±»å‹ä¸å¤ªå¯¹ï¼Œæˆ‘ä»¬çŸ¥é“ crond è¿›ç¨‹çš„ type æ˜¯ <code>crond_t</code>ï¼Œé‚£ä¹ˆæŸ¥æ‰¾ä¸‹ <code>crond_t</code> èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶ SELinux type æœ‰å“ªäº›</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sesearch <span class="token punctuation">[</span>-A<span class="token punctuation">]</span> <span class="token punctuation">[</span>-s ä¸»ä½“ç±»åˆ«<span class="token punctuation">]</span> <span class="token punctuation">[</span>-t ç›®æ ‡ç±»åˆ«<span class="token punctuation">]</span> <span class="token punctuation">[</span>-b å¸ƒå°”å€¼<span class="token punctuation">]</span>

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Aï¼šåˆ—å‡ºåé¢æ•°æ®ä¸­ï¼Œå…è®¸ã€Œè¯»å–æˆ–æ”¾è¡Œã€çš„ç›¸å…³æ•°æ®
	-tï¼šåé¢è¿˜è¦æ¥ typeã€ä¾‹å¦‚ <span class="token parameter variable">-t</span> httpd_t
	-bï¼šåé¢æ¥ SELinux çš„è§„åˆ™ï¼Œä¾‹å¦‚ <span class="token parameter variable">-b</span> httpd_enable_ftp_server
	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šæ‰¾å‡º crond_t ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶ SELinux type</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sesearch -A -s crond_t | grep spool</span>
   allow crond_t var_spool_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t system_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t user_cron_spool_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t user_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> create getattr setattr lock append unlink <span class="token function">link</span> <span class="token function">rename</span> <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t system_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> create getattr setattr lock append unlink <span class="token function">link</span> <span class="token function">rename</span> <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t var_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> create getattr setattr lock append unlink <span class="token function">link</span> <span class="token function">rename</span> <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow daemon user_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> getattr lock append <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> getattr lock add_name remove_name search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t user_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> getattr lock add_name remove_name search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t user_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> create getattr setattr lock append unlink <span class="token function">link</span> <span class="token function">rename</span> <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t system_cron_spool_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> create getattr setattr lock append unlink <span class="token function">link</span> <span class="token function">rename</span> <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
   
<span class="token comment"># allow åé¢æ˜¯ä¸»ä½“è¿›ç¨‹ä»¥åŠæ–‡ä»¶çš„ SELinux typeï¼Œä¸Šé¢æ•°æ®æ˜¯æˆªå–å‡ºæ¥çš„</span>
<span class="token comment"># crond_t å¯ä»¥è¯»å– system_cron_spool_t çš„æ–‡ä»¶/ç›®å½•ç±»å‹ç­‰</span>

<span class="token comment"># èŒƒä¾‹ 2ï¼šæ‰¾å‡º crond_t æ˜¯å¦èƒ½è¯»å– /etc/cron.d/checktime è¿™ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼Ÿ</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -Z /etc/cron.d/checktime </span>
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /etc/cron.d/checktime
<span class="token comment"># ä¸¤ä¸ªé‡ç‚¹ï¼šSELinux type ä¸º admin_home_tï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶ï¼ˆfileï¼‰</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sesearch -A -s crond_t | grep admin_home_t</span>
   allow domain admin_home_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t admin_home_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow userdom_filetrans_type admin_home_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow userdom_filetrans_type admin_home_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> <span class="token function">write</span> getattr lock add_name remove_name search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow domain admin_home_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow crond_t admin_home_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span>
   
<span class="token comment"># å‘ç°æœ‰ crond_t admin_home_t å­˜åœ¨ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯æ€»ä½“çš„ä¿¡æ¯</span>
<span class="token comment"># æ²¡æœ‰é’ˆå¯¹æŸäº›è§„åˆ™çš„æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®å®š checktime èƒ½å¦è¢«è¯»å–ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šå°±æ˜¯ SELinux type å‡ºç°é—®é¢˜ï¼Œæ‰æ— æ³•è¯»å–çš„</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨çŸ¥é“äº† <code>/etc/cron.d/checktime</code> æ˜¯ SELinux type é”™è¯¯å¯¼è‡´æ— æ³•è¯»å–çš„ã€‚çœ‹æ¥åœ¨ <code>getsebool -a</code> ä¸­çœ‹åˆ°çš„ <code>httpd_enable_homedirs</code> æ˜¯ä»€ä¹ˆï¼Ÿåˆæ˜¯è§„èŒƒäº†å“ªäº›ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„ SELinux type</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage boolean -l | grep httpd_enable_homedirs</span>
httpd_enable_homedirs          <span class="token punctuation">(</span>off  ,  off<span class="token punctuation">)</span>  Allow httpd to <span class="token builtin class-name">enable</span> homedirs
<span class="token comment"># httpd_enable_homedirs çš„åŠŸèƒ½æ˜¯å…è®¸ httpd è¿›ç¨‹è¯»å–ç”¨æˆ·å®¶ç›®å½•</span>

<span class="token comment"># èŒƒä¾‹ 3ï¼šåˆ—å‡ºè¯¥è§„åˆ™ä¸­ï¼Œä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶  SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sesearch -A -b httpd_enable_homedirs</span>
Found <span class="token number">77</span> semantic av rules:
   allow httpd_t user_home_type <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_suexec_t user_home_type <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_suexec_t user_home_dir_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_t nfs_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t nfs_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t cifs_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_user_script_t user_home_type <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_user_script_t user_home_type <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_t cifs_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t nfs_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t nfs_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t nfs_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t nfs_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_t user_home_dir_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t cifs_t <span class="token builtin class-name">:</span> <span class="token function">file</span> <span class="token punctuation">{</span> ioctl <span class="token builtin class-name">read</span> getattr lock <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t user_home_dir_t <span class="token builtin class-name">:</span> <span class="token function">dir</span> <span class="token punctuation">{</span> getattr search <span class="token function">open</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span> 
   allow httpd_sys_script_t user_home_dir_t <span class="token builtin class-name">:</span> lnk_file <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> getattr <span class="token punctuation">}</span> <span class="token punctuation">;</span>
   xxx
 <span class="token comment"># ä»ä¸Šé¢çš„æ•°æ®æ‰å¯ä»¥ç†è§£ï¼Œä¸»è¦æ˜¯æ”¾è¡Œ httpd_t èƒ½å¦è¯»å–ç”¨æˆ·å®¶ç›®å½•çš„æ–‡ä»¶ ï¼ˆç¬”è€…è¿™é‡Œæ˜¯æ‡µé€¼çš„æ²¡æœ‰çœ‹å‡ºæ¥ï¼‰</span>
 <span class="token comment"># æ‰€ä»¥ï¼Œå¦‚æœè¯¥è§„åˆ™æ²¡æœ‰å¯åŠ¨ï¼ŒåŸºæœ¬ä¸Š httpd_t è¿™ç§è¿›ç¨‹å°±æ— æ³•è¯»å–ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„æ–‡ä»¶</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¿®æ”¹-selinux-è§„åˆ™çš„å¸ƒå°”å€¼-setsebool" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹-selinux-è§„åˆ™çš„å¸ƒå°”å€¼-setsebool" aria-hidden="true">#</a> ä¿®æ”¹ SELinux è§„åˆ™çš„å¸ƒå°”å€¼ setsebool</h3><p>æŸ¥è¯¢åˆ°æŸä¸ª SELinux rule ï¼Œå¹¶ä¸”ä»¥ seaserch çŸ¥é“è¯¥è§„åˆ™çš„ç”¨é€”åï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥ç®¡ç†</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>setsebool <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token punctuation">[</span>è§„åˆ™åç§°<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">]</span>

-Pï¼šç›´æ¥å°†è®¾ç½®å€¼å†™å…¥é…ç½®æ–‡ä»¶ï¼Œè¯¥è®¾ç½®æ•°æ®æœªæ¥ä¼šç”Ÿæ•ˆ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šæŸ¥è¯¢ httpd_enable_homedirs è¿™ä¸ªè§„åˆ™çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¿®æ”¹è¿™ä¸ªè§„åˆ™ä¸ºä¸åŒçš„å¸ƒå°”å€¼</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># getsebool httpd_enable_homedirs</span>
httpd_enable_homedirs --<span class="token operator">&gt;</span> off			<span class="token comment"># å…³é—­çŠ¶æ€</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># setsebool -P httpd_enable_homedirs 1		# å¼€å¯å®ƒ</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># getsebool httpd_enable_homedirs</span>
httpd_enable_homedirs --<span class="token operator">&gt;</span> on

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ€-selinux-å®‰å…¨æœ¬æ–‡çš„ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#ğŸ€-selinux-å®‰å…¨æœ¬æ–‡çš„ä¿®æ”¹" aria-hidden="true">#</a> ğŸ€ SELinux å®‰å…¨æœ¬æ–‡çš„ä¿®æ”¹</h2><p>SELinux å¯¹å—é™çš„ä¸»ä½“è¿›ç¨‹æ²¡æœ‰å½±å“ï¼š</p><ol><li>è€ƒè™‘ SELinux çš„ä¸‰ç§ç±»å‹</li><li>è€ƒè™‘ SELinuxçš„æ”¿ç­–è§„åˆ™æ˜¯å¦æ”¾è¡Œ</li><li>æ¯”å¯¹ SELinux type å…³ç³»</li></ol><p>ä¸Šé¢è®²è§£è¿‡å¯ä»¥é€šè¿‡ sesearch æ¥æ‰¾åˆ°ä¸»ä½“è¿›ç¨‹ä¸æ–‡ä»¶çš„ SELinux type å…³ç³»ï¼Œé‚£ä¹ˆæ€ä¹ˆä¿®æ”¹æ–‡ä»¶çš„ SELinux typeï¼Œèƒ½è®©ä¸»ä½“è¿›ç¨‹è¯»åˆ°å‘¢ï¼Ÿ</p><h3 id="ä½¿ç”¨-chcon-æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„-selinux-type" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-chcon-æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„-selinux-type" aria-hidden="true">#</a> ä½¿ç”¨ chcon æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„ SELinux type</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>chcon <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span>-t type<span class="token punctuation">]</span> <span class="token punctuation">[</span>-u user<span class="token punctuation">]</span> <span class="token punctuation">[</span>-r role<span class="token punctuation">]</span> æ–‡ä»¶
chcon <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token parameter variable">--reference</span><span class="token operator">=</span>èŒƒä¾‹æ–‡ä»¶ æ–‡ä»¶

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Rï¼šè¿åŒè¯¥ç›®å½•ä¸‹çš„æ¬¡ç›®å½•ä¹ŸåŒæ—¶ä¿®æ”¹
	-tï¼šåé¢æ¥å®‰å…¨æ€§æœ¬æ–‡çš„ç±»å‹å­—æ®µï¼Œä¾‹å¦‚ httpd_sys_content_t
	-uï¼šåé¢æ¥èº«ä»½è¯†åˆ«ï¼Œä¾‹å¦‚ system_u <span class="token punctuation">(</span>ä¸é‡è¦<span class="token punctuation">)</span>
	-rï¼šåé¢æ¥è§’è‰²ï¼Œä¾‹å¦‚ system_r ï¼ˆä¸é‡è¦ï¼‰
	-vï¼šè‹¥æœ‰å˜åŒ–æˆåŠŸï¼Œå°†å˜åŠ¨çš„ç»“æœåˆ—å‡ºæ¥
	<span class="token parameter variable">--reference</span><span class="token operator">=</span>æ–‡ä»¶ï¼šæ‹¿æŸä¸ªæ–‡ä»¶æ¡£èŒƒä¾‹æ¥ä¿®æ”¹åç»­æ¥çš„æ–‡ä»¶çš„ç±»å‹
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šæŸ¥è¯¢ /etc/hosts çš„ SELinux typeï¼Œå¹¶å°†è¯¥ç±»å‹å¥—ç”¨åˆ° /etc/cron.d/checktime ä¸Š</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -Z /etc/hosts</span>
-rw-r--r--. root root system_u:object_r:net_conf_t:s0  /etc/hosts
<span class="token comment"># net_conf_t æ˜¯ä¸Šé¢æ–‡ä»¶ä¸­çš„ç±»å‹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chcon -v -t net_conf_t /etc/cron.d/checktime </span>
changing security context of <span class="token string">&#39;/etc/cron.d/checktime&#39;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -Z /etc/cron.d/checktime </span>
-rw-r--r--. root root unconfined_u:object_r:net_conf_t:s0 /etc/cron.d/checktime

<span class="token comment"># èŒƒä¾‹ 2ï¼šç›´æ¥ä»¥ /etc/shadow çš„ type å¥—ç”¨</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chcon -v --reference=/etc/shadow /etc/cron.d/checktime</span>
changing security context of <span class="token string">&#39;/etc/cron.d/checktime&#39;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -Z /etc/shadow /etc/cron.d/checktime </span>
-rw-r--r--. root root system_u:object_r:shadow_t:s0    /etc/cron.d/checktime
----------. root root system_u:object_r:shadow_t:s0    /etc/shadow

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç¤ºä¾‹å¹¶ä¸èƒ½è§£å†³ crond ä¸èƒ½è¯»å– <code>/etc/cron.d/checktime</code> çš„é—®é¢˜ï¼Œå› ä¸ºéœ€è¦æ”¹æˆ <code>/etc/cron.d</code> ä¸‹çš„æ ‡å‡† type æ‰è¡Œã€‚å¯ä»¥ä½¿ç”¨ restorecon æ¥è®© SELinux è‡ªå·±é»˜è®¤è§£å†³ç›®å½•ä¸‹çš„ type é—®é¢˜</p><h3 id="ä½¿ç”¨-restorecon-è®©æ–‡ä»¶æ¢å¤æ­£ç¡®çš„-selinux-type" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-restorecon-è®©æ–‡ä»¶æ¢å¤æ­£ç¡®çš„-selinux-type" aria-hidden="true">#</a> ä½¿ç”¨ restorecon è®©æ–‡ä»¶æ¢å¤æ­£ç¡®çš„ SELinux type</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>restorecon <span class="token punctuation">[</span>-Rv<span class="token punctuation">]</span> æ–‡ä»¶æˆ–ç›®å½•

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Rï¼šè¿åŒæ¬¡ç›®å½•ä¸€èµ·ä¿®æ”¹
	-vï¼šå°†è¿‡ç¨‹æ˜¾ç¤ºåˆ°å±å¹•ä¸Š
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 3ï¼šå°† /etc/cron.d/ ä¸‹çš„æ–‡ä»¶éƒ½æ¢å¤æˆé¢„è®¾çš„ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># restorecon -Rv /etc/cron.d/</span>
restorecon reset /etc/cron.d/checktime context system_u:object_r:shadow_t:s0-<span class="token operator">&gt;</span>system_u:object_r:system_cron_spool_t:s0

<span class="token comment"># ä¸Šé¢å°†  shadow_t æ”¹æˆäº† system_cron_spool_t ç±»å‹</span>

<span class="token comment"># èŒƒä¾‹ 4ï¼šé‡æ–°å¯åŠ¨ crond çœ‹çœ‹æœ‰æ²¡æœ‰æ­£ç¡®å¯åŠ¨ checktime</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart crond          </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># tail /var/log/cron</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:01:01 study CROND<span class="token punctuation">[</span><span class="token number">5886</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> CMD <span class="token punctuation">(</span>run-parts /etc/cron.hourly<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:01:01 study run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5886</span><span class="token punctuation">]</span>: starting 0anacron
Mar <span class="token number">17</span> <span class="token number">16</span>:01:01 study run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5898</span><span class="token punctuation">]</span>: finished 0anacron
Mar <span class="token number">17</span> <span class="token number">16</span>:01:01 study run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5886</span><span class="token punctuation">]</span>: starting mcelog.cron
Mar <span class="token number">17</span> <span class="token number">16</span>:01:01 study run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5904</span><span class="token punctuation">]</span>: finished mcelog.cron
Mar <span class="token number">17</span> <span class="token number">16</span>:10:01 study CROND<span class="token punctuation">[</span><span class="token number">5989</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> CMD <span class="token punctuation">(</span>/usr/lib64/sa/sa1 <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:12:48 study crond<span class="token punctuation">[</span><span class="token number">4073</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>Shutting down<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:12:48 study crond<span class="token punctuation">[</span><span class="token number">6068</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>RANDOM_DELAY will be scaled with factor <span class="token number">62</span>% <span class="token keyword">if</span> used.<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:12:49 study crond<span class="token punctuation">[</span><span class="token number">6068</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>running with inotify support<span class="token punctuation">)</span>
Mar <span class="token number">17</span> <span class="token number">16</span>:12:49 study crond<span class="token punctuation">[</span><span class="token number">6068</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>@reboot <span class="token function">jobs</span> will be run at computer&#39;s startup.<span class="token punctuation">)</span>
<span class="token comment"># æ²¡æœ‰æŠ¥é”™ä¿¡æ¯</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»è¿™é‡Œçœ‹æ¥ restorecon å¾ˆæ–¹ä¾¿ï¼Œchcon è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„</p><h3 id="semanage-é»˜è®¤ç›®å½•çš„å®‰å…¨æ€§æœ¬æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#semanage-é»˜è®¤ç›®å½•çš„å®‰å…¨æ€§æœ¬æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹" aria-hidden="true">#</a> semanage é»˜è®¤ç›®å½•çš„å®‰å…¨æ€§æœ¬æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹</h3><p>ä¸ºä»€ä¹ˆ restorecon å¯ä»¥æ¢å¤åŸæœ¬çš„ SELinux type å‘¢ï¼Ÿé‚£ä¸€å®šæ˜¯æœ‰ä¸ªåœ°æ–¹åœ¨è®°å½•æ¯ä¸ªæ–‡ä»¶/ç›®å½•çš„ SELinux é»˜è®¤ç±»å‹</p><ol><li>å¦‚ä½•æŸ¥è¯¢é¢„è®¾çš„ SELinux type</li><li>å¦‚ä½•å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ é¢„è®¾çš„ SELinux type</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>semanage <span class="token punctuation">{</span>login<span class="token operator">|</span>user<span class="token operator">|</span>port<span class="token operator">|</span>interface<span class="token operator">|</span>fcontext<span class="token operator">|</span>translation<span class="token punctuation">}</span> <span class="token parameter variable">-l</span>
semanage fcontext -<span class="token punctuation">{</span>a<span class="token operator">|</span>d<span class="token operator">|</span>m<span class="token punctuation">}</span> <span class="token punctuation">[</span>-frst<span class="token punctuation">]</span> file_spec

é€‰é¡¹ä¸å‚æ•°ï¼š
	fcontextï¼šä¸»è¦ç”¨åœ¨å®‰å…¨æ€§æœ¬æ–‡æ–¹é¢çš„ç”¨é€”ï¼Œ <span class="token parameter variable">-l</span> ä¸ºæŸ¥è¯¢
	-aï¼šå¢åŠ ï¼›å¯ä»¥å¢åŠ ä¸€äº›ç›®å½•çš„é»˜è®¤å®‰å…¨æ€§æœ¬æ–‡ç±»å‹è®¾ç½®
	-mï¼šä¿®æ”¹
	-dï¼šåˆ é™¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># èŒƒä¾‹ 1ï¼šæŸ¥è¯¢ /etc/   /etc/cron.d/ çš„é¢„è®¾ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage fcontext -l | grep -E &#39;^/etc |^/etc/cron&#39;</span>
/etc/cron.daily<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                              all files          system_u:object_r:bin_t:s0 
/etc/cron.weekly<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                             all files          system_u:object_r:bin_t:s0 
/etc/cron.hourly<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                             all files          system_u:object_r:bin_t:s0 
/etc/cron.monthly<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                            all files          system_u:object_r:bin_t:s0 
/etc/cron.minutely/openshift-facts                 regular <span class="token function">file</span>       system_u:object_r:openshift_cron_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>monthly<span class="token punctuation">)</span>/acct                    regular <span class="token function">file</span>       system_u:object_r:acct_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>weekly<span class="token punctuation">)</span>/sysklogd                 regular <span class="token function">file</span>       system_u:object_r:logrotate_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>monthly<span class="token punctuation">)</span>/mailman                 regular <span class="token function">file</span>       system_u:object_r:mailman_queue_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>weekly<span class="token punctuation">)</span>/man-db.*                 regular <span class="token function">file</span>       system_u:object_r:mandb_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>monthly<span class="token punctuation">)</span>/radiusd                 regular <span class="token function">file</span>       system_u:object_r:radiusd_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>weekly<span class="token punctuation">)</span>/ntp-simple               regular <span class="token function">file</span>       system_u:object_r:ntpd_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token punctuation">(</span>daily<span class="token operator">|</span>weekly<span class="token punctuation">)</span>/ntp-server               regular <span class="token function">file</span>       system_u:object_r:ntpd_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.<span class="token variable"><span class="token punctuation">((</span>daily<span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>weekly<span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>monthly<span class="token punctuation">))</span></span>/freeradius regular <span class="token function">file</span>       system_u:object_r:radiusd_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.d<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                                 all files          system_u:object_r:system_cron_spool_t:s0 
/etc/cron<span class="token punctuation">\\</span>.daily/<span class="token punctuation">[</span>sm<span class="token punctuation">]</span>locate                        regular <span class="token function">file</span>       system_u:object_r:locate_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.weekly/<span class="token punctuation">(</span>c<span class="token punctuation">)</span>?fingerd                      regular <span class="token function">file</span>       system_u:object_r:fingerd_exec_t:s0 
/etc                                               all files          system_u:object_r:etc_t:s0 
/etc/crontab                                       regular <span class="token function">file</span>       system_u:object_r:system_cron_spool_t:s0 
/etc/cron<span class="token punctuation">\\</span>.daily/prelink                           regular <span class="token function">file</span>       system_u:object_r:prelink_cron_system_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.daily/calamaris                         regular <span class="token function">file</span>       system_u:object_r:calamaris_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.daily/certwatch                         regular <span class="token function">file</span>       system_u:object_r:certwatch_exec_t:s0 
/etc/cron<span class="token punctuation">\\</span>.monthly/proftpd                         regular <span class="token function">file</span>       system_u:object_r:ftpd_exec_t:s0

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹ <code>/etc/cron\\.d(/.*)? all files system_u:object_r:system_cron_spool_t:s0</code> è¿™ä¸€è¡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç›´æ¥ä½¿ç”¨ vim åœ¨ <code>/etc/cron.d</code> ä¸‹æ–°å»ºæ–‡ä»¶æ—¶ï¼Œé¢„è®¾ SELinux type æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç»ƒä¹ ï¼šä¸‹é¢è¦å»ºç«‹ä¸€ä¸ª <code>/srv/mycron</code> ç›®å½•ï¼Œé»˜è®¤ä¹Ÿæ˜¯éœ€è¦å˜æˆ <code>system_cron_spool_t</code> æ—¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å…ˆå»ºç«‹ mycron ç›®å½•ï¼Œå†æ”¾å…¥é…ç½®æ–‡ä»¶ï¼Œè§‚å¯Ÿ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /srv/mycron</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/cron.d/checktime /srv/mycron/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -dZ /srv/mycron/ /srv/mycron/checktime </span>
drwxr-xr-x. root root unconfined_u:object_r:var_t:s0   /srv/mycron/
-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /srv/mycron/checktime
<span class="token comment"># å‘ç°å˜æˆäº† var_t</span>

<span class="token comment"># 2. è§‚å¯Ÿä¸Šå±‚ /srv çš„ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage fcontext -l | grep &#39;^/srv&#39;</span>
/srv/.*                                            all files          system_u:object_r:var_t:s0 
/srv/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>*/<span class="token punctuation">)</span>?www<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                            all files          system_u:object_r:httpd_sys_content_t:s0 
/srv/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>*/<span class="token punctuation">)</span>?ftp<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                            all files          system_u:object_r:public_content_t:s0 
/srv/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>*/<span class="token punctuation">)</span>?rsync<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                          all files          system_u:object_r:public_content_t:s0 
/srv/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>*/<span class="token punctuation">)</span>?www/logs<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                       all files          system_u:object_r:httpd_log_t:s0 
/srv/node<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                                    all files          system_u:object_r:swift_data_t:s0 
/srv/gallery2<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                                all files          system_u:object_r:httpd_sys_content_t:s0 
/srv/lib/gitosis<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                             all files          system_u:object_r:gitosis_var_lib_t:s0 
/srv/gallery2/smarty<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                         all files          system_u:object_r:httpd_sys_rw_content_t:s0 
/srv/loopback-device<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                         all files          system_u:object_r:swift_data_t:s0 
/srv                                               all files          system_u:object_r:var_t:s0
<span class="token comment"># å¯ä»¥çœ‹åˆ°è¿™é‡Œé»˜è®¤å°±æ˜¯  var_t ç±»å‹çš„</span>

<span class="token comment"># 3. å°† mycron é»˜è®¤å€¼æ”¹ä¸º system_cron_spool_t</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage fcontext -a -t system_cron_spool_t &quot;/srv/mycron(/.*)?&quot;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage fcontext -l | grep &#39;^/srv/mycron&#39;</span>
/srv/mycron<span class="token punctuation">(</span>/.*<span class="token punctuation">)</span>?                                  all files          system_u:object_r:system_cron_spool_t:s0 

<span class="token comment"># 4. å›å¤ /srv/mycron ä»¥åŠå­ç›®å½•ç›¸å…³çš„ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># restorecon -Rv /srv/mycron/</span>
restorecon reset /srv/mycron context unconfined_u:object_r:var_t:s0-<span class="token operator">&gt;</span>unconfined_u:object_r:system_cron_spool_t:s0
restorecon reset /srv/mycron/checktime context unconfined_u:object_r:var_t:s0-<span class="token operator">&gt;</span>unconfined_u:object_r:system_cron_spool_t:s0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªä¾‹å­æ¥çœ‹ï¼Œrestorecon çš„ç¡®æ˜¯å¾ˆæ–¹ä¾¿ ï¼Œå­¦ä¼šè¿™äº›åŸºç¡€çš„å·¥å…·ï¼Œå¯¹äº SELinux æ¥è¯´åŸºæœ¬ä¸Šä¹Ÿå¤Ÿç”¨äº†</p><h2 id="ğŸ€-ä¸€ä¸ªç½‘ç»œæœåŠ¡æ¡ˆä¾‹åŠç™»å½•æ–‡ä»¶ååŠ©" tabindex="-1"><a class="header-anchor" href="#ğŸ€-ä¸€ä¸ªç½‘ç»œæœåŠ¡æ¡ˆä¾‹åŠç™»å½•æ–‡ä»¶ååŠ©" aria-hidden="true">#</a> ğŸ€ ä¸€ä¸ªç½‘ç»œæœåŠ¡æ¡ˆä¾‹åŠç™»å½•æ–‡ä»¶ååŠ©</h2><p>æœ¬ç« åœ¨ SELinux å°èŠ‚ä¸­ä»‹ç»åˆ°çš„å„ä¸ªæŒ‡ä»¤ï¼Œå°¤å…¶æ˜¯ setseboolã€chconã€restorecon ç­‰éƒ½æ˜¯ä¸ºäº†å½“ä½ çš„æŸäº›ç½‘ç»œæœåŠ¡æ— æ³•æ­£å¸¸æä¾›ç›¸å…³åŠŸèƒ½æ—¶ï¼Œæ‰éœ€è¦è¿›è¡Œä¿®æ”¹çš„ä¸€äº›æŒ‡ä»¤åŠ¨ä½œã€‚</p><p>å¯ä»¥é€šè¿‡ä¸»åŠ¨æ£€æŸ¥çš„æ–¹å¼æ¥æ£€æŸ¥æ˜¯å¦æœ‰ SELinux äº§ç”Ÿçš„é”™è¯¯ã€‚è€Œä¸æ˜¯ç­‰å®¢æˆ·ç«¯è”æœºå¤±è´¥æ¥åé¦ˆ</p><h3 id="setroubleshoot-é”™è¯¯ä¿¡æ¯å†™å…¥-var-log-messages" tabindex="-1"><a class="header-anchor" href="#setroubleshoot-é”™è¯¯ä¿¡æ¯å†™å…¥-var-log-messages" aria-hidden="true">#</a> setroubleshootï¼šé”™è¯¯ä¿¡æ¯å†™å…¥ <code>/var/log/messages</code></h3><p>å‡ ä¹æ‰€æœ‰ SELinux ç›¸å…³çš„ç¨‹åºéƒ½æ˜¯ä»¥ se å¼€å¤´ï¼Œè¯¥æœåŠ¡æ—¶é”™è¯¯å…‹æœï¼Œå¯åŠ¨åï¼Œä¼šå°†å…³äº SELinux çš„é”™è¯¯ä¿¡æ¯ä¸å…‹æœæ–¹æ³•è®°å½•åˆ° <code>/var/log/messages</code> ä¸ <code>/var/log/setroubleshoot/*</code> ä¸­</p><p>éœ€è¦å®‰è£…ï¼šsetroubleshoot ä¸ setroubleshoot-serverã€‚åŸæœ¬ SELinux ä¿¡æ¯æ˜¯ä¸¤ä¸ªæœåŠ¡æ¥è®°å½•çš„ï¼Œåˆ†åˆ«æ˜¯ auditd ä¸ setroubleshootã€‚åœ¨ CentOS 6.x èµ·æ•´åˆæˆ auditd äº†ã€‚æ‰€ä»¥å®‰è£…å¥½ setroubleshoot-server åï¼Œéœ€è¦é‡æ–°å¯åŠ¨ auditd æœåŠ¡ï¼Œå¦åˆ™ setroubleshoot åŠŸèƒ½ä¸ä¼šè¢«å¯åŠ¨</p><p>å®é™…ä¸Šã€‚CentOS 7.x å¯¹ setroubleshoot çš„è¿è¡Œæ–¹å¼æ˜¯ï¼šå…ˆç”± auditd å»å‘¼å« audispd æœåŠ¡ï¼Œç„¶å audispd æœåŠ¡å¯åŠ¨ sedispatch ç¨‹åºï¼Œ sedispatch å†å°†åŸæœ¬çš„ auditd ä¿¡æ¯è½¬æˆ setroubleshoot çš„ä¿¡æ¯ï¼Œå­˜å‚¨ä¸‹æ¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep setroubleshoot</span>
setroubleshoot-3.2.30-7.el7.x86_64
setroubleshoot-plugins-3.0.67-4.el7.noarch
setroubleshoot-server-3.2.30-7.el7.x86_64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨é¢„è®¾çš„æƒ…å†µä¸‹ setroubleshoot è¢«å®‰è£…äº†ï¼Œè®°å¾—åˆšå®‰è£… setroubleshoot çš„è¯ï¼Œéœ€è¦é‡æ–°å¯åŠ¨ auditd æœåŠ¡çš„ã€</p><p>ç›®å‰æˆ‘ä»¬æ²¡æœ‰ä»»ä½•å—é™çš„ç½‘ç»œæœåŠ¡ä¸»ä½“è¿›ç¨‹åœ¨è¿è¡Œï¼Œä¸‹é¢ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ FTP æœåŠ¡å™¨è½¯ä»¶ç¤ºä¾‹ï¼Œæ¥äº†è§£ä¸Šé¢è®²åˆ°çš„è®¸å¤šé‡ç‚¹åº”ç”¨</p><h3 id="å®ä¾‹è¯´æ˜-é€šè¿‡-vsftpd-è¿™ä¸ª-ftp-æœåŠ¡å™¨æ¥å­˜å–ç³»ç»Ÿä¸Šçš„æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è¯´æ˜-é€šè¿‡-vsftpd-è¿™ä¸ª-ftp-æœåŠ¡å™¨æ¥å­˜å–ç³»ç»Ÿä¸Šçš„æ–‡ä»¶" aria-hidden="true">#</a> å®ä¾‹è¯´æ˜ï¼šé€šè¿‡ vsftpd è¿™ä¸ª FTP æœåŠ¡å™¨æ¥å­˜å–ç³»ç»Ÿä¸Šçš„æ–‡ä»¶</h3><p>åœ¨ CentOS 7.x ç¯å¢ƒä¸‹ï¼Œ FTP çš„é»˜è®¤æœåŠ¡å™¨è½¯ä»¶ä¸»è¦æ˜¯ vsftpd</p><p>è¯¦ç»†çš„ FTP åè®®åœ¨æœåŠ¡å™¨ç¯‡è®²è§£ï¼Œè¿™é‡Œç®€å•åˆ©ç”¨ vsftpd ä¸ FTP çš„åè®®æ¥è®²è§£ SELinux çš„é—®é¢˜ä¸é”™è¯¯å…‹æœã€‚</p><p>ä¸‹é¢åªæ¥å—ä¸€äº›ç®€å•çš„ FTP çŸ¥è¯†ï¼šå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨ FTP è´¦æˆ·ç™»å½• FTP æœåŠ¡å™¨ï¼Œæœ‰ä¸€ä¸ªç§°ä¸ºã€ŒåŒ¿å ï¼ˆanonymousï¼‰ã€çš„è´¦æˆ·å¯ä»¥ç™»å½•ç³»ç»Ÿï¼Œä½†æ˜¯è¿™ä¸ªåŒ¿åçš„è´¦æˆ·ç™»å½•åï¼Œåªèƒ½å­˜å–ä¸€ä¸ªç‰¹å®šçš„ç›®å½•ï¼Œè€Œæ— æ³•è„±ç¦»è¯¥ç›®å½•</p><p>åœ¨ vsftpd ä¸­ï¼Œä¸€èˆ¬ç”¨æˆ·ä¸åŒ¿åè€…çš„å®¶ç›®å½•è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>åŒ¿åè€…ï¼šå¦‚æœä½¿ç”¨æµè§ˆå™¨æ¥è”æœºåˆ° FTP æœåŠ¡å™¨ï¼Œé‚£é¢„è®¾å°±æ˜¯ä½¿ç”¨åŒ¿åè€…ç™»å½•ç³»ç»Ÿã€‚åŒ¿åè€…çš„å®¶ç›®å½•é»˜è®¤æ˜¯åœ¨ <code>/var/ftp</code> ä¸­ï¼ŒåŒæ—¶ï¼ŒåŒ¿åè€…åœ¨å®¶ç›®å½•ä¸‹åªèƒ½ä¸‹è½½æ•°æ®ï¼Œä¸èƒ½ä¸Šä¼ æ•°æ®åˆ° FTP æœåŠ¡å™¨ï¼ŒåŒæ—¶åŒ¿åè€…æ— æ³•ç¦»å¼€ FTP æœåŠ¡å™¨çš„ <code>/var/ftp</code> ç›®å½•</li><li>ä¸€èˆ¬ FTP è´¦æˆ·ï¼šåœ¨é¢„è®¾æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ UID å¤§äº 1000 çš„è´¦æˆ·ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ FTP æ¥ç™»å½•ç³»ç»Ÿï¼Œç™»å½•ç³»ç»Ÿåï¼Œæ‰€æœ‰çš„è´¦æˆ·éƒ½èƒ½å¤Ÿå–å¾—è‡ªå·±å®¶ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°æ®ï¼Œé¢„è®¾ä¹Ÿå¯ä»¥ä¸Šä¼ ã€ä¸‹è½½æ–‡ä»¶çš„</li></ul><p>ä¸ºäº†é¿å…ä¸ä¹‹å‰ç« èŠ‚çš„ç”¨æˆ·äº§ç”Ÿè¯¯è§£æƒ…å†µï¼Œåˆ›å»ºä¸€ä¸ªåä¸º ftptest çš„è´¦æˆ·ï¼Œä¸”è´¦æˆ·å¯†ç ä¸º myftp123</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># useradd -s /sbin/nologin ftptest</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;myftp123&quot; | passwd --stdin ftptest</span>
Changing password <span class="token keyword">for</span> user ftptest.
passwd: all authentication tokens updated successfully.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ¥å®‰è£… vsftp æœåŠ¡å™¨è½¯ä»¶ï¼ˆè¿˜æ˜¯åœ¨å…‰ç›˜ä¸­å®‰è£…ï¼Œå‰é¢æŒ‚è½½é‚£æ ·ï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># yum install /mnt/Packages/vsftpd-3*                    </span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl start vsftpd		# å¯åŠ¨ vsftpd æœåŠ¡</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable vsftpd		# è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># netstat -tlnp</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:631           <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1374</span>/cupsd          
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:25            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1578</span>/master         
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:6010          <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">2350</span>/sshd: mrcode@p 
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:111             <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1</span>/systemd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">192.168</span>.122.1:53        <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1975</span>/dnsmasq        
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1378</span>/sshd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:631                 :::*                    LISTEN      <span class="token number">1374</span>/cupsd          
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:25                  :::*                    LISTEN      <span class="token number">1578</span>/master         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:6010                :::*                    LISTEN      <span class="token number">2350</span>/sshd: mrcode@p 
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::111                  :::*                    LISTEN      <span class="token number">1</span>/systemd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::21                   :::*                    LISTEN      <span class="token number">6656</span>/vsftpd         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      <span class="token number">1378</span>/sshd

<span class="token comment"># å¯ä»¥çœ‹åˆ°   6656/vsftpd è¿™è¡Œæ•°æ®ï¼Œä»£è¡¨å·²ç»å¯åŠ¨äº†</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŒ¿åè€…æ— æ³•ä¸‹è½½çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åŒ¿åè€…æ— æ³•ä¸‹è½½çš„é—®é¢˜" aria-hidden="true">#</a> åŒ¿åè€…æ— æ³•ä¸‹è½½çš„é—®é¢˜</h3><p>æ¨¡æ‹Ÿä¸€äº› FTP çš„å¸¸ç”¨çŠ¶æ€ï¼Œå‡è®¾å°† <code>/etc/securetty</code> ä»¥åŠä¸»è¦çš„ <code>/etc/sysctl.conf</code> æ”¾ç½®ç»™æ‰€æœ‰äººä¸‹è½½ï¼Œé‚£ä¹ˆå¯ä»¥èƒ½ä¼šè¿™æ ·åš</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /var/ftp/pub/</span>
total <span class="token number">8</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">221</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> securetty
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">449</span> Aug  <span class="token number">9</span>  <span class="token number">2019</span> sysctl.conf

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤è¦ç»™ç”¨æˆ·ä¸‹è½½çš„ FTP æ–‡ä»¶ä¼šæ”¾åœ¨ <code>/var/ftp/pub</code> ç›®å½•ä¸­ã€‚ä¸‹é¢ä½¿ç”¨ç®€å•çš„ç»ˆç«¯æœºæµè§ˆå™¨ curl æ¥è§‚å¯Ÿ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. æŸ¥çœ‹ FTP æ ¹ç›®å½•ä¸‹æœ‰å“ªäº›å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">42</span> Mar <span class="token number">17</span> 09:03 pub
<span class="token comment"># ç¡®å®çœ‹åˆ°äº† pub ç›®å½•</span>

<span class="token comment"># 2. æŸ¥çœ‹ pub ç›®å½•å†…çš„å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost/pub</span>
curl: <span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">)</span> RETR response: <span class="token number">550</span>
<span class="token comment"># æ— æ³•è®¿é—®ï¼Œæ˜¯å› ä¸º pub æ˜¯ä¸€ä¸ªç›®å½•éœ€è¦åç¼€ / ç»“å°¾</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost/pub/</span>
-rw-------    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">221</span> Oct <span class="token number">30</span>  <span class="token number">2018</span> securetty
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">449</span> Aug 08  <span class="token number">2019</span> sysctl.conf

<span class="token comment"># 3. æŸ¥çœ‹é‡Œé¢çš„æ–‡ä»¶å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost/pub/sysctl.conf</span>
<span class="token comment"># sysctl settings are defined through files in</span>
<span class="token comment"># /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span>
<span class="token comment">#</span>
<span class="token comment"># Vendors settings live in /usr/lib/sysctl.d/.</span>
<span class="token comment"># To override a whole file, create a new file with the same in</span>
<span class="token comment"># /etc/sysctl.d/ and put new settings there. To override</span>
<span class="token comment"># only specific settings, add a file with a lexically later</span>
<span class="token comment"># name in /etc/sysctl.d/ and put new settings there.</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, see sysctl.conf(5) and sysctl.d(5).</span>

<span class="token comment"># ä¸Šé¢ä¸æ˜¯é”™è¯¯ä¿¡æ¯ï¼Œæ˜¯å“ªä¸ªæ–‡ä»¶çš„å†…å®¹</span>

<span class="token comment"># 4. ç»§ç»­æŸ¥çœ‹ä¸‹ä¸€ä¸ªæ–‡ä»¶å†…å®¹</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost/pub/securetty  </span>
curl: <span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">)</span> RETR response: <span class="token number">550</span>
<span class="token comment"># è¿™é‡Œçœ‹ä¸åˆ°äº†ï¼Œä½†æ˜¯ securetty çš„ç¡®æ˜¯ä¸€ä¸ªæ–‡ä»¶è€Œä¸æ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŸºæœ¬åŸå› åº”è¯¥æ˜¯æƒé™é—®é¢˜</span>
<span class="token comment"># å› ä¸º vsftpd é»˜è®¤æ”¾åœ¨ /var/ftp/pub å†…çš„èµ„æ–™ï¼Œæ— è®ºä»€ä¹ˆ SELinux type å‡ ä¹éƒ½å¯ä»¥è¢«è¯»å–æ‰å¯¹</span>

<span class="token comment"># 5. ä¿®æ­£æƒé™åï¼Œå†è§‚å¯Ÿä¸€æ¬¡ securetty æ–‡ä»¶</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll /var/ftp/pub/</span>
total <span class="token number">8</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">221</span> Oct <span class="token number">31</span>  <span class="token number">2018</span> securetty
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">449</span> Aug  <span class="token number">9</span>  <span class="token number">2019</span> sysctl.conf
<span class="token comment"># å¯ä»¥çœ‹åˆ° securetty çš„å…¶ä»–äººæƒé™æ²¡æœ‰ã€‚æ”¹å˜æˆå…¶ä»–äººä¹Ÿå¯ä»¥è¯»å–</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chmod a+r /var/ftp/pub/securetty </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost/pub/securetty</span>
console
vc/1
vc/2
vc/3
<span class="token comment"># æ­¤æ—¶å·²ç»èƒ½çœ‹åˆ°æ–‡ä»¶å†…å®¹äº†</span>

<span class="token comment"># 6. ä¿®æ­£ SELinux type çš„å†…å®¹ï¼ˆéå¿…é¡»ï¼‰</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># restorecon -Rv /var/ftp/</span>
restorecon reset /var/ftp/pub/securetty context system_u:object_r:etc_runtime_t:s0-<span class="token operator">&gt;</span>system_u:object_r:public_content_t:s0
restorecon reset /var/ftp/pub/sysctl.conf context system_u:object_r:system_conf_t:s0-<span class="token operator">&gt;</span>system_u:object_r:public_content_t:s0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°åˆ—å­å‘Šè¯‰æˆ‘ä»¬ï¼Œè¦å…ˆä»æƒé™è§’åº¦æ¥æ£€æŸ¥ï¼Œå¦‚æœæ— æ³•è¢«è¯»å– ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰ r æˆ–åˆ™æ²¡æœ‰ rx æƒé™ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ SELinux å¼•èµ·çš„ã€‚ä¸‹é¢çœ‹çœ‹ç”¨ä¸€èˆ¬è´¦æˆ·ç™»å½•</p><h3 id="æ— æ³•ä»å®¶ç›®å½•ä¸‹è½½æ–‡ä»¶çš„é—®é¢˜åˆ†æä¸è§£å†³" tabindex="-1"><a class="header-anchor" href="#æ— æ³•ä»å®¶ç›®å½•ä¸‹è½½æ–‡ä»¶çš„é—®é¢˜åˆ†æä¸è§£å†³" aria-hidden="true">#</a> æ— æ³•ä»å®¶ç›®å½•ä¸‹è½½æ–‡ä»¶çš„é—®é¢˜åˆ†æä¸è§£å†³</h3><p>ç”±äºé€šè¿‡ä¸€èˆ¬è´¦æˆ·ï¼Œå‰é¢å»ºç«‹çš„ ftptest è´¦æˆ·ç™»å½•çš„è¯ï¼Œæ–‡å­—å‹çš„ FTP å®¢æˆ·ç«¯è½¯ä»¶ï¼Œé»˜è®¤ä¼šå°†ç”¨æˆ·å¼•å¯¼åœ¨æ ¹ç›®å½•ï¼Œè€Œä¸æ˜¯å®¶ç›®å½•ï¼Œå› æ­¤ï¼Œè®¿é—®çš„ URL éœ€è¦æ›´æ”¹ä¸€ä¸‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 0. åœ¨ ftptest å®¶ç›®å½•ä¸‹åˆ›å»ºä¸€äº›æ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># echo  ~ftptest/</span>
/home/ftptest/
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;testing&quot; &gt;  ~ftptest/test.txt</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cp -a /etc/hosts /etc/sysctl.conf ~ftptest/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll ~ftptest/</span>
total <span class="token number">12</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">158</span> Jun  <span class="token number">7</span>  <span class="token number">2013</span> hosts
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">449</span> Aug  <span class="token number">9</span>  <span class="token number">2019</span> sysctl.conf
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">8</span> Mar <span class="token number">17</span> <span class="token number">17</span>:23 test.txt

<span class="token comment"># 1. ä¸€èˆ¬è´¦æˆ·ç›´æ¥ç™»å½• FTP æœåŠ¡å™¨ï¼ŒåŒæ—¶å˜æ¢ç›®å½•åˆ°å®¶ç›®å½•</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost/~/</span>
curl: <span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span> Access denied: <span class="token number">530</span>			<span class="token comment"># è¿™é‡ŒæŠ¥é”™äº†</span>
<span class="token comment"># æ³¨æ„ï¼šä¹¦ä¸Šåœ¨å¢åŠ  ftptest ç”¨æˆ·çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ /sbin/nologinï¼Œå°±æ— æ³•è®¿é—® ftpï¼Œè¿™é‡Œä¿®æ”¹ä¸‹ï¼Œå°±å¯ä»¥äº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># usermod -s  /bin/bash ftptest</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost/~/</span>
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">158</span> Jun 07  <span class="token number">2013</span> hosts
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>             <span class="token number">449</span> Aug 08  <span class="token number">2019</span> sysctl.conf
-rw-r--r--    <span class="token number">1</span> <span class="token number">0</span>        <span class="token number">0</span>               <span class="token number">8</span> Mar <span class="token number">17</span> 09:23 test.txt
<span class="token comment"># çœ‹å·¦è¾¹çš„æƒé™ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„</span>
<span class="token comment"># ä»è¿™é‡Œå¼€å§‹ï¼Œç¬”è€…çš„å®éªŒå’Œä¹¦ä¸Šçš„ç»“æœå¯¹ä¸ä¸Šäº†ï¼Œä¸‹é¢åªè®°å½•ä¹¦ä¸Šçš„æ“ä½œæŒ‡ä»¤</span>
<span class="token comment"># å°±æ˜¯å› ä¸ºä¸Šé¢ä¿®æ”¹ç”¨æˆ·çš„ bash åï¼Œè™½ç„¶å¯ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯ä¸‹é¢çš„å´å¯ä»¥ä¸‹è½½æ–‡ä»¶ï¼Œæ— æ³•è¾¾åˆ°å’Œä¹¦ä¸Šçš„æ•ˆæœä¸€æ ·</span>

<span class="token comment"># 2. ä¸‹è½½ä¸Šé¢å¯ä»¥é˜…è¯»çš„æƒé™æ–‡ä»¶</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost/~/test.txt</span>
curl:<span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">)</span> RETR response:550
<span class="token comment"># æ— æ³•è®¿ä¸‹è½½ï¼Œæ˜¯å¦æ˜¯ SELinux é€ æˆçš„ï¼Ÿ</span>

<span class="token comment"># 3. å°† SELinux ä» Enforce è½¬æˆ Permissive </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost/~/test.txt</span>
testing
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># setenforce 1	# ç¡®å®šæ˜¯ SELinux æƒé™é—®é¢˜åï¼Œæ”¹å›æ¥</span>
<span class="token comment"># éœ€è¦è¯¥è§„åˆ™è¿˜æ˜¯è¯¥ typeï¼Ÿç°åœ¨ä¸çŸ¥é“</span>
<span class="token comment"># æ‰€ä»¥å…ˆæŸ¥è¯¢ä¸‹ç™»å½•æ—¥å¿—æœ‰æ²¡æœ‰ç›¸å…³çš„ä¿¡æ¯æä¾›ç»™æˆ‘ä»¬å¤„ç†</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /var/log/messages</span>
Aug <span class="token number">9</span> 02:55:58 station3-39 setroubleshoot:SELinux is preventing /usr/sbin/vsftpd
	from lock access on the <span class="token function">file</span> /home/ftptest/test.txt. For complete SELinux messages.
	run sealert <span class="token parameter variable">-l</span> 3axxxxxxxx
<span class="token comment"># ä¹‹ç±»çš„å­—æ ·ï¼Œå…³é”®è¯å°±æ˜¯ sealert ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sealert -l 3axxxxxxxx</span>
SELinux is preventing /usr/sbin/vsftpd from lock access on the <span class="token function">file</span> /home/ftptest/test/txt.
<span class="token comment"># ä¸‹é¢è¯´æœ‰ 47.5% çš„å‡ ç‡æ˜¯ç”±äºè¿™ä¸ªåŸå› æ‰€å‘ç”Ÿï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ setsebool å»è§£å†³çš„æ„æ€</span>
******* Plugin catchall_boolean<span class="token punctuation">(</span><span class="token number">47.5</span> confidence<span class="token punctuation">)</span> suggests ********

<span class="token keyword">if</span> you want to allow <span class="token function">ftp</span> to home <span class="token function">dir</span>
<span class="token punctuation">..</span>.
Do
setsebool <span class="token parameter variable">-P</span> ftp_home_dir <span class="token number">1</span>

******* Plugin catchall<span class="token punctuation">(</span><span class="token number">6</span>.38confidence<span class="token punctuation">)</span> suggests ********
DO
<span class="token comment"># grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol</span>
<span class="token comment"># semodule -i mypol.pp</span>

<span class="token comment"># ä¸‹é¢å°±é‡è¦äº†ï¼Œæ˜¯æ•´ä¸ªé—®é¢˜å‘ç”Ÿçš„ä¸»è¦åŸå› </span>
Additional Information:
Source Context	system_u:system_r:ftpd_t:s0-s0:c0.c1023
Target Context	unconfined_u:object_r:user_home_t:s0
Target Objects	/home/ftptest/test/txt <span class="token punctuation">[</span> <span class="token function">file</span> <span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼ŒçŸ¥é“ä¸»è¦çš„é—®é¢˜å‘ç”Ÿåœ¨ SElinux çš„ type ä¸æ˜¯ vsftpd_t æ‰€èƒ½è¯»å–çš„åŸå› ï¼Œä¸Šé¢ 47.5 çš„æ¦‚ç‡é—®é¢˜ï¼Œftp_home_dir æ˜¯ SELinux rules çš„é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. ç¡®è®¤ä¸‹ SELinux çš„æ¨¡å¼ï¼Œå¹¶ä¸”æ— æ³•è®¿é—®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># getenforce </span>
Enforcing
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost/~/test.txt</span>
curl:<span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">)</span> RETR response:550
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># setsebool -P ftp_home_dir 1</span>
Boolean ftp_home_dir is not defined
<span class="token comment"># å¯æƒœç¬”è€…è¿™é‡Œæç¤ºæ²¡æœ‰è¢«å®šä¹‰ï¼Œä¸ä¹¦ä¸Šå¯¹ä¸ä¸Šå•Š</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸€èˆ¬è´¦æˆ·ç”¨æˆ·ä»éæ­£è§„ç›®å½•ä¸Šä¼ -ä¸‹è½½æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸€èˆ¬è´¦æˆ·ç”¨æˆ·ä»éæ­£è§„ç›®å½•ä¸Šä¼ -ä¸‹è½½æ–‡ä»¶" aria-hidden="true">#</a> ä¸€èˆ¬è´¦æˆ·ç”¨æˆ·ä»éæ­£è§„ç›®å½•ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶</h3><p>æä¾› <code>/srv/gogogo</code> ç›®å½•ç»™ ftptest ç”¨æˆ·ä½¿ç”¨ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿå‡è®¾ä¸è€ƒè™‘ SELiunx çš„è¯ï¼Œå°±æ˜¯å¦‚ä¸‹æ–¹å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å¤„ç†å¥½æ‰€éœ€è¦çš„ç›®å½•æ•°æ®</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /srv/gogogo</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># chgrp ftptest /srv/gogogo/</span>
<span class="token comment"># æŠŠç”¨æˆ·ç»„æ”¹æˆ ftptest è¿™ä¸ªç»„</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># ll -d /srv/gogogo/</span>
drwxr-xr-x. <span class="token number">2</span> root ftptest <span class="token number">22</span> <span class="token number">3</span>æœˆ  <span class="token number">17</span> <span class="token number">22</span>:43 /srv/gogogo/
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;test&quot; &gt; /srv/gogogo/test.txt</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt</span>
curl: <span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">)</span> RETR response: <span class="token number">550</span>
<span class="token comment"># è®¿é—®ä¸äº†ï¼ŒæŸ¥çœ‹æ—¥å¿—</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># grep sealert /var/log/messages | tail</span>
Mar <span class="token number">17</span> <span class="token number">22</span>:46:35 study setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from <span class="token builtin class-name">read</span> access on the <span class="token function">file</span> test.txt. For complete SELinux messages run: sealert <span class="token parameter variable">-l</span> 88f08c09-c510-4518-bbcc-58bcee06ffb0

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sealert -l 88f08c09-c510-4518-bbcc-58bcee06ffb0</span>
SELinux is preventing /usr/sbin/vsftpd from <span class="token builtin class-name">read</span> access on the <span class="token function">file</span> test.txt.

<span class="token comment"># è™½ç„¶è¿™ä¸ªå¯ä¿¡åº¦å¾ˆé«˜ï¼Œä¸è¿‡ï¼Œå› ä¸ºä¼šå…¨éƒ¨æ–¹å‘ FTPï¼Œæ‰€ä»¥ä¸è€ƒè™‘</span>
*****  Plugin catchall_boolean <span class="token punctuation">(</span><span class="token number">57.6</span> confidence<span class="token punctuation">)</span> suggests   ******************

If you want to allow ftpd to full access
Then you must tell SELinux about this by enabling the <span class="token string">&#39;ftpd_full_access&#39;</span> boolean.

Do
setsebool <span class="token parameter variable">-P</span> ftpd_full_access <span class="token number">1</span>

<span class="token comment"># å› ä¸ºæ˜¯éæ­£è§„ç›®å½•çš„ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™è¾¹åŠ ä¸Šé¢„è®¾ SELinux type ææ€•èƒ½è§£å†³</span>
*****  Plugin catchall_labels <span class="token punctuation">(</span><span class="token number">36.2</span> confidence<span class="token punctuation">)</span> suggests   *******************

If you want to allow vsftpd to have <span class="token builtin class-name">read</span> access on the test.txt <span class="token function">file</span>
Then you need to change the label on test.txt
Do
<span class="token comment"># ä¸‹é¢è¿™ä¸€æ¡æ•°æ®</span>
<span class="token comment"># semanage fcontext -a -t FILE_TYPE &#39;test.txt&#39;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span> å¾ˆå¤šæ•°æ®
Then execute:
restorecon <span class="token parameter variable">-v</span> <span class="token string">&#39;test.txt&#39;</span>		<span class="token comment"># è¿˜æœ‰è¿™ä¸€æ¡æ•°æ®ï¼Œéƒ½æ˜¯è¦å‚è€ƒçš„è§£å†³æ–¹æ¡ˆ</span>

*****  Plugin catchall <span class="token punctuation">(</span><span class="token number">7.64</span> confidence<span class="token punctuation">)</span> suggests   **************************

If you believe that vsftpd should be allowed <span class="token builtin class-name">read</span> access on the test.txt <span class="token function">file</span> by default.
Then you should report this as a bug.
You can generate a <span class="token builtin class-name">local</span> policy module to allow this access.
Do
allow this access <span class="token keyword">for</span> now by executing:
<span class="token comment"># ausearch -c &#39;vsftpd&#39; --raw | audit2allow -M my-vsftpd</span>
<span class="token comment"># semodule -i my-vsftpd.pp</span>


Additional Information:
Source Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023
Target Context                unconfined_u:object_r:var_t:s0
Target Objects                test.txt <span class="token punctuation">[</span> <span class="token function">file</span> <span class="token punctuation">]</span>
Source                        vsftpd
Source Path                   /usr/sbin/vsftpd
Port                          <span class="token operator">&lt;</span>Unknown<span class="token operator">&gt;</span>
Host                          study.centos.mrcode
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-252.el7.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     study.centos.mrcode
Platform                      Linux study.centos.mrcode <span class="token number">3.10</span>.0-1062.el7.x86_64
                              <span class="token comment">#1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64</span>
Alert Count                   <span class="token number">2</span>
First Seen                    <span class="token number">2020</span>-03-17 <span class="token number">22</span>:46:17 CST
Last Seen                     <span class="token number">2020</span>-03-17 <span class="token number">22</span>:46:32 CST
Local ID                      88f08c09-c510-4518-bbcc-58bcee06ffb0

Raw Audit Messages
<span class="token assign-left variable">type</span><span class="token operator">=</span>AVC <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1584456392.386</span>:979<span class="token punctuation">)</span>: avc:  denied  <span class="token punctuation">{</span> <span class="token builtin class-name">read</span> <span class="token punctuation">}</span> <span class="token keyword">for</span>  <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">10979</span> <span class="token assign-left variable">comm</span><span class="token operator">=</span><span class="token string">&quot;vsftpd&quot;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;test.txt&quot;</span> <span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token string">&quot;dm-0&quot;</span> <span class="token assign-left variable">ino</span><span class="token operator">=</span><span class="token number">35108539</span> <span class="token assign-left variable">scontext</span><span class="token operator">=</span>system_u:system_r:ftpd_t:s0-s0:c0.c1023 <span class="token assign-left variable">tcontext</span><span class="token operator">=</span>unconfined_u:object_r:var_t:s0 <span class="token assign-left variable">tclass</span><span class="token operator">=</span>file <span class="token assign-left variable">permissive</span><span class="token operator">=</span><span class="token number">0</span>


Hash: vsftpd,ftpd_t,var_t,file,read

<span class="token comment"># 3. æŸ¥çœ‹ /var/ftp çš„ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment">#  ll -Zd /var/ftp/</span>
drwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp/
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment">#  ll -Zd /srv/gogogo/</span>
drwxr-xr-x. root ftptest unconfined_u:object_r:var_t:s0   /srv/gogogo/

<span class="token comment"># 4. ä»¥ sealert å»ºè®®çš„æ–¹æ³•æ¥å¤„ç†å¥½ SELinux type</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage fcontext -a -t public_content_t &#39;/srv/gogogo(/.*)?&#39;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># restorecon -Rv /srv/gogogo</span>
restorecon reset /srv/gogogo context unconfined_u:object_r:var_t:s0-<span class="token operator">&gt;</span>unconfined_u:object_r:public_content_t:s0
restorecon reset /srv/gogogo/test.txt context unconfined_u:object_r:var_t:s0-<span class="token operator">&gt;</span>unconfined_u:object_r:public_content_t:s0
<span class="token comment"># å†æ¬¡è®¿é—®å°±å¯ä»¥äº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt</span>
<span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªèŒƒä¾‹ä¸­ï¼Œä¿®æ”¹çš„æ˜¯ typeï¼Œå‰ä¸€ä¸ªèŒƒä¾‹ä¸­ä¿®æ”¹çš„æ˜¯ ruleï¼Œä¸å¤ªä¸€æ ·çš„</p><h3 id="æ— æ³•å˜æ›´-ftp-è”æœºç«¯å£é—®é¢˜åˆ†æè§£å†³" tabindex="-1"><a class="header-anchor" href="#æ— æ³•å˜æ›´-ftp-è”æœºç«¯å£é—®é¢˜åˆ†æè§£å†³" aria-hidden="true">#</a> æ— æ³•å˜æ›´ FTP è”æœºç«¯å£é—®é¢˜åˆ†æè§£å†³</h3><p>æ¯”å¦‚ä½ æƒ³è¦æ”¹å˜ FTP é»˜è®¤çš„å¯åŠ¨ç«¯å£ 21 æ”¹æˆ 555ï¼ŒåŸºæœ¬ä¸Šï¼Œæ—¢ç„¶ SELinux çš„ä¸»ä½“è¿›ç¨‹å¤§å¤šæ˜¯è¢«å—é™çš„ç½‘ç»œæœåŠ¡ï¼Œå¾ˆæœ‰å¯èƒ½è¿ç«¯å£ä¹Ÿé™åˆ¶äº†ï¼Œä¸‹é¢å°è¯•ä¿®æ”¹ç«¯å£ï¼Œæ¥æŸ¥çœ‹æ˜¯æ€ä¹ˆè§£å†³é—®é¢˜çš„</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å…ˆå¤„ç† vsftpd çš„é…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥ port çš„ç«¯å£å‚æ•°</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/vsftpd/vsftpd.conf </span>
<span class="token assign-left variable">listen_port</span><span class="token operator">=</span><span class="token number">555</span>

<span class="token comment"># 2. é‡å¯æœåŠ¡ï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart vsftpd</span>
Job <span class="token keyword">for</span> vsftpd.service failed because the control process exited with error code. See <span class="token string">&quot;systemctl status vsftpd.service&quot;</span> and <span class="token string">&quot;journalctl -xe&quot;</span> <span class="token keyword">for</span> details.
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># grep sealert /var/log/messages</span>
Mar <span class="token number">17</span> <span class="token number">23</span>:03:23 study setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port <span class="token number">555</span>. For complete SELinux messages run: sealert <span class="token parameter variable">-l</span> e3e3dee0-83eb-4cb8-b894-8be590fee082

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># sealert -l e3e3dee0-83eb-4cb8-b894-8be590fee082</span>
SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port <span class="token number">555</span>.

<span class="token comment"># è¿™ä¸ª 92.2 çš„æ¦‚ç‡ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¿™ä¸ªäº†</span>
*****  Plugin bind_ports <span class="token punctuation">(</span><span class="token number">92.2</span> confidence<span class="token punctuation">)</span> suggests   ************************

If you want to allow /usr/sbin/vsftpd to <span class="token builtin class-name">bind</span> to network port <span class="token number">555</span>
Then you need to modify the port type.
Do
<span class="token comment"># semanage port -a -t PORT_TYPE -p tcp 555</span>
    where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t, ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t, isns_port_t, port_t, postgrey_port_t, unreserved_port_t.

*****  Plugin catchall_boolean <span class="token punctuation">(</span><span class="token number">7.83</span> confidence<span class="token punctuation">)</span> suggests   ******************

If you want to allow nis to enabled
Then you must tell SELinux about this by enabling the <span class="token string">&#39;nis_enabled&#39;</span> boolean.

Do
setsebool <span class="token parameter variable">-P</span> nis_enabled <span class="token number">1</span>

*****  Plugin catchall <span class="token punctuation">(</span><span class="token number">1.41</span> confidence<span class="token punctuation">)</span> suggests   **************************

If you believe that vsftpd should be allowed name_bind access on the port <span class="token number">555</span> tcp_socket by default.
Then you should report this as a bug.
You can generate a <span class="token builtin class-name">local</span> policy module to allow this access.
Do
allow this access <span class="token keyword">for</span> now by executing:
<span class="token comment"># ausearch -c &#39;vsftpd&#39; --raw | audit2allow -M my-vsftpd</span>
<span class="token comment"># semodule -i my-vsftpd.pp</span>


Additional Information:
Source Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023
Target Context                system_u:object_r:hi_reserved_port_t:s0
Target Objects                port <span class="token number">555</span> <span class="token punctuation">[</span> tcp_socket <span class="token punctuation">]</span>
Source                        vsftpd
Source Path                   /usr/sbin/vsftpd
Port                          <span class="token number">555</span>
Host                          study.centos.mrcode
Source RPM Packages           vsftpd-3.0.2-25.el7.x86_64
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-252.el7.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     study.centos.mrcode
Platform                      Linux study.centos.mrcode <span class="token number">3.10</span>.0-1062.el7.x86_64
                              <span class="token comment">#1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64</span>
Alert Count                   <span class="token number">1</span>
First Seen                    <span class="token number">2020</span>-03-17 <span class="token number">23</span>:03:20 CST
Last Seen                     <span class="token number">2020</span>-03-17 <span class="token number">23</span>:03:20 CST
Local ID                      e3e3dee0-83eb-4cb8-b894-8be590fee082

Raw Audit Messages
<span class="token assign-left variable">type</span><span class="token operator">=</span>AVC <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1584457400.225</span>:1008<span class="token punctuation">)</span>: avc:  denied  <span class="token punctuation">{</span> name_bind <span class="token punctuation">}</span> <span class="token keyword">for</span>  <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">11443</span> <span class="token assign-left variable">comm</span><span class="token operator">=</span><span class="token string">&quot;vsftpd&quot;</span> <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token number">555</span> <span class="token assign-left variable">scontext</span><span class="token operator">=</span>system_u:system_r:ftpd_t:s0-s0:c0.c1023 <span class="token assign-left variable">tcontext</span><span class="token operator">=</span>system_u:object_r:hi_reserved_port_t:s0 <span class="token assign-left variable">tclass</span><span class="token operator">=</span>tcp_socket <span class="token assign-left variable">permissive</span><span class="token operator">=</span><span class="token number">0</span>


<span class="token assign-left variable">type</span><span class="token operator">=</span>SYSCALL <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1584457400.225</span>:1008<span class="token punctuation">)</span>: <span class="token assign-left variable">arch</span><span class="token operator">=</span>x86_64 <span class="token assign-left variable">syscall</span><span class="token operator">=</span>bind <span class="token assign-left variable">success</span><span class="token operator">=</span>no <span class="token assign-left variable">exit</span><span class="token operator">=</span>EACCES <span class="token assign-left variable">a0</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">a1</span><span class="token operator">=</span>55e9e4d4e800 <span class="token assign-left variable">a2</span><span class="token operator">=</span>1c <span class="token assign-left variable">a3</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">items</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ppid</span><span class="token operator">=</span><span class="token number">11440</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">11443</span> <span class="token assign-left variable">auid</span><span class="token operator">=</span><span class="token number">4294967295</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">suid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">fsuid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">egid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">sgid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">fsgid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">tty</span><span class="token operator">=</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span> <span class="token assign-left variable">ses</span><span class="token operator">=</span><span class="token number">4294967295</span> <span class="token assign-left variable">comm</span><span class="token operator">=</span>vsftpd <span class="token assign-left variable">exe</span><span class="token operator">=</span>/usr/sbin/vsftpd <span class="token assign-left variable">subj</span><span class="token operator">=</span>system_u:system_r:ftpd_t:s0-s0:c0.c1023 <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>

Hash: vsftpd,ftpd_t,hi_reserved_port_t,tcp_socket,name_bind

<span class="token comment"># 3. æ ¹æ®å»ºè®®è§£å†³æ‰§è¡ŒæŒ‡ä»¤, 92% å“ªä¸ªæŒ‡ä»¤ä¸‹é¢ PORT_TYPE ä¸‹é¢åˆå¯é€‰çš„ ftp_port_t</span>
<span class="token comment"># ä½†æ˜¯ç¬”è€…è¿˜æ˜¯æ‡µé€¼çš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šé‡Œé¢å°±é€‰è¿™ä¸ªäº†</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># semanage port -a -t ftp_port_t -p tcp 555</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart vsftpd</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># netstat -tlnp</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:631           <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1374</span>/cupsd          
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:25            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1578</span>/master         
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:6010          <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">2350</span>/sshd: mrcode@p 
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:6011          <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">10579</span>/sshd: root@pt 
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:111             <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1</span>/systemd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">192.168</span>.122.1:53        <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1975</span>/dnsmasq        
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1378</span>/sshd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:631                 :::*                    LISTEN      <span class="token number">1374</span>/cupsd          
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:25                  :::*                    LISTEN      <span class="token number">1578</span>/master         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:6010                :::*                    LISTEN      <span class="token number">2350</span>/sshd: mrcode@p 
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:6011                :::*                    LISTEN      <span class="token number">10579</span>/sshd: root@pt 
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::555                  :::*                    LISTEN      <span class="token number">11573</span>/vsftpd        
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::111                  :::*                    LISTEN      <span class="token number">1</span>/systemd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      <span class="token number">1378</span>/sshd     
<span class="token comment"># å¯ä»¥çœ‹åˆ° vsftpd çš„ç«¯å£å˜æˆäº† 555 äº†</span>

<span class="token comment"># 4. å®éªŒçœ‹çœ‹è¯¥ port æ˜¯å¦å¯ç”¨</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># curl ftp://localhost:555</span>
drwxr-xr-x    <span class="token number">2</span> <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">42</span> Mar <span class="token number">17</span> 09:03 pub
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,72);function _(f,h){const a=t("RouterLink");return c(),o("div",null,[k,p("p",null,[n("ä¸Šè¿°å·¥å…·å¹¶æœªé¢„è£…ï¼Œ"),l(a,{to:"/99-tools/Linux/07/03.html#%E6%8C%82%E8%BD%BD-cd-%E6%88%96-dvd-%E5%85%89%E7%9B%98"},{default:i(()=>[n("è¯·æ‹¿å‡ºå®‰è£…å…‰ç›˜æŒ‚è½½åˆ° /mnt ç›®å½•ä¸‹")]),_:1}),n("ï¼Œå®‰è£…")]),b])}const x=e(v,[["render",_],["__file","05.html.vue"]]);export{x as default};
