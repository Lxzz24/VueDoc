import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as p,c as e,a as n,b as c,w as o,d as i,e as l}from"./app-CvlAI_tu.js";const u="/VueDoc/assets/l-20231128151911542-BtrJnzbU.jpeg",d={},k={class:"hint-container details"},r=n("summary",null,"ç›®å½•",-1),v={class:"table-of-contents"},m=i(`<p>åœ¨ Java ç¨‹åºä¸­ï¼Œ<code>synchronized</code> è§£å†³äº†å¤šçº¿ç¨‹ç«äº‰çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¯ä»¥ç”¨ <code>synchronized</code> åŠ é”ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
    <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ <code>synchronized</code> å¹¶æ²¡æœ‰è§£å†³å¤šçº¿ç¨‹åè°ƒçš„é—®é¢˜ã€‚</p><p>ä»ç„¶ä»¥ä¸Šé¢çš„ <code>TaskQueue</code> ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ª <code>getTask()</code> æ–¹æ³•å–å‡ºé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
    <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çœ‹ä¸Šå»æ²¡æœ‰é—®é¢˜ï¼š<code>getTask()</code> å†…éƒ¨å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œå°±å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œ<code>while()</code> å¾ªç¯é€€å‡ºï¼Œå°±å¯ä»¥è¿”å›é˜Ÿåˆ—çš„å…ƒç´ äº†ã€‚</p><p>ä½†å®é™…ä¸Š <code>while()</code> å¾ªç¯æ°¸è¿œä¸ä¼šé€€å‡ºã€‚å› ä¸ºçº¿ç¨‹åœ¨æ‰§è¡Œ <code>while()</code> å¾ªç¯æ—¶ï¼Œå·²ç»åœ¨ <code>getTask()</code> å…¥å£è·å–äº† <code>this</code> é”ï¼Œå…¶ä»–çº¿ç¨‹æ ¹æœ¬æ— æ³•è°ƒç”¨ <code>addTask()</code>ï¼Œå› ä¸º <code>addTask()</code> æ‰§è¡Œæ¡ä»¶ä¹Ÿæ˜¯è·å– <code>this</code> é”ã€‚</p><p>å› æ­¤ï¼Œæ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œçº¿ç¨‹ä¼šåœ¨ <code>getTask()</code> ä¸­å› ä¸ºæ­»å¾ªç¯è€Œ 100% å ç”¨ CPU èµ„æºã€‚</p><p>å¦‚æœæ·±å…¥æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ‰§è¡Œæ•ˆæœæ˜¯ï¼š</p><ul><li>çº¿ç¨‹ 1 å¯ä»¥è°ƒç”¨ <code>addTask()</code> ä¸æ–­å¾€é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼›</li><li>çº¿ç¨‹ 2 å¯ä»¥è°ƒç”¨ <code>getTask()</code> ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ <code>getTask()</code> åº”è¯¥ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡æ—¶å†è¿”å›ã€‚</li></ul><p>å› æ­¤ï¼Œå¤šçº¿ç¨‹åè°ƒè¿è¡Œçš„åŸåˆ™å°±æ˜¯ï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p><p>å¯¹äºä¸Šè¿° <code>TaskQueue</code>ï¼Œæˆ‘ä»¬å…ˆæ”¹é€  <code>getTask()</code> æ–¹æ³•ï¼Œåœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ° <code>getTask()</code> æ–¹æ³•å†…éƒ¨çš„ <code>while</code> å¾ªç¯æ—¶ï¼Œå®ƒå¿…å®šå·²ç»è·å–åˆ°äº† <code>this</code> é”ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œ <code>while</code> æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œçº¿ç¨‹å°†æ‰§è¡Œ <code>this.wait()</code>ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼š<code>wait()</code> æ–¹æ³•å¿…é¡»åœ¨å½“å‰è·å–çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œè¿™é‡Œè·å–çš„æ˜¯ <code>this</code> é”ï¼Œå› æ­¤è°ƒç”¨ <code>this.wait()</code>ã€‚</p><p>è°ƒç”¨ <code>wait()</code> æ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ<code>wait()</code> æ–¹æ³•ä¸ä¼šè¿”å›ï¼Œç›´åˆ°å°†æ¥æŸä¸ªæ—¶åˆ»ï¼Œçº¿ç¨‹ä»ç­‰å¾…çŠ¶æ€è¢«å…¶ä»–çº¿ç¨‹å”¤é†’åï¼Œ<code>wait()</code> æ–¹æ³•æ‰ä¼šè¿”å›ï¼Œç„¶åï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚</p><p>æœ‰äº›ä»”ç»†çš„ç«¥é‹ä¼šæŒ‡å‡ºï¼šå³ä½¿çº¿ç¨‹åœ¨ <code>getTask()</code> å†…éƒ¨ç­‰å¾…ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœæ‹¿ä¸åˆ° <code>this</code> é”ï¼Œç…§æ ·æ— æ³•æ‰§è¡Œ <code>addTask()</code>ï¼Œè‚¿ä¹ˆåŠï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜çš„å…³é”®å°±åœ¨äº <code>wait()</code> æ–¹æ³•çš„æ‰§è¡Œæœºåˆ¶éå¸¸å¤æ‚ã€‚é¦–å…ˆï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java æ–¹æ³•ï¼Œè€Œæ˜¯å®šä¹‰åœ¨ <code>Object</code> ç±»çš„ä¸€ä¸ª <code>native</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”± JVM çš„ C ä»£ç å®ç°çš„ã€‚å…¶æ¬¡ï¼Œå¿…é¡»åœ¨ <code>synchronized</code> å—ä¸­æ‰èƒ½è°ƒç”¨ <code>wait()</code> æ–¹æ³•ï¼Œå› ä¸º <code>wait()</code> æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼š * é‡Šæ”¾ * çº¿ç¨‹è·å¾—çš„é”ï¼Œ<code>wait()</code> æ–¹æ³•è¿”å›åï¼Œçº¿ç¨‹åˆä¼šé‡æ–°è¯•å›¾è·å¾—é”ã€‚</p><p>å› æ­¤ï¼Œåªèƒ½åœ¨é”å¯¹è±¡ä¸Šè°ƒç”¨ <code>wait()</code> æ–¹æ³•ã€‚å› ä¸ºåœ¨ <code>getTask()</code> ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº† <code>this</code> é”ï¼Œå› æ­¤ï¼Œåªèƒ½åœ¨ <code>this</code> å¯¹è±¡ä¸Šè°ƒç”¨ <code>wait()</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é‡Šæ”¾ this é”:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é‡æ–°è·å– this é”</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸€ä¸ªçº¿ç¨‹åœ¨ <code>this.wait()</code> ç­‰å¾…æ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾ <code>this</code> é”ï¼Œä»è€Œä½¿å¾—å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿåœ¨ <code>addTask()</code> æ–¹æ³•è·å¾— <code>this</code> é”ã€‚</p><p>ç°åœ¨æˆ‘ä»¬é¢ä¸´ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•è®©ç­‰å¾…çš„çº¿ç¨‹è¢«é‡æ–°å”¤é†’ï¼Œç„¶åä» <code>wait()</code> æ–¹æ³•è¿”å›ï¼Ÿç­”æ¡ˆæ˜¯åœ¨ç›¸åŒçš„é”å¯¹è±¡ä¸Šè°ƒç”¨ <code>notify()</code> æ–¹æ³•ã€‚æˆ‘ä»¬ä¿®æ”¹ <code>addTask()</code> å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å”¤é†’åœ¨ this é”ç­‰å¾…çš„çº¿ç¨‹</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°åœ¨å¾€é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä»»åŠ¡åï¼Œçº¿ç¨‹ç«‹åˆ»å¯¹ <code>this</code> é”å¯¹è±¡è°ƒç”¨ <code>notify()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå”¤é†’ä¸€ä¸ªæ­£åœ¨ <code>this</code> é”ç­‰å¾…çš„çº¿ç¨‹ï¼ˆå°±æ˜¯åœ¨ <code>getTask()</code> ä¸­ä½äº <code>this.wait()</code> çš„çº¿ç¨‹ï¼‰ï¼Œä»è€Œä½¿å¾—ç­‰å¾…çº¿ç¨‹ä» <code>this.wait()</code> æ–¹æ³•è¿”å›ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> ts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ‰§è¡Œtask:</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token class-name">String</span> s <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;execute task: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> add <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ”¾å…¥task:</span>
                <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add task: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                q<span class="token punctuation">.</span><span class="token function">addTask</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        add<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        add<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">:</span> ts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
    <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ <code>addTask()</code> æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨äº† <code>this.notifyAll()</code> è€Œä¸æ˜¯ <code>this.notify()</code>ï¼Œä½¿ç”¨ <code>notifyAll()</code> å°†å”¤é†’æ‰€æœ‰å½“å‰æ­£åœ¨ <code>this</code> é”ç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œ <code>notify()</code> åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªï¼ˆå…·ä½“å“ªä¸ªä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸€å®šçš„éšæœºæ€§ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨ <code>getTask()</code> æ–¹æ³•å†…éƒ¨çš„ <code>wait()</code> ä¸­ç­‰å¾…ï¼Œä½¿ç”¨ <code>notifyAll()</code> å°†ä¸€æ¬¡æ€§å…¨éƒ¨å”¤é†’ã€‚é€šå¸¸æ¥è¯´ï¼Œ<code>notifyAll()</code> æ›´å®‰å…¨ã€‚æœ‰äº›æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç é€»è¾‘è€ƒè™‘ä¸å‘¨ï¼Œç”¨ <code>notify()</code> ä¼šå¯¼è‡´åªå”¤é†’äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹å¯èƒ½æ°¸è¿œç­‰å¾…ä¸‹å»é†’ä¸è¿‡æ¥äº†ã€‚</p><p>ä½†æ˜¯ï¼Œæ³¨æ„åˆ° <code>wait()</code> æ–¹æ³•è¿”å›æ—¶éœ€è¦ <em>é‡æ–°</em> è·å¾— <code>this</code> é”ã€‚å‡è®¾å½“å‰æœ‰ 3 ä¸ªçº¿ç¨‹è¢«å”¤é†’ï¼Œå”¤é†’åï¼Œé¦–å…ˆè¦ç­‰å¾…æ‰§è¡Œ <code>addTask()</code> çš„çº¿ç¨‹ç»“æŸæ­¤æ–¹æ³•åï¼Œæ‰èƒ½é‡Šæ”¾ <code>this</code> é”ï¼Œéšåï¼Œè¿™ 3 ä¸ªçº¿ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªè·å–åˆ° <code>this</code> é”ï¼Œå‰©ä¸‹ä¸¤ä¸ªå°†ç»§ç»­ç­‰å¾…ã€‚</p><p>å†æ³¨æ„åˆ°æˆ‘ä»¬åœ¨ <code>while()</code> å¾ªç¯ä¸­è°ƒç”¨ <code>wait()</code>ï¼Œè€Œä¸æ˜¯ <code>if</code> è¯­å¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> queue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§å†™æ³•å®é™…ä¸Šæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºçº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œéœ€è¦å†æ¬¡è·å– <code>this</code> é”ã€‚å¤šä¸ªçº¿ç¨‹è¢«å”¤é†’åï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å– <code>this</code> é”ï¼Œæ­¤åˆ»ï¼Œè¯¥çº¿ç¨‹æ‰§è¡Œ <code>queue.remove()</code> å¯ä»¥è·å–åˆ°é˜Ÿåˆ—çš„å…ƒç´ ï¼Œç„¶è€Œï¼Œå‰©ä¸‹çš„çº¿ç¨‹å¦‚æœè·å– <code>this</code> é”åæ‰§è¡Œ <code>queue.remove()</code>ï¼Œæ­¤åˆ»é˜Ÿåˆ—å¯èƒ½å·²ç»æ²¡æœ‰ä»»ä½•å…ƒç´ äº†ï¼Œæ‰€ä»¥ï¼Œè¦å§‹ç»ˆåœ¨ <code>while</code> å¾ªç¯ä¸­ <code>wait()</code>ï¼Œå¹¶ä¸”æ¯æ¬¡è¢«å”¤é†’åæ‹¿åˆ° <code>this</code> é”å°±å¿…é¡»å†æ¬¡åˆ¤æ–­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œæ­£ç¡®ç¼–å†™å¤šçº¿ç¨‹ä»£ç æ˜¯éå¸¸å›°éš¾çš„ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘çš„æ¡ä»¶éå¸¸å¤šï¼Œä»»ä½•ä¸€ä¸ªåœ°æ–¹è€ƒè™‘ä¸å‘¨ï¼Œéƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹è¿è¡Œæ—¶ä¸æ­£å¸¸ã€‚</p><figure><img src="`+u+'" alt="multithread" tabindex="0" loading="lazy"><figcaption>multithread</figcaption></figure><h2 id="ğŸ€-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ€-å°ç»“" aria-hidden="true">#</a> ğŸ€ å°ç»“</h2><p><code>wait</code> å’Œ <code>notify</code> ç”¨äºå¤šçº¿ç¨‹åè°ƒè¿è¡Œï¼š</p><ul><li>åœ¨ <code>synchronized</code> å†…éƒ¨å¯ä»¥è°ƒç”¨ <code>wait()</code> ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›</li><li>å¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ <code>wait()</code> æ–¹æ³•ï¼›</li><li>åœ¨ <code>synchronized</code> å†…éƒ¨å¯ä»¥è°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code> å”¤é†’å…¶ä»–ç­‰å¾…çº¿ç¨‹ï¼›</li><li>å¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code> æ–¹æ³•ï¼›</li><li>å·²å”¤é†’çš„çº¿ç¨‹è¿˜éœ€è¦é‡æ–°è·å¾—é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul>',37);function b(w,y){const s=t("router-link");return p(),e("div",null,[n("details",k,[r,n("nav",v,[n("ul",null,[n("li",null,[c(s,{to:"#ğŸ€-å°ç»“"},{default:o(()=>[l("ğŸ€ å°ç»“")]),_:1})])])])]),m])}const f=a(d,[["render",b],["__file","9.html.vue"]]);export{f as default};
