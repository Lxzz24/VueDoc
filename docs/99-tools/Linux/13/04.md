---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# ä½¿ç”¨è€…èº«ä»½åˆ‡æ¢

èº«ä»½å˜åŒ–å¯èƒ½æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

- ä½¿ç”¨ä¸€èˆ¬è´¦æˆ·ï¼šç³»ç»Ÿå¹³æ—¶æ“ä½œçš„å¥½ä¹ æƒ¯

  ä¸ºäº†å®‰å…¨ï¼Œä¸€èˆ¬éƒ½ä¼šå»ºè®®å°½é‡ä»¥ä¸€èˆ¬èº«ä»½ä½¿ç”¨è€…æ¥æ“ä½œ Linux çš„æ—¥å¸¸å·¥ä½œã€‚ç­‰åˆ°éœ€è¦è®¾ç½®ç³»ç»Ÿç¯å¢ƒæ—¶ï¼Œæ‰åˆ‡æ¢æˆ root æ¥ç®¡ç†ç³»ç»Ÿï¼Œç›¸å¯¹æ¯”è¾ƒå®‰å…¨ï¼Œé¿å…è¯¯æ“ä½œä¸€äº›ä¸¥é‡çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ `rm -rf /`

- ç”¨è¾ƒä½æƒé™å¯åŠ¨ç³»ç»ŸæœåŠ¡

  æ¯”å¦‚ï¼šapache è½¯ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª apache ç”¨æˆ·æ¥å¯åŠ¨å®ƒï¼Œå°±ç®—è¯¥è½¯ä»¶è¢«æ”»ç ´äº†ï¼Œè‡³å°‘ä¸è‡³äºæŸåæ•´ä¸ªç³»ç»Ÿï¼›

- è½¯ä»¶æœ¬èº«çš„é™åˆ¶

  åœ¨è¿œå¤æ—¶ä»£çš„ telnet ç¨‹åºä¸­ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸ä½¿ç”¨ root èº«ä»½ç™»å½•çš„ï¼Œè‹¥å‘ç°æ˜¯ UID=0 çš„ç™»å½•ç›´æ¥æ‹’ç»ç™»å½•ï¼›æ­¤å¤– ssh ä¹Ÿå¯ä»¥è®¾ç½®æ‹’ç» root ç™»å½•çš„

ç”±äºä¸Šè¿°è€ƒè™‘ï¼Œæ²¡æœ‰ç³»ç»Ÿè®¾å®šç­‰çš„ç‰¹æ®Šéœ€æ±‚ä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ä¸€èˆ¬è´¦æˆ·ç™»å½•ï¼Œå¦‚æœæœ‰åˆ™å¯ä»¥å˜æ¢èº«ä»½ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š

- `su`ï¼šä»¥ `su -` æŒ‡ä»¤ç›´æ¥å°†èº«ä»½å˜æˆ root

  è¯¥æŒ‡ä»¤éœ€è¦ root å¯†ç ï¼Œè¾“å…¥éªŒè¯æˆåŠŸåæ‰å¯ä»¥åˆ‡æ¢æˆ root èº«ä»½

- `sudo`ï¼šä»¥ `sudo æŒ‡ä»¤` æ‰§è¡ŒæŒ‡ä»¤ä¸²

  ç”±äº sudo éœ€è¦å®ç°è®¾ç½®ï¼Œä¸” sudo éœ€è¦è¾“å…¥ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼Œå› æ­¤å¤šäººå…±åŒç®¡ç†åŒä¸€éƒ¨ä¸»æœºæ—¶ï¼Œ sudo è¦æ¯” su å¥½ï¼Œè‡³å°‘ root å¯†ç ä¸ä¼šæµä¼ å‡ºå»

## ğŸ€ su
æœ€ç®€å•çš„èº«ä»½åˆ‡æ¢æŒ‡ä»¤ï¼Œå¯ä»¥è¿›è¡Œä»»ä½•èº«ä»½çš„åˆ‡æ¢

```bash
su [-lm] [-c æŒ‡ä»¤] [username]
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- `-`ï¼šå•çº¯ä½¿ç”¨ `su -` è¡¨ç¤ºä½¿ç”¨ login-shell çš„å˜é‡æ–‡ä»¶è¯»å–æ–¹å¼æ¥ç™»å½•ç³»ç»Ÿï¼Œè‹¥ä½¿ç”¨è€…åç§°æ²¡æœ‰åŠ ä¸Šå»ï¼Œåˆ™ä»£è¡¨åˆ‡æ¢ä¸º root èº«ä»½
- `-l`ï¼šä¸ `-` ç±»ä¼¼ï¼Œå•åé¢éœ€è¦åŠ è¦åˆ‡æ¢çš„ä½¿ç”¨è€…è´¦æˆ·ï¼Œä¹Ÿæ˜¯ login-shell çš„æ–¹å¼
- `m`ï¼šä¸ `-p` æ˜¯ä¸€æ ·çš„ï¼Œè¡¨ç¤ºï¼šä½¿ç”¨ç›®å‰çš„ç¯å¢ƒè®¾ç½®ï¼Œè€Œä¸è¯»å–æ–°ä½¿ç”¨è€…çš„é…ç½®æ–‡ä»¶
- `-c`ï¼šä»…è¿›è¡Œä¸€æ¬¡æŒ‡ä»¤ï¼Œæ‰€ä»¥ `-c` åé¢å¯ä»¥åŠ ä¸ŠæŒ‡ä»¤

å‰é¢è®²è§£è¿‡ [ login-shell ](10/04.html#login-ä¸-non-login-shell)  æ˜¯å•¥ï¼Œè¿™é‡Œæœ‰æ²¡æœ‰åŠ ä¸Š `-` çš„æŒ‡ä»¤æ¶‰åŠåˆ°äº† login-shell ä¸ non-login shell çš„å˜é‡è¯»å–æ–¹å¼ï¼Œä¸‹é¢ä»¥ä¾‹å­è¯´æ˜

```bash
# èŒƒä¾‹ 1ï¼š å‡è®¾ç°åœ¨èº«ä»½æ˜¯ mrcode , æƒ³è¦ä½¿ç”¨ non-login shell çš„æ–¹å¼å˜æˆ root
[mrcode@study ~]$ su			# æ³¨æ„æç¤ºå­—ç¬¦æ˜¯ mrcode èº«ä»½
Password: 
[root@study mrcode]# id	
# id è¯†åˆ«çš„ç¡®æ˜¯ root èº«ä»½
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

# æŸ¥çœ‹ç¯å¢ƒå˜é‡ä¸­
[root@study mrcode]# env | grep 'mrcode'
HOSTNAME=study.centos.mrcode
USER=mrcode			# å½“å‰ç”¨æˆ·è¿˜æ˜¯ mrcode
PATH=/usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/mrcode/.local/bin:/home/mrcode/bin		# è¿™ä¸ªå½±å“æœ€å¤§ï¼Œåªæ‰¾äº† /home/mrcode
MAIL=/var/spool/mail/mrcode		# ä¿¡ç®±ä¹Ÿæ˜¯
PWD=/home/mrcode				# ä¹Ÿå¹¶éæ˜¯ root çš„å®¶çš„ç›®å½•
LOGNAME=mrcode
XDG_DATA_DIRS=/home/mrcode/.local/share/flatpak/exports/share:/var/lib/flatpak/exports/share:/usr/local/share:/usr/share
# è™½ç„¶ UID å·²ç»å…·æœ‰ root çš„èº«ä»½ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€å †å˜é‡æ˜¯åŸæœ¬ mrcode çš„èº«ä»½ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¾ˆå¤šæ•°æ®æ— æ³•ç›´æ¥åˆ©ç”¨

# ç¦»å¼€å½“å‰çš„ su ç¯å¢ƒ
[root@study mrcode]# exit
exit

```

æ‰€ä»¥å•çº¯çš„ä½¿ç”¨ su åˆ‡æ¢æˆ root æ–¹å¼ï¼Œã€‚è¯»å–çš„å˜é‡è®¾å®šæ–¹å¼ä¸º non-login shell çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å¾ˆå¤šåŸæœ¬çš„å˜é‡ä¸ä¼šè¢«æ”¹å˜ï¼Œå°¤å…¶æ˜¯å¾ˆé‡è¦çš„ PATH å˜é‡ï¼Œç”±äºæ²¡æœ‰æ”¹å˜ä¸º root ç¯å¢ƒï¼Œå› æ­¤å¾ˆå¤š root ç®¡æƒ¯ç”¨çš„æŒ‡ä»¤å°±åªèƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„æ¥æ‰§è¡Œã€‚æ‰€ä»¥æ‰§è¡Œåˆ‡æ¢èº«ä»½æ—¶ï¼ŒåŠ¡å¿…ä½¿ç”¨ä»¥ä¸‹èŒƒä¾‹

```bash
# èŒƒä¾‹ 2ï¼šä½¿ç”¨ login shell çš„æ–¹å¼åˆ‡æ¢ä¸º root çš„èº«ä»½å¹¶è§‚å¯Ÿå˜é‡
[mrcode@study ~]$ su -
Password: 					# è¾“å…¥ root å¯†ç ç™»å½•
Last login: Tue Feb 25 10:47:26 CST 2020 on pts/1
[root@study ~]# env | grep root
USER=root
MAIL=/var/spool/mail/root
PATH=/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
PWD=/root
HOME=/root
LOGNAME=root
XDG_DATA_DIRS=/root/.local/share/flatpak/exports/share:/var/lib/flatpak/exports/share:/usr/local/share:/usr/share
XAUTHORITY=/root/.xauthL0s7Pj
# å¯ä»¥çœ‹åˆ°ç¯å¢ƒå˜é‡éƒ½å˜æˆ root çš„äº†
[root@study ~]# env | grep mrcode
HOSTNAME=study.centos.mrcode
```

åŒæ ·å¯ä»¥ä½¿ç”¨ exit æŒ‡ä»¤ç¦»å¼€ root èº«ä»½ï¼Œå¦‚æœåªæ˜¯æƒ³ä½¿ç”¨ root æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå°±æ¢å¤åŸæœ¬çš„èº«ä»½å¯ä»¥ä½¿ç”¨ `-c` é€‰é¡¹

```bash
# èŒƒä¾‹ 3ï¼šmrcode è¦æ‰§è¡Œ  hread -n 3 /etc/shadow ä¸€æ¬¡ï¼Œå·²çŸ¥ root å¯†ç 
[mrcode@study ~]$ head -n 3  /etc/shadow
head: cannot open '/etc/shadow' for reading: Permission denied
[mrcode@study ~]$ su - -c "head -n 3 /etc/shadow"
Password: 				# è¾“å…¥ root å¯†ç 
root:$6$eC75oi.rU.wJPhgN$C.C.qFXTvmJ64qFnez88TdcsHuuQAqtAYrukgBYBspgSZbCgzvJuv4OVJ9gaEfA2/.T7e68AZW7RoZt6ubeHD0::0:99999:7:::
bin:*:17834:0:99999:7:::
daemon:*:17834:0:99999:7:::
[mrcode@study ~]$ 				# æ³¨æ„çœ‹è¿™é‡Œçš„èº«ä»½è¿˜æ˜¯ mrcode

```

é‚£ä¹ˆæ€ä¹ˆåˆ‡æ¢ä¸ºå…¶ä»–è´¦æˆ·å‘¢ï¼Ÿ

```bash
# èŒƒä¾‹ 4ï¼šåŸæœ¬æ˜¯ mrcode ä½¿ç”¨è€…ï¼Œæƒ³è¦å˜æ¢èº«ä»½ä¸º mrcode1

[mrcode@study ~]$ su -l mrcode1
Password: 				# è¾“å…¥ mrcode1 çš„å¯†ç 
Last login: Mon Feb 24 17:35:35 CST 2020 from 192.168.4.170 on pts/2
[mrcode1@study ~]$ su -			
å¯†ç ï¼š				# è¾“å…¥ root çš„å¯†ç ï¼Œåˆ‡æ¢åˆ° root
ä¸Šä¸€æ¬¡ç™»å½•ï¼šäºŒ 2æœˆ 25 10:58:09 CST 2020pts/1 ä¸Š
[root@study ~]# id sshd			# æŸ¥çœ‹è¿™ä¸ªè´¦æˆ·ï¼Œå‘ç°æœ‰è¯¥è´¦æˆ·
uid=74(sshd) gid=74(sshd) ç»„=74(sshd)
[root@study ~]# su -l sshd			
This account is currently not available.  # æç¤ºæ— æ³•åˆ‡æ¢åˆ° sshd
[root@study ~]# finger sshd		# æŸ¥çœ‹ä»–çš„ä¿¡æ¯å¦‚ä¸‹
Login: sshd           			Name: Privilege-separated SSH
Directory: /var/empty/sshd          	Shell: /sbin/nologin		# è¿™é‡Œçš„ nologin é—®é¢˜
Last login äºŒ 2æœˆ 25 11:00 (CST) on pts/1
No mail.
No Plan.
[root@study ~]# exit
ç™»å‡º		# ç¦»å¼€ç¬¬ 2 æ¬¡çš„ su
[mrcode1@study ~]$ exit
ç™»å‡º		# ç¦»å¼€ç¬¬ 1 æ¬¡çš„ su
[mrcode@study ~]$ 		# è¿™é‡Œåˆå›åˆ°äº†æœ€åˆçš„ mrcode  èº«ä»½

```

### å°ç»“ç”¨æ³•

- è‹¥è¦å®Œæ•´çš„åˆ‡æ¢åˆ°æ–°ä½¿ç”¨è€…çš„ç¯å¢ƒï¼Œæ¯”å¦‚è¦ä½¿ç”¨ `su - username æˆ– su -l username`ï¼Œæ‰ä¼šè¿åŒ PATHã€USERã€MAIL ç­‰å˜é‡éƒ½è½¬æˆæ–°ç”¨æˆ·çš„ç¯å¢ƒ
- å¦‚æœä»…æƒ³è¦æ‰§è¡Œä¸€æ¬¡ root çš„æŒ‡ä»¤ï¼Œå¯ä»¥åˆ©ç”¨ `su -c "æŒ‡ä»¤ä¸²"` çš„æ–¹å¼æ¥å¤„ç†
- ä½¿ç”¨ root åˆ‡æ¢ç§°ä¸ºä»»ä½•ä½¿ç”¨è€…æ—¶ï¼Œå¹¶ä¸éœ€è¦è¾“å…¥æ–°ç”¨æˆ·çš„å¯†ç 

## ğŸ€ sudo

ç›¸å¯¹äº su éœ€è¦äº†è§£åˆ‡æ¢ç”¨æˆ·çš„å¯†ç ï¼ˆå¸¸å¸¸æ˜¯ root çš„å¯†ç ï¼‰ï¼Œè€Œ sudo çš„æ‰§è¡Œä»…éœ€è¦è‡ªå·±çš„å¯†ç ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸éœ€è¦å¯†ç å°±å¯ä»¥æ‰§è¡Œ sudoï¼›ç”±äº sudo å¯ä»¥è®©ä½ ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼Œï¼ˆé€šå¸¸æ˜¯åˆ©ç”¨ root èº«ä»½æ‰§è¡Œå‘½ä»¤ï¼‰ï¼Œæ‰€ä»¥å¹¶éæ‰€æœ‰äººéƒ½èƒ½å¤Ÿæ‰§è¡Œ sudoï¼Œè€Œæ˜¯éœ€è¦è§„èŒƒåˆ° `/etc/sudoers`å†…çš„ç”¨æˆ·æ‰èƒ½å¤Ÿæ‰§è¡Œ sudo æŒ‡ä»¤

::: tip
ä¸€èˆ¬ç”¨æˆ·èƒ½å¤Ÿå…·æœ‰ sudo çš„ä½¿ç”¨æƒï¼Œæ˜¯ç»è¿‡ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡åï¼Œä¹Ÿå°±æ˜¯å—ä¿¡ä»»çš„è´¦æˆ·ï¼Œå¦åˆ™ä¸€èˆ¬ç”¨æˆ·é»˜è®¤æ˜¯ä¸èƒ½æ“ä½œ sudo çš„
:::

### sudo çš„æŒ‡ä»¤ç”¨æ³•

ç”±äºç³»ç»Ÿé»˜è®¤ä»…æœ‰ root å¯ä»¥æ‰§è¡Œ sudoï¼Œå› æ­¤ä¸‹é¢çš„èŒƒä¾‹å…ˆä½¿ç”¨ root æ¥æ‰§è¡Œã€‚ç­‰è°ˆåˆ° visudo æ—¶ï¼Œå†å·²ä¸€èˆ¬ä½¿ç”¨è€…æ¥è®¨è®ºå…¶ä»– sudo çš„ç”¨æ³•

::: tip
æœ€åˆæƒ…å†µä¸‹æ˜¯åªæœ‰ root èƒ½æ‰§è¡Œ sudo çš„ï¼Œä½†æ˜¯åœ¨å®‰è£… CentOs æ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·ä¹Ÿå…·æœ‰ sudo çš„æƒé™
:::

```bash
sudo [-b][-u æ–°ä½¿ç”¨è€…è´¦æˆ·]

é€‰é¡¹ä¸å‚æ•°ï¼š
	-bï¼šå°†åç»­çš„æŒ‡ä»¤æ”¾åˆ°èƒŒæ™¯ä¸­è®©ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼Œè€Œä¸ä¸ç›®å‰çš„ shell äº§ç”Ÿå½±å“
	-uï¼šåé¢å¯ä»¥æ¥è¦åˆ‡æ¢çš„ä½¿ç”¨è€…è´¦æˆ·ï¼Œè‹¥æ²¡æ­¤é¡¹ï¼Œåˆ™è¡¨ç¤ºåˆ‡æ¢åˆ° root èº«ä»½
```

```bash
# èŒƒä¾‹ 1ï¼šæƒ³è¦ä»¥ sshd çš„èº«ä»½åœ¨ /tmp ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º myssh çš„æ–‡ä»¶
[root@study ~]# sudo -u sshd touch /tmp/mysshd
æ‚¨åœ¨ /var/spool/mail/root ä¸­æœ‰æ–°é‚®ä»¶
[root@study ~]# ll /tmp/mysshd 
-rw-r--r--. 1 sshd sshd 0 2æœˆ  25 13:04 /tmp/mysshd
# å¯ä»¥çœ‹åˆ°æ˜¯ç”± ssh åˆ›å»ºçš„

# èŒƒä¾‹ 2ï¼šä»¥ mrcode1 çš„èº«ä»½åˆ›å»º ~Vbird1/www å¹¶åœ¨å…¶ä¸­åˆ›å»º index.html æ–‡ä»¶
[root@study ~]# sudo -u mrcode1 sh -c "mkdir ~mrcode1/www; cd ~mrcode1/www; echo 'This is index.html'  > index.html"
[root@study ~]# ll -a ~mrcode1/www/
æ€»ç”¨é‡ 4
drwxr-xr-x. 2 mrcode1 mrcode1  24 2æœˆ  25 13:15 .
drwx------. 7 mrcode1 mrcode1 201 2æœˆ  25 13:15 ..
-rw-r--r--. 1 mrcode1 mrcode1  19 2æœˆ  25 13:15 index.html
# æ³¨æ„ä¸Šé¢ é‚£ä¸ª sh -c ""  è¿™ä¸€ä¸²ä¸æ˜¯ sudo çš„å‚æ•°ï¼Œæ˜¯æŒ‡ä»¤ï¼›sh --help å¯ä»¥çœ‹åˆ° sh -c "æŒ‡ä»¤ä¸²"ï¼Œæ˜¯åˆ©ç”¨ sh æ‰§è¡Œå‘½ä»¤
```

èŒƒä¾‹ 2 ä½¿ç”¨ sh -c æ¥æ‰§è¡Œå¤šé‡æŒ‡ä»¤ã€‚

ä¸ºä»€ä¹ˆ sudo é¢„è®¾ä»…æœ‰ root èƒ½ä½¿ç”¨ï¼Ÿæ˜¯å› ä¸º sudo çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š

1. å½“ç”¨æˆ·æ‰§è¡Œ sudo æ—¶ï¼Œç³»ç»Ÿä¸ `/etc/sudoers` æ–‡ä»¶ä¸­æœç´¢è¯¥ä½¿ç”¨è€…æ˜¯å¦æœ‰æ‰§è¡Œ sudo çš„æƒé™
2. è‹¥ä½¿ç”¨è€…å…·æœ‰å¯æ‰§è¡Œ sudo çš„æƒé™åï¼Œä¾¿è®©ä½¿ç”¨è€…ã€Œè¾“å…¥ç”¨æˆ·è‡ªå·±çš„å¯†ç ã€æ¥ç¡®è®¤
3. è‹¥å¯†ç è¾“å…¥æˆåŠŸï¼Œå˜å¼€å§‹è¿›è¡Œ sudo åç»­æ¥çš„æŒ‡ä»¤ï¼ˆroot æ‰§è¡Œ sudo æ—¶ä¸éœ€è¦å¯†ç ï¼‰
4. è‹¥è¦åˆ‡æ¢çš„èº«ä»½ä¸æ‰§è¡Œè€…èº«ä»½ç›¸åŒï¼Œä¹Ÿä¸éœ€è¦è¾“å…¥å¯†ç 

æ‰€ä»¥æ˜¯å¦èƒ½ä½¿ç”¨ sudo ï¼Œå¿…é¡»è¦çœ‹ `/etc/sudoers` ä¸­æ˜¯å¦æœ‰é…ç½®ï¼Œè¿™ç§æ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„è§„èŒƒï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ª visudo æŒ‡ä»¤æ¥å¸®åŠ©ç®¡ç†è¯¥æ–‡ä»¶

### visudo ä¸ `/etc/sudoers`

ä½¿ç”¨ visudo æ¥ä¿®æ”¹ï¼Œåœ¨ç»“æŸç¦»å¼€æ—¶ï¼Œä¼šæ ¡éªŒ `/etc/sudoers` çš„è¯­æ³•ï¼Œæ¥é¿å…ä¿®æ”¹é”™è¯¯çš„è¯­æ³•å¯¼è‡´ sudo æ— æ³•ä½¿ç”¨

ä¸€èˆ¬æ¥è¯´ï¼Œvisduo çš„è®¾ç½®æ–¹å¼æœ‰å‡ ç§ç®€å•çš„æ–¹æ³•ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜

### å•ä¸€ç”¨æˆ·ä½¿ç”¨ sudo

å•ä¸€ç”¨æˆ·å¯è¿›è¡Œ root æ‰€æœ‰æŒ‡ä»¤ï¼Œä¸ sudoers æ–‡ä»¶è¯­æ³•ï¼š

```bash
# è®© mrcode1 è´¦æˆ·å¯ä»¥ä½¿ç”¨ root çš„ä»»ä½•æŒ‡ä»¤ï¼ŒåŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹å¼ï¼š
# 1. ç›´æ¥ä¿®æ”¹ /etc/sudoers
[root@study ~]# visudo 
:set nu			# æ˜¾ç¤ºè¡Œå·
    100 root    ALL=(ALL)       ALL
    101 mrcode1 ALL=(ALL)       ALL			# åœ¨ 100 è¡Œåï¼Œæ·»åŠ  mrcode1 çš„æ•°æ®
# ç„¶åä¿å­˜ç¦»å¼€
```

å…¶å® visudo åˆ©ç”¨ vi å°†æ–‡ä»¶æ‰“å¼€ä¿®æ”¹ã€‚

```bash
ä½¿ç”¨è€…è´¦æˆ·	ç™»é™†è€…çš„æ¥æºä¸»æœºå=ï¼ˆå¯åˆ‡æ¢çš„èº«ä»½ï¼‰	å¯ä¸‹è¾¾çš„æŒ‡ä»¤
root    	ALL=(ALL)       				ALL
```

å„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š

1. ä½¿ç”¨è€…è´¦æˆ·ï¼šç³»ç»Ÿä¸­é‚£ä¸ªè´¦æˆ·å¯ä»¥ä½¿ç”¨ sudo æŒ‡ä»¤
2. ç™»é™†è€…çš„æ¥æºä¸»æœºåï¼šå°±æ˜¯ä¿¡ä»»å“ªä¸€å°ç½‘ç»œä¸»æœºå¯ä»¥è”æœºï¼Œè¿™ä¸ªå€¼å¯ä»¥æŒ‡å®šå®¢æˆ·ç«¯è®¡ç®—æœºã€‚é»˜è®¤çš„ ALL æ˜¯å…è®¸ä»»ä½•ä¸€å°ç½‘ç»œä¸»æœº
3. å¯åˆ‡æ¢çš„èº«ä»½ï¼šè¿™ä¸ªè´¦æˆ·å¯ä»¥åˆ‡æ¢æˆä»€ä¹ˆèº«ä»½æ¥ä¸‹è¾¾åç»­çš„æŒ‡ä»¤ã€‚é»˜è®¤ root å¯ä»¥åˆ‡æ¢æˆä»»ä½•äºº
4. å¯ä¸‹è¾¾çš„æŒ‡ä»¤ï¼šå¯ç”¨è¯¥èº«ä»½ä¸‹è¾¾ä»€ä¹ˆæŒ‡ä»¤ï¼Ÿ**è¿™ä¸ªæŒ‡ä»¤è¯·åŠ¡å¿…ä½¿ç”¨ç»å¯¹è·¯å¾„**ï¼Œé¢„è®¾ root å¯ä»¥åˆ‡æ¢ä»»ä½•èº«ä»½ä¸”ä¸‹è¾¾ä»»ä½•æŒ‡ä»¤

All æ˜¯ç‰¹æ®Šçš„å…³é”®è¯ï¼Œä»£è¡¨ä»»ä½•èº«ä»½ã€ä¸»æœºã€æŒ‡ä»¤

```bash
# è¿›è¡Œæµ‹è¯•
[mrcode1@study ~]$ tail -n 1 /etc/shadow		# è¿™é‡Œæ˜¯ mrcode1 ç™»å½•çš„
# æç¤ºæƒé™ä¸è¶³
tail: cannot open '/etc/shadow' for reading: Permission denied

# ä½¿ç”¨ sudo æ¥æ‰§è¡Œ
[mrcode1@study ~]$ sudo tail -n 1 /etc/shadow

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.
# ä¸Šé¢åªæ˜¯æç¤ºï¼Œå¤§æ¦‚æ„æ€æ˜¯èƒ½åŠ›è¶Šå¤§è´£ä»»è¶Šå¤§ï¼Œæ…é‡ä¹‹ç±»çš„æ„æ€
[sudo] password for mrcode1: 				# ç„¶åè¾“å…¥ mrcode1 è‡ªå·±çš„å¯†ç ï¼Œå°±å¯ä»¥æ‰§è¡Œäº†
pro3:$6$oku6c8Az$GUOVL1SkmFnSnVHvUCKnToNv8l7094dQ17/GOw/R5mdxqiE0THtkFaO4GpzFMxJy30rZbpWgQcNSpMqHN8KWT/:18316:0:99999:7:::

```

åˆ©ç”¨ wheel ç¾¤ç»„ä»¥åŠå…å¯†ç çš„åŠŸèƒ½å¤„ç† visudo

### wheel ç¾¤ç»„ä½¿ç”¨ sudo

ä¹‹å‰æ›¾å»ºç«‹è¿‡ pro1ã€pro2ã€pro3  è®©è¿™ 3 ä¸ªç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨ sudoï¼Œä½†æ˜¯é€šè¿‡ç¾¤ç»„çš„æ–¹å¼æ¥æ”¯æŒ

```bash
# 1. ä½¿ç”¨ visudo è®¾ç½® whell ç¾¤ç»„
visudo

     99 ## Allow root to run any commands anywhere
    100 root    ALL=(ALL)       ALL
    101 mrcode1 ALL=(ALL)       ALL
    102 
    103 ## Allows members of the 'sys' group to run networking, software,
    104 ## service management apps and more.
    105 # %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS
    106 
    107 ## Allows people in group wheel to run all commands
    108 %wheel  ALL=(ALL)       ALL
    
# åœ¨æœ€å·¦è¾¹å¢åŠ  % è¡¨ç¤ºæ˜¯ä¸€ä¸ªç¾¤ç»„ï¼Œæ³¨æ„åœ¨ç¼–è¾‘çš„æ—¶å€™ï¼Œå½“æ—¶ç¬”è€…å§ $wheel è¿™ä¸€è¡Œå†™åœ¨ ä¸Šé¢ root åé¢ï¼ŒæŠ¥é”™å°±æŠ¥é”™è¯´æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯å¦ä¹Ÿæœ‰è¯†åˆ«ï¼Œéœ€è¦å†™åˆ°è¿™ä¸ª Allows people in group wheel to run all commands è¿™ä¸€è¡Œä¸‹é¢å‘¢ï¼Ÿ
# æ³¨æ„ï¼š whell è¿™ä¸ªé…ç½®é»˜è®¤å·²ç»é…ç½®è¿‡äº†ï¼Œå¹¶ä¸”è¯¥ç»„ä¹Ÿå·²ç»å­˜åœ¨äº†ã€‚åº”è¯¥æ˜¯ç³»ç»Ÿåˆå§‹åŒ–å°±æœ‰çš„

# 2. å°† pro1 æ·»åŠ è¿› wheel ç¾¤ç»„
[root@study ~]# usermod -a -G wheel pro1

# 3. åˆ‡æ¢åˆ° pro1 ã€pro2 å¹¶æ‰§è¡Œ sudo å‘½ä»¤æŸ¥çœ‹
[root@study ~]# su -l pro1
[pro1@study ~]$ sudo tail -n 1 /etc/shadow

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for pro1: 
pro3:$6$oku6c8Az$GUOVL1SkmFnSnVHvUCKnToNv8l7094dQ17/GOw/R5mdxqiE0THtkFaO4GpzFMxJy30rZbpWgQcNSpMqHN8KWT/:18316:0:99999:7:::

# åˆ‡æ¢åˆ° pro2 
[root@study ~]# su -l pro2
[pro2@study ~]$ export LANG=C
[pro2@study ~]$ sudo tail -n 1 /etc/shadow

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for pro2: 
pro2 is not in the sudoers file.  This incident will be reported.
# æç¤º pro2 ä¸åœ¨ sudoers æ–‡ä»¶ä¸­
```

é‚£ä¹ˆè¿™é‡Œå¯¹ç¾¤ç»„è¿›è¡Œäº†æ”¯æŒï¼Œpro2 å’Œ pro3 ä¹Ÿè¦æ”¯æŒ sudo çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ usermod å°†ä»–ä»¬æ·»åŠ åˆ° wheel ç»„ä¸­å³å¯

å‰é¢è¯´å®‰è£…ç³»ç»Ÿåˆ›å»ºçš„ç”¨æˆ·ï¼Œç›´æ¥è®¾ç½®ä¸ºäº†ç®¡ç†å‘˜çš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ sudo æŒ‡ä»¤çš„ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯å°†é‚£ä¸ªè´¦æˆ·æ·»åŠ åˆ°äº† wheel ç»„äº†

```bash
[mrcode@study ~]$ id mrcode 
uid=1000(mrcode) gid=1000(mrcode) groups=1000(mrcode),100(users)
[mrcode@study ~]$ id pro1
uid=1505(pro1) gid=1508(pro1) groups=1508(pro1),10(wheel),1507(projecta)

[mrcode@study ~]$ sudo cat /etc/shadow
[sudo] password for mrcode: 
mrcode is not in the sudoers file.  This incident will be reported.

# æˆ‘ä»¬è¿™é‡Œçœ‹åˆ°ï¼Œè¿™é‡Œçš„è´¦æˆ·å¹¶æ²¡æœ‰åŠ å…¥ wheel è¿™ä¸ªç»„ï¼Œå®é™…æ‰§è¡Œ sudo çš„è¯ï¼Œä¹Ÿä¼šæç¤ºä¸æ”¯æŒï¼›
# è¿™å°±è¯´æ˜å½“æ—¶æˆ‘å¹¶æ²¡æœ‰é€‰æ‹©æ·»åŠ ä¸ºç®¡ç†å‘˜

```

ä» Centos 7 å¼€å§‹ï¼Œ `%wheel` è¿™è¡Œé»˜è®¤å­˜åœ¨ï¼Œå¹¶ä¸”ä¹Ÿæœ‰è¿™ä¸ªç»„

### å…å¯†ä½¿ç”¨ sudo

æ—¢ç„¶ç®¡ç†å‘˜éƒ½ä¿¡ä»»è¿™äº›ç”¨æˆ·äº†ï¼Œæ˜¯å¦å¯ä»¥æä¾›ï¼šä¸éœ€è¦å¯†ç å°±å¯ä»¥ä½¿ç”¨ sudo å‘¢ï¼Ÿ

```bash
[root@study ~]# visudo 
## ğŸ€ Allows people in group wheel to run all commands
# %wheel        ALL=(ALL)       ALL


## ğŸ€ Same thing without a password
%wheel  ALL=(ALL)       NOPASSWD: ALL
```

æ‰¾åˆ°ä¸Šè¿°åœ°æ–¹ï¼Œåœ¨ç¬¬ä¸‰ä¸ªå­—æ®µï¼Œå°† NOPASSWD å“ªä¸€è¡Œæ”¾å¼€ï¼ŒæŠŠä¸Šé¢åŸå§‹çš„æ³¨é‡Šæ‰ã€‚ä¹Ÿå°±æ˜¯åœ¨å¯ä¸‹è¾¾çš„æŒ‡ä»¤å‰ä½¿ç”¨ `NOPASSWD:` æ¥æ ‡è¯†ä¸éœ€è¦å¯†ç 

### æœ‰é™åˆ¶çš„æŒ‡ä»¤æ“ä½œ

ä¸Šé¢çš„é…ç½®å¯ä»¥è®©ä½¿ç”¨è€…åˆ©ç”¨ root èº«ä»½è¿›è¡Œä»»ä½•äº‹æƒ…ï¼Œå¦‚æœè¦é…ç½®åªèƒ½å¤Ÿå…è®¸è¿›è¡Œä¸€éƒ¨åˆ†äº‹æƒ…çš„è¯ï¼Œæ¯”å¦‚ myuser1 åªèƒ½å¸® root ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç ï¼Œå¯ä»¥å¦‚ä¸‹åš

```bash
[root@study ~]# visudo 
## ğŸ€ Allow root to run any commands anywhere
root    ALL=(ALL)       ALL
mrcode1 ALL=(ALL)       ALL
myuser1 ALL=(ALL)       /usr/bin/passwd		# ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ¥ç»™å®šä½¿ç”¨çš„æŒ‡ä»¤


# å†ä½¿ç”¨ myuser1 æ¥æµ‹è¯•æ˜¯å¦æˆåŠŸ
[myuser1@study ~]$ sudo cat /etc/shadow
[sudo] password for myuser1: 
Sorry, user myuser1 is not allowed to execute '/bin/cat /etc/shadow' as root on study.centos.mrcode.
# å¯ä»¥çœ‹åˆ°ä¸æ”¯æŒ /bin/cat æŒ‡ä»¤

# å†ä½¿ç”¨ sudo passwd ï¼Œå‘ç°å¯ä»¥æ‰§è¡Œ
[myuser1@study ~]$ sudo passwd myuser3
Changing password for user myuser3.
New password: 
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: 
passwd: all authentication tokens updated successfully.
# ä¸Šé¢ä¿®æ”¹äº† myuser3 çš„å¯†ç 

# è¿™é‡Œä¸åŠ å‚æ•°ï¼Œå‘ç°å¯ä»¥ç›´æ¥ä¿®æ”¹ root çš„å¯†ç ï¼Œè¿™æ ·å°±ä¸è¡Œäº†
[myuser1@study ~]$ sudo passwd
Changing password for user root.
New password: 

# è¿˜å¯ä»¥é™åˆ¶æŒ‡ä»¤çš„å‚æ•°
myuser1 ALL=(ALL)       !/usr/bin/passwd, !/usr/bin/passwd root, /usr/bin/passwd [A-Za-z]*
# ä¸å¯æ‰§è¡Œçš„æŒ‡ä»¤æ·»åŠ ä¸Šäº†æ„Ÿå¹å· !
# ä¸Šé¢ç›´æ¥æ‰§è¡Œ passwd å’Œ passwd root éƒ½ä¸å…è®¸ï¼Œåé¢ä¸€ä¸ªç”¨æ­£åˆ™è§„å®šäº†å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨å­—æ¯å¼€å¤´çš„å‚æ•°

# æµ‹è¯•ï¼Œå°±ä¼šæç¤ºä¸è¢«å…è®¸æ‰§è¡Œ
[myuser1@study ~]$ sudo passwd
Sorry, user myuser1 is not allowed to execute '/bin/passwd' as root on study.centos.mrcode.
```

### é€šè¿‡åˆ«åå»ºç«‹ visudo

æ¯”å¦‚æˆ‘æœ‰ 15 ä¸ªç”¨æˆ·åŠ å…¥åˆšåˆšçš„ç®¡ç†å‘˜ï¼Œé‚£ä¹ˆæ˜¯å¦éƒ½éœ€è¦å°†ä¸Šè¿°é™åˆ¶å‘½ä»¤çš„ä»£ç å¤åˆ¶ 15 è¡Œé…ç½®åˆ° visudo ä¸­å‘¢ï¼Ÿ

å¯ä»¥é€šè¿‡ visudo çš„åˆ«ååŠŸèƒ½ï¼Œå¯ä»¥æ˜¯ï¼šæŒ‡ä»¤åˆ«åã€è´¦æˆ·åˆ«åã€ä¸»æœºåˆ«åç­‰ã€‚è¿™é‡Œä»…ä»‹ç»è´¦æˆ·åˆ«å

```bash
# å‡è®¾ pro1ã€pro2ã€pro3 ä¸ myuser1ã€myuser2 è¦åŠ å…¥ä¸Šè¿°çš„å¯†ç ç®¡ç†å‘˜çš„ sudo åˆ—è¡¨ä¸­
# é‚£ä¹ˆå¯ä»¥åˆ›å»ºä¸€ä¸ªè´¦æˆ·åˆ«åä¸º ADMPWï¼Œç„¶åé…ç½®è¯¥è´¦æˆ·åˆ«å

## ğŸ€ User Aliases
## ğŸ€ These aren't often necessary, as you can use regular groups
## ğŸ€ (ie, from files, LDAP, NIS, etc) in this file - just use %groupname
## ğŸ€ rather than USERALIAS
# User_Alias ADMINS = jsmith, mikem
User_Alias ADMPW = pro1, pro2, pro3, myuser1, myuser2

## ğŸ€ Command Aliases
## ğŸ€ These are groups of related commands...
Cmnd_Alias ADMPWCOM = !/usr/bin/passwd, !/usr/bin/passwd root, /usr/bin/passwd [A-Za-z]*

## ğŸ€ Allow root to run any commands anywhere
root    ALL=(ALL)       ALL
mrcode1 ALL=(ALL)       ALL
myuser1 ALL=(ALL)       !/usr/bin/passwd, !/usr/bin/passwd root, /usr/bin/passwd [A-Za-z]*
ADMPW   ALL=(ALL)       ADMPWCOM
# ä¸Šé¢å®šä¹‰äº† User_Alias ç”¨æˆ·åˆ«å å’Œ Cmnd_Alias å‘½ä»¤åˆ«å
# å¹¶åœ¨ä¹‹å‰é…ç½®ç”¨æˆ·çš„åœ°æ–¹ä½¿ç”¨ä¸Šäº†è¿™ä¸¤ä¸ªåˆ«å
```

åˆ«åå»ºè®®ä½¿ç”¨å¤§å†™ï¼›åç»­å¯¹ç”¨æˆ·çš„ç»´æŠ¤ç›´æ¥ä¿®æ”¹åˆ«åä¸­çš„å³å¯

### sudo çš„æ—¶é—´é—´éš”é—®é¢˜

å¦‚æœä½¿ç”¨åŒä¸€ä¸ªè´¦æˆ·åœ¨æçŸ­æ—¶é—´å†…é‡å¤æ“ä½œ sudo æ¥è¿è¡ŒæŒ‡ä»¤çš„è¯ï¼Œåœ¨ç¬¬äºŒæ¬¡æ‰§è¡Œ sudo æ—¶ï¼Œå¹¶ä¸éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç ï¼ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ

è¿™æ˜¯å› ä¸ºæœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œsudo ä¸¤æ¬¡æ“ä½œé—´éš”è¶…è¿‡ 5 åˆ†é’Ÿï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°è¾“å…¥ä¸€æ¬¡å¯†ç ã€‚è¿™ä¸ªæœºåˆ¶ä¹Ÿæ˜¯ä¸ºäº†å®‰å…¨ï¼Œæ¯”å¦‚ä½ è¾“å…¥å¯†ç æ‰§è¡Œè¿‡ä¸€æ¬¡ sudoï¼Œè¿™ä¸ªæ—¶å€™å»å•æ‰€äº†ï¼Œè¶…è¿‡äº† 5 åˆ†é’Ÿè¿˜æ²¡æœ‰å›æ¥ï¼Œé˜²æ­¢åˆ«äººåŠ¨ä½ çš„ç”µè„‘æ‰§è¡Œ sudo

### sudo æ­é… su çš„ä½¿ç”¨æ–¹å¼

æœ‰æ—¶å€™éœ€è¦å¤§é‡æ‰§è¡Œå¾ˆå¤š root çš„å·¥ä½œï¼Œä¸€ç›´ä½¿ç”¨ sudo å°±å¾ˆéº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ç»“åˆ suï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ç”¨æˆ·è‡ªå·±çš„å¯†ç æ¥å˜æˆ root

```bash
visudo
User_Alias ADMINS = pro1, pro2, pro3, myuser1
ADMINS  ALL=(root)      /bin/su -

# åˆ›å»ºä¸€ä¸ª ADMINS çš„ç”¨æˆ·åˆ«åï¼Œå†é™åˆ¶è¯¥ç”¨æˆ·åªèƒ½åˆ‡æ¢åˆ° rootï¼Œå¹¶ä¸”åªèƒ½æ‰§è¡Œ su -
# æ³¨æ„ä½¿ç”¨æ˜¯ï¼šç”¨ sudo å‘½ä»¤æ¥æ‰§è¡Œ su
[pro2@study ~]$ sudo su -
[sudo] password for pro2: 
Last login: Tue Feb 25 15:09:19 CST 2020 on pts/1
[root@study ~]# 		# çœ‹è¿™é‡Œçš„æç¤ºï¼Œå˜æˆäº† root

```

è¿™ä¸ªæ–¹å¼æ˜¯è¿™æ ·çš„ï¼š

1. é™åˆ¶äº†å¯åˆ‡æ¢ä¸º rootï¼Œé‚£ä¹ˆè¿™äº›ç”¨æˆ·åªèƒ½åˆ‡æ¢åˆ° root
2. å¹¶ä¸”è¿™äº›ç”¨æˆ·åªèƒ½é€šè¿‡ sudo æ‰§è¡Œ `su -` çš„æ“ä½œ
3. sudo éœ€è¦è¾“å…¥ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼Œé€šè¿‡ä¹‹åç›¸å½“äºæ˜¯ root èº«ä»½äº†ï¼Œç”¨ root èº«ä»½æ‰§è¡Œ su -  åˆ‡æ¢åˆ° root èº«ä»½ï¼Œå°±ä¸éœ€è¦ root å¯†ç äº†ï¼ˆroot ä½¿ç”¨ su ä¸éœ€è¦å¯†ç ï¼‰

é€šè¿‡ä¸­æ–¹å¼ä¹Ÿèƒ½æˆæƒç®¡ç†å‘˜è´¦æˆ·ã€‚