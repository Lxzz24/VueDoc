---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# CentOS 7 ç¯å¢ƒä¸‹å¤§é‡å»ºç«‹è´¦æˆ·çš„æ–¹æ³•

ç³»ç»Ÿä¸Šå¦‚æœæœ‰ä¸€å †è´¦æˆ·ï¼Œæ€ä¹ˆåˆ¤å®šæŸäº›è´¦æˆ·æ˜¯å¦å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Ÿå¦‚ä½•åˆ›å»ºæˆ–åˆ é™¤å¤§é‡è´¦æˆ·ï¼Ÿ

è¿™ä¸ªè‚¯å®šæ˜¯éœ€è¦ç”¨åˆ° shell script è„šæœ¬çš„ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»

## ğŸ€ ä¸€äº›è´¦æˆ·ç›¸å…³çš„æ£€æŸ¥å·¥å…·

### pwck

è¯¥æŒ‡ä»¤ä¼šæ£€æŸ¥ `/etc/passwd` è´¦æˆ·é…ç½®æ–‡ä»¶å†…çš„ä¿¡æ¯ï¼Œä¸å®é™…çš„å®¶ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œç­‰ä¿¡æ¯ã€è¿˜å¯ä»¥æ¯”å¯¹ `/etc/passwd` ä¸ `/etc/shadow` çš„ä¿¡æ¯æ˜¯å¦ä¸€è‡´ã€å¦‚æœ `/etc/passwd` å†…çš„æ•°æ®å­—æ®µé”™è¯¯æ—¶ï¼Œä¼šæç¤ºä½¿ç”¨è€…ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œä½œè€…åªæ˜¯åˆ©ç”¨è¿™ä¸ªæŒ‡ä»¤æ¥æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®

```bash
[root@study ~]# pwck
user 'ftp': directory '/var/ftp' does not exist
user 'saslauth': directory '/run/saslauthd' does not exist
user 'gluster': directory '/run/gluster' does not exist
user 'pulse': directory '/var/run/pulse' does not exist
user 'gnome-initial-setup': directory '/run/gnome-initial-setup/' does not exist
pwck: no changes
```

ä¸Šé¢å‘ŠçŸ¥äº†è¿™äº›è´¦æˆ·æ²¡æœ‰å®¶ç›®å½•ï¼›ä»”ç»†çœ‹ç”±äºå¤§éƒ¨åˆ†éƒ½æ˜¯ç³»ç»Ÿè´¦æˆ·ï¼ˆçš„ç¡®ä¸éœ€è¦å®¶ç›®å½•ï¼‰

```bash
# å¯¹åº”çš„ç¾¤ç»„æ£€æŸ¥
[root@study ~]# grpck
```

### pwconv

è¯¥æŒ‡ä»¤ä¸»è¦ç›®çš„æ˜¯å°† `/etc/passwd` è´¦æˆ·ä¸å¯†ç ç§»åŠ¨åˆ° `/etc/shadow` ä¸­ã€‚ï¼ˆæ—©èµ·çš„ Unix ä¸­æ²¡æœ‰ shadow æ–‡ä»¶ï¼Œåœ¨ passwd çš„ç¬¬ 2 å­—æ®µï¼‰

ä½¿ç”¨ pwdconv åï¼š

- æ¯”å¯¹ `/etc/passwd` å’Œ `/etc/shadow` 

  è‹¥ passwd å­˜åœ¨çš„è´¦æˆ·å¹¶æ²¡æœ‰å¯¹åº”çš„ shadow å¯†ç æ—¶ï¼Œåˆ™ pwconv ä¼šå» `/etc/login.defs` è·å–ç›¸å…³çš„å¯†ç æ•°æ®ï¼Œå¹¶å»ºç«‹è¯¥è´¦æˆ·çš„ shadow æ•°æ®

- è‹¥ `/etc/passwd` å†…å­˜åœ¨åŠ å¯†åçš„å¯†ç æ•°æ®æ—¶ï¼Œåˆ™ pwconv ä¼šå°†è¯¥å¯†ç æ ç§»åŠ¨åˆ° `/etc/shadow` ä¸­ï¼Œå¹¶å°†åŸæ¥çš„å¯†ç æ å†…å®¹å˜æ›´ä¸º x

æ‰€ä»¥è¯¥å·¥å…·åªæ˜¯ä¸ºäº†è¿ç§»æ—©æœŸçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œå¯¹äºç°åœ¨å‡ ä¹ä¸Šæ²¡æœ‰å•¥ç”¨å¤„äº†

### pwunconv

è¯¥æŒ‡ä»¤æ˜¯å°† `/etc/shadow` å†…çš„å¯†ç æ æ•°æ®å†™å› `/etc/passwd` ä¸­ï¼Œå¹¶ä¸”åˆ é™¤ `/etc/shadow` æ–‡ä»¶

### chpasswd

è¯»å–æœªåŠ å¯†å‰çš„å¯†ç ï¼ŒåŠ å¯†å¹¶å°†åŠ å¯†åçš„å¯†ç å†™å…¥ `/etc/shadow`

è¯¥æŒ‡ä»¤å¯ä»¥ç”¨åœ¨å¤§é‡å»ºç«‹è´¦æˆ·çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥ç”±  Standard input è¯»å…¥æ•°æ®ï¼Œæ•°æ®æ ¼å¼ä¸º `username:password`ã€‚

```bash
# æ¯”å¦‚ï¼šæ›´æ–° mrcode3 è´¦æˆ·çš„å¯†ç 
[root@study ~]# echo "mrcode3:123" | chpasswd
[root@study ~]# grep mrcode3 /etc/shadow
mrcode3:$6$v4wtD/HDxmMD.F$tkpuAZ3Onx14Oa2YYqpD3CfZrexV0D18nolGGfl7cIcXG/57r2S2S2oQzHjuiN4efmFYCOpHS.cK/.cVDk6zi/:18318::::::
[root@study ~]# echo "mrcode3:123abv" | chpasswd
[root@study ~]# grep mrcode3 /etc/shadow
mrcode3:$6$kqggs/OgGqR0ftc$zHF9FbcJqd0fWHNx4hGwWXcQgrjPosDcpDed7iH7/LYb0tAOBerMvUzodNrX.K4UW5AUYs9S/DGaetJBD3xu6.:18318::::::
# è§‚å¯Ÿä¸‹å¯†ç æ çš„åŠ å¯†å­—ç¬¦ä¸²ï¼Œå‘ç°çš„ç¡®æ˜¯è¢«æ›´æ–°è¿‡äº†
```

å®ƒé¢„è®¾ä½¿ç”¨ `SHA512` è¿›è¡ŒåŠ å¯†ï¼Œæƒ³è¦æ›´æ”¹å°±éœ€è¦ä½¿ç”¨ `-c å’Œ -e` é€‰é¡¹æ¥æŒ‡å®šã€‚ä¸è¿‡ä» CentOS 5.x ä¹‹åï¼Œpasswd æŒ‡ä»¤å·²ç»æ·»åŠ äº† `--stdin` é€‰é¡¹ï¼Œå¯ä»¥è¯´æ˜¯æ›¿ä»£äº†è¿™é‡Œçš„åŠŸèƒ½

## ğŸ€ å¤§é‡å»ºç«‹è´¦æˆ·æ¨¡æ¿ï¼ˆé€‚ç”¨ passwd --stdin é€‰é¡¹ï¼‰

ä¸‹é¢æ˜¯ä¸€ä¸ªæ–°ç«™ç”¨æˆ·åŠŸèƒ½çš„è„šæœ¬

```bash
vim accountadd.sh

#!/bin/bash
# This shell script will create amount of linux login accounts for you.
# 1. check the "accountadd.txt" file existï¼Ÿ you must create that file manually
#	one account name one line in the "accountadd.txt" file
# 2. use openssl to create users password
# 3. User must change his password in his first login
#
# æ­¤å‘½ä»¤è¡Œå‘½ä»¤è„šæœ¬å°†ä¸ºæ‚¨åˆ›å»ºå¤§é‡ Linux ç™»å½•ã€‚
# 1.æ£€æŸ¥ "accountadd.txt" æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿæ‚¨å¿…é¡»æ‰‹åŠ¨åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä¸€ä¸ªè´¦æˆ·ä¸€è¡Œ
# 2.ä½¿ç”¨ openssl åˆ›å»ºç”¨æˆ·å¯†ç 
# 3.ç”¨æˆ·å¿…é¡»åœ¨é¦–æ¬¡ç™»å½•æ—¶æ›´æ”¹å¯†ç 
export PATH=/bin:/sbin:/usr/bin:/usr/sbin

# 0. userinput
usergroup=""		# å¦‚æœä½ çš„è´¦æˆ·éœ€è¦æ¬¡è¦ç»„ï¼Œåœ¨è¿™é‡Œå®šä¹‰
pwmech="openssl"	# å¦‚æœæ˜¯ openssl(ç”Ÿæˆéšæœºæ•°) åˆ™ä½¿ç”¨ openssl æŒ‡ä»¤ç”Ÿæˆ base64 çš„ 6 ä½æ•°éšæœºå¯†ç 
homeperm="no"		# å¦‚æœä¿®æ”¹ä¸º yesï¼Œåˆ™å°†è¯¥è´¦æˆ·å®¶ç›®å½•æƒé™ä¿®æ”¹ä¸º 711

# 1. æ£€æŸ¥ accountadd.txt æ–‡ä»¶
action="${1}"			# create ä½¿ç”¨ useradd æŒ‡ä»¤ã€delete ä½¿ç”¨ userdel æŒ‡ä»¤
if [ ! -f accountadd.txt ]; then
	echo "accountadd.txt æ–‡ä»¶ä¸å­˜åœ¨ï¼"
	exit 1
fi

# å¦‚æœæœ‰ç¾¤ç»„ï¼Œåˆ™å»ºç«‹ç³»ç»Ÿç¾¤ç»„
[ "${usergroup}" != "" ] && groupadd -r ${usergroup}
rm -f outputpw.txt
usernames=$(cat accountadd.txt)

for username in ${usernames} 
do
	case ${action} in
		"create")
			# å­˜åœ¨ç»„åˆ™æ‹¼æ¥é€‰é¡¹ -G æ˜¯ä¸ºè¯¥ç”¨æˆ·æ·»åŠ æ¬¡è¦ç¾¤ç»„
			[ "${usergroup}" != "" ] && usegrp=" -G ${usergroup} " || usegrp=""
			useradd ${usegrp} ${username}	# æ–°å¢è´¦æˆ·
			# å¦‚æœæ²¡æœ‰å€¼åˆ™ä½¿ç”¨ç”¨æˆ·åä½œä¸ºå¯†ç 
			[ "${pwmech}" == "openssl" ] && usepw=$(openssl rand -base64 6) || usepw=${username}
			echo ${usepw} | passwd --stdin ${username}  # åˆ›å»ºå¯†ç 
			chage -d 0 ${username}		# é…ç½®é¦–æ¬¡ç™»é™†å¿…é¡»ä¿®æ”¹å¯†ç 
			[ "${homeperm}" == "yes" ] && chmod 711 /home/${username}
			echo "username=${username},password=${usepw}" >> outputpw.txt
		;;
		"delete")
			echo "åˆ é™¤ç”¨æˆ· ${username}"
			userdel -r ${username}			# -r å°†ç”¨æˆ·å®¶ç›®å½•ä¹Ÿåˆ é™¤
		;;
		*)
			echo "è¯·ä½¿ç”¨ï¼š$0 [create|dellete]"
		;;
	esac
done
```

è„šæœ¬å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œæµ‹è¯•

```bash
vim accountadd.txt

std01
std02
std03
std04
std05
```

```bash
sh accountadd.sh create
[root@study ~]# sh accountadd.sh create
æ›´æ”¹ç”¨æˆ· std01 çš„å¯†ç  ã€‚
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚
æ›´æ”¹ç”¨æˆ· std02 çš„å¯†ç  ã€‚
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚
æ›´æ”¹ç”¨æˆ· std03 çš„å¯†ç  ã€‚
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚
æ›´æ”¹ç”¨æˆ· std04 çš„å¯†ç  ã€‚
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚
æ›´æ”¹ç”¨æˆ· std05 çš„å¯†ç  ã€‚
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚

[root@study ~]# cat outputpw.txt 
username=std01,password=s4j4jdwr
username=std02,password=G4iW/O6M
username=std03,password=HGO0rvI8
username=std04,password=17NAhvgS
username=std05,password=Q2CftODm

# å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„è´¦æˆ·å’Œå¯†ç ä¿¡æ¯ï¼Œä½ å¯ä»¥æ‰“å°å‡ºæ¥ï¼Œä¸€è¡Œä¸€æ¡è£å‰ªï¼Œç„¶åå‘ç»™ä½¿ç”¨è€…
```

