---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# ä¸»æœºçš„ç»†éƒ¨æƒé™è§„åˆ’ï¼šACL çš„ä½¿ç”¨

ä»ç¬¬ 5 ç« å¼€å§‹ï¼Œåœ¨å¼ºè°ƒ Linux çš„æƒé™æ¦‚å¿µéå¸¸é‡è¦ï¼Œä¼ ç»Ÿçš„æƒé™ä»…æœ‰ä¸‰ç§èº«ä»½ï¼ˆownerã€groupã€othersï¼‰æ­é…ä¸‰ç§æƒé™ï¼ˆrã€wã€xï¼‰ï¼Œæ— æ³•å•çº¯çš„é’ˆå¯¹æŸä¸€ä¸ªä½¿ç”¨è€…æˆ–æŸä¸€ä¸ªç¾¤ç»„æ¥è®¾ç½®è®¾ç½®ç‰¹æ®Šçš„æƒé™éœ€æ±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨ ACl è¿™ä¸ªæœºåˆ¶äº†

## ğŸ€ ä»€ä¹ˆæ˜¯ ACl ä¸å¦‚ä½•æ”¯æŒå¯åŠ¨ ACl

ACl ï¼ˆAccess Control Listï¼‰ï¼Œä¸»è¦ç›®çš„æ˜¯æä¾›ä¼ ç»Ÿçš„ ownerã€groupã€others çš„ readã€writeã€execute æƒé™ä¹‹å¤–çš„ç‰¹æ®Šæƒé™éœ€æ±‚è®¾ç½®ã€‚ACL å¯ä»¥é’ˆå¯¹å•ä¸€ä½¿ç”¨è€…ã€å•ä¸€æ–‡ä»¶æˆ–ç›®å½•æ¥è¿›è¡Œ rã€wã€x çš„æƒé™è§„èŒƒï¼Œå¯¹äºéœ€è¦ç‰¹æ®Šæƒé™çš„ä½¿ç”¨çŠ¶å†µéå¸¸æœ‰å¸®åŠ©

ACl ä¸»è¦é’ˆå¯¹ä»¥ä¸‹æ–¹é¢æ¥æ§åˆ¶æƒé™ï¼š

- ä½¿ç”¨è€… user
- ç¾¤ç»„ group
- é»˜è®¤å±æ€§ maskï¼šé’ˆå¯¹åœ¨è¯¥ç›®å½•ä¸‹åœ¨å»ºç«‹æ–°æ–‡ä»¶/ç›®å½•æ—¶ï¼Œè§„èŒƒæ–°æ•°æ®çš„é»˜è®¤æƒé™

ç®€å•è¯´ï¼Œæœ‰ä¸€ä¸ªç›®å½•ï¼Œç»™ä¸€å †äººä½¿ç”¨ï¼Œæ¯ä¸ªäººæˆ–æ¯ä¸ªç¾¤ç»„æ‰€éœ€è¦çš„æƒé™å¹¶ä¸ç›¸åŒï¼Œä½¿ç”¨ä¼ ç»Ÿ Linux ä¸‰ç§èº«ä»½çš„ä¸‰ç§æƒé™æ˜¯æ— æ³•è¾¾åˆ°çš„ï¼Œå› æ­¤åŸºæœ¬ä¸Šï¼Œä¼ ç»Ÿçš„ Linux æƒé™åªèƒ½é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªç¾¤ç»„ä»¥åŠéæ­¤ç¾¤ç»„çš„å…¶ä»–äººè®¾ç½®æƒé™ã€‚æ— æ³•é’ˆå¯¹å•ä¸€ç”¨æˆ·æˆ–ä¸ªäººæ¥è®¾è®¡æƒé™ã€‚

### å¦‚ä½•å¯åŠ¨ ACl

åŸæœ¬ ACL æ˜¯ unix-like æ“ä½œç³»ç»Ÿé¢å¤–æ”¯æŒçš„é¡¹ç›®ï¼Œå› ä¸ºè¿‘å¹´æ¥å¯¹æƒé™éœ€æ±‚æ—¥ç›Šå¢å¤§ï¼Œå› æ­¤ç›®å‰ ACl å‡ ä¹å·²ç»é¢„è®¾åŠ å…¥æ‰€æœ‰åœºæ™¯çš„ Linux æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½å‚æ•°ä¸­ï¼ˆext2\3\4ã€xfs ç­‰ï¼‰ï¼Œæ‰€ä»¥æ— éœ€ä»»ä½•æ“ä½œã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥æ£€æµ‹æ˜¯å¦æ”¯æŒ ACL

```bash
[root@study mrcode]# dmesg | grep -i acl
# è¿™é‡Œ +ACl
[    1.329361] systemd[1]: systemd 219 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN)
# è¿™é‡Œ SGI XFS with ACLs
[    2.978756] SGI XFS with ACLs, security attributes, no debug enabled
```

ç¬”è€…ç–‘é—®ï¼šæ€ä¹ˆç¡®å®š xfs æ”¯æŒï¼Ÿéš¾é“æ˜¯å› ä¸ºæˆ‘è‡ªå·±çŸ¥é“æ˜¯åœ¨ xfs ç³»ç»Ÿä¸Šï¼Ÿ

## ğŸ€ ACL çš„è®¾ç½®æŠ€å·§ï¼šgetfaclã€setfacl

- getfaclï¼šå–å¾—æŸä¸ªæ–‡ä»¶/ç›®å½•çš„ ACL è®¾ç½®ä¿¡æ¯
- setfaclï¼šè®¾ç½®æŸä¸ªæ–‡ä»¶/ç›®å½•çš„ ACl

### setfacl æŒ‡ä»¤ç”¨æ³•ä»‹ç»ä»¥åŠæœ€ç®€å•çš„ `u:è´¦æˆ·:æƒé™` è®¾ç½®

```bash
setfacl [-bkRd] [{-ml -x} acl å‚æ•°] ç›®æ ‡æ–‡ä»¶å

é€‰é¡¹ä¸å‚æ•°ï¼š
	-mï¼šè®¾ç½®åç»­çš„ acl å‚æ•°ç»™æ–‡ä»¶ä½¿ç”¨ï¼Œä¸å¯ä¸ -x åˆç”¨
	-xï¼šåˆ é™¤åç»­çš„ acl å‚æ•°ï¼Œä¸å¯ä¸ -m åˆç”¨
	-bï¼šç§»é™¤ æ‰€æœ‰çš„ ACL è®¾ç½®å‚æ•°
	-kï¼šç§»é™¤ é¢„è®¾çš„ ACL å‚æ•°ï¼›ï¼ˆå…³äºæ‰€è°“çš„é¢„è®¾å‚æ•°åç»­ä»‹ç»ï¼‰
	-Rï¼šé€’å½’è®¾ç½® aclï¼ŒåŒ…æ‹¬æ­¤ç›®å½•ä¹Ÿä¼šè¢«è®¾ç½®
	-dï¼šè®¾ç½® ã€Œé¢„è®¾ acl å‚æ•°ã€çš„æ„æ€ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆï¼Œåœ¨è¯¥ç›®å½•æ–°å»ºçš„æ•°æ®ä¼šå¼•ç”¨æ­¤é»˜è®¤å€¼
```

ä¸Šé¢æ˜¯ acl çš„é€‰é¡¹åŠŸèƒ½ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€äº›ç‰¹æ®Šæƒé™çš„è®¾ç½®æ–¹å¼ï¼š

```bash
# 1. é’ˆå¯¹ç‰¹å®šä½¿ç”¨è€…çš„æ–¹å¼
# è®¾ç½®è§„èŒƒï¼šã€Œu:[ä½¿ç”¨è€…è´¦æˆ·åˆ—è¡¨]:[rwx]ã€
# ä¾‹å¦‚ é’ˆå¯¹ mrcode1 çš„æƒé™è®¾ç½®ä¸º rx
[root@study ~]# touch acl_test1
[root@study ~]# ll acl_test1 
-rw-r--r--. 1 root root 0 2æœˆ  24 16:47 acl_test1
[root@study ~]# setfacl -m u:mrcode1:rx acl_test1 
[root@study ~]# ll acl_test1 
-rw-r-xr--+ 1 root root 0 2æœˆ  24 16:47 acl_test1
# æƒé™éƒ¨åˆ†å¤šäº†ä¸€ä¸ª +ï¼Œä¸”ä¸åŸæœ¬çš„æƒé™ 644 çœ‹èµ·æ¥å·®å¼‚å¾ˆå¤§ã€‚

[root@study ~]# setfacl -m u::rwx acl_test1 
[root@study ~]# ll acl_test1 
-rwxr-xr--+ 1 root root 0 2æœˆ  24 16:47 acl_test1
# è®¾ç½® u åé¢æ— ä½¿ç”¨è€…åˆ—è¡¨ï¼Œä»£è¡¨è®¾ç½®è¯¥æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œæ‰€ä»¥ä¸Šçº¿æ˜¾ç¤º root çš„å…¨æ–‡ä¸º rwx äº†
```

ä¸Šé¢æ˜¯è®¾ç½®ï¼Œæƒé™éƒ¨åˆ†ä¼šå¤šå‡ºä¸€ä¸ª + å·ï¼Œä¼ ç»Ÿçš„ ll æ˜¯ä¸çŸ¥é“è®¾ç½®äº†ä»€ä¹ˆçš„ï¼Œå¯ä»¥é€šè¿‡  getfacl æ¥æŸ¥é˜…

### getfacl æŒ‡ä»¤ç”¨æ³•

```bash
getfacl filename

é€‰é¡¹ä¸å‚æ•°ï¼šå‡ ä¹ä¸ setfacl ç›¸åŒï¼Œè¿™é‡Œä¸è´´äº†
```

```bash
# åˆ—å‡ºåˆšåˆšè®¾ç½®çš„ acl_test1 çš„æƒé™å†…å®¹
[root@study ~]# getfacl acl_test1 
# file: acl_test1			# æ–‡ä»¶å
# owner: root				# æ‹¥æœ‰è€…ï¼Œls -l çœ‹åˆ°çš„ç¬¬ 3 å­—æ®µ
# group: root				# è¯¥æ–‡ä»¶æ‰€å±ç¾¤ç»„ï¼Œls -l çœ‹åˆ°çš„ç¬¬ 4 å­—æ®µ
user::rwx					# ä½¿ç”¨è€…åˆ—è¡¨æ æ˜¯ç©ºçš„ï¼Œæ ‡è¯†è¯¥æƒé™è®¾ç½®é’ˆå¯¹çš„æ˜¯æ–‡ä»¶çš„æ‹¥æœ‰è€…
user:mrcode1:r-x			# é’ˆå¯¹ mrcode1 çš„æƒé™è®¾ç½®ä¸º rxï¼Œä¸æ‹¥æœ‰è€…ä¸åŒ
group::r--					# ç¾¤ç»„çš„è®¾ç½®
mask::r-x					# æ­¤æ–‡ä»¶é¢„è®¾çš„æœ‰æ•ˆæƒé™ mask
other::r--					# å…¶ä»–äººæ‹¥æœ‰çš„æƒé™
```

### ç‰¹å®šçš„å•ä¸€ç¾¤ç»„çš„æƒé™è®¾ç½®ï¼š`g:ç¾¤ç»„å:æƒé™`

```bash
# 2. é’ˆå¯¹ç‰¹å®šç¾¤ç»„çš„æ–¹å¼
# è®¾ç½®è§„èŒƒï¼šã€Œg:[ç¾¤ç»„åˆ—è¡¨]:[rwx]ã€
# é’ˆå¯¹ mygroup1 çš„æƒé™è®¾ç½®ä¸º rx
[root@study ~]# setfacl -m g:mygroup1:rx acl_test1 
[root@study ~]# getfacl acl_test1 
# file: acl_test1
# owner: root
# group: root
user::rwx
user:mrcode1:r-x
group::r--
group:mygroup1:r-x				# å¤šäº†è¿™ä¸ªæƒé™è®¾ç½®
mask::r-x
other::r--
```

### é’ˆå¯¹æœ‰æ•ˆæƒé™è®¾ç½®ï¼š`m:æƒé™`

ç¾¤ç»„ä¸ä½¿ç”¨è€…è®¾ç½®ç±»ä¼¼ï¼Œä½†æ˜¯é‚£ä¸ª mask æœ‰ç‚¹åƒæ˜¯ã€Œæœ‰æ•ˆæƒé™ã€çš„æ„æ€ï¼šä½¿ç”¨è€…æˆ–ç¾¤ç»„æ‰€è®¾ç½®çš„æƒé™å¿…é¡»è¦å­˜åœ¨ä¸ mask çš„æƒé™è®¾ç½®èŒƒå›´å†…æ‰ä¼šç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯æœ‰æ•ˆæƒé™ effective permission

```bash
# 3. é’ˆå¯¹æœ‰æ•ˆå…¨æ˜¯ mask çš„è®¾ç½®æ–¹å¼
# è®¾ç½®è§„èŒƒï¼šã€Œm:[rwx]ã€
# é’ˆå¯¹åˆšåˆšçš„æ–‡ä»¶è§„èŒƒä»…æœ‰ r
[root@study ~]# setfacl -m m:r acl_test1 
[root@study ~]# getfacl acl_test1 
# file: acl_test1
# owner: root
# group: root
user::rwx
user:mrcode1:r-x		#effective:r--		# æœ‰æ•ˆæƒé™åªæœ‰ r
group::r--
group:mygroup1:r-x		#effective:r--
mask::r--
other::r--

```

è¯¥åŠŸèƒ½å¯ä»¥é€šè¿‡ mask æ¥è§„èŒƒæœ€å¤§å…è®¸çš„æƒé™ï¼Œå°±èƒ½é¿å…ä¸å°å¿ƒå¼€æ”¾æŸäº›æƒé™ç»™å…¶ä»–ä½¿ç”¨è€…æˆ–è€…ç¾¤ç»„äº†ã€‚ä¸è¿‡ï¼Œé€šå¸¸éƒ½æ˜¯å°† mask è®¾ç½®ä¸º rwxï¼Œå†åˆ†åˆ«ä¾æ®ä¸åŒçš„ä½¿ç”¨è€…ã€ç¾¤ç»„å»è§„èŒƒä»–ä»¬çš„æƒé™

### ä¾‹é¢˜

```bash
# èŒƒä¾‹ 1ï¼š å°†å‰ä¸€å°èŠ‚ä»»åŠ¡äºŒä¸­ /srv/projecta ç›®å½•ï¼Œè®© myuser1 å¯ä»¥è¿›å…¥æŸ¥é˜…ï¼Œä½†æ˜¯ myuser1 ä¸å…·æœ‰ä¿®æ”¹çš„æƒé™
# ç”±äº myuser1 æ˜¯ç‹¬ç«‹çš„ä½¿ç”¨è€…ä¸ç¾¤ç»„ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ä¼ ç»Ÿçš„ Linux æƒé™è®¾ç½®ï¼Œæ­¤æ—¶åº”è¯¥ä½¿ç”¨ ACL çš„è®¾ç½®

# 1. å…ˆæµ‹è¯•ä½¿ç”¨ myuser1 èƒ½å¦è¿›å…¥è¯¥ç›®å½•
[myuser1@study ~]$ cd /srv/projecta/
-bash: cd: /srv/projecta/: Permission denied

# 2. ä¿®æ”¹ ACL æƒé™ä¸ºè¯»å’Œæ‰§è¡Œ
[root@study ~]# setfacl -m u:myuser1:rx /srv/projecta/
[root@study ~]# getfacl /srv/projecta/
getfacl: Removing leading '/' from absolute path names
# file: srv/projecta/
# owner: root
# group: projecta
# flags: -s-
user::rwx
user:myuser1:r-x		# è®¾ç½®äº†æƒé™
group::rwx
mask::rwx
other::---

# 3. æµ‹è¯•æ˜¯å¦æˆåŠŸè¿›å…¥
[myuser1@study ~]$ cd /srv/projecta/
[myuser1@study projecta]$ ll -a
total 0
drwxrws---+ 2 root projecta  6 Feb 24 15:04 .
drwxr-xr-x. 3 root root     22 Feb 24 15:04 ..
# æµ‹è¯•å†™å…¥ï¼Œç¼ºå°‘ä¸å¯å†™å…¥
[myuser1@study projecta]$ touch testing
touch: cannot touch 'testing': Permission denied

```

ä¸Šé¢ä¾‹å­å®Œæˆäº†ä¹‹å‰ä»»åŠ¡äºŒçš„åç»­éœ€æ±‚ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸‹é»˜è®¤æƒé™ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºæ–°æ–‡ä»¶æ˜¯å¦èƒ½ç»§æ‰¿ ACl è®¾ç½®ï¼Ÿ

```bash
# ä½¿ç”¨ root è´¦æˆ·å–åˆ›å»ºç›®å½•å¯æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ç»§æ‰¿ acl è®¾ç½®
[root@study projecta]# touch abc1
[root@study projecta]# mkdir abc2
[root@study projecta]# ll -d abc*;
-rw-r--r--. 1 root projecta 0 Feb 25 09:32 abc1
drwxr-sr-x. 2 root projecta 6 Feb 25 09:32 abc2
```

å¯ä»¥çœ‹åˆ°æƒé™åé¢æ²¡æœ‰ `+` å·å‡ºç°ï¼Œæ ‡è¯†è¿™ä¸ª acl å±æ€§æ²¡æœ‰è¢«ç»§æ‰¿

### ä½¿ç”¨é»˜è®¤æƒé™è®¾ç½®ç›®å½•æœªæ¥æ–‡ä»¶çš„ ACL æƒé™ç»§æ‰¿ `d:[u|g]:[user|group]:æƒé™`

```bash
# è®¾ç½®è§„èŒƒï¼šd:[u|g]:[user|group ä½¿ç”¨è€…åˆ—è¡¨]:[æƒé™ rwx]
# è®© myuser1 åœ¨ /srv/projeecta ç›®å½•ä¸‹ä¸€ç›´å…·æœ‰ rx çš„é¢„è®¾æƒé™
[root@study projecta]# setfacl -m d:myuser1:rx /srv/projecta/
[root@study projecta]# getfacl /srv/projecta
getfacl: Removing leading '/' from absolute path names
# file: srv/projecta
# owner: root
# group: projecta
# flags: -s-
user::rwx
user:myuser1:r-x
group::rwx
mask::rwx
other::---
default:user::rwx
default:user:myuser1:r-x			# å¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»è¢«è®¾ç½®ä¸Šäº†
default:group::rwx
default:mask::rwx
default:other::---
```

è®¾ç½®ä¹‹åï¼Œè¿˜å‡ºç°äº†å…¶ä»–é’ˆå¯¹æ‹¥æœ‰è€…çš„ default é…ç½®ã€‚æ‰€ä»¥è¿™é‡Œå†æ¬¡ä½¿ç”¨ root è´¦æˆ·å–åˆ›å»ºï¼Œä¹Ÿèƒ½çœ‹åˆ°ç»§æ‰¿æ•ˆæœäº†

```bash
[root@study projecta]# touch abc1
[root@study projecta]# mkdir abc2
[root@study projecta]# ll -d abc*
-rw-rw----+ 1 root projecta 0 Feb 25 09:40 abc1
drwxrws---+ 2 root projecta 6 Feb 25 09:40 abc2
```

å¦‚æœéœ€è¦è®© ACL å±æ€§å…¨éƒ¨æ¶ˆå¤±ï¼Œå¯ä»¥é€šè¿‡ `setfacl -b æ–‡ä»¶å` è¾¾åˆ°æ•ˆæœ

### ä¾‹é¢˜ç»ƒä¹ 

#### ç¬¬ä¸€é¢˜

é’ˆå¯¹ `/srv/projecta` ç›®å½•çš„æƒé™è®¾ç½®ä¸­ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š

1. å–æ¶ˆ myuser1 çš„è®¾ç½®ï¼ˆåŒ…æ‹¬é»˜è®¤å€¼ï¼‰
2. ä¸èƒ½è®© pro3 è¿™ä¸ªç”¨æˆ·ä½¿ç”¨è¯¥ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ pro3 åœ¨è¯¥ç›®å½•ä¸‹æ²¡æœ‰ä»»ä½•æƒé™

```bash
# 1. å–æ¶ˆ myuser1 çš„è®¾ç½®å’Œé»˜è®¤å€¼
# å…ˆæŸ¥è¯¢åˆ°é…ç½®äº†å“ªäº›å±æ€§
[root@study projecta]# getfacl /srv/projecta/ | grep myuser1
getfacl: Removing leading '/' from absolute path names
user:myuser1:r-x
default:user:myuser1:r-x
# é€šè¿‡ -x å‚æ•°æ¥å–æ¶ˆï¼Œå–æ¶ˆçš„æ—¶å€™ï¼Œä¸éœ€è¦å†™æƒé™ï¼Œç›´æ¥å†™å‰é¢å®šä½éƒ¨ä½
[root@study projecta]# setfacl -x u:myuser1 /srv/projecta/
[root@study projecta]# setfacl -x d:myuser1 /srv/projecta/
[root@study projecta]# getfacl /srv/projecta/ | grep myuser1


# 2.è®© pro3 è¿™ä¸ªç”¨æˆ·æ— æ³•ä½¿ç”¨è¯¥ç›®å½•
[root@study projecta]# setfacl -m u:pro3:- /srv/projecta/
[root@study projecta]# getfacl /srv/projecta/ | grep pro3   
getfacl: Removing leading '/' from absolute path names
user:pro3:---			# è¿™æ ·ä¸€æ¥å°±æ²¡æœ‰ä»»ä½•æƒé™äº†
```

