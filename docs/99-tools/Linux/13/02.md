---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# è´¦å·ç®¡ç†

ç”±æ–°å¢ä¸ç§»é™¤ä½¿ç”¨è€…å¼€å§‹è®²è§£

## ğŸ€ æ–°å¢ä¸ç§»é™¤è´¦æˆ·ï¼ˆä½¿ç”¨è€…ï¼‰

æ¶‰åŠåˆ° useraddã€ç›¸å…³é…ç½®æ–‡ä»¶ã€passwdã€usermodã€userdel ç­‰çŸ¥è¯†ç‚¹

### useradd

```bash
useradd [-u UID] [-g åˆå§‹ç¾¤ç»„] [-G æ¬¡è¦ç¾¤ç»„] [-mM] [-c è¯´æ˜æ ] [-d å®¶ç›®å½•ç»å¯¹è·¯å¾„] [-s shell] ä½¿ç”¨è€…è´¦æˆ·

é€‰é¡¹ä¸å‚æ•°ï¼š

	-uï¼šUID æ˜¯ä¸€ç»„æ•°å­—ã€‚ç›´æ¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ UID ç»™è¯¥è´¦æˆ·
	-gï¼šå­—ç¬¦ä¸²çš„åˆå§‹ç»„åï¼Œè¯¥å­—ç¬¦ä¸²çš„ GID åœ¨ /etc/passwd çš„ç¬¬ 3 ä¸ªå­—æ®µå†…
	-Gï¼šå­—ç¬¦ä¸²çš„æ¬¡è¦ç¾¤ç»„ï¼Œè¯¥é€‰é¡¹ä¼šä¿®æ”¹ /etc/group å†…çš„ç›¸å…³å­—æ®µ
	-Mï¼šå¼ºåˆ¶ï¼ä¸è¦å»ºç«‹ç”¨æˆ·å®¶ç›®å½•ï¼ˆç³»ç»Ÿè´¦æˆ·é»˜è®¤å€¼ï¼‰
	-mï¼šå¼ºåˆ¶ï¼è¦å»ºç«‹ç”¨æˆ·å®¶ç›®å½•ï¼ˆä¸€èˆ¬è´¦æˆ·é»˜è®¤ï¼‰
	-cï¼š/etc/passwd ä¸­ç¬¬ 5 å­—æ®µçš„è¯´æ˜å†…å®¹ï¼Œå¯ä»¥éšä¾¿è®¾ç½®
	-dï¼šæŒ‡å®šæŸä¸ªç›®å½•æˆä¸ºå®¶ç›®å½•ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨å†³å®šè·¯å¾„
	-rï¼šå»ºç«‹ä¸€ä¸ªç³»ç»Ÿè´¦æˆ·ï¼Œè¯¥è´¦æˆ·çš„ UID æœ‰é™åˆ¶ï¼ˆå‚è€ƒ /etc/login.defsï¼‰
	-sï¼šåé¢æ¥ä¸€ä¸ª shellï¼Œè‹¥æ²¡æœ‰æŒ‡å®šåˆ™é¢„è®¾æ˜¯ /bin/bash
	-eï¼šåé¢æ¥ä¸€ä¸ªæ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DD ï¼Œæ­¤é¡¹å¯å†™å…¥ shadow ç¬¬ 8 å­—æ®µï¼Œå³æ˜¯è´¦æˆ·å¤±æ•ˆæ—¥æœŸ
	-fï¼šåé¢æ¥ shadow çš„ç¬¬ 7 å­—æ®µï¼Œè¯¥å¯†ç æ˜¯å¦ä¼šå¤±æ•ˆã€‚0 ä¸ºç«‹åˆ»å¤±æ•ˆï¼Œ-1 ä¸ºæ°¸è¿œä¸å¤±æ•ˆï¼ˆå¯†ç åªä¼šè¿‡æœŸè€Œå¼ºåˆ¶åŸŸç™»å½•æ—¶é‡æ–°è®¾ç½®ï¼‰

```

æ³¨æ„è¿™é‡Œæ˜¯æ²¡æœ‰å¯†ç é…ç½®çš„ï¼Œå¯†ç çš„è®¾ç½®éœ€è¦ç”¨åˆ° passwd æŒ‡ä»¤

å®è·µç»ƒä¹ ï¼Œåˆ›å»ºä¸€èˆ¬è´¦æˆ·

```bash
# èŒƒä¾‹ 1ï¼š å®Œå…¨å‚è€ƒé»˜è®¤å€¼åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œåç§°ä¸º mrcode1
[root@study ~]# useradd mrcode1
[root@study ~]# ll -d /home/mrcode1/
drwx------. 3 mrcode1 mrcode1 78 Feb 20 17:12 /home/mrcode1/
# é»˜è®¤ä¼šåˆ›å»ºå®¶ç›®å½•ï¼Œä¸”æƒé™ä¸º 700ï¼Œè¿™æ˜¯é‡ç‚¹ï¼

[root@study ~]# grep mrcode1 /etc/passwd /etc/shadow /etc/group
/etc/passwd:mrcode1:x:1001:1001::/home/mrcode1:/bin/bash
/etc/shadow:mrcode1:!!:18312:0:99999:7:::
/etc/group:mrcode1:x:1001:			# é¢„è®¾ä¼šå»ºç«‹ä¸€ä¸ªä¸è´¦æˆ·åŒåçš„ç¾¤ç»„å
```

å¯ä»¥çœ‹åˆ°ç³»ç»Ÿè§„å®šå¥½äº†éå¸¸å¤šçš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥å¯ä»¥ç®€å•çš„ä½¿ç”¨ useradd è´¦æˆ·å æ¥åˆ›å»ºä½¿ç”¨è€…ã€‚ CentOS è¿™äº›é»˜è®¤å€¼ä¸»è¦ä¼šå¸®æˆ‘ä»¬å¤„ç†å‡ ä¸ªæ“ä½œ

- åœ¨ `/etc/passwd` ä¸­åˆ›å»ºä¸€è¡Œä¸è´¦æˆ·ç›¸å…³çš„æ•°æ®ï¼ŒåŒ…æ‹¬å»ºç«‹ UIDã€GIDã€å®¶ç›®å½•ç­‰
- åœ¨ `/etc/shadow` ä¸­åˆ›å»ºè¯¥è´¦æˆ·çš„å¯†ç ç›¸å…³å‚æ•°ï¼Œä½†æ˜¯æ— å¯†ç 
- åœ¨ `/etc/group` ä¸­åˆ›å»ºä¸€ä¸ªä¸è´¦æˆ·ååŒåçš„ç»„å
- åœ¨ `/home` ä¸‹åˆ›å»ºä¸€ä¸ªä¸è´¦æˆ·åŒåçš„ç›®å½•ä½œä¸ºå®¶çš„ç›®å½•ï¼Œä¸”æƒé™ä¸º 700

å¯¹äºè´¦æˆ·å¯†ç éœ€è¦ä½¿ç”¨ passwd æŒ‡ä»¤æ¥å®Œæˆã€‚å¦‚æœéœ€è¦å®šåˆ¶ç›¸å…³å‚æ•°ï¼Œå°±éœ€è¦ä½¿ç”¨é€‰é¡¹ä¸å‚æ•°æ¥è¯¦ç»†å®šåˆ¶äº†

```bash
# èŒƒä¾‹ 2ï¼šå‡è®¾å·²çŸ¥é“ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç»„åä¸º usersï¼Œä¸” UID 1500 å¹¶ä¸å­˜åœ¨ï¼Œè¯·ç”¨ users ä¸ºåˆå§‹ç¾¤ç»„ï¼Œä»¥åŠ UID ä¸º 1500 åˆ›å»ºä¸€ä¸ªåä¸º mrcode2 çš„è´¦æˆ·
[root@study ~]# useradd -u 1500 -g users mrcode2
[root@study ~]# ll -d /home/mrcode2
drwx------. 3 mrcode2 users 78 Feb 20 17:20 /home/mrcode2

[root@study ~]# grep mrcode2 /etc/passwd /etc/shadow /etc/group
/etc/passwd:mrcode2:x:1500:100::/home/mrcode2:/bin/bash
/etc/shadow:mrcode2:!!:18312:0:99999:7:::
# å¯¹æ¯”ä¸Šè¿°æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯å‘ç°å°‘äº†ä¸€ä¸ª mrcode2 çš„ç¾¤ç»„ï¼Ÿå› ä¸ºåˆå§‹ç¾¤ç»„æ˜¯ usersï¼ˆå¹¶ä¸”å·²ç»å­˜åœ¨äº†ï¼‰ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦åˆ›å»º mrcode2 ç¾¤ç»„äº†
```

åˆ›å»ºç³»ç»Ÿè´¦æˆ·ï¼ˆsystem accountï¼‰

```bash
# èŒƒä¾‹ 3 ï¼šåˆ›å»ºä¸€ä¸ªç³»ç»Ÿè´¦æˆ·ï¼Œåä¸º mrcode3
[root@study ~]# useradd -r mrcode3

# å¯ä»¥çœ‹åˆ°æ²¡æœ‰åˆ›å»ºå®¶çš„ç›®å½•
[root@study ~]# ll -d /home/mrcode3
ls: cannot access /home/mrcode3: No such file or directory

[root@study ~]# grep /etc/passwd /etc/shadow /etc/group
/etc/passwd:mrcode3:x:988:982::/home/mrcode3:/bin/bash
/etc/shadow:mrcode3:!!:18312::::::
/etc/group:mrcode3:x:982:

```

æ³¨æ„ä¸Šé¢çš„ 988:982,å‰é¢è°ˆåˆ°è¿‡ï¼Œä¸€èˆ¬è´¦æˆ·çš„ UID ä¸º 1000 ä»¥åï¼Œé‚£ä¹ˆç”¨æˆ·åˆ›å»ºçš„ç³»ç»Ÿè´¦æˆ·ä¸€èˆ¬æ˜¯å°äº 1000 çš„ã€‚å¦å¤–ç”±äºç³»ç»Ÿè´¦æˆ·è¦æ˜¯ç”¨æ¥è¿›è¡Œè¿è¡Œæ“ä½œç³»ç»Ÿæ‰€éœ€æœåŠ¡çš„æƒé™è®¾ç½®ï¼Œæ‰€ä»¥ç³»ç»Ÿè´¦æˆ·é»˜è®¤éƒ½ä¸ä¼šä¸»åŠ¨å»ºç«‹å®¶çš„ç›®å½•

ç³»ç»Ÿå†…ç½®äº†é»˜è®¤å€¼ï¼Œé‚£ä¹ˆè¿™äº›é»˜è®¤å€¼æ˜¯å‡ºè‡ªå“ªé‡Œçš„å‘¢ï¼Ÿè¿™å°±éœ€è¦äº†è§£ä¸‹ useradd æ‰€ä½¿ç”¨çš„å‚è€ƒæ–‡ä»¶äº†

### ç›¸å…³é…ç½®æ–‡ä»¶ï¼ˆuseradd å‚è€ƒæ–‡ä»¶ï¼‰

å¯ä»¥ä½¿ç”¨ `useradd -D`æ˜¾ç¤ºé»˜è®¤å€¼

```bash
[root@study ~]# useradd -D
GROUP=100						# é¢„è®¾ç¾¤ç»„
HOME=/home						# é»˜è®¤åŠ ç›®å½•æ‰€åœ¨ç›®å½•
INACTIVE=-1						# å¯†ç å¤±æ•ˆæ—¥ï¼Œåœ¨ shadow å†…çš„ç¬¬ 7 å­—æ®µ
EXPIRE=							# è´¦æˆ·å¤±æ•ˆæ—¥ï¼Œåœ¨ shadow å†…çš„ç¬¬ 8 å­—æ®µ
SHELL=/bin/bash					# é¢„è®¾çš„ shell
SKEL=/etc/skel					# ç”¨æˆ·å®¶çš„ç›®å½•å†…å®¹æ•°æ®å‚è€ƒç›®å½•
CREATE_MAIL_SPOOL=yes			# æ˜¯å¦ä¸»åŠ¨å¸®ä½¿ç”¨è€…å»ºç«‹é‚®ä»¶ä¿¡æ¯ï¼ˆmailboxï¼‰
```

#### `/etc/default/useradd`

ä»¥ä¸Šä¿¡æ¯æ˜¯å­˜åœ¨ `/etc/default/useradd` æ–‡ä»¶ä¸­çš„ï¼Œé‚£ä¹ˆé»˜è®¤å€¼é€ æˆçš„è¡Œä¸ºæ˜¯ï¼š

- `GROUP=100`ï¼š100 è¿™ä¸ª GID å¯¹åº”çš„ç¾¤ç»„ä¹Ÿå°±æ˜¯ users

  ä½†æ˜¯å¯¹äº mrcode1 æ¥è¯´ï¼Œä»–çš„åˆå§‹ç¾¤ç»„æ˜¯ mrcode1ï¼Œè€Œä¸æ˜¯ usersï¼Œè¿™æ˜¯å› ä¸ºé’ˆå¯¹ç¾¤ç»„çš„è§’åº¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š

  - ç§æœ‰ç¾¤ç»„æœºåˆ¶

    ç³»ç»Ÿä¼šå»ºç«‹ä¸€ä¸ªä¸è´¦æˆ·ä¸€æ ·çš„ç¾¤ç»„ç»™ä½¿ç”¨è€…ä½œä¸ºåˆå§‹ç¾¤ç»„ã€‚è¿™ç§æœºåˆ¶æ¯”è¾ƒæœ‰ä¿å¯†æ€§ï¼Œå› ä¸ºä½¿ç”¨è€…éƒ½æœ‰è‡ªå·±çš„ç¾¤ç»„ï¼Œè€Œå®¶ç›®å½•æƒé™ä¹Ÿå°†ä¼šè®¾å®šä¸º 700ï¼ˆä»…æœ‰è‡ªå·±å¯ä»¥è¿›å…¥è‡ªå·±çš„å®¶ç›®å½•ï¼‰ã€‚ä»£è¡¨æ€§çš„ distributions æœ‰ RHELã€Fedoraã€CentOS ç­‰

  - å…¬å…±ç¾¤ç»„æœºåˆ¶

    å°±æ˜¯ä»¥é»˜è®¤å€¼æ¥ç»™å®šåˆå§‹ç¾¤ç»„ï¼Œå› æ­¤æ¯ä¸ªè´¦æˆ·éƒ½å±äº usersï¼ˆé»˜è®¤å€¼ï¼‰ç¾¤ç»„ï¼Œä¸”é»˜è®¤å®¶ç›®å½•é€šå¸¸çš„æƒé™ä¼šæ˜¯ `drwx-xr-x ... username users ...`ã€‚ä»£è¡¨ distributions æœ‰ SuSE ç­‰

  æˆ‘ä»¬çš„å­¦ä¹ æœºæ˜¯ CentOSï¼Œæ‰€ä»¥çœ‹åˆ°çš„ä¸æ˜¯é»˜è®¤å€¼

- `HOME=/home`ï¼šç”¨æˆ·å®¶ç›®å½•çš„åŸºå‡†ç›®å½•ï¼ˆbasedirï¼‰

  ç”¨æˆ·åçš„å®¶ç›®å½•é€šå¸¸æ˜¯ä¸è´¦æˆ·åç›¸åŒçš„ï¼Œæ¯”å¦‚ /home/mrcode1

- `INACTIVE=-1`ï¼šå¯†ç è¿‡æœŸåæ˜¯å¦ä¼šå¤±æ•ˆçš„è®¾å®šå€¼

  åœ¨å‰é¢è®²åˆ° shadow æ–‡ä»¶ç»“æ„ï¼Œç¬¬ 7 ä¸ªå­—æ®µå°†ä¼šå½±å“å¯†ç è¿‡æœŸåï¼Œåœ¨å¤šä¹…æ—¶é—´å†…è¿˜å¯ä»¥ä½¿ç”¨æ—§å¯†ç ç™»å½•ã€‚0 è¡¨ç¤ºç«‹åˆ»å¤±æ•ˆï¼Œ-1 è¡¨ç¤ºæ°¸è¿œä¸å¤±æ•ˆï¼Œå¦‚ 30 ï¼Œåˆ™æ ‡è¯†è¿‡æœŸ 30 å¤©åå¤±æ•ˆ

- `EXPIRE=` ï¼šè´¦æˆ·å¤±æ•ˆæ—¥æœŸ

  shadow æ–‡ä»¶ä¸­ç¬¬ 8 å­—æ®µå†…å®¹ï¼Œè®¾ç½®è´¦æˆ·åœ¨å“ªä¸ªæ—¥æœŸåç›´æ¥å¤±æ•ˆï¼Œé€šå¸¸ä¸ä¼šè®¾ç½®æ­¤é¡¹ç›®ï¼Œå¦‚æœæ˜¯ä»˜è´¹çš„å›ä¼šå‘˜ç³»ç»Ÿï¼Œåˆ™æœ‰å¯èƒ½ä½¿ç”¨

- `SHELL=/bin/bash`ï¼šé»˜è®¤ä½¿ç”¨çš„ shell ç¨‹åºæ–‡ä»¶å

  å‡å¦‚ä½ çš„ç³»ç»Ÿä¸º mail serverï¼Œå¸Œæœ›æ¯ä¸ªè´¦æˆ·åªèƒ½ä½¿ç”¨ email çš„æ”¶å‘ä¿¡åŠŸèƒ½ï¼Œä¸å…è®¸ç”¨æˆ·ç™»å½•ç³»ç»Ÿå–å¾— shellï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸º `/sbin/nologin`ï¼Œé‚£ä¹ˆé¢„è®¾æ–°ç”¨æˆ·åˆ›å»ºåå°±æ— æ³•ç™»å½•äº†ã€‚

- `SKEL=/etc/skel`ï¼šç”¨æˆ·å®¶ç›®å½•å‚è€ƒåŸºå‡†ç›®å½•

  æ¯”å¦‚ä¸€ä¸ªæ–°ç”¨æˆ· mrcode1 ï¼Œé‚£ä¹ˆä»–çš„å®¶çš„ç›®å½• `/home/mrcode1` ä¸­çš„æ•°æ®æ˜¯ç”±è¿™é‡Œçš„åŸºå‡†ç›®å½•ä¸­çš„æ•°æ®å¤åˆ¶è¿‡å»çš„ã€‚

- `CREATE_MAIL_SPOOL=yes`ï¼šå»ºç«‹ä½¿ç”¨è€…çš„ mailbox

  `ll /var/spool/mail/mrcode1` æŸ¥çœ‹ä¼šå­˜åœ¨è¯¥æ–‡ä»¶ï¼Œ

#### `/etc/login.defs`

åˆä¸Šä¸Šè¿°çš„åŸºæœ¬è®¾ç½®ä¹‹å¤–ï¼Œ UID/GID å¯†ç å‚æ•°æ˜¯åœ¨ `/etc/login.defs` ä¸­é…ç½®çš„

```bash
# è¿™é‡Œå»æ‰äº†åŸå§‹æ–‡ä»¶ä¸­çš„æ³¨é‡Šæè¿°
MAIL_DIR	/var/spool/mail				# ç”¨æˆ·é»˜è®¤é‚®ç®±ç›®å½•

PASS_MAX_DAYS	99999					# /etc/shadow å†…çš„ç¬¬ 5 å­—æ®µï¼Œå¤šå°‘å¤©éœ€è¦å˜æ›´å¯†ç 
PASS_MIN_DAYS	0						# /etc/shadow å†…çš„ç¬¬ 4 å­—æ®µï¼Œå¤šå°‘å¤©ä¸å¯é‡æ–°è®¾ç½®å¯†ç 
PASS_MIN_LEN	5						# å¯†ç æœ€çŸ­çš„å­—ç¬¦é•¿åº¦ï¼Œå·²è¢« pam æ¨¡å—å–ä»£ï¼Œè¯¥é…ç½®å·²å¤±æ•ˆ
PASS_WARN_AGE	7						# /etc/shadow å†…çš„ç¬¬ 6 å­—æ®µï¼Œè¿‡æœŸå‰ 7 å¤©ä¼šå‘é€è­¦å‘Šæ¶ˆæ¯

UID_MIN                  1000			# ç”¨æˆ·çš„æœ€å° UID ï¼Œ1000 ä»¥ä¸‹ç”±ç³»ç»Ÿä¿ç•™
UID_MAX                 60000			# æœ€å¤§çš„ UID
SYS_UID_MIN               201			# ä¿ç•™ç»™ç”¨æˆ·è‡ªè¡Œåˆ›å»ºçš„ç³»ç»Ÿè´¦æˆ·æœ€å° UID
SYS_UID_MAX               999			# ä¿ç•™ç»™ç”¨æˆ·è‡ªè¡Œåˆ›å»ºçš„ç³»ç»Ÿè´¦æˆ·æœ€å¤§ UID

GID_MIN                  1000			# è‡ªå®šä¹‰ç»„çš„æœ€å° GID
GID_MAX                 60000			# è‡ªå®šä¹‰ç»„çš„æœ€å¤§ GID
SYS_GID_MIN               201			# ä¿ç•™ç»™ç”¨æˆ·åˆ›å»ºçš„ç³»ç»Ÿè´¦æˆ·ç»„ ID
SYS_GID_MAX               999			


CREATE_HOME	yes							# åœ¨ä¸åŠ  â€”M æˆ– -m æ—¶ï¼Œæ˜¯å¦ä¸»åŠ¨åˆ›å»ºç”¨æˆ·å®¶ç›®å½•

UMASK           077						# ç”¨æˆ·å®¶ç›®å½•å»ºç«‹çš„ umaskï¼Œå› æ­¤æƒé™ä¼šæ˜¯ 700

USERGROUPS_ENAB yes						# ä½¿ç”¨ userdel åˆ é™¤æ—¶ï¼Œæ˜¯å¦åˆ é™¤åˆå§‹ç¾¤ç»„
	
ENCRYPT_METHOD SHA512					# å¯†ç åŠ å¯†çš„æœºåˆ¶ä½¿ç”¨çš„æ˜¯  sha512 
```

å…·ä½“å¦‚ä¸‹ï¼š

- `mailbox` æ‰€åœ¨ç›®å½•

  ç”¨æˆ·çš„é»˜è®¤ mailbox æ–‡ä»¶å­˜æ”¾ç›®å½• `/var/spool/mail`

- `shadow` é¢è†œç¬¬ 4ã€5ã€6 å­—æ®µå†…å®¹

  `/etc/shadow` å†…æ¯ä¸€è¡ŒåŸºæœ¬ä¸Šéƒ½æœ‰  `0:99999:7` çš„å­˜åœ¨ï¼Œå°±æ˜¯è¿™é‡Œé¢„è®¾çš„

- `UID/GID` æ•°å€¼ç›¸å…³

  è™½ç„¶ LInux æ ¸å¿ƒæ”¯æŒçš„è´¦æˆ·å¯å¤§ 2çš„32æ¬¡æ–¹ ï¼Œä½†æ˜¯ä¸€å°ä¸»æœºä¸Šç®¡ç†è¿™ä¹ˆå¤šè´¦æˆ·ä¹Ÿå¾ˆéº»çƒ¦ã€‚

  é‚£ä¹ˆæ•°å€¼è‡ªå¢åŸç†æ˜¯ï¼šæ‹¿åˆ°è¿™é‡Œé…ç½®çš„ `UID_MIN`å’Œ `/etc/passwd` ä¸­æœå¯»æœ€å¤§çš„ UID æ•°å€¼ï¼Œå¹¶æ‰¾å‡ºä¸¤ä¸ªæºä¸­æœ€å¤§çš„ä¸€ä¸ª+1 å¾—åˆ°æ–°ç”¨æˆ·çš„ UID

  æ¯”å¦‚ä½¿ç”¨ `useradd -r sysaccount` å°±ä¼šå¾—åˆ° å¤§äº 201 å°äº 1000 çš„ UID äº†

- ç”¨æˆ·å®¶ç›®å½•è®¾ç½®

  `CREATE_HOME	yes` ä¼šè®©ä½ åœ¨ä½¿ç”¨ useradd æ—¶ï¼Œè‡ªåŠ¨åŠ ä¸Š -m å±æ€§åˆ›å»ºå®¶çš„ç›®å½•ï¼Œå¦‚æœä¸éœ€è¦åˆ™ä¼šåŠ ä¸Š -M ï¼Œå®¶çš„ç›®å½•å…¨æ˜¯æ˜¯ `drwx------` æ˜¯å› ä¸º UMASk=077 çš„ç¼˜æ•…

- ç”¨æˆ·åˆ é™¤ä¸å¯†ç è®¾ç½®

  `USERGROUPS_ENAB yes	` ä½¿ç”¨ userdel åˆ é™¤æ—¶ï¼Œä¸”è¯¥è´¦æˆ·æ‰€å±çš„åˆå§‹ç¾¤ç»„å·²ç»æ²¡æœ‰äººåœ¨è¯¥ç»„ä¸‹äº†ï¼Œåˆ™åˆ æ‰è¯¥ç»„ã€‚

å°ç»“ï¼šä½¿ç”¨ useradd æŒ‡ä»¤åœ¨ linux ä¸Šåˆ›å»ºè´¦æˆ·æ—¶ï¼Œè‡³å°‘ä¼šå‚è€ƒï¼š

- `/etc/default/useradd`
- `/etc/login.defs`
- `/etc/skel/*`

è¿™äº›æ–‡ä»¶ä½œä¸ºé»˜è®¤å€¼ç­‰å‚è€ƒï¼Œè€Œæ‰¿è½½ä¸è®°å½•æ•°æ®åˆ™æ˜¯ `/etc/passwd`ã€`/etc/shadow`ã€`/etc/group`ã€`/etc/gshadow` ä¸å®¶ç›®å½•ã€‚æ‰€ä»¥å¦‚æœä½ äº†è§£æ•´ä¸ªç¨‹åºä¿®æ”¹çš„æ˜¯é‚£äº›æ–‡ä»¶å’Œå†…å®¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹åŠ¨ä¿®æ”¹è¿™äº›æ–‡ä»¶ã€‚

### passwd

ä½¿ç”¨ useradd åˆ›å»ºè´¦æˆ·ä¹‹åï¼Œåœ¨é¢„è®¾çš„æƒ…å†µä¸‹ï¼Œè¯¥è´¦æˆ·æš‚æ—¶æ— æ³•ç™»å½•ï¼Œå› ä¸ºåœ¨ `/etc/shadow` ç¬¬ 2 ä¸ªå­—æ®µä¸­å†…å®¹ä¸º `!!`ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæ— æ•ˆå¯†ç ï¼Œæ‰€ä»¥æ— æ³•è¢«ç™»å½•ã€‚

```bash
passwd [--stdin] [è´¦æˆ·åç§°]		# æ‰€æœ‰äººå‡å¯ä½¿ç”¨æ¥ä¿®æ”¹è‡ªå·±çš„å¯†ç 
passwd [-l] [-u] [--stdin] [-S] [-n å¤©æ•°] [-x å¤©æ•°] [-w å¤©æ•°] [-i æ—¥æœŸ] è´¦æˆ·			# root åŠŸèƒ½

é€‰é¡¹ä¸å‚æ•°ï¼š

	--stdinï¼šå¯ä»¥æ¥å—å‰ä¸€ä¸ªç®¡çº¿çš„æ•°æ®ï¼Œä½œä¸ºå¯†ç è¾“å…¥ï¼Œå¯¹ shell script ä¸­æœ‰è¾ƒå¤§ä½œç”¨
	-lï¼šLock æ„æ€ï¼Œå°±æ˜¯ä¼šå°† /etc/shadow ç¬¬ 2 å­—æ®µå‰é¢åŠ ä¸Š ! ä½¿å¯†ç å¤±æ•ˆ
	-uï¼šUnlockï¼Œä¸ -l ç›¸å
	-Sï¼šåˆ—å‡ºå¯†ç ç›¸å…³å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ shadow æ–‡ä»¶å†…çš„å¤§éƒ¨åˆ†ä¿¡æ¯
	-nï¼šåé¢æ¥å¤©æ•°ï¼Œshadow ç¬¬ 4 å­—æ®µï¼Œå¤šä¹…ä¸å¯ä¿®æ”¹å¯†ç 
	-xï¼šåé¢æ¥å¤©æ•°ï¼Œshadow ç¬¬ 5 å­—æ®µï¼Œå¤šä¹…å†…å¿…é¡»è¦ä¿®æ”¹å¯†ç 
	-wï¼šåé¢æ¥å¤©æ•°ï¼Œshadow ç¬¬ 6 å­—æ®µï¼Œå¯†ç è¿‡æœŸå¤©çš„è­¦å‘Šå¤©æ•°
	-iï¼šåé¢æ¥å¤©æ•°ï¼Œshadow ç¬¬ 7 å­—æ®µï¼Œå¯†ç å¤±æ•ˆå¤©æ•°ï¼Œå½“å¯†ç è¿‡æœŸåå¤šä¹…å¤±æ•ˆ
```

å®æˆ˜ç»ƒä¹ 

```bash
# ç”¨ root ç»™ mrcode2 è®¾ç½®å¯†ç 
[root@study mrcode]# passwd mrcode2
Changing password for user mrcode2.
New password: 						# è¿™é‡Œæˆ‘è¾“å…¥äº† 12345678ï¼Œæœ‰ä¸€ä¸ªè­¦å‘Š
BAD PASSWORD: The password fails the dictionary check - it is too simplistic/systematic
Retype new password: 				# è¿™é‡Œè¿˜æ˜¯è¾“å…¥ 12345678 æˆåŠŸäº†
passwd: all authentication tokens updated successfully.
```
åœ¨ root è´¦æˆ·ä¸‹ï¼Œè™½ç„¶æœ‰æç¤ºï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ä¼šç»™ä½ è¿‡ï¼Œå¯è§ root è´¦æˆ·çš„å¨åŠ›æœ‰å¤šå¤§ã€‚é‚£ä¹ˆä½¿ç”¨ä¸€èˆ¬è´¦æˆ·æ¥ä¿®æ”¹è‡ªå·±çš„å¯†ç 

```bash
# èŒƒä¾‹ 2 ï¼šä½¿ç”¨ mrcode2 ç™»å½•åï¼Œä¿®æ”¹ mrcode2 è‡ªå·±çš„å¯†ç 
[mrcode2@study ~]$ passwd 
Changing password for user mrcode2.
Changing password for mrcode2.
(current) UNIX password: 
New password: 
# å¯†ç å¤ªç®€å•ï¼Œæ— æ³•é€šè¿‡
BAD PASSWORD: The password fails the dictionary check - it is based on a dictionary word
New password: 
# ä¸æ—§å¯†ç ç±»ä¼¼ï¼Œæ— æ³•é€šè¿‡
BAD PASSWORD: The password is too similar to the old one
New password: 
BAD PASSWORD: The password fails the dictionary check - it does not contain enough DIFFERENT characters
# è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œç›´æ¥ç»“æŸäº†
passwd: Have exhausted maximum number of retries for service
[mrcode2@study ~]$ 
[mrcode2@study ~]$ passwd 
Changing password for user mrcode2.
Changing password for mrcode2.
(current) UNIX password: 
# æ—§å¯†ç è¾“å…¥ä¸æ­£ç¡®ï¼Œç›´æ¥ç»“æŸ
passwd: Authentication token manipulation error
[mrcode2@study ~]$ 
[mrcode2@study ~]$ passwd 
Changing password for user mrcode2.
Changing password for mrcode2.
(current) UNIX password: 
New password: 
Retype new password: 
# ç»ˆäºä¿®æ”¹æˆåŠŸäº†ï¼Œéœ€è¦ç¬¦åˆæ¡ä»¶çš„å¯†ç ï¼Œè¿˜ä¸èƒ½æ˜¯ç®€å•çš„é‡å¤çš„å¯†ç 
passwd: all authentication tokens updated successfully.

```

å¯†ç è§„èŒƒæ ¡éªŒéå¸¸ä¸¥æ ¼ï¼Œæ–°çš„ distribution å¤§å¤šä½¿ç”¨ PAM æ¨¡å—æ¥è¿›è¡Œå¯†ç çš„æ ¡éªŒï¼ŒåŒ…æ‹¬å¤ªçŸ­ã€å¯†ç ä¸è´¦æˆ·ç›¸åŒã€å¯†ç ä¸ºå­—å…¸å¸¸è§å­—ç¬¦ä¸²ç­‰ï¼Œéƒ½ä¼šè¢«æ‹’ç»ã€‚

root è´¦æˆ·ä¿®æ”¹å¯†ç ï¼Œä¸ç”¨è¾“å…¥æ—§å¯†ç ï¼Œè€Œä¸€èˆ¬ç”¨æˆ·åˆ™éœ€è¦å…ˆè¾“å…¥æ—§å¯†ç ã€‚

PAM æ¨¡å—çš„ç®¡ç†æœºåˆ¶å†™åœ¨ `/etc/pam.d/passwd` ä¸­ï¼Œè€Œè¯¥æ–‡ä»¶ä¸å¯†ç æœ‰å…³çš„æµ‹è¯•æ¨¡å—ä½¿ç”¨ `pam_cracklib.so`ï¼Œè¯¥æ¨¡å—ä¼šæ ¡éªŒå¯†ç ç›¸å…³çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å–ä»£ `/etc/login.defs`å†…çš„ `PASS_MIN_LEN` çš„è®¾ç½®ï¼Œå¯¹äº PAM åç»­ä¼šå†ä»‹ç»ã€‚ç†è®ºä¸Šä½ çš„å¯†ç æœ€å¥½ç¬¦åˆä»¥ä¸‹è¦æ±‚ï¼š

- å¯†ç ä¸èƒ½ä¸è´¦æˆ·ç›¸åŒ
- å¯†ç ä¸è¦é€‰ç”¨å­—å…¸é‡Œé¢ä¼šå‡ºç°çš„å­—ç¬¦ä¸²
- å¯†ç é•¿åº¦éœ€è¦è¶…è¿‡ 8 ä¸ªå­—ç¬¦
- å¯†ç ä¸è¦ä½¿ç”¨ä¸ªäººä¿¡æ¯ï¼Œå¦‚èº«ä»½è¯ã€æ‰‹æœºå·ç ã€å…¶ä»–ç”µè¯å·ç ç­‰
- å¯†ç ä¸è¦ä½¿ç”¨ç®€å•çš„å…³ç³»ï¼Œå¦‚ 1+1=2 ç­‰
- å¯†ç å°½é‡ä½¿ç”¨å¤§å°å†™å­—ç¬¦ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ç»„åˆç­‰

ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿç®¡ç†ï¼Œæ–°ç‰ˆ passwd è¿˜åŠ å…¥äº†å¾ˆå¤šåˆ›æ„é€‰é¡¹ï¼Œä¸ªäººè®¤ä¸ºæœ€å¥½ç”¨çš„å¤§æ¦‚æ˜¯ `--stdin`äº†ï¼Œå¦‚ä¸‹é¢è¿™æ ·ä¿®æ”¹å¯†ç 

```bash
# èŒƒä¾‹ 3ï¼šä½¿ç”¨ standard input å»ºç«‹ç”¨æˆ·çš„å¯†ç 
# è¿™é‡Œä½¿ç”¨ root èº«ä»½å§ mrcode2 çš„å¯†ç è®¾ç½®æˆäº† abc543CC
[root@study mrcode]# echo "abc543CC" | passwd --stdin mrcode2
Changing password for user mrcode2.
passwd: all authentication tokens updated successfully.
```

ä¸Šé¢æŒ‡ä»¤ä¼šç›´æ¥æ›´æ–°ç”¨æˆ·å¯†ç ï¼Œå¥½å¤„æ˜¯æ–¹ä¾¿å¤„ç†ï¼Œç¼ºç‚¹æ˜¯è¿™ä¸ªå¯†ç ä¼šä¿ç•™åœ¨æŒ‡ä»¤ä¸­ï¼Œè‹¥è¢«æ”»å‡»ï¼Œäººå®¶å¯ä»¥åœ¨ `/root/.bash_history` ä¸­æ‰¾åˆ°è¯¥å¯†ç ï¼Œæ‰€ä»¥è¯¥æ“ä½œä¸€èˆ¬ä»…ç”¨åœ¨ shell script çš„å¤§é‡è´¦æˆ·åˆ›å»ºä¸­ã€‚

æ³¨æ„ï¼šè¯¥é€‰é¡¹å¹¶ä¸å­˜åœ¨æ‰€æœ‰çš„ distribution ç‰ˆæœ¬ä¸­ï¼Œè¯·ä½¿ç”¨ `man passwd` ç¡®è®¤æ˜¯å¦æœ‰è¯¥é€‰é¡¹

```bash
èŒƒä¾‹ 4ï¼šç®¡ç† mrcode2 çš„å¯†ç å…·æœ‰ 60 å¤©å˜æ›´ã€å¯†ç è¿‡æœŸ 10 å¤©åè´¦æˆ·å¤±æ•ˆçš„è®¾ç½®
[root@study mrcode]# passwd -S mrcode2
mrcode2 PS 2020-02-24 0 99999 7 -1 (Password set, SHA512 crypt.)
# ç”¨æˆ·æœ€è¿‘ä¿®æ”¹å¯†ç  2020-02-24 , 0 æœ€å°å¤©æ•°ã€99999 å˜æ›´å¤©æ•°ã€7 è­¦å‘Šå¤©æ•°ï¼Œå¯†ç ä¸ä¼šå¤±æ•ˆ

[root@study mrcode]# passwd -x 60 -i 10 mrcode2
Adjusting aging data for user mrcode2.
passwd: Success
[root@study mrcode]# passwd -S mrcode2
mrcode2 PS 2020-02-24 0 60 7 10 (Password set, SHA512 crypt.)
```

é‚£ä¹ˆæ€ä¹ˆè®©æŸä¸ªè´¦æˆ·æš‚æ—¶æ— æ³•ç™»å½•ä¸»æœºå‘¢ï¼Ÿæ¯”å¦‚ mrcode2 è¿™ä¸ªè´¦æˆ·è€ä¹±æ¥ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯è®©ä»–æ— æ³•ç™»å½•ä¸»æœºï¼Œå¯ä»¥è®©ä»–çš„å¯†ç å˜æˆä¸åˆæ³•çš„ ï¼ˆshadow ç¬¬ 2 å­—æ®µé•¿åº¦å˜æ›´ï¼‰

```bash
# èŒƒä¾‹ 5ï¼šè®© mrocde2 çš„è´¦æˆ·å¤±æ•ˆ
[root@study mrcode]# passwd -l mrcode2 
Locking password for user mrcode2.
passwd: Success
[root@study mrcode]# passwd -S mrcode2
mrcode2 LK 2020-02-24 0 60 7 10 (Password locked.)		# è¢«é”ä½äº†

[root@study mrcode]# grep 'mrcode2' /etc/shadow
# æŸ¥çœ‹ç¬¬2å­—æ®µï¼Œå¯†ç å‰é¢å¢åŠ äº† !!
mrcode2:!!$6$UhalDiXq$q7lGzX.sMx55zXJwmWKNghBrHjEAvuutRcUcqrhxWbjoWy0Z3R7tIoeIio2tuptBenG62JjjVIdfaRFIQwJKw.:18316:0:60:7:10::

# è§£é”è´¦æˆ·ï¼Œå‘ç° !! è¢«å»æ‰äº†
[root@study mrcode]# passwd -u mrcode2
Unlocking password for user mrcode2.
passwd: Success
[root@study mrcode]# grep 'mrcode2' /etc/shadow
mrcode2:$6$UhalDiXq$q7lGzX.sMx55zXJwmWKNghBrHjEAvuutRcUcqrhxWbjoWy0Z3R7tIoeIio2tuptBenG62JjjVIdfaRFIQwJKw.:18316:0:60:7:10::
```

### chage

é™¤äº†ä½¿ç”¨ `passwd -S` ä¹‹å¤–ï¼Œchage å¯ä»¥ä½¿å¯†ç å‚æ•°æ˜¾ç¤ºæ›´è¯¦ç»†

```bash
chage [-ldEImMW] è´¦æˆ·å

é€‰é¡¹ä¸å‚æ•°ï¼š
	-l: åˆ—å‡ºè¯¥è´¦æˆ·çš„è¯¦ç»†å¯†ç å‚æ•°
	-dï¼šåé¢æ¥æ—¥æœŸï¼Œä¿®æ”¹ shadow ç¬¬ 3 å­—æ®µï¼Œæœ€è¿‘ä¸€æ¬¡ä¿®æ”¹å¯†ç çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DD
	-Eï¼šåé¢æ¥æ—¥æœŸï¼Œä¿®æ”¹ shadow ç¬¬ 8 å­—æ®µï¼Œè´¦æˆ·å¤±æ•ˆæ—¥ï¼Œæ ¼å¼ YYYY-MM-DD
	-Iï¼šåé¢æ¥å¤©æ•°ï¼Œä¿®æ”¹ shadow ç¬¬ 7 å­—æ®µï¼Œå¯†ç å¤±æ•ˆæ—¥æœŸ
	-mï¼šåé¢æ¥å¤©æ•°ï¼Œä¿®æ”¹ shadow ç¬¬ 4 å­—æ®µï¼Œå¯†ç æœ€çŸ­ä¿ç•™å¤©æ•°
	-Mï¼šåé¢æ¥å¤©æ•°ï¼Œä¿®æ”¹ shadow ç¬¬ 5 å­—æ®µï¼Œå¯†ç å¤šä¹…éœ€è¦ä¿®æ”¹
	-Wï¼šåé¢æ¥å¤©æ•°ï¼Œä¿®æ”¹ shadow ç¬¬ 6 å­—æ®µï¼Œå¯†ç è¿‡æœŸå‰è­¦å‘Šå¤©æ•°
```

```bash
# èŒƒä¾‹ 1ï¼šåˆ—å‡º mrcode2 çš„è¯¦ç»†å¯†ç å‚æ•°
[root@study mrcode]# chage -l mrcode2 
Last password change					: Feb 24, 2020
Password expires					: Apr 24, 2020
Password inactive					: May 04, 2020
Account expires						: never
Minimum number of days between password change		: 0
Maximum number of days between password change		: 60
Number of days of warning before password expires	: 7
```

ä½¿ç”¨  passwd çœ‹ä¸åˆ°è¿™ä¹ˆè¯¦ç»†çš„é…ç½®ï¼Œä½¿ç”¨ chage å°±å¯ä»¥äº†ï¼Œæ›´è¯¦ç»†çš„ä½¿ç”¨æ–¹å¼å¯ä»¥  `man chage`

chage è¿˜å¯ä»¥å®ç°è®©ï¼šä½¿ç”¨è€…åœ¨ç¬¬ä¸€æ¬¡ç™»é™†æ—¶ï¼Œå¼ºåˆ¶ä»–ä»¬ä¸€å®šè¦ä¿®æ”¹å¯†ç åæ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥å¤„ç†

```bash
# èŒƒä¾‹ 2ï¼šåˆ›å»ºä¸€ä¸ªåä¸º agetest è´¦æˆ·ï¼Œè¯¥è´¦æˆ·ç¬¬ä¸€æ¬¡ç™»é™†ä½¿ç”¨é»˜è®¤å¯†ç ï¼Œä½†å¿…é¡»è¦ä¿®æ”¹å¯†ç åï¼Œä½¿ç”¨æ–°çš„å¯†ç æ‰èƒ½å¤Ÿç™»é™†ç³»ç»Ÿä½¿ç”¨ bash ç¯å¢ƒ

[root@study mrcode]# useradd agetest
# ä¿®æ”¹è´¦æˆ·å’Œå¯†ç ä¸ºåŒä¸€ä¸ª
[root@study mrcode]# echo "agetest" | passwd --stdin agetest
Changing password for user agetest.
passwd: all authentication tokens updated successfully.
# ä¿®æ”¹æœ€è¿‘ä¿®æ”¹å¯†ç æ—¶é—´ä¸º 0 ï¼Œè¿™é‡Œ
[root@study mrcode]# chage -d 0 agetest
[root@study mrcode]# chage -l agetest | head -n 3
Last password change					: password must be changed
Password expires					: password must be changed
Password inactive					: password must be changed
[root@study mrcode]# grep 'agetest' /etc/shadow
agetest:$6$9MX2dbGl$hyI3sKNt5fgSmi1n8xE/PXK6uiC9G7BeUMbluMil7Z9KVWKHO2aIdbCApLCWsLBPgqmiQAeUy48oPoq96Z/5z.:0:0:99999:7:::

# 
[root@study mrcode]# passwd -S agetest 
agetest PS 1970-01-01 0 99999 7 -1 (Password set, SHA512 crypt.)
# å¯ä»¥çœ‹åˆ°æœ€è¿‘ä¿®æ”¹å¯†ç è®¾ç½®ä¸º 0 çš„è¯ï¼Œé€šè¿‡ passwd ä¼šçœ‹åˆ°æ˜¯ 1970-01-01 ï¼Œæ‰€ä»¥ä¼šæœ‰é—®é¢˜
```

```bash
# èŒƒä¾‹ 3ï¼šå°è¯•ä»¥ agetest ç™»é™†
WARNING! The remote SSH server rejected X11 forwarding request.
You are required to change your password immediately (root enforced)
Last login: Mon Feb 24 11:30:57 2020
WARNING: Your password has expired.
You must change your password now and login again!
æ›´æ”¹ç”¨æˆ· agetest çš„å¯†ç  ã€‚
ä¸º agetest æ›´æ”¹ STRESS å¯†ç ã€‚
ï¼ˆå½“å‰ï¼‰UNIX å¯†ç ï¼š			# ç¬¬ä¸€æ¬¡ç™»é™†éœ€è¦å¼ºåˆ¶ä¿®æ”¹å¯†ç 
æ–°çš„ å¯†ç ï¼š
é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š
passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚

# ä¿®æ”¹å®Œæˆä¹‹åï¼Œå†çœ‹å¯†ç å‚æ•°ä¿¡æ¯ï¼Œå°±å‘ç°æ­£å¸¸äº†
[root@study mrcode]# chage -l agetest
Last password change					: Feb 24, 2020
Password expires					: never
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: 0
Maximum number of days between password change		: 99999
Number of days of warning before password expires	: 7
[root@study mrcode]# passwd -S agetest 
agetest PS 2020-02-24 0 99999 7 -1 (Password set, SHA512 crypt.)
```



### usermod

è´¦æˆ·åˆ›å»ºå¥½ä¹‹åï¼Œè¿˜å¯ä»¥ä¿®æ”¹é€‰é¡¹çš„ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ `/etc/passwd æˆ– /etc/shadow` æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥æŒ‡ä»¤æ¥ä¿®æ”¹

```bash
usermod [-cdefgGlsuLU] username
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- `-c`ï¼šåé¢æ¥è´¦æˆ·è¯´æ˜ï¼Œ passwd ç¬¬ 5 å­—æ®µï¼Œè´¦æˆ·è¯´æ˜
- `-d`ï¼š åé¢æ¥è´¦æˆ·çš„å®¶çš„ç›®å½•ï¼Œpasswd ç¬¬ 6 å­—æ®µ
- `-e`ï¼šåé¢æ¥æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DDï¼Œpasswd ç¬¬ 8 å­—æ®µï¼Œå¤±æ•ˆæ—¥æœŸ
- `-f`ï¼šåé¢æ¥å¤©æ•°ï¼Œshadow ç¬¬ 7 å­—æ®µ
- `-g`ï¼šåé¢æ¥åˆå§‹ç¾¤ç»„ï¼Œpasswd ç¬¬ 4 å­—æ®µï¼ŒGID å­—æ®µ
- `-G`ï¼šåé¢æ¥æ¬¡è¦ç¾¤ç»„ï¼Œä¿®æ”¹çš„æ˜¯ /etc/group å†…å®¹
- `-a`ï¼šä¸ -G åˆç”¨ï¼Œå¯ å¢åŠ æ¬¡è¦ç¾¤ç»„çš„æ”¯æŒï¼Œè€Œéè®¾ç½®
- `-l`ï¼šåé¢æ¥è´¦æˆ·åç§°ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹è´¦æˆ·åï¼Œpasswd ç¬¬ 1 å­—æ®µ
- `-s`ï¼šåé¢æ¥ Shell çš„å®é™…æ–‡ä»¶ï¼Œä¾‹å¦‚ /bin/bash æˆ– /bin/csh ç­‰
- `-u`ï¼šåé¢å°± UID æ•°å­—ï¼Œpasswd ç¬¬ 3 å­—æ®µ
- `-L`ï¼šæš‚æ—¶å°†ç”¨æˆ·çš„å¯†ç å†»ç»“ï¼Œshadow å¯†ç å­—æ®µ
- `-U`ï¼šè§£å†»ç”¨æˆ·å¯†ç 

ä»”ç»†å¯¹æ¯”ï¼Œä¼šå‘ç° usermod é€‰é¡¹ä¸ useradd å¾ˆç±»ä¼¼ï¼Œä»–ä»¬éƒ½æ˜¯ç”¨æ¥å¾®è°ƒé€‰é¡¹å‚æ•°çš„ã€‚å¯¹äº usermod çš„ `-L å’Œ` -U` å‚æ•°ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„ distribution ä¸­éƒ½æœ‰çš„

```bash
# èŒƒä¾‹ 1ï¼šä¿®æ”¹ mrcode2 çš„è¯´æ˜æ 
[root@study mrcode]# usermod -c "mrcode test" mrcode2
[root@study mrcode]# grep mrcode2 /etc/passwd
mrcode2:x:1500:100:mrcode test:/home/mrcode2:/bin/bash
```

```bash
# èŒƒä¾‹ 2ï¼šä¿®æ”¹ mrcode2 åœ¨ 2020/02/25 å¤±æ•ˆ
[root@study mrcode]# usermod -e "2020-02-25" mrcode2
# å¯ä»¥çœ‹åˆ°æœ‰è¿‡æœŸæ—¥æœŸï¼Œå¦‚æœç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„è¯ï¼Œä¹‹å‰è¯´è¿‡äº†ï¼Œæ–‡ä»¶é‡Œé¢å­˜å‚¨çš„æ˜¯å¤©æ•°ï¼Œä¸å®¹æ˜“ç›´è§‚çœ‹å‡ºæ¥æ˜¯å“ªä¸€å¤©
[root@study mrcode]# chage -l mrcode2 | grep 'Account expires'
Account expires						: Feb 25, 2020
```

```bash
# èŒƒä¾‹ 3ï¼šå½“æ—¶åˆ›å»º mrcode3 ç³»ç»Ÿè´¦æˆ·æ—¶ï¼Œæ²¡æœ‰ç»™å®¶çš„ç›®å½•ï¼Œç»™å®ƒåˆ›å»ºå®¶çš„ç›®å½•
[root@study mrcode]# grep mrcode3 /etc/passwd
mrcode3:x:988:982::/home/mrcode3:/bin/bash
# è™½ç„¶æœ‰ç›®å½•æŒ‡å‘ï¼Œä½†æ˜¯è¯¥ç›®å½•å¹¶ä¸å­˜åœ¨
[root@study mrcode]# ll -d /home/mrcode3
ls: cannot access /home/mrcode3: No such file or directory

# copy å‚è€ƒç›®å½•
[root@study mrcode]# cp -a /etc/skel/ /home/mrcode3
# -R è¿è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¸€èµ·ä¿®æ”¹æ‰€å±ç”¨æˆ·/ç¾¤ç»„
[root@study mrcode]# chown -R mrcode3:mrcode3 /home/mrcode3
[root@study mrcode]# ll -d /home/mrcode3/
drwxr-xr-x. 3 mrcode3 mrcode3 78 Jan 17 14:32 /home/mrcode3/
# è¿™é‡Œä¸ä½¿ç”¨ -Rï¼Œå› ä¸ºåªè¦ä¿®æ”¹ç›®å½•çš„æƒé™
[root@study mrcode]# chmod 700 /home/mrcode3
[root@study mrcode]# ll -a ~mrcode3
total 12
drwx------. 3 mrcode3 mrcode3  78 Jan 17 14:32 .
drwxr-xr-x. 7 root    root     80 Feb 24 13:10 ..
-rw-r--r--. 1 mrcode3 mrcode3  18 Aug  8  2019 .bash_logout
-rw-r--r--. 1 mrcode3 mrcode3 193 Aug  8  2019 .bash_profile
-rw-r--r--. 1 mrcode3 mrcode3 231 Aug  8  2019 .bashrc
drwxr-xr-x. 4 mrcode3 mrcode3  39 Jan 17 14:30 .mozilla

```



### userdel

åˆ é™¤ç”¨æˆ·çš„ç›¸å…³æ•°æ®ï¼Œä½¿ç”¨èµ·æ¥å¾ˆç®€å•äº†ï¼Œç”¨æˆ·æ•°æ®æœ‰ï¼š

- ç”¨æˆ·è´¦æˆ·ã€å¯†ç ç›¸å…³å‚æ•°ï¼š`/etc/passwd ã€/etc/shadow`
- ä½¿ç”¨è€…ç¾¤ç»„ç›¸å…³å‚æ•°ï¼š`/etc/groupã€/etc/gshadow`
- ç”¨æˆ·ä¸ªäººæ–‡ä»¶æ•°æ®ï¼š`/home/usernameã€/var/spool/mail/username ...`

```bash
userdel [-r] username  

-rï¼šè¿åŒç”¨æˆ·çš„å®¶ç›®å½•ä¹Ÿä¸€èµ·åˆ é™¤
```

```bash
# èŒƒä¾‹ 1ï¼š åˆ é™¤ mrcode2 ç”¨æˆ·ï¼Œè¿å®¶ç›®å½•ä¹Ÿä¸€èµ·åˆ æ‰
[root@study mrcode]# userdel -r mrcode2
userdel: user mrcode2 is currently used by process 4472		
# ä¸Šé¢æç¤ºæœ‰è¿›ç¨‹åœ¨ä½¿ç”¨è¯¥è´¦æˆ·ï¼Œæ‰€ä»¥æ²¡æœ‰åˆ é™¤æˆåŠŸ
[root@study mrcode]# grep mrcode /etc/passwd
mrcode:x:1000:1000:mrcode:/home/mrcode:/bin/bash
mrcode1:x:1001:1001::/home/mrcode1:/bin/bash
mrcode2:x:1500:100:mrcode test:/home/mrcode2:/bin/bash
mrcode3:x:988:982::/home/mrcode3:/bin/bash
# é€€å‡ºç™»å½• mrcode2 çš„ä¸­æ–­ï¼Œå†æ¬¡å°è¯•åˆ é™¤æˆåŠŸã€‚passwd ä¸­ä¹Ÿæ²¡æœ‰äº†
[root@study mrcode]# userdel -r mrcode2
[root@study mrcode]# grep mrcode /etc/passwd
mrcode:x:1000:1000:mrcode:/home/mrcode:/bin/bash
mrcode1:x:1001:1001::/home/mrcode1:/bin/bash
mrcode3:x:988:982::/home/mrcode3:/bin/bash
```

ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœæƒ³è¦åˆ é™¤è¯¥ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ç­‰æ•°æ®ï¼Œåœ¨è¯¥æŒ‡ä»¤ä¸‹è¾¾ä¹‹å‰ï¼Œä½¿ç”¨ `find / -user username` æ‰¾å‡ºæ•´ä¸ªç³»ç»Ÿå†…å±äº username çš„æ–‡ä»¶ï¼Œå†åŠ ä»¥åˆ é™¤ã€‚è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªç”¨æˆ·ä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæœ‰ä»–è‡ªå·±äº§ç”Ÿçš„æ•°æ®ç­‰æ–‡ä»¶ï¼Œæ¯”å¦‚ä»–çš„é‚®ä»¶ä¿¡ç®±æˆ–è€…æ˜¯ä¾‹è¡Œå·¥ä½œæ’ç¨‹ï¼ˆcrontab åç»­ç¬¬åäº”ç« è®²è§£ï¼‰

## ğŸ€ ç”¨æˆ·åŠŸèƒ½

useraddã€usermodã€userdel æŒ‡ä»¤éƒ½æ˜¯ç³»ç»Ÿç®¡ç†å‘˜æ‰€èƒ½å¤Ÿä½¿ç”¨çš„æŒ‡ä»¤ï¼Œä¸€èˆ¬ç”¨æˆ·é™¤äº† passwd æ›´æ”¹å¯†ç ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨çš„è´¦æˆ·æ•°æ®å˜æ›´ä¸æŸ¥è¯¢çš„æŒ‡ä»¤

### id

è¯¥æŒ‡ä»¤å¯ä»¥æŸ¥è¯¢æŸäººæˆ–è‡ªå·±çš„ç›¸å…³ UIDã€GID ç­‰ä¿¡æ¯ï¼Œå‚æ•°å¾ˆå¤šï¼Œä½†æ˜¯ä¸éœ€è¦é¢å¤–è®°å¿†ï¼Œå…¨éƒ¨åˆ—å‡ºæ¥å°±è¡Œ

```bash
# èŒƒä¾‹ 1ï¼š æŸ¥è¯¢ root è‡ªå·±çš„ç›¸å…³ ID ä¿¡æ¯
[root@study mrcode]# id
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
# contextæ˜¯ SELinux çš„å†…å®¹ï¼Œæš‚æ—¶ä¸è¦ç†ä¼š

# èŒƒä¾‹ 2ï¼š æŸ¥è¯¢ mrcode 1
[root@study mrcode]# id mrcode1
uid=1001(mrcode1) gid=1001(mrcode1) groups=1001(mrcode1)

# è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è´¦æˆ·ï¼Œå¾—åˆ° no such user çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤å®šè¯¥ç³»ç»Ÿä¸Šæ˜¯å¦æœ‰æŸä¸ªè´¦æˆ·
[root@study mrcode]# id mrcode00
id: mrcode00: no such user

```

### finger

ä¸­æ–‡å­—é¢æ„æ€æ˜¯ï¼šæ‰‹æŒ‡æˆ–è€…æŒ‡çº¹çš„æ„æ€ï¼Œå®ƒå¯ä»¥æŸ¥è¯¢å¾ˆå¤šç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œå…¶å®å¤§éƒ¨åˆ†éƒ½åœ¨ /etc/passwd æ–‡ä»¶é‡Œé¢çš„ä¿¡æ¯ã€‚ç”±äºè¯¥æŒ‡ä»¤æœ‰ç‚¹å±é™©ï¼Œæ‰€ä»¥æ–°ç‰ˆæœ¬ä¸­é»˜è®¤ä¸å®‰è£…è¯¥è½¯ä»¶ï¼›

ç”±äºæ— ç½‘ç»œï¼Œè¿™é‡Œè¿˜æ˜¯ä½¿ç”¨ [æŒ‚è½½å…‰ç›˜æ–¹å¼](../07/03.md#æŒ‚è½½-cd-æˆ–-dvd-å…‰ç›˜) æ¥å®‰è£…

```bash
# å…ˆç¡®å®šæ˜¯å¦æœ‰æŒ‚è½½å…‰é©±åˆ° /mnt ç›®å½•ä¸‹
[root@study mrcode]# df -hT /mnt/
Filesystem                    Type  Size  Used Avail Use% Mounted on
/dev/mapper/centos_study-root xfs    35G  4.4G   31G  13% /				# è¿™é‡Œä¸ºç©ºï¼Œæ ‡è¯†æ²¡æœ‰
# æ‰¾åˆ°ä½ çš„å…‰é©±æ‰€åœ¨ä½ç½®ï¼Œè¿™é‡Œ Centos 7 åœ¨ /dev/sr0
[root@study mrcode]# blkid
/dev/sr0: UUID="2019-09-11-18-50-31-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/sda1: UUID="e9d54afb-2afe-42de-87fe-9f55d747fcd9" TYPE="xfs" 
/dev/sda2: UUID="CNUXwS-J3Lh-0nDA-TssW-l1vT-90us-MHYnT1" TYPE="LVM2_member" 
/dev/mapper/centos_study-root: UUID="d7e09bb4-2f04-4ed4-b377-91a22fe85ce7" TYPE="xfs" 
/dev/mapper/centos_study-swap: UUID="684eebc0-3f70-4fc1-9a5d-d683f6a07cd0" TYPE="swap" 
# æŒ‚è½½å…‰ç›˜åˆ° /mnt
[root@study mrcode]# mount /dev/sr0 /mnt/
mount: /dev/sr0 is write-protected, mounting read-only
[root@study mrcode]# df -hT /mnt/
Filesystem     Type     Size  Used Avail Use% Mounted on
/dev/sr0       iso9660  4.4G  4.4G     0 100% /mnt		# ç°åœ¨æœ‰äº†

[root@study mrcode]# rpm -ivh /mnt/Packages/fin
findutils-4.5.11-6.el7.x86_64.rpm     finger-0.17-52.el7.x86_64.rpm         finger-server-0.17-52.el7.x86_64.rpm  
[root@study mrcode]# rpm -ivh /mnt/Packages/finger-[0-9]*
warning: /mnt/Packages/finger-0.17-52.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:finger-0.17-52.el7               ################################# [100%]
[root@study mrcode]# ll /mnt/Packages/finger-[0-9]*
-rw-rw-r--. 1 root root 26100 Aug 29  2014 /mnt/Packages/finger-0.17-52.el7.x86_64.rpm
```

å®‰è£…å¥½ä¹‹åï¼Œè¿›è¡Œä½¿ç”¨

```bash
finger [-s] username

é€‰é¡¹ä¸å‚æ•°ï¼š
	-sï¼šä»…åˆ—å‡ºç”¨æˆ·çš„è´¦æˆ·ã€å…¨åã€ç»ˆç«¯æœºä»£å·ä¸ç™»å½•æ—¶é—´
	-mï¼šåˆ—å‡ºä¸åé¢æ¥çš„è´¦æˆ·ç›¸åŒè€…ï¼Œè€Œä¸æ˜¯åˆ©ç”¨éƒ¨åˆ†æ¯”å¯¹ï¼ˆåŒ…æ‹¬å…¨åéƒ¨åˆ†ï¼‰
```

```bash
# èŒƒä¾‹ 1ï¼šè§‚å¯Ÿ mrcode1 çš„ç”¨æˆ·ç›¸å…³è´¦æˆ·å±æ€§
[root@study mrcode]# finger mrcode1
Login: mrcode1        			Name: 
Directory: /home/mrcode1            	Shell: /bin/bash
Never logged in.
No mail.
No Plan.
```

ç”±äº finger ç±»ä¼¼æŒ‡çº¹åŠŸèƒ½ï¼Œä¼šå°†ç”¨æˆ·å…ˆå…³å±æ€§åˆ—å‡ºæ¥ï¼Œå…¶å®ä»–åˆ—å‡ºçš„å‡ ä¹éƒ½æ˜¯ /etc/passwd æ–‡ä»¶é‡Œé¢çš„ä¿¡æ¯ã€‚åˆ—å‡ºçš„ä¿¡æ¯å¦‚ä¸‹å«ä¹‰ï¼š

- Loginï¼šä½¿ç”¨è€…è´¦æˆ·ã€‚ /etc/passwd ç¬¬ 1 å­—æ®µ
- Nameï¼šå…¨åï¼Œ/etc/passwd ç¬¬ 5 å­—æ®µï¼Œæˆ–ç§°ä¸ºæ‰¹æ³¨ä¿¡æ¯
- Directoryï¼šå®¶ç›®å½•
- Shellï¼š shell æ–‡ä»¶
- Never logged in.ï¼šfigner è¿˜ä¼šè°ƒæŸ¥ç”¨æˆ·ç™»å½•ä¸»æœºæƒ…å†µ
- No mailï¼šè°ƒæŸ¥ /var/spool/mail ä¸­çš„ä¿¡ç®±èµ„æ–™
- No Planï¼šè°ƒæŸ¥ `/~mrcode1/.plan` æ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶å–å‡ºæ¥è¯´æ˜

ä¸è¿‡å¦èƒ½æŸ¥è¯¢åˆ° Mail ä¸ Plan åˆ™ä¸å…¨æ–°æœ‰å…³äº†ï¼Œå› ä¸º Mail/Plan éƒ½æ˜¯ä¸ä½¿ç”¨è€…è‡ªå·±çš„æƒé™è®¾ç½®æœ‰å…³ç³»ã€‚æ¯”å¦‚ root èƒ½å¤ŸæŸ¥è¯¢åˆ°è¿™äº›ä¿¡æ¯ï¼Œä½†æ˜¯ä¸è§å¾— mrcode3 èƒ½æŸ¥è¯¢åˆ° mrcode1 çš„è¿™äº›ä¿¡æ¯ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹è‡ªå·±æƒ³è¦æ‰§è¡Œçš„é¢„å®šè®¡åˆ’ï¼Œå½“ç„¶ï¼Œæœ€å¤šæ˜¯ç»™è‡ªå·±çœ‹çš„ï¼Œå¯ä»¥è¿™æ ·åš

```bash
# èŒƒä¾‹ 2ï¼šåˆ©ç”¨ mrcode1 å»ºç«‹è‡ªå·±çš„è®¡åˆ’æ–‡ä»¶
[mrcode1@study ~]$ echo "I will study Linux during this year." > ~/.plan
[mrcode1@study ~]$ finger mrcode1
Login: mrcode1        			Name: 
Directory: /home/mrcode1            	Shell: /bin/bash
On since ä¸€ 2æœˆ 24 13:48 (CST) on pts/2 from 192.168.4.170
   2 seconds idle
No mail.
Plan:
I will study Linux during this year.			# å¯ä»¥çœ‹åˆ°è®¡åˆ’äº†

```

```bash
# èŒƒä¾‹ 3ï¼šæ‰¾å‡ºç›®å‰åœ¨ç³»ç»Ÿä¸Šé¢ç™»å½•çš„ç”¨æˆ·ä¸ç™»å½•æ—¶é—´
[mrcode1@study ~]$ finger 
Login     Name       Tty      Idle  Login Time   Office     Office Phone   Host
mrcode    mrcode     pts/0    2:24  Feb 21 14:51                           (192.168.4.170)
mrcode    mrcode     pts/1       2  Feb 21 16:21                           (192.168.4.170)
mrcode1              pts/2          Feb 24 13:48                           (192.168.4.170)

```

å¯ä»¥çœ‹åˆ° mrcode ç™»å½•äº†ä¸¤ä¸ª tty ç»ˆç«¯ã€‚è¿˜åˆ—å‡ºäº†å…¶ä»–çš„ Office     Office Phoneï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯ä»¥é€šè¿‡ chfn æŒ‡ä»¤æ¥é…ç½®

### chfn

chfn ç±»ä¼¼ change finger çš„æ„æ€ï¼Œæ–¹æ³•å¦‚ä¸‹

```bash
chfn [-foph] [è´¦æˆ·å]

é€‰é¡¹ä¸å‚æ•°ï¼š
	-fï¼šåé¢æ¥å®Œæ•´çš„å¤§å
	-oï¼šæ‚¨åŠå…¬å®¤çš„æˆ¿é—´å·ç 
	-pï¼šåŠå…¬å®¤çš„ç”µè¯å·ç 
	-hï¼šå®¶é‡Œçš„ç”µè¯å·ç 
```

```bash
# èŒƒä¾‹ 1ï¼šmrcode è‡ªå·±æ›´æ”¹è‡ªå·±çš„ç›¸å…³ä¿¡æ¯
[mrcode1@study ~]$ chfn
Changing finger information for mrcode1.
åç§° []: Mrcode1 test
åŠå…¬ []: DIV^H in kSU	 # è¿™é‡Œè¾“å…¥äº†é€€æ ¼é”®ï¼Œå¯¼è‡´æ— æ•ˆï¼Œä¸‹é¢é‡æ–°è¾“å…¥çš„
chfn: control characters are not allowed
åŠå…¬ []: 06-123456
åŠå…¬ç”µè¯ []: 06-456789
ä½å®…ç”µè¯ []: 06-789000

å¯†ç ï¼š				# è¿™é‡Œéœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç ï¼Œç”¨æ¥ç¡®è®¤èº«ä»½
Finger information changed.

# ä¸Šé¢å¿˜è®°ä¿®æ”¹ç»ˆç«¯æœºè¯­è¨€äº†ï¼Œä¸‹é¢é‡æ¥ä¸‹
# ä¼šå‘ç°å·²ç»é…ç½®è¿‡çš„ä¼šæœ‰æç¤º
[mrcode1@study ~]$ chfn
Changing finger information for mrcode1.
Name [Mrcode1 test]: Mrcode1 test
Office [06-123456]: 06-123456
Office Phone [06-456789]: 06-456789
Home Phone [06-789000]: 06-789000

Password: 
Finger information changed.


# æœ€åæŸ¥çœ‹ä¿¡æ¯ï¼Œå‘ç°ä¸€å®¶æœ‰äº†
[mrcode1@study ~]$ finger mrcode1
Login: mrcode1        			Name: Mrcode1 test
Directory: /home/mrcode1            	Shell: /bin/bash
Office: 06-123456, 06-456789		Home Phone: 06-789000
On since Mon Feb 24 13:48 (CST) on pts/2 from 192.168.4.170
   5 seconds idle
No mail.
Plan:
I will study Linux during this year.

# è¿™äº›ä¿¡æ¯å…¶å®æ˜¯å­˜åœ¨ ç¬¬ 5 ä¸ªå­—æ®µä¸­çš„ï¼Œç”¨é€—å·éš”å¼€äº†
[mrcode1@study ~]$ grep mrcode1 /etc/passwd
mrcode1:x:1001:1001:Mrcode1 test,06-123456,06-456789,06-789000:/home/mrcode1:/bin/bash
```

è¯¥æŒ‡ä»¤ä¸€èˆ¬æ¥è¯´ä¸ä½¿ç”¨çš„ï¼Œé™¤éä½ æœ‰å¾ˆå¤šç”¨æˆ·ã€‚ä»–ç±»ä¼¼è®ºå›é‡Œé¢ä¸ªäººèµ„æ–™å±æ€§ç»´æŠ¤ä¸€æ ·çš„æ„æ€

### chsh

change shell çš„ç®€å†™

```bash
chsh [-ls]

é€‰é¡¹ä¸å‚æ•°ï¼š
	-lï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šå¯ç”¨çš„ shellã€‚å…¶å®å°±æ˜¯ /etc/shells ä¸­çš„å†…å®¹
	-sï¼šè®¾ç½®ä¿®æ”¹è‡ªå·±çš„ shell
```

```bash
# èŒƒä¾‹ 1ï¼šç”¨ mrcode1 èº«ä»½åˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰åˆæ³•çš„ shellï¼Œå¹¶ä¸”åˆ¶å®š chs ä¸ºè‡ªå·±çš„ shell
[mrcode1@study ~]$ chsh -l
/bin/sh
/bin/bash
/usr/bin/sh
/usr/bin/bash
/bin/tcsh
/bin/csh
# æˆ‘è¿™é‡Œå’Œä¹¦ä¸Šå¯¹æ¯”å°‘äº†/sbin/nologin /usr/sbin/nologin ï¼Œå°±æ˜¯é‚£ä¸ªåˆæ³•ä¸å¯ç™»å½•çš„ shell

[mrcode1@study ~]$ chsh -s /bin/csh; grep mrcode1 /etc/passwd
Changing shell for mrcode1.
Password: 
Shell changed.
mrcode1:x:1001:1001:Mrcode1 test,06-123456,06-456789,06-789000:/home/mrcode1:/bin/csh

# å¯ç”¨çœ‹åˆ°å·²ç»ä¿®æ”¹æˆ csh äº†ï¼Œè®°å¾—å†ä¿®æ”¹å›æ¥
[mrcode1@study ~]$ chsh -s /bin/bash 
Changing shell for mrcode1.
Password: 
Shell changed.
```

ä¸è®ºæ˜¯ chfn ä¸ chsh éƒ½æ˜¯èƒ½å¤Ÿè®©ä¸€èˆ¬ç”¨æˆ·ä¿®æ”¹ /etc/passwd è¿™ä¸ªç³»ç»Ÿæ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæŒ‡ä»¤æ–‡ä»¶çš„æƒé™æ˜¯ä»€ä¹ˆï¼Ÿ

```bash
[mrcode1@study ~]$ ll $(which chsh)
-rws--x--x. 1 root root 23880 Aug  9  2019 /usr/bin/chsh
```

ä¹‹å‰è®²åˆ°è¿‡çš„ [SUID æƒé™](../06/04.md#æ–‡ä»¶ç‰¹æ®Šæƒé™-suidã€sgidã€sbit)ï¼ŒS å‡ºç°åœ¨äº†æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™ä½ç½®ä¸Šã€‚

## ğŸ€ æ–°å¢ä¸ç§»é™¤ç¾¤ç»„

åŸºæœ¬èƒ½å¤Ÿç¾¤ç»„çš„å†…å®¹éƒ½ä¸è¿™ä¸¤ä¸ªæ–‡ä»¶æœ‰å…³ï¼š`/etc/group`ã€`/etc/gshadow` ï¼Œæ¯”è¾ƒç®€å•ï¼Œå¯¹ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶çš„æ–°å¢ã€ä¿®æ”¹ä¸ç§»é™¤ï¼Œå¦‚æœè¿˜åŠ ä¸Šæœ‰æ•ˆç¾¤ç»„çš„æ¦‚å¿µï¼Œé‚£ä¹ˆ newgrp ä¸ gpasswd åˆ™éœ€è¦äº†è§£

### groupadd

```bash
group add [-g gid] [-r] ç»„å

é€‰é¡¹ä¸å‚æ•°ï¼š
	-gï¼šåé¢æ¥æŸä¸ªç‰¹å®šçš„GIDï¼Œç”¨æ¥æŒ‡å®š GID
	-rï¼šå»ºç«‹ç³»ç»Ÿç¾¤ç»„ã€‚ä¸ /etc/login.defs å†…çš„ GID_MIN æœ‰å…³
```

```bash
# èŒƒä¾‹ 1ï¼šæ–°å»ºä¸€ä¸ªç¾¤ç»„ï¼Œåç§°ä¸º group1
[root@study mrcode]# groupadd group1
[root@study mrcode]# grep group1 /etc/group  /etc/gshadow
/etc/group:group1:x:1502:
/etc/gshadow:group1:!::
# ä¸€èˆ¬ç»„çš„ GID é»˜è®¤æ˜¯ä» 1000 ä»¥ä¸Šçš„ï¼Œè¿™é‡Œå‡ºç°äº† 1502ï¼Œæ˜¯ /etc/group ä¸­æœ€å¤§ GID+1 å†³å®šçš„
```

### groupmod

ä¸ groupadd ç±»ä¼¼ï¼Œä¿®æ”¹ group ç›¸å…³å‚æ•°

```bash
groupmod [-g gid] [-n group_name] ç¾¤ç»„å

é€‰é¡¹ä¸å‚æ•°ï¼š
	-gï¼šä¿®æ”¹ç°æœ‰çš„ GID æ•°å­—
	-nï¼šä¿®æ”¹ç°æœ‰çš„ç»„å
```

```bash
# èŒƒä¾‹ 1ï¼šå°†ä¸Šä¸ªèŒƒä¾‹åˆ›å»ºçš„ group1 åç§°ä¿®æ”¹ä¸º mygroup s,GID ä¸º 201
[root@study mrcode]# groupmod -g 201 -n mygroup group1
[root@study mrcode]# grep group1 /etc/group  /etc/gshadow; grep mygroup /etc/group /etc/gshadow
/etc/group:mygroup:x:201:
/etc/gshadow:mygroup:!::
```

æ¸©é¦¨æç¤ºï¼šä¸è¦éšæ„ä¿®æ”¹ GIDï¼Œå®¹æ˜“é€ æˆç³»ç»Ÿèµ„æºçš„é”™ä¹±

### groupdel

åˆ é™¤ç¾¤ç»„

```bash
groupdel [groupname]
```

```bash
# èŒƒä¾‹ 1ï¼š å°†åˆšåˆšçš„ mygroup åˆ é™¤
[root@study mrcode]# groupdel mygroup 

# èŒƒä¾‹ 2ï¼šåˆ é™¤ mrcode1 è¿™ä¸ªç¾¤ç»„
[root@study mrcode]# groupdel mrcode1
groupdel: cannot remove the primary group of user 'mrcode1'
```

ä¼šå‘ç°ï¼Œmrcode1 ç¾¤ç»„æ— æ³•åˆ é™¤ï¼ŒåŸå› å°±æ˜¯æœ‰ç”¨æˆ·åœ¨ä½¿ç”¨è¯¥ç¾¤ç»„

```bash
[root@study mrcode]# grep mrcode1 /etc/group
mrcode1:x:1001:
[root@study mrcode]# grep 1001 /etc/passwd
mrcode1:x:1001:1001:Mrcode1 test,06-123456,06-456789,06-789000:/home/mrcode1:/bin/bash
# å¯ä»¥çœ‹åˆ° mrcode1 åœ¨çš„åˆå§‹ç¾¤ç»„å°±æ˜¯è¯¥ç¾¤ç»„ï¼Œå› æ­¤æ— æ³•åˆ é™¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´ mrcode1 ç™»å½•ç³»ç»Ÿä¼šæ‰¾ä¸åˆ° GID,é€ æˆå›°æ‰°
```

é‚£ä¹ˆå¦‚æœéè¦åˆ é™¤å‘¢ï¼Ÿåªèƒ½ç¾¤äººè¯¥ç»„æ²¡æœ‰äººä½¿ç”¨çš„æ—¶å€™æ‰å¯ä»¥åˆ é™¤ï¼Œä½ å¯ä»¥è¿™æ ·åš

- ä¿®æ”¹ mrcode1 çš„ GID
- åˆ é™¤ mrcode1 çš„ä½¿ç”¨è€…

ä¸Šè¿°æ–¹æ³•å®é™…ä¸Šè¿˜æ˜¯åœ¨åˆ é™¤è§„åˆ™ä¸­çš„æ–¹æ³•ã€‚æ²¡æœ‰å¼ºåˆ¶åˆ é™¤ä¸€è¯´ï¼ŒåŒæ ·ä¼šå¯¼è‡´å¼•ç”¨è¯¥ç»„çš„æ–‡ä»¶ï¼ŒæŸ¥è¯¢ä¸åˆ°ç›¸å…³ç»„çš„æƒ…å†µ

### gpasswd ç¾¤ç»„ç®¡ç†å‘˜åŠŸèƒ½

å¦‚æœç³»ç»Ÿç®¡ç†å‘˜å¤ªå¿™äº†ï¼Œå°±å¯ä»¥åˆ›å»ºç¾¤ç»„ç®¡ç†å‘˜æ¥ç®¡ç†å“ªäº›è´¦æˆ·å¯ä»¥åŠ å…¥/ç§»é™¤è¯¥ç¾¤ç»„

```bash
# å…³äºç³»ç»Ÿç®¡ç†å‘˜ root åšçš„æ“ä½œ
gpasswd groupname
gpasswd [-A user1,...][-M user3,...] groupname
gpasswd [-rR] groupname

é€‰é¡¹ä¸å‚æ•°ï¼š
	è‹¥æ²¡æœ‰ä»»ä½•å‚æ•°æ—¶ï¼Œæ ‡è¯†ç»™äºˆ groupname ä¸€ä¸ªå¯†ç  ï¼ˆ/etc/gshadowï¼‰
	-Aï¼šå°† groupname çš„ä¸»æ§åˆ¶æƒäº¤ç”±åé¢çš„ä½¿ç”¨è€…ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯¥ç»„çš„ç®¡ç†å‘˜
	-Mï¼šå°†æŸäº›è´¦æˆ·åŠ å…¥è¿™ä¸ªç¾¤ç»„ä¸­
	-rï¼šå°† groupname çš„å¯†ç ç§»é™¤
	-Rï¼šè®© groupname çš„å¯†ç æ å¤±æ•ˆ
	
# å…³äºç¾¤ç»„ç®¡ç†å‘˜ Group administrator åšçš„æ“ä½œ
gpasswd [-ad] user groupname

é€‰é¡¹ä¸å‚æ•°ï¼š
	-aï¼šå°†æŸä½ä½¿ç”¨è€…åŠ å…¥åˆ°è¯¥ç»„
	-dï¼šå°†æŸä½ä½¿ç”¨è€…ç§»é™¤è¯¥ç»„
```

å®è·µç»ƒä¹ 

```bash
# èŒƒä¾‹ 1ï¼šå»ºç«‹ä¸€ä¸ªæ–°ç¾¤ç»„ï¼Œåç§°ä¸º testgroup ä¸”ç¾¤ç»„äº¤ç”± mrcode1 ç®¡ç†
[root@study mrcode]# groupadd testgroup		# åˆ›å»ºç¾¤ç»„
[root@study mrcode]# gpasswd testgroup		# è®¾ç½®ä¸€ä¸ªå¯†ç 
Changing the password for group testgroup
New Password: 
Re-enter new password: 

# æ·»åŠ  mrcode1 ä¸ºç®¡ç†å‘˜
[root@study mrcode]# gpasswd -A mrcode1 testgroup
[root@study mrcode]# grep testgroup /etc/group /etc/gshadow
/etc/group:testgroup:x:1502:
/etc/gshadow:testgroup:$6$7mtnL/qNA97Cyxx$xGkPMKtlRucwCBFpsfYGoBM4BLQvYmoTYOvwvBzOMpJyFz1YTBTV7nZvGDvOyG8jhtQ0WGDdl1xhgq959xJ4s/:mrcode1:
```

```bash
# èŒƒä¾‹ 2ï¼šä»¥ mrcode1 ç™»å½•ç³»ç»Ÿï¼Œå¹¶ä¸”è®©ä»–åŠ å…¥ mrcode1 mrcode3 ç§°ä¸º testgroup çš„æˆå‘˜
[mrcode1@study ~]$ gpasswd -a mrcode1  testgroup
Adding user mrcode1 to group testgroup
[mrcode1@study ~]$ gpasswd -a mrcode3  testgroup
Adding user mrcode3 to group testgroup

[root@study mrcode]# grep testgroup /etc/group /etc/gshadow
/etc/group:testgroup:x:1502:mrcode1,mrcode3
/etc/gshadow:testgroup:$6$7mtnL/qNA97Cyxx$xGkPMKtlRucwCBFpsfYGoBM4BLQvYmoTYOvwvBzOMpJyFz1YTBTV7nZvGDvOyG8jhtQ0WGDdl1xhgq959xJ4s/:mrcode1:mrcode1,mrcode3
```

## ğŸ€ è´¦æˆ·ç®¡ç†å®ä¾‹

è´¦æˆ·ç®¡ç†éœ€è¦è€ƒè™‘ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚è®©ä¸€å°ä¸»æœºä¸Šçš„å¤šä¸ªè´¦æˆ·ååŒå·¥ä½œï¼šå­¦æ ¡çš„ä¸“é¢˜ç”Ÿéœ€è¦åˆ†ç»„ï¼ŒåŒä¸€ç»„çš„åŒå­¦é—´å¿…é¡»èƒ½å¤Ÿäº’ç›¸ä¿®æ”¹å¯¹æ–¹çš„æ•°æ®æ–‡ä»¶ï¼ŒåŒæ—¶è¿™äº›åŒå­¦åˆéœ€è¦ä¿ç•™è‡ªå·±çš„ç§å¯†æ•°æ®ï¼Œå› æ­¤ç›´æ¥å…¬å¼€å®¶ç›®å½•æ˜¯ä¸åˆé€‚çš„ã€‚

ä¸‹é¢æä¾›å‡ ä¸ªä¾‹å­æ¥æ€è€ƒä¸å­¦ä¹ 

**ä»»åŠ¡ 1**ï¼šå•çº¯çš„å®Œæˆä»»åŠ¡ï¼Œå‡è®¾éœ€è¦çš„è´¦æˆ·æ•°æ®å¦‚ä¸‹ï¼Œè¯¥å¦‚ä½•æ“ä½œï¼Ÿ



è´¦æˆ·åç§° | è´¦æˆ·å…¨å | æ¬¡è¦ç¾¤ç»„ | æ˜¯å¦å¯ç™»é™†ä¸»æœº | å¯†ç  
:--|--|--|---|---
myuser1|1st user|mygroup1|å¯ä»¥|password
myuser2|2st user|mygroup2|å¯ä»¥|password
myuser3|3st user|æ— |ä¸å¯ä»¥|password

```bash
# å…ˆå¤„ç†è´¦æˆ·ç›¸å…³å±æ€§
# ç”±äºè´¦æˆ·ç”±æ¬¡è¦ç¾¤ç»„ï¼Œä¸è§å¾—å­˜åœ¨ï¼Œæ‰€ä»¥è¦æ‰‹åŠ¨åˆ›å»º
[root@study mrcode]# groupadd mygroup1
[root@study mrcode]# useradd -G mygroup1 -c "1st user" myuser1
[root@study mrcode]# useradd -G mygroup1 -c "2st user" myuser2
[root@study mrcode]# useradd -c "3st user" -s /sbin/nologin  myuser3

# å¤„ç†å¯†ç 
[root@study mrcode]# echo "password" | passwd --stdin myuser1
Changing password for user myuser1.
passwd: all authentication tokens updated successfully.
[root@study mrcode]# echo "password" | passwd --stdin myuser2
Changing password for user myuser2.
passwd: all authentication tokens updated successfully.
[root@study mrcode]# echo "password" | passwd --stdin myuser3
Changing password for user myuser3.
passwd: all authentication tokens updated successfully.
```

**ä»»åŠ¡ 2**ï¼šä½¿ç”¨è€… pro1ã€pro2ã€pro3 æ˜¯åŒä¸€ä¸ªé¡¹ç›®è®¡åˆ’çš„å¼€å‘äººå‘˜ï¼Œæƒ³è¦è¿™ä¸‰ä¸ªç”¨æˆ·åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹å·¥ä½œï¼Œä½†è¿™ä¸‰ä¸ªç”¨æˆ·è¿˜æ˜¯æ‹¥æœ‰è‡ªå·±çš„å®¶ç›®å½•ä¸åŸºæœ¬çš„ç§æœ‰ç¾¤ç»„ã€‚å‡è®¾è¯¥é¡¹ç›®è®¡åˆ’åœ¨ /srv/projecta ç›®å½•ä¸‹å¼€å‘ï¼Œå¦‚ä½•è¿›è¡Œ

```bash
# 1.åˆ›å»ºè¿™ä¸‰ä¸ªç”¨æˆ·
# 2.æŠŠä»–ä»¬çš„æ¬¡è¦ç¾¤ç»„æ·»åŠ åˆ° projecta ç¾¤ç»„
[root@study mrcode]# groupadd projecta
[root@study mrcode]# useradd -G projecta -c "projecta user"  pro1
[root@study mrcode]# useradd -G projecta -c "projecta user"  pro2
[root@study mrcode]# useradd -G projecta -c "projecta user"  pro3
[root@study mrcode]# echo "password" | passwd --stdin pro1
[root@study mrcode]# echo "password" | passwd --stdin pro2
[root@study mrcode]# echo "password" | passwd --stdin pro3

# åˆ›å»º /srv/projecta ç›®å½•ï¼Œå¹¶ä¸”å±äº projecta ç¾¤ç»„
[root@study mrcode]# mkdir /srv/projecta
[root@study mrcode]# ll -d /srv/projecta; chgrp projecta /srv/projecta/; ll -d /srv/projecta
drwxr-xr-x. 2 root root 6 Feb 24 15:04 /srv/projecta
drwxr-xr-x. 2 root projecta 6 Feb 24 15:04 /srv/projecta		# å·²ç»æ›´æ”¹ä¸º projecta ç¾¤ç»„äº†
# ç”±äºåªç»™è¿™ 3 ä¸ªäººä½¿ç”¨ï¼Œæ‰€ä»¥è¯¥ç›®å½•æƒé™éœ€è¦è®¾ç½® SGID ï¼ˆè¿™é‡Œä¸æ¸…æ¥šçš„åˆ°ç¬¬ 6 ç« çœ‹ SGID æ˜¯å«ä¹‰ï¼‰
# 2 SGIDï¼Œ770 å…¶ä»–äººä¸å¯è®¿é—®ï¼Œæ‹¥æœ‰è€…å’Œç¾¤ç»„å¯è®¿é—®ä¿®æ”¹å’Œæ‰§è¡Œ
[root@study mrcode]# chmod 2770 /srv/projecta/
[root@study mrcode]# ll -d /srv/projecta
drwxrws---. 2 root projecta 6 Feb 24 15:04 /srv/projecta
```

ä½†æ˜¯æ¥ä¸‹æ¥æœ‰ä¸€ä¸ªå›°æ‰°çš„é—®é¢˜å‘ç”Ÿäº†ï¼Œå‡å¦‚ ä»»åŠ¡1 çš„ myuser1 æ˜¯ projecta é¡¹ç›®çš„åŠ©ç†ï¼Œä»–éœ€è¦è¿™ä¸ªé¡¹ç›®çš„å†…å®¹ï¼Œä½†æ˜¯ _ä»–ä¸å¯ä»¥ä¿®æ”¹_ è¯¥ç›®å½•ç±»çš„ä»»ä½•æ•°æ®

- æ–¹æ¡ˆ 1ï¼šå°†ä»–åŠ å…¥ projecta ç¾¤ç»„ï¼Œæ­¤æ—¶ä»–æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œä¸ç¬¦åˆè¦æ±‚
- æ–¹æ¡ˆ 2ï¼šå°†æ–‡ä»¶ç›®å½•æƒé™ä¿®æ”¹ä¸º 2775ï¼›éç¾¤ç»„äººå‘˜æ‹¥æœ‰è¯»å’Œæ‰§è¡Œçš„æƒé™ï¼Œè¿™ä¸ªä¹Ÿä¸ç¬¦åˆè¦æ±‚

æ­¤æ—¶å‘ç°ï¼Œæ— èƒ½ä¸ºåŠ›äº†ï¼Œä½†æ˜¯å¯ç”±å€ŸåŠ©å¤–éƒ¨èº«ä»½è®¤è¯ç³»ç»Ÿï¼Œé’ˆå¯¹æŸä¸ªäººè®¾ç½®ä¸“å±çš„æƒé™

## ğŸ€ ä½¿ç”¨å¤–éƒ¨èº«ä»½è®¤è¯ç³»ç»Ÿ

åœ¨è°ˆ ACL ä¹‹å‰ï¼Œå…ˆæ¥è°ˆä¸€ä¸ªæ¦‚å¿µæ€§çš„æ“ä½œï¼Œå› ä¸ºç›®å‰æ²¡æœ‰æœåŠ¡å™¨å¯ä¾›ç»ƒä¹ 

æœ‰æ—¶å€™ï¼Œé™¤äº†æœ¬æœºçš„è´¦æˆ·ä¹‹å¤–ï¼Œå¯èƒ½è¿˜ä¼šä½¿ç”¨åˆ°å…¶ä»–å¤–éƒ¨çš„èº«ä»½éªŒè¯æœåŠ¡å™¨æ‰€æä¾›çš„éªŒè¯èº«ä»½çš„åŠŸèƒ½ï¼Œå¦‚ windows ä¸‹æœ‰ä¸ª Active Directory ï¼ˆADï¼‰çš„èº«ä»½éªŒè¯ç³»ç»Ÿï¼Œè¿˜æœ‰ Linux ä¸ºäº†æä¾›ä¸åŒä¸»æœºä½¿ç”¨åŒä¸€ç»„è´¦æˆ·å¯†ç ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ° LDAPã€NIS ç­‰æœåŠ¡å™¨æä¾›çš„èº«ä»½éªŒè¯ç­‰

å¦‚æœ Linux ä¸»æœºè¦ä½¿ç”¨åˆ°ä¸Šé¢æä¾›çš„è¿™äº›å¤–éƒ¨èº«ä»½éªŒè¯ç³»ç»Ÿæ—¶ï¼Œå¯èƒ½è¦é¢å¤–è®¾ç½®ï¼Œä¸ºäº†ç®€åŒ–ç”¨æˆ·çš„æ“ä½œæµç¨‹ï¼ŒCentOS æä¾›äº†ä¸€ä¸ª authconfig-tui çš„æŒ‡ä»¤ç»™æˆ‘ä»¬å‚è€ƒï¼Œè¯¥æŒ‡ä»¤çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

![image-20200224152159050](./assets/image-20200224152159050.png)

åœ¨ç”»é¢ä¸­ä½¿ç”¨ tab æŒ‰é’®åˆ‡æ¢é€‰é¡¹ï¼ˆå› ä¸ºè¿™é‡Œæ²¡æœ‰é€‚ç”¨çš„æœåŠ¡å™¨å¯ä»¥æµ‹è¯•ï¼Œåç»­è°ˆåˆ°æœåŠ¡å™¨ç« èŠ‚æ—¶å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼Œä¸è¿‡ä¸Šå›¾å¤§æ¦‚æ”¯æŒ MD5 è¿™ä¸ªæ—©æœŸçš„å¯†ç æ ¼å¼äº†ã€‚æ­¤å¤–ï¼Œä¸è¦éšä¾¿å°†å·²ç»å¯ç”¨çš„é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯è¢« * å·æ ‡è¯†çš„é¡¹ç›®ï¼‰å–æ¶ˆæ‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›è´¦æˆ·å¤±æ•ˆ