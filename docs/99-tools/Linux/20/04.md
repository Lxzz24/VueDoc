---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# å¤‡ä»½çš„ç§ç±»ã€é¢‘ç‡ã€ä¸å·¥å…·çš„é€‰æ‹©

å¤‡ä»½çš„ç§ç±»ç²—äº†åˆ†ä¸ºï¼šç´¯ç§¯å¤‡ä»½ã€å·®å¼‚å¤‡ä»½ã€‚å¦‚æœä»…æƒ³åœ¨ç³»ç»Ÿå‡ºé”™æ—¶é‡æ–°å®‰è£…åˆ°æ›´æ–°çš„ç³»ç»Ÿæ—¶ï¼Œä»…å¤‡ä»½å…³é”®æ•°æ®ä¹Ÿå¯ä»¥

## ğŸ€ å®Œæ•´å¤‡ä»½ä¹‹ç´¯ç§¯å¤‡ä»½ï¼ˆIncremental backupï¼‰

ç¬”è€…ä¸ªäººè§‰å¾—ï¼Œå…³äºè¦å¦‚ä½•å¤‡ä»½ï¼Œè¦çœ‹ä½ çš„éœ€æ±‚ï¼Œè¿™é‡Œè®²è§£æ¯ç§å¤‡ä»½çš„ä¸€äº›æ€è·¯ä¸æ€è€ƒ

### è¿˜åŸè€ƒè™‘

å¦‚æœæ˜¯å®Œæ•´å¤‡ä»½çš„è¯ï¼Œå¯ä»¥ç›´æ¥å¤‡ä»½ `/` æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¿˜åŸæ—¶ä¹Ÿæ˜¯å…¨éƒ¨è¿˜åŸï¼Œè¿™ä¸ªæ˜¯å¾ˆå¿«é€Ÿæ–¹ä¾¿çš„ï¼Œè¿˜å¯ä»¥å¤‡ä»½ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ `/dev/sda1`

### ç´¯ç§¯å¤‡ä»½çš„åŸåˆ™ï¼ˆå¢é‡å¤‡ä»½ï¼‰

ç´¯ç§¯å¤‡ä»½ï¼šç³»ç»Ÿå…ˆè¿›è¡Œä¸€æ¬¡å®Œæ•´æ•°æ®å¤‡ä»½ä¹‹åï¼Œä¸‹æ¬¡å†å¤‡ä»½ä»…å¤‡ä»½æœ‰å˜åŒ–çš„æ•°æ®ã€‚

è¿™æ ·å¤‡ä»½è§„åˆ™æ•°æ®é‡å°ä¸”å¿«é€Ÿï¼Œå¤‡ä»½å¾ˆæœ‰æ•ˆç‡

å¦‚ä½•è¿˜åŸï¼Ÿç”±äºæ˜¯å¢é‡å¤‡ä»½ï¼Œå½“è¿˜åŸçš„æ—¶å€™éœ€è¦ä»ç¬¬ä¸€æ¬¡å¤‡ä»½å¼€å§‹ä»¥æ­¤è¿˜åŸ

### ç´¯ç§¯å¤‡ä»½ä½¿ç”¨çš„å¤‡ä»½è½¯ä»¶

å®Œæ•´å¤‡ä»½å¸¸ç”¨çš„å·¥å…·æœ‰ ddã€cpioã€xfsdumpã€xfsrestor ç­‰ã€‚å› ä¸ºè¿™äº›å·¥å…·éƒ½èƒ½å¤‡ä»½è®¾å¤‡ä¸ç‰¹æ®Šæ–‡ä»¶

- dd å¯ä»¥ç›´æ¥è¯»å–ç£ç›˜æ‰‡åŒºè€Œä¸ç®¡æ–‡ä»¶ç³»ç»Ÿï¼Œç¼ºç‚¹å°±æ˜¯æœ‰ç‚¹æ…¢
- cpio èƒ½å¤‡ä»½æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦ find æˆ–å…¶ä»–æ‰¾æ–‡ä»¶åçš„æŒ‡ä»¤æ‰èƒ½å¤„ç†

ä»¥ä¸Šä¸¤ä¸ªéƒ½å¯ä»¥å®Œæ•´å¤‡ä»½ï¼Œä½†ç´¯è®¡å¤‡ä»½å°±è¦é¢å¤–çš„ä½¿ç”¨è„šæœ¬ç¨‹åºæ¥å¤„ç†ã€‚

xfsdump å¯ä»¥ç›´æ¥å®Œæˆç´¯ç§¯å¤‡ä»½ï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†åœ¨ç¬¬ 8 ç« æœ‰è®²è§£

```bash
# 1. ç”¨ dd å°† /dev/sda å¤‡ä»½åˆ°å®Œå…¨ä¸€æ¨¡ä¸€æ ·çš„ /dev/sdb ç¡¬ç›˜ä¸Š
dd if=/dev/sda of=/dev/sdb
# ç”±äºæ˜¯ç›´æ¥è¯»å–æ‰‡åŒºï¼Œæ‰€ä»¥  /dev/sdb ç£ç›˜å¯ä»¥ä¸ç”¨æ ¼å¼åŒ–

# 2. ä½¿ç”¨ cpio æ¥å¤‡ä»½è¿˜åŸæ•´ä¸ªç³»ç»Ÿï¼Œå‡è®¾å­˜å‚¨åª’ä½“ä¸º SATA ç£å¸¦æœº
find / -print | cpio -covB > /dev/st0  # å¤‡ä»½åˆ°ç£å¸¦æœº
cpio -iduv < /dev/st0		# è¿˜åŸ
```

å‡è®¾ `/home` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œ `/backupdata` ä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç”¨æ¥å¤‡ä»½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ä½•ä½¿ç”¨ dump å°† `/home` å®Œæ•´å¤‡ä»½åˆ° /backupdata å‘¢?

```bash
# 1. å®Œæ•´å¤‡ä»½
xfsdump -l 0 -L 'full' -M -f /backupdata/home.dump /home

# 2. ç¬¬ä¸€æ¬¡è¿›è¡Œç´¯ç§¯å¤‡ä»½
xfsdump -l 1 -L â€˜full-1â€™ -N -f /backupdata/home.dump1 /home
```

ta ä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡Œå®Œæ•´å¤‡ä»½ã€‚æ¯”å¦‚  `backupdata` æ˜¯ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæƒ³å°†æ•´ä¸ªç³»ç»Ÿå¤‡ä»½èµ·æ¥æ—¶ï¼Œå¯ä»¥è¿™æ ·è€ƒè™‘ï¼šå°†ä¸éœ€è¦å¤‡ä»½çš„ `/proc`ã€`/mnt`ã€`/tmp` ç­‰ç›®å½•ä¸å¤‡ä»½ï¼Œå…¶ä»–çš„æ•°æ®åˆ™å¤‡ä»½

```bash
tar -exclude /proc --exclude /mnt --exclude /tmp --exclude /backupdata -jcvp /backupdata/system.tar.bz2
```

## ğŸ€ å®Œæ•´å¤‡ä»½ä¹‹å·®å¼‚å¤‡ä»½ï¼ˆDifferential backupï¼‰

å·®å¼‚å¤‡ä»½ï¼šä¸ç´¯ç§¯å¤‡ä»½ç±»ä¼¼ï¼Œç¬¬ä¸€æ¬¡éœ€è¦å®Œæ•´å¤‡ä»½ï¼Œåé¢çš„æ¯æ¬¡å¤‡ä»½éƒ½æ˜¯ä»¥ç¬¬ä¸€æ¬¡ä½œä¸ºåŸºå‡†çš„å·®å¼‚å¤‡ä»½ã€‚æ‰€ä»¥ç³»ç»Ÿè¿è¡Œè¶Šä¹…ï¼Œç¦»å®Œæ•´å¤‡ä»½æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆè¯¥æ¬¡çš„å·®å¼‚å¤‡ä»½æ•°æ®å¯èƒ½å°±ä¼šè¶Šå¤§

å·®å¼‚å¤‡ä»½ä¸ç´¯ç§¯å¤‡ä»½çš„å¸¸ç”¨å·¥å…·ç±»ä¼¼ï¼Œå› ä¸ºéƒ½éœ€è¦å®Œæ•´å¤‡ä»½ï¼Œå¦‚æœä½¿ç”¨ xfsdump æ¥å¤‡ä»½çš„è¯ï¼Œé‚£ä¹ˆæ¯æ¬¡å¤‡ä»½çš„ç­‰çº§ï¼ˆlevelï¼‰ å°±éƒ½æ˜¯ level 1 ã€‚

å½“ä½¿ç”¨ tar çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ -N é€‰é¡¹æ¥å¤‡ä»½

```bash
tar -N â€˜2020-04-04â€™ -jpcv -f /backupdata/home.tar.bz2 /home
# åªæœ‰åœ¨æ¯” 2020-04-04 è¿˜è¦æ–°çš„æ–‡ä»¶æ—¶ï¼Œåœ¨ /home ä¸‹çš„æ–‡ä»¶æ‰ä¼šè¢«æ‰“åŒ…è¿› home.tar.bz2 ä¸­
# æœ‰ä¸€ç‚¹ä¸å¥½å°±æ˜¯ï¼Œç›®å½•ä¼šè¢«å¤‡ä»½è¿›æ¥ï¼Œåªæ˜¯ç›®å½•å†…çš„æ—§æ–‡ä»¶ä¸ä¼šå¤‡ä»½
```

å¦å¤–è¿˜å¯ä»¥é€šè¿‡ rsync æ¥è¿›è¡Œé•œåƒå¤‡ä»½ã€‚rsync å¯ä»¥å¯¹ä¸¤ä¸ªç›®å½•è¿›è¡Œé•œåƒï¼ˆmirrorï¼‰ï¼Œç®—æ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿçš„å¤‡ä»½å·¥å…·ï¼Œç®€å•æŒ‡ä»¤è¯­æ³• `rsync -av æ¥æºç›®å½• ç›®æ ‡ç›®å½•`

```bash
# 1. å°† /home/ é•œåƒåˆ° /backupdata/home/ 
rsync -av /home /backupdata/
# æ­¤æ—¶ä¼šåœ¨ /backupdata ä¸‹äº§ç”Ÿ home ç›®å½•
rsync -av /home /backupdata/
# å†æ¬¡æ‰§è¡Œå°±ä¼šå¿«å¾ˆå¤šï¼Œå¦‚æœæ•°æ®æ²¡æœ‰æ”¹å˜ï¼Œå‡ ä¹ä¸ä¼šè¿›è¡Œä»»ä½•åŠ¨ä½œ

```

å·®å¼‚å¤‡ä»½æ‰€ä½¿ç”¨çš„ç£ç›˜å®¹é‡å¯èƒ½ä¼šæ¯”ç´¯ç§¯å¤‡ä»½æ›´å¤§ï¼Œä½†æ˜¯å·®å¼‚å¤‡ä»½è¿˜åŸè¾ƒå¿«

## ğŸ€ å…³é”®æ•°æ®å¤‡ä»½

å®Œæ•´å¤‡ä»½è™½ç„¶æœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹åªéœ€è¦å¤‡ä»½é‡è¦æ–‡ä»¶å³å¯ï¼Œæ¯”å¦‚ä½ çš„ä¸»æœºä¸æ˜¯ä¸€å®šè¦ 24 å°æ—¶æä¾›çš„æœåŠ¡ï¼Œå°±ç®—å®•æœºä¸¤ä¸‰å¤©ï¼Œå¯èƒ½ä¹Ÿä¸ä¼šå½±å“åˆ°ä½ çš„æ­£å¸¸ç”Ÿæ´»æ—¶ã€‚

å…³æœºæ•°æ®å¤‡ä»½ä¹Ÿæœ‰ä¸€äº›å¥½å¤„ï¼šæ¯”å¦‚å®Œæ•´å¤‡ä»½æ˜¯åœ¨ç³»ç»Ÿè¿è¡ŒæœŸé—´ï¼Œå¦‚æœç³»ç»Ÿæœ¬èº«å°±æœ‰é—®é¢˜äº†ï¼Œå°±ç®—è¿˜åŸå›å»ï¼Œè¿˜æ˜¯æœ‰é—®é¢˜çš„

å¯¹äºå…³æœºæ•°æ®çš„å¤‡ä»½ï¼Œå¯¹äºè¿˜åŸç¨å¾®éš¾ä¸€ç‚¹ï¼Œä½ éœ€è¦å¾ˆç†Ÿæ‚‰ç³»ç»Ÿçš„è¿ä½œï¼Œå°¤å…¶æ˜¯ SELinux ç­‰å®‰å…¨è¡Œç®¡çš„æƒé™ç­‰é—®é¢˜æ—¶ã€‚

ä½œè€…åœ¨å¤‡ä»½å…³é”®æ•°æ®æ—¶å–œæ¬¢ä½¿ç”¨ tar + date æ¥é…åˆ

```bash
tar -jpcvf mysql.`date +%y-%m-%d`.tar.bz2 /var/mysql
```

å¤‡ä»½æ˜¯éå¸¸é‡è¦çš„å·¥ä½œï¼Œä½ å¯ä»¥ç¼–å†™è„šæœ¬é…åˆ crontab å»æ‰§è¡Œ



