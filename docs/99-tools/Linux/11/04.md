---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
#  æ–‡ä»¶çš„æ ¼å¼åŒ–ä¸ç›¸å…³å¤„ç†

ä¸éœ€è¦é€šè¿‡ vim å»ç¼–è¾‘ï¼Œè€Œæ˜¯é€šè¿‡æ•°æ®æµé‡å¯¼å‘é…ç½® printf åŠŸèƒ½ä»¥åŠ awk æŒ‡ä»¤ï¼Œå¯ä»¥å¯¹æ–‡å­—ä¿¡æ¯è¿›è¡Œæ’ç‰ˆæ˜¾ç¤º

## ğŸ€ æ ¼å¼åŒ–æ‰“å°ï¼šprintf

æ¯”å¦‚å°†è€ƒè¯•åˆ†æ•°è¾“å‡ºï¼Œå§“åä¸ç§‘ç›®åŠåˆ†æ•°ä¹‹é—´ï¼Œç¨å¾®åšä¸ªæ¯”è¾ƒæ¼‚äº®çš„ç‰ˆé¢ï¼Œæ¯”å¦‚è¾“å‡ºä¸‹é¢è¿™æ ·çš„è¡¨æ ¼

```
Name		Chinese		Enlish		Math		Average
DmTsai		80				60				92			77.33
VBird			75				55				80			70.00
Ken				60				90				70			73.33
```

ä¸Šè¡¨æ•°æ®ä¸»è¦åˆ†æˆ 5 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µä¹‹é—´å¯ä»¥ä½¿ç”¨ tab æˆ–ç©ºæ ¼è¿›è¡Œåˆ†å‰²ã€‚å°†ä¸Šè¡¨å­˜å‚¨åˆ° printf.txt æ–‡ä»¶ä¸­ï¼Œåç»­ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶è¿›è¡Œç»ƒä¹ ã€‚

ç”±äºæ¯ä¸ªå­—æ®µçš„é•¿åº¦å¹¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¦è¾¾åˆ°ä¸Šè¡¨æ•ˆæœï¼Œå°±éœ€è¦æ‰“å°æ ¼å¼ç®¡ç†å‘˜ printf æ¥å¸®å¿™äº†

```bash
printf 'æ‰“å°æ ¼å¼' å®é™…ç±»å®¹
é€‰é¡¹ä¸å‚æ•°ï¼š
 å…³äºæ ¼å¼æ–¹é¢çš„å‡ ä¸ªç‰¹æ®Šæ ·å¼ï¼š
 		\a	è­¦å‘Šå‰©ä½™è¾“å‡º
 		\b	é€€æ ¼é”®ï¼ˆbackspaceï¼‰
 		\f	æ¸…æ¥šå±å¹•ï¼ˆform feedï¼‰
 		\n 	è¾“å‡ºæ–°çš„ä¸€è¡Œ
 		\r	Enter æŒ‰é”®ï¼Œæ¢è¡Œ
 		\t	æ°´å¹³çš„ tab æŒ‰é”®
 		\v	å‚ç›´çš„ tab æŒ‰é”®
 		\xNN	NN ä¸ºä¸¤ä½æ•°çš„æ•°å­—ï¼Œå¯ä»¥è½¬æ¢æ•°å­—ç§°ä¸ºå­—ç¬¦
 å…³äº C ç¨‹åºè¯­è¨€å†…ï¼Œå¸¸è§çš„å˜é‡æ ¼å¼ï¼š
 		%ns		n æ•°å­—ï¼Œs è¡¨ç¤º stringï¼Œä¹Ÿå°±æ˜¯å¤šå°‘ä¸ªå­—ç¬¦
 		%ni		n æ•°å­—ï¼Œi è¡¨ç¤º integerï¼Œå¤šå°‘æ•´æ•°æ•°å­—
 		%N.nf 	n ä¸ N éƒ½æ˜¯æ•°å­—ï¼Œf è¡¨ç¤º floatingï¼ˆæµ®ç‚¹ï¼‰ï¼Œå¦‚æœæœ‰å°æ•°ï¼Œæ¯”å¦‚å…± 10 ä¸ªä½æ•°ï¼Œå°æ•°ç‚¹ 2 ä½æ•°ï¼Œåˆ™å†™æˆ %10.2f
```

ä¸‹é¢è¿›è¡Œç»ƒä¹ 

```bash
# èŒƒä¾‹ 1ï¼šå°†ä¸Šé¢å­˜å‚¨çš„ printf.txt å†…å®¹ä»…åˆ—å‡ºå§“åä¸æˆç»©ï¼Œå¹¶ä¸”ç”¨ tab åˆ†å‰²
# æ–‡ä»¶å­˜å‚¨æ—¶ï¼Œå­—æ®µä¹‹é—´å…¨éƒ¨ç”¨ tab éš”å¼€çš„ï¼Œå¤åˆ¶è¿›å»å°±å˜æˆä¸‹é¢å±•ç¤ºè¿™æ ·äº†
 [mrcode@study tmp]$ cat printf.txt 
Name            Chinese         Enlish          Math            Average
DmTsai          80                              60                              92                      77.33
VBird                   75                              55                              80                      70.00
Ken                             60                              90                              70                      73.33
# ç”±äº printf ä¸æ˜¯ç®¡çº¿å‘½ä»¤ï¼Œéœ€è¦é€šè¿‡ cat å…ˆæå–å‡ºæ¥å†…å®¹
# %s è¡¨ç¤ºä¸å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œåé¢è·Ÿäº†ä¸€ä¸ªç©ºæ ¼ï¼Œå¹¶ä½¿ç”¨æ¨ªå‘åˆ¶è¡¨ç¬¦ \t æ¥æ ¼å¼åŒ–
[mrcode@study tmp]$ printf '%s \t %s \t %s \t %s \t %s \t \n ' $(cat printf.txt)
Name     Chinese         Enlish          Math    Average         
 DmTsai          80      60      92      77.33   
 VBird   75      55      80      70.00   
 Ken     60      90      70      73.33 
```

å¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„æ•ˆæœè™½ç„¶å¥½å¤šäº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰å¯¹é½ã€‚å¯èƒ½æ˜¯ç”±äº Chinese æ¯”å…¶ä»–çš„é•¿åº¦è¦é•¿ï¼Œå¯¼è‡´å¯¹ä¸é½ï¼Œé‚£ä¹ˆä¸‹é¢æ¥å›ºå®šé•¿åº¦

```bash
# èŒƒä¾‹ 2ï¼šå°†ä¸Šè¿°ç¬¬äºŒè¡Œä»¥åï¼Œåˆ†åˆ«ä»¥å­—ç¬¦ä¸²ã€æ•´æ•°ã€å°æ•°ç‚¹æ¥æ˜¾ç¤º
# grep -v Name æ’é™¤åŒ…å« Name å­—ç¬¦çš„è¡Œ
[mrcode@study tmp]$ printf '%10s %5i %5i %5i %8.2f \n' $(cat printf.txt | grep -v Name)
    DmTsai    80    60    92    77.33 
     VBird    75    55    80    70.00 
       Ken    60    90    70    73.33 
# ç”±äºè¿™é‡Œæ˜¯æ ¼å¼åŒ–æ•°å­—ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œæ— æ³•ä½¿ç”¨è¿™é‡Œçš„è¡¨è¾¾å¼ï¼Œå¦‚æœä½¿ç”¨å°†å¾—åˆ°æ•°å­— 0 çš„å±•ç¤º
# å±•ç¤ºæ•ˆæœå¥½äº†å¾ˆå¤š
 %10sï¼šè¿™ä¸€ä¸ªå­—æ®µæ°¸è¿œæ˜¾ç¤º 10 ä¸ªå­—ç¬¦å®½åº¦ï¼Œä¸è¶³çš„ç”¨ç©ºæ ¼è¡¥ä½
 %8.2fï¼šè¡¨ç¤º 00000.00
```

printf é™¤äº†å¯ä»¥æ ¼å¼åŒ–å¤„ç†ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ® ASCII çš„æ•°å­—ä¸å›¾å½¢å¯¹åº”æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå¦‚ä¸‹

```bash
# èŒƒä¾‹ 3ï¼š åˆ—å‡º 16 è¿›åˆ¶ 45 ä»£è¡¨çš„å­—ç¬¦æ˜¯ä»€ä¹ˆ
[mrcode@study tmp]$ printf '\x45\n'
E
# å¯ä»¥å°†æ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ï¼Œå¦‚æœä½ ä¼šå†™ script çš„è¯
# å¯ä»¥æµ‹è¯•ä¸‹ï¼Œ20~80 ä¹‹é—´çš„æ•°å€¼è¡¨ç¤ºçš„å­—ç¬¦æ˜¯ä»€ä¹ˆ
```

printf ä½¿ç”¨ç›¸å½“å¹¿æ³›ï¼ŒåŒ…æ‹¬åé¢æåˆ°çš„ awk ä»¥åŠåœ¨ c ç¨‹åºè¯­è¨€ä¸­ä½¿ç”¨çš„å±å¹•è¾“å‡ºï¼Œéƒ½æ˜¯åˆ©ç”¨ printfã€‚

printf ä½¿ç”¨åœºæ™¯å°±æ˜¯æ ¼å¼åŒ–è¾“å‡ºï¼Œå¦‚æœä½ è¦å†™è‡ªå·±çš„è½¯ä»¶ï¼ŒæŠŠä¿¡æ¯æ¼‚äº®çš„è¾“å‡ºåˆ°å±å¹•çš„è¯ï¼Œå¯æ˜¯å¾ˆæœ‰ç”¨çš„

## ğŸ€ awkï¼šå¥½ç”¨çš„æ•°æ®å¤„ç†å·¥å…·

- sedï¼šå¸¸å¸¸ç”¨äºä¸€æ•´è¡Œçš„å¤„ç†
- awkï¼šå€¾å‘äºå°†ä¸€è¡Œåˆ†æˆæ•°ä¸ªå­—æ®µæ¥å¤„ç†

å› æ­¤ï¼Œawk é€‚åˆå¤„ç†å°å‹çš„æ•°æ®å¤„ç†ã€‚

```bash
awk 'æ¡ä»¶ç±»å‹1{åŠ¨ä½œ1} æ¡ä»¶ç±»å‹2{åŠ¨ä½œ2} ...' filename

awk åå¯ä»¥è·Ÿæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ¥å—å‰ä¸ªæŒ‡ä»¤çš„ standard output
awk ä¸»è¦å¤„ç†æ¯ä¸€è¡Œçš„å­—æ®µå†…çš„æ•°æ®ï¼Œä»–é»˜è®¤çš„åˆ†éš”ç¬¦ä¸ºã€Œç©ºæ ¼é”®ã€æˆ–ã€Œtab é”®ã€
```

```bash
# èŒƒä¾‹ï¼šä½¿ç”¨ last å°†ç™»å½•è€…æ•°æ®å–å‡ºæ¥
[mrcode@study tmp]$ last -n 5		# å–å‡ºå‰ 5 è¡Œ
mrcode   pts/1        192.168.0.105    Wed Jan 15 22:20   still logged in   
mrcode   pts/0        192.168.0.105    Wed Jan 15 22:20   still logged in   
reboot   system boot  3.10.0-1062.el7. Wed Jan 15 22:19 - 23:05  (00:45)    
mrcode   pts/1        192.168.0.105    Mon Jan 13 22:51 - 23:13  (00:22)    
mrcode   pts/0        192.168.0.105    Mon Jan 13 22:51 - 23:13  (00:22) 

# è‹¥è¦å–å‡ºè´¦æˆ·ä¸ç™»å½• IP ï¼Œä¸”è´¦æˆ·ä¸ IP ä¹‹é—´ä»¥ tab éš”å¼€ï¼Œå¯ä»¥è¿™æ ·å†™
[mrcode@study tmp]$ last -n 5 | awk '{print $1 "\t" $3}'
mrcode  192.168.0.105
mrcode  192.168.0.105
reboot  boot
mrcode  192.168.0.105
mrcode  192.168.0.105
        
wtmp    Fri
# ç”±äºæ¯ä¸€è¡Œæ•°æ®éƒ½éœ€è¦å¤„ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦æœ‰æ¡ä»¶ç±»å‹
# é€šè¿‡ print åŠŸèƒ½å°†æ•°æ®åˆ—å‡ºæ¥
# ç¬¬ 3 è¡Œæ•°æ®è¢«è¯¯åˆ¤äº†ï¼Œç¬¬äºŒä¸ªå­—æ®µä¸­åŒ…å«äº†ç©ºæ ¼
# é‚£ä¹ˆ $1 å¼€å§‹çš„å˜é‡è¡¨ç¤ºå“ªä¸€ä¸ªå­—æ®µï¼Œè¦æ³¨æ„çš„æ˜¯ï¼š$0 è¡¨ç¤ºæ•´è¡Œæ•°æ®
```

å¯¹äºä¸Šé¢ç¤ºä¾‹ï¼Œawk çš„å¤„ç†æµç¨‹æ˜¯ï¼š

1. è¯»å…¥ç¬¬ä¸€è¡Œï¼Œå¹¶å°†ç¬¬ä¸€è¡Œçš„å†…å®¹å¡«å…¥ `$0ã€$1...` å˜é‡ä¸­
2. ä¾æ® æ¡ä»¶ç±»å‹ çš„é™åˆ¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåé¢çš„ åŠ¨ä½œ
3. åšå®Œæ‰€æœ‰çš„åŠ¨ä½œä¸æ¡ä»¶ç±»å‹
4. è‹¥è¿˜æœ‰åç»­çš„ã€Œè¡Œã€æ•°æ®ï¼Œåˆ™é‡å¤ä¸Šé¢ 1~3 æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å¤„ç†å®Œä¸ºæ­¢

awk æ˜¯ã€Œä»¥è¡Œä¸ºä¸€æ¬¡å¤„ç†çš„å•ä½ã€è€Œã€Œä»¥å­—æ®µä¸ºæœ€å°çš„å¤„ç†å•ä½ã€ï¼Œé‚£ä¹ˆ awk ä¸­è¿˜æä¾›äº†ä»¥ä¸‹å˜é‡ä¿¡æ¯

| å˜é‡åç§° |               å«ä¹‰                |
| :------: | :-------------------------------: |
|    NF    |   æ¯ä¸€è¡Œï¼ˆ`$0`ï¼‰æ‹¥æœ‰çš„å­—æ®µæ€»æ•°    |
|    NR    | ç›®å‰ awk æ‰€å¤„ç†çš„æ˜¯ã€Œç¬¬å‡ è¡Œã€æ•°æ® |
|    FS    |    ç›®å‰çš„åˆ†å‰²å­—ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼     |

ç»§ç»­ä¸Šé¢ last -n 5 çš„ä¾‹å­æ¥åšè¯´æ˜

```bash
# æƒ³è¦åˆ—å‡ºæ¯ä¸€è¡Œçš„è´¦æˆ·ï¼šå°±æ˜¯ $1
# åˆ—å‡ºç›®å‰å¤„ç†çš„è¡Œæ•°ï¼šNR å˜é‡
# è¯¥è¡Œæœ‰å¤šå°‘å­—æ®µï¼šNF å˜é‡
# æ³¨æ„ï¼šåœ¨ awk çš„æ ¼å¼å†…ä½¿ç”¨ print æ‰“å°æ—¶ï¼Œéå˜é‡éƒ¨åˆ†éœ€è¦ç”¨åŒå¼•å·å¼•ç”¨èµ·æ¥ï¼Œå› ä¸º awk åŠ¨ä½œæ˜¯ä»¥å•å¼•å·çš„
[mrcode@study ~]$ last -n 5 | awk '{print $1 "\t lines:" NR "\t columns:" NF}'
mrcode   lines:1         columns:10
mrcode   lines:2         columns:10
reboot   lines:3         columns:11
mrcode   lines:4         columns:10
mrcode   lines:5         columns:10
         lines:6         columns:0
wtmp     lines:7         columns:7
# æ³¨æ„ NF ç­‰å˜é‡ä¸éœ€è¦æœ‰ $ å¹¶ä¸”éœ€è¦å¤§å†™
```

### awk çš„é€»è¾‘è¿ç®—å­—ç¬¦

æ—¢ç„¶æœ‰ã€Œæ¡ä»¶ã€ï¼Œé‚£ä¹ˆå°±æœ‰é€»è¾‘è¿ç®—ç¬¦å·

| è¿ç®—å•å…ƒ |  ä»£è¡¨æ„ä¹‰  |
| :------: | :--------: |
|   `>`    |    å¤§äº    |
|   `<`    |    å°äº    |
|   `>=`   | å¤§äºæˆ–ç­‰äº |
|   `>=`   | å°äºæˆ–ç­‰äº |
|   `==`   |  **ç­‰äº**  |
|   `!=`   |   ä¸ç­‰äº   |

èŒƒä¾‹ï¼šåœ¨ /etc/passwd ä¸­æ˜¯ä»¥å†’å·ã€Œ:ã€æ¥åˆ†å‰²å­—æ®µçš„ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸ºè´¦æˆ·ï¼Œç¬¬ä¸‰å­—æ®µåˆ™æ˜¯ UID.

```bash
# æŸ¥é˜… ç¬¬ä¸‰æ å°äº 10 ä»¥ä¸‹çš„æ•°æ®ï¼Œå¹¶ä¸”ä»…åˆ—å‡ºè´¦æˆ·ä¸ç¬¬ä¸‰æ 
# FS æ˜¯å­—æ®µåˆ†éš”ç¬¦
[mrcode@study ~]$ cat /etc/passwd | awk '{FS=":"} $3 < 10 {print $1 "\t" $3}'
root:x:0:0:root:/root:/bin/bash 
bin     1
daemon  2
adm     3
lp      4
sync    5
shutdown        6
halt    7
mail    8
```

ç¬¬ä¸€è¡Œï¼Œæ²¡æœ‰ç”Ÿæ•ˆæ˜¯ä¸ºå•¥å‘¢ï¼Ÿåœ¨ awk ä¸­ï¼Œåœ¨ä¸Šè¿°å®šä¹‰ä¸­ï¼ŒFS ä»…èƒ½åœ¨ç¬¬äºŒè¡Œå¼€å§‹ï¼Œ

```bash
# éœ€è¦ä½¿ç”¨å…³é”®å­— BEGINï¼Œå¯¹åº”çš„è¿˜æœ‰ END
[mrcode@study ~]$ cat /etc/passwd | awk 'BEGIN {FS=":"} $3 < 10 {print $1 "\t" $3}'
root    0
bin     1
daemon  2
```

ä½¿ç”¨ awk çš„è®¡ç®—åŠŸèƒ½ï¼Œæ¯”å¦‚æœ‰å¦‚ä¸‹çš„æ•°æ® pay.txt

```
Name		1st		2nd		3th
Mrcode	2300	2400	2500
DMTsai	2100	2000	2300
Mrcode2	4300	4200	4100
```

```bash
# è®¡ç®—æ¯ä¸ªäººçš„æ€»é¢ï¼Œè€Œä¸”è¿˜è¦æ ¼å¼åŒ–è¾“å‡º
 - ç¬¬ä¸€è¡Œæ˜¯è¯´æ˜ï¼Œä¸éœ€è¦è®¡ç®—ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ¡ä»¶ NR=1 æ—¶å†å¤„ç†
 - ç¬¬äºŒè¡Œæ‰å¼€å§‹è®¡ç®—ï¼ŒNR >=2 æ‰å¤„ç†

[mrcode@study tmp]$ cat pay.txt | 
> awk 'NR==1 {printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"Total" }
> NR>=2 {total = $2 + $3 + $4 ; printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total}'
      Name        1st        2nd        3th      Total
    Mrcode       2300       2400       2500    7200.00
    DMTsai       2100       2000       2300    6400.00
   Mrcode2       4300       4200       4100   12600.00

ä¸ºäº†æ–¹ä¾¿å¤åˆ¶ï¼Œè¿™é‡Œç²˜è´´ä¸Šå®Œæ•´çš„ä¸€è¡Œå‘½ä»¤ï¼šcat pay.txt |  awk 'NR==1 {printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"Total" } NR>=2 {total = $2 + $3 + $4 ; printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total}'

# ç°åœ¨æ¥åˆ†è§£ä¸Šé¢æŒ‡ä»¤
# 1. åœ¨ awk ä¸­ï¼Œéå˜é‡éœ€è¦ä½¿ç”¨åŒå¼•å·å¼•ç”¨èµ·æ¥
# 2. ä½¿ç”¨ printf æ—¶ï¼Œéœ€è¦åŠ ä¸Š \n æ‰èƒ½æ¢è¡Œ
# ä¸‹é¢çš„å«ä¹‰æ˜¯ï¼Œå½“æ˜¯ç¬¬ä¸€è¡Œçš„æ—¶å€™ï¼Œæ‰§è¡Œæ‰“å°ä¸ªæ ¼å¼åŒ–ï¼Œå‰é¢æ˜¯æ ¼å¼åŒ–è¡¨è¾¾å¼
# åé¢ç”¨é€—å·åˆ†å‰²ï¼Œç»™å‡ºå¯¹åº”å†…å®¹ï¼Œè¿™é‡Œç»™å‡ºäº† 1~4 ä¸ªå­—æ®µï¼Œå¹¶æ–°å¢äº†ä¸€ä¸ª total å­—æ®µ
[mrcode@study tmp]$ cat pay.txt | awk 'NR==1 {printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"total"}'
      Name        1st        2nd        3th      total

# å¯¹äºè®¡ç®—çš„è®²è§£
# 1. åœ¨{} åŠ¨ä½œä¸­å¯ä»¥è®¾ç½®å˜é‡ï¼Œè¿›è¡Œè¿ç®—ï¼›è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ª total å˜é‡ï¼Œå¹¶æŠŠ 1~3 ä¸ªå­—æ®µç›¸åŠ 
# 2. ç”±äºè¿™é‡Œæœ‰å¤šä¸ªæŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å†’å· ã€Œ;ã€ è¿›è¡Œåˆ†å‰²
# 3. ä½¿ç”¨ printf å¸¸è§„æ‰“å°ï¼Œç¬¬ 5 ä¸ªå­—æ®µå¼•ç”¨äº†åŠ¨ä½œå†…è®¾ç½®çš„å˜é‡ totalï¼Œè®°ä½ awk ä¸­å¼•ç”¨å˜é‡ä¸éœ€è¦ä½¿ç”¨ % ç¬¦å·
[mrcode@study tmp]$ cat pay.txt | awk 'NR>=2 {total=$1+$2+$3 ; printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total}'
    Mrcode       2300       2400       2500    4700.00
    DMTsai       2100       2000       2300    4100.00
   Mrcode2       4300       4200       4100    8500.00

# é‚£ä¹ˆä¸Šé¢ä¸¤æ¡æ˜¯é’ˆå¯¹å„è‡ªæ¡ä»¶è¿›è¡Œå¤„ç†çš„ï¼Œç›¸å½“äº if è¯­å¥ï¼›å¤šä¸ªæ¡ä»¶åŠ¨ä½œä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†å‰²ï¼›é“¾æ¥èµ·æ¥å°±å®Œæˆäº†
```

åˆ©ç”¨ awk å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†å¾ˆå¤šæ—¥å¸¸å·¥ä½œäº†ï¼Œåœ¨ awk çš„è¾“å‡ºæ ¼å¼ä¸­ï¼Œå¸¸å¸¸ä¼šä»¥ printf æ¥è¾…åŠ©ã€‚å¦å¤–åœ¨ {} åŠ¨ä½œå†…ï¼Œä¹Ÿæ”¯æŒ if(æ¡ä»¶) è¯­å¥ã€‚é‚£ä¹ˆä¸Šé¢çš„æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ if æ¥åšï¼Œå¦‚ä¸‹

```bash
cat pay.txt | awk '{if(NR==1) printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"Total" } NR>=2 {total = $2 + $3 + $4 ; printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total}'
```

ç¬”è€…æ²¡æœ‰æ„Ÿè§‰è¿™ä¸ª if æœ‰å¤šæ–¹ä¾¿å•Šï¼Ÿ

å¦å¤–ï¼Œawk è¿˜å¯ä»¥è¿›è¡Œå¾ªç¯è®¡ç®—ï¼Œä¸è¿‡è¿™ä¸ªå±äºæ¯”è¾ƒè¿›é˜¶çš„å•ç‹¬è¯¾ç¨‹äº†

## ğŸ€ æ–‡ä»¶æ¯”å¯¹å·¥å…·

é€šå¸¸ä¼šåœ¨åŒä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¸åŒç‰ˆæœ¬ä¹‹é—´ï¼Œæ¯”è¾ƒé…ç½®æ–‡ä»¶ä¸åŸå§‹æ–‡ä»¶çš„å·®å¼‚çš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°æ–‡ä»¶å¯¹æ¯”ã€‚

å¾ˆå¤šæ—¶å€™æ‰€è°“çš„å¯¹æ¯”ï¼Œé€šå¸¸æ˜¯ç”¨åœ¨ ASCII çº¯æ–‡æœ¬çš„æ¯”å¯¹ã€‚å¸¸è§çš„æŒ‡ä»¤æœ‰ diffï¼Œè¿˜å¯ä»¥ä½¿ç”¨ cmp æ¥å¯¹æ¯”éçº¯æ–‡æœ¬ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ diff å»ºç«‹åˆ†ææ–‡æ¡£ï¼Œä»¥å¤„ç†è¡¥ä¸ patch åŠŸèƒ½çš„æ–‡ä»¶

### diff

diff ç”¨åœ¨æ¯”å¯¹ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´çš„å·®å¼‚ï¼Œä»¥è¡Œä¸ºå•ä½æ¥æ¯”å¯¹çš„ã€‚ä¸€èˆ¬æ˜¯ç”¨åœ¨ ASCII çº¯æ–‡æœ¬æ–‡ä»¶çš„æ¯”å¯¹ä¸Šã€‚

æ¯”å¦‚ï¼šå°† /etc/passwd åˆ é™¤ç¬¬ 4 è¡Œï¼Œç¬¬ 6 è¡Œåˆ™æ›¿æ¢ä¸ºã€Œno six lineã€ï¼Œæ–°æ–‡ä»¶æ”¾ç½®åˆ° /tmp/test é‡Œï¼Œè¯¥å¦‚ä½•åšï¼Ÿ

```bash
# åˆ›å»ºæµ‹è¯•ç›®å½•
[mrcode@study tmp]$ mkdir -p /tmp/testpw
[mrcode@study tmp]$ cd /tmp/testpw/
[mrcode@study testpw]$ cp /etc/passwd passwd.old 
# sed -e ç›´æ¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸Šä¿®æ”¹ï¼›d æ˜¯åˆ é™¤ï¼Œcæ˜¯æ›¿æ¢ï¼›å‰é¢ sed ä¸­æœ‰è®²åˆ°è¿‡çš„
# è¿™é‡ŒæŠŠä¿®æ”¹åçš„å†…å®¹å­˜åˆ°äº† passwd.new æ–‡ä»¶ä¸­
# sed ä¸­æœ‰è¶…è¿‡ä¸¤ä¸ªä»¥ä¸Šçš„åŠ¨ä½œæ—¶éœ€è¦åŠ  -e
[mrcode@study testpw]$ cat /etc/passwd | sed -e '4d' -e '6c no six line' > passwd.new

```

```bash
diff [-bBi] from-file to-file
é€‰é¡¹ä¸å‚æ•°ï¼š

from-fileï¼šæ–‡ä»¶åï¼ŒåŸå§‹å¯¹æ¯”æ–‡ä»¶
to-fileï¼šæ–‡ä»¶åï¼Œç›®çš„æ¯”è¾ƒæ–‡ä»¶
æ³¨æ„ï¼šä¸¤ä¸ªæ–‡ä»¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ - è¡¨ç¤ºï¼Œ- ä»£è¡¨ standard input

-bï¼šå¿½ç•¥ä¸€è¡Œå½“ä¸­ï¼Œä»…æœ‰å¤šä¸ªç©ºç™½çš„å·®å¼‚ï¼›ä¾‹å¦‚ï¼šâ€œabout meâ€œ ä¸ â€œabout         meâ€ è§†ä¸ºç›¸åŒ
-Bï¼šå¿½ç•¥ç©ºç™½è¡Œçš„å·®å¼‚
-iï¼šå¿½ç•¥å¤§å°å†™çš„ä¸åŒ
```

```bash
# èŒƒä¾‹ 1ï¼šæ¯”å¯¹ passwd.old passwd.new æ–‡ä»¶
[mrcode@study testpw]$ diff passwd.old passwd.new 
4d3						# å·¦è¾¹ç¬¬ 4 è¡Œè¢«åˆ é™¤(d)æ‰äº†ï¼ŒåŸºå‡†æ˜¯å³è¾¹ç¬¬ 3 è¡Œ
< adm:x:3:4:adm:/var/adm:/sbin/nologin				# åˆ—å‡ºäº†å·¦è¾¹è¢«åˆ é™¤çš„é‚£ä¸€è¡Œå†…å®¹
6c5						# å·¦è¾¹ç¬¬ 6 è¡Œï¼Œè¢«æ›¿æ¢ï¼ˆcï¼‰æˆå³è¾¹æ–‡ä»¶çš„ç¬¬ 5 è¡Œ
< sync:x:5:0:sync:/sbin:/bin/sync			# å·¦è¾¹æ–‡ä»¶ç¬¬ 6 è¡Œå†…å®¹
---	
> no six line								# å³è¾¹æ–‡ä»¶ç¬¬ 5 è¡Œå†…å®¹
# æ³¨æ„è¿™é‡Œçš„ï¼Œå·¦è¾¹ç¬¬ 4 è¡Œè¢«åˆ é™¤æ„æ€æ˜¯ï¼šå·¦è¾¹æ–‡ä»¶æ˜¯å®Œæ•´çš„ï¼Œå³è¾¹æ˜¯ä¿®æ”¹ä¹‹åçš„ï¼Œå³è¾¹ä¸å·¦è¾¹å¯¹æ¯”ï¼ŒåŸæ¥çš„ç¬¬ 4 è¡Œè¢«åˆ é™¤äº†
```

å¦‚æœç”¨ diff å»å¯¹æ¯”ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„æ–‡ä»¶ï¼Œæ˜¯å¯¹æ¯”ä¸å‡ºæ¥ä»€ä¹ˆçš„ï¼›å¦å¤– diff è¿˜å¯ä»¥å¯¹æ¯”æ•´ä¸ªç›®å½•ä¸‹çš„å·®å¼‚

```bash
# èŒƒä¾‹ï¼šäº†è§£ä¸€ä¸‹ä¸åŒçš„å¼€æœºæ‰§è¡Œç­‰çº§ï¼ˆrunlevelï¼‰å†…å®¹æœ‰å•¥ä¸åŒï¼Ÿå‡è®¾ä½ å·²ç»çŸ¥é“æ‰§è¡Œç­‰çº§ 0 ä¸ 5çš„å¯åŠ¨è„šæœ¬åˆ†åˆ«æ”¾ç½®åˆ° /etc/rc0.d åŠ /etc/rc5.d åˆ™å¯ä»¥å¯¹æ¯”ä¸‹
[mrcode@study testpw]$ diff /etc/rc0.d/ /etc/rc5.d/
åªåœ¨ /etc/rc0.d/ å­˜åœ¨ï¼šK90network
åªåœ¨ /etc/rc5.d/ å­˜åœ¨ï¼šS10network
```

### cmp

cmp ä¸»è¦ä¹Ÿæ˜¯å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸»è¦åˆ©ç”¨å­—èŠ‚å•ä½å»å¯¹æ¯”

```bash
cmp [-l] file1 file2
-iï¼šå°†æ‰€æœ‰çš„ä¸åŒç‚¹çš„å­—èŠ‚å¤„éƒ½åˆ—å‡ºæ¥ã€‚å› ä¸º cmp é¢„è®¾ä»…ä¼šè¾“å‡ºç¬¬ä¸€ä¸ªå‘ç°çš„ä¸åŒç‚¹
```

```bash
# èŒƒä¾‹ 1ï¼šç”¨ cmp æ¯”è¾ƒ passwd.old ä¸ passwd.new
[mrcode@study testpw]$ cmp passwd.old passwd.new 
passwd.old passwd.new ä¸åŒï¼šç¬¬ 106 å­—èŠ‚ï¼Œç¬¬ 4 è¡Œ
```

### patch

patch ä¸ diff å¯é…åˆä½¿ç”¨ï¼Œdiff æ¯”è¾ƒå‡ºä¸åŒï¼Œè€Œ patch åˆ™å¯ä»¥å°†ã€Œæ—§æ–‡ä»¶å‡çº§ä¸ºæ–°çš„æ–‡ä»¶ã€ã€‚

1. å…ˆæ¯”è¾ƒæ–°æ—§ç‰ˆæœ¬çš„å·®å¼‚
2. å°†å·®å¼‚åˆ¶ä½œæˆè¡¥ä¸æ–‡ä»¶
3. å†ç”±è¡¥ä¸æ–‡ä»¶æ›´æ–°æ—§æ–‡ä»¶

```bash
# èŒƒä¾‹ 1ï¼šä»¥ /tmp/testpw å†…çš„ passwd.old ä¸ passwd.new åˆ¶ä½œè¡¥ä¸æ–‡ä»¶
[mrcode@study testpw]$ diff -Naur passwd.old passwd.new > passwd.patch
[mrcode@study testpw]$ cat passwd.patch 
--- passwd.old	2020-01-17 15:58:55.405462402 +0800			# æ–°æ—§æ–‡ä»¶çš„ä¿¡æ¯
+++ passwd.new	2020-01-17 16:01:03.115462402 +0800
@@ -1,9 +1,8 @@		# æ–°æ—§æ–‡ä»¶è¦ä¿®æ”¹æ•°æ®çš„ç•Œå®šèŒƒå›´ï¼Œæ—§æ–‡ä»¶åœ¨ 1-0 è¡Œï¼Œæ–°æ–‡ä»¶åœ¨ 1-8 è¡Œ
 root:x:0:0:root:/root:/bin/bash
 bin:x:1:1:bin:/bin:/sbin/nologin
 daemon:x:2:2:daemon:/sbin:/sbin/nologin
-adm:x:3:4:adm:/var/adm:/sbin/nologin			# å·¦ä¾§æ–‡ä»¶åˆ é™¤
 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
-sync:x:5:0:sync:/sbin:/bin/sync				# å·¦ä¾§æ–‡ä»¶åˆ é™¤
+no six line									# å³ä¾§æ–°åŠ å…¥
 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
 halt:x:7:0:halt:/sbin:/sbin/halt
 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
 
 # è¿™é‡Œæ€ä¹ˆç†è§£ï¼Ÿ å¯ä»¥ç†è§£ä¸º old æ–‡ä»¶æ˜¯åŸºå‡†æ–‡ä»¶
 # æ ¹æ®è¿™é‡Œçš„åŸºå‡†æ–‡ä»¶ï¼Œçœ‹åˆ° - å°±å‰ªæ‰ï¼Œçœ‹åˆ° + å°±å¢åŠ ï¼›æ‰§è¡Œå®Œæˆåï¼Œåˆ™ä¼šå¾—åˆ° new è¿™ä¸ªæ–‡ä»¶ï¼›
 # å¹¶ä¸”è¡¥ä¸ä¸­é™åˆ¶äº†è¡Œæ•°ã€‚
```

å°† passwd.old åŒæ­¥ä¸º passwd.new ç›¸åŒçš„å†…å®¹ï¼Œ

```bash
# ç”±äºç³»ç»Ÿæœªé¢„è£… patch è½¯ä»¶ï¼Œéœ€è¦å°†ä¹‹å‰çš„ iso é•œåƒæ–‡ä»¶æŒ‚è½½
# åœ¨è™šæ‹Ÿæœºä¸Šæ‰¾åˆ°é¡ºåºä¸º 0 çš„æ§åˆ¶å™¨ä½ç½®ï¼Œé€‰æ‹© iso æ–‡ä»¶ï¼Œè®¾å¤‡å°±èƒ½è¢« linux æ‰¾åˆ°äº†
[root@study ~]# mount /dev/sr0 /mnt/
mount: /dev/sr0 å†™ä¿æŠ¤ï¼Œå°†ä»¥åªè¯»æ–¹å¼æŒ‚è½½
[root@study ~]# rpm -ivh /mnt/Packages/patch-2.*
è­¦å‘Šï¼š/mnt/Packages/patch-2.7.1-11.el7.x86_64.rpm: å¤´V3 RSA/SHA256 Signature, å¯†é’¥ ID f4a80eb5: NOKEY
å‡†å¤‡ä¸­...                          ################################# [100%]
æ­£åœ¨å‡çº§/å®‰è£…...
   1:patch-2.7.1-11.el7               ################################# [100%]
[root@study ~]# umount /mnt/
[root@study ~]# exit
# é€è¿‡ä¸Šè¿°æ–¹å¼å®‰è£…æ‰€éœ€è½¯ä»¶
```

è¯­æ³•

```bash
patch -pN < patch_file  # æ›´æ–°
patch -R -pN < patch_file  # è¿˜åŸ

é€‰é¡¹ä¸å‚æ•°ï¼š
-pï¼šåé¢å¯ä»¥æ¥ å–æ¶ˆå‡ å±‚ç›®å½• çš„æ„æ€
-Rï¼šä»£è¡¨è¿˜åŸï¼Œå°†æ–°çš„æ–‡ä»¶è¿˜åŸæˆåŸæ¥çš„æ—§æ–‡ä»¶
```

```bash
# èŒƒä¾‹ 2ï¼šå°†åˆšåˆšåˆ¶ä½œå‡ºæ¥çš„ patch file ç”¨æ¥æ›´æ–°æ—§ç‰ˆæœ¬æ•°æ®
[mrcode@study testpw]$ patch -p0 < passwd.patch 
patching file passwd.old
[mrcode@study testpw]$ ll passwd.*
-rw-rw-r--. 1 mrcode mrcode 2266 1æœˆ  17 16:01 passwd.new
-rw-r--r--. 1 mrcode mrcode 2266 1æœˆ  17 16:50 passwd.old	# æ–‡ä»¶å¤§å°å’Œnewæ–‡ä»¶ä¸€æ ·äº†
-rw-rw-r--. 1 mrcode mrcode  480 1æœˆ  17 16:38 passwd.patch

# èŒƒä¾‹ 3ï¼šæ¢å¤æ—§æ–‡ä»¶å†…å®¹
[mrcode@study testpw]$ patch -R -p0 < passwd.patch 
patching file passwd.old
[mrcode@study testpw]$ ll passwd.*
-rw-rw-r--. 1 mrcode mrcode 2266 1æœˆ  17 16:01 passwd.new
-rw-r--r--. 1 mrcode mrcode 2323 1æœˆ  17 16:52 passwd.old
```

è¿™é‡Œä¸ºä»€ä¹ˆä¼šä½¿ç”¨ `-p0` ï¼Ÿå› ä¸ºä¸¤ä¸ªæ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå› æ­¤ä¸éœ€è¦å‡å»ç›®å½•ã€‚å¦‚æœæ˜¯æ•´ä½“ç›®å½•æ¯”å¯¹ï¼ˆdiff æ—§ç›®å½• æ–°ç›®å½•ï¼‰æ—¶ï¼Œå°±è¦ä¾æ®å»ºç«‹ patch æ–‡ä»¶æ‰€åœ¨ç›®å½•æ¥è¿›è¡Œç›®å½•åˆ å‡

æ›´è¯¦ç»†çš„ patch ç”¨æ³•åœ¨åç»­çš„ç¬¬äºŒåç« ã€ŒåŸå§‹ç ç¼–è¯‘ã€

### æ–‡ä»¶æ‰“å°å‡†å¤‡ï¼špr

åœ¨å›¾å½¢ç•Œé¢ä¸­çš„æ–‡å­—å¤„ç†è½¯ä»¶ï¼Œæ‰“å°æ—¶å¯ä»¥é€‰æ‹©æ¯ä¸€é¡µçš„æ ‡å¤´å’Œé¡µç ï¼Œåœ¨æ–‡å­—ç•Œé¢ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ pr æ¥å®ç°ï¼Œç”±äº pr å‚æ•°å®åœ¨å¤ªå¤šäº†ï¼Œè¿™é‡Œä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼æ¥å¤„ç†

```bash
# æ‰“å° /etc/man_db.conf
[mrcode@study testpw]$ pr /etc/man_db.conf 


2018-10-31 04:26                /etc/man_db.conf                 ç¬¬ 1 é¡µ


# 
#
# This file is used by the man-db package to configure the man and cat paths.
# It is also used to provide a manpath for those without one by examining
# their PATH environment variable. For details see the manpath(5) man page.
```

æœ€ä¸Šé¢çš„ä¸€è¡Œå°±æ˜¯ pr å¤„ç†ä¹‹åçš„æ•ˆæœã€‚ä¾æ¬¡æ˜¯ï¼šæ–‡ä»¶æ—¶é—´ã€æ–‡ä»¶åã€é¡µç 

