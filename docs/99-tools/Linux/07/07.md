---
title: é‡ç‚¹å›é¡¾
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# 

- ä¸€ä¸ªå¯ä»¥è¢«æŒ‚è½½çš„æ•°æ®é€šå¸¸ç§°ä¸ºã€Œæ–‡ä»¶ç³»ç»Ÿ filesystemã€è€Œä¸æ˜¯åˆ†åŒºæ§½ï¼ˆpartitionï¼‰
- åŸºæœ¬ä¸Š Linux çš„ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä½ Ext2ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿå†…çš„ä¿¡æ¯ä¸»è¦æœ‰ï¼š
  - superblockï¼šè®°å½•æ­¤ filesystem çš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ inodeã€block çš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯
  - inodeï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ï¼Œä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ª inodeï¼ŒåŒæ—¶è®°å½•æ­¤æ–‡ä»¶çš„æ•°æ®æ‰€åœ¨çš„ block å·ç 
  - blockï¼šå®é™…è®°å½•æ–‡ä»¶çš„å†…å®¹ï¼Œè‹¥æ–‡ä»¶å¤ªå¤§æ—¶ï¼Œä¼šå ç”¨å¤šä¸ª block
- Ext2 æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®å­˜å–ä¸ºç´¢å¼•å¼æ–‡ä»¶ç³»ç»Ÿï¼ˆindexed allocationï¼‰
- éœ€è¦ç¢ç‰‡æ•´ç†çš„åŸå› å°±æ˜¯æ–‡ä»¶å†™å…¥çš„ block å¤ªè¿‡äºç¦»æ•£äº†ï¼Œæ­¤æ—¶æ–‡ä»¶è¯»å–çš„æ•ˆèƒ½å˜å¾—å¾ˆå·®ã€‚å¯ä»¥é€šè¿‡ç¢ç‰‡æ•´ç†å°†åŒä¸€ä¸ªæ–‡ä»¶æ‰€å±çš„ blocks æ•´ç†åœ¨ä¸€èµ·
- Ext æ–‡ä»¶ç³»ç»Ÿä¸»è¦æœ‰ï¼šboot sectorã€superblockã€inode bitmapã€inode tableã€data block ç­‰ 6 å¤§éƒ¨åˆ†
- data block æ˜¯ç”¨æ¥æ”¾ç½®æ–‡ä»¶å†…å®¹æ•°æ®çš„åœ°æ–¹ï¼Œåœ¨ ext2 æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æ”¯æŒçš„ block å¤§å°æœ‰ 1kã€2kã€4k ä¸‰ç§
- inode è®°å½•æ–‡ä»¶çš„å±æ€§ã€æƒé™ç­‰æ•°æ®ï¼Œå…¶ä»–é‡è¦é¡¹ç›®ä¸ºï¼šæ¯ä¸ª inode å¤§å°å‡ä¸ºå›ºå®šï¼Œæœ‰ 128ã€256bytes ä¸¤ç§åŸºæœ¬å®¹é‡ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½ä»…ä¼šå ç”¨ä¸€ä¸ª inodeã€‚å› æ­¤æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿå»ºç«‹çš„æ–‡ä»¶æ•°é‡ä¸ inode çš„æ•°é‡æœ‰å…³
- æ–‡ä»¶çš„ block åœ¨è®°å½•æ–‡ä»¶çš„å®é™…æ•°æ®ï¼Œç›®å½•çš„ block åˆ™åœ¨è®°å½•è¯¥ç›®å½•ä¸‹æ–‡ä»¶åä¸å…¶ inode å·ç çš„å¯¹ç…§è¡¨
- æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼ˆjournalï¼‰ä¼šå¤šå‡ºä¸€å—è®°å½•åŒºï¼Œéšæ—¶è®°è½½æ–‡ä»¶ç³»ç»Ÿçš„ä¸»è¦æ´»åŠ¨ï¼Œå¯åŠ å¿«ç³»ç»Ÿå¤åŸæ—¶é—´
- Linux æ–‡ä»¶ç³»ç»Ÿä½å¢åŠ æ•ˆèƒ½ï¼Œä¼šè®©ä¸»å­˜å‚¨å™¨ä½œä¸ºå¤§é‡çš„ç£ç›˜å‘Šè¯‰ç¼“å­˜
- å®ä½“é“¾æ¥åªæ˜¯å¤šäº†ä¸€ä¸ªæ–‡ä»¶åå¯¹è¯¥ inode å·ç çš„è¿æ¥
- ç¬¦å·é“¾æ¥å°±ç±»ä¼¼ windows çš„å¿«æ·æ–¹å¼åŠŸèƒ½
- ç£ç›˜çš„ä½¿ç”¨å¿…é¡»ç»è¿‡ï¼šåˆ†åŒºã€æ ¼å¼åŒ–ä¸æŒ‚è½½ï¼Œåˆ†åˆ«æƒ¯ç”¨çš„æŒ‡ä»¤ä¸ºï¼šgdiskã€mkfsã€mount ä¸‰ä¸ªæŒ‡ä»¤
- åˆ†åŒºæ—¶ï¼Œåº”ä½¿ç”¨ parted æ£€æŸ¥åˆ†åŒºè¡¨æ ¼å¼ï¼Œå†åˆ¤æ–­ä½¿ç”¨ fdisk æˆ– gdisk æ¥åˆ†åŒºï¼Œæˆ–ç›´æ¥ä½¿ç”¨ parted åˆ†åŒº
- ä¸ºäº†è€ƒè™‘æ•ˆèƒ½ï¼Œxfs æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–æ—¶ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸Š agcountã€suã€swã€extsize ç­‰å‚æ•°
- å¦‚æœç£ç›˜ä»¥æ— æœªåˆ†åŒºçš„å®¹é‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤§å‹æ–‡ä»¶å–ä»£ç£ç›˜è£…ç½®çš„å¤„ç†æ–¹å¼ï¼Œé€šè¿‡ dd ä¸æ ¼å¼åŒ–åŠŸèƒ½
- å¼€æœºè‡ªåŠ¨æŒ‚è½½å¯å‚è€ƒ /etc/fstab çš„è®¾ç½®ï¼Œè®¾ç½®å®ŒååŠ¡å¿…ä½¿ç”¨ mount -a æµ‹è¯•è¯­æ³•æ­£ç¡®æ€§



## ğŸ€ å¸è½½æŒ‚è½½çš„åˆ†åŒºç»ƒä¹ 

å°†æœ¬ç« æŒ‚è½½çš„å‡ ä¸ªæŒ‚è½½ç‚¹å…¨éƒ¨å¸è½½ã€‚å¹¶åˆ é™¤è¿™äº›åˆ†åŒºï¼Œå›å¤åˆ°åŸæœ¬åˆšå®‰è£…æ—¶çš„çŠ¶æ€ï¼›

- ç›®æ ‡ï¼šäº†è§£åˆ°åˆ é™¤åˆ†åŒºæ§½éœ€è¦æ³¨æ„çš„å„é¡¹ä¿¡æ¯
- å‰æï¼šæœ¬ç« å„é¡¹ç¤ºä¾‹éƒ½æœ‰åšè¿‡ï¼Œæ‰ä¼šæ‹¥æœ‰ /dev/sda4 ~ /dev/sda7 çš„åˆ†åŒºå‡ºç°
- éœ€æ±‚ï¼šç†Ÿæ‚‰ gdiskã€paratedã€umountã€sapoff ç­‰æŒ‡ä»¤

1. ä½¿ç”¨ freeã€swapon -sã€mount ç­‰æŒ‡ä»¤æŸ¥è¯¢è¦è¢«å¤„ç†çš„æ–‡ä»¶ç³»ç»Ÿä¸å¯ä»¥è¢«ä½¿ç”¨ï¼Œå¦‚æœæœ‰è¢«ä½¿ç”¨åˆ™å¿…é¡»ä½¿ç”¨ umount å¸è½½æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœæ˜¯ swapï¼Œåˆ™éœ€è¦ä½¿ç”¨ swapon -s æ‰¾å‡ºè¢«ä½¿ç”¨çš„åˆ†åŒºæ§½å†ç”¨ swapoff å¸è½½

   ```bash
   [root@study ~]# umount /data/ext4 /data/xfs /data/file /data/win
   umount: /data/ext4ï¼šæœªæŒ‚è½½
   [root@study ~]# swapoff /dev/sda6 /tmp/swap

   ```

2. è§‚å¯Ÿ /etc/fstab å°†ç›¸å…³çš„é…ç½®åˆ é™¤æˆ–æ³¨é‡Šæ‰

   ```bash
   nano /etc/fstab
   # å°†ç›¸å…³çš„éƒ½æ³¨é‡Šæ‰äº†
   # UUID="edfa7161-5847-4935-80e1-6e081be9ab77" /data/xfs xfs defaults 0 0
   # /srv/loopdev /data/file xfs defaults 0 0
   # UUID="89727d5b-a222-4878-be50-19bbb61cabb0" swap swap defaults 0 0
   # /tmp/swap swap swap defaults 0 0
   # UUID="72BE-0556" /data/win vfat defaults 0 0

   ```

3. ä½¿ç”¨ gdisk åˆ é™¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ parted æ¥åˆ é™¤

   ```bash
   [root@study ~]# parted /dev/sda rm 7
   ä¿¡æ¯: You may need to update /etc/fstab.

   [root@study ~]# parted /dev/sda rm 6
   ä¿¡æ¯: You may need to update /etc/fstab.

   [root@study ~]# parted /dev/sda rm 5
   ä¿¡æ¯: You may need to update /etc/fstab.

   [root@study ~]# parted /dev/sda rm 4
   ä¿¡æ¯: You may need to update /etc/fstab.
   # åˆ·æ–°åˆ†åŒºè¡¨
   [root@study ~]# partprobe                                                 

   # ç¡®è®¤ä¸‹ï¼Œç¡®å®åªå‰©ä¸‹ä¸‰ä¸ªäº†
   [root@study ~]# parted /dev/sda print
   Model: ATA VBOX HARDDISK (scsi)
   Disk /dev/sda: 43.8GB
   Sector size (logical/physical): 512B/512B
   Partition Table: gpt
   Disk Flags: pmbr_boot

   Number  Start   End     Size    File system  Name  æ ‡å¿—
    1      1049kB  3146kB  2097kB                     bios_grub
    2      3146kB  1077MB  1074MB  xfs
    3      1077MB  33.3GB  32.2GB                     lvm

   # å°†ç›¸å…³æ–‡ä»¶åˆ é™¤
   [root@study ~]# rm /tmp/swap /srv/loopdev
   rmï¼šæ˜¯å¦åˆ é™¤æ™®é€šæ–‡ä»¶ "/tmp/swap"ï¼Ÿy
   rmï¼šæ˜¯å¦åˆ é™¤æ™®é€šæ–‡ä»¶ "/srv/loopdev"ï¼Ÿy

   ```
