---
title: ç£ç›˜çš„åˆ†åŒºã€æ ¼å¼åŒ–ã€æ£€éªŒä¸æŒ‚è½½
sidebarDepth: 0 
category: Tools 
tag: Linux
---


å¯¹äºç³»ç»Ÿç®¡ç†è€…ï¼ˆrootï¼‰è€Œè¨€ï¼Œç£ç›˜ç®¡ç†æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå°¤å…¶æ˜¯è¿‘æ¥ç£ç›˜å·²ç»æ¸æ¸è¢«å½“æˆæ˜¯æ¶ˆè€—å“äº†ã€‚

æƒ³è¦åœ¨ç³»ç»Ÿé‡Œé¢æ–°å¢ä¸€é¢—ç£ç›˜æ—¶ï¼Œåº”è¯¥åšçš„æœ‰ï¼š

1. å¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºï¼Œå»ºç«‹å¯ç”¨çš„ partition
2. å¯¹è¯¥ partition è¿›è¡Œæ ¼å¼åŒ–ï¼ˆformatï¼‰ï¼Œå»ºç«‹ç³»ç»Ÿå¯ç”¨çš„ filesystem
3. å¯é€‰ï¼šå¯¹åˆšåˆšå»ºç«‹å¥½çš„ filesystem è¿›è¡Œæ£€æŸ¥
4. åœ¨ linux ç³»ç»Ÿä¸Šï¼Œå»ºç«‹æŒ‚è½½ç‚¹ï¼ˆç›®å½•ï¼‰ï¼Œå¹¶å°†å®ƒæŒ‚è½½ä¸Šæ¥

å½“ç„¶åœ¨ä¸Šè¿°æ­¥éª¤ä¸­æœ‰å¾ˆå¤šç»†è‡´çš„éœ€è¦è€ƒè™‘ï¼Œæ¯”å¦‚ç£ç›˜åˆ†åŒºæ§½ï¼ˆpartitionï¼‰éœ€è¦å¤šå¤§ï¼Ÿæ˜¯å¦éœ€è¦åŠ å…¥ jounal çš„åŠŸèƒ½ï¼Ÿinode ä¸ block çš„æ•°é‡åº”è¯¥å¦‚ä½•åˆ’åˆ†ç­‰ã€‚

ä½†æ˜¯è¿™äº›é—®é¢˜çš„å†³å®šï¼Œéƒ½éœ€è¦ä¸ä½ çš„ä¸»æœºç”¨é€”æ¥è€ƒè™‘çš„ï¼Œå› æ­¤åœ¨æœ¬èŠ‚ï¼Œè®²è§£å‡ ä¸ªå…¥é—¨æ“ä½œï¼Œå…¶ä»–çš„è‡ªå·±å»å®æˆ˜äº†è§£

## ğŸ€  è§‚å¯Ÿç£ç›˜åˆ†åŒºçŠ¶æ€

ç£ç›˜åˆ†åŒºä¸»è¦æœ‰ MBR å’Œ GPT ä¸¤ç§æ ¼å¼ï¼Œæ”¯æŒçš„å·¥å…·ä¸ä¸€æ ·ï¼ˆåç»­è®²è§£çš„ parted éƒ½æ”¯æŒï¼‰ï¼Œ
ä¹ æƒ¯ä½¿ç”¨çš„æ˜¯ fdisk ã€gdisk æ¥å¤„ç†åˆ†åŒºã€‚

###  lsblk åˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰ç£ç›˜åˆ—è¡¨

```bash
lsblk [-dfipt] [device]
```

- dï¼šä»…åˆ—å‡ºç£ç›˜æœ¬èº«ï¼Œå¹¶ä¸ä¼šåˆ—å‡ºè¯¥ç£ç›˜çš„åˆ†åŒºæ•°æ®
- fï¼šåŒæ—¶åˆ—å‡ºè¯¥ç£ç›˜å†…çš„æ–‡ä»¶ç³»ç»Ÿåç§°
- iï¼šä½¿ç”¨ ASCII çš„çº¿æ®µè¾“å‡ºï¼Œä¸è¦ä½¿ç”¨å¤æ‚çš„ç¼–ç ï¼ˆåœ¨æŸäº›ç¯å¢ƒä¸‹å¾ˆæœ‰ç”¨ï¼‰
- mï¼šåŒæ—¶è¾“å‡ºè¯¥è£…ç½®åœ¨ /dev ä¸‹çš„æƒé™æ•°æ®ï¼ˆrwxï¼‰
- pï¼šåˆ—å‡ºè¯¥è£…ç½®çš„å®Œæ•´æ–‡ä»¶åï¼Œè€Œä¸æ˜¯ä»…åˆ—å‡ºæœ€åçš„åå­—
- tï¼šåˆ—å‡ºè¯¥ç£ç›˜è£…ç½®çš„è¯¦ç»†æ•°æ®ï¼ŒåŒ…æ‹¬ç£ç›˜é˜Ÿåˆ—æœºåˆ¶ã€é¢„è¯»å†™çš„æ•°æ®é‡å¤§å°ç­‰

å®è·µç»ƒä¹ 

åˆ—å‡ºæœ¬ç³»ç»Ÿä¸‹çš„æ‰€æœ‰ç£ç›˜ä¸ç£ç›˜å†…çš„åˆ†åŒºä¿¡æ¯

```bash
[mrcode@study ~]$ lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0 40.8G  0 disk 				# è¿™æ˜¯ä¸€æ•´é¢—ç£ç›˜
â”œâ”€sda1            8:1    0    2M  0 part
â”œâ”€sda2            8:2    0    1G  0 part /boot
â””â”€sda3            8:3    0   30G  0 part 				# åœ¨ sda3 å†…çš„å…¶ä»–çš„æ–‡ä»¶ç³»ç»Ÿ
  â”œâ”€centos-root 253:0    0   10G  0 lvm  /
  â”œâ”€centos-swap 253:1    0    1G  0 lvm  [SWAP]
  â””â”€centos-home 253:2    0    5G  0 lvm  /home
sdb               8:16   0    2G  0 disk
sr0              11:0    1 73.6M  0 rom
```

ä»è¾“å‡ºæ¥çœ‹ï¼Œä¸»è¦æœ‰ sda ã€sdbã€sr0 è£…ç½®ï¼Œè€Œ sda ä¸‹é¢åˆåˆ†äº† 3 ä¸ªåˆ†åŒºï¼Œå…¶ä¸­ sda3 è¿˜æœ‰ LVM äº§ç”Ÿçš„æ–‡ä»¶ç³»ç»Ÿ

- NAMEï¼šè£…ç½®æ–‡ä»¶åï¼Œä¼šçœç•¥ /dev ç­‰å‰å¯¼ç›®å½•
- MAJ:MINï¼šå…¶å®æ ¸å¿ƒè®¤è¯†çš„è£…ç½®éƒ½æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªä»£ç æ¥ç†Ÿæ‚‰çš„ï¼Œåˆ†åˆ«æ˜¯ï¼š`ä¸»è¦:æ¬¡è¦` è£…ç½®
- RMï¼šæ˜¯å¦ä¸ºé¢—æ‹†å¸è£…ç½®ï¼ˆremovable deviceï¼‰ã€‚å¦‚å…‰ç›˜ã€USB ç£ç›˜ç­‰
- SIZEï¼šå®¹é‡
- ROï¼šæ˜¯å¦ä¸ºåªè¯»
- TYPEï¼šç£ç›˜ diskã€åˆ†åŒºæ§½ partitionã€åªè¯»å­˜å‚¨å™¨ rom
- MOUTPOINTï¼šæŒ‚è½½ç‚¹

åˆ—å‡º /dev/sda (å‰é¢å·²ç»è¯´è¿‡äº†ï¼Œä½¿ç”¨è™šæ‹Ÿæœºä¸åŒï¼Œç£ç›˜é‡Œé¢æ²¡æœ‰ vda çš„ï¼Œæˆ‘çš„æ˜¯ sda å“¦) è£…ç½®å†…çš„æ‰€æœ‰æ•°æ®çš„å®Œæ•´æ–‡ä»¶å

```bash
[root@study ~]# lsblk -ip /dev/sda
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      8:0    0 40.8G  0 disk
|-/dev/sda1                   8:1    0    2M  0 part
|-/dev/sda2                   8:2    0    1G  0 part /boot
`-/dev/sda3                   8:3    0   30G  0 part
  |-/dev/mapper/centos-root 253:0    0   10G  0 lvm  /
  |-/dev/mapper/centos-swap 253:1    0    1G  0 lvm  [SWAP]
  `-/dev/mapper/centos-home 253:2    0    5G  0 lvm  /home
```

### åˆ—å‡ºè£…ç½®çš„ UUID ç­‰å‚æ•°

ä½¿ç”¨ `lsblk -f` å¯ä»¥åˆ—å‡ºæ¥ UUID çš„æ•°æ®ï¼Œä¸è¿‡ä¹ æƒ¯ä½¿ç”¨ blkid æ¥æ‰¾å‡ºè£…ç½®çš„ UUIDï¼Œå¯ä»¥ç”¨æ¥ä½œä¸ºæŒ‚è½½æˆ–åˆ™æ˜¯ä½¿ç”¨è¿™ä¸ªè£…ç½®/æ–‡ä»¶ç³»ç»Ÿç”¨

```bash
[root@study ~]# lsblk -f
NAME            FSTYPE    LABEL           UUID                                   MOUNTPOINT
sda                                                                              
â”œâ”€sda1                                                                           
â”œâ”€sda2          xfs                       13d0663f-4cbd-412d-aa9f-975eb18da590   /boot
â””â”€sda3          LVM2_memb                 cksKYp-dPYj-CCPQ-Qxpq-m6rE-bhcL-84NkM3
  â”œâ”€centos-root xfs                       7b220a88-4e13-4869-9aa9-87031303f3e1   /
  â”œâ”€centos-swap swap                      0576b616-9606-434b-91c6-b99cbba5597d   [SWAP]
  â””â”€centos-home xfs                       d475b892-bcde-4c97-99da-497f3ff7163c   /home
sdb                                                                              
sr0             iso9660   VBox_GAs_6.0.10 2019-07-12-09-13-14-35   

# æ˜¾ç¤ºæ ¼å¼ä¸ä¸€æ ·ï¼Œè¿˜å¤šäº†åˆ†åŒºçš„ UUIDï¼Œæ„Ÿè§‰ä¸Šé¢çš„å°‘äº†ä¸€ä¸ª dsa1 çš„å‘¢ï¼Ÿ
[root@study ~]# blkid
/dev/sda1: PARTUUID="bf674a46-65e1-43b1-a348-ac2c06c25293"
/dev/sda2: UUID="13d0663f-4cbd-412d-aa9f-975eb18da590" TYPE="xfs" PARTUUID="783703d8-96cb-48fa-bfdb-853e7a0b1581"
/dev/sda3: UUID="cksKYp-dPYj-CCPQ-Qxpq-m6rE-bhcL-84NkM3" TYPE="LVM2_member" PARTUUID="cb3c0557-b7a5-493c-bab0-250a62a11099"
/dev/sr0: UUID="2019-07-12-09-13-14-35" LABEL="VBox_GAs_6.0.10" TYPE="iso9660"
/dev/mapper/centos-root: UUID="7b220a88-4e13-4869-9aa9-87031303f3e1" TYPE="xfs"
/dev/mapper/centos-swap: UUID="0576b616-9606-434b-91c6-b99cbba5597d" TYPE="swap"
/dev/mapper/centos-home: UUID="d475b892-bcde-4c97-99da-497f3ff7163c" TYPE="xfs"
```

### parted åˆ—å‡ºç£ç›˜çš„åˆ†åŒºè¡¨ç±»å‹ä¸åˆ†åŒºä¿¡æ¯

```bash
# è¯­æ³•ï¼šparted device_name print
[root@study ~]# parted /dev/sda print
Model: ATA VBOX HARDDISK (scsi)										# ç£ç›˜æ¨¡å—åç§°ï¼ˆå‚å•†ï¼‰
Disk /dev/sda: 43.8GB															# ç£ç›˜çš„æ€»å®¹é‡
Sector size (logical/physical): 512B/512B					# ç£ç›˜çš„æ¯ä¸ªé€»è¾‘/ç‰©ç†æ‰‡åŒºå®¹é‡
Partition Table: gpt						# åˆ†åŒºæ ¼å¼
Disk Flags: pmbr_boot

# ä¸‹é¢æ˜¯åˆ†åŒºä¿¡æ¯
Number  Start   End     Size    File system  Name  æ ‡å¿—
 1      1049kB  3146kB  2097kB                     bios_grub
 2      3146kB  1077MB  1074MB  xfs
 3      1077MB  33.3GB  32.2GB                     lvm

```

## ğŸ€ ç£ç›˜åˆ†åŒºï¼šgdiskã€fdisk

- MBRï¼šä½¿ç”¨ fdisk åˆ†åŒº
- GPTï¼šä½¿ç”¨ gdisk åˆ†åŒº

ä¸¤ä¸ªå·¥å…·ä½¿ç”¨ç›¸ä¼¼ï¼Œé€šè¿‡å†…éƒ¨çš„è¯´æ˜æ¥æ“ä½œï¼Œä¸éœ€è¦æ­»è®°ç¡¬èƒŒã€‚åˆšåˆšé€šè¿‡ parted æŒ‡ä»¤è¾“å‡ºçš„ç»“æœå¾—çŸ¥ sda è¿™ä¸ªç£ç›˜æ˜¯ GPT åˆ†åŒºï¼Œæ‰€ä»¥ä¸‹é¢çš„ä½¿ç”¨ gdisk æ¥æ“ä½œ

### gdisk

è¯­æ³•å¾ˆç®€å•

```bash
gdisk è£…ç½®åç§°
```

ä¾‹ï¼šè§‚å¯Ÿ /dev/sda ç£ç›˜çš„åˆ†åŒºä¸ç›¸å…³æ•°æ®

```bash
[root@study ~]# gdisk /dev/sda
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present
# æ‰¾åˆ°äº† GPT çš„åˆ†åŒºè¡¨
Found valid GPT with protective MBR; using GPT.

Command (? for help): ?  # ç­‰å¾…ä½ è¾“å…¥æŒ‡ä»¤ï¼Œå¯ä»¥è¾“å…¥é—®å·æ˜¾ç¤ºè¯´æ˜
b       back up GPT data to a file
c       change a partition's name
d       delete a partition		# åˆ é™¤åˆ†åŒº
i       show detailed information on a partition
l       list known partition types
n       add a new partition		# å¢åŠ åˆ†åŒº
o       create a new empty GUID partition table (GPT)
p       print the partition table # æ‰“å°åˆ†åŒºè¡¨ï¼ˆå¸¸ç”¨ï¼‰
q       quit without saving changes # ä¸å­˜å‚¨åˆ†åŒºå°±ç›´æ¥ç¦»å¼€ gdisk
r       recovery and transformation options (experts only)
s       sort partitions
t       change a partition's type code
v       verify disk
w       write table to disk and exit	# å­˜å‚¨åˆ†åŒºæ“ä½œåç¦»å¼€ gdisk
x       extra functionality (experts only)
?       print this menu

```

å†æ¥å›é¡¾ä¸‹æ­¥éª¤ï¼š

1. ä½¿ç”¨ lsblk æˆ– blkid æ‰¾åˆ°ç£ç›˜
2. ä½¿ç”¨ parted /dev/xxx print æ¥æ‰¾å‡ºå†…éƒ¨çš„åˆ†è¡¨è¡¨ç±»å‹
3. ä½¿ç”¨ gdisk æˆ– fdisk æ¥æ“ä½œ

é€šè¿‡ä¸Šé¢çš„å¸®åŠ©ï¼Œæœ‰ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼šæŒ‡ä»¤ q å’Œ wï¼Œåœ¨ gdisk é‡Œé¢æ‰§è¡Œçš„æ“ä½œï¼Œ**åªæœ‰ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡ä»¤åæ‰ä¼šç”Ÿæ•ˆ**ï¼Œ
ä½¿ç”¨ q é€€å‡ºä¸ç”Ÿæ•ˆï¼Œä½¿ç”¨ w ç”Ÿæ•ˆå¹¶ç¦»å¼€ã€‚

```bash
Command (? for help): p		# è¾“å‡ºç›®å‰ç£ç›˜çš„çŠ¶æ€
Disk /dev/sda: 85491712 sectors, 40.8 GiB				# ç£ç›˜æ–‡ä»¶åã€æ‰‡åŒºæ•°é‡ã€æ€»å®¹é‡
Logical sector size: 512 bytes									# å•ä¸€æ‰‡åŒºå¤§å°ä¸º 512 bytes
Disk identifier (GUID): 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D	# ç£ç›˜çš„ GPTæ ‡è¯†ç¬¦
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 85491678
Partitions will be aligned on 2048-sector boundaries
Total free space is 20467645 sectors (9.8 GiB)

# ä¸‹é¢æ˜¯åˆ†åŒºä¿¡æ¯
# åˆ†åŒºç¼–å· å¼€å§‹æ‰‡åŒºå·ç 			 ç»“æŸæ‰‡åŒºå·ç     å®¹é‡å¤§å°
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00
# è¿™é‡Œçš„ Code linux ä¸º 8300ï¼Œswap ä¸º 8200ï¼Œä¸è¿‡åªæ˜¯ä¸€ä¸ªæç¤ºï¼Œä¸è§å¾—çœŸçš„ä»£è¡¨æ­¤åˆ†åŒºæ§½å†…çš„æ–‡ä»¶ç³»ç»Ÿ
```

ä»ä¸Šè¡¨å¯ä»¥å‘ç°å‡ ä»¶äº‹æƒ…ï¼š

- æ•´é¢—ç£ç›˜è¿˜å¯ä»¥è¿›è¡Œé¢å¤–çš„åˆ†åŒº

  æœ€å¤§æ‰‡åŒºä¸º 85491712 ä¸ªï¼Œä¸‹é¢ä¸‰ä¸ªåˆ†åŒºè¡¨ï¼ˆç¬¬ä¸‰ä¸ªï¼‰ç»“æŸæ‰‡åŒºä¸º 65026047ï¼Œ
  åœ¨ä¸Šé¢ä¿¡æ¯ä¸­ä¹Ÿæç¤ºäº†ç©ºé—²çš„æ‰‡åŒº `20467645 sectors (9.8 GiB)`

- åˆ†åŒºæ§½çš„è®¾è®¡ä¸­ï¼Œæ–°åˆ†åŒºé€šå¸¸é€‰ç”¨ä¸Šä¸€ä¸ªåˆ†åŒºçš„ç»“æŸæ‰‡åŒºå·ç æ•°åŠ  1 ä½œä¸ºèµ·å§‹æ‰‡åŒºå·ç 

::: warning
æ³¨æ„ä¸è¦åœ¨ MBR åˆ†åŒºä¸Šä½¿ç”¨ gdiskï¼Œå¦‚æœæŒ‡ä»¤æŒ‰é”™ï¼Œææ€•åˆ†åŒºè®°å½•ä¼šæŒ‚æ‰ï¼Œ
å¦å¤–åœ¨ gdisk ä¸­æ“ä½œï¼Œç¦»å¼€çš„æ—¶å€™è®°å¾—æŒ‰ q ï¼Œä¸è¦æŒ‰ w å°±ä¸ä¼šç”Ÿæ•ˆ
:::

### ç”¨ gdisk æ–°å¢åˆ†åŒºæ§½

æœ€å¼€å§‹å®‰è£…çš„æ—¶å€™å°±é¢„ç•™äº†ä¸€å—å®¹é‡æ¥åšç»ƒä¹ ï¼Œåœ¨ä¸Šé¢ä¹Ÿçœ‹åˆ°äº†è¿˜å‰©ä½™ 9.8 G çš„ç©ºä½™å®¹é‡ï¼Œå‡è®¾æœ‰å¦‚ä¸‹çš„åˆ†åŒºéœ€æ±‚ï¼š

- 1 GB çš„ xfs æ–‡ä»¶ç³»ç»Ÿï¼ˆlinuxï¼‰
- 1 GB çš„ vfat æ–‡ä»¶ç³»ç»Ÿï¼ˆwindowsï¼‰
- 0.5 GB çš„ swap ï¼ˆlinux swapï¼‰

```bash
[root@study ~]# gdisk /dev/sda
Command (? for help): p
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00
# æ‰“å°åˆ†åŒºä¿¡æ¯ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°æœ€åä¸€ä¸ª sector çš„å·ç ï¼Œè¿™é‡Œæ˜¯ 65026047
# ä½¿ç”¨æŒ‡ä»¤ n å¢åŠ ç‰©ç†åˆ†åŒº
Command (? for help): n
Partition number (4-128, default 4): 4  # åˆ†åŒºå·ç ï¼Œè¿™é‡Œé»˜è®¤å°±æ˜¯ 4ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŒ‰å›è½¦
First sector (34-85491678, default = 65026048) or {+-}size{KMGTP}: # ç¬¬ä¸€ä¸ªæ‰‡åŒºå·ç ï¼ŒåŒæ ·æœ‰é»˜è®¤çš„
Last sector (65026048-85491678, default = 85491678) or {+-}size{KMGTP}: +1G  # ç»“æŸæ‰‡åŒºå·ç 
# ä¸Šé¢æœ‰é»˜è®¤çš„å€¼ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±è®¡ç®—æ‰‡åŒºæ•°é‡ï¼Œä½¿ç”¨ +- KMGTP ç­‰å•ä½å®¹é‡æ–¹å¼æ¥å®¹é‡

# é€‰æ‹©æœªæ¥è¯¥åˆ†åŒºæ§½é¢„è®¡ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé¢„è®¾çš„éƒ½æ˜¯ linux æ–‡ä»¶ç³»ç»Ÿçš„ 8300
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300):
Changed type of partition to 'Linux filesystem'

# å†æ¬¡æ‰“å°ï¼Œå°±å‘ç°å¤šäº†åˆšåˆšåˆ†å‡ºæ¥çš„åˆ†åŒºä¿¡æ¯
Command (? for help): p
Disk /dev/sda: 85491712 sectors, 40.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 85491678
Partitions will be aligned on 2048-sector boundaries
Total free space is 18370493 sectors (8.8 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00  
   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem

é‚£ä¹ˆåé¢ä¸¤ä¸ªåŒºçš„åˆ†åŒºç»§ç»­ï¼Œè®°å¾—æ¯æ¬¡åˆ†åŒºå®Œå°±æ‰“å°ä¸‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹æ˜¯å¦æ­£ç¡®

Command (? for help): n
Partition number (5-128, default 5):
First sector (34-85491678, default = 67123200) or {+-}size{KMGTP}:
Last sector (67123200-85491678, default = 85491678) or {+-}size{KMGTP}: +1G
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 0700  # 0700 ä¸º windows æ–‡ä»¶ç³»ç»Ÿ
Changed type of partition to 'Microsoft basic data'

Command (? for help): n
Partition number (6-128, default 6):
First sector (34-85491678, default = 69220352) or {+-}size{KMGTP}:
Last sector (69220352-85491678, default = 85491678) or {+-}size{KMGTP}: +500M
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 8200  # linux swap
Changed type of partition to 'Linux swap'

# æœ€ååˆ†åŒºå®Œæˆåçš„åˆ†åŒºä¿¡æ¯å¦‚ä¸‹
Command (? for help): n
...
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00  
   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem
   5        67123200        69220351   1024.0 MiB  0700  Microsoft basic data
   6        69220352        70244351   500.0 MiB   8200  Linux swap

# åˆ†åŒºçš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ° codeï¼Œä¸Šé¢æœ‰å¯¹åº”çš„ code æ•°å€¼äº†
# å¦‚æœå¿˜è®°æˆ–åˆ™ä¸çŸ¥é“ï¼Œå¯ä»¥ä½¿ç”¨ l å‘½ä»¤æ¥æ˜¾ç¤ºæ‰€æœ‰çš„ code å€¼
Command (? for help): l
0700 Microsoft basic data  0c01 Microsoft reserved    2700 Windows RE          
3000 ONIE boot             3001 ONIE config           4100 PowerPC PReP boot  
...

# æœ€åä½¿ç”¨ w å‘½ä»¤å†™å…¥ç£ç›˜åˆ†åŒºè¡¨
Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sda.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot.
The operation has completed successfully.

# ç­‰ä½ è¾“å…¥ y ç¡®è®¤ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œï¼Œä¸Šé¢çš„è­¦å‘Šä¿¡æ¯ç¿»è¯‘å¦‚ä¸‹
è­¦å‘Šï¼šå†…æ ¸ä»åœ¨ä½¿ç”¨æ—§çš„åˆ†åŒºè¡¨ã€‚
æ–°è¡¨å°†åœ¨ä¸‹æ¬¡é‡æ–°å¯åŠ¨æ—¶ä½¿ç”¨ã€‚
æ“ä½œå·²æˆåŠŸå®Œæˆã€‚

# æŸ¥çœ‹ä¿¡æ¯ï¼Œå‘ç°åˆ†åŒºä¸­è¿˜æ²¡æœ‰å‡ºç° sda4ã€5ã€6 ï¼Œè¿™æ˜¯å› ä¸ºæ ¸å¿ƒè¿˜æ²¡æœ‰æ›´æ–°
[root@study ~]# cat /proc/partitions
major minor  #blocks  name

   8        0   42745856 sda
   8        1       2048 sda1
   8        2    1048576 sda2
   8        3   31461376 sda3
   8       16    2097152 sdb
  11        0      75354 sr0
 253        0   10485760 dm-0
 253        1    1048576 dm-1
 253        2    5242880 dm-2
```

å¯¹äºè­¦å‘Šå†…æ ¸æœªç”Ÿæ•ˆï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥å¤„ç†ï¼Œç¬¬ä¸€ç§å°±æ˜¯é‡æ–°å¯åŠ¨ï¼Œå¦ä¸€ç§å°±æ˜¯é€šè¿‡ partprobe æŒ‡ä»¤æ¥å¤„ç†



### partprobe æ›´æ–° Linux æ ¸å¿ƒçš„åˆ†åŒºè¡¨ä¿¡æ¯

```bash
# -s è¾“å‡ºä¿¡æ¯ï¼Œä¸åŠ åˆ™ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯
[root@study ~]# partprobe -s
/dev/sda: gpt partitions 1 2 3 4 5 6
Warning: æ— æ³•ä»¥è¯»å†™æ–¹å¼æ‰“å¼€ /dev/sr0 (åªè¯»æ–‡ä»¶ç³»ç»Ÿ)ã€‚/dev/sr0 å·²æŒ‰ç…§åªè¯»æ–¹å¼æ‰“å¼€ã€‚

# æŸ¥çœ‹ç£ç›˜çŠ¶æ€ï¼Œå‘ç°å‡ºç°äº† 4ã€5ã€6 åˆ†åŒº
[root@study ~]# lsblk /dev/sda
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0 40.8G  0 disk 
â”œâ”€sda1            8:1    0    2M  0 part 
â”œâ”€sda2            8:2    0    1G  0 part /boot
â”œâ”€sda3            8:3    0   30G  0 part 
â”‚ â”œâ”€centos-root 253:0    0   10G  0 lvm  /
â”‚ â”œâ”€centos-swap 253:1    0    1G  0 lvm  [SWAP]
â”‚ â””â”€centos-home 253:2    0    5G  0 lvm  /home
â”œâ”€sda4            8:4    0    1G  0 part 
â”œâ”€sda5            8:5    0    1G  0 part 
â””â”€sda6            8:6    0  500M  0 part 

# æŸ¥çœ‹åˆ†åŒºè®°å½•ï¼Œä¹Ÿå‡ºç°äº† 4ã€5ã€6
[root@study ~]# cat /proc/partitions 
major minor  #blocks  name

   8        0   42745856 sda
   8        1       2048 sda1
   8        2    1048576 sda2
   8        3   31461376 sda3
   8        4    1048576 sda4
   8        5    1048576 sda5
   8        6     512000 sda6
   8       16    2097152 sdb
  11        0      75354 sr0
 253        0   10485760 dm-0
 253        1    1048576 dm-1
 253        2    5242880 dm-2

```

### ç”¨ gdisk åˆ é™¤ä¸€ä¸ªåˆ†åŒºæ§½

```bash
[root@study ~]# gdisk /dev/sda
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.

# æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
Command (? for help): p
Disk /dev/sda: 85491712 sectors, 40.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 85491678
Partitions will be aligned on 2048-sector boundaries
Total free space is 15249341 sectors (7.3 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00  
   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem
   5        67123200        69220351   1024.0 MiB  0700  Microsoft basic data
   6        69220352        70244351   500.0 MiB   8200  Linux swap

# åˆ é™¤ç¬¬ 6 ä¸ªåˆ†åŒº
Command (? for help): d
Partition number (1-6): 6

# å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç° 6 ä¸åœ¨äº†
Command (? for help): p
Disk /dev/sda: 85491712 sectors, 40.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 85491678
Partitions will be aligned on 2048-sector boundaries
Total free space is 16273341 sectors (7.8 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00  
   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem
   5        67123200        69220351   1024.0 MiB  0700  Microsoft basic data

# å†™å…¥å¹¶ç¦»å¼€
Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sda.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot.
The operation has completed successfully.

# æŸ¥çœ‹ç£ç›˜çŠ¶æ€ï¼Œå‘ç° sda6 è¿˜å­˜åœ¨ï¼Œåªæ˜¯å› ä¸ºæ²¡æœ‰æ›´æ–°æ ¸å¿ƒåˆ†åŒºè¡¨å¯¼è‡´çš„
# ä½¿ç”¨å‘½ä»¤ partprobe -s æ›´æ–°ä¸‹å†æŸ¥çœ‹å°±æ²¡æœ‰äº†
[root@study ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0 40.8G  0 disk 
â”œâ”€sda1            8:1    0    2M  0 part 
â”œâ”€sda2            8:2    0    1G  0 part /boot
â”œâ”€sda3            8:3    0   30G  0 part 
â”‚ â”œâ”€centos-root 253:0    0   10G  0 lvm  /
â”‚ â”œâ”€centos-swap 253:1    0    1G  0 lvm  [SWAP]
â”‚ â””â”€centos-home 253:2    0    5G  0 lvm  /home
â”œâ”€sda4            8:4    0    1G  0 part 
â”œâ”€sda5            8:5    0    1G  0 part 
â””â”€sda6            8:6    0  500M  0 part 
sdb               8:16   0    2G  0 disk 
sr0              11:0    1 73.6M  0 rom  

```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸è¦å»å¤„ç†ä¸€ä¸ª **æ­£åœ¨ä½¿ç”¨ä¸­çš„åˆ†åŒºæ§½** ã€‚ä¾‹å¦‚ï¼šç°åœ¨å·²ç»ä½¿ç”¨äº† /dev/sda5ï¼Œ
å¿…é¡»å…ˆå°† /dev/sda5 å…ˆ **å¸è½½** ï¼Œå¦åˆ™ç›´æ¥åˆ é™¤è¯¥åˆ†åŒºçš„è¯ï¼Œè™½ç„¶ç£ç›˜ä¼šå†™å…¥æ­£ç¡®çš„åˆ†åŒºä¿¡æ¯ï¼Œ
ä½†æ˜¯æ ¸å¿ƒä¼šæ— æ³•æ›´æ–°åˆ†åŒºè¡¨çš„ä¿¡æ¯ã€‚

æ€»ä¹‹ï¼šåƒä¸‡ä¸è¦å¤„ç†æ­£åœ¨æ´»åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå…ˆå¸è½½åå†å¤„ç†

### fdisk

è™½ç„¶ MBR åœ¨æœªæ¥å¯èƒ½ä¼šæ…¢æ…¢æ·˜æ±°ï¼Œä½†æ˜¯å¦‚æœæ°å·§ä½ é‡åˆ°äº†å‘¢ï¼Œä½¿ç”¨æ–¹å¼ä¸ gdisk ç±»ä¼¼ï¼Œä¸‹é¢åˆ—å‡ºæŒ‡ä»¤å¸®åŠ©æ–‡æ¡£

![image-20191027131011438](./assets/image-20191027131011438.png)

## ğŸ€  ç£ç›˜æ ¼å¼åŒ–ï¼ˆå»ºç«‹æ–‡ä»¶ç³»ç»Ÿï¼‰

åˆ†åŒºå®Œæˆä¹‹åéœ€è¦è¿›è¡Œæ ¼å¼åŒ–æ‰èƒ½ä½¿ç”¨ç£ç›˜ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡ä»¤ã€Œmake filesystemï¼Œmkfsã€ï¼Œè¯¥æŒ‡ä»¤æ˜¯ä¸€ä¸ªç»¼åˆæŒ‡ä»¤ï¼Œå›å»è°ƒç”¨æ­£ç¡®çš„ç³»ç»Ÿæ ¼å¼åŒ–å·¥å…·è½¯ä»¶ã€‚å› ä¸º CentOS 7 ä½¿ç”¨ xfs ä½œä¸ºé¢„è®¾æ–‡ä»¶ç³»ç»Ÿï¼Œä¸‹é¢å…ˆä»‹ç» mkfs.xfs ï¼Œå†ä»‹ç»æ–°ä¸€ä»£çš„ mkfs.ext4ï¼Œæœ€åå†èŠ mkfs è¿™ä¸ªç»¼åˆæŒ‡ä»¤

### XFS æ–‡ä»¶ç³»ç»Ÿ mkfs.xfs

å¸¸å¬åˆ°çš„æ ¼å¼åŒ–å…¶å®åº”è¯¥ç§°ä¸ºã€Œå»ºç«‹æ–‡ä»¶ç³»ç»Ÿï¼ˆmake filesystemï¼‰ã€ã€‚

```bash
mkfs.xfs [-b bsize][-d parms][-i parms][-l parms][-L parms][-f][-r parms] è®¾å¤‡åç§°
```

é€‰é¡¹ä¸å‚æ•°ï¼šä¸‹é¢æè¿°å…³äºå•ä½çš„è¯´æ˜ï¼Œæ²¡æœ‰åŠ å•ä½åˆ™ä¸º bytesï¼Œå¯ä»¥ç”¨ kã€mã€gã€tã€p ç­‰æ¥è§£é‡Šï¼Œç‰¹æ®Šçš„ä¸º s å•ä½ï¼ŒæŒ‡çš„æ˜¯ sector çš„ä¸ªæ•°

- bï¼šåé¢æ¥ block å®¹é‡ï¼Œå¯ç”± 512 åˆ° 64kï¼Œä¸è¿‡æœ€å¤§å®¹é‡é™åˆ¶ä¸º Linux çš„ 4k

- dï¼šåé¢æ¥ data section çš„ç›¸å…³å‚æ•°ï¼Œä¸»è¦çš„å€¼æœ‰ï¼š

  - agcount=æ•°å€¼ï¼šè®¾ç½®éœ€è¦å‡ ä¸ªå­˜å‚¨ç¾¤ç»„ï¼ˆAGï¼‰ï¼Œé€šå¸¸ä¸ CPU æœ‰å…³

  - agsize=æ•°å€¼ï¼šæ¯ä¸ª AG è®¾ç½®ä¸ºå¤šå°‘å®¹é‡ï¼Œé€šå¸¸ agcount/agsize åªé€‰ä¸€ä¸ªè®¾ç½®å³å¯

  - fileï¼šæ ¼å¼çš„çš„è£…ç½®æ˜¯ä¸ªæ–‡ä»¶è€Œä¸æ˜¯ä¸ªè£…ç½®ï¼ˆä¾‹å¦‚è™šæ‹Ÿç£ç›˜ï¼‰

  - size=æ•°å€¼ï¼šdata section çš„æ•°é‡ï¼Œä½ å¯ä¸å°†å…¨éƒ¨çš„å®¹é‡ç”¨å®Œçš„æ„æ€

  - su=æ•°å€¼ï¼šå½“æœ‰ RAID æ—¶ï¼Œå“ªä¸ª stripe æ•°å€¼ï¼Œä¸ä¸‹é¢çš„ sw æ­é…ä½¿ç”¨

  - sw=æ•°å€¼ï¼šå½“æœ‰ RAID æ—¶ï¼Œç”¨äºå­˜å‚¨çš„ç£ç›˜æ•°é‡ï¼ˆéœ€æ‰£é™¤å¤‡ä»½ç¢Ÿä¸å¤‡ç”¨ç¢Ÿï¼‰

  - sunit-æ•°å€¼ï¼šä¸ su ç±»å‹ï¼Œä¸è¿‡å•ä½ä½¿ç”¨çš„æ˜¯ã€Œå‡ ä¸ª sectorï¼ˆ512byteså¤§å°ï¼‰ã€

  - swidth=æ•°å€¼ï¼šsu*sw çš„å€¼ï¼Œä½†æ˜¯ä»¥ã€Œå‡ ä¸ª sector*ï¼ˆ512bytes å¤§å°ï¼‰ã€æ¥è®¾ç½®

- fï¼šå¦‚æœè£…ç½®å†…å·²ç»æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ™éœ€è¦ä½¿ç”¨è¯¥å‚æ•°æ¥å¼ºåˆ¶æ ¼å¼åŒ–

- iï¼šä¸ inode æœ‰è¾ƒç›¸å…³çš„è®¾ç½®ï¼Œä¸»è¦çš„è®¾ç½®å€¼æœ‰ï¼š

  - size=æ•°å€¼ï¼šæœ€å°æ˜¯ 256bytesï¼Œæœ€å¤§æ˜¯ 2kï¼Œä¸€èˆ¬ä¿ç•™ 256 è¶³å¤Ÿä½¿ç”¨äº†
  - internal=[0|1]ï¼šlog è£…ç½®æ˜¯å¦ä¸ºå†…å»ºï¼Ÿé¢„è®¾ä¸º 1 å†…å»ºï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¤–ç½®çš„ï¼Œé…ç½®ä¸‹é¢çš„å‚æ•°
  - logdev=deviceï¼šæŒ‡å®š log è£…ç½®åœ¨å“ªä¸ªè£…ç½®ä¸Š
  - size=æ•°å€¼ï¼šæŒ‡å®šè¿™å—ç™»å½•åŒºçš„å®¹é‡ï¼Œé€šå¸¸æœ€å°éœ€è¦  512 ä¸ª blockï¼Œå¤§çº¦ 2M ä»¥ä¸Š

- Lï¼šæŒ‡å®šè¯¥æ–‡ä»¶ç³»ç»Ÿçš„è¡¨å¤´åç§° Label name

- rï¼šæŒ‡å®š realtime section çš„ç›¸å…³è®¾ç½®ï¼Œå¸¸è§çš„æœ‰

  - extsize=æ•°å€¼ï¼šå°±æ˜¯é‚£ä¸ªé‡è¦çš„ extent æ•°å€¼ï¼Œä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ï¼Œæ‹…å¿§ RAID æ—¶ï¼Œæœ€å¥½è®¾ç½®ä¸ swidth ç›¸åŒçš„æ•°å€¼ï¼Œæœ€å°ä¸º 4k ï¼Œæœ€å¤§ä¸º 1G

å®è·µç»ƒä¹ 

```bash
# å°†å‰é¢åˆ†åŒºå‡ºæ¥çš„ /dev/sda4 æ ¼å¼åŒ–ä¸º xfs æ–‡ä»¶ç³»ç»Ÿ
[root@study ~]# mkfs.xfs /dev/sda4
meta-data=/dev/sda4              isize=512    agcount=4, agsize=65536 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=262144, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
# å¾ˆå¿«å°±æ ¼å¼åŒ–å®Œæˆäº†ï¼Œä¸åŠ ä»»ä½•å‚æ•°ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼ï¼Œè¾ƒé‡è¦çš„æ˜¯ inode ä¸ block çš„æ•°å€¼
# isize å°±æ˜¯ inodeçš„å¤§å°ï¼Œbsize å°±æ˜¯ block çš„å¤§å°

# æŸ¥çœ‹ä¿¡æ¯ï¼Œç¡®å®šä¸º xfs äº†
[root@study ~]# blkid /dev/sda4
/dev/sda4: UUID="4079b244-7ef8-47eb-85d0-1d634c8c703f" TYPE="xfs" PARTLABEL="Linux filesystem" PARTUUID="3819b115-2ab8-4fb6-8425-bb2ff8e797b7" 
```

ä¸€èˆ¬ä½¿ç”¨é»˜è®¤çš„ xfs æ–‡ä»¶ç³»ç»Ÿå‚æ•°æ¥æ ¼å¼åŒ–å³å¯ï¼Œå¦‚æœæœ‰å…¶ä»–é¢å¤–çš„å®šåˆ¶åˆ™éœ€è¦æ·»åŠ å¯¹åº”çš„å‚æ•°æ¥è®¾ç½®ã€‚æ¯”å¦‚ï¼šå› ä¸º xfs å¯ä»¥ä½¿ç”¨å¤šä¸ªæ•°æ®æµæ¥è¯»å†™ç³»ç»Ÿï¼Œå¢åŠ é€Ÿåº¦ï¼Œå› æ­¤å“ªä¸ª agcount å¯ä»¥è·Ÿ CPU çš„æ ¸å¿ƒæ•°é‡æ¥åšæ­é…ã€‚æ¯”å¦‚æœåŠ¡å™¨æœ‰ä¸€é¢— 4 æ ¸å¿ƒ 8 çº¿ç¨‹çš„ CPUï¼Œå…¶å®å°±ç›¸å½“äºæ˜¯ 8 æ ¸å¿ƒäº†ï¼Œå¯ä»¥è®¾ç½®ä¸º 8

```bash
# æ‰¾å‡ºç³»ç»Ÿçš„ CPU æ•°é‡ï¼Œå¹¶è®¾ç½® agcount æ•°é‡
[root@study ~]# grep 'processor' /proc/cpuinfo
processor       : 0
# è¿™é‡Œåªæœ‰ä¸€ä¸ª processorï¼Œåˆ™è¡¨ç¤ºåªæœ‰ä¸€é¢— CPU

# ä½¿ç”¨ -f ï¼ˆå‰é¢å·²ç»æ ¼å¼åŒ–æœ‰æ–‡ä»¶ç³»ç»Ÿäº†ï¼Œå¼ºåˆ¶ï¼‰-d æŒ‡å®š agcount æ•°å€¼
[root@study ~]# mkfs.xfs -f -d agcount=1 /dev/sda4
meta-data=/dev/sda4              isize=512    agcount=1, agsize=262144 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=262144, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
# ä¸è¿‡ï¼šç¬”è€…å‘ç°ï¼Œé»˜è®¤çš„ agcount=4 è€Œä¸æ˜¯æŒ‰ç…§ cpu æ•°é‡æ¥çš„

```

### XFS æ–‡ä»¶ç³»ç»Ÿ for RAID æ•ˆèƒ½ä¼˜åŒ–ï¼ˆOptionalï¼‰

åœ¨åç»­ä¼šè°ˆåˆ°ã€Œè¿›é˜¶æ–‡ä»¶ç³»ç»Ÿçš„è®¾ç½®ã€ï¼Œå…¶ä¸­å°±æœ‰ç£ç›˜é˜µåˆ—ï¼Œæ˜¯å¤šé¢—ç£ç›˜ç»„æˆä¸€é¢—å¤§ç£ç›˜çš„æ„æ€ï¼Œåˆ©ç”¨åŒæ­¥å†™å…¥åˆ°è¿™äº›ç£ç›˜çš„æŠ€æœ¯ï¼Œä¸ä½†å¯ä»¥åŠ å¿«è¯»å†™é€Ÿåº¦ï¼Œè¿˜å¯ä»¥è®©æŸä¸€é¢—ç£ç›˜åæ‰æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯å¼€æºæŒç»­è¿ä½œçš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å®¹é”™

åŸºæœ¬ä¸Šï¼Œç£ç›˜é˜µåˆ— RAID å°±æ˜¯é€šè¿‡å°†æ–‡ä»¶å…ˆç»†åˆ†ä¸ºæ•°ä¸ªå°å‹çš„åˆ†åŒºåŒºå—ï¼ˆstripeï¼‰åï¼Œå°†ä»–ä»¬åˆ†åˆ«æ”¾åˆ°ç£ç›˜é˜µåˆ—é‡Œé¢çš„æ‰€æœ‰ç£ç›˜ï¼Œæ‰€ä»¥ä¸€ä¸ªæ–‡ä»¶æ˜¯è¢«åŒæ—¶å†™å…¥åˆ°å¤šä¸ªç£ç›˜ä¸­å»çš„ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç£ç›˜é˜µåˆ—é«˜æ•ˆè¯»å–çš„åŸå› ä¹‹ä¸€ï¼‰ã€‚ä¸ºäº†æ–‡ä»¶æ•°æ®çš„å®‰å…¨ï¼Œåœ¨è¿™äº›ç£ç›˜ä¸­è¿˜ä¼šè§„åˆ’å¤„ä¸€éƒ¨åˆ†ä½œä¸ºå¤‡ä»½ç£ç›˜ï¼ˆparity diskï¼‰ï¼Œä»¥åŠå¯èƒ½ä¼šä¿ç•™ä¸€ä¸ªä»¥ä¸Šçš„å¤‡ç”¨ç£ç›˜ï¼ˆspare diskï¼‰ï¼Œè¿™äº›åŒºå—åŸºæœ¬ä¸Šä¼šå ç”¨æ‰ç£ç›˜é˜µåˆ—çš„æ€»å®¹é‡ï¼Œä½†æ˜¯å¯¹äºæ•°æ®æ¥è¯´æ¯”è¾ƒæœ‰ä¿éšœ

åˆ†åŒºåŒºå— stripe çš„æ•°å€¼å¤§å¤šä»‹äº 4k åˆ° 1m ä¹‹é—´ï¼Œè¿™ä¸ä½ çš„ç£ç›˜é˜µåˆ—å¡æ”¯æŒçš„é¡¹ç›®æœ‰å…³ã€‚stripe ä¸ä½ çš„æ–‡ä»¶æ•°æ®å®¹é‡ä»¥åŠæ•ˆèƒ½ç›¸å…³æ€§è¾ƒé«˜ã€‚å½“ç”¨äºå¤§å‹æ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬å»ºè®® stripe å¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹ï¼Œè¿™æ ·ç£ç›˜é˜µåˆ—è¯»å†™é¢‘ç‡ä¼šé™ä½ï¼Œæ•ˆèƒ½ä¼šæå‡ã€‚å¦‚æœæ˜¯ç”¨äºç³»ç»Ÿï¼Œé‚£ä¹ˆå°æ–‡ä»¶æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œstripe å»ºè®®å¤§çº¦åœ¨ 64K å·¦å³å¯èƒ½ä¼šæ›´å¥½ã€‚ä¸è¿‡ï¼Œè¿™äº›å‚æ•°æœ€å¥½ç»è¿‡æµ‹è¯•ä¹‹åçœ‹æ˜¯å¦èƒ½è¾¾åˆ°é¢„æœŸæ•ˆæœå†è°ƒæ•´ã€‚æ›´è¯¦ç»†çš„ä¿¡æ¯åœ¨åç»­å†è®²è§£

ã€Œç£ç›˜é˜µåˆ—ç« èŠ‚ã€åœ¨åç»­å­¦å®Œï¼Œå†å›è¿‡å¤´æ¥çœ‹è¯¥ç« èŠ‚ã€‚

æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™è¦èƒ½å¤Ÿæœ‰ä¼˜åŒ–ï¼Œæœ€å¥½èƒ½å¤Ÿæ­é…ç£ç›˜é˜µåˆ—çš„å‚æ•°æ¥è®¾è®¡ï¼›æå‰å…ˆåœ¨æ–‡ä»¶ç³»ç»Ÿå°±å°† stripe è§„åˆ’å¥½ï¼Œå“ªäº¤ç»™ RAID å»å­˜å–æ—¶ï¼Œå®ƒå°±æ— éœ€é‡å¤è¿›è¡Œæ–‡ä»¶çš„ stripe è¿‡ç¨‹ï¼Œæ•ˆèƒ½ä¼šæ›´å¥½ï¼Œåœ¨æ ¼å¼åŒ–æ—¶ï¼Œä¼˜åŒ–æ•ˆèƒ½ä¸å“ªäº›æœ‰å…³ç³»å‘¢ï¼Ÿä¸‹é¢æ¨¡æ‹Ÿä¸€ä¸ªç¯å¢ƒï¼š

- CPU 2 æ ¸å¿ƒï¼Œæ‰€ä»¥è®¾ç½® agcount ä¸º 2
- å½“åˆè®¾ç½® RAID çš„ stripe æŒ‡å®šä¸º 256k ï¼Œå› æ­¤ su æœ€å¥½è®¾ç½®ä¸º 256k
- è®¾ç½®çš„ç£ç›˜é˜µåˆ—æœ‰ 8 é¢—ï¼Œå› ä¸ºæ˜¯ RAID5 çš„è®¾ç½®ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ª parityï¼ˆå¤‡ä»½ç¢Ÿï¼‰å› æ­¤æŒ‡å®š sw ä¸º 7
- ç”±ä¸Šè¿°æ•°æ®å¯ä»¥å‘ç°æ•°æ®å®½åº¦ swidth åº”è¯¥ä¸º 256k * 7 = 1792kï¼Œå¯ä»¥è®¾ç½® extsize ä¸º 1792k

è¿™é‡Œä»…å¿«é€Ÿçš„ä½¿ç”¨ mkfs.xfs çš„å‚æ•°æ¥å¤„ç†æ ¼å¼åŒ–åŠ¨ä½œï¼ˆç›¸å…³ç£ç›˜é˜µåˆ—è¦æ±‚çš„æ•°é‡ç­‰ï¼Œè¯·è‡ªè¡Œç™¾åº¦ï¼‰

```bash
[root@study ~]# mkfs.xfs -f -d agcount=2,su=256k,sw=7 -r extsize=1792k /dev/sda4
meta-data=/dev/sda4              isize=512    agcount=2, agsize=131072 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=262144, imaxpct=25
         =                       sunit=64     swidth=448 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=64 blks, lazy-count=1
realtime =none                   extsz=1835008 blocks=0, rtextents=0
# å…³æ³¨ agcountã€sunitã€swidthã€extsz çš„å€¼
```

ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œagcount æ²¡æœ‰é—®é¢˜

- agcountï¼šæ²¡æœ‰é—®é¢˜
- sunitï¼š64 ä¸ª blockï¼Œ64 * 4096ï¼ˆå•ä¸ªblock å®¹é‡ï¼‰=256Kï¼ˆä¹Ÿå°±æ˜¯ su çš„æ•°å€¼ï¼‰
- swidthï¼š448 * 4k = 1792kï¼ˆextsize çš„æ•°å€¼ï¼‰

å¦‚æœ sunit ä¸ swidth ç›´æ¥å¥—ç”¨åœ¨ mkfs.xfs ä¸­çš„è¯ï¼Œå°±éœ€è¦æ³¨æ„äº†ï¼Œå› ä¸ºæŒ‡ä»¤ä¸­çš„è¿™ä¸¤ä¸ªå‚æ•°ç”¨çš„æ˜¯ã€Œå‡ ä¸ª 512bytes çš„ sector æ•°é‡

- sunitï¼š256k/(512byte*1024)=512 ä¸ª sector 
- Swidthï¼š7 ä¸ªç£ç›˜ * sunit = 7 * 512 = 3584 ä¸ª sector

æ‰€ä»¥æŒ‡ä»¤å°±éœ€è¦å˜æˆä¸‹é¢è¿™æ ·äº†

```bash
mkfs.xfs -f -d agcount=2,sunit=512,swidth=3584 -r extsize=1792k /dev/sda4
```

### EXT4 æ–‡ä»¶ç³»ç»Ÿ mkfs.ext4

```bash
mkfs.ext4 [-b size][-L label] è£…ç½®åç§°

- bï¼šè®¾ç½® block çš„å¤§å°ï¼Œæœ‰ 1kã€2kã€4k çš„å®¹é‡
- Lï¼šè£…ç½®è¡¨å¤´åç§°
```

å®è·µç»ƒä¹ 

```bash
# å°† /dev/sda5 æ ¼å¼åŒ–ä¸º ext4 æ–‡ä»¶ç³»ç»Ÿ
[root@study ~]# mkfs.ext4 /dev/sda5
mke2fs 1.42.9 (28-Dec-2013)
æ–‡ä»¶ç³»ç»Ÿæ ‡ç­¾=
OS type: Linux
å—å¤§å°=4096 (log=2)		# æ¯ä¸€ä¸ª block å¤§å°
åˆ†å—å¤§å°=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks	# ä¸ RAID ç›¸å…³æ€§è¾ƒé«˜
65536 inodes, 262144 blocks		# æ€»è®¡ inodeã€block æ•°é‡
13107 blocks (5.00%) reserved for the super user
ç¬¬ä¸€ä¸ªæ•°æ®å—=0
Maximum filesystem blocks=268435456
8 block groups		# å…±æœ‰ 8 ä¸ª block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376

Allocating group tables: å®Œæˆ                            
æ­£åœ¨å†™å…¥inodeè¡¨: å®Œæˆ                            
Creating journal (8192 blocks): å®Œæˆ
Writing superblocks and filesystem accounting information: å®Œæˆ

[root@study ~]# dumpe2fs -h /dev/sda5
dumpe2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   <none>
Last mounted on:          <not available>
Filesystem UUID:          939ac781-62e4-48a9-a4c5-d804e0f0ee52
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              65536
Block count:              262144
Reserved block count:     13107
Free blocks:              249189
Free blocks:              249189
Free inodes:              65525
First block:              0
Block size:               4096
Fragment size:            4096
Group descriptor size:    64
Reserved GDT blocks:      127
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Tue Oct 22 08:51:57 2019
Last mount time:          n/a
Last write time:          Tue Oct 22 08:51:57 2019
Mount count:              0
Maximum mount count:      -1
Last checked:             Tue Oct 22 08:51:57 2019
Check interval:           0 (<none>)
Lifetime writes:          33 MB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:               256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      9f6434c1-738d-47e2-ae2c-bc766c2198cd
Journal backup:           inode blocks
Journal features:         (none)
æ—¥å¿—å¤§å°:             32M
Journal length:           8192
Journal sequence:         0x00000001
Journal start:            0

```

è¿™é‡Œä¹‹åäº†ä¹‹å‰è®²è§£è¿‡çš„ [dumpe2fs](./01.md#dumpe2fs-æŸ¥è¯¢-ext-å®¶æ—-superblock-ä¿¡æ¯çš„æŒ‡ä»¤) å‘½ä»¤ï¼Œè¿™é‡Œå°±èƒ½å†å›è¿‡å¤´å»ç»ƒä¹ äº†

### å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ mkfs

mkfs æ˜¯ä¸€ä¸ªç»¼åˆæŒ‡ä»¤ï¼Œå½“ä½¿ç”¨ `mkfs -t xfs` æŒ‡ä»¤æ—¶ï¼Œå…¶å®ä¼šå»æ‰¾ mkfs.xfs ç›¸å…³å‚æ•°ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚å¦‚æœè¿˜æƒ³çŸ¥é“è¯¥å‘½ä»¤æ”¯æŒå“ªäº›æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨ tab çš„è¡¥å…¨æ¥æ˜¾ç¤º

```bash
[root@study ~]# mkfs [tab*2]
mkfs         mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs
mkfs.btrfs   mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat 

# è¿™é‡Œçœ‹åˆ°è¿™ä¹ˆå¤šçš„æ”¯æŒæ ¼å¼ï¼Œå¦‚æœå°†åˆšæ‰çš„ /dev/sda5 æ ¼å¼åŒ–ä¸º vfat å¯ä»¥è¿™æ ·åš
[root@study ~]# mkfs -t vfat /dev/sda5 
mkfs.fat 3.0.20 (12 Jun 2013)
[root@study ~]# blkid /dev/sda5
/dev/sda5: UUID="4DA6-A982" TYPE="vfat" PARTLABEL="Microsoft basic data" PARTUUID="9cffc784-99a3-40f6-8e5f-0c71b3bb7f05" 
```

## ğŸ€ æ–‡ä»¶ç³»ç»Ÿæ£€éªŒ

å½“æ–‡ä»¶ç³»ç»Ÿå‡ºç°é—®é¢˜æ˜¯ï¼Œå¦‚ç¡¬ä»¶ã€è½¯ä»¶ã€ç¡¬ä»¶ç­‰é—®é¢˜ç­‰å®•æœºæ—¶ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“æ–‡ä»¶ç³»ç»Ÿè¿ä½œæ—¶ä¼šæœ‰ç£ç›˜ä¸å†…å­˜æ•°æ®å¼‚æ­¥çš„çŠ¶å†µå‘ç”Ÿï¼Œå› æ­¤åœ¨å®•æœºæ—¶å¯èƒ½å¯¼è‡´æ–‡ä»¶ç³»ç»Ÿçš„é”™ä¹±ã€‚

ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ•‘æ´çš„æŒ‡ä»¤ä¸å¤ªä¸€æ ·ï¼Œè¿™é‡Œä¸»è¦é’ˆå¯¹ xfsã€ext4 ä¸¤ä¸ªä¸»æµçš„æ¥è®²è§£

### xfs_repair å¤„ç† XFS æ–‡ä»¶ç³»ç»Ÿ

å½“æœ‰ xfs æ–‡ä»¶ç³»ç»Ÿé”™ä¹±æ‰éœ€è¦ä½¿ç”¨è¯¥å‘½ä»¤

```bash
xfs_repair [-fnd] è£…ç½®å

- fï¼šåé¢çš„è£…ç½®æ˜¯ä¸ªæ–‡ä»¶ï¼ˆå¦‚è™šæ‹Ÿç¡¬ç›˜ï¼‰è€Œä¸æ˜¯å®ä½“çŠ¶æ€
- nï¼šå•çº¯æ£€æŸ¥å¹¶ä¸ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿçš„ä»»ä½•æ•°æ®
- dï¼šé€šå¸¸ç”¨åœ¨å•äººç»´æŠ¤æ¨¡å¼ä¸‹ï¼Œé’ˆå¯¹æ ¹ç›®å½•è¿›è¡Œæ£€æŸ¥ä¸ä¿®å¤çš„åŠ¨ä½œï¼Œå¾ˆå±é™©ï¼ä¸è¦éšä¾¿ä½¿ç”¨
```

å®è·µç»ƒä¹ 

``` bash
æ£€æŸ¥ /dev/sda4 çš„æ–‡ä»¶ç³»ç»Ÿ
[root@study ~]# xfs_repair /dev/sda4
Phase 1 - find and verify superblock...
Phase 2 - using internal log
        - zero log...
        - scan filesystem freespace and inode maps...
        - found root inode chunk
Phase 3 - for each AG...
        - scan and clear agi unlinked lists...
        - process known inodes and perform inode discovery...
        - agno = 0
        - agno = 1
        - process newly discovered inodes...
Phase 4 - check for duplicate blocks...
        - setting up duplicate extent list...
        - check for inodes claiming duplicate blocks...
        - agno = 0
        - agno = 1
Phase 5 - rebuild AG headers and trees...
        - reset superblock...
Phase 6 - check inode connectivity...
        - resetting contents of realtime bitmap and summary inodes
        - traversing filesystem ...
        - traversal finished ...
        - moving disconnected inodes to lost+found ...
Phase 7 - verify and correct link counts...
done
# å…±æœ‰ 7 ä¸ªé‡è¦çš„æ£€æŸ¥æµç¨‹ï¼Œè¯¦ç»†çš„æµç¨‹ä»‹ç»å¯ä»¥ man xfs_repair æŸ¥çœ‹

# æ£€æŸ¥ä¸‹ç³»ç»ŸåŸæœ¬å°±æœ‰çš„ /dev/centos/home æ–‡ä»¶ç³»ç»Ÿ
[root@study ~]# xfs_repair /dev/centos/home 
xfs_repair: /dev/centos/home contains a mounted filesystem
xfs_repair: /dev/centos/home contains a mounted and writable filesystem

fatal error -- couldn't initialize XFS library

```

xfs_repair å¯ä»¥æ£€æŸ¥æˆ–ä¿®å¤æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºä¿®å¤å·¥ä½œæ˜¯ä¸ªå¾ˆåºå¤§çš„ä»»åŠ¡ï¼Œä¸å…è®¸å·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸Šé¢ä¼šæç¤º `xfs_repair /dev/centos/home` æ˜¯ä¸€ä¸ªå·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆéœ€è¦å¸è½½åå†å¤„ç†ï¼‰ã€‚

Linux ç³»ç»Ÿè¿˜æœ‰ä¸ªæ ¹ç›®å½•è£…ç½®æ— æ³•è¢«å¸è½½ï¼Œè¦å¯¹æ ¹ç›®å½•æ•‘æ´æ€ä¹ˆåŠï¼Ÿè¿™ä¸ªå°±æ˜¯å•äººæ•‘æ´æ¨¡å¼æ¥å¤„ç†äº†ï¼Œä½¿ç”¨å‚æ•° `-d` è¿›å…¥ã€‚è®°å¾—å¾ˆå±é™©è¿™ä¸ªæŒ‡ä»¤ï¼

### fsck.ext4 å¤„ç† ext4 æ–‡ä»¶ç³»ç»Ÿ

```bash
fsck.ext4 [-pf][-b superblock] è£…ç½®åç§°
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- pï¼šå½“æ–‡ä»¶ç³»ç»Ÿåœ¨ä¿®å¤æ—¶ï¼Œè‹¥æœ‰éœ€è¦å›å¤ y çš„åŠ¨ä½œæ—¶ï¼Œè‡ªåŠ¨å›å¤ y æ¥ç»§ç»­è¿›è¡Œä¿®å¤åŠ¨ä½œ
- fï¼šå¼ºåˆ¶æ£€æŸ¥ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœ fsck æ²¡æœ‰å‘ç°ä»»ä½• unclean çš„æ——æ ‡ï¼Œä¸ä¼šä¸»åŠ¨è¿›å…¥ç»†éƒ¨æ£€æŸ¥çš„ï¼Œå¯ä»¥é€šè¿‡ -f å‚æ•°å¼ºåˆ¶æ£€æŸ¥
- Dï¼šé’ˆå¯¹è¯¥æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ç›®å½•è¿›è¡Œä¼˜åŒ–é…ç½®
- bï¼šåé¢æ¥ superblock çš„ä½ç½®ã€‚ä¸€èˆ¬æ¥è¯´è¯¥é€‰é¡¹ç”¨ä¸åˆ°ï¼Œä½†æ˜¯å¦‚æœ superblock å› æ•…æŸåæ—¶ï¼Œé€šè¿‡è¯¥å‚æ•°å³å¯åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿå†…å¤‡ä»½çš„ superblock æ¥å°è¯•æ•‘æ´ã€‚ä¸€èˆ¬æ¥è¯´ superblock å¤‡ä»½åœ¨ï¼š 1k block æ”¾åœ¨ 8193ã€2k block æ”¾åœ¨16384ã€4k block æ”¾åœ¨ 32786

å®è·µç»ƒä¹ 

```bash
# æ‰¾å‡ºåˆšåˆšå»ºç«‹çš„ /dev/sda5 çš„å¦ä¸€å— superblockï¼Œå¹¶æ£€æŸ¥å®ƒ
# å‘ç°æŠ¥é”™äº†ï¼Œè¿™ä¸ªæ˜¯å‰é¢ç»ƒä¹ æ ¼å¼åŒ–æˆé ext ç³»ç»Ÿäº†ï¼Œè¿™é‡Œéœ€è¦æ ¼å¼åŒ–å›æ¥
[root@study ~]# dumpe2fs -h /dev/sda5 | grep 'Blocks per group'
dumpe2fs 1.42.9 (28-Dec-2013)
dumpe2fs: Bad magic number in super-block å½“å°è¯•æ‰“å¼€ /dev/sda5 æ—¶
# æ ¼å¼å› ext4
[root@study ~]# mkfs.ext4 /dev/sda5
[root@study ~]# dumpe2fs -h /dev/sda5 | grep 'Blocks per group'
dumpe2fs 1.42.9 (28-Dec-2013)
Blocks per group:         32768
# çœ‹èµ·æ¥æ¯ä¸ª block ç¾¤ç»„ä¼šæœ‰ 32768 ä¸ª blockï¼Œå› æ­¤ç¬¬äºŒä¸ª superblock åº”è¯¥å°±åœ¨ 32768 ä¸Š
# å› ä¸º block å·ç ä¸º 0 å·å¼€å§‹

[root@study ~]# fsck.ext4 -b 32768 /dev/sda5
e2fsck 1.42.9 (28-Dec-2013)
/dev/sda5 was not cleanly unmounted, å¼ºåˆ¶æ£€æŸ¥.
ç¬¬ä¸€æ­¥: æ£€æŸ¥inode,å—,å’Œå¤§å°
åˆ é™¤ inode 1577 has zero dtime.  å¤„ç†<y>? æ˜¯
ç¬¬äºŒæ­¥: æ£€æŸ¥ç›®å½•ç»“æ„
ç¬¬3æ­¥: æ£€æŸ¥ç›®å½•è¿æ¥æ€§
Pass 4: Checking reference counts
ç¬¬5æ­¥: æ£€æŸ¥ç°‡æ¦‚è¦ä¿¡æ¯

/dev/sda5: ***** æ–‡ä»¶ç³»ç»Ÿå·²ä¿®æ”¹ *****  # æ–‡ä»¶ç³»ç»Ÿè¢«ä¿®æ”¹è¿‡ï¼Œæ‰€ä»¥å‡ºç°äº†è­¦å‘Š
/dev/sda5: 11/65536 files (0.0% non-contiguous), 12955/262144 blocks

# å¦‚æœæ²¡æœ‰æ£€æŸ¥åˆ°é—®é¢˜ï¼Œåˆ™ä¸ä¼šå¼ºåˆ¶æ£€æŸ¥
[root@study ~]# fsck.ext4 /dev/sda5
e2fsck 1.42.9 (28-Dec-2013)
/dev/sda5: clean, 11/65536 files, 12955/262144 blocks
# -f å‚æ•°å¼ºåˆ¶æ£€æŸ¥
[root@study ~]# fsck.ext4 -f /dev/sda5
e2fsck 1.42.9 (28-Dec-2013)
ç¬¬ä¸€æ­¥: æ£€æŸ¥inode,å—,å’Œå¤§å°
ç¬¬äºŒæ­¥: æ£€æŸ¥ç›®å½•ç»“æ„
ç¬¬3æ­¥: æ£€æŸ¥ç›®å½•è¿æ¥æ€§
Pass 4: Checking reference counts
ç¬¬5æ­¥: æ£€æŸ¥ç°‡æ¦‚è¦ä¿¡æ¯
/dev/sda5: 11/65536 files (0.0% non-contiguous), 12955/262144 blocks

```

xfs_repair sæˆ– fsck.ext4 éƒ½æ˜¯ç”¨æ¥æ£€æŸ¥ä¸ä¿®æ­£æ–‡ä»¶ç³»ç»Ÿé”™è¯¯çš„æŒ‡ä»¤ã€‚æ³¨æ„ï¼šé€šå¸¸åªæœ‰èº«ä¸º root ä¸”ä½ çš„æ–‡ä»¶ç³»ç»Ÿæœ‰é—®é¢˜çš„æ—¶å€™æ‰ä½¿ç”¨è¯¥æŒ‡ä»¤ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆå¯¹ç³»ç»Ÿçš„å±å®³ã€‚é€šå¸¸ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½æ˜¯ç³»ç»Ÿå‡ºç°äº†æå¤§çš„é—®é¢˜ï¼Œå¯¼è‡´åœ¨ linux å¼€æœºçš„æ—¶å€™å¾—è¿›å…¥å•äººå•æœºæ¨¡å¼ä¸‹è¿›è¡Œç»´æŠ¤çš„è¡Œä¸ºæ—¶ï¼Œæ‰å¿…é¡»ä½¿ç”¨æ­¤æŒ‡ä»¤

å¦å¤–ï¼Œå¦‚æœæ€€ç–‘åˆšæ ¼å¼åŒ–çš„ç£ç›˜æœ‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›æŒ‡ä»¤æ¥æ£€æŸ¥ï¼Œæ­¤å¤–è¿™äº›æŒ‡ä»¤åœ¨æ‰«æç£ç›˜æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆéƒ¨åˆ† filesystem çš„ä¿®è®¢ï¼Œæ‰€ä»¥ï¼šæ‰§è¡Œ xfs_repairã€fsck.ext4 æ—¶ï¼Œè¢«æ£€æŸ¥çš„ partition ä¸èƒ½æŒ‚è½½åˆ°ç³»ç»Ÿä¸Šï¼Œéœ€è¦å…ˆå¸è½½



## ğŸ€ æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸å¸è½½

å‰é¢æåˆ°è¿‡æŒ‚è½½ç‚¹æ˜¯ç›®å½•ï¼Œç›®å½•æ˜¯è¿›å…¥ç£ç›˜åˆ†åŒºæ§½ï¼ˆå…¶å®æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰çš„å…¥å£ã€‚åœ¨æŒ‚è½½å‰éœ€è¦ç¡®å®šå‡ ä»¶äº‹æƒ…ï¼š

- å•ä¸€æ–‡ä»¶ç³»ç»Ÿä¸åº”è¯¥è¢«é‡å¤æŒ‚è½½åœ¨ä¸åŒçš„æŒ‚è½½ç‚¹ï¼ˆç›®å½•ï¼‰ä¸­

- å•ä¸€ç›®å½•ä¸åº”è¯¥é‡å¤æŒ‚è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿ

- è¦ä½œä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ï¼Œç†è®ºä¸Šéƒ½æ˜¯ç©ºç›®å½•æ‰æ˜¯

  å¦‚æœä¸æ˜¯ç©ºç›®å½•ï¼ŒæŒ‚è½½ä¹‹åï¼ŒåŸæ¥ç›®å½•ä¸‹çš„å†…å®¹ä¼šæš‚æ—¶æ¶ˆå¤±ï¼Œç­‰å¾…åˆ†åŒºè¢«å¸è½½ä¹‹åæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥

åœ¨ linux ç³»ç»Ÿä¸Šéœ€è¦ä½¿ç”¨ mount æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¾ˆéš¾ï¼Œè¿™é‡Œç®€å•å­¦ä¸€ç‚¹

```bash
mount -a
mount [-l]
mount [-t æ–‡ä»¶ç³»ç»Ÿ] LABEL='' æŒ‚è½½ç‚¹
mount [-t æ–‡ä»¶ç³»ç»Ÿ] UUID='' æŒ‚è½½ç‚¹
mount [-t æ–‡ä»¶ç³»ç»Ÿ] è£…ç½®æ–‡ä»¶å='' æŒ‚è½½ç‚¹
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- aï¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ /etc/fstab çš„æ•°æ®å°†æ‰€æœ‰æœªæŒ‚è½½çš„ç£ç›˜éƒ½æŒ‚è½½ä¸Šæ¥
- lï¼šå•çº¯çš„è¾“å…¥ mount ä¼šæ˜¾ç¤ºç›®å‰æŒ‚è½½çš„ä¿¡æ¯ã€‚åŠ ä¸Š -l å¯å¢åˆ— Label åç§°
- tï¼šå¯ä»¥åŠ ä¸Šæ–‡ä»¶ç³»ç»Ÿç§ç±»æ¥æŒ‡å®šæ¬²æŒ‚è½½çš„ç±»å‹ã€‚å¸¸è§çš„ Linux æ”¯æŒç±»å‹æœ‰
  - xfs
  - ext3
  - ext4
  - reiserfs
  - vfat
  - Iso9660ï¼ˆå…‰ç›˜æ ¼å¼ï¼‰
  - nfsï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼‰
  - cifsï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼‰
  - smbfsï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼‰
- oï¼šåé¢å¯ä»¥æ¥ä¸€äº›æŒ‚è½½æ—¶é¢å¤–åŠ ä¸Šçš„å‚æ•°ï¼Œä¾‹å¦‚è´¦æˆ·ã€å¯†ç ã€è¯»å†™æƒé™ç­‰
  - asyncã€syncï¼šæ­¤æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦ä½¿ç”¨åŒæ­¥å†™å…¥ï¼ˆsyncï¼‰æˆ–å¼‚æ­¥ï¼ˆasyncï¼‰çš„å†…å­˜æœºåˆ¶ï¼Œè¯·å‚è€ƒæ–‡ä»¶ç³»ç»Ÿè¿ä½œæ–¹å¼ã€‚é¢„è®¾ä¸º async
  - atimeã€noatimeï¼šæ˜¯å¦ä¿®è®¢æ–‡ä»¶çš„è¯»å–æ—¶é—´ï¼ˆatimeï¼‰ï¼Œä¸ºäº†æ•ˆèƒ½ï¼ŒæŸäº›æ—¶åˆ»åˆ»ä½¿ç”¨ noatime
  - roã€rwï¼šæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿä½åªè¯»ï¼ˆroï¼‰æˆ–å¯æ“¦å†™ï¼ˆrwï¼‰
  - autoã€noautoï¼šå…è®¸æ­¤ filesystem è¢« ä»¥ mount -a è‡ªåŠ¨æŒ‚è½½ï¼ˆautoï¼‰
  - devã€nodevï¼šæ˜¯å¦å…è®¸æ­¤ filesystem ä¸Šï¼Œå¯å»ºç«‹è£…ç½®æ–‡ä»¶ï¼Ÿdev ä¸ºå…è®¸
  - suidã€nosuidï¼šæ˜¯å¦å…è®¸æ­¤ filesystem å«æœ‰ suidã€sgid çš„æ–‡ä»¶æ ¼å¼
  - execã€noexecï¼šæ˜¯å¦å…è®¸æ­¤ filesystem ä¸Šæ‹¥æœ‰å¯æ‰§è¡Œ binary æ–‡ä»¶
  - userã€nouserï¼šæ˜¯å¦å…è®¸æ­¤ filesystem è®©ä»»ä½•ä½¿ç”¨è€…æ‰§è¡Œ mount ï¼Ÿä¸€èˆ¬æ¥è¯´ mount ä»…æœ‰ root å¯ä»¥è¿›è¡Œï¼Œä½†ä¸‹è¾¾ user å‚æ•°åˆ™å¯ä»¥è®©ä¸€èˆ¬ user ä¹Ÿèƒ½å¤Ÿå¯¹æ­¤ partition è¿›è¡Œ mount
  - defaultsï¼šé»˜è®¤å€¼ä¸º rwã€suidã€devã€execã€autoã€nouserã€async
  - remountï¼šé‡æ–°æŒ‚è½½ï¼Œè¿™åœ¨ç³»ç»Ÿé™¤é”™æˆ–é‡æ–°æ›´æ–°å‚æ•°æ—¶ï¼Œå¾ˆæœ‰ç”¨

åŸºæœ¬ä¸Š CentOS 7 ä¸éœ€è¦åŠ ä¸Š -t è¿™ä¸ªé€‰é¡¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œè¿™ä¹Ÿæ˜¯ä½¿ç”¨ blkid å°±èƒ½å¤Ÿæ˜¾ç¤ºæ­£ç¡®çš„æ–‡ä»¶ç³»ç»Ÿçš„ç¼˜æ•…ã€‚

é‚£ä¹ˆ centos æ˜¯æ€ä¹ˆæ‰¾å‡ºæ–‡ä»¶ç³»ç»Ÿç±»å‹çš„å‘¢ï¼Ÿç”±äºæ–‡ä»¶ç³»ç»Ÿå‡ ä¹éƒ½æœ‰ superblock ï¼Œå¯ä»¥é€šè¿‡åˆ†æ superblock æ­é… linux è‡ªå·±çš„é©±åŠ¨ç¨‹åºå»æµ‹è¯•æŒ‚è½½ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œå°±likeè‡ªåŠ¨çš„ä½¿ç”¨è¯¥ç±»å‹çš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½èµ·æ¥ã€‚é‚£ä¹ˆå¯ä»¥ä¸»è¦åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°æœ‰å“ªäº› filesystem æ”¯æŒä¸Šè¿°çš„æŒ‚è½½æµ‹è¯•

- /etc/filesystemsï¼šç³»ç»ŸæŒ‡å®šçš„æµ‹è¯•æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç±»å‹çš„ä¼˜å…ˆçº§
- /proc/filesystemsï¼šlinux ç³»ç»Ÿå·²ç»åŠ è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹

å¯ä»¥åœ¨ `/lib/modules/$(uname -r)/kernel/fs/` ç›®å½•ä¸­æ‰¾åˆ°ç›¸å…³æ–‡ä»¶ç³»ç»Ÿç±»å‹çš„é©±åŠ¨ç¨‹åºï¼Œæ¯”å¦‚ ext4 çš„é©±åŠ¨åœ¨ `/lib/modules/$(uname -r)/kernel/fs/ext4/` ç›®å½•ä¸‹

æ³¨ï¼š`$(uname -r)`æ‹¬å·ä¸­çš„æŒ‡ä»¤å¯ä»¥æ‰§è¡Œçš„ï¼Œä½¿ç”¨è¿™ç§å ä½æ¥å¼•ç”¨æŒ‡ä»¤è¾“å‡ºçš„ç»“æœ

å¦å¤–ï¼Œè¿‡å»éƒ½ä¹ æƒ¯ä½¿ç”¨è£…ç½®æ–‡ä»¶åç„¶åç›´æ¥ç”¨è¯¥æ–‡ä»¶åæ¥æŒ‚è½½ï¼Œä¸è¿‡è¿™é‡Œæ¨èä½¿ç”¨ UUID æ¥è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºæ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå¾ˆå¯é 



### æŒ‚è½½ xfs/ext4/vfat ç­‰æ–‡ä»¶ç³»ç»Ÿ

```bash
# å…ˆæ‰¾å‡º uuidï¼Œä½¿ç”¨ uuid æ¥æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿåˆ° /data/xfs å†…
[root@study fs]# blkid /dev/sda4
/dev/sda4: UUID="819c0c18-8d4a-4c3f-9a98-0ab039e769f5" TYPE="xfs" PARTLABEL="Linux filesystem" PARTUUID="3819b115-2ab8-4fb6-8425-bb2ff8e797b7" 
[root@study fs]# mount UUID="819c0c18-8d4a-4c3f-9a98-0ab039e769f5" /data/xfs
mount: æŒ‚è½½ç‚¹ /data/xfs ä¸å­˜åœ¨
[root@study fs]# mkdir -p /data/xfs
[root@study fs]# mount UUID="819c0c18-8d4a-4c3f-9a98-0ab039e769f5" /data/xfs
[root@study fs]# df /data/xfs
æ–‡ä»¶ç³»ç»Ÿ         1K-å—  å·²ç”¨    å¯ç”¨ 	  å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sda4      1038336 32896 1005440    4% /data/xfs
# è¿™é‡Œé¡ºåˆ©æŒ‚è½½äº†ï¼Œä¸”å®¹é‡çº¦ä¸º 1g å·¦å³
[root@study fs]# df -h /data/xfs
æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sda4      1014M   33M  982M    4% /data/xfs


# ä½¿ç”¨ç›¸åŒçš„æ–¹å¼ï¼Œå°† /dev/sda5 æŒ‚è½½åˆ° /dev/ext4 ç›®å½•
[root@study fs]# mkdir /data/ext4
[root@study fs]# blkid /dev/sda5
/dev/sda5: UUID="b0923041-024a-47cf-a4b8-d59b573855d7" TYPE="ext4" PARTLABEL="Microsoft basic data" PARTUUID="9cffc784-99a3-40f6-8e5f-0c71b3bb7f05" 
[root@study fs]# mount UUID="b0923041-024a-47cf-a4b8-d59b573855d7" /data/ext4
[root@study fs]# df /data/ext4
æ–‡ä»¶ç³»ç»Ÿ        1K-å—  å·²ç”¨   å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sda5      999320  2564 927944    1% /data/ext4

```

### æŒ‚è½½ CD æˆ– DVD å…‰ç›˜

è¿™é‡Œæ‹¿å‡ºè£…ç³»ç»Ÿçš„æ—¶å€™é‚£ä¸ª iso çš„æ–‡ä»¶ï¼ŒåŠ è½½åˆ°è™šæ‹Ÿæœºä¸­

![image-20191027165331804](./assets/image-20191027165331804.png)

```bash
[root@study ~]# blkid
/dev/sr0: UUID="2019-07-12-09-13-14-35" LABEL="VBox_GAs_6.0.10" TYPE="iso9660" 
# æ‰¾åˆ°ä¸Šå›¾çš„å…‰é©±
/dev/sr1: UUID="2019-09-11-18-50-31-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
...

# æŒ‚è½½åˆ° /data/cdrom ç›®å½•ä¸‹
[root@study ~]# mkdir /data/cdrom
[root@study ~]# mount /dev/sr1 /data/cdrom/
mount: /dev/sr1 å†™ä¿æŠ¤ï¼Œå°†ä»¥åªè¯»æ–¹å¼æŒ‚è½½
[root@study ~]# df /data/cdrom/
æ–‡ä»¶ç³»ç»Ÿ         1K-å—    å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sr1       4554702 4554702     0  100% /data/cdrom

```

å…‰é©±æŒ‚è½½ä¹‹åå°±æ— æ³•é€€å‡ºç›˜ç‰‡äº†ï¼Œé™¤éå¸è½½æ‰èƒ½å¤Ÿé€€å‡ºã€‚åœ¨å›¾å½¢ç•Œé¢ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ æŒ‚è½½è¿™ä¸ªå…‰ç›˜åˆ° /media/ é‡Œé¢å»ï¼Œä¹Ÿå¯ä»¥ä¸å¸é™¤å°±ç›´æ¥é€€å‡ºï¼Œä½†æ˜¯æ–‡å­—ç•Œé¢å°±æ²¡æœ‰è¿™ä¸ªç¦åˆ©äº†



### æŒ‚è½½ vfat ï¼ˆUSB ç£ç›˜ï¼‰

USB ä¸èƒ½æ˜¯ NTFS çš„æ–‡ä»¶ç³»ç»Ÿ

```bash
ç”±äºç¬”è€…æ²¡æœ‰ USB ç£ç›˜ï¼Œè¿™é‡Œå°±ä¸åšç»ƒä¹ äº†ï¼Œç›´æ¥å¤åˆ¶å‘½ä»¤
blkid
/dev/sda1:UUID="xxxx22" TYPE="vfat"
mkdir /data/usb
mount -o codepage=950,iocharset=utf8 UUID="xxxx22" /data/usb
df /data/usb
æ–‡ä»¶ç³»ç»Ÿ         1K-å—    å·²ç”¨    å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sda1    4554702 4554702     0  100% /data/usb
```

å¦‚æœå¸¦æœ‰ä¸­æ–‡æ–‡ä»¶åçš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æŒ‚è½½æ—¶æŒ‡å®šä¸‹æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ‰€ä½¿ç”¨çš„è¯­ç³»æ•°æ®ï¼Œåœ¨ man mount æ‰¾åˆ° vfat æ–‡ä»¶æ ¼å¼å½“ä¸­å¯ç”¨ä½¿ç”¨ codepage æ¥å¤„ç†ï¼Œä¸­æ–‡è¯­ç³»ä»£ç ä¸º 950

å¦‚æœä½ ä½¿ç”¨çš„ usb ç£ç›˜æ˜¯ NTFS æ—¶ï¼Œå› ä¸ºé¢„è®¾çš„ CentOS 7 ä¸æ”¯æŒ NTFS æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… NTFS æ–‡ä»¶ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºåï¼Œæ‰å¯ä»¥ï¼ˆè¯¥éƒ¨åˆ†åç»­è®²è§£ yum æœåŠ¡å™¨æ—¶ä¼šç»§ç»­ï¼‰



### é‡æ–°æŒ‚è½½æ ¹ç›®å½•ä¸æŒ‚è½½ä¸ç‰¹å®šç›®å½•

æ ¹ç›®å½•ä¸èƒ½è¢«å¸è½½çš„ï¼Œå¦‚æœæƒ³è¦æ”¹å˜æŒ‚è½½å‚æ•°æˆ–åˆ™æ ¹ç›®å½•å‡ºç°ã€Œåªè¯»ã€çŠ¶æ€æ—¶ï¼Œå¦‚ä½•é‡æ–°æŒ‚è½½å‘¢ï¼Ÿæœ€å¯èƒ½çš„å¤„ç†æ–¹å¼å°±æ˜¯é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤æ¥åš

```bash
# å°† / é‡æ–°æŒ‚è½½ï¼Œå¹¶åŠ å…¥å‚æ•°ä¸º rw ä¸ auto
mount -o remount,rw,auto /
```

å¦å¤–ï¼Œå¯ä»¥åˆ©ç”¨ mount æ¥å°†æŸä¸ªç›®å½•æŒ‚è½½åˆ°å¦å¤–ä¸€ä¸ªæœ¨å»ï¼Œè¿™å¹¶ä¸æ˜¯æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯é¢å¤–æ•…éšœæŸä¸ªç›®å½•çš„æ–¹æ³•ï¼Œè™½ç„¶ä¸‹é¢çš„æ¼”ç¤ºä¹Ÿå¯ä»¥ä½¿ç”¨ symbolic link æ¥è¿ç»“ï¼Œä¸è¿‡åœ¨æŸäº›ä¸æ”¯æŒç¬¦å·é“¾æ¥çš„ç¨‹åºè¿è¡Œä¸­ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å¤„ç†

```bash
[root@study ~]# mkdir /data/var
[root@study ~]# mount --bind /var /data/var
[root@study ~]# ls -lid /var /data/var
69 drwxr-xr-x. 20 root root 282 10æœˆ  4 18:38 /data/var
69 drwxr-xr-x. 20 root root 282 10æœˆ  4 18:38 /var
# å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç›®å½•ä¸€æ¨¡ä¸€æ ·

# é€šè¿‡ mount æŒ‡ä»¤æŸ¥æ‰¾ var å†…å®¹ï¼Œçœ‹åˆ°ä¸‹é¢çš„ /data/var çš„æŒ‚è½½å±æ€§
[root@study ~]# mount | grep var
sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
/dev/mapper/centos-root on /data/var type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
# ä»æ­¤è¿›å…¥ /data/var å°±æ˜¯è¿›å…¥ /var çš„æ•ˆæœäº†
```

### umount å°†è£…ç½®æ–‡ä»¶å¸é™¤

```bash
umount [-fn] è£…ç½®æ–‡ä»¶åæˆ–æŒ‚è½½ç‚¹

-fï¼šå¼ºåˆ¶å¸é™¤ï¼Œå¯ç”¨åœ¨ç±»ä¼¼ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿæ— æ³•è¯»å–åˆ°çš„æƒ…å†µä¸‹
-lï¼šlikeå¸é™¤æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯” -f è¿˜å¼º
-nï¼šä¸æ›´æ–° /etc/mtab æƒ…å†µä¸‹å¸é™¤

# å°†æœ¬ç« è®²è§£çš„ç¤ºä¾‹æŒ‚è½½å…¨éƒ¨å¸é™¤
/dev/sr1 on /data/cdrom type iso9660 (ro,relatime)
/dev/mapper/centos-root on /data/var type xfs (rw,relatime,seclabel,attr2,inode64,noquota)

# ç¬”è€…è¿™é‡Œåˆšæ‰è™šæ‹Ÿæœºé‡å¯äº†ï¼Œæ‰¾ä¸åˆ° /data/xfs å’Œ /data/ext4 çš„æŒ‚è½½ç‚¹ä¿¡æ¯äº†
# æŸ¥çœ‹äº†ä¸‹ç›®å½•ä¿¡æ¯ï¼Œå‘ç°å˜æˆæœ€åä¸€ä¸ª ä¸€æ ·çš„äº†ï¼Œéƒ½æ˜¯ /dev/mapper/centos-root

# å¸è½½åé¢å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼
# umount /dev/sr1  # ç”¨è£…ç½®æ–‡ä»¶å
umount /data/cdrom # ç”¨æŒ‚è½½ç‚¹æ¥å¸è½½
umount /data/var # è¯´æ˜¯è¿™ä¸ªè£…ç½®æœ‰è¢«å…¶ä»–æ–¹å¼æŒ‚è½½ï¼Œè¿™é‡Œä¸€å®šè¦ç”¨æŒ‚è½½ç‚¹
# è¿™é‡Œç¬”è€…å°±æ‡µé€¼äº†ï¼Œå®Œå…¨çœ‹ä¸å‡ºæ¥æ€ä¹ˆç®—æ˜¯è¢«å…¶ä»–æŒ‚è½½ç‚¹æŒ‚è½½çš„ï¼Ÿ

```

## ğŸ€ ç£ç›˜/æ–‡ä»¶ç³»ç»Ÿå‚æ•°ä¿®è®¢

æŸäº›æ—¶å€™ï¼Œå¯èƒ½å¸Œæœ›ä¿®æ”¹ä¸€ä¸‹ç›®å‰æ–‡ä»¶ç³»ç»Ÿçš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚éœ€è¦ä¿®æ”¹ Label nameï¼Œæˆ–åˆ™æ˜¯ journal çš„å‚æ•°ï¼Œæˆ–åˆ™æ˜¯å…¶ä»–ç£ç›˜ã€æ–‡ä»¶ç³»ç»Ÿè¿ä½œæ—¶çš„ç›¸å…³å‚æ•°ï¼ˆDMA å¯åŠ¨ä¸å¦ï¼‰ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸‹é¢çš„ç›¸å…³æŒ‡ä»¤äº†

### mknod

åœ¨ Linux ä¸‹æ‰€æœ‰çš„è£…ç½®éƒ½ä»¥æ–‡ä»¶æ¥ä»£è¡¨çš„ï¼Œä½†æ˜¯é‚£ä¸ªæ–‡ä»¶å¦‚ä½•ä»£è¡¨è¯¥è£…ç½®å‘¢ï¼Ÿ

```bash
[mrcode@study ~]$ ll /dev/sda*
# æ³¨æ„è¿™é‡Œçš„ 8,0 è¿™ä¸€åˆ—
brw-rw----. 1 root disk 8, 0 Oct 27 17:36 /dev/sda
brw-rw----. 1 root disk 8, 1 Oct 27 17:36 /dev/sda1
brw-rw----. 1 root disk 8, 2 Oct 27 17:36 /dev/sda2
brw-rw----. 1 root disk 8, 3 Oct 27 17:36 /dev/sda3
brw-rw----. 1 root disk 8, 4 Oct 27 17:36 /dev/sda4
brw-rw----. 1 root disk 8, 5 Oct 27 17:36 /dev/sda5

```

ä¸Šé¢ä¿¡æ¯ä¸­çš„ 8 ä¸ºä¸»è¦è£…ç½®ä»£ç ï¼ˆMajorï¼‰ï¼Œè€Œ 0~5 åˆ™ä¸ºæ¬¡è¦è£…ç½®ä»£ç ï¼ˆMinorï¼‰ï¼Œlinux æ ¸å¿ƒå°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªæ•°å€¼æ¥å†³å®šçš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¸¸è§çš„ç£ç›˜æ–‡ä»¶å /dev/sda ä¸ /dev/loop0 è£…ç½®ä»£ç å¦‚ä¸‹æ‰€ç¤º

| ç£ç›˜æ–‡ä»¶å | Major | Minor |
| :--------: | :---: | :---: |
|  /dev/sda  |   8   | 0-15  |
|  /dev/sdb  |   8   | 16-31 |
| /dev/loop0 |   7   |   0   |
| /dev/loop1 |   7   |   1   |

å¯ä»¥é€šè¿‡æ ¸å¿ƒå®˜ç½‘è¿ç»“äº†è§£æ›´å¤šæ ¸å¿ƒæ”¯æ’‘çš„ç¡¬ä»¶è£…ç½®ä»£ç ã€‚åŸºæœ¬ä¸Š linux æ ¸å¿ƒ 2.6 ä»¥åï¼Œç¡¬ä»¶æ–‡ä»¶åå·²ç»éƒ½å¯ä»¥è¢«ç³»ç»Ÿè‡ªåŠ¨çš„å®æ—¶äº§ç”Ÿäº†ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºè£…ç½®æ–‡ä»¶ã€‚ä¸å¤ŸæŸäº›æƒ…å†µä¸‹éœ€è¦ä¸œæ¶Œå¤„ç†è£…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨æŸäº›æœåŠ¡è¢«å…³åˆ°ç‰¹å®šç›®å½•ä¸‹æ—¶ï¼ˆchrootï¼‰å°±éœ€è¦è¿™æ ·åšäº†ï¼Œæ­¤æ—¶ mknod æŒ‡ä»¤å¯ä»¥å®ç°

```bash
mknod è£…ç½®æ–‡ä»¶å [bcp][Major][Minor]
é€‰é¡¹ä¸å‚æ•°
è£…ç½®ç§ç±»ï¼š
 bï¼šè®¾ç½®è£…ç½®åç§°æˆä¸ºä¸€ä¸ªå‘¨è¾¹å­˜å‚¨è®¾å¤‡æ–‡ä»¶ï¼Œä¾‹å¦‚ç£ç›˜ç­‰
 cï¼šè®¾ç½®è£…ç½®åç§°æˆä¸ºä¸€ä¸ªå‘¨è¾¹è¾“å…¥è®¾å¤‡æ–‡ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡ã€é”®ç›˜ç¯
 pï¼šè®¾ç½®è£…ç½®åç§°æˆä¸ºä¸€ä¸ª FIFO æ–‡ä»¶
Majorï¼šä¸»è¦è£…ç½®ä»£ç 
Minorï¼šæ¬¡è¦è£…ç½®ä»£ç 
```

å®è·µç»ƒä¹ 

```bash
# ä¸Šè¿°ä»‹ç»çŸ¥é“  /dev/sda10 çš„è£…ç½®ä»£ç ä¸º 8ï¼Œ10 ï¼Œè¯·å»ºç«‹å¹¶æŸ¥é˜…æ­¤è£…ç½®
[root@study ~]# mknod /dev/sda10 b 8 10
[root@study ~]# ll /dev/sda10
brw-r--r--. 1 root root 8, 10 10æœˆ 27 17:52 /dev/sda10
# æ³¨æ„å‰é¢çš„ b å’Œ 8ï¼Œ10 è¿™ä¸ªæ˜¯æœ‰æ„ä¹‰çš„ä¸è¦éšæ„è®¾å®š

# å»ºç«‹ä¸€ä¸ª FIFO æ–‡ä»¶
[root@study ~]# mknod /tmp/testpipe p
[root@study ~]# ll /tmp/testpipe 
prw-r--r--. 1 root root 0 10æœˆ 27 17:53 /tmp/testpipe
# è¯¥æ–‡ä»¶ä¸æ˜¯ä¸€èˆ¬æ–‡ä»¶ï¼Œä¸å¯ä»¥éšä¾¿æ”¾è¿™é‡Œï¼Œæµ‹è¯•å®Œæˆååˆ é™¤æ‰è¯¥æ–‡ä»¶

[root@study ~]# rm /dev/sda10 /tmp/testpipe 
rmï¼šæ˜¯å¦åˆ é™¤å—ç‰¹æ®Šæ–‡ä»¶ "/dev/sda10"ï¼Ÿy
rmï¼šæ˜¯å¦åˆ é™¤å…ˆè¿›å…ˆå‡º "/tmp/testpipe"ï¼Ÿy

```

### xfs_admin ä¿®æ”¹ XFS æ–‡ä»¶ç³»ç»Ÿçš„ UUID ä¸ Lable name

å¦‚æœå½“åˆæ ¼å¼åŒ–çš„æ‰‹å¿˜è®°åŠ ä¸Š lable nameï¼Œåæ¥æƒ³è¦é‡æ–°åŠ ä¸Šï¼Œä¸éœ€è¦é‡æ–°æ ¼å¼åŒ–

```bash
xfs_admin [-lu] [-L labe][-U uuid] è£…ç½®æ–‡ä»¶å
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- lï¼šåˆ—å‡ºè¿™ä¸ªè£…ç½®çš„ lable
- uï¼šåˆ—å‡ºè¿™ä¸ªè£…ç½®çš„ uuid
- Lï¼šè®¾ç½®è¿™ä¸ªè£…ç½®çš„ label name
- Uï¼šè®¾ç½®è¿™ä¸ªè£…ç½®çš„ uuid

```bash
# å¼€å§‹æŸ¥çœ‹ï¼Œæ²¡æœ‰ label
[root@study ~]# xfs_admin -l /dev/sda4
label = ""
# è®¾ç½®åï¼Œå‘ç°åäº†
[root@study ~]# xfs_admin -L mrcode_xfs /dev/sda4
writing all SBs
new label = "mrcode_xfs"
[root@study ~]# xfs_admin -l /dev/sda4
label = "mrcode_xfs"

# åˆ©ç”¨ uuidgen äº§ç”Ÿæ–° UUID æ¥è®¾ç½® /dev/sda4 ï¼Œå¹¶æµ‹è¯•æŒ‚è½½
[root@study ~]# umount /dev/sda4
umount: /dev/sda4ï¼šæœªæŒ‚è½½  # å‰é¢ç»ƒä¹ ä¸­æˆ‘è¯´å’‹æ²¡æœ‰å‘ç°ä»–äº†ï¼ŒåŸæ¥æŒ‚è½½å¤±æ•ˆäº†ï¼Ÿ
# ç”Ÿæˆ uuid
[root@study ~]# uuidgen
edfa7161-5847-4935-80e1-6e081be9ab77
[root@study ~]# xfs_admin -u /dev/sda4
UUID = 819c0c18-8d4a-4c3f-9a98-0ab039e769f5
# ä¿®æ”¹ä¸ºæ–°ç”Ÿæˆçš„ uuid
[root@study ~]# xfs_admin -U edfa7161-5847-4935-80e1-6e081be9ab77 /dev/sda4
Clearing log and setting UUID
writing all SBs
new UUID = edfa7161-5847-4935-80e1-6e081be9ab77
# ç”¨æ–°çš„ uuid æŒ‚è½½
[root@study ~]# mount UUID=edfa7161-5847-4935-80e1-6e081be9ab77 /data/xfs

```

### tune2fs ä¿®æ”¹ ext4 çš„ label name ä¸ UUID

```bash
tune2fs [-l][-L label][-U uuid] è£…ç½®å

-lï¼šç±»ä¼¼ dumpe2fs -h çš„åŠŸèƒ½ï¼Œå°† superblock å†…çš„æ•°æ®è¯»å‡ºæ¥
-Lï¼šä¿®æ”¹ label name
-Uï¼šä¿®æ”¹ UUID
```

å®è·µç»ƒä¹ 

```bash
[root@study ~]# dumpe2fs -h /dev/sda5 | grep name
dumpe2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   <none>		# æ— åç§°
[root@study ~]# tune2fs -L mrcode_ext4 /dev/sda5
tune2fs 1.42.9 (28-Dec-2013)
[root@study ~]# mount LABEL=mrcode_ext4 /data/ext4
# å†æ¬¡æŸ¥çœ‹å°±æœ‰äº†
[root@study ~]# dumpe2fs -h /dev/sda5 | grep name
dumpe2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   mrcode_ext4

```

