---
title: å†…å­˜äº¤æ¢ç©ºé—´ï¼ˆswapï¼‰ä¹‹å»ºç½®
sidebarDepth: 0 
category: Tools 
tag: Linux
---


æ—©æœŸå¹´ä»£å› ä¸ºå†…å­˜ä¸è¶³ï¼Œå› æ­¤å¯ä»¥æš‚æ—¶å°†å†…å­˜çš„ç¨‹åºæ‹¿åˆ°ç¡¬ç›˜ä¸­æš‚æ”¾çš„å†…å­˜ç½®æ¢ç©ºé—´ï¼ˆswapï¼‰å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œæ‰€ä»¥ä¹‹å‰è€è§åˆ°è¯´å®‰è£… linux ä¸€å®šéœ€è¦ä¸¤ä¸ª partitionï¼Œä¸€ä¸ªæ˜¯æ ¹ç›®å½•ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ swap äº†

ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœç¡¬ä»¶èµ„æºé…ç½®è¶³å¤Ÿçš„è¯ï¼Œswap åº”è¯¥ä¸ä¼šè¢«ç³»ç»Ÿä½¿ç”¨åˆ°ã€‚ä¼šè¢«ç”¨åˆ°çš„æ—¶å€™ï¼Œé€šå¸¸å°±æ˜¯ç‰©ç†å†…å­˜ä¸è¶³çš„æƒ…å†µäº†ã€‚åœ¨ç”¨åˆ° swap æ—¶ï¼Œä½ çš„ä¸»æœºç£ç›˜ç¯å°±ä¼šå¼€å§‹é—ªä¸ªä¸åœ

ä½†æ˜¯ä½ ä¸èƒ½é¢„ä¼°ä¸ä¼šå­˜åœ¨ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µï¼Œæ‰€ä»¥é¢„ç•™ swap æ˜¯æœ‰å¿…è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šæœ‰å¤§é‡çš„ç½‘ç»œè¯·æ±‚ã€‚

å‡å¦‚ç°åœ¨æœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼šç³»ç»Ÿå·²ç»å»ºç«‹èµ·æ¥äº†ï¼Œä½†æ˜¯å´å‘ç°æ²¡æœ‰å»ºç«‹ swapï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼æ¥åš

- è®¾ç½®ä¸€ä¸ª swap partition
- å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿå†…å­˜çš„æ–‡ä»¶

## ğŸ€ ä½¿ç”¨å®ä½“åˆ†åŒºæ§½å»ºç«‹ swap

æ­¥éª¤å¦‚ä¸‹

1. åˆ†åŒºï¼šä½¿ç”¨ gdisk åœ¨ç£ç›˜ä¸­åˆ†åŒºå‡ºä¸€ä¸ªåˆ†åŒºæ§½ç»™ç³»ç»Ÿä½œä¸º swapã€‚
2. æ ¼å¼åŒ–ï¼šåˆ©ç”¨å»ºç«‹ swap æ ¼å¼çš„ ã€Œmkswap è£…ç½®æ–‡ä»¶åã€å°±èƒ½å¤Ÿæ ¼å¼åŒ–è¯¥åˆ†åŒºæ§½æˆä¸º swap æ ¼å¼
3. ä½¿ç”¨ï¼šæœ€åå°†è¯¥ swap è£…ç½®å¯åŠ¨ï¼Œæ–¹æ³•ä¸ºã€Œswapon è£…ç½®æ–‡ä»¶åã€
4. è§‚å¯Ÿï¼šé€šè¿‡ free ä¸ swapon -s æŒ‡ä»¤æ¥è§‚å¯Ÿå†…å­˜çš„ç”¨é‡

### 1. åˆ†åŒº

```bash
[root@study ~]# gdisk /dev/sda
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.

Command (? for help): n
Partition number (6-128, default 6): 
First sector (34-85491678, default = 69220352) or {+-}size{KMGTP}: 
Last sector (69220352-85491678, default = 85491678) or {+-}size{KMGTP}: +512M
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 8200

Command (? for help): p
Disk /dev/sda: 85491712 sectors, 40.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 85491678
Partitions will be aligned on 2048-sector boundaries
Total free space is 15224765 sectors (7.3 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144         2103295   1024.0 MiB  0700  
   3         2103296        65026047   30.0 GiB    8E00  
   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem
   5        67123200        69220351   1024.0 MiB  0700  Microsoft basic data
   6        69220352        70268927   512.0 MiB   8200  Linux swap

Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sda.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot.
The operation has completed successfully.

# åˆ·æ–°åˆ†åŒº
[root@study ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0 40.8G  0 disk 
â”œâ”€sda1            8:1    0    2M  0 part 
â”œâ”€sda2            8:2    0    1G  0 part /boot
â”œâ”€sda3            8:3    0   30G  0 part 
â”‚ â”œâ”€centos-root 253:0    0   10G  0 lvm  /
â”‚ â”œâ”€centos-swap 253:1    0    1G  0 lvm  [SWAP]
â”‚ â””â”€centos-home 253:2    0    5G  0 lvm  /home
â”œâ”€sda4            8:4    0    1G  0 part /data/xfs
â”œâ”€sda5            8:5    0    1G  0 part 
â””â”€sda6            8:6    0  512M  0 part   	# å‡ºç°äº†
```

### 2. å»ºç«‹ swap æ ¼å¼

```bash
[root@study ~]# mkswap /dev/sda6
æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 524284 KiB
æ— æ ‡ç­¾ï¼ŒUUID=89727d5b-a222-4878-be50-19bbb61cabb0

# ç¡®å®å¯ä»¥æŠ“åˆ°è¯¥è£…ç½®äº†
[root@study ~]# blkid /dev/sda6
/dev/sda6: UUID="89727d5b-a222-4878-be50-19bbb61cabb0" TYPE="swap" PARTLABEL="Linux swap" PARTUUID="5fff6d01-b73a-45c2-be69-8fc4a67e0788" 
```

### 3. å¼€å§‹è§‚å¯Ÿçœ‹çœ‹

```bash
[root@study ~]# free
              total        used        free      shared  buff/cache   available
Mem:        1190952      389504       83364       10916      718084      640164
Swap:       1048572           0     1048572
[root@study ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.1G        380M         81M         10M        701M        625M
Swap:          1.0G          0B        1.0G

# åˆ—å‡ºç›®å‰ä½¿ç”¨çš„ swap è£…ç½®æœ‰å“ªäº›
[root@study ~]# swapon -s
æ–‡ä»¶å                          ç±»å‹            å¤§å°    å·²ç”¨    æƒé™
/dev/dm-1                               partition       1048572 0       -2

# ä½¿ç”¨ swapon æŒ‡ä»¤æŒ‚è½½ swap åˆ†åŒºæ§½
[root@study ~]# swapon /dev/sda6
[root@study ~]# free
              total        used        free      shared  buff/cache   available
Mem:        1190952      389848       82492       10916      718612      639820
Swap:       1572856           0     1572856
[root@study ~]# swapon -s
æ–‡ä»¶å                          ç±»å‹            å¤§å°    å·²ç”¨    æƒé™
/dev/dm-1                               partition       1048572 0       -2
/dev/sda6                               partition       524284  0       -3
# å¯ä»¥çœ‹åˆ°è¿™é‡Œ sda6 è¢«ç”¨ä¸Šäº†

# å»ºç«‹æ°¸ä¹…æŒ‚è½½
nano /etc/fstab
# è¿™é‡Œæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‚è½½ç‚¹ï¼Œç¬¬äºŒä¸ªå­—æ®µå†™ swap
UUID="89727d5b-a222-4878-be50-19bbb61cabb0" swap swap defaults 0 0

```

## ğŸ€ ä½¿ç”¨æ–‡ä»¶å»ºç«‹ swap

å¦‚æœæ˜¯åœ¨å››é¢˜åˆ†åŒºæ§½æ— æ³•æ”¯æŒçš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šä¸€å°èŠ‚ä¸­æåˆ°çš„ loop è£…ç½®æ¥å»ºç«‹

```bash
[root@study ~]# dd if=/dev/zero of=/tmp/swap bs=1M count=128
è®°å½•äº†128+0 çš„è¯»å…¥
è®°å½•äº†128+0 çš„å†™å‡º
134217728å­—èŠ‚(134 MB)å·²å¤åˆ¶ï¼Œ0.0852543 ç§’ï¼Œ1.6 GB/ç§’
[root@study ~]# ll -h /tmp/swap 
-rw-r--r--. 1 root root 128M 10æœˆ 27 21:22 /tmp/swap

# æ ¼å¼åŒ–çš„æ—¶å€™ä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ï¼Œè·¯å¾„ä¸è¦é”™ï¼Œå¦åˆ™æœ‰å¯èƒ½æå®ä½ çš„æ–‡ä»¶ç³»ç»Ÿ
[root@study ~]# mkswap /tmp/swap 
æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 131068 KiB
æ— æ ‡ç­¾ï¼ŒUUID=977e598a-ff20-4be9-bc28-7792c19bfe32

[root@study ~]# swapon /tmp/swap
swapon: /tmp/swapï¼šä¸å®‰å…¨çš„æƒé™ 0644ï¼Œå»ºè®®ä½¿ç”¨ 0600ã€‚
[root@study ~]# swapon -s
æ–‡ä»¶å                          ç±»å‹            å¤§å°    å·²ç”¨    æƒé™
/dev/dm-1                               partition       1048572 0       -2
/dev/sda6                               partition       524284  0       -3
/tmp/swap                               file    131068  0       -4

# ä½¿ç”¨ swapoff æŒ‡ä»¤å…³æ‰åˆšæ‰æ‰‹åŠ¨æŒ‚è½½çš„ä¸¤ä¸ªæŒ‚è½½ç‚¹ï¼Œå¹¶é…ç½®è‡ªåŠ¨æŒ‚è½½
# å»ºç«‹æ°¸ä¹…æŒ‚è½½
nano /etc/fstab
# å¢åŠ é…ç½®
/tmp/swap swap swap defaults 0 0

# å…³é—­æ‰‹åŠ¨æŒ‚è½½çš„æŒ‚è½½ç‚¹
[root@study ~]# swapoff /dev/sda6 /tmp/swap
[root@study ~]# swapon -s
æ–‡ä»¶å                          ç±»å‹            å¤§å°    å·²ç”¨    æƒé™
/dev/dm-1                               partition       1048572 0       -2

# æ‰‹åŠ¨æŒ‚è½½æ‰€æœ‰ï¼Œå†æŸ¥çœ‹ä¸‹ï¼Œé…ç½®æ­£ç¡®
[root@study ~]# swapon -a
swapon: /tmp/swapï¼šä¸å®‰å…¨çš„æƒé™ 0644ï¼Œå»ºè®®ä½¿ç”¨ 0600ã€‚
[root@study ~]# swapon -s
æ–‡ä»¶å                          ç±»å‹            å¤§å°    å·²ç”¨    æƒé™
/dev/dm-1                               partition       1048572 0       -2
/dev/sda6                               partition       524284  0       -3
/tmp/swap                               file    131068  0       -4


```

swap ä¸»è¦åŠŸèƒ½æ˜¯å½“ç‰©ç†å†…å­˜ä¸å¤Ÿæ—¶ï¼Œåˆ™æŸäº›åœ¨å†…å­˜ä¸­æ‰€å çš„ç¨‹åºä¼šæš‚æ—¶è¢«ç§»åŠ¨åˆ° swap ä¸­ï¼Œè®©ç‰©ç†å†…å­˜å¯ä»¥è¢«éœ€è¦çš„ç¨‹åºæ¥ä½¿ç”¨ã€‚å¦å¤–ï¼Œå¦‚æœä¸»æœºæ”¯æŒç”µæºç®¡ç†æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ã€Œä¼‘çœ ã€åŠŸèƒ½çš„è¯ï¼Œè¿è¡Œä¸­çš„ç¨‹åºçŠ¶æ€åˆ™ä¼šè¢«è®°å½•åˆ° swap ä¸­å»ï¼Œä»¥ä½œä¸ºã€Œå”¤é†’ã€ä¸»æœºçš„çŠ¶æ€ä¾æ®ã€‚å¦å¤–æŸäº›ç¨‹åºä¼šåˆ©ç”¨ swap çš„ç‰¹æ€§æ¥å­˜æ”¾ä¸€äº›æ•°æ®ï¼Œæ‰€ä»¥ swap éœ€è¦å»ºç«‹ï¼Œåªæ˜¯ä¸éœ€è¦å¤ªå¤§