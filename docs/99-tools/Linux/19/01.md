---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# Linux çš„å¼€æœºæµç¨‹åˆ†æ

ä¸ºä»€ä¹ˆè¦äº†è§£å¼€æœºæµç¨‹ï¼Ÿä¸‹é¢åˆå‡ ä¸ªå¸¸è§çš„åœºæ™¯ï¼š

- å¦‚æœæƒ³å¤šé‡å¼•å¯¼ï¼Œæ€ä¹ˆå®‰å…¨ç³»ç»Ÿï¼Ÿ
- å¦‚æœä½ çš„ root å¯†ç å¿˜è®°äº†ï¼Œå¦‚ä½•æ•‘æ´ï¼Ÿ
- å¦‚æœä½ çš„é»˜è®¤ç™»å½•æ¨¡å¼ä¸ºå›¾å½¢ç•Œé¢ï¼Œå¦‚æœåœ¨å¼€æœºæ—¶ç›´æ¥æŒ‡å®šè¿›å…¥çº¯æ–‡æœ¬æ¨¡å¼ï¼Ÿ
- å¦‚æœå› ä¸º `/etc/fstab` è®¾ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•é¡ºåˆ©æŒ‚è½½æ ¹ç›®å½•ï¼Œå¦‚ä½•ä¿®å¤ `/etc/fstab` æ–‡ä»¶ï¼Ÿ

ç¬”è€…å½“æ—¶å…¶å®å°±å› ä¸º fstab æ–‡ä»¶é…ç½®é”™è¯¯ï¼Œå¯¼è‡´å¼€æœºè¿›å…¥ä¸äº†ç³»ç»Ÿçš„é—®é¢˜ï¼Œå½“æ—¶é€šè¿‡ç¬¬ 3 ç« ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œè¿˜å¥½æ•‘æ´å›æ¥äº†ã€‚å¯è§æ˜¯çœŸçš„å¾ˆé‡è¦

## ğŸ€ å¼€æœºæµç¨‹ä¸€è§ˆ

å¼€æœºç®¡ç†ç¨‹åºï¼ˆBoot Loaderï¼‰ï¼Œç”±äºå„å¤§ Linux distribution çš„ä¸»æµä¸º grub2ï¼Œä¸‹é¢å°±ä»¥å®ƒä¸ºä¸»è®²è§£

ç®€å•æ¥è¯´ï¼Œç³»ç»Ÿå¼€æœºçš„ç»è¿‡å¯ä»¥æ€»ç»“å¦‚ä¸‹çš„æµç¨‹ï¼š

1. åŠ è½½ BISO çš„ç¡¬ä»¶ä¿¡æ¯ä¸è¿›è¡Œè‡ªæˆ‘æµ‹è¯•ï¼Œå¹¶æ ¹æ®è®¾ç½®è·å¾—ç¬¬ä¸€ä¸ªå¯å¼€æœºçš„è®¾å¤‡

2. è¯»å–å¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªå¼€æœºè®¾å¤‡å†… MBR çš„ boot Loaderï¼ˆgrub2ã€spfdisk ç­‰ç¨‹åºï¼‰

3. æ ¹æ® boot loader çš„è®¾ç½®åŠ è½½ Kernelï¼ŒKernel ä¼šå¼€å§‹æ£€æµ‹ç¡¬ä»¶ä¸åŠ è½½é©±åŠ¨ç¨‹åº

4. åœ¨ç¡¬ä»¶é©±åŠ¨æˆåŠŸåï¼ŒKernel ä¼šè°ƒç”¨ systemd ç¨‹åºï¼Œå¹¶ä»¥ default.target çš„æµç¨‹å¼€æœºï¼š

   - systemd æ‰§è¡Œ sysinit.target åˆå§‹ç³»ç»Ÿä»¥åŠ bashic.target å‡†å¤‡æ“ä½œç³»ç»Ÿ

   - systemd å¯åŠ¨ multi-user.target ä¸‹çš„æœ¬æœºä¸æœåŠ¡å™¨æœåŠ¡

   - systemd æ‰§è¡Œ multi-user.target ä¸‹çš„`/etc/rc.d/rc.local` æ–‡ä»¶
   - systemd æ‰§è¡Œ multi-user.target ä¸‹çš„ `getty.target` åŠç™»å½•æœåŠ¡
   - systemd æ‰§è¡Œ graphical éœ€è¦çš„æœåŠ¡

å¤§æ¦‚æµç¨‹å¦‚ä¸Šï¼Œä¼šå‘ç° systemd ç¨‹åºå æ¯”éå¸¸é‡ï¼Œä¸‹é¢æ¥è°ˆè°ˆå„ä¸ªç¨‹åºçš„ä¸»è¦å†…å®¹æ˜¯ä»€ä¹ˆ

## ğŸ€ BIOSã€boot loader ä¸ kernel è½½å…¥

åœ¨ç¬¬ 2 ç« ä¸­ç®€å•çš„è®²è§£è¿‡å¼€æœºæµç¨‹ä¸ MBR çš„åŠŸèƒ½ï¼Œä»¥åŠå¤§å®¹é‡ç£ç›˜éœ€è¦ä½¿ç”¨ GPT åˆ†åŒºæ ¼å¼ç­‰ã€‚è¿™é‡ŒåªæŠŠåç»­ä¼šç”¨åˆ°çš„éƒ¨åˆ†ä¸“æœ‰åè¯ç»¼åˆè§£é‡Šï¼š

- BIOSï¼šæ— è®ºä¼ ç»Ÿ BIOS è¿˜æ˜¯ UEFI BIOS ç»Ÿç§° BIOS
- MBRï¼šåˆ†åŒºè¡¨æœ‰ä¼ ç»Ÿ MBR å’Œæ–°å¼ GPTï¼ŒGPT ä¹Ÿä¿ç•™ä¸€å—å…¼å®¹ MBR çš„åŒºå—ï¼Œå› æ­¤åç»­çš„è¯´æ˜åœ¨å®‰è£… boot loader çš„éƒ¨åˆ†ï¼Œéƒ½ç®€ç§° MBRï¼Œæ€»ä¹‹ï¼Œ MBR å°±ä»£è¡¨è¯¥ç£ç›˜æœ€å‰é¢å¯å®‰è£… boot loader çš„å“ªä¸ªåŒºå—

### BIOS å¼€æœºè‡ªæˆ‘æµ‹è¯•ä¸ MBR/GPT

BIOSï¼šåœ¨ç¬¬ 0 ç« çš„è®¡ç®—æœºæ¦‚è®ºä¸­è°ˆè¿‡ï¼Œåœ¨ä¸ªäººè®¡ç®—æœºæ¶æ„ä¸‹ï¼Œè¦å¯åŠ¨æ•´éƒ¨ç³»ç»Ÿï¼Œéœ€è¦è®©ç³»ç»Ÿå»åŠ è½½ BIOS ï¼ˆBasic Output Systemï¼‰ï¼Œå¹¶é€šè¿‡ BIOS ç¨‹åºä¸åŠ è½½ CMOS çš„ä¿¡æ¯ï¼Œè·å– CMOS å†…çš„è®¾ç½®å–å¾—ä¸»æœºçš„å„é¡¹ç¡¬ä»¶é…ç½®ï¼Œä¾‹å¦‚ CPU ä¸æ¥å£è®¾å¤‡çš„æ²Ÿé€šé¢‘ç‡ã€å¼€æœºè®¾å¤‡çš„æœç´¢é¡ºåºã€ç¡¬ç›˜çš„å¤§å°ã€ç³»ç»Ÿæ—¶é—´ã€å„å‘¨è¾¹æ€»çº¿æ˜¯å¦å¯åŠ¨ Plug and Play ï¼ˆPnP å³æ’å³ç”¨è®¾å¤‡ï¼‰ç­‰ä¿¡æ¯

å¼€æœºè‡ªæˆ‘æµ‹è¯•ï¼šBIOS å–å¾—ä¸Šè¿°ä¿¡æ¯åï¼Œä¼šè¿›è¡Œå¼€æœºè‡ªæˆ‘æµ‹è¯•ï¼ˆPower-on Self Testï¼Œç®€ç§° POSTï¼‰ã€‚ç„¶åæ‰§è¡Œç¡¬ä»¶æ£€æµ‹åˆå§‹åŒ–ï¼Œå¹¶è®¾ç½® PnP è£…ç½®ï¼Œä¹‹åå†å®šä¹‰å‡ºå¯å¼€æœºçš„è®¾å¤‡é¡ºåºï¼Œæ¥ä¸‹æ¥ä¼šå¼€å§‹è¿›è¡Œå¼€æœºè®¾å¤‡çš„æ•°æ®è¯»å–

MBRï¼šç³»ç»Ÿè½¯ä»¶å¤§å¤šæ”¾ç½®åœ¨ç¡¬ç›˜ä¸­ï¼Œæ‰€ä»¥ BIOS ä¼šæŒ‡å®šå¼€æœºçš„è®¾å¤‡è®©æˆ‘ä»¬å¯ä»¥è¯»å–ç£ç›˜ä¸­çš„æ“ä½œç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶ï¼Œä½†æ˜¯ç”±äºä¸åŒçš„æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ä¸åŒï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªå¼€æœºç®¡ç†ç¨‹åºæ¥å¤„ç†æ ¸å¿ƒæ–‡ä»¶åŠ è½½ ï¼ˆloadï¼‰çš„é—®é¢˜ï¼Œå› æ­¤æ•´ä¸ª **å¼€æœºç®¡ç†ç¨‹åºè¢«ç§°ä¸º Boot Loader **ï¼ŒBoot Loader ç¨‹åºå®‰è£…åœ¨å¼€æœºè®¾å¤‡çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼ˆsectorï¼‰å†…ï¼Œæ•´ä¸ªæ‰‡åŒºä¹Ÿç§°ä¸º **MBRï¼ˆMaster Boot Recordï¼‰** ä¸»è¦å¯åŠ¨è®°å½•åŒº

æ¯ä¸ªæ“ä½œç³»ç»Ÿçš„ loader éƒ½å¯èƒ½ä¸åŒï¼ŒBIOS é€šè¿‡ç¡¬ä»¶çš„ INT 13 ä¸­æ–­åŠŸèƒ½æ¥è¯»å– MBR çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ BIOS èƒ½å¤Ÿæ£€æµ‹åˆ°ä½ çš„ç¡¬ç›˜ï¼ˆä¸è®ºè¯¥ç£ç›˜æ˜¯ SATA è¿˜æ˜¯ SAS æ¥å£ï¼‰ï¼Œå®ƒå°±æœ‰åŠæ³•é€šè¿‡ INT 13 è¿™ä¸ªä¿¡é“æ¥è¯»å–è¯¥ç£ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºå†…çš„ MBR è½¯ä»¶

æ³¨æ„ï¼šå¦‚æœç³»ç»Ÿä¸­æœ‰ä¸¤å—ç¡¬ç›˜ï¼Œé‚£ä¹ˆæŸ¥æ‰¾çš„æ˜¯ç¬¬ä¸€å¯åŠ¨è®¾å¤‡ä¸­çš„ MBR

### Boot Loader åŠŸèƒ½

Loader æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯è®¤è¯†æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ ¼å¼å¹¶æ ¹æ®åŠ è½½æ ¸å¿ƒåˆ°ä¸»å­˜å‚¨å™¨å»æ‰§è¡Œã€‚ç”±äºä¸åŒæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ ¼å¼ä¸ä¸€è‡´ï¼Œå› æ­¤æ¯ç§æ“ä½œç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„ boot loaderã€‚

é‚£ä¹ˆå¤šé‡æ“ä½œç³»ç»Ÿï¼šå°±æ˜¯åœ¨ä¸ä¸€éƒ¨è¿½ä¸Šå®‰è£…å¤šä¸­ä¸åŒçš„æ“ä½œç³»ç»Ÿ

1. å¿…é¡»è¦ä½¿ç”¨è‡ªå·±çš„ loader æ‰èƒ½å¤ŸåŠ è½½å±äºè‡ªå·±çš„æ“ä½œç³»ç»Ÿæ ¸å¿ƒ
2. ä½†æ˜¯ç³»ç»Ÿçš„ MBR åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆæ€ä¹ˆèƒ½è®©åŒä¸€å°ä¸»æœºä¸Šå®‰è£… windows ä¸ Linux å‘¢ï¼Ÿ

è¿™ä¸ªé—®é¢˜åœ¨ç¬¬ 7 ç« çš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰ä»‹ç»åˆ°è¿‡ã€‚æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆfilesystem æˆ– partitionï¼‰éƒ½ä¼šä¿ç•™ä¸€å—å¯åŠ¨æ‰‡åŒºï¼ˆboot sectorï¼‰æä¾›æ“ä½œç³»ç»Ÿå®‰è£… boot loaderï¼Œé€šå¸¸æ“ä½œç³»ç»Ÿé»˜è®¤ä¼šå®‰è£…ä¸€ä»½ loader åˆ°å®ƒæ ¹ç›®å½•æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿçš„ boot sector ä¸Šã€‚

å¦‚æœåœ¨ä¸€å°ä¸»æœºä¸Šå®‰è£… Windows ä¸ Linux åï¼Œboot sectorã€boot loader ä¸ MBR çš„ç›¸å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º

![image-20200323222234528](./assets/image-20200323222234528.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿé»˜è®¤ä¼šå®‰è£…ä¸€å¥— boot loader åˆ°ä»–è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆå·¦ä¸‹è§’çš„è“è‰²åŒºåŸŸï¼‰ï¼š

- Linux ç³»ç»Ÿï¼šå®‰è£…æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹© boot loader å®‰è£…åˆ° MBR ä¸Šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸å®‰è£…ã€‚å¦‚æœé€‰æ‹©å®‰è£…åˆ° MBR çš„è¯ï¼Œç†è®ºä¸Šä½ å† MBR ä¸ boot sector éƒ½ä¼šæœ‰ä¸€ä»½ boot loader ç¨‹åºã€‚
- Windowsï¼šå®‰è£…æ—¶ï¼Œå®ƒé»˜è®¤ä¸»åŠ¨çš„å°† MBR  ä¸ boot sector éƒ½è£…ä¸Šä¸€ä»½ boot loader

æ‰€ä»¥ä¼šå‘ç°å®‰è£…å¤šé‡æ“ä½œç³»ç»Ÿæ—¶ï¼Œä½ çš„ MBR å¸¸å¸¸ä¼šè¢«ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„ boot loader æ‰€è¦†ç›–ã€‚

é‚£ä¹ˆæ€ä¹ˆè§£å†³å¤šé‡æ“ä½œç³»ç»Ÿçš„é—®é¢˜å‘¢ï¼Ÿåœ¨ç¬¬ 2 ç« ä¸­æåˆ°è¿‡ï¼Œboot loader çš„åŠŸèƒ½

- æä¾›é€‰å•ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„å¼€æœºé¡¹ç›®ï¼Œè¿™ä¹Ÿæ˜¯å¤šé‡å¼•å¯¼çš„é‡è¦åŠŸèƒ½
- è½½å…¥æ ¸å¿ƒæ–‡ä»¶ï¼šç›´æ¥æ‰§è¡Œå¯å¼€æœºçš„ç¨‹åºåŒºæ®µæ¥å¼€å§‹æ“ä½œç³»ç»Ÿ
- è½¬äº¤å…¶ä»– loaderï¼šå°†å¼€æœºç®¡ç†åŠŸèƒ½è½¬äº¤ç»™å…¶ä»– loader è´Ÿè´£

ç”±äºå…·æœ‰é€‰å•åŠŸèƒ½ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„æ ¸å¿ƒæ¥å¼€æœºã€‚ç”±äºå…·æœ‰æ§åˆ¶æƒé™è½¬äº¤åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥åŠ è½½å…¶ä»– boot sector å†…çš„ loaderã€‚ä½†æ˜¯ Windows çš„ loader é¢„è®¾ä¸å…·æœ‰æ§åˆ¶è½¬äº¤çš„åŠŸèƒ½ï¼Œå› æ­¤ä½ ä¸èƒ½ä½¿ç”¨ Windows çš„ loader æ¥åŠ è½½ Linux çš„ loaderã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒ **å…ˆè£… windowsï¼Œå†è£… Linux** çš„ç¼˜æ•…ã€‚

ä¸Šè¿°ä¸‰ä¸ªåŠŸèƒ½å›¾ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20200323223119255](./assets/image-20200323223119255.png)

ä¸Šå›¾ï¼ŒMBR ä½¿ç”¨ Linux çš„ grub2 å¼€æœºç®¡ç†ç¨‹åºï¼Œå¹¶ä¸”è®¾ç½®äº† 3 ä¸ªé€‰å•ï¼š

- é€‰å• 1ï¼šMBRï¼ˆgrub2ï¼‰ -> kernel file -> booting
- é€‰å• 2ï¼šMBRï¼ˆgrub2ï¼‰ -> boot sectorï¼ˆWindows loaderï¼‰ -> Windows kernel -> booting
- é€‰å• 3ï¼šMBRï¼ˆgrub2ï¼‰ -> boot sectorï¼ˆgrub2ï¼‰-> kernel file -> booting

### åŠ è½½æ ¸å¿ƒæ£€æŸ¥ç¡¬ä»¶ä¸ initramfs åŠŸèƒ½

é€šè¿‡ boot loader çš„ç®¡ç†è€Œå¼€å§‹è¯»å–æ ¸å¿ƒæ–‡ä»¶åï¼ŒåŠ ä¸‹æ¥ï¼ŒLinux ä¼šå°†æ ¸å¿ƒè§£å‹åˆ°ä¸»å­˜å‚¨å™¨ä¸­ï¼Œå¹¶åˆ©ç”¨æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œå¼€å§‹æµ‹è¯•ä¸é©±åŠ¨å„ä¸ªå‘¨è¾¹è®¾å¤‡ï¼ŒåŒ…æ‹¬å­˜å‚¨è®¾å¤‡ã€CPUã€ç½‘å¡ã€å£°å¡ç­‰ã€‚

**æ­¤æ—¶ Linux æ ¸å¿ƒä¼šä»¥è‡ªå·±çš„åŠŸèƒ½é‡æ–°æ£€æŸ¥ä¸€æ¬¡ç¡¬ä»¶ï¼Œè€Œä¸ä¸€å®šä¼šä½¿ç”¨ BIOS æ£€æµ‹åˆ°çš„ç¡¬ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¸å¿ƒæ­¤æ—¶æ‰å¼€å§‹æ¥ç®¡ BIOS åçš„å·¥ä½œ **ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ¸å¿ƒæ–‡ä»¶ä¼šæ”¾åˆ° `/boot` ä¸­ï¼Œå¹¶å–åä¸º `/boot/vmlinuz`

```bash
[root@study ~]# ls --format=single-column -F /boot
config-3.10.0-1062.el7.x86_64																# æ­¤ç‰ˆæœ¬æ ¸å¿ƒè¢«ç¼–è¯‘æ—¶é€‰æ‹©çš„åŠŸèƒ½ä¸æ¨¡å—é…ç½®æ–‡ä»¶
efi/																												# ä¹¦ä¸Šæ²¡æœ‰è¿™ä¸ª
grub/																												# æ—§ç‰ˆ grub1ï¼Œä¸ç”¨ç®¡
grub2/																											# å¼€æœºç®¡ç†ç¨‹åº grub2 çš„ç›®å½•
initramfs-0-rescue-f228ab37c368416c84c6b27971ba45a9.img			# è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æ•‘æ´çš„
initramfs-3.10.0-1062.el7.x86_64.img												# æ­£å¸¸å¼€æœºä¼šç”¨åˆ°çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
initramfs-3.10.0-1062.el7.x86_64kdump.img										# æ ¸å¿ƒå‡ºé—®é¢˜æ—¶ä¼šç”¨åˆ°çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼›ç¬”è€…è¿™é‡Œæ²¡æœ‰çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶
System.map-3.10.0-1062.el7.x86_64														# æ ¸å¿ƒåŠŸèƒ½æ”¾åˆ°å†…å­˜åœ°å€çš„å¯¹åº”è¡¨
symvers-3.10.0-1062.el7.x86_64.gz														# ä¹¦ä¸Šæ²¡æœ‰è¿™ä¸ª
vmlinuz-0-rescue-f228ab37c368416c84c6b27971ba45a9*					# æ•‘æ´ç”¨çš„æ ¸å¿ƒæ–‡ä»¶
vmlinuz-3.10.0-1062.el7.x86_64*															# æ ¸å¿ƒæ–‡ä»¶ï¼Œæœ€é‡è¦çš„
testing.img																									# ä¹¦ä¸Šæ²¡æœ‰è¿™ä¸ª
```

ä¸Šé¢å¯çŸ¥é“ CentOS 7.x çš„ Linux æ ¸å¿ƒä¸º 3.10.0-1062.el7.x86_64 ç‰ˆæœ¬ã€‚ä¸ºäº†ç¡¬ä»¶å¼€å‘å•†ä¸å…¶ä»–æ ¸å¿ƒåŠŸèƒ½å¼€å‘è€…çš„ä¾¿åˆ©ï¼Œå› æ­¤ Linux æ ¸å¿ƒæ˜¯å¯ä»¥é€šè¿‡åŠ¨æ€åŠ è½½æ ¸å¿ƒæ¨¡å—çš„ï¼ˆå¯æƒ³è±¡æˆé©±åŠ¨ç¨‹åºï¼‰ï¼Œè¿™äº›æ ¸å¿ƒæ¨¡å—æ”¾åœ¨ `/lib/modules/` ç›®å½•å†…ã€‚

**ç”±äºæ¨¡å—æ”¾ç½®åˆ°ç£ç›˜æ ¹ç›®å½•å†…ï¼ˆè®°å¾— /lib  ä¸å¯ä»¥ä¸ /  åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„ partitionï¼‰ï¼ï¼Œå› æ­¤åœ¨å¼€æœºçš„è¿‡ç¨‹ä¸­æ ¸å¿ƒå¿…é¡»è¦æŒ‚è½½æ ¹ç›®å½•ï¼Œè¿™æ ·æ‰èƒ½è¯»å–æ ¸å¿ƒæ¨¡å—æä¾›ä»·å€¼é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½**ã€‚è€Œä¸”ä¸ºäº†æ‹…å¿ƒå½±å“åˆ°ç£ç›˜å†…çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å¼€æœºè¿‡ç¨‹ä¸­æ ¹ç›®å½•æ˜¯åªè¯»æ–¹å¼æ¥æŒ‚è½½çš„

ä¸€èˆ¬æ¥è¯´ï¼Œéå¿…è¦çš„åŠŸèƒ½ä¸”å¯ä»¥ç¼–è¯‘æˆæ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç›®å‰çš„ Linux distribution éƒ½ä¼šå°†å®ƒç¼–è¯‘æˆæ¨¡å—ã€‚å› æ­¤ USBã€SATAã€SCSI ç­‰ç£ç›˜è®¾å¤‡çš„é©±åŠ¨ç¨‹åºé€šå¸¸éƒ½æ˜¯ä»¥æ¨¡å—çš„æ–¹å¼å­˜åœ¨çš„ã€‚

è€ƒè™‘ä¸€ç§æƒ…å†µï¼šä½ çš„ Linux æ˜¯å®‰è£…åœ¨ SATA ç£ç›˜ä¸Šé¢çš„ï¼Œå¯ä»¥é€šè¿‡ BIOS çš„ INT 13 è·å– boot loader ä¸ kernel æ–‡ä»¶æ¥å¼€æœºï¼Œç„¶å kernel ä¼šå¼€å§‹æ¥ç®¡ç³»ç»Ÿå¹¶ä¸”æ£€æŸ¥ç¡¬ä»¶åŠé•¿æ²™æŒ‚è½½æ ¹ç›®å½•æ¥è·å–é¢å¤–çš„é©±åŠ¨ç¨‹åº

é—®é¢˜æ˜¯ï¼š**æ ¸å¿ƒæ ¹æœ¬ä¸è®¤è¯† SATA ç£ç›˜**ï¼Œæ‰€ä»¥éœ€è¦åŠ è½½ SATA ç£ç›˜çš„é©±åŠ¨ç¨‹åºï¼Œå¦åˆ™æ ¹æœ¬æ— æ³•æŒ‚è½½æ ¹ç›®å½•ã€‚ä½†æ˜¯ SATA çš„é©±åŠ¨ç¨‹åºåœ¨ `/lib/modules` å†…ï¼Œä½ æ ¹æœ¬æ— æ³•æŒ‚è½½æ ¹ç›®å½•ï¼Œå°±æ²¡æ³•è¯»å–åˆ° SATA çš„é©±åŠ¨ç¨‹åºã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒLInux æ˜¯æ— æ³•é¡ºåˆ©å¼€æœºçš„ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å¤„ç†è¿™ä¸ªé—®é¢˜

**è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆInitial RAM Disk æˆ– Initial RAM Filesystemï¼‰** ä¸€èˆ¬ä½¿ç”¨ `/boot/initrd` æˆ– `/boot/initramfs`ï¼Œè¯¥æ–‡ä»¶ç‰¹ç‚¹æ˜¯ï¼Œå®ƒä¹Ÿå¯ä»¥é€šè¿‡ boot loader æ¥åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¯¥æ–‡ä»¶ä¼šè¢«è§£å‹ç¼©å¹¶ä¸”åœ¨å†…å­˜ä¸­ **ä»¿çœŸæˆä¸€ä¸ªæ ¹ç›®å½•**ï¼Œä¸”æ­¤ä»¿çœŸåœ¨å†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿæä¾›ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºï¼Œé€šè¿‡è¯¥ç¨‹åºæ¥ **åŠ è½½å¼€æœºè¿‡ç¨‹ä¸­æ‰€æœ€éœ€è¦çš„æ ¸å¿ƒæ¨¡å—**ï¼Œç­‰è½½å…¥å®Œæˆåï¼Œä¼šå¸®åŠ©æ ¸å¿ƒé‡æ–°è°ƒç”¨ systemd æ¥å¼€å§‹åç»­çš„æ­£å¸¸å¼€æœºæµç¨‹

BIOS ä¸ boot loader ã€æ ¸å¿ƒåŠ è½½æµç¨‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![image-20200323225642529](./assets/image-20200323225642529.png)

å¦‚å›¾æ‰€ç¤ºï¼šboot loader å¯ä»¥åŠ è½½ kernel ä¸ initramfsï¼Œåœ¨å†…å­˜ä¸­è®© initramfs è§£å‹ç¼©æˆä¸ºæ ¹ç›®å½•ï¼Œkernel å€Ÿæ­¤åŠ è½½é€‚å½“çš„é©±åŠ¨ç¨‹åºï¼Œæœ€ç»ˆé‡Šæ”¾è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æŒ‚è½½å®é™…çš„æ ¹ç›®å½•æ–‡ä»¶ç³»ç»Ÿï¼Œå°±å¯ä»¥å¼€å§‹åç»­çš„æ­£å¸¸å¼€æœºæµç¨‹äº†

ä¸‹é¢æ¥äº†è§£ä¸‹ CentOS 7.x çš„ initramfs æ–‡ä»¶å†…å®¹

```bash
# 1. ç›´æ¥çœ‹ initramfs é‡Œçš„å†…å®¹æœ‰å“ªäº›
[root@study ~]# lsinitrd /boot/initramfs-3.10.0-1062.el7.x86_64.img 
Image: /boot/initramfs-3.10.0-1062.el7.x86_64.img: 31M
========================================================================
è¿™ä¸€éƒ¨åˆ†æ•°æ®ç¬”è€…å¹¶æ²¡æœ‰çœ‹åˆ°æœ‰
Early CPIO image
kernel  kernel/x86
========================================================================

========================================================================
Version: dracut-033-564.el7

Arguments: -f

# å¼€å§‹ä¸€å †æ¨¡å—çš„åŠ è½½è¡Œä¸º
dracut modules:
bash
nss-softokn
...
========================================================================
drwxr-xr-x  12 root     root            0 Oct  4 18:31 .
crw-r--r--   1 root     root       5,   1 Oct  4 18:31 dev/console
crw-r--r--   1 root     root       1,  11 Oct  4 18:31 dev/kmsg
crw-r--r--   1 root     root       1,   3 Oct  4 18:31 dev/null
lrwxrwxrwx   1 root     root            7 Oct  4 18:31 bin -> usr/bin
...
-rwxr-xr-x   1 root     root      1624552 Oct  4 18:31 usr/lib/systemd/systemd
...
-rw-r--r--   1 root     root         1377 Sep  7  2017 usr/share/terminfo/v/vt220
drwxr-xr-x   2 root     root            0 Oct  4 18:31 var
lrwxrwxrwx   1 root     root           11 Oct  4 18:31 var/lock -> ../run/lock
lrwxrwxrwx   1 root     root            6 Oct  4 18:31 var/run -> ../run
========================================================================
# æœ€ååˆ™ä¼šåˆ—å‡ºè¿™ä¸ª initramfs é‡Œæ‰€æœ‰çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ–‡ä»¶å¤§æ¦‚å­˜å‚¨ä¸¤éƒ¨åˆ†å†…å®¹
# 1. æœ€å‰é¢æ ¸å¿ƒæ–‡ä»¶ # ç¬”è€…è¿™ä¸ªé‡Œé¢æ²¡æœ‰è¿™äº›æ•°æ®
# 2. è¢«æ ¸å¿ƒå–ç”¨çš„å…¨éƒ¨é™„åŠ çš„æ–‡ä»¶æ•°æ®
```

ä¸‹é¢è§£å‹ä¸‹è¯¥ img çš„æ–‡ä»¶ï¼Œæ¥çœ‹çœ‹é‡Œé¢çš„æ–‡ä»¶å†…å®¹

æç¤ºï¼šç¬”è€…æœºå™¨ä¸Šä¸ä¹¦ä¸Šä¸€éƒ¨åˆ†å¯¹ä¸ä¸Šï¼Œæ‰€ä»¥æš‚æ—¶ä¸ç¡®å®šæ˜¯å¦èƒ½æ­£å¸¸è§£å‹

```bash
[root@study ~]# mkdir /tmp/initramfs
[root@study ~]# cd /tmp/initramfs
[root@study initramfs]# ll /boot/
total 135200
...
-rw-------. 1 root root 31799826 Oct  4 18:32 initramfs-3.10.0-1062.el7.x86_64.img
...
# 1. è·³è¿‡éƒ¨åˆ†æ–‡ä»¶ï¼Œè¿™ä¸€æ­¥ä¸è·³è¿‡å¯ä»¥çœç•¥ï¼Œç›´æ¥å¤åˆ¶åŸæ¥çš„æ–‡ä»¶å°±å¯ä»¥
# æˆ‘è¿™é‡Œæ²¡æœ‰è·³è¿‡æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° 31799826 å’Œä¸Šé¢çš„æ–‡ä»¶å¤§å°æ˜¯ä¸€æ ·çš„
# ä¹¦ä¸Šæ˜¯åœ¨ä¸‹é¢çš„æŒ‡ä»¤åé¢å†™äº† skip 1; è·³è¿‡äº†ä¸€ä¸ª 11264 çš„å—ï¼Œä½†æ˜¯ä½œè€…æ€ä¹ˆçŸ¥é“è¿™ä¸ªå¤§å°æ˜¯ä»–éœ€è¦è·³è¿‡çš„æ–‡ä»¶å¤§å°å‘¢ï¼Ÿ
[root@study initramfs]# dd if=/boot/initramfs-3.10.0-1062.el7.x86_64.img of=initramfs.gz bs=11264       
2823+1 records in
2823+1 records out
31799826 bytes (32 MB) copied, 0.0366742 s, 867 MB/s
[root@study initramfs]# ll initramfs.gz; file initramfs.gz 
-rw-r--r--. 1 root root 31799826 Mar 24 21:54 initramfs.gz
initramfs.gz: gzip compressed data, from Unix, last modified: Fri Oct  4 18:31:46 2019, max compression
# dd è¯­æ³•è¿˜å¯ä»¥ç›´æ¥å†™ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Ÿè¿˜æœ‰è¿™ç§ç¥å¥‡çš„ç”¨æ³•ï¼Ÿ
# ä¸Šé¢å’Œä¸‹é¢éƒ½ç”¨åˆ°äº† fileï¼Œå› æ­¤ç¬”è€…çŒœæƒ³ï¼Œä¸Šé¢ä½¿ç”¨ dd çº¯ç²¹æ˜¯ä¸ºäº†è·³è¿‡æŸäº›æ–‡ä»¶ç½¢äº†
# å®é™…ä¸Š img æ˜¯ä¸€ä¸ª gizp çš„å‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥ä»ä¸‹é¢çš„ç»“æœçœ‹å‡ºæ¥
[root@study initramfs]# file /boot/initramfs-3.10.0-1062.el7.x86_64.img 
/boot/initramfs-3.10.0-1062.el7.x86_64.img: gzip compressed data, from Unix, last modified: Fri Oct  4 18:31:46 2019, max compression
# çš„ç¡®æ˜¾ç¤ºæ˜¯ gzip æ–‡ä»¶

# 2. ä»æ–‡ä»¶æ¥çœ‹ï¼Œæ˜¯ä¸€ä¸ª gz æ–‡ä»¶ï¼Œè§£å‹è¯¥å‹ç¼©æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹
[root@study initramfs]# gzip -d initramfs.gz 
[root@study initramfs]# file initramfs 
initramfs: ASCII cpio archive (SVR4 with no CRC)

# 3. è§£å‹ä¹‹åï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ª cpio çš„æ–‡ä»¶
# ä½¿ç”¨ cpio æ¥è§£å‹ï¼Œå¹¶ä¸”ä¸è¦ç»å¯¹è·¯å¾„æ˜¯æœ€ä¿é™©çš„
[root@study initramfs]# cpio -i -H newc --no-absolute-filenames < initramfs 
128695 blocks
[root@study initramfs]# ll
total 64356
lrwxrwxrwx.  1 root root        7 Mar 24 22:05 bin -> usr/bin
drwxr-xr-x.  2 root root       45 Mar 24 22:05 dev
drwxr-xr-x. 12 root root     4096 Mar 24 22:05 etc
lrwxrwxrwx.  1 root root       23 Mar 24 22:05 init -> usr/lib/systemd/systemd
-rw-r--r--.  1 root root 65891840 Mar 24 21:54 initramfs
lrwxrwxrwx.  1 root root        7 Mar 24 22:05 lib -> usr/lib
lrwxrwxrwx.  1 root root        9 Mar 24 22:05 lib64 -> usr/lib64
drwxr-xr-x.  2 root root        6 Mar 24 22:05 proc
drwxr-xr-x.  2 root root        6 Mar 24 22:05 root
drwxr-xr-x.  2 root root        6 Mar 24 22:05 run
lrwxrwxrwx.  1 root root        8 Mar 24 22:05 sbin -> usr/sbin
-rwxr-xr-x.  1 root root     3117 Mar 24 22:05 shutdown
drwxr-xr-x.  2 root root        6 Mar 24 22:05 sys
drwxr-xr-x.  2 root root        6 Mar 24 22:05 sysroot
drwxr-xr-x.  2 root root        6 Mar 24 22:05 tmp
drwxr-xr-x.  7 root root       66 Mar 24 22:05 usr
drwxr-xr-x.  2 root root       29 Mar 24 22:05 var
# å¯ä»¥çœ‹åˆ°ä¸Šé¢å‡ ä¹å°±åƒæ˜¯ä¸€ä¸ªå°å‹çš„æ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ï¼Œè¿™æ ·å°±èƒ½è®© kernel å»æŒ‚è½½äº†

# 4. å†æ¥çœ‹ä¸‹ï¼Œå°å‹æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œsystemd æ˜¯ä½¿ç”¨å“ªä¸€ä¸ª target æ¥æ‰§è¡Œå¼€æœºå‘¢ï¼Ÿ
[root@study initramfs]# ll usr/lib/systemd/system/default.target 
lrwxrwxrwx. 1 root root 13 Mar 24 22:05 usr/lib/systemd/system/default.target -> initrd.target

# 5. æœ€ç»ˆï¼Œçœ‹çœ‹ç³»ç»Ÿå†…é»˜è®¤çš„ initrd.target ç›¸ä¾çš„æ‰€æœ‰æœåŠ¡æ•°æ®
[root@study initramfs]# systemctl list-dependencies initrd.target 
initrd.target
* |-dracut-cmdline.service
....
* |-basic.target
* | |-microcode.service
* | |-rhel-dmesg.service
* | |-selinux-policy-migrate-local-changes@targeted.service
* | |-paths.target
* | |-slices.target
* | | |--.slice
* | | `-system.slice
* | |-sockets.target
* | | |-avahi-daemon.socket
...
* | |-sysinit.target
* | | |-dev-hugepages.mount
...
* | | |-local-fs.target
* | | | |--.mount
* | | | |-boot.mount
* | | | |-home.mount
* | | | |-rhel-readonly.service
* | | | `-systemd-remount-fs.service
...
* | | `-swap.target
* | |   `-dev-mapper-centos\x2dswap.swap
* | `-timers.target
* |   |-systemd-tmpfiles-clean.timer
* |   `-unbound-anchor.timer
* |-initrd-fs.target
* `-initrd-root-fs.target

# é€šè¿‡ systemd çš„æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„å°†æ‰€æœ‰çš„æ£€æŸ¥ä¸æœåŠ¡ä»·å€¼ç³»ç»Ÿä¸­
```

é€šè¿‡ä¸Šé¢è§£å¼€ initramfs çš„ç»“æœï¼Œå…¶å®å®ƒå°±æ˜¯ä¸€ä¸ªå°å‹çš„æ ¹ç›®å½•ï¼Œè€Œä¸”ä¹Ÿæ˜¯é€šè¿‡ systemd æ¥è¿›è¡Œç®¡ç†ï¼ŒåŒæ—¶è§‚å¯Ÿ default.target çš„é“¾æ¥åˆ°äº† initrd.target ï¼Œå°±æ˜¯é€šè¿‡å®ƒæ¥å¼€æœºï¼Œè€Œ initrd.target ä¹Ÿæ˜¯éœ€è¦è¯»å…¥ä¸€å †å¦‚ basic.targetã€sysinit.target ç­‰ç¡¬ä»¶æ£€æµ‹ã€æ ¸å¿ƒåŠŸèƒ½å¯ç”¨çš„æµç¨‹ï¼Œç„¶åè®©ç³»ç»Ÿé¡ºåˆ©è¿è¡Œã€‚æœ€ç»ˆåˆå¸è½½äº† initramfs çš„å°å‹æ–‡ä»¶ç³»ç»Ÿï¼Œå®é™…æŒ‚è½½ç³»ç»Ÿçš„æ ¹ç›®å½•

åŒæ—¶å¯ä»¥çœ‹åˆ° initramfs é‡Œé¢å¾ˆç²¾ç®€ï¼Œä»…æ˜¯å¸¦å…¥å¼€æœºè¿‡ç¨‹ä¸­ä¼šç”¨åˆ°çš„æ ¸å¿ƒæ¨¡å—ã€‚åœ¨ initramfs é‡Œå»æ‰¾ modules å…³é”®è¯ï¼Œå°±å¯ä»¥å‘ç°ä¸»è¦çš„æ ¸å¿ƒæ¨¡å—å¤§æ¦‚å°±æ˜¯ SCSIã€virtioã€RAID ç­‰ä¸ç£ç›˜ç›¸å…³æ€§è¾ƒé«˜çš„æ¨¡å—ã€‚ç°åœ¨ç”±äºå¤§éƒ¨åˆ†ç£ç›˜éƒ½ä½¿ç”¨ SATA ï¼Œå¹¶æ²¡æœ‰ IDE çš„æ ¼å¼ï¼Œæ²¡æœ‰ initramfs çš„è¯ï¼Œä½ çš„ Linux å‡ ä¹å°±ä¸èƒ½é¡ºåˆ©å¼€æœºäº†ï¼Œé™¤éå°† STAT çš„æ¨¡å—ç›´æ¥ç¼–è¯‘åˆ°æ ¸å¿ƒä¸­å»

åœ¨æ ¸å¿ƒåŠ è½½å®Œæˆåï¼Œä¸»æœºå°±å¼€å§‹æ­£ç¡®è¿è¡Œäº†ï¼Œæ¥ä¸‹æ¥å°±è¦å¼€å§‹æ‰§è¡Œç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªç¨‹åº systemd

## ğŸ€ ç¬¬ä¸€ä¸ªç¨‹åº systemd åŠä½¿ç”¨ defaul.target è¿›å…¥å¼€æœºç¨‹åºåˆ†æ

åœ¨æ ¸å¿ƒåŠ è½½å®Œæˆã€è¿›è¡Œå®Œç¡¬ä»¶æ£€æµ‹ä¸é©±åŠ¨ç¨‹åºåŠ è½½åï¼Œæ­¤æ—¶ä½ çš„ä¸»æœºç¡¬ä»¶å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼ˆreadyï¼‰ï¼Œæ­¤æ—¶æ ¸å¿ƒä¼šè°ƒç”¨ç¬¬ä¸€ä¸ªç¨‹åº systemdã€‚

systemd æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å‡†å¤‡è½¯ä»¶æ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒ…æ‹¬ç³»ç»Ÿçš„ä¸»æœºåã€ç½‘ç»œè®¾ç½®ã€è¯­ç³»å¤„ç†ã€æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŠå…¶ä»–æœåŠ¡çš„å¯åŠ¨ç­‰ã€‚è€Œæ‰€æœ‰çš„åŠ¨ä½œéƒ½æ´»é€šè¿‡ systemd çš„é»˜è®¤å¯åŠ¨æœåŠ¡é›†åˆï¼Œä¹Ÿå°±æ˜¯ `/etc/ststend/system/default.target` æ¥è§„åˆ’ã€‚

#### å¸¸è§çš„æ“ä½œç¯å¢ƒ target ä¸å…¼å®¹äº runlevel çš„ç­‰çº§

å¯ä»¥ä½œä¸ºé¢„è®¾çš„æ“ä½œç¯å¢ƒï¼ˆdefault.targetï¼‰çš„ä¸»è¦é¡¹ç›®æœ‰ï¼šmulti-user.target ä»¥åŠ graphical.target è¿™ä¸¤ä¸ªã€‚è¿˜åŒ…æ‹¬ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„æ“ä½œç¯å¢ƒï¼ŒåŒ…æ‹¬åœ¨ç¬¬ 17 ç« ä¸­çš„ rescue.targetã€emergency.target.targetã€shutdown.target ç­‰ï¼Œè¿˜æœ‰æœ¬ç« è®²åˆ°çš„ initramfs ä¸­çš„ initrd.target 

ä»¥å‰ systemV ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç§°ä¸º runlevelï¼ˆæ‰§è¡Œç­‰çº§ï¼‰çš„æ¦‚å¿µæ¥å¯åŠ¨ç³»ç»Ÿçš„ï¼Œsystemd ä¸ºäº†å…¼å®¹äºæ—§çš„ systemd æ“ä½œè¡Œä¸ºï¼Œä¸‹åˆ—æ–¹å¼å¯ä»¥æ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„å…³ç³»

```bash
[root@study initramfs]# ll -d /usr/lib/systemd/system/runlevel*.target | cut -c 28-
Oct  4 18:22 /usr/lib/systemd/system/runlevel0.target -> poweroff.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel1.target -> rescue.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel2.target -> multi-user.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel3.target -> multi-user.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel4.target -> multi-user.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel5.target -> graphical.target
Oct  4 18:22 /usr/lib/systemd/system/runlevel6.target -> reboot.target

```

### systemd çš„å¤„ç†æµç¨‹

å½“æˆ‘ä»¬å–å¾—äº† `/etc/systemd/system/default.target` è¿™ä¸ªé»˜è®¤çš„æ“ä½œç•Œé¢è®¾ç½®åï¼Œæ“ä½œç³»ç»Ÿä¼šé“¾æ¥åˆ° `/usr/lib.systemd/system/` ç›®å½•ä¸‹å–å¾— multi-usr.target æˆ– graphical.target ä¸­çš„ä¸€ä¸ªï¼Œå‡è®¾ä½¿ç”¨çš„æ˜¯ graphical.target ï¼Œæ¥ä¸‹æ¥ï¼Œsystemd ä¼šæ‰¾ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹çš„é…ç½®

- `/etc/systemd/system/graphical.target.wants/`ï¼šä½¿ç”¨è€…è®¾ç½®åŠ è½½çš„ unit
- `/usr/lib/systemd/system/graphical.target.wants/`ï¼šç³»ç»Ÿé»˜è®¤åŠ è½½çš„ unit

ç„¶åå†ç”±`/usr/lib/systemd/system/graphical.target` é…ç½®æ–‡ä»¶å†…å®¹å‘ç°å¦‚ä¸‹èµ„æ–™

```bash
[root@study initramfs]# cat /usr/lib/systemd/system/graphical.target 
#  This file is part of systemd.
#
#  systemd is free software; you can redistribute it and/or modify it
#  under the terms of the GNU Lesser General Public License as published by
#  the Free Software Foundation; either version 2.1 of the License, or
#  (at your option) any later version.

[Unit]
Description=Graphical Interface
Documentation=man:systemd.special(7)
Requires=multi-user.target				# éœ€è¦å…ˆè¿è¡Œè¯¥ç¯å¢ƒåœ¨è¿è¡Œè‡ªå·±
Wants=display-manager.service			# è¿è¡Œå®Œè‡ªå·±ä¹‹åï¼Œè¿˜éœ€è¦è¿è¡Œè¯¥æœåŠ¡
Conflicts=rescue.service rescue.target
After=multi-user.target rescue.service rescue.target display-manager.service
AllowIsolate=yes

```

é‚£ä¹ˆé€šè¿‡åŒæ ·çš„æ–¹å¼ï¼Œæ‰¾åˆ° multi-user.target

```bash
[root@study initramfs]# cat /usr/lib/systemd/system/multi-user.target
#  This file is part of systemd.
#
#  systemd is free software; you can redistribute it and/or modify it
#  under the terms of the GNU Lesser General Public License as published by
#  the Free Software Foundation; either version 2.1 of the License, or
#  (at your option) any later version.

[Unit]
Description=Multi-User System
Documentation=man:systemd.special(7)
Requires=basic.target				# å¿…é¡»è¦å…ˆå¯åŠ¨è¯¥ç¯å¢ƒ
Conflicts=rescue.service rescue.target
After=basic.target rescue.service rescue.target
AllowIsolate=yes

# çœ‹çœ‹ç³»ç»Ÿé»˜è®¤è¦åŠ è½½çš„ unit æœ‰å“ªäº›
[root@study initramfs]# ls /usr/lib/systemd/system/multi-user.target.wants/
dbus.service  plymouth-quit-wait.service  systemd-ask-password-wall.path  systemd-update-utmp-runlevel.service
getty.target  plymouth-quit.service       systemd-logind.service          systemd-user-sessions.service

# ä½¿ç”¨è€…è‡ªå®šä¹‰è¦åŠ è½½çš„ unit æœ‰å“ªäº›
[root@study initramfs]# ls /etc/systemd/system/multi-user.target.wants/    
ModemManager.service    avahi-daemon.service                   ksmtuned.service        rngd.service
NetworkManager.service  crond.service                          libstoragemgmt.service  rpcbind.service
abrt-ccpp.service       cups.path                              libvirtd.service        rsyslog.service
abrt-oops.service       cups.service                           mcelog.service          smartd.service
abrt-vmcore.service     firewalld.service                      mdmonitor.service       sshd.service
abrt-xorg.service       initial-setup-reconfiguration.service  nfs-client.target       sysstat.service
abrtd.service           irqbalance.service                     postfix.service         tuned.service
atd.service             kdump.service                          remote-fs.target        vdo.service
auditd.service          ksm.service                            rhel-configure.service  vmtoolsd.service

```

ç¬”è€…åœ¨è¿™é‡Œå·²ç»æ‡µé€¼äº†ï¼Œæœ‰ç‚¹éš¾äº†

é€šè¿‡ä»¥ä¸Šåˆ†æçŸ¥é“ï¼šmulti-user.target è¦åœ¨ basic.target è¿è¡Œå®Œæ¯•åæ‰èƒ½å¤ŸåŠ è½½ä¸Šè¿°çš„è®¸å¤š unitã€‚ç„¶åå†å» bashic.target ä¸­æ‰¾æ•°æ®ç­‰ï¼Œæœ€ç»ˆè¿™äº›æ•°æ®å¯ä»¥é€šè¿‡ `systemctl list-dependencies graphical.target` æŒ‡ä»¤åˆ—å‡ºæ¥æ‰€æœ‰ç›¸å…³æ€§çš„æœåŠ¡

è¿™ä¸ªå°±æ˜¯ sytemd è°ƒç”¨æ‰€éœ€è¦çš„æœåŠ¡æµç¨‹

ç®€çº¦åˆ†æä¸‹ `systemctl list-dependencies graphical.target` æ‰€è¾“å‡ºçš„ç›¸ä¾å±æ€§æœåŠ¡ï¼ŒåŸºæœ¬ä¸Š CentOS 7.x çš„ systemd å¼€æœºæµç¨‹å¤§çº¦æ˜¯è¿™æ ·ï¼š

1. `local-fs.target + swap.target`ï¼šä¸»è¦åœ¨æŒ‚è½½æœ¬æœº `/etc/fstab` é‡Œæ‰€è§„èŒƒçš„æ–‡ä»¶ç³»ç»Ÿä¸ç›¸å…³çš„å†…å­˜äº¤æ¢ç©ºé—´
2. sysinit.targetï¼šä¸»è¦åœ¨æ£€æµ‹ç¡¬ä»¶ã€åŠ è½½æ‰€éœ€è¦çš„æ ¸å¿ƒæ¨¡å—ç­‰
3. bashic.targetï¼šåŠ è½½ä¸»è¦çš„å¤–å›´ç”¨ç¡¬ä»¶é©±åŠ¨ç¨‹åºä¸é˜²ç«å¢™ç›¸å…³æœåŠ¡
4. multi-user.targetï¼šä¸‹é¢çš„å…¶ä»–ä¸€èˆ¬ç³»ç»Ÿæˆ–ç½‘ç»œæœåŠ¡çš„åŠ è½½
5. å›¾å½¢ç•Œé¢ç›¸å…³æœåŠ¡ï¼Œå¦‚ gdm.service ç­‰å…¶ä»–æœåŠ¡çš„åŠ è½½

é™¤äº†ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡ `/etc/fastab` æ¥è¿›è¡ŒæŒ‚è½½çš„è¡Œä¸ºä¹‹å¤–ï¼Œå…¶ä»–çš„ target åšäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢æ¥ç®€å•è¯´è¯´

## ğŸ€ systemd æ‰§è¡Œ sysinit.target åˆå§‹åŒ–ç³»ç»Ÿã€bashic.target å‡†å¤‡ç³»ç»Ÿ

å¦‚æœä½¿ç”¨ `systemctl list-dependencies sysinit.target` ä¼šçœ‹åˆ°å¾ˆå¤šç›¸ä¾çš„æœåŠ¡ï¼Œæƒ³è¦çŸ¥é“è¿™äº›æœåŠ¡æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåŒºçœ‹è„šæœ¬è®¾ç½®å†…å®¹ï¼ŒåŸºæœ¬ä¸Šï¼Œå¯ä»¥å°†è¿™äº›æœåŠ¡å½’ç±»ä¸ºå‡ ä¸ªå¤§é¡¹ï¼š

- ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿè£…ç½®çš„æŒ‚è½½ï¼šåŒ…æ‹¬ `dev-hugepages.mount dev-mqueue.mount` ç­‰æŒ‚è½½æœåŠ¡ï¼Œä¸»è¦åœ¨æŒ‚è½½ä¸å·¨é‡å†…å­˜åˆ†é¡µä¸æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚æŒ‚è½½æˆåŠŸåï¼Œä¼šåœ¨ `/dev` ä¸‹å»ºç«‹  `/dev/hugepages` ã€`/dev.mqueue` ç­‰ç›®å½•
- ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ï¼šåŒ…æ‹¬ç£ç›˜é˜µåˆ—ã€ç½‘ç»œé©±åŠ¨å™¨ï¼ˆiscsiï¼‰ã€LVM æ–‡ä»¶ç³»ã€æ–‡ä»¶ç³»ç»Ÿå¯¹ç…§æœåŠ¡ï¼ˆmultipathï¼‰ï¼Œç­‰ï¼Œä¹Ÿä¼šåœ¨è¿™é‡Œè¢«æ£€æµ‹åˆ°
- å¼€æœºè¿‡ç¨‹çš„ä¿¡æ¯ä¼ é€’ä¸åŠ¨ç”»æ‰§è¡Œï¼šä½¿ç”¨ plymouthd æœåŠ¡æ­é… plymouth æŒ‡ä»¤æ¥ä¼ é€’åŠ¨ç”»ä¸ä¿¡æ¯
- æ—¥å¿—æ–‡ä»¶çš„ä½¿ç”¨ï¼šsystemd-journald æœåŠ¡çš„å¯ç”¨
- åŠ è½½é¢å¤–é¢æ ¸å¿ƒæ¨¡å—ï¼šé€šè¿‡ `/etc/modules-load.d/*.conf` æ–‡ä»¶çš„è®¾ç½®ï¼Œè®©æ ¸å¿ƒé¢å¤–åŠ è½½ç®¡ç†å‘˜æ‰€éœ€è¦çš„æ ¸å¿ƒæ¨¡å—
- åŠ è½½é¢å¤–çš„æ ¸å¿ƒå‚æ•°è®¾ç½®ï¼šåŒ…æ‹¬ `/etc/sysctl.conf` ä»¥åŠ `/etc/sysctl.d/*.conf` å†…éƒ¨è®¾ç½®
- å¯åŠ¨ç³»ç»Ÿçš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šéšæœºæ•°ç”Ÿæˆå™¨å¯ä»¥å¸®åŠ©ç³»ç»Ÿè¿›è¡Œä¸€äº›å¯†ç åŠ å¯†çš„åŠŸèƒ½
- è®¾ç½®ç»ˆç«¯æœºï¼ˆconsoleï¼‰å­—å½¢
- å¯åŠ¨åŠ¨æ€è®¾å¤‡ç®¡ç†å™¨ï¼šudevdï¼Œç”¨åœ¨åŠ¨æ€å¯¹åº”å®é™…è®¾å¤‡å­˜å–ä¸è£…ç½®æ–‡ä»¶åå¯¹åº”çš„ä¸€ä¸ªæœåŠ¡ï¼Œç›¸å½“é‡è¦

æ— è®ºä½¿ç”¨å“ªç§æ“ä½œç¯å¢ƒæ¥ä½¿ç”¨ç³»ç»Ÿï¼Œè¯¥ sysinit.target å‡ ä¹éƒ½æ˜¯å¿…è¦çš„å·¥ä½œï¼Œä»ä¸Šé¢çœ‹ï¼ŒåŸºæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ã€æ–‡ä»¶ç³»ç»Ÿã€æ–‡ä»¶ç³»ç»Ÿè®¾å¤‡çš„é©±åŠ¨ç­‰ï¼Œéƒ½åœ¨æ­¤åˆ»å¤„ç†å®Œæˆçš„

ä¹‹åå°±æ˜¯ basic.target é¡¹ç›®ã€‚è¯¥é˜¶æ®µä¸»è¦å¯åŠ¨çš„æœåŠ¡å¤§æ¦‚æœ‰ï¼š

- åŠ è½½ alsa éŸ³æ•ˆé©±åŠ¨ç¨‹åº
- åŠ è½½ firewalld é˜²ç«å¢™ï¼šCentOS 7.x ä½¿ç”¨ firewalld ä»£æ›¿ iptables çš„é˜²ç«å¢™è®¾ç½®ï¼Œä¸è¿‡åº•å±‚è¿˜æ˜¯ç§ç”¨çš„ iptables æ¶æ„
- åŠ è½½ CPU çš„å¾®æŒ‡ä»¤åŠŸèƒ½
- å¯åŠ¨ä¸è®¾ç½® SELinux çš„å®‰å…¨æœ¬æ–‡ï¼šå¦‚æœ disable çš„çŠ¶æ€æ”¹æˆ enableï¼Œä¹Ÿæ˜¯åœ¨è¯¥é˜¶æ®µå¤„ç†
- å°†ç›®å‰çš„å¼€æœºè¿‡ç¨‹æ‰€äº§ç”Ÿçš„å¼€æœºä¿¡æ¯å†™åˆ° `/var/log/dmesg` ä¸­
- ç”± `/etc/sysconfig/modules/*.modules` ä»¥åŠ `/etc/rc.modules` åŠ è½½ç®¡ç†å‘˜æŒ‡å®šçš„æ¨¡å—
- åŠ è½½ systemd æ”¯æŒçš„ timer åŠŸèƒ½

è¯¥é˜¶æ®µä¹‹åï¼Œç³»ç»Ÿå·²ç»å¼€æºé¡ºåˆ©çš„è¿è¡Œï¼Œå°±å·®ä¸€å †éœ€è¦çš„ç™»å½•æœåŠ¡ã€ç½‘ç»œæœåŠ¡ã€æœ¬æœºè®¤è¯æœåŠ¡ç­‰ service ç±»åˆ«ï¼Œä¸‹ä¸ªé˜¶æ®µå°±è¿›å…¥åˆ°æœåŠ¡å¯åŠ¨çš„é˜¶æ®µäº†

## ğŸ€ systemd å¯åŠ¨ multi-user.target ä¸‹çš„æœåŠ¡

è¿™äº›æœåŠ¡çš„å¯åŠ¨å¤§å¤šæ˜¯æŒ‚è½½ multi-user.target æ“ä½œç¯å¢ƒä¸‹ï¼Œå¯ä»¥åˆ° `/etc/systemd/system/multi-user.target.wants/` ä¸­çœ‹çœ‹é»˜è®¤è¦å¯åŠ¨çš„æœåŠ¡ã€‚

ä¸€èˆ¬æ¥è¯´æœåŠ¡çš„å¯åŠ¨è„šæœ¬è®¾ç½®éƒ½æ˜¯æ”¾åœ¨å¦‚ä¸‹çš„ç›®å½•å†…ï¼š

- `/usr/lib/systemd/system`ï¼šç³»ç»Ÿé»˜è®¤çš„æœåŠ¡å¯åŠ¨è„šæœ¬è®¾ç½®
- `/etc/systemd/system`ï¼šç®¡ç†å‘˜è‡ªå·±å¼€å‘ä¸è®¾ç½®çš„è„šæœ¬è®¾ç½®

è€Œç”¨æˆ·é’ˆå¯¹ä¸»æœºçš„æœ¬åœ°æœåŠ¡äºæœåŠ¡å™¨ç½‘ç»œæœåŠ¡çš„å„é¡¹ unit è‹¥è¦ enable ï¼Œå°†ä»– æ”¾åˆ° `/etc/systemd/system/multi-user.target.wants/` ç›®å½•ä¸‹åšä¸ªé“¾æ¥ï¼Œå°±å¯ä»¥åœ¨å¼€æœºçš„æ—¶å€™å»å¯ç”¨å®ƒã€‚

```bash
# å°† vsftpd.service å…ˆ disable å† enable çœ‹çœ‹è¾“å‡ºçš„ä¿¡æ¯
[root@study ~]# systemctl disable vsftpd.service
rm '/etc/systemd/system/multi-user.target.wants/vsftpd.service'
[root@study ~]# systemctl enable vsftpd.service
ln -s '/usr/lib/systemd/system/vsftpd.service' '/etc/systemd/system/multi-user.target.wants/vsftpd.service'
```

### ç›¸å®¹ systemV çš„ rc-local.service

è¿‡å»ï¼Œè¦è®©ç³»ç»Ÿå¼€æœºåæ‰§è¡ŒæŸäº›ç¨‹åºï¼Œå¯ä»¥å°†æŒ‡ä»¤æˆ–è„šæœ¬çš„ç»å¯¹è·¯å¾„å†™å…¥åˆ° `/etc/rc.d/rc.local` æ–‡ä»¶ä¸­

systemd ç¯å¢ƒä¸‹ï¼Œå†™ä¸€ä¸ª systemd çš„å¯åŠ¨è„šæœ¬é…ç½®æ–‡ä»¶åˆ° `/etc/systemd/system` ä¸‹ï¼Œç„¶åä½¿ç”¨ systemctl enable çš„æ–¹å¼æ¥å¯åŠ¨å®ƒ

rc-local.service æœåŠ¡å°±å…¼å®¹äº†è€çš„æ–¹å¼ã€‚è¯¥æœåŠ¡ä¸éœ€è¦å¯åŠ¨ï¼Œå®ƒä¼šåˆ¤æ–­ `/etc/rc.d/rc.local` æ˜¯å¦å…·æœ‰å¯æ‰§è¡Œçš„æƒé™æ¥åˆ¤æ–­è¦ä¸è¦å¯åŠ¨è¿™ä¸ªæœåŠ¡ã€‚å¯ä»¥å¦‚ä¸‹æ£€æŸ¥

```bash
# 1. æŸ¥çœ‹ rc.local çš„æƒé™ï¼Œå†æ£€æŸ¥ multi-user.target æœ‰æ²¡æœ‰è¯¥æœåŠ¡
[root@study ~]# ll /etc/rc.d/rc.local 
-rw-r--r--. 1 root root 473 Aug  8  2019 /etc/rc.d/rc.local

[root@study ~]# systemctl status rc-local.service 
* rc-local.service - /etc/rc.d/rc.local Compatibility
   Loaded: loaded (/usr/lib/systemd/system/rc-local.service; static; vendor preset: disabled)
   Active: inactive (dead)

[root@study ~]# systemctl list-dependencies multi-user.target | grep rc-local

# å¯ä»¥çœ‹åˆ°ï¼Œæœ‰è¿™ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ rc.local æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå› æ­¤è¯¥æœåŠ¡ä¸ä¼šè¢«æ‰§è¡Œ

# 2. åŠ å…¥å¯æ‰§è¡Œåï¼Œå†çœ‹ä¸‹ rc-local æ˜¯å¦å¯è¢«å¯ç”¨ 
[root@study ~]# chmod a+x /etc/rc.d/rc.local ;  ll /etc/rc.d/rc.local 
-rwxr-xr-x. 1 root root 473 Aug  8  2019 /etc/rc.d/rc.local
[root@study ~]# systemctl list-dependencies multi-user.target | grep rc-local
* |-rc-local.service

# å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æœåŠ¡ç¡®å®è¢«è®°å½•åˆ°å¯åŠ¨çš„ç¯å¢ƒä¸‹äº†
```

### æä¾› tty ç•Œé¢ä¸ç™»å½•çš„æœåŠ¡

åœ¨ multi-user.target ä¸‹æœ‰ä¸ª getty.target çš„æ“ä½œç•Œé¢é¡¹ç›®ã€‚èƒ½ä¸èƒ½æä¾›é€‚å½“çš„ç™»å½•æœåŠ¡ä¹Ÿæ˜¯è¯¥ target ä¸‹çš„å†…å®¹ï¼ŒåŒ…æ‹¬ systemd-logind.serviceã€systemd-usr-sessions.service ç­‰æœåŠ¡

è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªç°è±¡ï¼Œåœ¨å¯åŠ¨ç³»ç»Ÿæ—¶ï¼Œçœ‹åˆ°å±å¹•å‡ºç° tty1 å¯ä»¥ç™»å½•ï¼Œä½†æ˜¯å½“è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç å´æ— æ³•ç™»å½•ï¼Œç­‰å¾…åå‡ ç§’æ‰å¯ä»¥ï¼Œè¿™æ˜¯å› ä¸ºä»¥ä¸ŠæœåŠ¡åŒæ—¶å¯åŠ¨çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ tty å…ˆå¯åŠ¨å¥½ï¼Œlogind è¿˜æœªå¯åŠ¨å¥½é€ æˆçš„

## ğŸ€ systemd å¯åŠ¨ graphical.target ä¸‹çš„æœåŠ¡

å¦‚æœ default.target æ˜¯ multi-user.target çš„è¯ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸ä¼šæ‰§è¡Œã€‚

systemd å¼€å§‹åŠ è½½ç”¨æˆ·ç®¡ç†æœåŠ¡äºå›¾å½¢ç•Œé¢ç®¡ç†å‘˜ï¼ˆwindow display managerï¼ŒDMï¼‰ï¼Œå¯åŠ¨å›¾å½¢ç•Œé¢è®©ç”¨æˆ·å¯ä»¥ä»¥å›¾å½¢ç•Œé¢ç™»å½•ç³»ç»Ÿï¼Œå¯ä»¥æŸ¥çœ‹æœ‰å“ªäº›æœåŠ¡

```bash
[root@study ~]# systemctl list-dependencies graphical.target 
graphical.target
* |-accounts-daemon.service
* |-gdm.service
* |-initial-setup-reconfiguration.service
* |-network.service
* |-rtkit-daemon.service
* |-systemd-readahead-collect.service
* |-systemd-readahead-replay.service
* |-systemd-update-utmp-runlevel.service
* |-udisks2.service
* `-multi-user.target
*   |-abrt-ccpp.service
....
```

ä¹Ÿæœ‰å¾ˆå¤šæœåŠ¡ï¼Œå…¶ä¸­ gdm.service å»æŸ¥çœ‹ä»–çš„å†…å®¹ï¼Œä¼šå‘ç°æ‰§è¡Œçš„æ˜¯ `/usr/sbin/gdm` è¿™ä¸ªæ˜¯è®©ç”¨æˆ·å¯ä»¥åˆ©ç”¨å›¾å½¢ç•Œé¢ç™»å½•æœ€é‡è¦çš„æœåŠ¡ï¼Œæœªæ¥å†æ¥è¯¦ç»†è®²è§£ gdm

## ğŸ€ å¼€æœºè¿‡ç¨‹ä¼šç”¨åˆ°çš„ä¸»è¦é…ç½®æ–‡ä»¶

systemd æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶å¤„ç†æ–¹å¼ï¼Œä¸è¿‡ä¸ºäº†å…¼å®¹ systemVï¼Œè¿˜æœ‰éƒ¨åˆ†æœåŠ¡è„šæœ¬è®¾ç½®ä¼šè¯»å– `/etc/sysconfig/` ä¸‹çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ã€‚ä¸‹é¢æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®æ–‡ä»¶

### å…³äºæ¨¡å— `/etc/modprobe.d/*.conf ä¸ /etc/modules-load.d/*.conf`

åœ¨ sysinit.target ç³»ç»Ÿåˆå§‹åŒ–ä¸­è°ˆåˆ°åŠ è½½ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—çš„åœ°æ–¹ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å¤„ç†æ¨¡å—åŠ è½½çš„é—®é¢˜ï¼š

-  `/etc/modules-load.d/*.conf`ï¼šå•çº¯è¦æ ¸å¿ƒåŠ è½½æ¨¡å—çš„ä½ç½®
- `/etc/modprobe.d/*.conf`ï¼šå¯ä»¥åŠ ä¸Šæ¨¡å—å‚æ•°çš„ä½ç½®

Systemd åŸºæœ¬ä¸Šå¸®æˆ‘ä»¬å¼€æœºä¼šç”¨åˆ°çš„é©±åŠ¨ç¨‹åºå…¨éƒ¨åŠ è½½äº†ï¼Œä¸€èˆ¬ä¸éœ€è¦æ›´æ”¹è¿™éƒ¨åˆ†ï¼Œå¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚è¦å¤„ç†çš„è¯ï¼Œå°±éœ€è¦å†è¿™é‡Œè¿›è¡Œäº†ã€‚

ä¸¾ä¾‹ï¼šåœ¨ç¬¬ 17 ç« ä¸­è°ˆåˆ° vsftpd æœåŠ¡ï¼Œç«¯å£å·ç²³ç¨»åˆ° 555 ä¸Šå»äº†ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¿®æ”¹é˜²ç«å¢™è®¾ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªé’ˆå¯¹ FTP å¾ˆé‡è¦çš„é˜²ç«å¢™æ¨¡å—ä¸º nf_conntrack_ftp ï¼Œå› æ­¤ï¼Œå¯ä»¥å°†è¿™ä¸ªæ¨¡å—å†™å…¥åˆ°ç³»ç»Ÿå¼€æœºæµç¨‹ä¸­ã€‚ä¾‹å¦‚

```bash
[root@study ~]# vim /etc/modules-load.d/mrcode.conf
nf_conntrack_ftp

```

ä¸€ä¸ªæ¨¡å—ï¼ˆé©±åŠ¨ç¨‹åºï¼‰å†™ä¸€è¡Œï¼Œä¸Šè¿°çš„æ¨¡å—åŸºæœ¬ä¸Šæ˜¯é’ˆå¯¹é»˜è®¤ FTP ç«¯å£çš„ï¼Œå³ 21 ï¼Œå¦‚æœéœ€è¦è°ƒæ•´åˆ°port 555 ï¼Œéœ€è¦é¢å¤–å¸¦å‚æ•°ï¼Œæ¨¡å—å¤–åŠ å‚æ•°çš„è®¾ç½®æ–¹å¼éœ€è¦å†™åˆ°å¦å¤–ä¸€ä¸ªåœ°æ–¹

```bash
[root@study ~]# vim /etc/modprobe.d/mrcode.conf
options nf_conntrack_ftp ports=555
[root@study ~]# lsmod | grep nf_conntrack_ftp
# å› ä¸ºè¿˜æ²¡æœ‰åŠ è½½è¯¥æ¨¡å—ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ä¿¡æ¯

# é‡å¯æ¨¡å—æœåŠ¡åï¼Œå°±å‘ç°è¢«åŠ è½½äº†
[root@study ~]# systemctl restart systemd-modules-load.service  
[root@study ~]# lsmod | grep nf_conntrack_ftp
nf_conntrack_ftp       18478  0 
nf_conntrack          139224  8 nf_nat,nf_nat_ipv4,nf_nat_ipv6,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_ftp,nf_conntrack_ipv4,nf_conntrack_ipv6

```

é€šè¿‡å¦‚ä¸Šæ–¹å¼ï¼Œå¯ä»¥åœ¨å¼€æœºæ—¶å°†ä½ éœ€è¦çš„é©±åŠ¨ç¨‹åºæˆ–åˆ™æ˜¯è°ƒæ•´è¿™äº›æ¨¡å—çš„å¤–åŠ å‚æ•°

###`/etc/sysconfig/*`

ä¸‹é¢è®²è§£å‡ ä¸ªæ¯”è¾ƒå¸¸è§ä¸”é‡è¦çš„ç¯å¢ƒé…ç½®æ–‡ä»¶

- authconfig

  ä¸»è¦è§„èŒƒä½¿ç”¨è€…çš„èº«ä»½è®¤è¯æœºåˆ¶ï¼ŒåŒ…æ‹¬æ˜¯å¦ä½¿ç”¨æœ¬æœºçš„ `/etc/passwd`ã€`/etc/shadow` ç­‰ï¼Œä»¥åŠ `/etc/shadow` å¯†ç è®°å½•ä½¿ç”¨ä½•ç§åŠ å¯†ç®—æ³•ï¼Œè¿˜æœ‰æ˜¯å¦ä½¿ç”¨å¤–éƒ¨å¯†ç æœåŠ¡å™¨æä¾›çš„è´¦æˆ·éªŒè¯ï¼ˆNISã€LDAPï¼‰ç­‰ã€‚ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ SHA512 åŠ å¯†ç®—æ³•ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨å¤–éƒ¨çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼›

  å¦å¤–ä¸å»ºè®®æ‰‹åŠ¨ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œåº”è¯¥ä½¿ç”¨ `authconfig-tui` æ¥ä¿®æ”¹

- cpupower

  å¦‚æœæœ‰å¯åŠ¨ cpupower.service æœåŠ¡æ—¶ï¼Œå°±ä¼šè¯»å–è¯¥æ–‡ä»¶ã€‚ä¸»è¦æ˜¯ Linux æ ¸å¿ƒå¦‚ä½•æ“ä½œ CPU çš„åŸåˆ™ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯åŠ¨ cpupower.service åï¼Œç³»ç»Ÿä¼šè®© CPU ä»¥æœ€å¤§æ•ˆèƒ½çš„æ–¹å¼æ¥è¿è¡Œï¼Œå¦åˆ™é¢„è®¾å°±æ˜¯ç”¨å¤šå°‘ç®—å¤šå°‘çš„æ¨¡å¼æ¥å¤„ç†

- firewalldã€iptables-configã€ebtables-config

  ä¸é˜²ç«å¢™æœåŠ¡çš„å¯åŠ¨å¤–å¸¦å‚æ•°æœ‰å…³

- network-scripts

	è‡³äº network-scripts æ–‡ä»¶ï¼Œåˆ™ä¸»è¦ç”¨æ¥è®¾ç½®ç½‘å¡

  

