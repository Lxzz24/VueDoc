---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# æ ¸å¿ƒä¸æ ¸å¿ƒæ¨¡å—

æ•´ä¸ªå¼€æœºæµç¨‹è®²å®Œï¼Œåœ¨æ•´ä¸ªå¼€æœºè¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦èƒ½å¤ŸæˆåŠŸçš„é©±åŠ¨æˆ‘ä»¬ä¸»æœºçš„ç¡¬ä»¶è®¾å¤‡ï¼Œæ˜¯æ ¸å¿ƒçš„å·¥ä½œï¼Œè€Œæ ¸å¿ƒä¸€èˆ¬éƒ½æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦å…ˆè§£å‹åæ‰èƒ½åŠ è½½ä¸»å­˜å‚¨å™¨ä¸­

ç›®å‰çš„æ ¸å¿ƒéƒ½æ˜¯å…·æœ‰å¯è¯»å–æ¨¡å—åŒ–é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½ï¼Œå³æ¨¡å—åŒ–ï¼ˆmodulesï¼‰ï¼Œè¯¥æ¨¡å—å¯èƒ½ç”±ç¡¬ä»¶å¼€å‘å‚å•†æä¾›ï¼Œä¹Ÿæœ‰å¯èƒ½æ ¸å¿ƒæœ¬æ¥å°±æ”¯æŒï¼Œè¾ƒæ–°çš„ç¡¬ä»¶ï¼Œé€šå¸¸éƒ½éœ€è¦ç¡¬ä»¶å¼€å‘å•†æä¾›é©±åŠ¨ç¨‹åºçš„æ¨¡å—

æ ¸å¿ƒä¸æ ¸å¿ƒæ¨¡å—ä½ç½®ï¼š

- æ ¸å¿ƒï¼š`/boot/vmlinuz` æˆ– `/boot/vminuz-version`
- æ ¸å¿ƒè§£å‹ç¼©éœ€ RAM diskï¼š`/boot/initramfs(/boot/initramfs-version)`
- æ ¸å¿ƒæ¨¡å—ï¼š`/lib/modules/version/kernel` æˆ– `/lib/modules/$(uname-r)`/kernel
- æ ¸å¿ƒåŸå§‹ç ï¼š`/usr/src/linux` æˆ– `/usr/src/kernels/` (é»˜è®¤ä¸å®‰è£…ï¼Œå®‰è£…æ‰ä¼šæœ‰)

å¦‚æœè¯¥æ ¸å¿ƒè¢«é¡ºåˆ©åŠ è½½åˆ°ç³»ç»Ÿä¸­äº†ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¦‚ä¸‹ä¿¡æ¯è®°å½•ä¸‹æ¥

- æ ¸å¿ƒç‰ˆæœ¬ï¼š`/proc/version`
- ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼š`/proc/sys/kernel`

é—®é¢˜æ¥äº†ï¼šå¦‚æœæœ‰ä¸ªæ–°çš„ç¡¬ä»¶ï¼Œæˆ‘çš„æ“ä½œç³»ç»Ÿä¸æ”¯æŒæ€ä¹ˆåŠï¼Ÿ

- é‡æ–°ç¼–è¯‘æ ¸å¿ƒï¼Œå¹¶åŠ å…¥æœ€æ–°çš„ç¡¬ä»¶é©±åŠ¨ç¨‹åºåŸå§‹ç 
- å°†è¯¥ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åºç¼–è¯‘æˆä¸ºæ¨¡å—ï¼Œåœ¨å¼€æœºæ—¶åŠ è½½è¯¥æ¨¡å—

å…³äºæ€ä¹ˆç¼–è¯‘å¯ä»¥å‚è€ƒåç»­çš„ç¬¬ 21 ç« ã€‚

## ğŸ€ æ ¸å¿ƒæ¨¡å—ä¸ç›¸ä¾æ€§

åŸºæœ¬ä¸Šæ ¸å¿ƒæ¨¡å—åœ¨ `/lib/modules/$(uname -r)/kernel` ä¸­ï¼Œä¸»è¦åˆ†æˆå‡ ä¸ªç›®å½•

```bash
archï¼šä¸ç¡¬ä»¶å¹³å°æœ‰å…³é¡¹ç›®ï¼Œä¾‹å¦‚ CPU çš„ç­‰çº§ç­‰
cryptoï¼šæ ¸å¿ƒæ‰€æ”¯æŒçš„åŠ å¯†æŠ€æœ¯ï¼Œä¾‹å¦‚ md5 æˆ–åˆ™æ˜¯ des ç­‰
driversï¼šä¸€äº›ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åºï¼Œä¾‹å¦‚æ˜¾å¡ã€ç½‘å¡ã€PCI ç›¸å…³ç¡¬ä»¶
fsï¼šæ ¸å¿ƒæ‰€æ”¯æŒçš„ filesystemsï¼Œä¾‹å¦‚ vfatã€reiserfsã€nfs ç­‰
libï¼šä¸€äº›å‡½æ•°åº“
netï¼šä¸ç½‘ç»œæœ‰å…³çš„å„é¡¹åè®®æ•°æ®ï¼Œè¿˜æœ‰é˜²ç«å¢™æ¨¡å—ï¼ˆnetã€ipv4ã€netfilterï¼‰ ç­‰
soundï¼šä¸éŸ³æ•ˆæœ‰å…³
```

æœ‰ä¸€ä¸ªæ–‡ä»¶è®°å½•äº†æ ¸å¿ƒæ”¯æŒçš„æ¨¡å—çš„å„é¡¹ç›¸ä¾æ€§ï¼š`/lib/modules/$(uname -r)/modules.dep`, å¯ä»¥ä½¿ç”¨ depmod æŒ‡ä»¤æ¥ç®¡ç†

```bash
depmod [-Ane]

é€‰é¡¹ä¸å‚æ•°ï¼š
	-Aï¼šä¸åŠ ä»»ä½•å‚æ•°æ—¶ï¼Œdepmod ä¼šä¸»åŠ¨åˆ†æç›®å‰æ ¸å¿ƒçš„æ¨¡å—ï¼Œå¹¶ä¸”é‡æ–°å†™å…¥è¯¥æ–‡ä»¶ä¸­ã€‚è‹¥åŠ å…¥ -A å‚æ•°æ—¶ï¼Œåˆ™ä¼šå»æœç´¢æ¯” modules.dep å†…è¿˜è¦æ–°çš„æ¨¡å—ï¼Œå¦‚æœæ‰¾åˆ°æ–°æ¨¡å—ï¼Œæ‰ä¼šæ›´æ–°
	-nï¼šä¸å†™å…¥ modules.dep ,è€Œæ˜¯å°†ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Š
	-eï¼šæ˜¾ç¤ºå‡ºç›®å‰å·²åŠ è½½çš„ä¸å¯æ‰§è¡Œçš„æ¨¡å—åç§°
```

```bash
# èŒƒä¾‹ï¼šè‹¥æˆ‘åšå¥½ä¸€ä¸ªç½‘å¡é©±åŠ¨ç¨‹åºï¼Œæ–‡ä»¶åä¸º a.ko  ï¼Œå¦‚ä½•æ›´æ–°æ ¸å¿ƒæƒ³ä¾æ€§ï¼Ÿ
cp a.ko /lib/modules/$(uname -r)/kernel/drivers/net
depmod
```

æ ¸å¿ƒæ¨¡å—æ‰©å±•åä¸€å®šæ˜¯ `.ko` ç»“å°¾ï¼Œå½“ä½¿ç”¨ depmod åï¼Œè¯¥ç¨‹åºä¼šåœ¨ ` /lib/modules/$(uname -r)/kernel/` ç›®å½•å†…ï¼Œæ ¹æ®ç›¸å…³ç›®å½•çš„å®šä¹‰å°†å…¨éƒ¨çš„æ¨¡å—æ‹¿æ¥åˆ†æï¼Œæœ€ç»ˆæ‰ä¼šå°†åˆ†æçš„ç»“æœå†™å…¥ modules.dep æ–‡ä»¶ä¸­

è¯¥æ–‡ä»¶å¾ˆé‡è¦ï¼Œä¼šå½±å“åˆ°æœ¬ç« åç»­ä¼šä»‹ç»çš„ modprobe æŒ‡ä»¤çš„åº”ç”¨

## ğŸ€ æ ¸å¿ƒæ¨¡å—çš„è§‚å¯Ÿ

å¯ä»¥é€šè¿‡  lsmod çŸ¥é“ç›®å‰æ ¸å¿ƒåŠ è½½äº†å¤šå°‘æ¨¡å—

```bash
[root@study ~]# lsmod 
# æ¨¡å—å									å¤§å°		æ¨¡å—æ˜¯å¦è¢«å…¶ä»–æ¨¡å—æ‰€ä½¿ç”¨
Module                  Size  Used by
xt_CHECKSUM            12549  1 
ipt_MASQUERADE         12678  3 
nf_nat_masquerade_ipv4    13430  1 ipt_MASQUERADE
tun                    32026  1 
bridge                151336  0 
stp                    12976  1 bridge
llc                    14552  2 stp,bridge
...
drm										 311588 4 qx1,ttm,drm_kms_helper

```

æ¨¡å—æ˜¯æœ‰ç›¸ä¾æ€§çš„ï¼Œæ¯”å¦‚ä¸Šé¢ nf_nat_masquerade_ipv4 å…ˆåŠ è½½ï¼Œipt_MASQUERADE æ¨¡å—æ‰èƒ½å¤Ÿè¿›ä¸€æ­¥åŠ è½½åˆ°ç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤è€…æ˜¯æœ‰ç›¸ä¾æ€§çš„

æƒ³è¦äº†è§£æŸä¸ªå—ï¼Œå¯ä»¥ä½¿ç”¨ modinfo

```bash
modinfo [-adln] [module_name|filename]
é€‰é¡¹ä¸å‚æ•°ï¼š
	-aï¼šä»…åˆ—å‡ºä½œè€…åç§°
	-dï¼šä»…åˆ—å‡ºè¯¥ modules çš„è¯´æ˜ï¼ˆdescriptionï¼‰
	-lï¼šä»…åˆ—å‡ºæˆæƒ license
	-nï¼šä»…åˆ—å‡ºè¯¥æ¨¡å—çš„è¯¦ç»†è·¯å¾„
```

```bash
# èŒƒä¾‹ï¼šåˆ—å‡º drm æ¨¡å—çš„ç›¸å…³ä¿¡æ¯
[root@study ~]# modinfo drm
# è¯¥æ¨¡å—çš„æ¥æº
filename:       /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/gpu/drm/drm.ko.xz
license:        GPL and additional rights
# è¯¥æ¨¡å—çš„ç®€ä»‹
description:    DRM shared core routines
author:         Gareth Hughes, Leif Delgass, JosÃ© Fonseca, Jon Smirl
license:        GPL and additional rights
description:    DRM bridge infrastructure
author:         Ajay Kumar <ajaykumar.rs@samsung.com>
retpoline:      Y
rhelversion:    7.7
srcversion:     0B7C5A6948CEE2DF7C405B0
depends:        drm_panel_orientation_quirks
...
sig_hashalgo:   sha256
parm:           edid_firmware:Do not probe monitor, use specified EDID blob from built-in data or /lib/firmware instead.  (string)
parm:           vblankoffdelay:Delay until vblank irq auto-disable [msecs] (0: never disable, <0: disable immediately) (int)
parm:           timestamp_precision_usec:Max. error on timestamps [usecs] (int)
parm:           edid_fixup:Minimum number of valid EDID header bytes (0-8, default 6) (int)
parm:           debug:Enable debug output, where each bit enables a debug category.

```

è¯¥æŒ‡ä»¤å¤„ç†å¯ä»¥æŸ¥è¯¢åœ¨æ ¸å¿ƒå†…çš„æ¨¡å—ï¼Œè¿˜å¯ä»¥æ£€æŸ¥æŸä¸ªæ¨¡å—æ–‡ä»¶ã€‚

## ğŸ€ æ ¸å¿ƒæ¨¡å—çš„åŠ è½½ä¸ç§»é™¤

å¦‚æƒ³æ‰‹åŠ¨åŠ è½½æ¨¡å—ï¼Ÿæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œè¿™é‡Œæ¨èæœ€ç®€å•çš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ modprobe æŒ‡ä»¤æ¥åŠ è½½æ¨¡å—ï¼Œå› ä¸ºå®ƒä¼šä¸»åŠ¨æœç´¢ modules.dep çš„å†…å®¹ï¼Œå…ˆå…‹æœäº†æ¨¡å—çš„ç›¸ä¾æ€§åï¼Œæ‰å†³å®šéœ€è¦åŠ è½½çš„æ¨¡å—æœ‰å“ªäº›

è€Œ insmod åˆ™å®Œå…¨ç”±ä½¿ç”¨è€…åŠ è½½ä¸€ä¸ªå®Œæ•´æ–‡ä»¶åçš„æ¨¡å—ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨åˆ†ææ¨¡å—çš„ç›¸ä¾æ€§

```bash
insmod [/full/path/module_name] [parameters]
```

```bash
# èŒƒä¾‹ 1ï¼šå°è¯•è½½å…¥ cifs.ko æ–‡ä»¶ç³»ç»Ÿæ¨¡å—
[root@study ~]# insmod /lib/modules/$(uname -r)/kernel/fs/fat/fat.ko.xz
[root@study ~]# lsmod | grep fat
fat                    65950  0 

```

likeå°±è¢«åŠ è½½äº†ï¼Œä½†æ˜¯éœ€è¦å®Œæ•´çš„è·¯å¾„

```bash
rmmod [-fw] module_name

-fï¼šå¼ºåˆ¶ç§»é™¤è¯¥æ¨¡å—ï¼Œæ— è®ºæ˜¯å¦æ­£åœ¨ä½¿ç”¨
```

```bash
# èŒƒä¾‹ 1ï¼šå°†åˆšåˆšåŠ è½½çš„æ¨¡å—ç§»é™¤
[root@study ~]# rmmod fat
[root@study ~]# lsmod | grep fat
# å°±è¢«ç§»é™¤æ‰äº†

# èŒƒä¾‹ 2ï¼šåŠ è½½ vfat è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¨¡å—
[root@study ~]# insmod /lib/modules/$(uname -r)/kernel/fs/fat/vfat.ko.xz
insmod: ERROR: could not insert module /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fat/vfat.ko.xz: Unknown symbol in module
# æ— æ³•åŠ è½½
```

ä¸Šé¢å°±ç”±äºæœ‰æ¨¡å—ç›¸ä¾æ€§ï¼Œæ— æ³•ç›´æ¥è¢«åŠ è½½ï¼Œå°±å¯ä»¥ä½¿ç”¨ modprobe æ¥å¤„ç†

```bash
modprobe [-cfr] module_name

é€‰é¡¹ä¸å‚æ•°ï¼š
	-cï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿæ‰€æœ‰çš„æ¨¡å—ï¼ˆæ›´è¯¦ç»†çš„ä»£å·å¯¹åº”è¡¨ï¼‰
	-fï¼šå¼ºåˆ¶åŠ è½½è¯¥æ¨¡å—
	-rï¼šç±»ä¼¼ rmmod
```

```bash
# èŒƒä¾‹ 1ï¼š åŠ è½½ vfat æ¨¡å—
[root@study ~]# modprobe vfat
[root@study ~]# lsmod | grep vfat
vfat                   17461  0 
fat                    65950  1 vfat

# å¯ä»¥çœ‹åˆ°ï¼Œè‡ªå·±å°±å¸®æˆ‘ä»¬è§£å†³äº†æ¨¡å—çš„ç›¸ä¾æ€§é—®é¢˜ï¼Œè€Œä¸”åªéœ€è¦çŸ¥é“æ¨¡å—å
```

## ğŸ€ æ ¸å¿ƒæ¨¡å—çš„é¢å¤–å‚æ•°è®¾ç½®ï¼š`/etc/modprobe.d/*.conf`

å¦‚æœæœ‰æŸäº›ç‰¹æ®Šçš„éœ€æ±‚å¯¼è‡´ä½ å¿…é¡»è¦è®©æ ¸å¿ƒæ¨¡å—åŠ ä¸ŠæŸäº›å‚æ•°æ—¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å›åˆ°ä¸Šä¸€ç« çš„æœ€åä¸€å°èŠ‚ **å¼€æœºè¿‡ç¨‹ä¼šç”¨åˆ°çš„ä¸»è¦é…ç½®æ–‡ä»¶** ä¸­å»äº†è§£ï¼Œé‡ç‚¹å°±æ˜¯è¦è‡ªå·±å»ºè®® `.conf` çš„æ–‡ä»¶ï¼Œé€šè¿‡ options æ¥å¸¦å…¥æ ¸å¿ƒæ¨¡å—å‚æ•°

