---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# ç”¨ make è¿›è¡Œå®ç¼–è¯‘

## ğŸ€ ä¸ºä»€ä¹ˆè¦ç”¨ make

æ¥çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼šæ‰§è¡Œæ–‡æ¡£é‡Œé¢åŒ…å«äº† 4 ä¸ªæºç æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ `main.c`ã€ `haha.c`ã€ `sin_value.c`ã€ `cos_value.c`ã€

- `main.c`ï¼šä¸»è¦ç›®çš„æ˜¯è®©ç”¨æˆ·è¾“å…¥è§’åº¦æ•°æ®ä¸è°ƒç”¨å…¶ä»–ä¸‰ä¸ªå­ç¨‹åº
- `haha.c`ï¼šè¾“å‡ºä¸€å †æœ‰çš„æ²¡æœ‰çš„ä¿¡æ¯
- `sin_value.c`ï¼šè®¡ç®—ä½¿ç”¨è€…è¾“å…¥çš„è§’åº¦ï¼ˆ360ï¼‰sin æ•°å€¼
- `cos_value.c`ï¼šè®¡ç®—ä½¿ç”¨è€…è¾“å…¥çš„è§’åº¦ï¼ˆ360ï¼‰cos æ•°å€¼

`main.c`

```bash
#include <stdio.h>
#define pi 3.14159
char name[15];
float angle;

int main(void)
{
	printf ("\n\nPlease input your name: ");
	scanf  ("%s", &name );
	printf ("\nPlease enter the degree angle (ex> 90): " );
	scanf  ("%f", &angle );
	haha( name );
	sin_value( angle );
	cos_value( angle );
}
```

`haha.c`

```bash
#include <stdio.h>
int haha(char name[15])
{
	printf ("\n\nHi, Dear %s, nice to meet you.", name);
}

```

`sin_value.c`

```bash
#include <stdio.h>
#include <math.h>
#define pi 3.14159
float angle;

void sin_value(void)
{
	float value;
	value = sin ( angle / 180. * pi );
	printf ("\nThe Sin is: %5.2f\n",value);
}

```

`cos_value.c`

```bash
#include <stdio.h>
#include <math.h>
#define pi 3.14159
float angle;

void cos_value(void)
{
	float value;
	value = cos ( angle / 180. * pi );
	printf ("The Cos is: %5.2f\n",value);
}

```

```bash
# 1. å…ˆè¿›è¡Œç›®æ ‡æ–‡ä»¶çš„ç¼–è¯‘ï¼Œæœ€ç»ˆä¼šæœ‰ 4 ä¸ª *.o çš„æ–‡ä»¶å‡ºç°
[root@study ~]# gcc -c main.c 
[root@study ~]# gcc -c haha.c 
[root@study ~]# gcc -c sin_value.c 
[root@study ~]# gcc -c cos_value.c 

# 2. å†æ‰§è¡Œè¿ç»“ç§°ä¸ºæ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åŠ å…¥ libm çš„å‡½æ•°ï¼Œäº§ç”Ÿ man çš„æ‰§è¡Œæ–‡ä»¶
[root@study ~]# gcc -o man main.o haha.o sin_value.o cos_value.o  -lm

# 3. æ‰§è¡Œç¨‹åºï¼Œæ¯”å¦‚è¾“å…¥å§“åï¼Œ360 åº¦è§’çš„è§’åº¦å€¼æ¥è®¡ç®—
[root@study ~]# ./man 


Please input your name: mrcode		# è¾“å…¥å§“å
	
Please enter the degree angle (ex> 90): 30		# è¾“å…¥è§’åº¦


Hi, Dear mrcode, nice to meet you.
The Sin is:  0.50
The Cos is:  0.87
```

å¯ä»¥çœ‹åˆ°ç¼–è¯‘æŒ‡ä»¤å°±å˜å¾—å¤æ‚èµ·æ¥äº†ï¼Œå¦‚æœè¦é‡æ–°ç¼–è¯‘ï¼Œä¸Šè¿°æµç¨‹è¿˜éœ€è¦é‡æ–°æ¥ä¸€æ¬¡ï¼Œå¾ˆéº»çƒ¦

å¯ä»¥ä½¿ç”¨ make å·¥å…·ç®€åŒ–æˆ‘ä»¬çš„å·¥ä½œã€‚å…ˆå»ºç«‹ makefile çš„æ–‡ä»¶

```bash
# 1. å…ˆç¼–è¾‘ makefile è§„åˆ™æ–‡ä»¶ï¼Œå†…å®¹åªè¦åšå‡º man è¿™ä¸ªæ‰§è¡Œæ–‡ä»¶
[root@study ~]# vim makefile
main: main.o haha.o sin_value.o cos_value.o
        gcc -o main main.o haha.o sin_value.o cos_value.o -lm
# æ³¨æ„ç¬¬ 2 è¡Œæ•°æ®ï¼Œæ˜¯æŒ‰ tab äº§ç”Ÿçš„ç©ºæ ¼

# 2.å°è¯•ä½¿ç”¨ makefile æŒ‡å®šçš„è§„åˆ™è¿›è¡Œç¼–è¯‘è¡Œä¸º
# å…ˆæŠŠä¹‹å‰äº§ç”Ÿçš„ .o æ–‡ä»¶åˆ é™¤
[root@study ~]# rm -f main *.o
[root@study ~]# make          
cc    -c -o main.o main.c
cc    -c -o haha.o haha.c
cc    -c -o sin_value.o sin_value.c
cc    -c -o cos_value.o cos_value.c
gcc -o main main.o haha.o sin_value.o cos_value.o -lm

# æ­¤æ—¶ make ä¼šè¯»å– makefile çš„å†…å®¹ï¼Œå¹¶æ ¹æ®å†…å®¹ç›´æ¥ç¼–è¯‘ç›¸å…³çš„æ–‡ä»¶

# 3. åœ¨ä¸åˆ é™¤ä»»ä½•æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œé‡æ–°æ‰§è¡Œä¸€æ¬¡ç¼–è¯‘çš„åŠ¨ä½œ
[root@study ~]# make
make: `main' is up to date.
# åªä¼šæ‰§è¡Œæ›´æ–° update çš„åŠ¨ä½œ
```

ä¸Šé¢çš„æ‰§è¡Œï¼Œä»å‘½ä»¤è¡Œè¾“å‡ºæ¥çœ‹ï¼Œè·å–ä½ ä¼šè§‰å¾— shell script ä¹Ÿå¯ä»¥åšåˆ°ï¼Œçš„ç¡®æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ make æä¾›äº†å¢é‡ç¼–è¯‘çš„æœºåˆ¶ï¼Œä¸éœ€è¦ä½ è‡ªå·±å»å†™é‚£ä¹ˆå¤æ‚çš„æµç¨‹åˆ¤æ–­äº†ã€‚å¥½å¤„å¦‚ä¸‹ï¼š

- ç®€åŒ–ç¼–è¯‘æ—¶æ‰€éœ€è¦ä¸‹è¾¾çš„æŒ‡ä»¤
- è‹¥åœ¨ç¼–è¯‘å®Œæˆä¹‹åï¼Œä¿®æ”¹äº†æŸä¸ªæºç æ–‡ä»¶ï¼Œåˆ™ make ä»…ä¼šé’ˆå¯¹è¢«ä¿®æ”¹äº†çš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå…¶ä»–çš„ object file ä¸ä¼šå˜åŠ¨
- æœ€åå¯ä»¥ä¾ç…§ç›¸ä¾æ€§æ¥æ›´æ–°ï¼ˆupdateï¼‰æ‰§è¡Œæ–‡ä»¶

ä¸‹é¢é’ˆå¯¹ makefile çš„è¯­æ³•æ¥ä»‹ç»

## ğŸ€ makefile çš„åŸºæœ¬è¯­æ³•ä¸å˜é‡

makefile çš„è¯­æ³•å¤šè€Œå¤æ‚ï¼Œå¯ä»¥å‚è€ƒ [GUN å®˜ç½‘æ–‡æ¡£](http://www.gnu.org/software/make/manual/make.html)ï¼Œè¿™é‡Œä»…åšä¸€äº›åŸºæœ¬çš„è§„åˆ™ï¼Œé‡ç‚¹åœ¨äºä½ æ¥è§¦æºç çš„æ—¶å€™ï¼Œä¸è‡³äºææ…Œï¼ŒåŸºæœ¬è§„åˆ™å¦‚ä¸‹

```bash
ç›®æ ‡ï¼ˆtargetï¼‰ï¼šç›®æ ‡æ–‡ä»¶1 ç›®æ ‡æ–‡ä»¶2
<tab>	 gcc -o æ¬²å»ºç«‹çš„æ‰§è¡Œæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶1 ç›®æ ‡æ–‡ä»¶2
```

åœ¨ makefile ä¸­çš„è§„åˆ™åŸºæœ¬ä¸Šæ˜¯ï¼š

- `#` ä»£è¡¨æ‰¹æ³¨
- `<tab>` éœ€è¦åœ¨å‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦
- ç›®æ ‡ target ä¸ç›¸ä¾æ–‡ä»¶ï¼ˆç›®æ ‡æ–‡ä»¶ï¼‰ä¹‹é—´ä»¥ `:` åˆ†å‰²

å¯¹ä¸Šä¸Šé¢é‚£ä¸ªç¤ºä¾‹ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ‰§è¡ŒåŠ¨ä½œæ—¶ï¼Œå¦‚ä½•åšï¼Ÿæ¯”å¦‚å¢åŠ ä¸€ä¸ªæŒ‡ä»¤ï¼Œç›´æ¥æ¸…é™¤æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶ä¸æ‰§è¡Œæ–‡ä»¶

```bash
# 1. ç¼–è¾‘ makefile æ¥å»ºè®®æ–°çš„è§„åˆ™ï¼Œæ­¤è§„åˆ™çš„ç›®æ ‡ä¸º clean
[root@study ~]# vim makefile 
main: main.o haha.o sin_value.o cos_value.o
        gcc -o main main.o haha.o sin_value.o cos_value.o -lm
clean:
        rm -rf main.o haha.o sin_value.o cos_value.o
        
# 2. ä»¥æ–°çš„ç›®æ ‡ clean æµ‹è¯•æ‰§è¡Œ
[root@study ~]# make clean
rm -rf main.o haha.o sin_value.o cos_value.o
```

å¦‚æ­¤ä¸€æ¥ï¼Œmakefile é‡Œå°±å…·æœ‰è‡³å°‘ä¸¤ä¸ªç›®æ ‡ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¦‚ä¸‹ä¸€èµ·ç»„åˆæ‰§è¡Œ

```bash
[root@study ~]# make clean main
rm -rf main.o haha.o sin_value.o cos_value.o
cc    -c -o main.o main.c
cc    -c -o haha.o haha.c
cc    -c -o sin_value.o sin_value.c
cc    -c -o cos_value.o cos_value.c
gcc -o main main.o haha.o sin_value.o cos_value.o -lm
```

è¿™ä¸ªæ—¶å€™ï¼Œä½ ä¼šå‘ç° makefile ä¸­çš„é‡å¤æ•°æ®å¾ˆå¤šï¼Œå¯ä»¥é€šè¿‡å˜é‡æ¥é‡æ„

```bash
[root@study ~]# vim makefile 
LIBS = -lm
OBJS = main.o haha.o sin_value.o cos_value.o
main: ${OBJS}
        gcc -o main ${OBJS} ${LIBS}
clean:
        rm -rf main ${OBJS}
# ä¸€å®šè¦æ³¨æ„è¿™ä¸ª tab é”®çš„è¯­æ³•ï¼Œä¸èƒ½ä½¿ç”¨ç©ºæ ¼æ›¿ä»£çš„ï¼
```

ä¸ bash shell script çš„è¯­æ³•æœ‰ç‚¹ä¸å¤ªç›¸åŒï¼Œå˜é‡çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š

1. å˜é‡ä¸å˜é‡å†…å®¹ä»¥ `=` éš”å¼€ï¼ŒåŒæ—¶ä¸¤è¾¹å¯ä»¥æœ‰ç©ºæ ¼
2. å˜é‡å·¦è¾¹ä¸å¯ä»¥æœ‰ `<tab>`
3. å˜é‡ä¸å˜é‡å†…å®¹åœ¨ `=` ä¸¤è¾¹ä¸èƒ½æœ‰ `:`
4. åœ¨ä¹ æƒ¯ä¸Šï¼Œå˜é‡æœ€å¥½ä»¥å¤§å†™å­—æ¯ä¸ºä¸»
5. ä½¿ç”¨å˜é‡æ—¶ï¼Œä»¥ `${å˜é‡}ã€$(å˜é‡)`ä½¿ç”¨
6. åœ¨è¯¥ shell çš„ç¯å¢ƒå˜é‡æ˜¯å¯ä»¥è¢«å¥—ç”¨çš„ï¼Œä¾‹å¦‚æåˆ°çš„ CFLAGS è¿™ä¸ªå˜é‡
7. åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¹Ÿå¯ä»¥ç»™äºˆå˜é‡

ç”±äº gcc åœ¨ç¼–è¯‘çš„è¡Œä¸ºæ—¶ï¼Œä¼šä¸»åŠ¨è¯»å– CFLAGS è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨ shell å®šä¹‰å‡ºè¿™ä¸ªç¯å¢ƒå˜é‡

```bash
CFLAGS="-Wall" make clean main
# åœ¨ make è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä¼šè¯»å– CFLAGS çš„å˜é‡å†…å®¹

# è¿˜å¯ä»¥åœ¨ makefile ä¸­å®šä¹‰è¿™ä¸ªå˜é‡
```

å¦‚æœåœ¨æŒ‡ä»¤åˆ—å’Œ makefile ä¸­éƒ½è®¾ç½®äº† CFLAGS å˜é‡ï¼Œè€Œä¸”å†…å®¹ä¸åŒï¼Œé‚£ä¹ˆå“ªä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Ÿ

1. make æŒ‡ä»¤åˆ—ååŠ ä¸Šçš„ç¯å¢ƒå˜é‡ä¸ºä¼˜å…ˆ
2. makefile é‡Œé¢æŒ‡å®šçš„ç¯å¢ƒå˜é‡ç¬¬ 2
3. shell åŸæœ¬å…·æœ‰çš„ç¯å¢ƒå˜é‡ç¬¬ 3

æ­¤å¤–ï¼š`$@` è¿™ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œè¡¨ç¤ºç›®å‰çš„ç›®æ ‡ï¼ˆtargetï¼‰ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹ makefile ä¸º

```bash
[root@study ~]# vim makefile 
LIBS = -lm
OBJS = main.o haha.o sin_value.o cos_value.o
main: ${OBJS}
        gcc -o $@ ${OBJS} ${LIBS}		
        # è¿™é‡Œçš„ $@ å°±è¡¨ç¤ºæ˜¯ main è¿™ä¸ªå­—ç¬¦
clean:
        rm -rf main ${OBJS}
```





