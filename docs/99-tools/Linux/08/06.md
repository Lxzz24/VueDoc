---
title: å…¶ä»–å¸¸è§çš„åŽ‹ç¼©ä¸Žå¤‡ä»½å·¥å…·
sidebarDepth: 0 
category: Tools 
tag: Linux
---


## ðŸ€ dd

åœ¨å‰é¢ ç¬¬ä¸ƒç« ä¸­ç‰¹æ®Š loop è£…ç½®æŒ‚è½½æ—¶ä½¿ç”¨è¿‡ dd è¿™ä¸ªæŒ‡ä»¤ï¼Œdd æŒ‡ä»¤ä¸åªæ˜¯åˆ¶ä½œä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæœ€å¤§çš„åŠŸæ•ˆå¯èƒ½å°±æ˜¯å¤‡ä»½äº†ï¼Œå› ä¸º dd å¯ä»¥è¯»å–ç£ç›˜è£…ç½®çš„å†…å®¹ï¼ˆå‡ ä¹Žæ˜¯ç›´æŽ¥è¯»å–æ‰‡åŒº sectorï¼‰ï¼Œç„¶åŽå°†è£…ç½®å¤‡ä»½æˆä¸€ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢è®²è§£å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„é€‰é¡¹

```bash
dd if="input_file" of="output_file" bs="block_size" count="number"

ifï¼šè¾“å…¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯è£…ç½®
ofï¼šè¾“å‡ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯è£…ç½®
bsï¼šè§„åˆ’ä¸€ä¸ª block çš„å¤§å°ï¼Œè‹¥æœªæŒ‡å®šåˆ™é¢„è®¾ä¸º 512bytesï¼ˆä¸€ä¸ª sector å¤§å°ï¼‰
countï¼šå¤šå°‘ä¸ª bs
```

å®žè·µä¸Žç»ƒä¹ 

```bash
# å°† /etc/passwd å¤‡ä»½åˆ° /tmp/passwd.back ä¸­
[root@study ~]# dd if=/etc/passwd of=/tmp/passwd.back
è®°å½•äº†4+1 çš„è¯»å…¥
è®°å½•äº†4+1 çš„å†™å‡º
2323å­—èŠ‚(2.3 kB)å·²å¤åˆ¶ï¼Œ0.000202909 ç§’ï¼Œ11.4 MB/ç§’
[root@study ~]# ll /tmp/passwd.back /etc/passwd
-rw-r--r--. 1 root root 2323 10æœˆ  4 18:31 /etc/passwd
-rw-r--r--. 1 root root 2323 10æœˆ 29 09:37 /tmp/passwd.back
# /etc/passwd æ–‡ä»¶ä¸º 2323bytes
# æ²¡æœ‰è®¾ç½® bsï¼Œé»˜è®¤ä¸º 512bytesï¼Œ4+1 è¡¨ç¤ºæœ‰ 4 ä¸ªå®Œæ•´çš„ 512bytes
# ä»¥åŠä¸€ä¸ªæœªæ»¡ 512bytes çš„ block

# å°†åˆšåˆšåˆ»å½•çš„å…‰é©±å†…å®¹ï¼Œå†æ¬¡å¤‡ä»½ä¸‹æ¥ç§°ä¸ºæ˜ åƒæ–‡æ¡£
 [root@study ~]# dd if=/dev/sr0 of=/tmp/system.iso
è®°å½•äº†150708+0 çš„è¯»å…¥
è®°å½•äº†150708+0 çš„å†™å‡º
77162496å­—èŠ‚(77 MB)å·²å¤åˆ¶ï¼Œ0.503923 ç§’ï¼Œ153 MB/ç§’
[root@study ~]# ll /tmp/system.iso 
-rw-r--r--. 1 root root 77162496 10æœˆ 29 09:41 /tmp/system.iso
[root@study ~]# mount /tmp/system.iso /mnt/
mount: /dev/loop1 å†™ä¿æŠ¤ï¼Œå°†ä»¥åªè¯»æ–¹å¼æŒ‚è½½
[root@study ~]# ll /mnt/
æ€»ç”¨é‡ 62742
-r--r--r--. 1 root root      763 1æœˆ  22 2019 AUTORUN.INF
-r-xr-xr-x. 1 root root     6384 7æœˆ  12 17:06 autorun.sh
dr-xr-xr-x. 2 root root      792 7æœˆ  12 17:13 cert
dr-xr-xr-x. 2 root root     1824 7æœˆ  12 17:13 NT3x
dr-xr-xr-x. 2 root root     2652 7æœˆ  12 17:13 OS2
-r-xr-xr-x. 1 root root     4821 7æœˆ  12 17:06 runasroot.sh
-r--r--r--. 1 root root      547 7æœˆ  12 17:13 TRANS.TBL
-r--r--r--. 1 root root  3731646 7æœˆ  12 17:05 VBoxDarwinAdditions.pkg
-r--r--r--. 1 root root     3949 7æœˆ  12 17:05 VBoxDarwinAdditionsUninstall.tool
-r-xr-xr-x. 1 root root  8601012 7æœˆ  12 17:07 VBoxLinuxAdditions.run
-r--r--r--. 1 root root 16584704 7æœˆ  12 17:07 VBoxSolarisAdditions.pkg
-r-xr-xr-x. 1 root root 22909888 7æœˆ  12 17:12 VBoxWindowsAdditions-amd64.exe
-r-xr-xr-x. 1 root root   270104 7æœˆ  12 17:07 VBoxWindowsAdditions.exe
-r-xr-xr-x. 1 root root 12125152 7æœˆ  12 17:09 VBoxWindowsAdditions-x86.exe     
[root@study ~]# umount /mnt/
# æœ¬æ¥æ˜¯è™šæ‹Ÿæœºï¼Œä¸åº”è¯¥æœ‰å†…å®¹çš„æŠŠã€‚çœ‹ä¸‹æ–‡ä»¶å†…å®¹ï¼Œåº”è¯¥å°±æ˜¯è™šæ‹Ÿæœºçš„å·¥å…·ä¹‹ç±»çš„
[root@study ~]# ll /dev/sr0 
brw-rw----+ 1 root cdrom 11, 0 10æœˆ 28 21:38 /dev/sr0
[root@study ~]# mount /dev/sr0 /mnt/
mount: /dev/sr0 å†™ä¿æŠ¤ï¼Œå°†ä»¥åªè¯»æ–¹å¼æŒ‚è½½
[root@study ~]# ll /mnt/
æ€»ç”¨é‡ 62742
-r--r--r--. 1 root root      763 1æœˆ  22 2019 AUTORUN.INF
-r-xr-xr-x. 1 root root     6384 7æœˆ  12 17:06 autorun.sh
dr-xr-xr-x. 2 root root      792 7æœˆ  12 17:13 cert
dr-xr-xr-x. 2 root root     1824 7æœˆ  12 17:13 NT3x
dr-xr-xr-x. 2 root root     2652 7æœˆ  12 17:13 OS2
-r-xr-xr-x. 1 root root     4821 7æœˆ  12 17:06 runasroot.sh
-r--r--r--. 1 root root      547 7æœˆ  12 17:13 TRANS.TBL
-r--r--r--. 1 root root  3731646 7æœˆ  12 17:05 VBoxDarwinAdditions.pkg
-r--r--r--. 1 root root     3949 7æœˆ  12 17:05 VBoxDarwinAdditionsUninstall.tool
-r-xr-xr-x. 1 root root  8601012 7æœˆ  12 17:07 VBoxLinuxAdditions.run
-r--r--r--. 1 root root 16584704 7æœˆ  12 17:07 VBoxSolarisAdditions.pkg
-r-xr-xr-x. 1 root root 22909888 7æœˆ  12 17:12 VBoxWindowsAdditions-amd64.exe
-r-xr-xr-x. 1 root root   270104 7æœˆ  12 17:07 VBoxWindowsAdditions.exe
-r-xr-xr-x. 1 root root 12125152 7æœˆ  12 17:09 VBoxWindowsAdditions-x86.exe

# è¿™ä¸ªå®žä¾‹æ˜¯ç›´æŽ¥è®°å½•æ­¥éª¤ï¼Œç¬”è€…æ²¡æœ‰ usb çš„çŽ¯å¢ƒ
# å‡è®¾ä½ çš„ usb æ˜¯ /dev/sda ï¼Œå°†ä¸Šé¢çš„ image åˆ»å½•åˆ° USB ç£ç›˜ä¸­
lsblk /dev/sda
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda   8:0    0   2G   0 disk    				# è¿™é‡Œæ˜¯ disk 

dd if=/tmp/system.iso of=/dev/sda
mount /dev/sda /mnt
ll /mnt
# æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥ä½¿ç”¨è¿™é‡Œçš„ dd å°† iso æ–‡ä»¶å†™å…¥ USB ç£ç›˜
# é‚£ä¹ˆä¹…ä¼šå˜æˆå¯å¼€æœºå…‰ç›˜ä¸€æ ·çš„åŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ ç”¨ USB æ¥å®‰è£… linux ï¼Œé€Ÿåº¦å¿«å¾ˆå¤šï¼ˆå› ä¸º DVD åˆ»å½•å¾ˆæ…¢ï¼‰

# å°†ä½ çš„ /boot æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿé€šè¿‡ dd å¤‡ä»½ä¸‹æ¥
[root@study ~]# df -h /boot/
æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sda2      1014M  181M  834M   18% /boot
[root@study ~]# dd if=/dev/sda2 of=/tmp/sda2.img
è®°å½•äº†2097152+0 çš„è¯»å…¥
è®°å½•äº†2097152+0 çš„å†™å‡º
1073741824å­—èŠ‚(1.1 GB)å·²å¤åˆ¶ï¼Œ5.96824 ç§’ï¼Œ180 MB/ç§’
[root@study ~]# ll -h /tmp/sda2.img 
-rw-r--r--. 1 root root 1.0G 10æœˆ 29 09:52 /tmp/sda2.img

```

ä½¿ç”¨ dd æ¥å¤‡ä»½æ˜¯æ— å¯å¥ˆä½•çš„æƒ…å†µï¼Œå› ä¸ºé»˜è®¤ dd æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰‡åŒºåŽ»è¯»å†™çš„ï¼Œè€Œä¸”å³ä½¿æ²¡æœ‰ç”¨åˆ°çš„æ‰‡åŒºä¹Ÿä¼šå†™å…¥å¤‡ä»½æ¡£ä¸­ï¼Œå› æ­¤æ•´ä¸ªæ–‡ä»¶ä¼šå˜å¾—ä¸Žç£ç›˜ä¸€æ¨¡ä¸€æ ·å¤§ã€‚ç¼ºç‚¹å³ä¼˜ç‚¹ï¼Œå› æ­¤ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å®¹éƒ½å¯ä»¥å¤‡ä»½å’Œè¿˜åŽŸ

## ðŸ€ cpio

cpio å¯ä»¥å¤‡ä»½ä»»ä½•ä¸œè¥¿ï¼ŒåŒ…æ‹¬è£…ç½®è®¾å¤‡æ–‡ä»¶ã€‚ä¸è¿‡ cpio æœ‰ä¸ªå¤§é—®é¢˜ï¼Œä¸ä¼šä¸»åŠ¨æ‰¾æ–‡ä»¶ï¼Œè¢«åŠ¨æŽ¥æ”¶ï¼Œæ‰€ä»¥éœ€è¦é…åˆç±»ä¼¼ find ç­‰å¯ä»¥æ‰¾åˆ°æ–‡ä»¶åçš„æŒ‡ä»¤æ¥ä½¿ç”¨ï¼Œå› æ­¤æ¶‰åŠåˆ°äº†åŽç»­æ‰ä¼šè®²è§£çš„æ•°æ®æµé‡å¯¼å‘ã€‚

è¿™é‡Œå¦‚æžœä¸æ˜Žç™½ä»€ä¹ˆæ˜¯æ•°æ®æµé‡å¯¼å‘ï¼Œé‚£ä¹ˆåŽç»­å­¦ä¹ ä¹‹åŽå†å›žè¿‡å¤´æ¥çœ‹è¿™é‡Œ

```bash
å¤‡ä»½ï¼šcpio -ovcB > [file|device]
è¿˜åŽŸï¼šcpio -ivcdu < [file|device]
æŸ¥çœ‹ï¼šcpio -ivct < [file|device]
```

å¤‡ä»½é€‰é¡¹å‚æ•°ï¼š

- oï¼šå°†æ•°æ® copy è¾“å‡ºåˆ°æ–‡ä»¶æˆ–è£…ç½®ä¸Š
- Bï¼šè®©é¢„è®¾çš„ Blocks å¯ä»¥å¢žåŠ è‡³ 5120bytesï¼ˆé¢„è®¾æ˜¯ 512bytesï¼‰ï¼Œå¥½å¤„æ˜¯ï¼šå¯ä»¥è®©å¤§æ–‡ä»¶çš„å­˜å‚¨é€Ÿåº¦åŠ å¿«è®¸å¤šï¼ˆè¯·å‚è€ƒ i-nodes æ¦‚å¿µï¼‰

è¿˜åŽŸé€‰é¡¹å‚æ•°ï¼š

- iï¼šå°†æ•°æ®ä»Žæ–‡ä»¶æˆ–è£…ç½®ä¸­ copy å‡ºæ¥
- dï¼šè‡ªåŠ¨å»ºç«‹ç›®å½•ï¼Œä½¿ç”¨ cpio æ‰€å¤‡ä»½çš„æ•°æ®å†…å®¹ä¸è§å¾—ä¼šåœ¨åŒä¸€å±‚ç›®å½•ä¸­ï¼Œå› æ­¤å¿…é¡»è¦è®© cpio åœ¨è¿˜åŽŸæ—¶å¯ä»¥å»ºç«‹æ–°ç›®å½•
- uï¼šè‡ªåŠ¨çš„å°†è¾ƒæ–°çš„æ–‡ä»¶è¦†ç›–æ—§æ–‡ä»¶
- tï¼šéœ€è¦é…åˆ -i ä½¿ç”¨ï¼Œå¯ä»¥ç”¨åœ¨æŸ¥çœ‹ä»¥ cpio å»ºç«‹çš„æ–‡ä»¶æˆ–è£…ç½®çš„å†…å®¹

ä¸€äº›å…±äº«é€‰é¡¹å‚æ•°ï¼š

- vï¼šè¾“å‡ºå¤„ç†çš„æ–‡ä»¶å
- cï¼šä¸€ç§è¾ƒæ–°çš„ portable format æ–¹å¼å­˜å‚¨

å®žè·µç»ƒä¹ ï¼š

```bash
# æ‰¾å‡º /boot ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå°†å…¶å¤‡ä»½åˆ° /tmp/boot.cpio 
[root@study ~]# cd /
[root@study /]# find boot -print
boot
boot/efi
boot/efi/EFI
boot/efi/EFI/centos
boot/efi/EFI/centos/fw
....
# é€šè¿‡ find å¯ä»¥æ‰¾åˆ° boot ä¸‹å­˜åœ¨çš„æ–‡ä»¶ååŒ…æ‹¬æ–‡ä»¶ä¸Žç›®å½•ï¼Œä½†è¯·åƒä¸‡ä¸è¦æ˜¯ç»å¯¹è·¯å¾„
# å¦‚æžœæ˜¯ç»å¯¹è·¯å¾„ï¼Œå’Œä¹‹å‰è§£åŽ‹ç¼©æ—¶ç±»ä¼¼çš„é—®é¢˜

# è¿™é‡Œå°±çœ‹æ˜Žç™½äº†ï¼Œä¸Šé¢è¯­æ³•ä¸­å…¶å®žæ˜¯æ²¡æœ‰æŒ‡å®šéœ€è¦å¤‡ä»½çš„æ–‡ä»¶æœ‰å“ªäº›çš„
# è¿™é‡Œä½¿ç”¨ç®¡é“ç¬¦å·æŠŠ find boot æ‰¾åˆ°çš„æ–‡ä»¶åä¼ é€’ç»™äº†åŽç»­çš„ cpio å¤„ç†
[root@study /]# find boot | cpio -ocvB > /tmp/boot.cpio
[root@study /]# ll -h /tmp/boot.cpio 
-rw-r--r--. 1 root root 147M 10æœˆ 29 10:29 /tmp/boot.cpio
[root@study /]# file /tmp/boot.cpio 
/tmp/boot.cpio: ASCII cpio archive (SVR4 with no CRC)

# å°†åˆšåˆšçš„æ–‡ä»¶åœ¨ /root ç›®å½•ä¸‹è§£å¼€
[root@study /]# cd ~
[root@study ~]# cpio -idvc < /tmp/boot.cpio 
[root@study ~]# ll /root/boot/
æ€»ç”¨é‡ 135200
-rw-r--r--. 1 root root   152976 10æœˆ 29 10:31 config-3.10.0-1062.el7.x86_64
drwx------. 3 root root       17 10æœˆ 29 10:31 efi
drwxr-xr-x. 2 root root       27 10æœˆ 29 10:31 grub
drwx------. 5 root root       97 10æœˆ 29 10:31 grub2
-rw-------. 1 root root 78606868 10æœˆ 29 10:31 initramfs-0-rescue-f228ab37c368416c84c6b27971ba45a9.img
-rw-------. 1 root root 31799826 10æœˆ 29 10:31 initramfs-3.10.0-1062.el7.x86_64.img
-rw-r--r--. 1 root root   318717 10æœˆ 29 10:31 symvers-3.10.0-1062.el7.x86_64.gz
-rw-------. 1 root root  3594971 10æœˆ 29 10:31 System.map-3.10.0-1062.el7.x86_64
-rw-r--r--. 1 root root 10485760 10æœˆ 29 10:31 testing.img
-rwxr-xr-x. 1 root root  6734016 10æœˆ 29 10:31 vmlinuz-0-rescue-f228ab37c368416c84c6b27971ba45a9
-rwxr-xr-x. 1 root root  6734016 10æœˆ 29 10:31 vmlinuz-3.10.0-1062.el7.x86_64
```

cpio å¯ä»¥å°†ç³»ç»Ÿçš„æ•°æ®å®Œæ•´çš„å¤‡ä»½åˆ°ç£å¸¦æœºä¸ŠåŽ»ï¼š

- å¤‡ä»½ï¼š`find / | cpio -ocvB > /dev/st0`
- è¿˜åŽŸï¼š`cpio -idvc < /dev/sto`

è™½ç„¶ cpio ä¸æ˜¯ç‰¹åˆ«çš„æ–¹ä¾¿ï¼Œä½†æ˜¯å¤‡ä»½å¯æ˜¯åˆ©å™¨ï¼Œå› ä¸ºå¯ä»¥å¤‡ä»½ä»»ä½•æ–‡ä»¶ï¼ŒåŒ…æ‹¬ /dev/ ä¸‹çš„ä»»ä½•è£…ç½®æ–‡ä»¶

å…¶å®žç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªä½¿ç”¨ cpio å»ºç«‹çš„æ–‡ä»¶ /boot/initramfs-xxx ï¼ŒçŽ°åœ¨æ¥è§£å¼€ä»–çœ‹çœ‹

```bash
# å…ˆçœ‹ä¸‹å±žäºŽä»€ä¹ˆæ–‡ä»¶æ ¼å¼
[root@study ~]# file /boot/initramfs-3.10.0-1062.el7.x86_64.img 
/boot/initramfs-3.10.0-1062.el7.x86_64.img: gzip compressed data, from Unix, last modified: Fri Oct  4 18:31:46 2019, max compression

# å®Œäº†ï¼Œç¬”è€…çš„ç³»ç»Ÿæ¯”ä¹¦ä¸Šçš„æ–°ï¼Œå·²ç»ä¸æ˜¯ cpio çš„äº†
# é‚£ä¹ˆä¸‹é¢åªè®°å½•ä¸‹è§£å¼€æ­¥éª¤
mkdir /tmp/initramfs
cd /tmp/initramfs
cpio -idvc < /boot/initramfs-xx/img
```

