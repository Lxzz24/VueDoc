---
title: XFS æ–‡ä»¶ç³»ç»Ÿçš„å¤‡ä»½ä¸è¿˜åŸ
sidebarDepth: 0 
category: Tools 
tag: Linux
---


ä½¿ç”¨ tar é€šå¸¸æ˜¯é’ˆå¯¹ç›®å½•æ ‘ç³»ç»Ÿæ¥è¿›è¡Œå¤‡ä»½çš„å·¥ä½œï¼Œå¦‚æœæ˜¯é’ˆå¯¹æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¥è¿›è¡Œå¤‡ä»½ä¸è¿˜åŸã€‚åœ¨ CentOS 7 ä¸­å¯ä»¥ä½¿ç”¨ xfsdump ä¸ xfsrestore æŒ‡ä»¤æ¥è¿›è¡Œ

## ğŸ€ XFS æ–‡ä»¶ç³»ç»Ÿå¤‡ä»½ xfsdump

æ”¯æŒçš„åŠŸèƒ½ï¼š

- å…¨é‡å¤‡ä»½ï¼šå®Œæ•´å¤‡ä»½æ–‡ä»¶ç³»ç»Ÿï¼ˆfull backupï¼‰

- å¢é‡å¤‡ä»½ï¼šIncremental backup

  ç¬¬ä¸€æ¬¡å…¨é‡å¤‡ä»½ä¹‹åï¼Œå°±å¯ä»¥é€‰æ‹©å¢é‡å¤‡ä»½äº†

  å¢é‡å¤‡ä»½çš„å·®å¼‚æ–‡ä»¶å­˜æ”¾åœ¨ /var/lib/xfsdump/inventory ä¸­

xfsdump æœ‰å¦‚ä¸‹é™åˆ¶ï¼š

- ä¸æ”¯æŒæ²¡æœ‰æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿå¤‡ä»½ï¼Œæ‰€ä»¥åªèƒ½å¤‡ä»½å·²æŒ‚è½½çš„
- å¿…é¡»ä½¿ç”¨ root çš„æƒé™æ‰èƒ½æ“ä½œï¼Œæ¶‰åŠæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»
- åªèƒ½å¤‡ä»½ XFS æ–‡ä»¶ç³»ç»Ÿ
- å¤‡ä»½ä¸‹æ¥çš„æ•°æ®ï¼ˆæ–‡ä»¶æˆ–å­˜å‚¨åª’ä½“ï¼‰åªèƒ½è®© xfsrestore è§£æ
- æ˜¯é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„ UUID æ¥åˆ†è¾¨å„ä¸ªå¤‡ä»½æ¡£çš„ï¼Œå› æ­¤ä¸èƒ½å¤‡ä»½ä¸¤ä¸ªå…·æœ‰ç›¸åŒ UUID çš„æ–‡ä»¶ç³»ç»Ÿ

ç®€å•æ“ä½œæ—¶çš„è¯­æ³•å¦‚ä¸‹ï¼ˆå®Œæ•´çš„é€‰é¡¹éå¸¸å¤æ‚ï¼‰

```bash
xfsdump [-L S_label][-M M_label][-l #][-f å¤‡ä»½æ¡£] å¸¦å¤‡ä»½èµ„æ–™
xfsdump -I
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- Lï¼šxfsdump ä¼šè®°å½•æ¯æ¬¡å¤‡ä»½çš„ session æ ‡å¤´ï¼Œè¿™é‡Œå¯ä»¥å¡«å†™é’ˆå¯¹æ­¤æ–‡ä»¶ç³»ç»Ÿçš„å»ºè®®è¯´æ˜
- Mï¼šxfsdump å¯ä»¥è®°å½•å­˜å‚¨åª’ä½“çš„æ ‡å¤´ï¼Œè¿™é‡Œå¯ä»¥å¡«å†™æ­¤åª’ä½“çš„å»ºè®®è¯´æ˜
- lï¼šå°å†™çš„ Lï¼ŒæŒ‡å®šç­‰çº§ã€‚æœ‰ 0~9 å…± 10 ä¸ªç­‰çº§ï¼Œé¢„è®¾ä¸º 0 å®Œæ•´å¤‡ä»½
- fï¼šæœ‰ç‚¹ç±»ä¼¼ tarï¼Œåé¢æ¥äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ /dev/st0 è£…ç½®æ–‡ä»¶åæˆ–å…¶ä»–ä¸€èˆ¬æ–‡ä»¶åç­‰
- Iï¼šä» /var/lib/xfsdump/inventory åˆ—å‡ºç›®å‰å¤‡ä»½çš„ä¿¡æ¯çŠ¶æ€

æ³¨æ„ï¼šxfsdump é¢„è®¾ä»…æ”¯æŒæ–‡ä»¶ç³»ç»Ÿçš„å¤‡ä»½ï¼Œå¹¶ä¸æ”¯æŒç›®å½•çš„å¤‡ä»½ã€‚å¦‚ /etc ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿ

### ç”¨ xfsdump å¤‡ä»½å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿ

```bash
# 1. å…ˆç¡®å®š /boot æ˜¯ç‹¬ç«‹çš„é—®ä»·ç³»ç»Ÿ
[mrcode@study ~]$ df -h /boot/
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda2      1014M  171M  844M  17% /boot
# æŒ‚è½½ç‚¹æ˜¯ /boot æ–‡ä»¶ç³»ç»Ÿæ˜¯ /dev/sda2 è£…ç½®ï¼Œæ˜¯ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿ

# 2. å°†å®Œæ•´å¤‡ä»½çš„æ–‡ä»¶åè®°å½•ä¸º /srv/boot.dump
# æŒ‡å®šäº†ä¸€ä¸ªç­‰çº§0ï¼Œåé¢ lm éƒ½æ˜¯è¯´æ˜ï¼Œåé¢æ˜¯è¦ä¿å­˜çš„æ–‡ä»¶åœ°å€ï¼Œæœ€åæ˜¯è¦å¤‡ä»½çš„è£…ç½®
[root@study ~]# xfsdump -l 0 -L boot_all -M boot_all -f /srv/boot.dump /boot
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsdump: level 0 dump of study.centos.mrcode:/boot	# level 0 å¼€å§‹å¤‡ä»½æœ¬æœº /boot ç³»ç»Ÿ	
xfsdump: dump date: Tue Oct 29 03:03:50 2019  # å¤‡ä»½æ—¶é—´
xfsdump: session id: 49ac1ac5-c63b-4778-9b87-f77f3b1d703a # dump çš„ ID
xfsdump: session label: "boot_all"	# ä¸Šé¢å†™çš„è¯´æ˜
xfsdump: ino map phase 1: constructing initial dump list # å¼€å§‹å¤‡ä»½
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 144381568 bytes
xfsdump: /var/lib/xfsdump/inventory created
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files
xfsdump: ending media file
xfsdump: media file size 144048736 bytes
xfsdump: dump size (non-dir files) : 143807160 bytes
xfsdump: dump complete: 1 seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream 0 /srv/boot.dump OK (success)
xfsdump: Dump Status: SUCCESS
# å¦‚æœä¸åœ¨æŒ‡ä»¤ä¸­å¢åŠ  -L å’Œ -M ä¼šè¿›å…¥äº’åŠ¨æ¨¡å¼ï¼Œè®©ä½ æ‰‹åŠ¨å¡«å†™ç¡®è®¤åæ‰ä¼šå¼€å§‹å¤‡ä»½

[root@study ~]# ll /srv/boot.dump 
-rw-r--r--. 1 root root 144048736 10æœˆ 29 03:03 /srv/boot.dump

[root@study ~]# ll /var/lib/xfsdump/inventory/
æ€»ç”¨é‡ 16
-rw-r--r--. 1 root root  312 10æœˆ 29 03:03 13d0663f-4cbd-412d-aa9f-975eb18da590.InvIndex
-rw-r--r--. 1 root root 5080 10æœˆ 29 03:03 6ad3d9fa-9c06-4968-9250-c1a70b5629ed.StObj
-rw-r--r--. 1 root root  576 10æœˆ 29 03:03 fstab

```

### ç”¨ xfsdump è¿›è¡Œå¢é‡å¤‡ä»½ï¼ˆIncremental backupsï¼‰

å¢é‡æ˜¯åœ¨å…¨é‡çš„åŸºç¡€ä¸Šï¼Œä¹Ÿå°±æ˜¯è‡³å°‘æœ‰ level 0 ï¼Œæ‰èƒ½å¤Ÿå‡ åŒºæœ‰å…¶ä»–çš„å¢é‡å¤‡ä»½ï¼ˆ1~9ï¼‰

```bash
# æŸ¥çœ‹ xfsdump ä¿¡æ¯
[root@study ~]# xfsdump -I
file system 0:
        fs id:          13d0663f-4cbd-412d-aa9f-975eb18da590
        session 0:
                mount point:    study.centos.mrcode:/boot
                device:         study.centos.mrcode:/dev/sda2
                time:           Tue Oct 29 03:03:50 2019
                session label:  "boot_all"
                session id:     49ac1ac5-c63b-4778-9b87-f77f3b1d703a
                level:          0
                resumed:        NO
                subtree:        NO
                streams:        1
                stream 0:
                        pathname:       /srv/boot.dump
                        start:          ino 69 offset 0
                        end:            ino 1577745 offset 0
                        interrupted:    NO
                        media files:    1
                        media file 0:
                                mfile index:    0
                                mfile type:     data
                                mfile size:     144048736
                                mfile start:    ino 69 offset 0
                                mfile end:      ino 1577745 offset 0
                                media label:    "boot_all"
                                media id:       da10035c-1c0b-4773-a56e-409a17fe9913
xfsdump: Dump Status: SUCCESS

# å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ª level 0
# ä¸‹é¢å…ˆåœ¨ boot ä¸­å»ºç«‹ä¸€ä¸ªå¤§çº¦ 10MB çš„æ–‡ä»¶
[root@study ~]# dd if=/dev/zero of=/boot/testing.img bs=1M count=10
è®°å½•äº†10+0 çš„è¯»å…¥
è®°å½•äº†10+0 çš„å†™å‡º
10485760å­—èŠ‚(10 MB)å·²å¤åˆ¶ï¼Œ0.00396854 ç§’ï¼Œ2.6 GB/ç§’

# 2. å»ºç«‹å·®å¼‚å¤‡ä»½ï¼Œè¿™é‡Œä½¿ç”¨ -l 1 æŒ‡å®šäº† level 1 çš„è¢«å¢é‡å¤‡ä»½
[root@study ~]# dd if=/dev/zero of=/boot/testing.img bs=1M count=10
è®°å½•äº†10+0 çš„è¯»å…¥
è®°å½•äº†10+0 çš„å†™å‡º
10485760å­—èŠ‚(10 MB)å·²å¤åˆ¶ï¼Œ0.00396854 ç§’ï¼Œ2.6 GB/ç§’
[root@study ~]# xfsdump -l 1 -L boot_2 -M boot_2 -f /srv/boot.dump1 /boot
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsdump: level 1 incremental dump of study.centos.mrcode:/boot based on level 0 dump begun Tue Oct 29 03:03:50 2019
xfsdump: dump date: Tue Oct 29 03:11:00 2019
xfsdump: session id: 8a8a1680-2a91-4292-943d-0d0a51fa2d67
xfsdump: session label: "boot_2"
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: pruning unneeded subtrees
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 10506880 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files
xfsdump: ending media file
xfsdump: media file size 10510952 bytes
xfsdump: dump size (non-dir files) : 10488408 bytes
xfsdump: dump complete: 0 seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream 0 /srv/boot.dump1 OK (success)
xfsdump: Dump Status: SUCCESS

[root@study ~]# ll -h /srv/boot*
-rw-r--r--. 1 root root 138M 10æœˆ 29 03:03 /srv/boot.dump
-rw-r--r--. 1 root root  11M 10æœˆ 29 03:11 /srv/boot.dump1

# 3. æœ€åå†è§‚å¯Ÿä¸‹å¤‡ä»½æƒ…å†µ
[root@study ~]# xfsdump -I
file system 0:
        fs id:          13d0663f-4cbd-412d-aa9f-975eb18da590
        session 0:
                mount point:    study.centos.mrcode:/boot
                device:         study.centos.mrcode:/dev/sda2
                time:           Tue Oct 29 03:03:50 2019
                session label:  "boot_all"
                session id:     49ac1ac5-c63b-4778-9b87-f77f3b1d703a
                level:          0
                resumed:        NO
                subtree:        NO
                streams:        1
                stream 0:
                        pathname:       /srv/boot.dump
                        start:          ino 69 offset 0
                        end:            ino 1577745 offset 0
                        interrupted:    NO
                        media files:    1
                        media file 0:
                                mfile index:    0
                                mfile type:     data
                                mfile size:     144048736
                                mfile start:    ino 69 offset 0
                                mfile end:      ino 1577745 offset 0
                                media label:    "boot_all"
                                media id:       da10035c-1c0b-4773-a56e-409a17fe9913
        session 1:
                mount point:    study.centos.mrcode:/boot
                device:         study.centos.mrcode:/dev/sda2
                time:           Tue Oct 29 03:11:00 2019
                session label:  "boot_2"
                session id:     8a8a1680-2a91-4292-943d-0d0a51fa2d67
                level:          1
                resumed:        NO
                subtree:        NO
                streams:        1
                stream 0:
                        pathname:       /srv/boot.dump1
                        start:          ino 113 offset 0
                        end:            ino 114 offset 0
                        interrupted:    NO
                        media files:    1
                        media file 0:
                                mfile index:    0
                                mfile type:     data
                                mfile size:     10510952
                                mfile start:    ino 113 offset 0
                                mfile end:      ino 114 offset 0
                                media label:    "boot_2"
                                media id:       2c0d4e02-11cd-45a4-b131-8bc6505403fe
xfsdump: Dump Status: SUCCESS
# å¯ä»¥çœ‹åˆ°ä¸Šé¢å‡ºç°äº† session 1 å’Œ level 1
```

## ğŸ€ XFS æ–‡ä»¶ç³»ç»Ÿè¿˜åŸ xfsrestore

å¤‡ä»½æ–‡ä»¶å°±æ˜¯åœ¨æ€¥ç”¨æ—¶å¯ä»¥è¿˜åŸç³»ç»Ÿçš„é‡è¦æ•°æ®ï¼Œç”¨ xfsdump å¤‡ä»½çš„æ•°æ®å¯ä»¥ä½¿ç”¨ xfsresotre æ¥è¿˜åŸ

```bash
xfsrestore -I	# è§‚å¯Ÿå¤‡ä»½æ–‡ä»¶èµ„æ–™
xfsrestore [-f å¤‡ä»½æ–‡ä»¶å][-L S_label][-s] å¾…å¤åŸçš„ç›®å½•  # å•ä¸€æ–‡ä»¶å…¨ç³»ç»Ÿå¤åŸ
xfsrestore [-f å¤‡ä»½æ–‡ä»¶å] -r å¾…å¤åŸç›®å½•	# é€šè¿‡å¢é‡å¤‡ä»½æ–‡ä»¶å¤åŸç³»ç»Ÿ
xfsrestore [-f å¤‡ä»½æ–‡ä»¶å] -i å¾…å¤åŸç›®å½•	# è¿›å…¥äº’åŠ¨æ¨¡å¼
```

é€‰é¡¹ä¸å‚æ•°ï¼š

- Iï¼šä¸ xfsdump ç›¸åŒçš„è¾“å‡º
- fï¼šåé¢æ¥çš„å°±æ˜¯å¤‡ä»½çš„æ–‡ä»¶ï¼Œä¼ä¸šç•Œå¯èƒ½ä¼šæ¥ /dev/st0 ç­‰ç£å¸¦æœºï¼Œæˆ‘ä»¬è¿™é‡Œæ¥æ–‡ä»¶å
- Lï¼šsession çš„ label name ï¼Œå°±æ˜¯åœ¨ -I è¾“å‡ºä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®
- sï¼šéœ€è¦æ¥ç‰¹å®šç›®å½•ï¼Œå¤åŸæŸä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„æ„æ€
- rï¼šå¦‚æœæ˜¯ç”¨æ–‡ä»¶æ¥å­˜å‚¨å¤‡ä»½æ•°æ®ï¼Œè¿™ä¸ªé€‰é¡¹å°±ä¸éœ€è¦ä½¿ç”¨ã€‚å¦‚æœæ˜¯ä¸€ä¸ªç£å¸¦å†…æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œéœ€è¦è¿™ä¸œè¥¿æ¥è¾¾æˆå¢é‡å¤åŸ
- iï¼šè¿›å…¥äº’åŠ¨æ¨¡å¼ï¼Œè¿›é˜¶ç®¡ç†å‘˜ä½¿ç”¨çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸å¤ªéœ€è¦æ“ä½œå®ƒ

### ç”¨ xfsrestore è§‚å¯Ÿ xfsdump åçš„å¤‡ä»½æ•°æ®å†…å®¹

```bash
[root@study ~]# xfsrestore -I
file system 0:
        fs id:          13d0663f-4cbd-412d-aa9f-975eb18da590
        session 0:
                mount point:    study.centos.mrcode:/boot
                device:         study.centos.mrcode:/dev/sda2
                time:           Tue Oct 29 03:03:50 2019
                session label:  "boot_all"
                session id:     49ac1ac5-c63b-4778-9b87-f77f3b1d703a
                level:          0
                resumed:        NO
                subtree:        NO
                streams:        1
                stream 0:
                        pathname:       /srv/boot.dump
                        start:          ino 69 offset 0
                        end:            ino 1577745 offset 0
                        interrupted:    NO
                        media files:    1
                        media file 0:
                                mfile index:    0
                                mfile type:     data
                                mfile size:     144048736
                                mfile start:    ino 69 offset 0
                                mfile end:      ino 1577745 offset 0
                                media label:    "boot_all"
                                media id:       da10035c-1c0b-4773-a56e-409a17fe9913
        session 1:
								mount point:    study.centos.mrcode:/boot
                device:         study.centos.mrcode:/dev/sda2
                time:           Tue Oct 29 03:11:00 2019
                session label:  "boot_2"
                session id:     8a8a1680-2a91-4292-943d-0d0a51fa2d67
                level:          1
                resumed:        NO
                subtree:        NO
                streams:        1
                stream 0:
                        pathname:       /srv/boot.dump1
                        start:          ino 113 offset 0
                        end:            ino 114 offset 0
                        interrupted:    NO
                        media files:    1
                        media file 0:
                                mfile index:    0
                                mfile type:     data
                                mfile size:     10510952
                                mfile start:    ino 113 offset 0
                                mfile end:      ino 114 offset 0
                                media label:    "boot_2"
                                media id:       2c0d4e02-11cd-45a4-b131-8bc6505403fe
xfsrestore: Restore Status: SUCCESS
# å’Œå‰é¢è¾“å‡ºçš„ä¸€æ ·
# è¿™é‡Œé‡ç‚¹æ˜¯çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿæ˜¯ /boot æŒ‚è½½ç‚¹ï¼Œæœ‰ä¸¤ä¸ªå¤‡ä»½ level 0 å’Œ level 1
# å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªå¤‡ä»½æ–‡ä»¶çš„å¤§å°ï¼Œæ›´é‡è¦çš„æ˜¯ session label
```

### ç®€å•å¤åŸ level 0 çš„æ–‡ä»¶ç³»ç»Ÿ

```bash
# 1. ç›´æ¥å°†æ•°æ®è¦†ç›–å›å»å³å¯
# è¿™é‡Œä½¿ç”¨äº† -L å°±æ˜¯é‚£ä¸ª session label
[root@study ~]# xfsrestore -f /srv/boot.dump -L boot_all /boot
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: examining media file 0
xfsrestore: reading directories
xfsrestore: 11 directories and 337 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 0 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /srv/boot.dump OK (success)
xfsrestore: Restore Status: SUCCESS

# 2. å°†å¤‡ä»½èµ„æ–™åœ¨ /tmp/boot ä¸‹è§£å¼€
[root@study ~]# mkdir /tmp/boot
[root@study ~]# xfsrestore -f /srv/boot.dump -L boot_all /tmp/boot/
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: examining media file 0
xfsrestore: reading directories
xfsrestore: 11 directories and 337 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 0 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /srv/boot.dump OK (success)
xfsrestore: Restore Status: SUCCESS

# çœ‹åˆ°ä¸¤ä¸ªå¤§å°ä¸ä¸€è‡´
[root@study ~]# du -sm /boot/ /tmp/boot/
148     /boot/
138     /tmp/boot/

# å¯¹æ¯”ä¸‹å‘ç° /boot ä¸‹å¤šäº†ä¸€ä¸ª testing.img
[root@study ~]# diff -r /boot/ /tmp/boot/
åªåœ¨ /boot/ å­˜åœ¨ï¼štesting.img
```

è¿™é‡Œæ³¨æ„äº†ï¼Œç¬”è€…ä»¥ä¸ºè¿™æ ·å¤åŸä¹‹åï¼Œä¼šå®Œå…¨è¿˜åŸåˆ°å¤åŸä¹‹å‰çš„å†…å®¹çš„ï¼Œè¿™é‡Œçš„è§„åˆ™æ˜¯ï¼š**åŒåçš„æ–‡ä»¶è¢«è¦†ç›–ï¼Œå…¶ä»–ç³»ç»Ÿå†…çš„æ–°çš„é—®ä»·ä¼šè¢«ä¿ç•™** 

```bash
# 3. ä»…å¤åŸå¤‡ä»½æ¡£å†…çš„ grub2 åˆ° /tmp/boot2 é‡Œé¢å»
[root@study ~]# mkdir /tmp/boot2
[root@study ~]# xfsrestore -f /srv/boot.dump -L boot_all -s grub2 /tmp/boot2
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: examining media file 0
xfsrestore: reading directories
xfsrestore: 11 directories and 337 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 0 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /srv/boot.dump OK (success)
xfsrestore: Restore Status: SUCCESS
[root@study ~]# ll -h /tmp/boot2/
æ€»ç”¨é‡ 0
drwx------. 5 root root 97 10æœˆ  4 18:32 grub2

```

## ğŸ€ å¤åŸå¢é‡å¤‡ä»½èµ„æ–™

å¢é‡è¿˜åŸæœ‰é¡ºåºï¼Œæ¯”å¦‚ç”± level 0 -> level1 -> level2 é‚£ä¹ˆè¿˜åŸçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æŒ‰ç…§è¿™ä¸ªé¡ºåº

```bash
[root@study ~]# xfsrestore -f /srv/boot.dump1 /tmp/boot
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: searching media for dump
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: study.centos.mrcode
xfsrestore: mount point: /boot
xfsrestore: volume: /dev/sda2
xfsrestore: session time: Tue Oct 29 03:11:00 2019
xfsrestore: level: 1
xfsrestore: session label: "boot_2"
xfsrestore: media label: "boot_2"
xfsrestore: file system id: 13d0663f-4cbd-412d-aa9f-975eb18da590
xfsrestore: session id: 8a8a1680-2a91-4292-943d-0d0a51fa2d67
xfsrestore: media id: 2c0d4e02-11cd-45a4-b131-8bc6505403fe
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsrestore: 1 directories and 12 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: 0 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /srv/boot.dump1 OK (success)
xfsrestore: Restore Status: SUCCESS

```

### ä»…è¿˜åŸéƒ¨åˆ†æ–‡ä»¶çš„ xfsrestore äº’åŠ¨æ¨¡å¼

ä½¿ç”¨ -s å‚æ•°å¯ä»¥æ¥éƒ¨åˆ†æ•°æ®æ¥è¿˜åŸï¼Œå½“æ–‡ä»¶å¤ªå¤šæ—¶ï¼Œåˆä¸çŸ¥é“é‡Œé¢æœ‰å“ªäº›æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨äº’åŠ¨æ¨¡å¼ï¼Œæ¯”å¦‚æƒ³è¦çŸ¥é“ level0 çš„å¤‡ä»½æ•°æ®é‡Œé¢æœ‰å“ªäº›ä¸œè¥¿

```bash
[root@study ~]# xfsrestore -f /srv/boot.dump -i /tmp/boot3
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
xfsrestore: searching media for dump
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: study.centos.mrcode
xfsrestore: mount point: /boot
xfsrestore: volume: /dev/sda2
xfsrestore: session time: Tue Oct 29 03:03:50 2019
xfsrestore: level: 0
xfsrestore: session label: "boot_all"
xfsrestore: media label: "boot_all"
xfsrestore: file system id: 13d0663f-4cbd-412d-aa9f-975eb18da590
xfsrestore: session id: 49ac1ac5-c63b-4778-9b87-f77f3b1d703a
xfsrestore: media id: da10035c-1c0b-4773-a56e-409a17fe9913
xfsrestore: using online session inventory
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsrestore: 11 directories and 337 entries processed
xfsrestore: directory post-processing

 ========================== subtree selection dialog ==========================

the following commands are available:
        pwd 
        ls [ <path> ]
        cd [ <path> ]
        add [ <path> ]		# å¯ä»¥åŠ å…¥è¿˜åŸæ–‡ä»¶åˆ—è¡¨ä¸­
        delete [ <path> ] # ä»è¿˜åŸåˆ—è¡¨ä¸­åˆ é™¤æ–‡ä»¶ï¼Œä¸æ˜¯åˆ é™¤ï¼Œåªæ˜¯ä»åˆ—è¡¨ä¸­ç§»å‡ºå»
        extract 	# å¼€å§‹è¿˜åŸåŠ¨ä½œ
        quit 
        help 

-> ls		# ls æŸ¥çœ‹æœ‰å“ªäº›æ–‡æ¡£
              75 initramfs-3.10.0-1062.el7.x86_64.img 
              77 vmlinuz-0-rescue-f228ab37c368416c84c6b27971ba45a9 
              76 initramfs-0-rescue-f228ab37c368416c84c6b27971ba45a9.img 
              74 vmlinuz-3.10.0-1062.el7.x86_64 
              73 symvers-3.10.0-1062.el7.x86_64.gz 
              72 config-3.10.0-1062.el7.x86_64 
              71 System.map-3.10.0-1062.el7.x86_64 
              70 .vmlinuz-3.10.0-1062.el7.x86_64.hmac 
              68 grub/
         1572928 grub2/
              67 efi/

 -> add grub/

 -> add grub2/

 -> add config-3.10.0-229.el7.x86_64
config-3.10.0-229.el7.x86_64 not found			# è¿™ä¸ªé‡Œé¢ä¸èƒ½æŒ‰é€€æ ¼é”®ï¼Œæˆ‘è¾“å‡ºäº†ï¼Œä¸è¿‡æç¤ºæœªæ‰¾åˆ°

 -> extract
 --------------------------------- end dialog ---------------------------------

xfsrestore: restoring non-directory files
xfsrestore: restore complete: 182 seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream 0 /srv/boot.dump OK (success)
xfsrestore: Restore Status: SUCCESS

# æŸ¥çœ‹è¿˜åŸçš„ç›®å½•ä¸‹ï¼Œçš„ç¡®åªæœ‰æˆ‘ä»¬éœ€è¦çš„ä¸¤ä¸ª
[root@study ~]# ls -l /tmp/boot3
æ€»ç”¨é‡ 0
drwxr-xr-x. 2 root root 27 10æœˆ  4 18:22 grub
drwx------. 5 root root 97 10æœˆ  4 18:32 grub2

```

