---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
## ğŸ€ ç‰¹æ®Šæ–‡ä»¶ä¸è¿›ç¨‹

åœ¨ç¬¬ 6 ç« ä¸­è®²åˆ°ç‰¹æ®Šæƒé™ SUIDã€SGIDã€SBITï¼Œé‚£ä¹ˆè¿™äº›æƒé™å¯¹äºä½ çš„ **è¿›ç¨‹** æ˜¯å¦‚ä½•å½±å“çš„ï¼Ÿè¿›ç¨‹ç”¨åˆ°çš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚ç¡¬ç›˜èµ„æºï¼Œä½¿ç”¨ umount ç¡¬ç›˜æ—¶ï¼Œå‡ºç°æç¤º ã€Œdevice is busyã€çš„æç¤ºæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

## ğŸ€ å…·æœ‰ SUIDã€SGID æƒé™çš„æŒ‡ä»¤æ‰§è¡ŒçŠ¶æ€

SUID çš„æƒé™ä¸è¿›ç¨‹çš„ç›¸å…³æ€§éå¸¸å¤§ï¼ŒSUID çš„ç¨‹åºæ˜¯å¦‚ä½•è¢«ä¸€èˆ¬ç”¨æˆ·æ‰§è¡Œï¼Œå…·æœ‰ä»€ä¹ˆç‰¹è‰²ï¼Ÿ

- SUID æƒé™ä»…å¯¹äºŒè¿›åˆ¶ç¨‹åºï¼ˆbinary programï¼‰æœ‰æ•ˆ
- æ‰§è¡Œè€…å¯¹äºè¯¥è¿›ç¨‹éœ€è¦å…·æœ‰ x çš„å¯æ‰§è¡Œæƒé™
- æœ¬æƒé™ä»…åœ¨æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼ˆrun-timeï¼‰
- æ‰§è¡Œè€…å°†å…·æœ‰è¯¥ç¨‹åºæ‹¥æœ‰è€…ï¼ˆownerï¼‰çš„æƒé™

æ‰€ä»¥ï¼Œæ•´ä¸ª SUID çš„æƒé™ä¼šç”Ÿæ•ˆæ˜¯ç”±äº**å…·æœ‰è¯¥æƒé™çš„ç¨‹åºè¢«è§¦å‘**ï¼Œä¸€ä¸ªè¿›ç¨‹è¡¨ç¤ºä¸€ä¸ªç¨‹åºçš„è¿è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œè€…å¯ä»¥å…·æœ‰ç¨‹åºæ‹¥æœ‰è€…çš„æƒé™å°±æ˜¯åœ¨è¯¥ç¨‹åºå˜æˆè¿›ç¨‹çš„æ—¶å€™

æ¯”å¦‚æ‰§è¡Œäº† passwd åä½ å°±å…·æœ‰ root çš„æƒé™ï¼Ÿæ˜¯å› ä¸ºä½ å†è§¦å‘ passwd åï¼Œä¼šå–å¾—ä¸€ä¸ªæ–°çš„è¿›ç¨‹ä¸ PIDï¼Œè¯¥ PID äº§ç”Ÿæ—¶é€šè¿‡ SUID æ¥ç»™äºˆè¯¥ PID ç‰¹æ®Šçš„æƒé™è®¾ç½®

ä¸‹é¢ä½¿ç”¨ mrcode ç™»å½•ç³»ç»Ÿå¹¶æ‰§è¡Œ passwd åï¼Œé€šè¿‡å·¥ä½œæ§åˆ¶æ¥ç†è§£

```bash
[mrcode@study ~]$ export LANG=C
[mrcode@study ~]$ passwd
Changing password for user mrcode.
Changing password for mrcode.
(current) UNIX password: 		# è¿™é‡ŒæŒ‰ä¸‹ ctrl + zï¼Œå¹¶æŒ‰ä¸‹ enter é”®

[1]+  Stopped                 passwd
[mrcode@study ~]$ pstree -uA
systemd-+-ModemManager---2*[{ModemManager}]
        |-sshd-+-sshd---sshd(mrcode)-+-bash---su(root)---bash
        |      |                     |-bash---top
        |      |                     |-bash---sleep
        |      |                     `-sftp-server
        |      `-sshd---sshd(mrcode)-+-bash-+-passwd(root)
        |                            |      `-pstree
        |                            |-bash---top
        |                            |-bash---sleep
        |                            `-sftp-server

```

ä»ä¸Šé¢çš„è¿›ç¨‹æ¥çœ‹ï¼Œåœ¨æ‰§è¡Œ passwd å‰æ˜¯ mrcode çš„æƒé™ï¼Œpasswd åˆ™æ˜¯ root æƒé™ï¼Œpasswd æ˜¯ç”± bash è¡ç”Ÿå‡ºæ¥çš„ï¼Œä½†æ˜¯æƒé™ä¸ä¸€æ ·ï¼Œè¿™æ ·ä¸€æ¥å°±èƒ½ç†è§£ä¸ºä»€ä¹ˆä¸åŒç¨‹åºæ‰€äº§ç”Ÿçš„æƒé™ä¸åŒäº†ï¼Œæ˜¯ç”±äº SUID ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„è¿›ç¨‹çš„å…³ç³»

```bash
[mrcode@study ~]$ type passwd
passwd is hashed (/usr/bin/passwd)
[mrcode@study ~]$ ll /usr/bin/passwd
-rwsr-xr-x. 1 root root 27856 Aug  9  2019 /usr/bin/passwd
#å¯ä»¥çœ‹åˆ°ï¼Œçš„ç¡®è¯¥æŒ‡ä»¤ä¹Ÿæœ‰ s æƒé™

# è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æŸ¥æ‰¾ SUID/SGID çš„æ–‡ä»¶
find / -perm /6000
```

## ğŸ€  `/proc/*` ä»£è¡¨çš„æ„ä¹‰

è¿›ç¨‹åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜ä¸­çš„æ•°æ®éƒ½æ˜¯å†™å…¥åˆ° `/proc/*` ç›®å½•ä¸‹çš„ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹è¯¥ç›®å½•

```bash
[mrcode@study ~]$ ll /proc/
total 0
dr-xr-xr-x.  9 root           root                         0 Mar 15 20:13 1
dr-xr-xr-x.  9 root           root                         0 Mar 15 20:13 10
dr-xr-xr-x.  9 root           root                         0 Mar 15 20:13 11
...
dr-xr-xr-x.  2 root           root                         0 Mar 15 20:54 sysvipc
-r--r--r--.  1 root           root                         0 Mar 15 20:54 timer_list
-rw-r--r--.  1 root           root                         0 Mar 15 20:54 timer_stats
dr-xr-xr-x.  4 root           root                         0 Mar 15 20:54 tty
-r--r--r--.  1 root           root                         0 Mar 15 20:16 uptime
-r--r--r--.  1 root           root                         0 Mar 15 20:54 version
-r--------.  1 root           root                         0 Mar 15 20:54 vmallocinfo
-r--r--r--.  1 root           root                         0 Mar 15 20:54 vmstat
-r--r--r--.  1 root           root                         0 Mar 15 20:54 zoneinfo

```

åŸºæœ¬ä¸Šï¼Œç›®å‰ä¸»æœºä¸Šé¢çš„å„ä¸ªè¿›ç¨‹çš„ PID éƒ½æ˜¯ä»¥ç›®å½•çš„å½¢æ€å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚å¦‚ç¬¬ 1 è¡Œçš„ PID ä¸º 1ï¼Œå®ƒæ˜¯å¼€æœºæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç¨‹åº systemdï¼Œè¯¥ PID çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯éƒ½å†™å…¥åœ¨ `/proc/1/*` ä¸‹é¢

```bash
[root@study ~]# ll /proc/1
total 0
dr-xr-xr-x. 2 root root 0 Mar 15 20:48 attr
-rw-r--r--. 1 root root 0 Mar 15 20:53 autogroup
-r--------. 1 root root 0 Mar 15 20:53 auxv
-r--r--r--. 1 root root 0 Mar 15 20:13 cgroup
-r--r--r--. 1 root root 0 Mar 15 20:13 cmdline			# æŒ‡ä»¤ä¸²
-r--------. 1 root root 0 Mar 15 20:13 environ			# ä¸€äº›ç¯èŠ‚å˜é‡
lrwxrwxrwx. 1 root root 0 Mar 15 20:13 exe -> /usr/lib/systemd/systemd

```

é‡Œé¢æ•°æ®å¾ˆå¤šï¼Œå¯ä»¥æŸ¥è¯¢ä¸‹ cmdline çš„å†…å®¹

```bash
[root@study ~]# cat /proc/1/cmdline
/usr/lib/systemd/systemd--switched-root--system--deserialize22
```

ä¸Šé¢æŒ‡ä»¤æ˜¾ç¤ºäº†æ˜¯ä»¥ä»€ä¹ˆå‚æ•°å¯åŠ¨çš„ systemd æŒ‡ä»¤ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹ PID æœ‰å…³çš„å†…å®¹ï¼Œä¸‹é¢æ˜¯é’ˆå¯¹æ•´ä¸ª Linux ç³»ç»Ÿç›¸å…³çš„å‚æ•°ï¼Œå¯¹åº”ä¸ /proc ç›®å½•ä¸‹çš„æ–‡ä»¶å¦‚ä¸‹

| æ–‡ä»¶å              | æ–‡ä»¶å†…å®¹                                                     |
| ------------------- | ------------------------------------------------------------ |
| `/proc/cmdline`     | åŠ è½½ kernel æ—¶æ‰€ä¸‹è¾¾çš„ç›¸å…³æŒ‡ä»¤ä¸å‚æ•°ï¼ŒæŸ¥è¯¢æ­¤æ–‡ä»¶ï¼Œå¯äº†è§£æŒ‡ä»¤æ˜¯å¦‚ä½•å¯åŠ¨çš„ |
| `/proc/cpuinfo`     | æœ¬æœºçš„ CPU ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…å«é¢‘ç‡ã€ç±»å‹ä¸è®¡ç®—åŠŸèƒ½ç­‰              |
| `/proc/devices`     | ç³»ç»Ÿå„ä¸ªä¸»è¦è£…ç½®çš„ä¸»è¦è£…ç½®ä»£å·ï¼Œä¸ mknod æœ‰å…³                |
| `/proc/filesystems` | ç›®å‰ç³»ç»Ÿå·²ç»åŠ è½½çš„æ–‡ä»¶ç³»ç»Ÿ                                   |
| `/proc/interrupts`  | ç›®å‰ç³»ç»Ÿä¸Š IRQ åˆ†é…çŠ¶æ€                                      |
| `/proc/ioports`     | ç›®å‰ç³»ç»Ÿä¸Šå„ä¸ªè£…ç½®æ‰€é…ç½®çš„ I/O åœ°å€                          |
| `/proc/kcore`       | å†…å­˜å¤§å°ï¼Œå¾ˆå¤§ï¼Ÿä¸è¦è¯»å–è¯¥æ–‡ä»¶                               |
| `/proc/loadavg`     | top ä»¥åŠ uptime çš„ä¸‰ä¸ªå¹³å‡æ•°å€¼å°±æ˜¯è®°å½•åœ¨è¿™é‡Œçš„               |
| `/proc/meminfo`     | ä½¿ç”¨ free åˆ—å‡ºçš„å†…å­˜ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°                 |
| `/proc/modules`     | ç›®å‰æˆ‘ä»¬ LInux å·²ç»åŠ è½½çš„æ¨¡å—åˆ—è¡¨ï¼Œå¯ä»¥çœ‹æˆæ˜¯é©±åŠ¨ç¨‹åº        |
| `/proc/mounts`      | ç³»ç»Ÿå·²ç»æŒ‚è½½çš„æ•°æ®ï¼Œå°±æ˜¯ç”¨ mount æŒ‡ä»¤æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®          |
| `/proc/swaps`       | ç³»ç»ŸæŒ‚è½½çš„å†…å­˜åœ¨å“ªé‡Œï¼Ÿä½¿ç”¨æ‰çš„ partition è®°å½•åœ¨è¿™é‡Œ          |
| `/proc/partitions`  | ä½¿ç”¨ fsidk -l ä¼šå‡ºç°ç›®å‰æ‰€æœ‰çš„ partitionï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ä¹Ÿæœ‰è®°å½• |
| `/proc/uptime`      | ä½¿ç”¨ uptime å‡ºç°çš„ä¿¡æ¯                                       |
| `/proc/version`     | æ ¸å¿ƒçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ uname -a æ˜¾ç¤ºçš„ä¿¡æ¯                         |
| `/proc/bus/*`       | ä¸€äº›æ€»çº¿çš„è£…ç½®ï¼Œè¿˜æœ‰ USB çš„è£…ç½®ä¹Ÿè®°å½•åœ¨è¿™é‡Œ                  |

è¿™äº›æ–‡ä»¶å†…å®¹å»ºè®®ä½¿ç”¨ cat å»æŸ¥é˜…çœ‹çœ‹ï¼Œä¸å¿…æ·±å…¥äº†è§£ï¼Œå¦‚æœæœªæ¥ä½ è¦å†™æŸäº›å·¥å…·è½¯ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®å½•ä¸‹ç›¸å…³æ–‡ä»¶å¯èƒ½ä¼šå¯¹ä½ æœ‰ç‚¹å¸®åŠ©

## ğŸ€ æŸ¥è¯¢å·²å¼€å¯æ–‡ä»¶æˆ–å·²æ‰§è¡Œè¿›ç¨‹å¼€å¯ä¹‹æ–‡ä»¶

è¿˜æœ‰ä¸€äº›ä¸è¿›ç¨‹ç›¸å…³çš„æŒ‡ä»¤å¯ä»¥å‚è€ƒä¸åº”ç”¨

### fuserï¼šç”±æ–‡ä»¶ï¼ˆæˆ–æ–‡ä»¶ç³»ç»Ÿï¼‰æ‰¾å‡ºæ­£åœ¨ä½¿ç”¨è¯¥æ–‡ä»¶çš„è¿›ç¨‹

```bash
fuser [-umv] [-k [i] [signal]] file/dir

é€‰é¡¹ä¸å‚æ•°ï¼š
	-uï¼šé™¤äº†è¿›ç¨‹çš„ PID ä¹‹å¤–ï¼ŒåŒæ—¶åˆ—å‡ºè¯¥è¿›ç¨‹çš„æ‹¥æœ‰è€…
	-mï¼šåé¢æ¥çš„æ–‡ä»¶åä¼šä¸»åŠ¨çš„ä¸Šæåˆ°è¯¥æ–‡ä»¶ç³»ç»Ÿçš„æœ€é¡¶å±‚ï¼Œå¯¹ umount ä¸æˆåŠŸå¾ˆæœ‰æ•ˆ
	-vï¼šå¯ä»¥åˆ—å‡ºæ¯ä¸ªæ–‡ä»¶ä¸è¿›ç¨‹è¿˜æœ‰æŒ‡ä»¤çš„å®Œæ•´ç›¸å…³æ€§
	-kï¼šæ‰¾å‡ºä½¿ç”¨è¯¥æ–‡ä»¶/ç›®å½•çš„ PIDï¼Œå¹¶è¯•å›¾ä»¥ SIGKILL è¿™ä¸ªä¿¡å·ç»™äºˆè¯¥ PID
	-iï¼šå¿…é¡»ä¸ -k é…åˆä½¿ç”¨ï¼Œåœ¨åˆ é™¤ PID ä¹‹å‰ä¼šå…ˆè¯¢é—®ä½¿ç”¨è€…
	-signalï¼šä¾‹å¦‚ -1 -15 ç­‰ï¼Œè‹¥ä¸åŠ çš„è¯ï¼Œé¢„è®¾æ˜¯ -9ï¼šSIGKILL
```

```bash
# èŒƒä¾‹ 1ï¼šæ‰¾å‡ºç›®å‰æ‰€åœ¨ç›®å½•çš„ä½¿ç”¨ PIDã€æ‰€å±è´¦æˆ·ã€æƒé™
[root@study ~]# fuser -uv .
                     USER        PID ACCESS COMMAND
/root:               root       2604 ..c.. (root)bash

```

æœ‰ä¸€ä¸ªè¿›ç¨‹å±äº rootï¼Œè€Œ ACCESS é¡¹åˆ™ç•¥ä¸ºå¤æ‚ä¸€ç‚¹ï¼š

- cï¼šæ­¤è¿›ç¨‹åœ¨å½“å‰çš„ç›®å½•ä¸‹ï¼ˆéæ¬¡ç›®å½•ï¼‰
- eï¼šå¯è¢«è§¦å‘ä¸ºæ‰§è¡ŒçŠ¶æ€
- fï¼šæ˜¯ä¸€ä¸ªè¢«å¼€å¯çš„æ–‡ä»¶
- rï¼šä»£è¡¨é¡¶å±‚ç›®å½•ï¼ˆroot directoryï¼‰
- Fï¼šè¯¥æ–‡ä»¶è¢«å¼€å¯äº†ï¼Œä¸è¿‡åœ¨ç­‰å¾…å›åº”ä¸­
- mï¼šå¯èƒ½ä¸ºåˆ†äº«çš„åŠ¨æ€å‡½æ•°åº“

å¦‚æœæƒ³çŸ¥é“æŸä¸ªæ–‡ä»¶ç³»ç»Ÿä¸‹åˆå¤šå°‘è¿›ç¨‹æ­£åœ¨å ç”¨è¯¥æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `-m` é€‰é¡¹

ä¸‹é¢åšå‡ ä¸ªç®€å•æµ‹è¯•ï¼ŒåŒ…æ‹¬å®ä½“æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ /proc è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„å†…å®¹ï¼Œçœ‹çœ‹æœ‰å¤šå°‘çš„è¿›ç¨‹å¯¹è¿™äº›æŒ‚è½½ç‚¹æˆ–å…¶ä»–ç›®å½•çš„ä½¿ç”¨çŠ¶æ€

```bash
# èŒƒä¾‹ 2ï¼šæ‰¾åˆ°æ‰€æœ‰ä½¿ç”¨åˆ° /proc è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹
[root@study ~]# fuser -uv /proc/
                     USER        PID ACCESS COMMAND
/proc:               root     kernel mount (root)/proc
                     rtkit       834 .rc.. (rtkit)rtkit-daemon

[root@study ~]# fuser -muv /proc/
                     USER        PID ACCESS COMMAND
/proc:               root     kernel mount (root)/proc
                     root          1 f.... (root)systemd
                     root        589 f.... (root)systemd-journal
                     rtkit       834 .rc.. (rtkit)rtkit-daemon
                     root        844 f.... (root)udisksd
                     root        929 f.... (root)NetworkManager
                     root       1277 F.... (root)libvirtd
                     root       1638 F.... (root)X
                     gdm        1693 f.... (gdm)gnome-shell
                     root       1759 f.... (root)packagekitd
                     mrcode     2280 f.... (mrcode)top
                     mrcode     7722 f.... (mrcode)top
# è¿™å°±èƒ½çœ‹åˆ°æœ‰å‡ ä¸ªç¨‹åºåœ¨å¯¹è¯¥ç›®å½•è¿›è¡Œå­˜å–


# èŒƒä¾‹ 3ï¼šæ‰¾åˆ°æ‰€æœ‰ä½¿ç”¨åˆ° /home è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹
[root@study ~]# echo $$
2604				# å…ˆç¡®å®šä¸‹è‡ªå·±çš„ bash çš„è¿›ç¨‹ PID
[root@study ~]#  cd /home/
[root@study home]# fuser -muv .
                     USER        PID ACCESS COMMAND
/home:               root     kernel mount (root)/home
                     mrcode     1346 ..c.. (mrcode)bash
                     mrcode     1371 ..c.. (mrcode)bash
                     mrcode     1378 ..c.. (mrcode)sleep
                     mrcode     1399 ..c.. (mrcode)sleep
                     mrcode     1958 ..c.. (mrcode)bash
                     mrcode     1991 ..c.. (mrcode)sftp-server
                     mrcode     1992 ..c.. (mrcode)bash
                     mrcode     2280 ..c.. (mrcode)top
                     root       2604 ..c.. (root)bash			# çœ‹è¿™é‡Œï¼Œè‡ªå·±çš„ bash å­˜åœ¨åˆ—è¡¨ä¸­
                     mrcode     7294 ..c.. (mrcode)bash
                     mrcode     7358 ..c.. (mrcode)sftp-server
                     mrcode     7362 ..c.. (mrcode)bash
                     mrcode     7722 ..c.. (mrcode)top
                     root       8884 ..c.. (root)passwd

[root@study home]# cd ~
[root@study ~]# umount /home/
umount: /home: target is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
# é€šè¿‡ fuser çŸ¥é“æœ‰å¥½å‡ ä¸ªè¿›ç¨‹åœ¨è¯¥ç›®å½•ä¸‹è¿è¡Œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ä¸€ä¸ªä¸€ä¸ªåˆ é™¤
[root@study ~]# fuser -mki /home/
/home:                7294c  7358c  7362c  7722c  8884c 19238c 19289c 19291c 19601c 25650c 25674c 25685c 25746c
Kill process 7294 ? (y/N)
# ä»¥ä¸ŠæŒ‡ä»¤æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé¢‡ä¸ºæ£˜æ‰‹ï¼Œå°±æ˜¯å¾ˆå®¹æ˜“æ€åˆ°è‡ªå·± bash çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆä¹…ç›´æ¥æŠŠç›´æ¥è¸¢æ‰äº†
# ä¸çŸ¥é“è¿™ä¸ªè¿™ä¹ˆæ’é™¤æ‰æ˜¯å‡ºæ–¹ä¾¿çš„
```

ä¸Šé¢å¯ä»¥é’ˆå¯¹æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå…¶å®ä¹Ÿå¯ä»¥é’ˆå¯¹å•ä¸€æ–‡ä»¶

```bash
# èŒƒä¾‹ 4ï¼šæ‰¾åˆ° /run ä¸‹å±äº FIFO ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶æ‰¾å‡ºå­˜å–è¯¥æ–‡ä»¶çš„è¿›ç¨‹
[root@study ~]# find /run -type p
/run/dmeventd-client
/run/dmeventd-server
/run/systemd/inhibit/7.ref
/run/systemd/inhibit/6.ref
/run/systemd/inhibit/5.ref
/run/systemd/inhibit/4.ref
/run/systemd/inhibit/2.ref
/run/systemd/inhibit/1.ref
/run/systemd/sessions/13.ref
/run/systemd/sessions/5.ref
/run/systemd/sessions/c1.ref
/run/systemd/initctl/fifo

# éšä¾¿æ‰¾åˆ°æ–‡ä»¶æµ‹è¯•
[root@study ~]# fuser -uv /run/systemd/sessions/c1.ref
                     USER        PID ACCESS COMMAND
/run/systemd/sessions/c1.ref:
                     root        842 f.... (root)systemd-logind
                     root       1649 F.... (root)gdm-session-wor
# é€šå¸¸ç³»ç»Ÿçš„ FIFO æ–‡ä»¶éƒ½ä¼šæ”¾ç½®åˆ° /run ä¸‹ï¼Œé€šè¿‡è¯¥æ–¹å¼æ¥è¿½è¸ªè¯¥æ–‡ä»¶å­˜å–çš„ process
# åŒæ ·ä¹Ÿèƒ½å¤Ÿçœ‹åˆ°ç³»ç»Ÿæœ‰å¤šå¿™ç¢Œï¼ˆè¿›ç¨‹å¤šå½“ç„¶å°±å¿™ç¢Œï¼‰
```

fuser çš„é‡ç‚¹æ˜¯å¯ä»¥è®©æˆ‘ä»¬äº†è§£åˆ°æŸä¸ªæ–‡ä»¶ç³»ç»Ÿæˆ–æ–‡ä»¶ç›®å‰æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹æ‰€ä½¿ç”¨

### lsofï¼šåˆ—å‡ºè¢«è¿›ç¨‹æ‰€å¼€å¯çš„æ–‡ä»¶å

fuser æ˜¯é€šè¿‡æ–‡ä»¶æˆ–åˆ™è£…ç½®åå»æ‰¾ä½¿ç”¨å®ƒçš„è¿›ç¨‹ï¼Œè€Œ lsof åˆ™æ˜¯é€šè¿‡æŸä¸ªè¿›ç¨‹å»æ‰¾å®ƒå¼€å¯æˆ–ä½¿ç”¨çš„æ–‡ä»¶ä¸è£…ç½®

```bash
lsof [-aUu] [+d]

é€‰é¡¹ä¸å‚æ•°ï¼š
	-aï¼šå¤šæƒ³æ•°æ®éœ€è¦åŒæ—¶æˆç«‹æ‰æ˜¾ç¤ºå‡ºç»“æœæ—¶
	-Uï¼šä»…åˆ—å‡º Unix like ç³»ç»Ÿçš„ socket æ–‡ä»¶ç±»å‹
	-uï¼šåé¢æ¥ usernameï¼Œåˆ—å‡ºè¯¥ä½¿ç”¨è€…ç›¸å…³è¿›ç¨‹æ‰€å¼€å¯çš„æ–‡ä»¶
	+dï¼šåé¢æ¥ç›®å½•ï¼Œæ‰¾å‡ºæŸä¸ªç›®å½•ä¸‹å·²ç»è¢«å¼€å¯çš„æ–‡ä»¶
```

```bash
# èŒƒä¾‹ 1ï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šæ‰€æœ‰å·²ç»è¢«å¼€å¯çš„æ–‡ä»¶ä¸è£…ç½®
[root@study ~]# lsof
libvirtd   1277 1318           root  mem       REG              253,0     53848    9645351 /usr/lib64/libavahi-common.so.3.5.3
libvirtd   1277 1318           root  mem       REG              253,0    155784    8569818 /usr/lib64/libselinux.so.1
libvirtd   1277 1318           root  mem       REG              253,0     37056    8655202 /usr/lib64/libacl.so.1.1.0
# æ–‡ä»¶å¾ˆå¤šå¾ˆå¤šï¼Œç›´æ¥åˆ·å±äº†


# èŒƒä¾‹ 2ï¼šä»…åˆ—å‡ºå…³äº root çš„æ‰€æœ‰è¿›ç¨‹å¼€å¯çš„ socket æ–‡ä»¶
[root@study ~]# lsof -u root -a -U
COMMAND     PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME
systemd       1 root   12u  unix 0xffff8922437ed800      0t0  12513 /run/systemd/private
systemd       1 root   13u  unix 0xffff892243dc2c00      0t0  25917 /run/systemd/journal/stdout
systemd       1 root   15u  unix 0xffff892243e71800      0t0  25941 /run/systemd/journal/stdout
systemd       1 root   16u  unix 0xffff892243e8fc00      0t0  25942 /run/systemd/journal/stdout
systemd       1 root   17u  unix 0xffff892243e6ec00      0t0  26002 /run/systemd/journal/stdout
systemd       1 root   18u  unix 0xffff892243e6dc00      0t0  26009 /run/systemd/journal/stdout
systemd       1 root   23u  unix 0xffff89224359a800      0t0   7620 /run/systemd/notify
# æ³¨æ„ -a å‚æ•°ï¼Œåˆ†åˆ«æ‰§è¡Œ lsof -u root åŠ lsof -U ä¿¡æ¯éƒ½ä¸åŒ
# -a å–ä»–ä»¬çš„äº¤é›†ç»“æœ


# èŒƒä¾‹ 3ï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šæ‰€æœ‰è¢«å¯åŠ¨çš„å‘¨è¾¹è£…ç½®
[root@study ~]# lsof +d /dev/
COMMAND     PID           USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
systemd       1           root    0u   CHR                1,3      0t0 5342 /dev/null
systemd       1           root    1u   CHR                1,3      0t0 5342 /dev/null
systemd       1           root    2u   CHR                1,3      0t0 5342 /dev/null
systemd       1           root   27r   CHR             10,235      0t0 7250 /dev/autofs
systemd       1           root   30u  unix 0xffff8922436ce000      0t0 7645 /dev/log
kdevtmpfs    13           root  cwd    DIR                0,5     3340    3 /dev
# å› ä¸ºéƒ½åœ¨ç›®å½•ä¸­ï¼Œæ‰€ä»¥æœç´¢ç›®å½•å³å¯

# èŒƒä¾‹ 4ï¼šåˆ—å‡º root çš„ bash ç¨‹åºå¼€å¯çš„æ–‡ä»¶
[root@study ~]# lsof -u root | grep bash
ksmtuned    921 root  txt       REG              253,0    964600     309027 /usr/bin/bash
bash      20030 root  cwd       DIR              253,0      4096   25165889 /root
bash      20030 root  rtd       DIR              253,0       251         64 /
bash      20030 root  txt       REG              253,0    964600     309027 /usr/bin/bash
bash      20030 root  mem       REG              253,0 106075056     309022 /usr/lib/locale/locale-archive
bash      20030 root  mem       REG              253,0     61624    8548289 /usr/lib64/libnss_files-2.17.so
bash      20030 root  mem       REG              253,0   2156160    8532847 /usr/lib64/libc-2.17.so
bash      20030 root  mem       REG              253,0     19288    8532853 /usr/lib64/libdl-2.17.so
bash      20030 root  mem       REG              253,0    174576    8548350 /usr/lib64/libtinfo.so.5.9
bash      20030 root  mem       REG              253,0    163400    8532840 /usr/lib64/ld-2.17.so
bash      20030 root  mem       REG              253,0     26254   16946906 /usr/lib64/gconv/gconv-modules.cache
bash      20030 root    0u      CHR              136,0       0t0          3 /dev/pts/0
bash      20030 root    1u      CHR              136,0       0t0          3 /dev/pts/0
bash      20030 root    2u      CHR              136,0       0t0          3 /dev/pts/0
bash      20030 root  255u      CHR              136,0       0t0          3 /dev/pts/0

```

å¯ä»¥é€šè¿‡èŒƒä¾‹ 4 æ‰¾å‡ºæŸä¸ªè¿›ç¨‹æ˜¯å¦æœ‰å¯ç”¨å“ªäº›ä¿¡æ¯

### pidofï¼šæ‰¾å‡ºæŸä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ PID

```bash
pidof [-sx] program_name

é€‰é¡¹ä¸å‚æ•°ï¼š
	-sï¼šä»…åˆ—å‡ºä¸€ä¸ª PID è€Œä¸åˆ—å‡ºæ‰€æœ‰çš„ PID
	-xï¼šåŒæ—¶åˆ—å‡ºè¯¥ç¨‹åºå¯èƒ½çš„ PPID é‚£ä¸ªè¿›ç¨‹çš„ PID
```

```bash
# èŒƒä¾‹ 1ï¼šåˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Š systemd ä»¥åŠ rsyslogd è¿™ä¸¤ä¸ªç¨‹åºçš„ PID
[root@study ~]# pidof systemd rsyslogd
1 1265
# ç»“æœæ˜¾ç¤ºçš„æ˜¯ä¸¤ä¸ª PID
```

pidof æŒ‡ä»¤è¾ƒç®€å•ï¼Œå¯é…åˆ pas aux ä¸æ­£åˆ™è¡¨ç¤ºæ³•ï¼Œå°±å¯ä»¥å¾ˆè½»æ˜“çš„æ‰¾åˆ°ä½ æƒ³è¦çš„è¿›ç¨‹å†…å®¹äº†ã€‚å¦‚æœè¦æ‰¾çš„æ˜¯ bashï¼Œé‚£å°±  pidof bash ï¼Œå°±åˆ—å‡ºä¸€å † PID å·ç äº†
