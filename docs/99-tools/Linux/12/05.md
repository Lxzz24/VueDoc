---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# å¾ªç¯ï¼ˆloopï¼‰

å¾ªç¯å¯ä»¥ä¸æ–­æ‰§è¡ŒæŸä¸ªç¨‹åºæ®µæ¥¼ï¼Œç›´åˆ°ç”¨æˆ·è®¾å®šçš„æ¡ä»¶è¾¾æˆä¸ºæ­¢ã€‚

## ğŸ€ while do doneã€until do doneï¼ˆä¸å®šå¾ªç¯ï¼‰

å½“æ¡ä»¶æˆç«‹æ—¶ï¼Œæ‰§è¡Œå¾ªç¯ä½“

```bash
while [ condition ]   # ä¸­æ‹¬å·ä¸­æ¡ä»¶åˆ¤æ–­
do    # å¾ªç¯å¼€å§‹
  ç¨‹åºæ®µè½
done  # å¾ªç¯ç»“æŸ
```

è¿˜æœ‰ä¸€ç§ä¸å®šå¾ªç¯çš„æ–¹å¼ï¼Œå½“æ¡ä»¶æˆç«‹æ—¶é€€å‡ºå¾ªç¯ä½“

```bash
until [ condition ]
do
    ç¨‹åºæ®µè½
done
```

èŒƒä¾‹ï¼šè®©ä½¿ç”¨è€…è¾“å…¥ yes æˆ–åˆ™æ˜¯ YES æ‰ç»“æŸç¨‹åºçš„æ‰§è¡Œï¼Œå¦åˆ™å°±ä¸€ç›´å‘ŠçŸ¥ç”¨æˆ·è¾“å…¥å­—ç¬¦ä¸²

```bash
vim yes_to_stop.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

while [ "${yn}" != 'yes' -a "${yn}" != 'YES' ]
# ä½¿ç”¨ until åˆ™æ˜¯å¦‚ä¸‹
# until [ "${yn}" == 'yes' -o "${yn}" == 'YES' ]
do
  read -p 'è¯·è¾“å…¥ yes æˆ– YES é€€å‡ºç¨‹åº' yn
done

echo "ä½ è¾“å…¥äº†æ­£ç¡®ç­”æ¡ˆ"
```

æµ‹è¯•å¦‚ä¸‹

```bash
[mrcode@study bin]$ ./yes_to_stop.sh
è¯·è¾“å…¥ yes æˆ– YES é€€å‡ºç¨‹åºj
è¯·è¾“å…¥ yes æˆ– YES é€€å‡ºç¨‹åºjj
è¯·è¾“å…¥ yes æˆ– YES é€€å‡ºç¨‹åºyes
ä½ è¾“å…¥äº†æ­£ç¡®ç­”æ¡ˆ
```

å¦‚æœæƒ³è¦è®¡ç®— `1+2+3+..100`åˆ™å¦‚ä¸‹å†™

```bash
vim cal_1_100.sh

#!/bin/bash
# Program:
#       è®¡ç®— 1+2+3+..100 çš„ç»“æœ
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

total=0	# è®¡ç®—ç»“æœ
i=0			# å½“å‰æ•°å€¼

while [ "${i}" != 100 ]
do
	i=$(($i+1))		# æ¯æ¬¡å¢åŠ  1
	total=$(($total+$i))
done
echo "1+2+3+..100 = ${total}"
```

## ğŸ€  `for...do...done` å›ºå®šå¾ªç¯

```bash
for var in con1 con2 con3 ...
do
	å¾ªç¯ä½“
done
```

èŒƒä¾‹ï¼šå‡è®¾æœ‰ä¸‰ç§åŠ¨ç‰©ï¼Œåˆ†åˆ«æ˜¯ dogã€catã€elephant ä¸‰ç§ï¼Œè¾“å‡ºä¸‰è¡Œä¿¡æ¯ï¼Œå¦‚ `There are dogs...` ä¹‹ç±»çš„ä¿¡æ¯

```bash
vim show_animal.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

for animal in dog cat elephant
do
	echo "There are ${animal}s..."
done
```
/etc/passwd ä¸­ç¬¬ä¸€ä¸ªå­—æ®µå­˜æ”¾äº†ç”¨æˆ·åï¼Œä½¿ç”¨å¾ªç¯æ‰“å°å‡ºæ¯ä¸ªç”¨æˆ·åçš„ id ä¿¡æ¯ï¼›å¯ä½¿ç”¨ cut æˆªå–ç¬¬ä¸€å­—æ®µï¼Œä½¿ç”¨ idæŒ‡ä»¤è·å–ç”¨æˆ·åçš„ä¿¡æ¯ï¼ˆæ ‡è¯†ç¬¦ä¸ç‰¹æ®Šå‚æ•°ï¼‰
```bash
vim userid.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

users=$(cut -d ':' -f1 /etc/passwd)		# è·å–åˆ°æ‰€æœ‰çš„ç”¨æˆ·å
for user in ${users}
do
	id ${user}
done
```

å½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨æ•°å­—æ¥åšå¾ªç¯é¡¹ï¼Œæ¯”å¦‚éœ€è¦æ‰§è¡Œ `ping 192.168.1.1~192.168.1.100` ä¹Ÿå°±æ˜¯ä» 1 ping åˆ° 100ï¼Œä½†æ˜¯ä¸å¯èƒ½éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¾“å…¥ 100 ä¸ªæ•°å­—å§

```bash
vim pingip.sh


#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

network="192.168.0"			# å…ˆå®šä¹‰ä¸€ä¸ªç½‘åŸŸçš„å‰éƒ¨åˆ†
for sitenu in $(seq 1 100)	# seq ä¸º sequence è¿ç»­çš„æ„æ€
do
	# ping -c 1 -w 1 192.168.0.101 &> /dev/null && echo "1" || echo "0"
	# ä¸æ˜¾ç¤ºæ‰§è¡Œç»“æœï¼Œå¹¶è·å–å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
	ping -c 1 -w 1 ${network}.${sitenu} &> /dev/null && result=0 || result=1
	if [ "${result}" == 0 ]; then
		echo "${network}.${sitenu} is up"
	else
		echo "${network}.${sitenu} is down"
	fi
done
```

æµ‹è¯•ç»“æœ

```bash
[mrcode@study bin]$ ./pingip.sh
192.168.0.1 is up
192.168.0.2 is down
192.168.0.3 is down
..
```

å¯¹äº `$(seq 1 100)` æ¥è¯´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ bash çš„å†…å»ºæœºåˆ¶ `{1..100}` æ¥ä»£æ›¿ï¼Œä¸­é—´ä¸¤ä¸ªç‚¹è¡¨ç¤ºè¿ç»­çš„æ„æ€ï¼Œæ¯”å¦‚æƒ³è¦è¾“å‡º a~g åˆ™å¯ä»¥ä½¿ç”¨ `a..g`

æœ€åä¸€ä¸ªèŒƒä¾‹ï¼š

1. è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªç›®å½•
2. å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™æç¤ºå¹¶é€€å‡ºç¨‹åº
3. å¦‚æœç›®å½•å­˜åœ¨ï¼Œåˆ™è·å–è¯¥ç›®å½•ä¸‹ç¬¬ä¸€çº§æ–‡ä»¶æ˜¯å¦å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ



```bash
vim dir_perm.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

read -p "è¯·è¾“å…¥ä¸€ä¸ªç›®å½•ï¼Œå°†ä¼šæ£€æµ‹è¯¥ç›®å½•æ˜¯å¦å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼š" dir
# åˆ¤å®šè¾“å…¥ä¸ä¸ºç©ºï¼Œå¹¶ä¸”ç›®å½•å­˜åœ¨
if [ "${dir}" == '' -o ! -d "${dir}" ]; then
        echo "The ${dir} is NOT exist in your system"
        exit 1
fi

# è·å–è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶æƒé™ä¿¡æ¯
filelist=$(ls ${dir})
for file in ${filelist}
do
        perm=""
        test -r "${dir}/${file}" && perm="${perm} readable"
        test -w "${dir}/${file}" && perm="${perm} writable"
        test -x "${dir}/${file}" && perm="${perm} executable"
        echo "The file ${dir}/${file}'s permission is ${perm}"
done

```

ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¾ˆè½»æ˜“çš„æ¥å¤„ç†ä¸€äº›æ–‡ä»¶çš„ç‰¹æ€§

## ğŸ€ `for...do...done` æ•°å€¼å¤„ç†

```bash
for (( åˆå§‹å€¼; é™åˆ¶å€¼; æ‰§è¡Œæ­¥é˜¶))
do
	å¾ªç¯ä½“
done
```

- åˆå§‹å€¼ï¼šæŸä¸ªå˜é‡åœ¨å¾ªç¯ä¸­çš„èµ·å§‹å€¼ï¼Œå¯ä»¥ä»¥ i=1 è®¾ç½®å¥½åˆå§‹å€¼
- é™åˆ¶å€¼ï¼šå½“å˜é‡å€¼åœ¨è¿™ä¸ªé™åˆ¶å€¼èŒƒå›´å†…ï¼Œåˆ™ç»§ç»­å¾ªç¯ã€‚ä¾‹å¦‚ i<=100
- æ‰§è¡Œæ­¥é˜¶ï¼šæ¯æ‰§è¡Œä¸€æ¬¡å¾ªç¯æ—¶ï¼Œå˜é‡çš„å˜åŒ–é‡ã€‚ä¾‹å¦‚ i=i+1ï¼Œå¦‚æœæ˜¯è‡ªå¢åˆ™å¯ä»¥ä½¿ç”¨ i++ æ¥æ›¿ä»£

èŒƒä¾‹ï¼šè®¡ç®—ä» 1 ç´¯åŠ åˆ°æŒ‡å®šæ•°å€¼çš„ç»“æœ

```bash
vim cal_1_100-2.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

read -p "è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼ï¼Œå°†è®¡ç®—å‡ºä» 1 ç´¯åŠ åˆ°è¯¥æ•°å€¼çš„è®¡ç®—ç»“æœ" nu

total=0

for (( i=1; i<=${nu}; i++))
do
	total=$((${total}+${i}))
done

echo "1+..+${nu} = ${total}"

```

æµ‹è¯•è¾“å‡ºå¦‚ä¸‹

```bash
[mrcode@study bin]$ ./cal_1_100-2.sh
è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼ï¼Œå°†è®¡ç®—å‡ºä» 1 ç´¯åŠ åˆ°è¯¥æ•°å€¼çš„è®¡ç®—ç»“æœ2
1+..+2 = 3
[mrcode@study bin]$ ./cal_1_100-2.sh
è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼ï¼Œå°†è®¡ç®—å‡ºä» 1 ç´¯åŠ åˆ°è¯¥æ•°å€¼çš„è®¡ç®—ç»“æœ100
1+..+100 = 5050
```

## ğŸ€ æ­é…éšæœºæ•°ä¸æ•°ç»„çš„å®éªŒ

ç°åœ¨å¤§æ¦‚å·²ç»èƒ½å¤ŸæŒæ¡ shell script äº†ã€‚

ç°åœ¨æ¥åšä¸ªæœ‰è¶£çš„å°ä¸œè¥¿ï¼Œä»Šå¤©ä¸­åˆåƒå•¥ï¼Ÿè¦å®Œæˆè¿™ä¸ªè„šæœ¬ï¼Œé¦–å…ˆéœ€è¦å°†å…¨éƒ¨çš„åº—å®¶è¾“å…¥åˆ°ä¸€ç»„æ•°ç»„ä¸­ï¼Œå†é€šè¿‡éšæœºæ•°çš„å¤„ç†ï¼Œè·å¾—å¯èƒ½çš„å€¼

```bash
vim what_to_eat.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

# å®šä¹‰ä½ æœé›†åˆ°çš„åº—å®¶ä¿¡æ¯
eat[1]="å–å½“å½“æ±‰å ¡"
eat[2]="è‚¯çˆ·çˆ·ç‚¸é¸¡"
eat[3]="å½©è™¹æ—¥å¼ä¾¿å½“"
eat[4]="è¶Šæ²¹è¶Šå¥½åƒæ‰“å‘€"
eat[5]="æƒ³ä¸å‡ºåƒä»€ä¹ˆ"
eat[6]="å¤ªå¸ˆå‚…ä¾¿å½“"
eat[7]="æ± ä¸Šä¾¿å½“"
eat[8]="æ€€æ‹ç«è½¦ä¾¿å½“"
eat[9]="ä¸€èµ·åƒæ³¡é¢"
eat[10]="å¤ªä¸Šçš‡"
eatnum=10		# ä¸€å…±æœ‰å‡ å®¶å¯ç”¨çš„åº—é“º

check=$((${RANDOM} * ${eatnum} / 32767 + 1))
echo "your may eat ${eat[${check}]}"
```

æµ‹è¯•è¾“å‡º

```bash
[mrcode@study bin]$ ./what_to_eat.sh
your may eat å¤ªä¸Šçš‡
[mrcode@study bin]$ ./what_to_eat.sh
your may eat è¶Šæ²¹è¶Šå¥½åƒæ‰“å‘€
[mrcode@study bin]$ ./what_to_eat.sh
your may eat æƒ³ä¸å‡ºåƒä»€ä¹ˆ
[mrcode@study bin]$ ./what_to_eat.sh
```

ç»§ç»­æ·±å…¥ï¼Œä¸€æ¬¡æ€§è¾“å‡º 3 ä¸ªé€‰æ‹©ï¼Œå¹¶ä¸”ä¸èƒ½é‡å¤

```bash
vim what_to_eat-2.sh

#!/bin/bash
# Program:
#       
# History:
#       2020/02/12              mrcode          first relese
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

# å®šä¹‰ä½ æœé›†åˆ°çš„åº—å®¶ä¿¡æ¯
eat[1]="å–å½“å½“æ±‰å ¡"
eat[2]="è‚¯çˆ·çˆ·ç‚¸é¸¡"
eat[3]="å½©è™¹æ—¥å¼ä¾¿å½“"
eat[4]="è¶Šæ²¹è¶Šå¥½åƒæ‰“å‘€"
eat[5]="æƒ³ä¸å‡ºåƒä»€ä¹ˆ"
eat[6]="å¤ªå¸ˆå‚…ä¾¿å½“"
eat[7]="æ± ä¸Šä¾¿å½“"
eat[8]="æ€€æ‹ç«è½¦ä¾¿å½“"
eat[9]="ä¸€èµ·åƒæ³¡é¢"
eat[10]="å¤ªä¸Šçš‡"
eatnum=10		# ä¸€å…±æœ‰å‡ å®¶å¯ç”¨çš„åº—é“º

# å…¶å®å°±æ˜¯éœ€è¦è½®è¯¢å‡ºæ¥ 3 ä¸ªä¸åŒçš„ç´¢å¼•ç»“æœ

eated=0	# å·²é€‰ä¸­æ•°é‡

while [ "${eated}" -lt 3 ];
do
	check=$((${RANDOM} * ${eatnum} / 32767 + 1))
	mycheck=0		# å½“ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºä¸é‡å¤
	# å»é‡æ£€æŸ¥
	if [ ${eated} -gt 0 ]; then			# å½“å·²é€‰ä¸­è‡³å°‘ä¸€ä¸ªåº—é“ºçš„æ—¶å€™ï¼Œæ‰æ‰§è¡Œ
    for i in $(seq 1 ${eated})
    do
      if [ "${eatedcon[$i]}" == $check ]; then
        mycheck=1
      fi
    done
  fi
	if [ ${mycheck} == 0 ]; then
		echo "your may eat ${eat[${check}]}"
		eated=$(( ${eated} + 1 ))
		eatedcon[${eated}]=${check}		# å°†å·²é€‰ä¸­ç»“æœå­˜å‚¨èµ·æ¥
	fi
done
```
