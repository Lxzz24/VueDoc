---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# åˆ†æç™»å½•æ–‡ä»¶

æ—¥å¿—æ–‡ä»¶çš„åˆ†ææ˜¯å¾ˆé‡è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨ vim æˆ–åˆ™æ˜¯ journalctl æŸ¥é˜…ç›¸å…³ä¿¡æ¯ï¼Œè¿˜æœ‰ä¹‹å‰æåˆ°è¿‡çš„ lastã€lastlogã€dmesg ç­‰è½¯ä»¶ã€‚

ä¸è¿‡æ•°æ®éå¸¸çš„åˆ†æ•£ï¼Œæ‰€ä»¥æä¾›äº† logwatch è½¯ä»¶æ¥å¸®åŠ©æˆ‘ä»¬

## ğŸ€ CentOS é¢„è®¾æä¾›çš„ logwatch

è¯¥å·¥å…·æ¯å¤©åˆ†æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†æ•°æ®ä»¥ email çš„æ ¼å¼å¯„é€ç»™ rootã€‚æ›´è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥åˆ° logwatch å®˜ç½‘ http://www.logwatch.org æŸ¥çœ‹

è€æ ·å­ï¼Œè¯¥å·¥å…·é»˜è®¤æœªå®‰è£…ï¼Œæ‹¿å‡ºä½ çš„å…‰ç›˜æŒ‚è½½åï¼Œå¼€å§‹å®‰è£…

```bash
[root@study ~]# yum install /mnt/Packages/perl-5.*.rpm  /mnt/Packages/perl-Date-Manip-*.rpm /mnt/Packages/perl-Sys-CPU-*.rpm /mnt/Packages/perl-Sys-MemInfo-*.rpm /mnt/Packages/logwatch-*.rpm

# éœ€è¦å®‰è£… perl ä¾èµ–ä¸è½¯ä»¶
[root@study ~]# ll /etc/cron.daily/0logwatch 
-rwxr-xr-x. 1 root root 434 Aug 16  2018 /etc/cron.daily/0logwatch
[root@study ~]# /etc/cron.daily/0logwatch 
```

å®‰è£…å®Œæˆä¹‹åï¼Œå®ƒå·²ç»æŠŠè„šæœ¬å†™åˆ° cron ä¸‹é¢å»äº†ï¼Œä¸€å¤©ä¼šè‡ªåŠ¨è¿è¡Œä¸€æ¬¡ï¼Œç„¶åé€šè¿‡é‚®ä»¶å‘é€ç»™ rootï¼›ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ `/etc/cron.daily/0logwatch `ï¼Œç¬”è€…çœ‹äº†ä¸‹å†…å®¹ï¼Œå†…éƒ¨ç›´æ¥è¿è¡Œäº† `/usr/sbin/logwatch` æŒ‡ä»¤ã€‚æ‰‹åŠ¨è¿è¡Œä¹‹åï¼Œä½¿ç”¨ root è´¦æˆ·å»æŸ¥çœ‹ email å°±å¯ä»¥äº†ã€‚æç¤ºï¼šæ‰‹åŠ¨è¿è¡Œçš„è¯ï¼Œå¦‚æœæ•°æ®æµå¾ˆå¤§å½“å‰ç»ˆç«¯æœºä¼šé˜»å¡ï¼Œç›´åˆ°åˆ†æå®Œæˆ

```bash
[root@study ~]# mail
Heirloom Mail version 12.5 7/5/10.  Type ? for help.
"/var/spool/mail/root": 1 message 1 new
>N  1 logwatch@study.cento  Mon Mar 16 04:07 128/4920  "Logwatch for study.centos.mrcode (Linux)"
& 1
Message  1:
From root@study.centos.mrcode  Mon Mar 16 04:07:23 2020
Return-Path: <root@study.centos.mrcode>
X-Original-To: root
Delivered-To: root@study.centos.mrcode
To: root@study.centos.mrcode
From: logwatch@study.centos.mrcode
Subject: Logwatch for study.centos.mrcode (Linux)
Auto-Submitted: auto-generated
Precedence: bulk
Content-Type: text/plain; charset="iso-8859-1"
Date: Mon, 16 Mar 2020 04:07:22 +0800 (CST)
Status: R

 # å‘ŠçŸ¥å½“å‰ logwatch ç‰ˆæœ¬ï¼Œå½“æ¬¡åˆ†æçš„æ—¶é—´ç­‰ä¿¡æ¯
 ################### Logwatch 7.4.0 (03/01/11) #################### 
        Processing Initiated: Mon Mar 16 04:07:22 2020
        Date Range Processed: yesterday
                              ( 2020-Mar-15 )
                              Period is day.
        Detail Level of Output: 0
        Type of Output/Format: mail / text
        Logfiles for Host: study.centos.mrcode
 ################################################################## 
 # ä¸‹é¢å¼€å§‹ä¸€é¡¹ä¸€é¡¹çš„åˆ†æ
 --------------------- Cron Begin ------------------------ 

 **Unmatched Entries**
 INFO (RANDOM_DELAY will be scaled with factor 25% if used.)
 ---------------------- Cron End ------------------------- 

 
 --------------------- Kernel Begin ------------------------ 

 
 WARNING:  Kernel Errors Present
    [drm:vmw_host_log [vmwgfx]] *ERROR* Failed to send  ...:  2 Time(s)
 
 ---------------------- Kernel End ------------------------- 

 
 --------------------- pam_unix Begin ------------------------ 

 gdm-launch-environment:
    Unknown Entries:
       session opened for user gdm by (uid=0): 1 Time(s)
 
 su-l:
    Sessions Opened:
       mrcode -> root: 3 Time(s)
 ....
 
 --------------------- SSHD Begin ------------------------ 

 
 SSHD Started: 2 Time(s)
 
 Users logging in through sshd:
    mrcode:
       192.168.0.105: 4 times
 
 **Unmatched Entries**
 error: no more sessions : 8 time(s)
 
 ---------------------- SSHD End ------------------------- 

 # è¿˜æœ‰å¯¹ç£ç›˜çš„ä½¿ç”¨çŠ¶æ€
 --------------------- Disk Space Begin ------------------------ 

 Filesystem               Size  Used Avail Use% Mounted on
 devtmpfs                 565M     0  565M   0% /dev
 /dev/mapper/centos-root   10G  5.1G  5.0G  51% /
 /dev/sda2               1014M  181M  834M  18% /boot
 /dev/mapper/centos-home  5.0G  927M  4.1G  19% /home
 
 
 ---------------------- Disk Space End ------------------------- 
```

## ğŸ€ ä½œè€…å†™çš„æ–‡ä»¶åˆ†æå·¥å…·

ä¸‹è½½åœ°å€ï¼šhttp://linux.vbird.org//linux_basic/0570syslog//logfile_centos7.tar.gz

ä¸‹è½½ä¹‹åï¼Œåœ¨æ ¹ç›®å½•è§£å‹ï¼Œæ–‡ä»¶ä¼šè¿›å…¥ç›¸åº”çš„ç›®å½•ï¼ŒåŒ…æ‹¬å®šæ—¶ä»»åŠ¡çš„æ–‡ä»¶ï¼Œæ¯æ—¥ 00:10 åˆ†æä¸€æ¬¡ç³»ç»Ÿæ³¨å†Œè¡¨æ–‡ä»¶ï¼Œè¯¥å·¥å…·åªé€‚ç”¨äº journalctl çš„æ•°æ®ç³»ç»Ÿï¼ˆCentOS 7.xï¼‰

```bash
[root@study ~]# tar -zxvf logfile_centos7.tar.gz -C /
etc/cron.d/vbirdlogfile
root/bin/logfile/
root/bin/logfile/function/
root/bin/logfile/function/samba
root/bin/logfile/function/dovecot
root/bin/logfile/function/sendmail
root/bin/logfile/function/proftp
root/bin/logfile/function/pop3
root/bin/logfile/function/procmail
root/bin/logfile/function/zzz.sh
root/bin/logfile/function/ssh
root/bin/logfile/function/ports
root/bin/logfile/function/postfix
root/bin/logfile/function/openwebmail
root/bin/logfile/function/wuftp
root/bin/logfile/logfile.sh
# å¯ä»¥çœ‹åˆ°å‡½æ•°æŒºå¤šçš„
# è¿™ä¸ªæ˜¯å®šæ—¶ä»»åŠ¡çš„æ–‡ä»¶
[root@study ~]# cat /etc/cron.d/vbirdlogfile 
10 0 * * * root /bin/bash /root/bin/logfile/logfile.sh &> /dev/null
# æ‰‹åŠ¨æ‰§è¡Œ
[root@study ~]# sh /root/bin/logfile/logfile.sh 
[root@study ~]# sh /root/bin/logfile/logfile.sh 
/sbin/restorecon:  Warning no default label for /dev/shm/logfile/logfile_mail.txt

grep: /etc/postfix/body_checks: No such file or directory
cat: /dev/shm/logfile//postlog.1: No such file or directory

# æ‰“å¼€é‚®ä»¶ï¼Œå°±çœ‹åˆ°æœ‰ä¿¡æ¯äº†
[root@study ~]# mail
Heirloom Mail version 12.5 7/5/10.  Type ? for help.
"/var/spool/mail/root": 2 messages 1 new
    1 logwatch@study.cento  Mon Mar 16 04:07 129/4931  "Logwatch for study.centos.mrcode (Linux)"
>N  2 root                  Mon Mar 16 04:24  67/3085  "study.centos.mrcode logfile analysis results"

# æŸ¥çœ‹å†…å®¹ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¯ä»¥çš„
=============== system summary =================================
Linux kernel  :  Linux version 3.10.0-1062.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org)
CPU informatin:  1 Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz
CPU speed     :  2904.000 MHz
hostname is   :  study.centos.mrcode
Network IP    :  192.168.0.128 192.168.122.1
Check time    :  2020/March/16 04:23:52 ( Monday )
Summary date  :  Mar 15
Up times      :  8:10,
Filesystem summary: 
       Filesystem              Type      Size  Used Avail Use% Mounted on
       devtmpfs                devtmpfs  565M     0  565M   0% /dev
       tmpfs                   tmpfs     582M  144K  582M   1% /dev/shm
       tmpfs                   tmpfs     582M  1.3M  581M   1% /run
       tmpfs                   tmpfs     582M     0  582M   0% /sys/fs/cgroup
       /dev/mapper/centos-root xfs        10G  5.1G  5.0G  51% /
       /dev/sda2               xfs      1014M  181M  834M  18% /boot
       /dev/mapper/centos-home xfs       5.0G  927M  4.1G  19% /home
       tmpfs                   tmpfs     117M   12K  117M   1% /run/user/42
       tmpfs                   tmpfs     117M     0  117M   0% /run/user/1000
       /dev/sr0                iso9660   4.4G  4.4G     0 100% /mnt
 
 
================= Ports çš„ç›¸é—œåˆ†æè³‡è¨Š =======================
ä¸»æ©Ÿå•Ÿç”¨çš„ port èˆ‡ç›¸é—œçš„ process ownerï¼š
å°å¤–éƒ¨ä»‹é¢é–‹æ”¾çš„ 
   ports (PID|owner|command)
       tcp 22|(root)|/usr/sbin/sshd -D
       tcp 25|(root)|/usr/libexec/postfix/master -w
       tcp 53|(nobody)|/usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/de
       tcp 111|(root)|/usr/lib/systemd/systemd --switched-root --system --deseri
       tcp 514|(root)|/usr/sbin/rsyslogd -n
       tcp 631|(root)|/usr/sbin/cupsd -f
       udp 53|(nobody)|/usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/de
       udp 67|(nobody)|/usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/de
       udp 111|(root)|/usr/lib/systemd/systemd --switched-root --system --deseri
       udp 1008|(rpc)|/sbin/rpcbind -w
       udp 5353|(avahi)|avahi-daemon: running [study.local]
       udp 45105|(avahi)|avahi-daemon: running [study.local]

================= SSH çš„ç™»éŒ„æª”è³‡è¨Šå½™æ•´ =======================
ä¸€å…±æˆåŠŸç™»å…¥çš„æ¬¡æ•¸ï¼š   4
       å¸³è™Ÿ     ä¾†æºä½å€    æ¬¡æ•¸
       mrcode     192.168.0.105     4
 
 
================= Postfix çš„ç™»éŒ„æª”è³‡è¨Šå½™æ•´ ===================
ä½¿ç”¨è€…ä¿¡ç®±å—ä¿¡æ¬¡æ•¸ï¼š

```



