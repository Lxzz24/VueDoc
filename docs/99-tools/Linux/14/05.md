---
title: 
sidebarDepth: 0 
category: Tools 
tag: Linux
---
# æœ¬ç« ä¹ é¢˜

## ğŸ€ æƒ…æ™¯æ¨¡æ‹Ÿé¢˜

LVM å¯ä»¥å¼¹æ€§è°ƒæ•´ filesystem çš„å¤§å°ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å¯èƒ½æ²¡æœ‰åŠ é€Ÿä¸ç¡¬ä»¶å¤‡ä»½ï¼ˆä¸å¿«ç…§ä¸åŒï¼‰çš„åŠŸèƒ½ã€‚è€Œç£ç›˜é˜µåˆ—åˆ™å…·æœ‰æ•ˆç‡ä¸å¤‡ä»½åŠŸèƒ½ï¼Œä½†æ˜¯æ— æ³•æä¾›ç±»ä¼¼ LVM çš„ä¼˜ç‚¹ã€‚æ­¤ä¾‹ä¸­ç»“åˆä¸¤è€…çš„ä¼˜åŠ¿ï¼Œåœ¨ RAID ä¸Šä½¿ç”¨ LVM çš„åŠŸèƒ½

- ç›®æ ‡ï¼šæµ‹è¯•åœ¨RAID ç£ç›˜ä¸Šé¢æ¶æ„ LVM ç³»ç»Ÿ
- éœ€æ±‚ï¼šéœ€è¦å…·æœ‰ç£ç›˜ç®¡ç†çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ RAID ä¸ LVM
- å‰æï¼šä¼šç”¨åˆ°æœ¬ç« å»ºç«‹å‡ºæ¥çš„ `/dev/vda{5,6,7}`

æœ¬ç« ä¸å®é™…æ“ä½œäº†ï¼Œç¬”è€…æš‚æ—¶ä¸éœ€è¦æ·±å…¥äº†è§£è¿™é‡Œçš„çŸ¥è¯†ç‚¹

```bash
# åˆ†å‡º 3 ä¸ªåŒºå‡ºæ¥ï¼Œåˆ†å®Œä¹‹åï¼Œå¦‚ä¸‹
gdisk -l /dev/vda
 5        67123200        69220351   1024.0 MiB  FD00  Linux RAID
 6        69220352        71317503   1024.0 MiB  FD00  Linux RAID
 7        71317504        73414655   1024.0 MiB  FD00  Linux RAID
 
# åˆ›å»º RAID5 æ•°ç»„
mdadm --create /dev/md0 --auto=yes --level=5 --raid-devices=3 /dev/vda{5,6,7}
	UUID:xxx1234
vim /etc/mdadm.conf
	ARRAY /dev/md0 UUID=xxx1234

# å¤„ç† LVMï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤å‚æ•°
pvcreate /dev/md0			# åˆ›å»º PV
vgcreate raidvg /dev/md0	# å»ºç«‹ VG
lvcreate -L 1.5G -n raidlv raidvg	# å»ºç«‹ LVM
lvscan
	ACTIVE â€˜/dev/raidvg/raidlvâ€™ [1.50 GIB] inherit

# æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸æŒ‚è½½
mkfs.xfs /dev/raidvg/raidlv
blkid /dev/raidvg/raidlv
	/dev/raidvg/raidlv:UUID="xxx456" TYPE="xfs"
vim /etc/fstab
	UUID="xxx456" /srv/raidlvm xfs	defaults 0 0

mkdir /srv/raidlvm
mount -a
df -Th /srv/raidlvm
	Filesystem				  Type  Size	Used	Avail	Use%	Mounted on	
	/dev/mapper/raidvg-raidlv  xfs  1.5G    33M      1.5G    3%	    /srv/raidlvm
```

è¿™ä¸ªè¿‡ç¨‹ä¸å‰é¢çš„ä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯å…ˆåˆ›å»ºäº† RAIDï¼Œç„¶åå†æ”¹ RAID ä¸Šé¢åˆ›å»º LVMã€‚è‡³äºå…¶ä»–çš„åŸºæœ¬ç®¡ç†æ–¹å¼ä¹Ÿæ˜¯å’Œä¹‹å‰çš„é‚£äº›ç»´æŠ¤æŒ‡ä»¤ä¸€æ ·ï¼ŒåŒ…æ‹¬ RAID çƒ­æ’æ‹¨æœºåˆ¶ã€LVM æ”¾å¤§ç¼©å°æœºåˆ¶ç­‰

## ğŸ€ ç®€ç­”é¢˜

- åœ¨å‰ä¸€ç« å¤§é‡æ–°å¢è´¦æˆ·èŒƒä¾‹ä¸­ï¼Œå¦‚æœè¦è®©æ¯ä¸ªç”¨æˆ·å…·æœ‰ `soft/hard` `40M/50M` çš„å®¹é‡ï¼Œå¦‚ä½•ä¿®æ”¹è¿™ä¸ª scriptï¼Ÿ

  ```bash
  # è¦å…ˆå¯¹ /home å¯åŠ¨ Quota çš„ç¯å¢ƒåï¼Œä½¿ç”¨å¦‚ä¸‹è„šæœ¬
  [root@study ~]# vim addaccount2.sh
  #!/bin/bash
  # ä½¿ç”¨è„šæœ¬æ¥åˆ›å»º xfs æ–‡ä»¶ç³»ç»Ÿ Quota å®éªŒçš„è´¦æˆ·
  groupadd myquotagrp
  for username in myquota1 myquota2 myquota3 myquota4 myquota5 
  do
  	useradd -g myquotagrp $username
  	echo "123456" | passwd --stdin $username
  	# åœ¨è¿™é‡Œå¢åŠ 
  	xfs_quota -x -c "limit -u bsoft=40M bhard=50M ${username}" /home
  done
  
  mkdir /home/myquota
  chgrp myquotagrp /home/myquota		# æ”¹å˜è¯¥ç›®å½•çš„æ‰€å±ç¾¤
  chmod 2770 /home/myquota		# æ‹¥æœ‰è€…å’Œç¾¤ç»„æœ‰æƒé™ï¼Œè¿™é‡ŒåŠ äº†ä¸ª SGID=2 çš„ç‰¹æ®Šæƒé™ï¼Œç¬”è€…æš‚æ—¶ä¸ç†è§£æ˜¯ä¸ºä»€ä¹ˆ
  
  ```

- è®© RAID å…·æœ‰ä¿æŠ¤æ•°æ®çš„åŠŸèƒ½ï¼Œé˜²æ­¢å› ä¸ºç¡¬ä»¶æŸåè€Œå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼Œå¯ä»¥é€‰çš„ RAID ç­‰çº§æœ‰å“ªäº›ï¼Ÿ

  å…·æœ‰å¤‡ä»½æ•°æ®çš„æœ‰ï¼šRAID-1ã€RAID-5ã€RAID-6

- åœ¨é¢„è®¾çš„ LVM è®¾ç½®ä¸­ï¼ŒLVM èƒ½å¦å…·æœ‰ å¤‡ä»½ åŠŸèƒ½ï¼Ÿ

  å¯ä»¥é€šè¿‡å¿«ç…§ï¼ˆsnopshotï¼‰åŠŸèƒ½è¿›è¡Œæ•°æ®çš„å¤‡ä»½ï¼Œæ³¨æ„éœ€è¦å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½

- å¦‚æœä½ çš„ä¸»æœºæä¾› RAID0 åŠŸèƒ½ï¼Œä½ å°† 3 å—ç£ç›˜å…¨éƒ¨åœ¨ BIOS é˜¶æ®µä½¿ç”¨ RAID èŠ¯ç‰‡æ•´åˆä¸ºä¸€å—å¤§ç£ç›˜ï¼Œåˆ™æ­¤ç£ç›˜åœ¨ Linux ç³»ç»Ÿä¸­çš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Ÿ

  å› ä¸ºç£ç›˜é˜µåˆ—æ—¶å† BIOS é˜¶æ®µå®Œæˆçš„ï¼Œå› æ­¤ Linux ç³»ç»Ÿä¼šæ•æ‰åˆ°ä¸€å—å®Œæ•´çš„ RAID ç£ç›˜ï¼Œæ–‡ä»¶ååˆ™æ˜¯ `/dev/sda` ï¼Œä½†å¦‚æœæ˜¯ intel çš„èŠ¯ç‰‡ç»„ï¼Œåˆ™è¿˜æ˜¯å¯èƒ½æ˜¯ `/dev/md127` ç±»ä¼¼çš„åç§°