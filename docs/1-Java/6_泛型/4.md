---
title: æ“¦æ‹­æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æ³›å‹æ˜¯ä¸€ç§ç±»ä¼¼â€œæ¨¡æ¿ä»£ç â€çš„æŠ€æœ¯ï¼Œä¸åŒè¯­è¨€çš„æ³›å‹å®ç°æ–¹å¼ä¸ä¸€å®šç›¸åŒã€‚

Java è¯­è¨€çš„æ³›å‹å®ç°æ–¹å¼æ˜¯æ“¦æ‹­æ³•ï¼ˆType Erasureï¼‰ã€‚

æ‰€è°“æ“¦æ‹­æ³•æ˜¯æŒ‡ï¼Œ_è™šæ‹Ÿæœºå¯¹æ³›å‹å…¶å®ä¸€æ— æ‰€çŸ¥ï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯ç¼–è¯‘å™¨åšçš„_ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªæ³›å‹ç±» `Pair<T>`ï¼Œè¿™æ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```

è€Œè™šæ‹Ÿæœºæ ¹æœ¬ä¸çŸ¥é“æ³›å‹ã€‚è¿™æ˜¯è™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç ï¼š

```java
public class Pair {
    private Object first;
    private Object last;
    public Pair(Object first, Object last) {
        this.first = first;
        this.last = last;
    }
    public Object getFirst() {
        return first;
    }
    public Object getLast() {
        return last;
    }
}
```

å› æ­¤ï¼ŒJava ä½¿ç”¨æ“¦æ‹­æ³•å®ç°æ³›å‹ï¼Œå¯¼è‡´äº†ï¼š

- ç¼–è¯‘å™¨æŠŠç±»å‹ `<T>` è§†ä¸º `Object` ï¼›
- ç¼–è¯‘å™¨æ ¹æ® `<T>` å®ç°å®‰å…¨çš„å¼ºåˆ¶è½¬å‹ã€‚

ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç ä¹Ÿæ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š

```java
Pair<String> p = new Pair<>("Hello", "world");
String first = p.getFirst();
String last = p.getLast();
```

è€Œè™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç å¹¶æ²¡æœ‰æ³›å‹ï¼š

```java
Pair p = new Pair("Hello", "world");
String first = (String) p.getFirst();
String last = (String) p.getLast();
```

æ‰€ä»¥ï¼ŒJava çš„æ³›å‹æ˜¯ç”±ç¼–è¯‘å™¨åœ¨ **ç¼–è¯‘æ—¶** å®è¡Œçš„ï¼Œç¼–è¯‘å™¨å†…éƒ¨æ°¸è¿œæŠŠæ‰€æœ‰ç±»å‹ `T` è§†ä¸º `Object` å¤„ç†ï¼Œä½†æ˜¯ï¼Œåœ¨éœ€è¦è½¬å‹çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ® `T` çš„ç±»å‹è‡ªåŠ¨ä¸ºæˆ‘ä»¬å®è¡Œå®‰å…¨åœ°å¼ºåˆ¶è½¬å‹ã€‚

## ğŸ€ Java æ³›å‹çš„å±€é™

äº†è§£äº† Java æ³›å‹çš„å®ç°æ–¹å¼â€”â€”æ“¦æ‹­æ³•ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº† Java æ³›å‹çš„å±€é™ï¼š

::: warning å±€é™ä¸€
`<T>` ä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¾‹å¦‚ `int`ï¼Œå› ä¸ºå®é™…ç±»å‹æ˜¯ `Object`ï¼Œ`Object` ç±»å‹æ— æ³•æŒæœ‰åŸºæœ¬ç±»å‹ï¼š
:::

```java
Pair<int> p = new Pair<>(1, 2); // compile error!
```

::: warning å±€é™äºŒ
æ— æ³•å–å¾—å¸¦æ³›å‹çš„ `Class` ã€‚è§‚å¯Ÿä»¥ä¸‹ä»£ç ï¼š
:::

```java
public class Main {
    public static void main(String[] args) {
        Pair<String> p1 = new Pair<>("Hello", "world");
        Pair<Integer> p2 = new Pair<>(123, 456);
        Class c1 = p1.getClass();
        Class c2 = p2.getClass();
        System.out.println(c1==c2); // true
        System.out.println(c1==Pair.class); // true
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```

å› ä¸º `T` æ˜¯ `Object`ï¼Œæˆ‘ä»¬å¯¹ `Pair<String>` å’Œ `Pair<Integer>` ç±»å‹è·å– `Class` æ—¶ï¼Œè·å–åˆ°çš„æ˜¯åŒä¸€ä¸ª `Class`ï¼Œä¹Ÿå°±æ˜¯ `Pair` ç±»çš„ `Class` ã€‚

æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰æ³›å‹å®ä¾‹ï¼Œæ— è®º T çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œ`getClass()` è¿”å›åŒä¸€ä¸ª Class å®ä¾‹ï¼Œå› ä¸ºç¼–è¯‘åå®ƒä»¬å…¨éƒ¨éƒ½æ˜¯ `Pair<Object>`ã€‚

::: warning å±€é™ä¸‰
æ— æ³•åˆ¤æ–­å¸¦æ³›å‹çš„ç±»å‹ï¼š
:::

```java
Pair<Integer> p = new Pair<>(123, 456);
// Compile error:
if (p instanceof Pair<String>) {
}
```

åŸå› å’Œå‰é¢ä¸€æ ·ï¼Œå¹¶ä¸å­˜åœ¨ `Pair<String>.class`ï¼Œè€Œæ˜¯åªæœ‰å”¯ä¸€çš„ `Pair.class` ã€‚

::: warning å±€é™å››
ä¸èƒ½å®ä¾‹åŒ– `T` ç±»å‹ï¼š
:::

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair() {
        // Compile error:
        first = new T();
        last = new T();
    }
}
```

ä¸Šè¿°ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºæ„é€ æ–¹æ³•çš„ä¸¤è¡Œè¯­å¥ï¼š

```java
first = new T();
last = new T();
```

æ“¦æ‹­åå®é™…ä¸Šå˜æˆäº†ï¼š

```java
first = new Object();
last = new Object();
```

è¿™æ ·ä¸€æ¥ï¼Œåˆ›å»º `new Pair<String>()` å’Œåˆ›å»º `new Pair<Integer>()` å°±å…¨éƒ¨æˆäº† `Object`ï¼Œæ˜¾ç„¶ç¼–è¯‘å™¨è¦é˜»æ­¢è¿™ç§ç±»å‹ä¸å¯¹çš„ä»£ç ã€‚

---

è¦å®ä¾‹åŒ– `T` ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»å€ŸåŠ©é¢å¤–çš„ `Class<T>` å‚æ•°ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(Class<T> clazz) {
        first = clazz.newInstance();
        last = clazz.newInstance();
    }
}
```

ä¸Šè¿°ä»£ç å€ŸåŠ© `Class<T>` å‚æ•°å¹¶é€šè¿‡åå°„æ¥å®ä¾‹åŒ– `T` ç±»å‹ï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»ä¼ å…¥ `Class<T>` ã€‚ä¾‹å¦‚ï¼š

```java
Pair<String> pair = new Pair<>(String.class);
```

å› ä¸ºä¼ å…¥äº† `Class<String>` çš„å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ© `String.class` å°±å¯ä»¥å®ä¾‹åŒ– `String` ç±»å‹ã€‚

## ğŸ€ ä¸æ°å½“çš„è¦†å†™æ–¹æ³•

æœ‰äº›æ—¶å€™ï¼Œä¸€ä¸ªçœ‹ä¼¼æ­£ç¡®å®šä¹‰çš„æ–¹æ³•ä¼šæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼š

```java
public class Pair<T> {
    public boolean equals(T t) {
        return this == t;
    }
}
```

è¿™æ˜¯å› ä¸ºï¼Œå®šä¹‰çš„ `equals(T t)` æ–¹æ³•å®é™…ä¸Šä¼šè¢«æ“¦æ‹­æˆ `equals(Object t)`ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ç»§æ‰¿è‡ª `Object` çš„ï¼Œ~~ç¼–è¯‘å™¨ä¼šé˜»æ­¢ä¸€ä¸ªå®é™…ä¸Šä¼šå˜æˆè¦†å†™çš„æ³›å‹æ–¹æ³•å®šä¹‰~~ã€‚

æ¢ä¸ªæ–¹æ³•åï¼Œé¿å¼€ä¸ `Object.equals(Object)` çš„å†²çªå°±å¯ä»¥æˆåŠŸç¼–è¯‘ï¼š

```java
public class Pair<T> {
    public boolean same(T t) {
        return this == t;
    }
}
```

## ğŸ€ æ³›å‹ç»§æ‰¿\*

ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿è‡ªä¸€ä¸ªæ³›å‹ç±»ã€‚ä¾‹å¦‚ï¼šçˆ¶ç±»çš„ç±»å‹æ˜¯ `Pair<Integer>`ï¼Œå­ç±»çš„ç±»å‹æ˜¯ `IntPair`ï¼Œå¯ä»¥è¿™ä¹ˆç»§æ‰¿ï¼š

```java
public class IntPair extends Pair<Integer> {
}
```

ä½¿ç”¨çš„æ—¶å€™ï¼Œå› ä¸ºå­ç±» `IntPair` å¹¶æ²¡æœ‰æ³›å‹ç±»å‹ï¼Œæ‰€ä»¥ï¼Œæ­£å¸¸ä½¿ç”¨å³å¯ï¼š

```java
IntPair ip = new IntPair(1, 2);
```

å‰é¢è®²äº†ï¼Œæˆ‘ä»¬æ— æ³•è·å– `Pair<T>` çš„ `T` ç±»å‹ï¼Œå³ç»™å®šä¸€ä¸ªå˜é‡ `Pair<Integer> p`ï¼Œæ— æ³•ä» `p` ä¸­è·å–åˆ° `Integer` ç±»å‹ã€‚

ä½†æ˜¯ï¼Œåœ¨çˆ¶ç±»æ˜¯æ³›å‹ç±»å‹çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°±å¿…é¡»æŠŠç±»å‹ `T` ï¼ˆå¯¹ `IntPair` æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯ `Integer` ç±»å‹ï¼‰ä¿å­˜åˆ°å­ç±»çš„ `class` æ–‡ä»¶ä¸­ï¼Œä¸ç„¶ç¼–è¯‘å™¨å°±ä¸çŸ¥é“ `IntPair` åªèƒ½å­˜å– `Integer` è¿™ç§ç±»å‹ã€‚

åœ¨ç»§æ‰¿äº†æ³›å‹ç±»å‹çš„æƒ…å†µä¸‹ï¼Œå­ç±»å¯ä»¥è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹ã€‚ä¾‹å¦‚ï¼š `IntPair` å¯ä»¥è·å–åˆ°çˆ¶ç±»çš„æ³›å‹ç±»å‹ `Integer` ã€‚è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹ä»£ç æ¯”è¾ƒå¤æ‚ï¼š

```java
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;

public class Main {
    public static void main(String[] args) {
        Class<IntPair> clazz = IntPair.class;
        Type t = clazz.getGenericSuperclass();
        if (t instanceof ParameterizedType) {
            ParameterizedType pt = (ParameterizedType) t;
            Type[] types = pt.getActualTypeArguments(); // å¯èƒ½æœ‰å¤šä¸ªæ³›å‹ç±»å‹
            Type firstType = types[0]; // å–ç¬¬ä¸€ä¸ªæ³›å‹ç±»å‹
            Class<?> typeClass = (Class<?>) firstType;
            System.out.println(typeClass); // Integer
        }
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}

class IntPair extends Pair<Integer> {
    public IntPair(Integer first, Integer last) {
        super(first, last);
    }
}
```

å› ä¸º Java å¼•å…¥äº†æ³›å‹ï¼Œæ‰€ä»¥ï¼Œåªç”¨ Class æ¥æ ‡è¯†ç±»å‹å·²ç»ä¸å¤Ÿäº†ã€‚å®é™…ä¸Šï¼ŒJava çš„ç±»å‹ç³»ç»Ÿç»“æ„å¦‚ä¸‹ï¼š

![](assets/20221121151054.png)

## ğŸ€ å°ç»“

1. Java çš„æ³›å‹æ˜¯é‡‡ç”¨æ“¦æ‹­æ³•å®ç°çš„ï¼›
2. æ“¦æ‹­æ³•å†³å®šäº†æ³›å‹ `<T>` ï¼š
   - ä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¾‹å¦‚ï¼š `int` ï¼›
   - ä¸èƒ½è·å–å¸¦æ³›å‹ç±»å‹çš„ `Class`ï¼Œä¾‹å¦‚ï¼š `Pair<String>.class` ï¼›
   - ä¸èƒ½åˆ¤æ–­å¸¦æ³›å‹ç±»å‹çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š `x instanceof Pair<String>` ï¼›
   - ä¸èƒ½å®ä¾‹åŒ– `T` ç±»å‹ï¼Œä¾‹å¦‚ï¼š `new T()` ã€‚
3. æ³›å‹æ–¹æ³•è¦é˜²æ­¢é‡å¤å®šä¹‰æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š `public boolean equals(T obj)` ï¼›
4. å­ç±»å¯ä»¥è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹ `<T>` ã€‚
