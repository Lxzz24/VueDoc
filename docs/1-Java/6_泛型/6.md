---
title: super é€šé…ç¬¦
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


æˆ‘ä»¬å‰é¢å·²ç»è®²åˆ°äº†æ³›å‹çš„ç»§æ‰¿å…³ç³»ï¼š `Pair<Integer>` ä¸æ˜¯ `Pair<Number>` çš„å­ç±»ã€‚

è€ƒå¯Ÿä¸‹é¢çš„ `set` æ–¹æ³•ï¼š

```java
void set(Pair<Integer> p, Integer first, Integer last) {
    p.setFirst(first);
    p.setLast(last);
}
```

ä¼ å…¥ `Pair<Integer>` æ˜¯å…è®¸çš„ï¼Œä½†æ˜¯ä¼ å…¥ `Pair<Number>` æ˜¯ä¸å…è®¸çš„ã€‚

å’Œ `extends` é€šé…ç¬¦ç›¸åï¼Œè¿™æ¬¡ï¼Œæˆ‘ä»¬å¸Œæœ›æ¥å— `Pair<Integer>` ç±»å‹ï¼Œä»¥åŠ `Pair<Number>` ã€ `Pair<Object>` ï¼Œå› ä¸º `Number` å’Œ `Object` æ˜¯ `Integer` çš„çˆ¶ç±»ï¼Œ `setFirst(Number)` å’Œ `setFirst(Object)` å®é™…ä¸Šå…è®¸æ¥å— `Integer` ç±»å‹ã€‚

æˆ‘ä»¬ä½¿ç”¨ `super` é€šé…ç¬¦æ¥æ”¹å†™è¿™ä¸ªæ–¹æ³•ï¼š

```java
void set(Pair<? super Integer> p, Integer first, Integer last) {
    p.setFirst(first);
    p.setLast(last);
}
```

æ³¨æ„åˆ° `Pair<? super Integer>` è¡¨ç¤ºï¼Œæ–¹æ³•å‚æ•°æ¥å—æ‰€æœ‰æ³›å‹ç±»å‹ä¸º `Integer` æˆ– `Integer` çˆ¶ç±»çš„ `Pair` ç±»å‹ã€‚

ä¸‹é¢çš„ä»£ç å¯ä»¥è¢«æ­£å¸¸ç¼–è¯‘ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Pair<Number> p1 = new Pair<>(12.3, 4.56);
        Pair<Integer> p2 = new Pair<>(123, 456);
        setSame(p1, 100);
        setSame(p2, 200);
        System.out.println(p1.getFirst() + ", " + p1.getLast());
        System.out.println(p2.getFirst() + ", " + p2.getLast());
    }

    static void setSame(Pair<? super Integer> p, Integer n) {
        p.setFirst(n);
        p.setLast(n);
    }
}

class Pair<T> {
    private T first;
    private T last;

    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }

    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
    public void setFirst(T first) {
        this.first = first;
    }
    public void setLast(T last) {
        this.last = last;
    }
}
```


è€ƒå¯Ÿ `Pair<? super Integer>` çš„ `setFirst()` æ–¹æ³•ï¼Œå®ƒçš„æ–¹æ³•ç­¾åå®é™…ä¸Šæ˜¯ï¼š

```java
void setFirst(? super Integer);
```

å› æ­¤ï¼Œå¯ä»¥å®‰å…¨åœ°ä¼ å…¥ `Integer` ç±»å‹ã€‚

å†è€ƒå¯Ÿ `Pair<? super Integer>` çš„ `getFirst()` æ–¹æ³•ï¼Œå®ƒçš„æ–¹æ³•ç­¾åå®é™…ä¸Šæ˜¯ï¼š

```java
? super Integer getFirst();
```

è¿™é‡Œæ³¨æ„åˆ°æˆ‘ä»¬æ— æ³•ä½¿ç”¨ `Integer` ç±»å‹æ¥æ¥æ”¶ `getFirst()` çš„è¿”å›å€¼ï¼Œå³ä¸‹é¢çš„è¯­å¥å°†æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š

```java
Integer x = p.getFirst();
```

å› ä¸ºå¦‚æœä¼ å…¥çš„å®é™…ç±»å‹æ˜¯ `Pair<Number>` ï¼Œç¼–è¯‘å™¨æ— æ³•å°† `Number` ç±»å‹è½¬å‹ä¸º `Integer` ã€‚

> [!caution]
> è™½ç„¶ `Number` æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å®ä¾‹åŒ–å®ƒã€‚ä½†æ˜¯ï¼Œå³ä¾¿ `Number` ä¸æ˜¯æŠ½è±¡ç±»ï¼Œè¿™é‡Œä»ç„¶æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚æ­¤å¤–ï¼Œä¼ å…¥ `Pair<Object>` ç±»å‹æ—¶ï¼Œç¼–è¯‘å™¨ä¹Ÿæ— æ³•å°† `Object` ç±»å‹è½¬å‹ä¸º `Integer` ã€‚

å”¯ä¸€å¯ä»¥æ¥æ”¶ `getFirst()` æ–¹æ³•è¿”å›å€¼çš„æ˜¯ `Object` ç±»å‹ï¼š

```java
Object obj = p.getFirst();
```

å› æ­¤ï¼Œä½¿ç”¨ `<? super Integer>` é€šé…ç¬¦è¡¨ç¤ºï¼š

- å…è®¸è°ƒç”¨ `set(? super Integer)` æ–¹æ³•ä¼ å…¥ `Integer` çš„å¼•ç”¨ï¼›
- ä¸å…è®¸è°ƒç”¨ `get()` æ–¹æ³•è·å¾— `Integer` çš„å¼•ç”¨ã€‚

å”¯ä¸€ä¾‹å¤–æ˜¯å¯ä»¥è·å– `Object` çš„å¼•ç”¨ï¼š `Object o = p.getFirst()` ã€‚

æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ `<? super Integer>` é€šé…ç¬¦ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œè¡¨ç¤ºæ–¹æ³•å†…éƒ¨ä»£ç å¯¹äºå‚æ•°åªèƒ½å†™ï¼Œä¸èƒ½è¯»ã€‚


## ğŸ€ å¯¹æ¯” extends å’Œ super é€šé…ç¬¦

æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ `extends` é€šé…ç¬¦ã€‚ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œ `<? extends T>` ç±»å‹å’Œ `<? super T >` ç±»å‹çš„åŒºåˆ«åœ¨äºï¼š

- `<? extends T>` å…è®¸è°ƒç”¨è¯»æ–¹æ³• `T get()` è·å– `T` çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨å†™æ–¹æ³• `set(T)` ä¼ å…¥ `T` çš„å¼•ç”¨ï¼ˆä¼ å…¥ `null` é™¤å¤–ï¼‰ï¼›
- `<? super T>` å…è®¸è°ƒç”¨å†™æ–¹æ³• `set(T)` ä¼ å…¥ `T` çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨è¯»æ–¹æ³• `T get()` è·å– `T` çš„å¼•ç”¨ï¼ˆè·å– `Object` é™¤å¤–ï¼‰ã€‚

ä¸€ä¸ªæ˜¯å…è®¸è¯»ä¸å…è®¸å†™ï¼Œå¦ä¸€ä¸ªæ˜¯å…è®¸å†™ä¸å…è®¸è¯»ã€‚

å…ˆè®°ä½ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬æ¥çœ‹ Java æ ‡å‡†åº“çš„ `Collections` ç±»å®šä¹‰çš„ `copy()` æ–¹æ³•ï¼š

```java
public class Collections {
    // æŠŠ src çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶åˆ° dest ä¸­:
    public static <T> void copy(List<? super T> dest, List<? extends T> src) {
        for (int i=0; i<src.size(); i++) {
            T t = src.get(i);
            dest.add(t);
        }
    }
}
```

å®ƒçš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ª `List` çš„æ¯ä¸ªå…ƒç´ ä¾æ¬¡æ·»åŠ åˆ°å¦ä¸€ä¸ª `List` ä¸­ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `List<? super T>` ï¼Œè¡¨ç¤ºç›®æ ‡ `List` ï¼Œç¬¬äºŒä¸ªå‚æ•° `List<? extends T>` ï¼Œè¡¨ç¤ºè¦å¤åˆ¶çš„ `List` ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç”¨ `for` å¾ªç¯å®ç°å¤åˆ¶ã€‚åœ¨ `for` å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºç±»å‹ `<? extends T>` çš„å˜é‡ `src` ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°è·å–ç±»å‹ `T` çš„å¼•ç”¨ï¼Œè€Œå¯¹äºç±»å‹ `<? super T>` çš„å˜é‡ `dest` ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä¼ å…¥ `T` çš„å¼•ç”¨ã€‚

è¿™ä¸ª `copy()` æ–¹æ³•çš„å®šä¹‰å°±å®Œç¾åœ°å±•ç¤ºäº† `extends` å’Œ `super` çš„æ„å›¾ï¼š

- `copy()` æ–¹æ³•å†…éƒ¨ä¸ä¼šè¯»å– `dest` ï¼Œå› ä¸ºä¸èƒ½è°ƒç”¨ `dest.get()` æ¥è·å– `T` çš„å¼•ç”¨ï¼›
- `copy()` æ–¹æ³•å†…éƒ¨ä¹Ÿä¸ä¼šä¿®æ”¹ `src` ï¼Œå› ä¸ºä¸èƒ½è°ƒç”¨ `src.add(T)` ã€‚

è¿™æ˜¯ç”±ç¼–è¯‘å™¨æ£€æŸ¥æ¥å®ç°çš„ã€‚å¦‚æœåœ¨æ–¹æ³•ä»£ç ä¸­æ„å¤–ä¿®æ”¹äº† `src` ï¼Œæˆ–è€…æ„å¤–è¯»å–äº† `dest` ï¼Œå°±ä¼šå¯¼è‡´ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š

```java
public class Collections {
    // æŠŠ src çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶åˆ° dest ä¸­:
    public static <T> void copy(List<? super T> dest, List<? extends T> src) {
        ...
        T t = dest.get(0); // compile error!
        src.add(t); // compile error!
    }
}
```

è¿™ä¸ª `copy()` æ–¹æ³•çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®‰å…¨åœ°æŠŠä¸€ä¸ª `List<Integer>` æ·»åŠ åˆ° `List<Number>` ï¼Œä½†æ˜¯æ— æ³•åè¿‡æ¥æ·»åŠ ï¼š

```java
// copy List<Integer> to List<Number> ok:
List<Number> numList = ...;
List<Integer> intList = ...;
Collections.copy(numList, intList);

// ERROR: cannot copy List<Number> to List<Integer>:
Collections.copy(intList, numList);
```

è€Œè¿™äº›éƒ½æ˜¯é€šè¿‡ `super` å’Œ `extends` é€šé…ç¬¦ï¼Œå¹¶ç”±ç¼–è¯‘å™¨å¼ºåˆ¶æ£€æŸ¥æ¥å®ç°çš„ã€‚



## ğŸ€ PECS åŸåˆ™

ä½•æ—¶ä½¿ç”¨ `extends` ï¼Œä½•æ—¶ä½¿ç”¨ `super` ï¼Ÿä¸ºäº†ä¾¿äºè®°å¿†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ PECS åŸåˆ™ï¼šProducer Extends Consumer Superã€‚

å³ï¼šå¦‚æœéœ€è¦è¿”å› `T` ï¼Œå®ƒæ˜¯ç”Ÿäº§è€…ï¼ˆProducerï¼‰ï¼Œè¦ä½¿ç”¨ `extends` é€šé…ç¬¦ï¼›å¦‚æœéœ€è¦å†™å…¥ `T` ï¼Œå®ƒæ˜¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼Œè¦ä½¿ç”¨ `super` é€šé…ç¬¦ã€‚

è¿˜æ˜¯ä»¥ `Collections` çš„ `copy()` æ–¹æ³•ä¸ºä¾‹ï¼š

```java
public class Collections {
    public static <T> void copy(List<? super T> dest, List<? extends T> src) {
        for (int i=0; i<src.size(); i++) {
            T t = src.get(i); // src æ˜¯ producer
            dest.add(t); // dest æ˜¯ consumer
        }
    }
}
```

éœ€è¦è¿”å› `T` çš„ `src` æ˜¯ç”Ÿäº§è€…ï¼Œå› æ­¤å£°æ˜ä¸º `List<? extends T>` ï¼Œéœ€è¦å†™å…¥ `T` çš„ `dest` æ˜¯æ¶ˆè´¹è€…ï¼Œå› æ­¤å£°æ˜ä¸º `List<? super T>` ã€‚



## ğŸ€ æ— é™å®šé€šé…ç¬¦

æˆ‘ä»¬å·²ç»è®¨è®ºäº† `<? extends T>` å’Œ `<? super T>` ä½œä¸ºæ–¹æ³•å‚æ•°çš„ä½œç”¨ã€‚å®é™…ä¸Šï¼ŒJava çš„æ³›å‹è¿˜å…è®¸ä½¿ç”¨æ— é™å®šé€šé…ç¬¦ï¼ˆUnbounded Wildcard Typeï¼‰ï¼Œå³åªå®šä¹‰ä¸€ä¸ª `?` ï¼š

```java
void sample(Pair<?> p) {
}
```

å› ä¸º `<?>` é€šé…ç¬¦æ—¢æ²¡æœ‰ `extends` ï¼Œä¹Ÿæ²¡æœ‰ `super` ï¼Œå› æ­¤ï¼š

- ä¸å…è®¸è°ƒç”¨ `set(T)` æ–¹æ³•å¹¶ä¼ å…¥å¼•ç”¨ï¼ˆ `null` é™¤å¤–ï¼‰ï¼›
- ä¸å…è®¸è°ƒç”¨ `T get()` æ–¹æ³•å¹¶è·å– `T` å¼•ç”¨ï¼ˆåªèƒ½è·å– `Object` å¼•ç”¨ï¼‰ã€‚

æ¢å¥è¯è¯´ï¼Œæ—¢ä¸èƒ½è¯»ï¼Œä¹Ÿä¸èƒ½å†™ï¼Œé‚£åªèƒ½åšä¸€äº› `null` åˆ¤æ–­ï¼š

```java
static boolean isNull(Pair<?> p) {
    return p.getFirst() == null || p.getLast() == null;
}
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥å¼•å…¥æ³›å‹å‚æ•° `<T>` æ¶ˆé™¤ `<?>` é€šé…ç¬¦ï¼š

```java
static <T> boolean isNull(Pair<T> p) {
    return p.getFirst() == null || p.getLast() == null;
}
```

`<?>` é€šé…ç¬¦æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯ï¼š `Pair<?>` æ˜¯æ‰€æœ‰ `Pair<T>` çš„è¶…ç±»ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Pair<Integer> p = new Pair<>(123, 456);
        Pair<?> p2 = p; // å®‰å…¨åœ°å‘ä¸Šè½¬å‹
        System.out.println(p2.getFirst() + ", " + p2.getLast());
    }
}

class Pair<T> {
    private T first;
    private T last;

    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }

    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
    public void setFirst(T first) {
        this.first = first;
    }
    public void setLast(T last) {
        this.last = last;
    }
}
```


ä¸Šè¿°ä»£ç æ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œçš„ï¼Œå› ä¸º `Pair<Integer>` æ˜¯ `Pair<?>` çš„å­ç±»ï¼Œå¯ä»¥å®‰å…¨åœ°å‘ä¸Šè½¬å‹ã€‚



## ğŸ€ å°ç»“

ä½¿ç”¨ç±»ä¼¼ `<? super Integer>` é€šé…ç¬¦ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶è¡¨ç¤ºï¼š

- æ–¹æ³•å†…éƒ¨å¯ä»¥è°ƒç”¨ä¼ å…¥ `Integer` å¼•ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š `obj.setFirst(Integer n);` ï¼›
- æ–¹æ³•å†…éƒ¨æ— æ³•è°ƒç”¨è·å– `Integer` å¼•ç”¨çš„æ–¹æ³•ï¼ˆ `Object` é™¤å¤–ï¼‰ï¼Œä¾‹å¦‚ï¼š `Integer n = obj.getFirst();` ã€‚

å³ä½¿ç”¨ `super` é€šé…ç¬¦è¡¨ç¤ºåªèƒ½å†™ä¸èƒ½è¯»ã€‚

ä½¿ç”¨ `extends` å’Œ `super` é€šé…ç¬¦è¦éµå¾ª PECS åŸåˆ™ã€‚

æ— é™å®šé€šé…ç¬¦ `<?>` å¾ˆå°‘ä½¿ç”¨ï¼Œå¯ä»¥ç”¨ `<T>` æ›¿æ¢ï¼ŒåŒæ—¶å®ƒæ˜¯æ‰€æœ‰ `<T>` ç±»å‹çš„è¶…ç±»ã€‚



