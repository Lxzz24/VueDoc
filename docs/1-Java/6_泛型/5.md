---
title: extends é€šé…ç¬¦
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æˆ‘ä»¬å‰é¢å·²ç»è®²åˆ°äº†æ³›å‹çš„ç»§æ‰¿å…³ç³»ï¼š `Pair<Integer>` ä¸æ˜¯ `Pair<Number>` çš„å­ç±»ã€‚

å‡è®¾æˆ‘ä»¬å®šä¹‰äº† `Pair<T>` ï¼š

```java
public class Pair<T> { ... }
```

ç„¶åï¼Œæˆ‘ä»¬åˆé’ˆå¯¹ `Pair<Number>` ç±»å‹å†™äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒæ¥æ”¶çš„å‚æ•°ç±»å‹æ˜¯ `Pair<Number>` ï¼š

```java
public class PairHelper {
    static int add(Pair<Number> p) {
        Number first = p.getFirst();
        Number last = p.getLast();
        return first.intValue() + last.intValue();
    }
}
```

ä¸Šè¿°ä»£ç æ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘çš„ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ å…¥ï¼š

```java
int sum = PairHelper.add(new Pair<Number>(1, 2));
```

> [!caution]
> ä¼ å…¥çš„ç±»å‹æ˜¯ `Pair<Number>` ï¼Œå®é™…å‚æ•°ç±»å‹æ˜¯ `(Integer, Integer)` ã€‚

æ—¢ç„¶å®é™…å‚æ•°æ˜¯ `Integer` ç±»å‹ï¼Œè¯•è¯•ä¼ å…¥ `Pair<Integer>` ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Pair<Integer> p = new Pair<>(123, 456);
        int n = add(p);
        System.out.println(n);
    }

    static int add(Pair<Number> p) {
        Number first = p.getFirst();
        Number last = p.getLast();
        return first.intValue() + last.intValue();
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```


ç›´æ¥è¿è¡Œï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š

```
incompatible types: Pair<Integer> cannot be converted to Pair<Number>
```

åŸå› å¾ˆæ˜æ˜¾ï¼Œå› ä¸º `Pair<Integer>` ä¸æ˜¯ `Pair<Number>` çš„å­ç±»ï¼Œå› æ­¤ï¼Œ `add(Pair<Number>)` ä¸æ¥å—å‚æ•°ç±»å‹ `Pair<Integer>` ã€‚

ä½†æ˜¯ä» `add()` æ–¹æ³•çš„ä»£ç å¯çŸ¥ï¼Œä¼ å…¥ `Pair<Integer>` æ˜¯å®Œå…¨ç¬¦åˆå†…éƒ¨ä»£ç çš„ç±»å‹è§„èŒƒï¼Œå› ä¸ºè¯­å¥ï¼š

```java
Number first = p.getFirst();
Number last = p.getLast();
```

å®é™…ç±»å‹æ˜¯ `Integer` ï¼Œå¼•ç”¨ç±»å‹æ˜¯ `Number` ï¼Œæ²¡æœ‰é—®é¢˜ã€‚é—®é¢˜åœ¨äºæ–¹æ³•å‚æ•°ç±»å‹å®šæ­»äº†åªèƒ½ä¼ å…¥ `Pair<Number>` ã€‚

æœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—æ–¹æ³•å‚æ•°æ¥å— `Pair<Integer>` ï¼ŸåŠæ³•æ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯ä½¿ç”¨ `Pair<? extends Number>` ä½¿å¾—æ–¹æ³•æ¥æ”¶æ‰€æœ‰æ³›å‹ç±»å‹ä¸º `Number` æˆ– `Number` å­ç±»çš„ `Pair` ç±»å‹ã€‚æˆ‘ä»¬æŠŠä»£ç æ”¹å†™å¦‚ä¸‹ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Pair<Integer> p = new Pair<>(123, 456);
        int n = add(p);
        System.out.println(n);
    }

    static int add(Pair<? extends Number> p) {
        Number first = p.getFirst();
        Number last = p.getLast();
        return first.intValue() + last.intValue();
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```


è¿™æ ·ä¸€æ¥ï¼Œç»™æ–¹æ³•ä¼ å…¥ `Pair<Integer>` ç±»å‹æ—¶ï¼Œå®ƒç¬¦åˆå‚æ•° `Pair<? extends Number>` ç±»å‹ã€‚è¿™ç§ä½¿ç”¨ `<? extends Number>` çš„æ³›å‹å®šä¹‰ç§°ä¹‹ä¸ºä¸Šç•Œé€šé…ç¬¦ï¼ˆUpper Bounds Wildcardsï¼‰ï¼Œå³æŠŠæ³›å‹ç±»å‹ `T` çš„ä¸Šç•Œé™å®šåœ¨ `Number` äº†ã€‚

é™¤äº†å¯ä»¥ä¼ å…¥ `Pair<Integer>` ç±»å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¼ å…¥ `Pair<Double>` ç±»å‹ï¼Œ `Pair<BigDecimal>` ç±»å‹ç­‰ç­‰ï¼Œå› ä¸º `Double` å’Œ `BigDecimal` éƒ½æ˜¯ `Number` çš„å­ç±»ã€‚

å¦‚æœæˆ‘ä»¬è€ƒå¯Ÿå¯¹ `Pair<? extends Number>` ç±»å‹è°ƒç”¨ `getFirst()` æ–¹æ³•ï¼Œå®é™…çš„æ–¹æ³•ç­¾åå˜æˆäº†ï¼š

```
<? extends Number> getFirst();
```

å³è¿”å›å€¼æ˜¯ `Number` æˆ– `Number` çš„å­ç±»ï¼Œå› æ­¤ï¼Œå¯ä»¥å®‰å…¨èµ‹å€¼ç»™ `Number` ç±»å‹çš„å˜é‡ï¼š

```java
Number x = p.getFirst();
```

ç„¶åï¼Œæˆ‘ä»¬ä¸å¯é¢„æµ‹å®é™…ç±»å‹å°±æ˜¯ `Integer` ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼š

```java
Integer x = p.getFirst();
```

è¿™æ˜¯å› ä¸ºå®é™…çš„è¿”å›ç±»å‹å¯èƒ½æ˜¯ `Integer` ï¼Œä¹Ÿå¯èƒ½æ˜¯ `Double` æˆ–è€…å…¶ä»–ç±»å‹ï¼Œç¼–è¯‘å™¨åªèƒ½ç¡®å®šç±»å‹ä¸€å®šæ˜¯ `Number` çš„å­ç±»ï¼ˆåŒ…æ‹¬ `Number` ç±»å‹æœ¬èº«ï¼‰ï¼Œä½†å…·ä½“ç±»å‹æ— æ³•ç¡®å®šã€‚

æˆ‘ä»¬å†æ¥è€ƒå¯Ÿä¸€ä¸‹ `Pair<T>` çš„ `set` æ–¹æ³•ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Pair<Integer> p = new Pair<>(123, 456);
        int n = add(p);
        System.out.println(n);
    }

    static int add(Pair<? extends Number> p) {
        Number first = p.getFirst();
        Number last = p.getLast();
        p.setFirst(new Integer(first.intValue() + 100));
        p.setLast(new Integer(last.intValue() + 100));
        return p.getFirst().intValue() + p.getFirst().intValue();
    }
}

class Pair<T> {
    private T first;
    private T last;

    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }

    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
    public void setFirst(T first) {
        this.first = first;
    }
    public void setLast(T last) {
        this.last = last;
    }
}
```


ä¸å‡ºæ„å¤–ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š

```
incompatible types: Integer cannot be converted to CAP#1
where CAP#1 is a fresh type-variable:
    CAP#1 extends Number from capture of ? extends Number
```


ç¼–è¯‘é”™è¯¯å‘ç”Ÿåœ¨ `p.setFirst()` ä¼ å…¥çš„å‚æ•°æ˜¯ `Integer` ç±»å‹ã€‚æœ‰äº›ç«¥é‹ä¼šé—®äº†ï¼Œæ—¢ç„¶ `p` çš„å®šä¹‰æ˜¯ `Pair<? extends Number>` ï¼Œé‚£ä¹ˆ `setFirst(? extends Number)` ä¸ºä»€ä¹ˆä¸èƒ½ä¼ å…¥ `Integer` ï¼Ÿ

åŸå› è¿˜åœ¨äºæ“¦æ‹­æ³•ã€‚å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ `p` æ˜¯ `Pair<Double>` ï¼Œæ˜¾ç„¶å®ƒæ»¡è¶³å‚æ•°å®šä¹‰ `Pair<? extends Number>` ï¼Œç„¶è€Œï¼Œ `Pair<Double>` çš„ `setFirst()` æ˜¾ç„¶æ— æ³•æ¥å— `Integer` ç±»å‹ã€‚

è¿™å°±æ˜¯ `<? extends Number>` é€šé…ç¬¦çš„ä¸€ä¸ªé‡è¦é™åˆ¶ï¼šæ–¹æ³•å‚æ•°ç­¾å `setFirst(? extends Number)` æ— æ³•ä¼ é€’ä»»ä½• `Number` çš„å­ç±»å‹ç»™ `setFirst(? extends Number)` ã€‚

è¿™é‡Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯å¯ä»¥ç»™æ–¹æ³•å‚æ•°ä¼ å…¥ `null` ï¼š

```java
p.setFirst(null); // ok, ä½†æ˜¯åé¢ä¼šæŠ›å‡º NullPointerException
p.getFirst().intValue(); // NullPointerException
```


## ğŸ€ extends é€šé…ç¬¦çš„ä½œç”¨

å¦‚æœæˆ‘ä»¬è€ƒå¯Ÿ Java æ ‡å‡†åº“çš„ `java.util.List<T>` æ¥å£ï¼Œå®ƒå®ç°çš„æ˜¯ä¸€ä¸ªç±»ä¼¼ â€œå¯å˜æ•°ç»„â€ çš„åˆ—è¡¨ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

```java
public interface List<T> {
    int size(); // è·å–ä¸ªæ•°
    T get(int index); // æ ¹æ®ç´¢å¼•è·å–æŒ‡å®šå…ƒç´ 
    void add(T t); // æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ 
    void remove(T t); // åˆ é™¤ä¸€ä¸ªå·²æœ‰å…ƒç´ 
}
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ï¼š

```java
int sumOfList(List<? extends Integer> list) {
    int sum = 0;
    for (int i=0; i<list.size(); i++) {
        Integer n = list.get(i);
        sum = sum + n;
    }
    return sum;
}
```


ä¸ºä»€ä¹ˆæˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•å‚æ•°ç±»å‹æ˜¯ `List<? extends Integer>` è€Œä¸æ˜¯ `List<Integer>` ï¼Ÿä»æ–¹æ³•å†…éƒ¨ä»£ç çœ‹ï¼Œä¼ å…¥ `List<? extends Integer>` æˆ–è€… `List<Integer>` æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä½†æ˜¯ï¼Œæ³¨æ„åˆ° `List<? extends Integer>` çš„é™åˆ¶ï¼š

- å…è®¸è°ƒç”¨ `get()` æ–¹æ³•è·å– `Integer` çš„å¼•ç”¨ï¼›
- ä¸å…è®¸è°ƒç”¨ `set(? extends Integer)` æ–¹æ³•å¹¶ä¼ å…¥ä»»ä½• `Integer` çš„å¼•ç”¨ï¼ˆ `null` é™¤å¤–ï¼‰ã€‚


å› æ­¤ï¼Œæ–¹æ³•å‚æ•°ç±»å‹ `List<? extends Integer>` è¡¨æ˜äº†è¯¥æ–¹æ³•å†…éƒ¨åªä¼šè¯»å– `List` çš„å…ƒç´ ï¼Œä¸ä¼šä¿®æ”¹ `List` çš„å…ƒç´ ï¼ˆå› ä¸ºæ— æ³•è°ƒç”¨ `add(? extends Integer)` ã€ `remove(? extends Integer)` è¿™äº›æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹å‚æ•° `List<? extends Integer>` è¿›è¡Œåªè¯»çš„æ–¹æ³•ï¼ˆæ¶æ„è°ƒç”¨ `set(null)` é™¤å¤–ï¼‰ã€‚



## ğŸ€ ä½¿ç”¨ extends é™å®š T ç±»å‹

åœ¨å®šä¹‰æ³›å‹ç±»å‹ `Pair<T>` çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `extends` é€šé…ç¬¦æ¥é™å®š `T` çš„ç±»å‹ï¼š

```java
public class Pair<T extends Number> { ... }
```

ç°åœ¨ï¼Œæˆ‘ä»¬åªèƒ½å®šä¹‰ï¼š

```java
Pair<Number> p1 = null;
Pair<Integer> p2 = new Pair<>(1, 2);
Pair<Double> p3 = null;
```

å› ä¸º `Number` ã€ `Integer` å’Œ `Double` éƒ½ç¬¦åˆ `<T extends Number>`ã€‚

é `Number` ç±»å‹å°†æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š

```java
Pair<String> p1 = null; // compile error!
Pair<Object> p2 = null; // compile error!
```

å› ä¸º `String` ã€ `Object` éƒ½ä¸ç¬¦åˆ `<T extends Number>` ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ `Number` ç±»å‹æˆ– `Number` çš„å­ç±»ã€‚


## ğŸ€ å°ç»“

ä½¿ç”¨ç±»ä¼¼ `<? extends Number>` é€šé…ç¬¦ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶è¡¨ç¤ºï¼š

- æ–¹æ³•å†…éƒ¨å¯ä»¥è°ƒç”¨è·å– `Number` å¼•ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š `Number n = obj.getFirst();` ï¼›
- æ–¹æ³•å†…éƒ¨æ— æ³•è°ƒç”¨ä¼ å…¥ `Number` å¼•ç”¨çš„æ–¹æ³•ï¼ˆ `null` é™¤å¤–ï¼‰ï¼Œä¾‹å¦‚ï¼š `obj.setFirst(Number n);` ã€‚

å³ä¸€å¥è¯æ€»ç»“ï¼š **ä½¿ç”¨ extends é€šé…ç¬¦è¡¨ç¤ºå¯ä»¥è¯»ï¼Œä¸èƒ½å†™ã€‚**

ä½¿ç”¨ç±»ä¼¼ `<T extends Number>` å®šä¹‰æ³›å‹ç±»æ—¶è¡¨ç¤ºï¼š

- æ³›å‹ç±»å‹é™å®šä¸º `Number` ä»¥åŠ `Number` çš„å­ç±»ã€‚


