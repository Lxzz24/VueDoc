---
title: éå¯¹ç§°åŠ å¯†ç®—æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


ä» DH ç®—æ³•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¬é’¥ - ç§é’¥ç»„æˆçš„å¯†é’¥å¯¹æ˜¯éå¸¸æœ‰ç”¨çš„åŠ å¯†æ–¹å¼ï¼Œå› ä¸ºå…¬é’¥æ˜¯å¯ä»¥å…¬å¼€çš„ï¼Œè€Œç§é’¥æ˜¯å®Œå…¨ä¿å¯†çš„ï¼Œç”±æ­¤å¥ å®šäº†éå¯¹ç§°åŠ å¯†çš„åŸºç¡€ã€‚

éå¯¹ç§°åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„ä¸æ˜¯ç›¸åŒçš„å¯†é’¥ï¼šåªæœ‰åŒä¸€ä¸ªå…¬é’¥ - ç§é’¥å¯¹æ‰èƒ½æ­£å¸¸åŠ è§£å¯†ã€‚

å› æ­¤ï¼Œå¦‚æœå°æ˜è¦åŠ å¯†ä¸€ä¸ªæ–‡ä»¶å‘é€ç»™å°çº¢ï¼Œä»–åº”è¯¥é¦–å…ˆå‘å°çº¢ç´¢å–å¥¹çš„å…¬é’¥ï¼Œç„¶åï¼Œä»–ç”¨å°çº¢çš„å…¬é’¥åŠ å¯†ï¼ŒæŠŠåŠ å¯†æ–‡ä»¶å‘é€ç»™å°çº¢ï¼Œæ­¤æ–‡ä»¶åªèƒ½ç”±å°çº¢çš„ç§é’¥è§£å¼€ï¼Œå› ä¸ºå°çº¢çš„ç§é’¥åœ¨å¥¹è‡ªå·±æ‰‹é‡Œï¼Œæ‰€ä»¥ï¼Œé™¤äº†å°çº¢ï¼Œæ²¡æœ‰ä»»ä½•äººèƒ½è§£å¼€æ­¤æ–‡ä»¶ã€‚

éå¯¹ç§°åŠ å¯†çš„å…¸å‹ç®—æ³•å°±æ˜¯ RSA ç®—æ³•ï¼Œå®ƒæ˜¯ç”± Ron Rivestï¼ŒAdi Shamirï¼ŒLeonard Adleman è¿™ä¸‰ä¸ªå“¥ä»¬ä¸€èµ·å‘æ˜çš„ï¼Œæ‰€ä»¥ç”¨ä»–ä»¬ä»¨çš„å§“çš„é¦–å­—æ¯ç¼©å†™è¡¨ç¤ºã€‚

éå¯¹ç§°åŠ å¯†ç›¸æ¯”å¯¹ç§°åŠ å¯†çš„æ˜¾è‘—ä¼˜ç‚¹åœ¨äºï¼Œå¯¹ç§°åŠ å¯†éœ€è¦åå•†å¯†é’¥ï¼Œè€Œéå¯¹ç§°åŠ å¯†å¯ä»¥å®‰å…¨åœ°å…¬å¼€å„è‡ªçš„å…¬é’¥ï¼Œåœ¨ N ä¸ªäººä¹‹é—´é€šä¿¡çš„æ—¶å€™ï¼šä½¿ç”¨éå¯¹ç§°åŠ å¯†åªéœ€è¦ N ä¸ªå¯†é’¥å¯¹ï¼Œæ¯ä¸ªäººåªç®¡ç†è‡ªå·±çš„å¯†é’¥å¯¹ã€‚è€Œä½¿ç”¨å¯¹ç§°åŠ å¯†éœ€è¦åˆ™éœ€è¦ `N*(N-1)/2` ä¸ªå¯†é’¥ï¼Œå› æ­¤æ¯ä¸ªäººéœ€è¦ç®¡ç† `N-1` ä¸ªå¯†é’¥ï¼Œå¯†é’¥ç®¡ç†éš¾åº¦å¤§ï¼Œè€Œä¸”éå¸¸å®¹æ˜“æ³„æ¼ã€‚

æ—¢ç„¶éå¯¹ç§°åŠ å¯†è¿™ä¹ˆå¥½ï¼Œé‚£æˆ‘ä»¬æŠ›å¼ƒå¯¹ç§°åŠ å¯†ï¼Œå®Œå…¨ä½¿ç”¨éå¯¹ç§°åŠ å¯†è¡Œä¸è¡Œï¼Ÿä¹Ÿä¸è¡Œã€‚å› ä¸ºéå¯¹ç§°åŠ å¯†çš„ç¼ºç‚¹å°±æ˜¯è¿ç®—é€Ÿåº¦éå¸¸æ…¢ï¼Œæ¯”å¯¹ç§°åŠ å¯†è¦æ…¢å¾ˆå¤šã€‚

æ‰€ä»¥ï¼Œåœ¨å®é™…åº”ç”¨çš„æ—¶å€™ï¼Œéå¯¹ç§°åŠ å¯†æ€»æ˜¯å’Œå¯¹ç§°åŠ å¯†ä¸€èµ·ä½¿ç”¨ã€‚å‡è®¾å°æ˜éœ€è¦ç»™å°çº¢éœ€è¦ä¼ è¾“åŠ å¯†æ–‡ä»¶ï¼Œä»–ä¿©é¦–å…ˆäº¤æ¢äº†å„è‡ªçš„å…¬é’¥ï¼Œç„¶åï¼š

1. å°æ˜ç”Ÿæˆä¸€ä¸ªéšæœºçš„ AES å£ä»¤ï¼Œç„¶åç”¨å°çº¢çš„å…¬é’¥é€šè¿‡ RSA åŠ å¯†è¿™ä¸ªå£ä»¤ï¼Œå¹¶å‘ç»™å°çº¢ï¼›
2. å°çº¢ç”¨è‡ªå·±çš„ RSA ç§é’¥è§£å¯†å¾—åˆ° AES å£ä»¤ï¼›
3. åŒæ–¹ä½¿ç”¨è¿™ä¸ªå…±äº«çš„ AES å£ä»¤ç”¨ AES åŠ å¯†é€šä¿¡ã€‚

å¯è§éå¯¹ç§°åŠ å¯†å®é™…ä¸Šåº”ç”¨åœ¨ç¬¬ä¸€æ­¥ï¼Œå³åŠ å¯† â€œAES å£ä»¤â€ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¸¸ç”¨çš„ HTTPS åè®®çš„åšæ³•ï¼Œå³æµè§ˆå™¨å’ŒæœåŠ¡å™¨å…ˆé€šè¿‡ RSA äº¤æ¢ AES å£ä»¤ï¼Œæ¥ä¸‹æ¥åŒæ–¹é€šä¿¡å®é™…ä¸Šé‡‡ç”¨çš„æ˜¯é€Ÿåº¦è¾ƒå¿«çš„ AES å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯ç¼“æ…¢çš„ RSA éå¯¹ç§°åŠ å¯†ã€‚

Java æ ‡å‡†åº“æä¾›äº† RSA ç®—æ³•çš„å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
import java.math.BigInteger;
import java.security.*;
import javax.crypto.Cipher;
public class Main {
    public static void main(String[] args) throws Exception {
        // æ˜æ–‡:
        byte[] plain = "Hello, encrypt use RSA".getBytes("UTF-8");
        // åˆ›å»ºå…¬é’¥ï¼ç§é’¥å¯¹:
        Person alice = new Person("Alice");
        // ç”¨ Alice çš„å…¬é’¥åŠ å¯†:
        byte[] pk = alice.getPublicKey();
        System.out.println(String.format("public key: %x", new BigInteger(1, pk)));
        byte[] encrypted = alice.encrypt(plain);
        System.out.println(String.format("encrypted: %x", new BigInteger(1, encrypted)));
        // ç”¨ Alice çš„ç§é’¥è§£å¯†:
        byte[] sk = alice.getPrivateKey();
        System.out.println(String.format("private key: %x", new BigInteger(1, sk)));
        byte[] decrypted = alice.decrypt(encrypted);
        System.out.println(new String(decrypted, "UTF-8"));
    }
}

class Person {
    String name;
    // ç§é’¥:
    PrivateKey sk;
    // å…¬é’¥:
    PublicKey pk;

    public Person(String name) throws GeneralSecurityException {
        this.name = name;
        // ç”Ÿæˆå…¬é’¥ï¼ç§é’¥å¯¹:
        KeyPairGenerator kpGen = KeyPairGenerator.getInstance("RSA");
        kpGen.initialize(1024);
        KeyPair kp = kpGen.generateKeyPair();
        this.sk = kp.getPrivate();
        this.pk = kp.getPublic();
    }

    // æŠŠç§é’¥å¯¼å‡ºä¸ºå­—èŠ‚
    public byte[] getPrivateKey() {
        return this.sk.getEncoded();
    }

    // æŠŠå…¬é’¥å¯¼å‡ºä¸ºå­—èŠ‚
    public byte[] getPublicKey() {
        return this.pk.getEncoded();
    }

    // ç”¨å…¬é’¥åŠ å¯†:
    public byte[] encrypt(byte[] message) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance("RSA");
        cipher.init(Cipher.ENCRYPT_MODE, this.pk);
        return cipher.doFinal(message);
    }

    // ç”¨ç§é’¥è§£å¯†:
    public byte[] decrypt(byte[] input) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance("RSA");
        cipher.init(Cipher.DECRYPT_MODE, this.sk);
        return cipher.doFinal(input);
    }
}

```


RSA çš„å…¬é’¥å’Œç§é’¥éƒ½å¯ä»¥é€šè¿‡ `getEncoded()` æ–¹æ³•è·å¾—ä»¥ `byte[]` è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚è¦ä» `byte[]` æ•°ç»„æ¢å¤å…¬é’¥æˆ–ç§é’¥ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```java
byte[] pkData = ...
byte[] skData = ...
KeyFactory kf = KeyFactory.getInstance("RSA");
// æ¢å¤å…¬é’¥:
X509EncodedKeySpec pkSpec = new X509EncodedKeySpec(pkData);
PublicKey pk = kf.generatePublic(pkSpec);
// æ¢å¤ç§é’¥:
PKCS8EncodedKeySpec skSpec = new PKCS8EncodedKeySpec(skData);
PrivateKey sk = kf.generatePrivate(skSpec);
```

ä»¥ RSA ç®—æ³•ä¸ºä¾‹ï¼Œå®ƒçš„å¯†é’¥æœ‰ 256/512/1024/2048/4096 ç­‰ä¸åŒçš„é•¿åº¦ã€‚é•¿åº¦è¶Šé•¿ï¼Œå¯†ç å¼ºåº¦è¶Šå¤§ï¼Œå½“ç„¶è®¡ç®—é€Ÿåº¦ä¹Ÿè¶Šæ…¢ã€‚

å¦‚æœä¿®æ”¹å¾…åŠ å¯†çš„ `byte[]` æ•°æ®çš„å¤§å°ï¼Œå¯ä»¥å‘ç°ï¼Œä½¿ç”¨ 512bit çš„ RSA åŠ å¯†æ—¶ï¼Œæ˜æ–‡é•¿åº¦ä¸èƒ½è¶…è¿‡ 53 å­—èŠ‚ï¼Œä½¿ç”¨ 1024bit çš„ RSA åŠ å¯†æ—¶ï¼Œæ˜æ–‡é•¿åº¦ä¸èƒ½è¶…è¿‡ 117 å­—èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨ RSA çš„æ—¶å€™ï¼Œæ€»æ˜¯é…åˆ AES ä¸€èµ·ä½¿ç”¨ï¼Œå³ç”¨ AES åŠ å¯†ä»»æ„é•¿åº¦çš„æ˜æ–‡ï¼Œç”¨ RSA åŠ å¯† AES å£ä»¤ã€‚

æ­¤å¤–ï¼Œåªä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸èƒ½é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚

## ğŸ€ ç»ƒä¹ 

```java
package com.itranswarp.learnjava;

import java.math.BigInteger;
import java.security.*;

import javax.crypto.Cipher;

public class Main {
	public static void main(String[] args) throws Exception {
		// æ˜æ–‡:
		byte[] plain = "Helloï¼Œä½¿ç”¨ RSA éå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼".getBytes("UTF-8");
		// åˆ›å»ºå…¬é’¥ï¼ç§é’¥å¯¹:
		Person alice = new Person("Alice");
		// ç”¨ Alice çš„å…¬é’¥åŠ å¯†:
		byte[] pk = alice.getPublicKey();
		System.out.println(String.format("public key: %x", new BigInteger(1, pk)));
		byte[] encrypted = alice.encrypt(plain);
		System.out.println(String.format("encrypted: %x", new BigInteger(1, encrypted)));
		// ç”¨ Alice çš„ç§é’¥è§£å¯†:
		byte[] sk = alice.getPrivateKey();
		System.out.println(String.format("private key: %x", new BigInteger(1, sk)));
		byte[] decrypted = alice.decrypt(encrypted);
		System.out.println(new String(decrypted, "UTF-8"));
	}
}

class Person {
	String name;
	// ç§é’¥:
	PrivateKey sk;
	// å…¬é’¥:
	PublicKey pk;

	public Person(String name) throws GeneralSecurityException {
		this.name = name;
		// ç”Ÿæˆå…¬é’¥ï¼ç§é’¥å¯¹:
		KeyPairGenerator kpGen = KeyPairGenerator.getInstance("RSA");
		kpGen.initialize(1024);
		KeyPair kp = kpGen.generateKeyPair();
		this.sk = kp.getPrivate();
		this.pk = kp.getPublic();
	}

	// æŠŠç§é’¥å¯¼å‡ºä¸ºå­—èŠ‚
	public byte[] getPrivateKey() {
		return this.sk.getEncoded();
	}

	// æŠŠå…¬é’¥å¯¼å‡ºä¸ºå­—èŠ‚
	public byte[] getPublicKey() {
		return this.pk.getEncoded();
	}

	// ç”¨å…¬é’¥åŠ å¯†:
	public byte[] encrypt(byte[] message) throws GeneralSecurityException {
		Cipher cipher = Cipher.getInstance("RSA");
		cipher.init(Cipher.ENCRYPT_MODE, this.pk);
		return cipher.doFinal(message);
	}

	// ç”¨ç§é’¥è§£å¯†:
	public byte[] decrypt(byte[] input) throws GeneralSecurityException {
		Cipher cipher = Cipher.getInstance("RSA");
		cipher.init(Cipher.DECRYPT_MODE, this.sk);
		return cipher.doFinal(input);
	}
}

```

## ğŸ€ å°ç»“

éå¯¹ç§°åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„ä¸æ˜¯ç›¸åŒçš„å¯†é’¥ï¼Œåªæœ‰åŒä¸€ä¸ªå…¬é’¥ - ç§é’¥å¯¹æ‰èƒ½æ­£å¸¸åŠ è§£å¯†ï¼›

åªä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸èƒ½é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚