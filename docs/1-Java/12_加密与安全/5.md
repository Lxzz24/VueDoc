---
title: å¯¹ç§°åŠ å¯†ç®—æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


å¯¹ç§°åŠ å¯†ç®—æ³•å°±æ˜¯ä¼ ç»Ÿçš„ç”¨ä¸€ä¸ªå¯†ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ WinZIP å’Œ WinRAR å¯¹å‹ç¼©åŒ…çš„åŠ å¯†å’Œè§£å¯†ï¼Œå°±æ˜¯ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š

![winrar](assets/l-20231128143540172.jpeg)

ä»ç¨‹åºçš„è§’åº¦çœ‹ï¼Œæ‰€è°“åŠ å¯†ï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶å¯†ç å’Œæ˜æ–‡ï¼Œç„¶åè¾“å‡ºå¯†æ–‡ï¼š

```java
secret = encrypt(key, message);
```

è€Œè§£å¯†åˆ™ç›¸åï¼Œå®ƒæ¥æ”¶å¯†ç å’Œå¯†æ–‡ï¼Œç„¶åè¾“å‡ºæ˜æ–‡ï¼š

```java
plain = decrypt(key, secret);
```

åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå¸¸ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼š

| ç®—æ³• | å¯†é’¥é•¿åº¦    | å·¥ä½œæ¨¡å¼             | å¡«å……æ¨¡å¼                                |
| :--- | :---------- | :------------------- | :-------------------------------------- |
| DES  | 56/64       | ECB/CBC/PCBC/CTR/... | NoPadding/PKCS5Padding/...              |
| AES  | 128/192/256 | ECB/CBC/PCBC/CTR/... | NoPadding/PKCS5Padding/PKCS7Padding/... |
| IDEA | 128         | ECB                  | PKCS5Padding/PKCS7Padding/...           |

å¯†é’¥é•¿åº¦ç›´æ¥å†³å®šåŠ å¯†å¼ºåº¦ï¼Œè€Œå·¥ä½œæ¨¡å¼å’Œå¡«å……æ¨¡å¼å¯ä»¥çœ‹æˆæ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•çš„å‚æ•°å’Œæ ¼å¼é€‰æ‹©ã€‚Java æ ‡å‡†åº“æä¾›çš„ç®—æ³•å®ç°å¹¶ä¸åŒ…æ‹¬æ‰€æœ‰çš„å·¥ä½œæ¨¡å¼å’Œæ‰€æœ‰å¡«å……æ¨¡å¼ï¼Œä½†æ˜¯é€šå¸¸æˆ‘ä»¬åªéœ€è¦æŒ‘é€‰å¸¸ç”¨çš„ä½¿ç”¨å°±å¯ä»¥äº†ã€‚

æœ€åæ³¨æ„ï¼ŒDES ç®—æ³•ç”±äºå¯†é’¥è¿‡çŸ­ï¼Œå¯ä»¥åœ¨çŸ­æ—¶é—´å†…è¢«æš´åŠ›ç ´è§£ï¼Œæ‰€ä»¥ç°åœ¨å·²ç»ä¸å®‰å…¨äº†ã€‚

## ğŸ€ ä½¿ç”¨ AES åŠ å¯†

AES ç®—æ³•æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„åŠ å¯†ç®—æ³•ã€‚æˆ‘ä»¬å…ˆç”¨ ECB æ¨¡å¼åŠ å¯†å¹¶è§£å¯†ï¼š

```java
import java.security.*;
import java.util.Base64;

import javax.crypto.*;
import javax.crypto.spec.*;

public class Main {
    public static void main(String[] args) throws Exception {
        // åŸæ–‡:
        String message = "Hello, world!";
        System.out.println("Message:" + message);
        // 128 ä½å¯†é’¥ = 16 bytes Key:
        byte[] key = "1234567890abcdef".getBytes("UTF-8");
        // åŠ å¯†:
        byte[] data = message.getBytes("UTF-8");
        byte[] encrypted = encrypt(key, data);
        System.out.println("Encrypted:" + Base64.getEncoder().encodeToString(encrypted));
        // è§£å¯†:
        byte[] decrypted = decrypt(key, encrypted);
        System.out.println("Decrypted:" + new String(decrypted, "UTF-8"));
    }

    // åŠ å¯†:
    public static byte[] encrypt(byte[] key, byte[] input) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
        SecretKey keySpec = new SecretKeySpec(key, "AES");
        cipher.init(Cipher.ENCRYPT_MODE, keySpec);
        return cipher.doFinal(input);
    }

    // è§£å¯†:
    public static byte[] decrypt(byte[] key, byte[] input) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
        SecretKey keySpec = new SecretKeySpec(key, "AES");
        cipher.init(Cipher.DECRYPT_MODE, keySpec);
        return cipher.doFinal(input);
    }
}
```


Java æ ‡å‡†åº“æä¾›çš„å¯¹ç§°åŠ å¯†æ¥å£éå¸¸ç®€å•ï¼Œä½¿ç”¨æ—¶æŒ‰ä»¥ä¸‹æ­¥éª¤ç¼–å†™ä»£ç ï¼š

1. æ ¹æ®ç®—æ³•åç§° / å·¥ä½œæ¨¡å¼ / å¡«å……æ¨¡å¼è·å– Cipher å®ä¾‹ï¼›
2. æ ¹æ®ç®—æ³•åç§°åˆå§‹åŒ–ä¸€ä¸ª SecretKey å®ä¾‹ï¼Œå¯†é’¥å¿…é¡»æ˜¯æŒ‡å®šé•¿åº¦ï¼›
3. ä½¿ç”¨ SecretKey åˆå§‹åŒ– Cipher å®ä¾‹ï¼Œå¹¶è®¾ç½®åŠ å¯†æˆ–è§£å¯†æ¨¡å¼ï¼›
4. ä¼ å…¥æ˜æ–‡æˆ–å¯†æ–‡ï¼Œè·å¾—å¯†æ–‡æˆ–æ˜æ–‡ã€‚

ECB æ¨¡å¼æ˜¯æœ€ç®€å•çš„ AES åŠ å¯†æ¨¡å¼ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å¯†é’¥ï¼Œå›ºå®šçš„æ˜æ–‡ä¼šç”Ÿæˆå›ºå®šçš„å¯†æ–‡ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„åŠ å¯†æ–¹å¼ä¼šå¯¼è‡´å®‰å…¨æ€§é™ä½ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡ CBC æ¨¡å¼ï¼Œå®ƒéœ€è¦ä¸€ä¸ªéšæœºæ•°ä½œä¸º IV å‚æ•°ï¼Œè¿™æ ·å¯¹äºåŒä¸€ä»½æ˜æ–‡ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯†æ–‡éƒ½ä¸åŒï¼š

```java
import java.security.*;
import java.util.Base64;
import javax.crypto.*;
import javax.crypto.spec.*;
public class Main {
    public static void main(String[] args) throws Exception {
        // åŸæ–‡:
        String message = "Hello, world!";
        System.out.println("Message:" + message);
        // 256 ä½å¯†é’¥ = 32 bytes Key:
        byte[] key = "1234567890abcdef1234567890abcdef".getBytes("UTF-8");
        // åŠ å¯†:
        byte[] data = message.getBytes("UTF-8");
        byte[] encrypted = encrypt(key, data);
        System.out.println("Encrypted:" + Base64.getEncoder().encodeToString(encrypted));
        // è§£å¯†:
        byte[] decrypted = decrypt(key, encrypted);
        System.out.println("Decrypted:" + new String(decrypted, "UTF-8"));
    }

    // åŠ å¯†:
    public static byte[] encrypt(byte[] key, byte[] input) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
        SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
        // CBC æ¨¡å¼éœ€è¦ç”Ÿæˆä¸€ä¸ª 16 bytes çš„ initialization vector:
        SecureRandom sr = SecureRandom.getInstanceStrong();
        byte[] iv = sr.generateSeed(16);
        IvParameterSpec ivps = new IvParameterSpec(iv);
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivps);
        byte[] data = cipher.doFinal(input);
        // IV ä¸éœ€è¦ä¿å¯†ï¼ŒæŠŠ IV å’Œå¯†æ–‡ä¸€èµ·è¿”å›:
        return join(iv, data);
    }

    // è§£å¯†:
    public static byte[] decrypt(byte[] key, byte[] input) throws GeneralSecurityException {
        // æŠŠ input åˆ†å‰²æˆ IV å’Œå¯†æ–‡:
        byte[] iv = new byte[16];
        byte[] data = new byte[input.length - 16];
        System.arraycopy(input, 0, iv, 0, 16);
        System.arraycopy(input, 16, data, 0, data.length);
        // è§£å¯†:
        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
        SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
        IvParameterSpec ivps = new IvParameterSpec(iv);
        cipher.init(Cipher.DECRYPT_MODE, keySpec, ivps);
        return cipher.doFinal(data);
    }

    public static byte[] join(byte[] bs1, byte[] bs2) {
        byte[] r = new byte[bs1.length + bs2.length];
        System.arraycopy(bs1, 0, r, 0, bs1.length);
        System.arraycopy(bs2, 0, r, bs1.length, bs2.length);
        return r;
    }
}

```


åœ¨ CBC æ¨¡å¼ä¸‹ï¼Œéœ€è¦ä¸€ä¸ªéšæœºç”Ÿæˆçš„ 16 å­—èŠ‚ IV å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨ `SecureRandom` ç”Ÿæˆã€‚å› ä¸ºå¤šäº†ä¸€ä¸ª `IvParameterSpec` å®ä¾‹ï¼Œå› æ­¤ï¼Œåˆå§‹åŒ–æ–¹æ³•éœ€è¦è°ƒç”¨ `Cipher` çš„ä¸€ä¸ªé‡è½½æ–¹æ³•å¹¶ä¼ å…¥ `IvParameterSpec`ã€‚

è§‚å¯Ÿè¾“å‡ºï¼Œå¯ä»¥å‘ç°æ¯æ¬¡ç”Ÿæˆçš„ IV ä¸åŒï¼Œå¯†æ–‡ä¹Ÿä¸åŒã€‚

## ğŸ€ å°ç»“

å¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå¸¸ç”¨ç®—æ³•æœ‰ DESã€AES å’Œ IDEA ç­‰ï¼›

å¯†é’¥é•¿åº¦ç”±ç®—æ³•è®¾è®¡å†³å®šï¼ŒAES çš„å¯†é’¥é•¿åº¦æ˜¯ 128/192/256 ä½ï¼›

ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦æŒ‡å®šç®—æ³•åç§°ã€å·¥ä½œæ¨¡å¼å’Œå¡«å……æ¨¡å¼ã€‚