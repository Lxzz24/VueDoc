---
title: å£ä»¤åŠ å¯†ç®—æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²çš„ AES åŠ å¯†ï¼Œç»†å¿ƒçš„ç«¥é‹å¯èƒ½ä¼šå‘ç°ï¼Œå¯†é’¥é•¿åº¦æ˜¯å›ºå®šçš„ 128/192/256 ä½ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ç”¨ WinZip/WinRAR é‚£æ ·ï¼Œéšä¾¿è¾“å…¥å‡ ä½éƒ½å¯ä»¥ã€‚

è¿™æ˜¯å› ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•å†³å®šäº†å£ä»¤å¿…é¡»æ˜¯å›ºå®šé•¿åº¦ï¼Œç„¶åå¯¹æ˜æ–‡è¿›è¡Œåˆ†å—åŠ å¯†ã€‚åˆå› ä¸ºå®‰å…¨éœ€æ±‚ï¼Œå£ä»¤é•¿åº¦å¾€å¾€éƒ½æ˜¯ 128 ä½ä»¥ä¸Šï¼Œå³è‡³å°‘ 16 ä¸ªå­—ç¬¦ã€‚

ä½†æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„åŠ å¯†è½¯ä»¶ï¼Œè¾“å…¥ 6 ä½ã€8 ä½éƒ½å¯ä»¥ï¼Œéš¾é“åŠ å¯†æ–¹å¼ä¸ä¸€æ ·ï¼Ÿ

å®é™…ä¸Šç”¨æˆ·è¾“å…¥çš„å£ä»¤å¹¶ä¸èƒ½ç›´æ¥ä½œä¸º AES çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼ˆé™¤éé•¿åº¦æ°å¥½æ˜¯ 128/192/256 ä½ï¼‰ï¼Œå¹¶ä¸”ç”¨æˆ·è¾“å…¥çš„å£ä»¤ä¸€èˆ¬éƒ½æœ‰è§„å¾‹ï¼Œå®‰å…¨æ€§è¿œè¿œä¸å¦‚å®‰å…¨éšæœºæ•°äº§ç”Ÿçš„éšæœºå£ä»¤ã€‚å› æ­¤ï¼Œç”¨æˆ·è¾“å…¥çš„å£ä»¤ï¼Œé€šå¸¸è¿˜éœ€è¦ä½¿ç”¨ PBE ç®—æ³•ï¼Œé‡‡ç”¨éšæœºæ•°æ‚å‡‘è®¡ç®—å‡ºçœŸæ­£çš„å¯†é’¥ï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚

PBE å°±æ˜¯ Password Based Encryption çš„ç¼©å†™ï¼Œå®ƒçš„ä½œç”¨å¦‚ä¸‹ï¼š

```java
key = generate(userPassword, secureRandomPassword);
```

PBE çš„**ä½œç”¨**å°±æ˜¯ _æŠŠç”¨æˆ·è¾“å…¥çš„å£ä»¤å’Œä¸€ä¸ªå®‰å…¨éšæœºçš„å£ä»¤é‡‡ç”¨æ‚å‡‘åè®¡ç®—å‡ºçœŸæ­£çš„å¯†é’¥_ã€‚ä»¥ AES å¯†é’¥ä¸ºä¾‹ï¼Œæˆ‘ä»¬è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå£ä»¤ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œé€šè¿‡ PBE ç®—æ³•è®¡ç®—å‡ºçœŸæ­£çš„ AES å£ä»¤ï¼Œå†è¿›è¡ŒåŠ å¯†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
public class Main {
    public static void main(String[] args) throws Exception {
        // æŠŠ BouncyCastle ä½œä¸º Provider æ·»åŠ åˆ° java.security:
        Security.addProvider(new BouncyCastleProvider());
        // åŸæ–‡:
        String message = "Hello, world!";
        // åŠ å¯†å£ä»¤:
        String password = "hello12345";
        // 16 bytes éšæœº Salt:
        byte[] salt = SecureRandom.getInstanceStrong().generateSeed(16);
        System.out.printf("salt: %032x\n", new BigInteger(1, salt));
        // åŠ å¯†:
        byte[] data = message.getBytes("UTF-8");
        byte[] encrypted = encrypt(password, salt, data);
        System.out.println("encrypted:" + Base64.getEncoder().encodeToString(encrypted));
        // è§£å¯†:
        byte[] decrypted = decrypt(password, salt, encrypted);
        System.out.println("decrypted:" + new String(decrypted, "UTF-8"));
    }

    // åŠ å¯†:
    public static byte[] encrypt(String password, byte[] salt, byte[] input) throws GeneralSecurityException {
        PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray());
        SecretKeyFactory skeyFactory = SecretKeyFactory.getInstance("PBEwithSHA1and128bitAES-CBC-BC");
        SecretKey skey = skeyFactory.generateSecret(keySpec);
        PBEParameterSpec pbeps = new PBEParameterSpec(salt, 1000);
        Cipher cipher = Cipher.getInstance("PBEwithSHA1and128bitAES-CBC-BC");
        cipher.init(Cipher.ENCRYPT_MODE, skey, pbeps);
        return cipher.doFinal(input);
    }

    // è§£å¯†:
    public static byte[] decrypt(String password, byte[] salt, byte[] input) throws GeneralSecurityException {
        PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray());
        SecretKeyFactory skeyFactory = SecretKeyFactory.getInstance("PBEwithSHA1and128bitAES-CBC-BC");
        SecretKey skey = skeyFactory.generateSecret(keySpec);
        PBEParameterSpec pbeps = new PBEParameterSpec(salt, 1000);
        Cipher cipher = Cipher.getInstance("PBEwithSHA1and128bitAES-CBC-BC");
        cipher.init(Cipher.DECRYPT_MODE, skey, pbeps);
        return cipher.doFinal(input);
    }
}
```

ä½¿ç”¨ PBE æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥ BouncyCastleï¼Œå¹¶æŒ‡å®šç®—æ³•æ˜¯ `PBEwithSHA1and128bitAES-CBC-BC`ã€‚è§‚å¯Ÿä»£ç ï¼Œå®é™…ä¸ŠçœŸæ­£çš„ AES å¯†é’¥æ˜¯è°ƒç”¨ `Cipher` çš„ `init()` æ–¹æ³•æ—¶åŒæ—¶ä¼ å…¥ `SecretKey` å’Œ `PBEParameterSpec` å®ç°çš„ã€‚åœ¨åˆ›å»º `PBEParameterSpec` çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†å¾ªç¯æ¬¡æ•° `1000`ï¼Œå¾ªç¯æ¬¡æ•°è¶Šå¤šï¼Œæš´åŠ›ç ´è§£éœ€è¦çš„è®¡ç®—é‡å°±è¶Šå¤§ã€‚

å¦‚æœæˆ‘ä»¬æŠŠ salt å’Œå¾ªç¯æ¬¡æ•°å›ºå®šï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªé€šç”¨çš„ â€œå£ä»¤â€ åŠ å¯†è½¯ä»¶ã€‚å¦‚æœæˆ‘ä»¬æŠŠéšæœºç”Ÿæˆçš„ salt å­˜å‚¨åœ¨ U ç›˜ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ª â€œå£ä»¤â€ åŠ  USB Key çš„åŠ å¯†è½¯ä»¶ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œå³ä½¿ç”¨æˆ·ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å¼±çš„å£ä»¤ï¼Œæ²¡æœ‰ USB Key ä»ç„¶æ— æ³•è§£å¯†ï¼Œå› ä¸º USB Key å­˜å‚¨çš„éšæœºæ•°å¯†é’¥å®‰å…¨æ€§éå¸¸é«˜ã€‚

## ğŸ€ å°ç»“

- PBE ç®—æ³•é€šè¿‡ç”¨æˆ·å£ä»¤å’Œå®‰å…¨çš„éšæœº salt è®¡ç®—å‡º Keyï¼Œç„¶åå†è¿›è¡ŒåŠ å¯†ï¼›

- Key é€šè¿‡å£ä»¤å’Œå®‰å…¨çš„éšæœº salt è®¡ç®—å¾—å‡ºï¼Œå¤§å¤§æé«˜äº†å®‰å…¨æ€§ï¼›

- PBE ç®—æ³•å†…éƒ¨ä½¿ç”¨çš„ä»ç„¶æ˜¯æ ‡å‡†å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆä¾‹å¦‚ AESï¼‰ã€‚
