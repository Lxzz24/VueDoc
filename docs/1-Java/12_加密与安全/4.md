---
title: Hmac ç®—æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::



åœ¨å‰é¢è®²åˆ°å“ˆå¸Œç®—æ³•æ—¶ï¼Œæˆ‘ä»¬è¯´ï¼Œå­˜å‚¨ç”¨æˆ·çš„å“ˆå¸Œå£ä»¤æ—¶ï¼Œè¦åŠ ç›å­˜å‚¨ï¼Œç›®çš„å°±åœ¨äºæŠµå¾¡å½©è™¹è¡¨æ”»å‡»ã€‚

æˆ‘ä»¬å›é¡¾ä¸€ä¸‹å“ˆå¸Œç®—æ³•ï¼š

```java
digest = hash(input)
```

æ­£æ˜¯å› ä¸ºç›¸åŒçš„è¾“å…¥ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼Œæˆ‘ä»¬åŠ ç›çš„ç›®çš„å°±åœ¨äºï¼Œä½¿å¾—è¾“å…¥æœ‰æ‰€å˜åŒ–ï¼š

```java
digest = hash(salt + input)
```

è¿™ä¸ª salt å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé¢å¤–çš„ â€œè®¤è¯ç â€ï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œä¸åŒçš„è®¤è¯ç ï¼Œä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡ºã€‚å› æ­¤ï¼Œè¦éªŒè¯è¾“å‡ºçš„å“ˆå¸Œï¼Œå¿…é¡»åŒæ—¶æä¾› â€œè®¤è¯ç â€ã€‚

Hmac ç®—æ³•å°±æ˜¯ä¸€ç§åŸºäºå¯†é’¥çš„æ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Hash-based Message Authentication Codeï¼Œæ˜¯ä¸€ç§æ›´å®‰å…¨çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚

Hmac ç®—æ³•æ€»æ˜¯å’ŒæŸç§å“ˆå¸Œç®—æ³•é…åˆèµ·æ¥ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ MD5 ç®—æ³•ï¼Œå¯¹åº”çš„å°±æ˜¯ HmacMD5 ç®—æ³•ï¼Œå®ƒç›¸å½“äº â€œåŠ ç›â€ çš„ MD5ï¼š

```
HmacMD5 â‰ˆ md5(secure_random_key, input)
```

å› æ­¤ï¼ŒHmacMD5 å¯ä»¥çœ‹ä½œå¸¦æœ‰ä¸€ä¸ªå®‰å…¨çš„ key çš„ MD5ã€‚ä½¿ç”¨ HmacMD5 è€Œä¸æ˜¯ç”¨ MD5 åŠ  saltï¼Œæœ‰å¦‚ä¸‹å¥½å¤„ï¼š

- HmacMD5 ä½¿ç”¨çš„ key é•¿åº¦æ˜¯ 64 å­—èŠ‚ï¼Œæ›´å®‰å…¨ï¼›
- Hmac æ˜¯æ ‡å‡†ç®—æ³•ï¼ŒåŒæ ·é€‚ç”¨äº SHA-1 ç­‰å…¶ä»–å“ˆå¸Œç®—æ³•ï¼›
- Hmac è¾“å‡ºå’ŒåŸæœ‰çš„å“ˆå¸Œç®—æ³•é•¿åº¦ä¸€è‡´ã€‚

å¯è§ï¼ŒHmac æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ key æ··å…¥æ‘˜è¦çš„ç®—æ³•ã€‚éªŒè¯æ­¤å“ˆå¸Œæ—¶ï¼Œé™¤äº†åŸå§‹çš„è¾“å…¥æ•°æ®ï¼Œè¿˜è¦æä¾› keyã€‚

ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œæˆ‘ä»¬ä¸ä¼šè‡ªå·±æŒ‡å®š keyï¼Œè€Œæ˜¯é€šè¿‡ Java æ ‡å‡†åº“çš„ KeyGenerator ç”Ÿæˆä¸€ä¸ªå®‰å…¨çš„éšæœºçš„ keyã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ HmacMD5 çš„ä»£ç ï¼š

```java
import java.math.BigInteger;
import javax.crypto.*;
public class Main {
    public static void main(String[] args) throws Exception {
        KeyGenerator keyGen = KeyGenerator.getInstance("HmacMD5");
        SecretKey key = keyGen.generateKey();
        // æ‰“å°éšæœºç”Ÿæˆçš„ key:
        byte[] skey = key.getEncoded();
        System.out.println(new BigInteger(1, skey).toString(16));
        Mac mac = Mac.getInstance("HmacMD5");
        mac.init(key);
        mac.update("HelloWorld".getBytes("UTF-8"));
        byte[] result = mac.doFinal();
        System.out.println(new BigInteger(1, result).toString(16));
    }
}
```


å’Œ MD5 ç›¸æ¯”ï¼Œä½¿ç”¨ HmacMD5 çš„æ­¥éª¤æ˜¯ï¼š

1. é€šè¿‡åç§° `HmacMD5` è·å– `KeyGenerator` å®ä¾‹ï¼›
2. é€šè¿‡ `KeyGenerator` åˆ›å»ºä¸€ä¸ª `SecretKey` å®ä¾‹ï¼›
3. é€šè¿‡åç§° `HmacMD5` è·å– `Mac` å®ä¾‹ï¼›
4. ç”¨ `SecretKey` åˆå§‹åŒ– `Mac` å®ä¾‹ï¼›
5. å¯¹ `Mac` å®ä¾‹åå¤è°ƒç”¨ `update(byte[])` è¾“å…¥æ•°æ®ï¼›
6. è°ƒç”¨ `Mac` å®ä¾‹çš„ `doFinal()` è·å–æœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨ Hmac ç®—æ³•å–ä»£åŸæœ‰çš„è‡ªå®šä¹‰çš„åŠ ç›ç®—æ³•ï¼Œå› æ­¤ï¼Œå­˜å‚¨ç”¨æˆ·åå’Œå£ä»¤çš„æ•°æ®åº“ç»“æ„å¦‚ä¸‹ï¼š

| username | secret_key (64 bytes) | password                         |
| :------- | :-------------------- | :------------------------------- |
| bob      | a8c06e05f92e...5e16   | 7e0387872a57c85ef6dddbaa12f376de |
| alice    | e6a343693985...f4be   | c1f929ac2552642b302e739bc0cdbaac |
| tim      | f27a973dfdc0...6003   | af57651c3a8a73303515804d4af43790 |

æœ‰äº† Hmac è®¡ç®—çš„å“ˆå¸Œå’Œ `SecretKey`ï¼Œæˆ‘ä»¬æƒ³è¦éªŒè¯æ€ä¹ˆåŠï¼Ÿè¿™æ—¶ï¼Œ`SecretKey` ä¸èƒ½ä» `KeyGenerator` ç”Ÿæˆï¼Œè€Œæ˜¯ä»ä¸€ä¸ª `byte[]` æ•°ç»„æ¢å¤ï¼š

```java
import java.util.Arrays;
import javax.crypto.*;
import javax.crypto.spec.*;
public class Main {
    public static void main(String[] args) throws Exception {
        byte[] hkey = new byte[] { 106, 70, -110, 125, 39, -20, 52, 56, 85, 9, -19, -72, 52, -53, 52, -45, -6, 119, -63,
                30, 20, -83, -28, 77, 98, 109, -32, -76, 121, -106, 0, -74, -107, -114, -45, 104, -104, -8, 2, 121, 6,
                97, -18, -13, -63, -30, -125, -103, -80, -46, 113, -14, 68, 32, -46, 101, -116, -104, -81, -108, 122,
                89, -106, -109 };

        SecretKey key = new SecretKeySpec(hkey, "HmacMD5");
        Mac mac = Mac.getInstance("HmacMD5");
        mac.init(key);
        mac.update("HelloWorld".getBytes("UTF-8"));
        byte[] result = mac.doFinal();
        System.out.println(Arrays.toString(result));
        // [126, 59, 37, 63, 73, 90, 111, -96, -77, 15, 82, -74, 122, -55, -67, 54]
    }
}
```


æ¢å¤ `SecretKey` çš„è¯­å¥å°±æ˜¯ `new SecretKeySpec(hkey, "HmacMD5")`ã€‚

## ğŸ€ å°ç»“

Hmac ç®—æ³•æ˜¯ä¸€ç§æ ‡å‡†çš„åŸºäºå¯†é’¥çš„å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥é…åˆ MD5ã€SHA-1 ç­‰å“ˆå¸Œç®—æ³•ï¼Œè®¡ç®—çš„æ‘˜è¦é•¿åº¦å’ŒåŸæ‘˜è¦ç®—æ³•é•¿åº¦ç›¸åŒã€‚