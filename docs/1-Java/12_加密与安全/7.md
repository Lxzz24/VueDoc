---
title: å¯†é’¥äº¤æ¢ç®—æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


å¯¹ç§°åŠ å¯†ç®—æ³•è§£å†³äº†æ•°æ®åŠ å¯†çš„é—®é¢˜ã€‚æˆ‘ä»¬ä»¥ AES åŠ å¯†ä¸ºä¾‹ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå°æ˜è¦å‘è·¯äººç”²å‘é€ä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼Œä»–å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ª AES å¯†é’¥ï¼Œå¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†æ–‡ä»¶å‘é€ç»™å¯¹æ–¹ã€‚å› ä¸ºå¯¹æ–¹è¦è§£å¯†ï¼Œå°±å¿…é¡»éœ€è¦å°æ˜ç”Ÿæˆçš„å¯†é’¥ã€‚

ç°åœ¨é—®é¢˜æ¥äº†ï¼šå¦‚ä½•ä¼ é€’å¯†é’¥ï¼Ÿ

åœ¨ä¸å®‰å…¨çš„ä¿¡é“ä¸Šä¼ é€’åŠ å¯†æ–‡ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºé»‘å®¢æ‹¿åˆ°åŠ å¯†æ–‡ä»¶æ²¡æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•å¦‚ä½•åœ¨ä¸å®‰å…¨çš„ä¿¡é“ä¸Šå®‰å…¨åœ°ä¼ è¾“å¯†é’¥ï¼Ÿ

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯†é’¥äº¤æ¢ç®—æ³•å³ DH ç®—æ³•ï¼šDiffie-Hellman ç®—æ³•åº”è¿è€Œç”Ÿã€‚

DH ç®—æ³•è§£å†³äº†å¯†é’¥åœ¨åŒæ–¹ä¸ç›´æ¥ä¼ é€’å¯†é’¥çš„æƒ…å†µä¸‹å®Œæˆå¯†é’¥äº¤æ¢ï¼Œè¿™ä¸ªç¥å¥‡çš„äº¤æ¢åŸç†å®Œå…¨ç”±æ•°å­¦ç†è®ºæ”¯æŒã€‚

æˆ‘ä»¬æ¥çœ‹ DH ç®—æ³•äº¤æ¢å¯†é’¥çš„æ­¥éª¤ã€‚å‡è®¾ç”²ä¹™åŒæ–¹éœ€è¦ä¼ é€’å¯†é’¥ï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥è¿™ä¹ˆåšï¼š

1. ç”²é¦–å…ˆé€‰æ‹©ä¸€ä¸ªç´ æ•° `p`ï¼Œä¾‹å¦‚ 97ï¼Œåº•æ•° `g` æ˜¯ `p` çš„ä¸€ä¸ªåŸæ ¹ï¼Œä¾‹å¦‚ 5ï¼Œéšæœºæ•° `a`ï¼Œä¾‹å¦‚ 123ï¼Œç„¶åè®¡ç®— `A=g^a mod p`ï¼Œç»“æœæ˜¯ 34ï¼Œç„¶åï¼Œç”²å‘é€ `pï¼97`ï¼Œ`g=5`ï¼Œ`A=34` ç»™ä¹™ï¼›
2. ä¹™æ–¹æ”¶åˆ°åï¼Œä¹Ÿé€‰æ‹©ä¸€ä¸ªéšæœºæ•° `b`ï¼Œä¾‹å¦‚ï¼Œ456ï¼Œç„¶åè®¡ç®— `B = g^b mod p`ï¼Œç»“æœæ˜¯ 75ï¼Œä¹™å†åŒæ—¶è®¡ç®— `s = A^b mod p`ï¼Œç»“æœæ˜¯ 22ï¼›
3. ä¹™æŠŠè®¡ç®—çš„ `B=75` å‘ç»™ç”²ï¼Œç”²è®¡ç®— `s ï¼ B^a mod p`ï¼Œè®¡ç®—ç»“æœä¸ä¹™ç®—å‡ºçš„ç»“æœä¸€æ ·ï¼Œéƒ½æ˜¯ 22ã€‚

æ‰€ä»¥æœ€ç»ˆåŒæ–¹åå•†å‡ºçš„å¯†é’¥ `s` æ˜¯ 22ã€‚æ³¨æ„åˆ°è¿™ä¸ªå¯†é’¥ `s` å¹¶æ²¡æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚è€Œé€šè¿‡ç½‘ç»œä¼ è¾“çš„ `p`ï¼Œ`g`ï¼Œ`A` å’Œ `B` æ˜¯æ— æ³•æ¨ç®—å‡º `s` çš„ï¼Œå› ä¸ºå®é™…ç®—æ³•é€‰æ‹©çš„ç´ æ•°æ˜¯éå¸¸å¤§çš„ã€‚

æ‰€ä»¥ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼ŒDH ç®—æ³•æ˜¯ä¸€ä¸ªå¯†é’¥åå•†ç®—æ³•ï¼ŒåŒæ–¹æœ€ç»ˆåå•†å‡ºä¸€ä¸ªå…±åŒçš„å¯†é’¥ï¼Œè€Œè¿™ä¸ªå¯†é’¥ä¸ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“ã€‚

å¦‚æœæˆ‘ä»¬æŠŠ `a` çœ‹æˆç”²çš„ç§é’¥ï¼Œ`A` çœ‹æˆç”²çš„å…¬é’¥ï¼Œ`b` çœ‹æˆä¹™çš„ç§é’¥ï¼Œ`B` çœ‹æˆä¹™çš„å…¬é’¥ï¼ŒDH ç®—æ³•çš„æœ¬è´¨å°±æ˜¯åŒæ–¹å„è‡ªç”Ÿæˆè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ï¼Œç§é’¥ä»…å¯¹è‡ªå·±å¯è§ï¼Œç„¶åäº¤æ¢å…¬é’¥ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯†é’¥ `secretKey`ï¼ŒDH ç®—æ³•é€šè¿‡æ•°å­¦å®šå¾‹ä¿è¯äº†åŒæ–¹å„è‡ªè®¡ç®—å‡ºçš„ `secretKey` æ˜¯ç›¸åŒçš„ã€‚

ä½¿ç”¨ Java å®ç° DH ç®—æ³•çš„ä»£ç å¦‚ä¸‹ï¼š

```java
import java.math.BigInteger;
import java.security.*;
import java.security.spec.*;

import javax.crypto.KeyAgreement;
public class Main {
    public static void main(String[] args) {
        // Bob å’Œ Alice:
        Person bob = new Person("Bob");
        Person alice = new Person("Alice");

        // å„è‡ªç”Ÿæˆ KeyPair:
        bob.generateKeyPair();
        alice.generateKeyPair();

        // åŒæ–¹äº¤æ¢å„è‡ªçš„ PublicKey:
        // Bob æ ¹æ® Alice çš„ PublicKey ç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:
        bob.generateSecretKey(alice.publicKey.getEncoded());
        // Alice æ ¹æ® Bob çš„ PublicKey ç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:
        alice.generateSecretKey(bob.publicKey.getEncoded());

        // æ£€æŸ¥åŒæ–¹çš„æœ¬åœ°å¯†é’¥æ˜¯å¦ç›¸åŒ:
        bob.printKeys();
        alice.printKeys();
        // åŒæ–¹çš„ SecretKey ç›¸åŒï¼Œåç»­é€šä¿¡å°†ä½¿ç”¨ SecretKey ä½œä¸ºå¯†é’¥è¿›è¡Œ AES åŠ è§£å¯†...
    }
}

class Person {
    public final String name;

    public PublicKey publicKey;
    private PrivateKey privateKey;
    private byte[] secretKey;

    public Person(String name) {
        this.name = name;
    }

    // ç”Ÿæˆæœ¬åœ° KeyPair:
    public void generateKeyPair() {
        try {
            KeyPairGenerator kpGen = KeyPairGenerator.getInstance("DH");
            kpGen.initialize(512);
            KeyPair kp = kpGen.generateKeyPair();
            this.privateKey = kp.getPrivate();
            this.publicKey = kp.getPublic();
        } catch (GeneralSecurityException e) {
            throw new RuntimeException(e);
        }
    }

    public void generateSecretKey(byte[] receivedPubKeyBytes) {
        try {
            // ä» byte[] æ¢å¤ PublicKey:
            X509EncodedKeySpec keySpec = new X509EncodedKeySpec(receivedPubKeyBytes);
            KeyFactory kf = KeyFactory.getInstance("DH");
            PublicKey receivedPublicKey = kf.generatePublic(keySpec);
            // ç”Ÿæˆæœ¬åœ°å¯†é’¥:
            KeyAgreement keyAgreement = KeyAgreement.getInstance("DH");
            keyAgreement.init(this.privateKey); // è‡ªå·±çš„ PrivateKey
            keyAgreement.doPhase(receivedPublicKey, true); // å¯¹æ–¹çš„ PublicKey
            // ç”Ÿæˆ SecretKey å¯†é’¥:
            this.secretKey = keyAgreement.generateSecret();
        } catch (GeneralSecurityException e) {
            throw new RuntimeException(e);
        }
    }

    public void printKeys() {
        System.out.printf("Name: %s\n", this.name);
        System.out.printf("Private key: %x\n", new BigInteger(1, this.privateKey.getEncoded()));
        System.out.printf("Public key: %x\n", new BigInteger(1, this.publicKey.getEncoded()));
        System.out.printf("Secret key: %x\n", new BigInteger(1, this.secretKey));
    }
}
```


ä½†æ˜¯ DH ç®—æ³•å¹¶æœªè§£å†³ä¸­é—´äººæ”»å‡»ï¼Œå³ç”²ä¹™åŒæ–¹å¹¶ä¸èƒ½ç¡®ä¿ä¸è‡ªå·±é€šä¿¡çš„æ˜¯å¦çœŸçš„æ˜¯å¯¹æ–¹ã€‚æ¶ˆé™¤ä¸­é—´äººæ”»å‡»éœ€è¦å…¶ä»–æ–¹æ³•ã€‚

## ğŸ€ ç»ƒä¹ 


```java
package com.itranswarp.learnjava;

import java.math.BigInteger;
import java.security.*;
import java.security.spec.*;

import javax.crypto.KeyAgreement;

/**
 * Learn Java from https://www.liaoxuefeng.com/
 *
 * @author liaoxuefeng
 */
public class Main {

	public static void main(String[] args) {
		// Bob å’Œ Alice:
		Person bob = new Person("Bob");
		Person alice = new Person("Alice");

		// å„è‡ªç”Ÿæˆ KeyPair:
		bob.generateKeyPair();
		alice.generateKeyPair();

		// åŒæ–¹äº¤æ¢å„è‡ªçš„ PublicKey:
		// Bob æ ¹æ® Alice çš„ PublicKey ç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:
		bob.generateSecretKey(alice.publicKey.getEncoded());
		// Alice æ ¹æ® Bob çš„ PublicKey ç”Ÿæˆè‡ªå·±çš„æœ¬åœ°å¯†é’¥:
		alice.generateSecretKey(bob.publicKey.getEncoded());

		// æ£€æŸ¥åŒæ–¹çš„æœ¬åœ°å¯†é’¥æ˜¯å¦ç›¸åŒ:
		bob.printKeys();
		alice.printKeys();
		// åŒæ–¹çš„ SecretKey ç›¸åŒï¼Œåç»­é€šä¿¡å°†ä½¿ç”¨ SecretKey ä½œä¸ºå¯†é’¥è¿›è¡Œ AES åŠ è§£å¯†...
	}
}

class Person {

	public final String name;

	public PublicKey publicKey;
	private PrivateKey privateKey;
	private byte[] secretKey;

	public Person(String name) {
		this.name = name;
	}

	// ç”Ÿæˆæœ¬åœ° KeyPair:
	public void generateKeyPair() {
		try {
			KeyPairGenerator kpGen = KeyPairGenerator.getInstance("DH");
			kpGen.initialize(512);
			KeyPair kp = kpGen.generateKeyPair();
			this.privateKey = kp.getPrivate();
			this.publicKey = kp.getPublic();
		} catch (GeneralSecurityException e) {
			throw new RuntimeException(e);
		}
	}

	public void generateSecretKey(byte[] receivedPubKeyBytes) {
		try {
			// ä» byte[] æ¢å¤ PublicKey:
			X509EncodedKeySpec keySpec = new X509EncodedKeySpec(receivedPubKeyBytes);
			KeyFactory kf = KeyFactory.getInstance("DH");
			PublicKey receivedPublicKey = kf.generatePublic(keySpec);
			// ç”Ÿæˆæœ¬åœ°å¯†é’¥:
			KeyAgreement keyAgreement = KeyAgreement.getInstance("DH");
			keyAgreement.init(this.privateKey); // è‡ªå·±çš„ PrivateKey
			keyAgreement.doPhase(receivedPublicKey, true); // å¯¹æ–¹çš„ PublicKey
			// ç”Ÿæˆ SecretKey å¯†é’¥:
			this.secretKey = keyAgreement.generateSecret();
		} catch (GeneralSecurityException e) {
			throw new RuntimeException(e);
		}
	}

	public void printKeys() {
		System.out.printf("Name: %s\n", this.name);
		System.out.printf("Private key: %x\n", new BigInteger(1, this.privateKey.getEncoded()));
		System.out.printf("Public key: %x\n", new BigInteger(1, this.publicKey.getEncoded()));
		System.out.printf("Secret key: %x\n", new BigInteger(1, this.secretKey));
	}
}
```


## ğŸ€ å°ç»“

DH ç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢åè®®ï¼Œé€šä¿¡åŒæ–¹é€šè¿‡ä¸å®‰å…¨çš„ä¿¡é“åå•†å¯†é’¥ï¼Œç„¶åè¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“ã€‚

DH ç®—æ³•æ²¡æœ‰è§£å†³ä¸­é—´äººæ”»å‡»ã€‚

