---
title: JDBC Batch
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ä½¿ç”¨ JDBC æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œç»å¸¸ä¼šæ‰§è¡Œä¸€äº›æ‰¹é‡æ“ä½œã€‚

ä¾‹å¦‚ï¼Œä¸€æ¬¡æ€§ç»™ä¼šå‘˜å¢åŠ å¯ç”¨ä¼˜æƒ åˆ¸è‹¥å¹²ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹ SQL ä»£ç ï¼š

```sql
INSERT INTO coupons (user_id, type, expires) VALUES (123, 'DISCOUNT', '2030-12-31');
INSERT INTO coupons (user_id, type, expires) VALUES (234, 'DISCOUNT', '2030-12-31');
INSERT INTO coupons (user_id, type, expires) VALUES (345, 'DISCOUNT', '2030-12-31');
INSERT INTO coupons (user_id, type, expires) VALUES (456, 'DISCOUNT', '2030-12-31');
...
```

å®é™…ä¸Šæ‰§è¡Œ JDBC æ—¶ï¼Œå› ä¸ºåªæœ‰å ä½ç¬¦å‚æ•°ä¸åŒï¼Œæ‰€ä»¥ SQL å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼š

```java
for (var params : paramsList) {
    PreparedStatement ps = conn.preparedStatement("INSERT INTO coupons (user_id, type, expires) VALUES (?,?,?)");
    ps.setLong(params.get(0));
    ps.setString(params.get(1));
    ps.setString(params.get(2));
    ps.executeUpdate();
}
```

ç±»ä¼¼çš„è¿˜æœ‰ï¼Œç»™æ¯ä¸ªå‘˜å·¥è–ªæ°´å¢åŠ  10%ï½ 30%ï¼š

```sql
UPDATE employees SET salary = salary * ? WHERE id = ?
```

é€šè¿‡ä¸€ä¸ªå¾ªç¯æ¥æ‰§è¡Œæ¯ä¸ª `PreparedStatement` è™½ç„¶å¯è¡Œï¼Œä½†æ˜¯æ€§èƒ½å¾ˆä½ã€‚SQL æ•°æ®åº“å¯¹ SQL è¯­å¥ç›¸åŒï¼Œä½†åªæœ‰å‚æ•°ä¸åŒçš„è‹¥å¹²è¯­å¥å¯ä»¥ä½œä¸º batch æ‰§è¡Œï¼Œå³æ‰¹é‡æ‰§è¡Œï¼Œè¿™ç§æ“ä½œæœ‰ç‰¹åˆ«ä¼˜åŒ–ï¼Œé€Ÿåº¦è¿œè¿œå¿«äºå¾ªç¯æ‰§è¡Œæ¯ä¸ª SQLã€‚

åœ¨ JDBC ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ SQL æ•°æ®åº“çš„è¿™ä¸€ç‰¹æ€§ï¼ŒæŠŠåŒä¸€ä¸ª SQL ä½†å‚æ•°ä¸åŒçš„è‹¥å¹²æ¬¡æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ª batch æ‰§è¡Œã€‚æˆ‘ä»¬ä»¥æ‰¹é‡æ’å…¥ä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
try (PreparedStatement ps = conn.prepareStatement("INSERT INTO students (name, gender, grade, score) VALUES (?, ?, ?, ?)")) {
    // å¯¹åŒä¸€ä¸ª PreparedStatement åå¤è®¾ç½®å‚æ•°å¹¶è°ƒç”¨ addBatch():
    for (Student s : students) {
        ps.setString(1, s.name);
        ps.setBoolean(2, s.gender);
        ps.setInt(3, s.grade);
        ps.setInt(4, s.score);
        ps.addBatch(); // æ·»åŠ åˆ° batch
    }
    // æ‰§è¡Œ batch:
    int[] ns = ps.executeBatch();
    for (int n : ns) {
        System.out.println(n + "inserted."); // batch ä¸­æ¯ä¸ª SQL æ‰§è¡Œçš„ç»“æœæ•°é‡
    }
}
```

æ‰§è¡Œ batch å’Œæ‰§è¡Œä¸€ä¸ª SQL ä¸åŒç‚¹åœ¨äºï¼Œéœ€è¦å¯¹åŒä¸€ä¸ª `PreparedStatement` åå¤è®¾ç½®å‚æ•°å¹¶è°ƒç”¨ `addBatch()`ï¼Œè¿™æ ·å°±ç›¸å½“äºç»™ä¸€ä¸ª SQL åŠ ä¸Šäº†å¤šç»„å‚æ•°ï¼Œç›¸å½“äºå˜æˆäº† â€œå¤šè¡Œâ€ SQLã€‚

ç¬¬äºŒä¸ªä¸åŒç‚¹æ˜¯è°ƒç”¨çš„ä¸æ˜¯ `executeUpdate()`ï¼Œè€Œæ˜¯ `executeBatch()`ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†å¤šç»„å‚æ•°ï¼Œç›¸åº”åœ°ï¼Œè¿”å›ç»“æœä¹Ÿæ˜¯å¤šä¸ª `int` å€¼ï¼Œå› æ­¤è¿”å›ç±»å‹æ˜¯ `int[]`ï¼Œå¾ªç¯ `int[]` æ•°ç»„å³å¯è·å–æ¯ç»„å‚æ•°æ‰§è¡Œåå½±å“çš„ç»“æœæ•°é‡ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Batch æ“ä½œ

## ğŸ€ å°ç»“

ä½¿ç”¨ JDBC çš„ batch æ“ä½œä¼šå¤§å¤§æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œå¯¹å†…å®¹ç›¸åŒï¼Œå‚æ•°ä¸åŒçš„ SQLï¼Œè¦ä¼˜å…ˆè€ƒè™‘ batch æ“ä½œã€‚
