---
title: è¿­ä»£å™¨
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚

è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰å®é™…ä¸Šåœ¨ Java çš„é›†åˆç±»ä¸­å·²ç»å¹¿æ³›ä½¿ç”¨äº†ã€‚æˆ‘ä»¬ä»¥ `List` ä¸ºä¾‹ï¼Œè¦éå† `ArrayList`ï¼Œå³ä½¿æˆ‘ä»¬çŸ¥é“å®ƒçš„å†…éƒ¨å­˜å‚¨äº†ä¸€ä¸ª `Object[]` æ•°ç»„ï¼Œä¹Ÿä¸åº”è¯¥ç›´æ¥ä½¿ç”¨æ•°ç»„ç´¢å¼•å»éå†ï¼Œå› ä¸ºè¿™æ ·éœ€è¦äº†è§£é›†åˆå†…éƒ¨çš„å­˜å‚¨ç»“æ„ã€‚å¦‚æœä½¿ç”¨ `Iterator` éå†ï¼Œé‚£ä¹ˆï¼Œ`ArrayList` å’Œ `LinkedList` éƒ½å¯ä»¥ä»¥ä¸€ç§ç»Ÿä¸€çš„æ¥å£æ¥éå†ï¼š

```java
List<String> list = ...
for (Iterator<String> it = list.iterator(); it.hasNext(); ) {
    String s = it.next();
}
```

å®é™…ä¸Šï¼Œå› ä¸º Iterator æ¨¡å¼ååˆ†æœ‰ç”¨ï¼Œå› æ­¤ï¼ŒJava å…è®¸æˆ‘ä»¬ç›´æ¥æŠŠä»»ä½•æ”¯æŒ `Iterator` çš„é›†åˆå¯¹è±¡ç”¨ `foreach` å¾ªç¯å†™å‡ºæ¥ï¼š

```java
List<String> list = ...
for (String s : list) {

}
```

ç„¶åç”± Java ç¼–è¯‘å™¨å®Œæˆ Iterator æ¨¡å¼çš„æ‰€æœ‰å¾ªç¯ä»£ç ã€‚

è™½ç„¶æˆ‘ä»¬å¯¹å¦‚ä½•ä½¿ç”¨ Iterator æœ‰äº†ä¸€å®šäº†è§£ï¼Œä½†å¦‚ä½•å®ç°ä¸€ä¸ª Iterator æ¨¡å¼å‘¢ï¼Ÿæˆ‘ä»¬ä»¥ä¸€ä¸ªè‡ªå®šä¹‰çš„é›†åˆä¸ºä¾‹ï¼Œé€šè¿‡ Iterator æ¨¡å¼å®ç°å€’åºéå†ï¼š

```java
public class ReverseArrayCollection<T> implements Iterable<T> {
    // ä»¥æ•°ç»„å½¢å¼æŒæœ‰é›†åˆ:
    private T[] array;

    public ReverseArrayCollection(T... objs) {
        this.array = Arrays.copyOfRange(objs, 0, objs.length);
    }

    public Iterator<T> iterator() {
        return ???;
    }
}
```

å®ç° Iterator æ¨¡å¼çš„å…³é”®æ˜¯è¿”å›ä¸€ä¸ª `Iterator` å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çŸ¥é“é›†åˆçš„å†…éƒ¨ç»“æ„ï¼Œå› ä¸ºå®ƒå¯ä»¥å®ç°å€’åºéå†ã€‚æˆ‘ä»¬ä½¿ç”¨ Java çš„å†…éƒ¨ç±»å®ç°è¿™ä¸ª `Iterator`ï¼š

```java
public class ReverseArrayCollection<T> implements Iterable<T> {
    private T[] array;

    public ReverseArrayCollection(T... objs) {
        this.array = Arrays.copyOfRange(objs, 0, objs.length);
    }

    public Iterator<T> iterator() {
        return new ReverseIterator();
    }

    class ReverseIterator implements Iterator<T> {
        // ç´¢å¼•ä½ç½®:
        int index;

        public ReverseIterator() {
            // åˆ›å»º Iterator æ—¶, ç´¢å¼•åœ¨æ•°ç»„æœ«å°¾:
            this.index = ReverseArrayCollection.this.array.length;
        }

        public boolean hasNext() {
            // å¦‚æœç´¢å¼•å¤§äº 0, é‚£ä¹ˆå¯ä»¥ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´  (å€’åºå¾€å‰ç§»åŠ¨):
            return index > 0;
        }

        public T next() {
            // å°†ç´¢å¼•ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶è¿”å› (å€’åºå¾€å‰ç§»åŠ¨):
            index--;
            return array[index];
        }
    }
}
```

ä½¿ç”¨å†…éƒ¨ç±»çš„å¥½å¤„æ˜¯å†…éƒ¨ç±»éšå«åœ°æŒæœ‰ä¸€ä¸ªå®ƒæ‰€åœ¨å¯¹è±¡çš„ `this` å¼•ç”¨ï¼Œå¯ä»¥é€šè¿‡ `ReverseArrayCollection.this` å¼•ç”¨åˆ°å®ƒæ‰€åœ¨çš„é›†åˆã€‚ä¸Šè¿°ä»£ç å®ç°çš„é€»è¾‘éå¸¸ç®€å•ï¼Œä½†æ˜¯å®é™…åº”ç”¨æ—¶ï¼Œå¦‚æœè€ƒè™‘åˆ°å¤šçº¿ç¨‹è®¿é—®ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿­ä»£æŸä¸ªé›†åˆï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†é›†åˆçš„å†…å®¹æ—¶ï¼Œæ˜¯å¦èƒ½ç»§ç»­å®‰å…¨åœ°è¿­ä»£ï¼Œè¿˜æ˜¯æŠ›å‡º `ConcurrentModificationException`ï¼Œå°±éœ€è¦æ›´ä»”ç»†åœ°è®¾è®¡ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Iterator æ¨¡å¼å®ç°é›†åˆçš„å€’åºéå†

## ğŸ€ å°ç»“

Iterator æ¨¡å¼å¸¸ç”¨äºéå†é›†åˆï¼Œå®ƒå…è®¸é›†åˆæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ `Iterator` æ¥å£æ¥éå†å…ƒç´ ï¼ŒåŒæ—¶ä¿è¯è°ƒç”¨è€…å¯¹é›†åˆå†…éƒ¨çš„æ•°æ®ç»“æ„ä¸€æ— æ‰€çŸ¥ï¼Œä»è€Œä½¿å¾—è°ƒç”¨è€…æ€»æ˜¯ä»¥ç›¸åŒçš„æ¥å£éå†å„ç§ä¸åŒç±»å‹çš„é›†åˆã€‚





