---
title: å‘½ä»¤
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚

å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰æ˜¯æŒ‡ï¼ŒæŠŠè¯·æ±‚å°è£…æˆä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åæ‰§è¡Œè¯¥å‘½ä»¤ã€‚

åœ¨ä½¿ç”¨å‘½ä»¤æ¨¡å¼å‰ï¼Œæˆ‘ä»¬å…ˆä»¥ä¸€ä¸ªç¼–è¾‘å™¨ä¸ºä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•å®ç°ç®€å•çš„ç¼–è¾‘æ“ä½œï¼š

```java
public class TextEditor {
    private StringBuilder buffer = new StringBuilder();

    public void copy() {
        ...
    }

    public void paste() {
        String text = getFromClipBoard();
        add(text);
    }

    public void add(String s) {
        buffer.append(s);
    }

    public void delete() {
        if (buffer.length() > 0) {
            buffer.deleteCharAt(buffer.length() - 1);
        }
    }

    public String getState() {
        return buffer.toString();
    }
}
```

æˆ‘ä»¬ç”¨ä¸€ä¸ª `StringBuilder` æ¨¡æ‹Ÿä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå®ƒæ”¯æŒ `copy()`ã€`paste()`ã€`add()`ã€`delete()` ç­‰æ–¹æ³•ã€‚

æ­£å¸¸æƒ…å†µï¼Œæˆ‘ä»¬åƒè¿™æ ·è°ƒç”¨ `TextEditor`ï¼š

```java
TextEditor editor = new TextEditor();
editor.add("Command pattern in text editor.\n");
editor.copy();
editor.paste();
System.out.println(editor.getState());
```

è¿™æ˜¯ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨æ–¹éœ€è¦äº†è§£ `TextEditor` çš„æ‰€æœ‰æ¥å£ä¿¡æ¯ã€‚

å¦‚æœæ”¹ç”¨å‘½ä»¤æ¨¡å¼ï¼Œæˆ‘ä»¬å°±è¦æŠŠè°ƒç”¨æ–¹å‘é€å‘½ä»¤å’Œæ‰§è¡Œæ–¹æ‰§è¡Œå‘½ä»¤åˆ†å¼€ã€‚æ€ä¹ˆåˆ†ï¼Ÿ

è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ä¸€ä¸ª `Command` æ¥å£ï¼š

```java
public interface Command {
    void execute();
}
```

è°ƒç”¨æ–¹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ `Command`ï¼Œç„¶åæ‰§è¡Œï¼Œå¹¶ä¸å…³å¿ƒå†…éƒ¨æ˜¯å¦‚ä½•å…·ä½“æ‰§è¡Œçš„ã€‚

ä¸ºäº†æ”¯æŒ `CopyCommand` å’Œ `PasteCommand` è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬ä» `Command` æ¥å£æ´¾ç”Ÿï¼š

```java
public class CopyCommand implements Command {
    // æŒæœ‰æ‰§è¡Œè€…å¯¹è±¡:
    private TextEditor receiver;

    public CopyCommand(TextEditor receiver) {
        this.receiver = receiver;
    }

    public void execute() {
        receiver.copy();
    }
}

public class PasteCommand implements Command {
    private TextEditor receiver;

    public PasteCommand(TextEditor receiver) {
        this.receiver = receiver;
    }

    public void execute() {
        receiver.paste();
    }
}
```

æœ€åæˆ‘ä»¬æŠŠ `Command` å’Œ `TextEditor` ç»„è£…ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯è¿™ä¹ˆå†™ï¼š

```java
TextEditor editor = new TextEditor();
editor.add("Command pattern in text editor.\n");
// æ‰§è¡Œä¸€ä¸ª CopyCommand:
Command copy = new CopyCommand(editor);
copy.execute();
editor.add("----\n");
// æ‰§è¡Œä¸€ä¸ª PasteCommand:
Command paste = new PasteCommand(editor);
paste.execute();
System.out.println(editor.getState());
```

è¿™å°±æ˜¯å‘½ä»¤æ¨¡å¼çš„ç»“æ„ï¼š

![image-20231220104707419](./assets/image-20231220104707419.png)

æœ‰çš„ç«¥é‹ä¼šæœ‰ç–‘é—®ï¼šæäº†ä¸€å¤§å † `Command`ï¼Œå¤šäº†å¥½å‡ ä¸ªç±»ï¼Œè¿˜ä¸å¦‚ç›´æ¥è¿™ä¹ˆå†™ç®€å•ï¼š

```java
TextEditor editor = new TextEditor();
editor.add("Command pattern in text editor.\n");
editor.copy();
editor.paste();
```

å®é™…ä¸Šï¼Œä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œç¡®å®å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚å¦‚æœéœ€æ±‚å¾ˆç®€å•ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨æ˜¾ç„¶æ›´ç›´è§‚è€Œä¸”æ›´ç®€å•ã€‚

é‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦å‘½ä»¤æ¨¡å¼å—ï¼Ÿ

ç­”æ¡ˆæ˜¯è§†éœ€æ±‚è€Œå®šã€‚å¦‚æœ `TextEditor` å¤æ‚åˆ°ä¸€å®šç¨‹åº¦ï¼Œå¹¶ä¸”éœ€è¦æ”¯æŒ Undoã€Redo çš„åŠŸèƒ½æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªå‘½ä»¤å¢åŠ  `undo()`ï¼š

```java
public interface Command {
    void execute();
    void undo();
}
```

ç„¶åæŠŠæ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤ç”¨ `List` ä¿å­˜èµ·æ¥ï¼Œå°±æ—¢èƒ½æ”¯æŒ Undoï¼Œåˆèƒ½æ”¯æŒ Redoã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åˆéœ€è¦ä¸€ä¸ª `Invoker` å¯¹è±¡ï¼Œè´Ÿè´£æ‰§è¡Œå‘½ä»¤å¹¶ä¿å­˜å†å²å‘½ä»¤ï¼š

![image-20231220104640638](./assets/image-20231220104640638.png)

å¯è§ï¼Œæ¨¡å¼å¸¦æ¥çš„è®¾è®¡å¤æ‚åº¦çš„å¢åŠ æ˜¯éšç€éœ€æ±‚è€Œå¢åŠ çš„ï¼Œå®ƒå‡å°‘çš„æ˜¯ç³»ç»Ÿå„ç»„ä»¶çš„è€¦åˆåº¦ã€‚

## ğŸ€ ç»ƒä¹ 

ç»™å‘½ä»¤æ¨¡å¼æ–°å¢ Add å’Œ Delete å‘½ä»¤å¹¶æ”¯æŒ Undoã€Redo æ“ä½œã€‚


## ğŸ€ å°ç»“

å‘½ä»¤æ¨¡å¼çš„è®¾è®¡æ€æƒ³æ˜¯æŠŠå‘½ä»¤çš„åˆ›å»ºå’Œæ‰§è¡Œåˆ†ç¦»ï¼Œä½¿å¾—è°ƒç”¨è€…æ— éœ€å…³å¿ƒå…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

é€šè¿‡å°è£… `Command` å¯¹è±¡ï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥ä¿å­˜å·²æ‰§è¡Œçš„å‘½ä»¤ï¼Œä»è€Œæ”¯æŒæ’¤é”€ã€é‡åšç­‰æ“ä½œã€‚








