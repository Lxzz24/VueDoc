---
title: è´£ä»»é“¾
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
--- 


> ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰æ˜¯ä¸€ç§å¤„ç†è¯·æ±‚çš„æ¨¡å¼ï¼Œå®ƒè®©å¤šä¸ªå¤„ç†å™¨éƒ½æœ‰æœºä¼šå¤„ç†è¯¥è¯·æ±‚ï¼Œç›´åˆ°å…¶ä¸­æŸä¸ªå¤„ç†æˆåŠŸä¸ºæ­¢ã€‚è´£ä»»é“¾æ¨¡å¼æŠŠå¤šä¸ªå¤„ç†å™¨ä¸²æˆé“¾ï¼Œç„¶åè®©è¯·æ±‚åœ¨é“¾ä¸Šä¼ é€’ï¼š

![image-20231220100724531](./assets/image-20231220100724531.png)

åœ¨å®é™…åœºæ™¯ä¸­ï¼Œè´¢åŠ¡å®¡æ‰¹å°±æ˜¯ä¸€ä¸ªè´£ä»»é“¾æ¨¡å¼ã€‚å‡è®¾æŸä¸ªå‘˜å·¥éœ€è¦æŠ¥é”€ä¸€ç¬”è´¹ç”¨ï¼Œå®¡æ ¸è€…å¯ä»¥åˆ†ä¸ºï¼š

- Managerï¼šåªèƒ½å®¡æ ¸ 1000 å…ƒä»¥ä¸‹çš„æŠ¥é”€ï¼›
- Directorï¼šåªèƒ½å®¡æ ¸ 10000 å…ƒä»¥ä¸‹çš„æŠ¥é”€ï¼›
- CEOï¼šå¯ä»¥å®¡æ ¸ä»»æ„é¢åº¦ã€‚

ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡æ­¤æŠ¥é”€æµç¨‹æ—¶ï¼Œæ¯ä¸ªå®¡æ ¸è€…åªå…³å¿ƒè‡ªå·±è´£ä»»èŒƒå›´å†…çš„è¯·æ±‚ï¼Œå¹¶ä¸”å¤„ç†å®ƒã€‚å¯¹äºè¶…å‡ºè‡ªå·±è´£ä»»èŒƒå›´çš„ï¼Œæ‰”ç»™ä¸‹ä¸€ä¸ªå®¡æ ¸è€…å¤„ç†ï¼Œè¿™æ ·ï¼Œå°†æ¥ç»§ç»­æ·»åŠ å®¡æ ¸è€…çš„æ—¶å€™ï¼Œä¸ç”¨æ”¹åŠ¨ç°æœ‰é€»è¾‘ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®ç°è´£ä»»é“¾æ¨¡å¼ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬è¦æŠ½è±¡å‡ºè¯·æ±‚å¯¹è±¡ï¼Œå®ƒå°†åœ¨è´£ä»»é“¾ä¸Šä¼ é€’ï¼š

```java
public class Request {
    private String name;
    private BigDecimal amount;

    public Request(String name, BigDecimal amount) {
        this.name = name;
        this.amount = amount;
    }

    public String getName() {
        return name;
    }

    public BigDecimal getAmount() {
        return amount;
    }
}
```

å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æŠ½è±¡å‡ºå¤„ç†å™¨ï¼š

```java
public interface Handler {
    // è¿”å› Boolean.TRUE = æˆåŠŸ
    // è¿”å› Boolean.FALSE = æ‹’ç»
    // è¿”å› null = äº¤ä¸‹ä¸€ä¸ªå¤„ç†
	Boolean process(Request request);
}
```

å¹¶ä¸”åšå¥½çº¦å®šï¼šå¦‚æœè¿”å› `Boolean.TRUE`ï¼Œè¡¨ç¤ºå¤„ç†æˆåŠŸï¼Œå¦‚æœè¿”å› `Boolean.FALSE`ï¼Œè¡¨ç¤ºå¤„ç†å¤±è´¥ï¼ˆè¯·æ±‚è¢«æ‹’ç»ï¼‰ï¼Œå¦‚æœè¿”å› `null`ï¼Œåˆ™äº¤ç”±ä¸‹ä¸€ä¸ª `Handler` å¤„ç†ã€‚

ç„¶åï¼Œä¾æ¬¡ç¼–å†™ ManagerHandlerã€DirectorHandler å’Œ CEOHandlerã€‚ä»¥ ManagerHandler ä¸ºä¾‹ï¼š

```java
public class ManagerHandler implements Handler {
    public Boolean process(Request request) {
        // å¦‚æœè¶…è¿‡ 1000 å…ƒï¼Œå¤„ç†ä¸äº†ï¼Œäº¤ä¸‹ä¸€ä¸ªå¤„ç†:
        if (request.getAmount().compareTo(BigDecimal.valueOf(1000)) > 0) {
            return null;
        }
        // å¯¹ Bob æœ‰åè§:
        return !request.getName().equalsIgnoreCase("bob");
    }
}
```

æœ‰äº†ä¸åŒçš„ `Handler` åï¼Œæˆ‘ä»¬è¿˜è¦æŠŠè¿™äº› `Handler` ç»„åˆèµ·æ¥ï¼Œå˜æˆä¸€ä¸ªé“¾ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç»Ÿä¸€å…¥å£å¤„ç†ï¼š

```java
public class HandlerChain {
    // æŒæœ‰æ‰€æœ‰ Handler:
    private List<Handler> handlers = new ArrayList<>();

    public void addHandler(Handler handler) {
        this.handlers.add(handler);
    }

    public boolean process(Request request) {
        // ä¾æ¬¡è°ƒç”¨æ¯ä¸ª Handler:
        for (Handler handler : handlers) {
            Boolean r = handler.process(request);
            if (r != null) {
                // å¦‚æœè¿”å› TRUE æˆ– FALSEï¼Œå¤„ç†ç»“æŸ:
                System.out.println(request + "" + (r ?"Approved by ":"Denied by ") + handler.getClass().getSimpleName());
                return r;
            }
        }
        throw new RuntimeException("Could not handle request:" + request);
    }
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯ç»„è£…å‡ºè´£ä»»é“¾ï¼Œç„¶åç”¨è´£ä»»é“¾æ¥å¤„ç†è¯·æ±‚ï¼š

```java
// æ„é€ è´£ä»»é“¾:
HandlerChain chain = new HandlerChain();
chain.addHandler(new ManagerHandler());
chain.addHandler(new DirectorHandler());
chain.addHandler(new CEOHandler());
// å¤„ç†è¯·æ±‚:
chain.process(new Request("Bob", new BigDecimal("123.45")));
chain.process(new Request("Alice", new BigDecimal("1234.56")));
chain.process(new Request("Bill", new BigDecimal("12345.67")));
chain.process(new Request("John", new BigDecimal("123456.78")));
```

è´£ä»»é“¾æ¨¡å¼æœ¬èº«å¾ˆå®¹æ˜“ç†è§£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`Handler` æ·»åŠ çš„é¡ºåºå¾ˆé‡è¦ï¼Œå¦‚æœé¡ºåºä¸å¯¹ï¼Œå¤„ç†çš„ç»“æœå¯èƒ½å°±ä¸æ˜¯ç¬¦åˆè¦æ±‚çš„ã€‚

æ­¤å¤–ï¼Œè´£ä»»é“¾æ¨¡å¼æœ‰å¾ˆå¤šå˜ç§ã€‚æœ‰äº›è´£ä»»é“¾çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡æŸä¸ª `Handler` æ‰‹åŠ¨è°ƒç”¨ä¸‹ä¸€ä¸ª `Handler` æ¥ä¼ é€’ `Request`ï¼Œä¾‹å¦‚ï¼š

```java
public class AHandler implements Handler {
    private Handler next;
    public void process(Request request) {
        if (!canProcess(request)) {
            // æ‰‹åŠ¨äº¤ç»™ä¸‹ä¸€ä¸ª Handler å¤„ç†:
            next.process(request);
        } else {
            ...
        }
    }
}
```

è¿˜æœ‰ä¸€äº›è´£ä»»é“¾æ¨¡å¼ï¼Œæ¯ä¸ª `Handler` éƒ½æœ‰æœºä¼šå¤„ç† `Request`ï¼Œé€šå¸¸è¿™ç§è´£ä»»é“¾è¢«ç§°ä¸ºæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æˆ–è€…è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œå®ƒçš„ç›®çš„ä¸æ˜¯æ‰¾åˆ°æŸä¸ª `Handler` å¤„ç†æ‰ `Request`ï¼Œè€Œæ˜¯æ¯ä¸ª `Handler` éƒ½åšä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚ï¼š

- è®°å½•æ—¥å¿—ï¼›
- æ£€æŸ¥æƒé™ï¼›
- å‡†å¤‡ç›¸å…³èµ„æºï¼›
- ...

ä¾‹å¦‚ï¼ŒJavaEE çš„ Servlet è§„èŒƒå®šä¹‰çš„ `Filter` å°±æ˜¯ä¸€ç§è´£ä»»é“¾æ¨¡å¼ï¼Œå®ƒä¸ä½†å…è®¸æ¯ä¸ª `Filter` éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œè¿˜å…è®¸æ¯ä¸ª `Filter` å†³å®šæ˜¯å¦å°†è¯·æ±‚ â€œæ”¾è¡Œâ€ ç»™ä¸‹ä¸€ä¸ª `Filter`ï¼š

```java
public class AuditFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {
        log(req);
        if (check(req)) {
            // æ”¾è¡Œ:
            chain.doFilter(req, resp);
        } else {
            // æ‹’ç»:
            sendError(resp);
        }
    }
}
```

è¿™ç§æ¨¡å¼ä¸ä½†å…è®¸ä¸€ä¸ª `Filter` è‡ªè¡Œå†³å®šå¤„ç† `ServletRequest` å’Œ `ServletResponse`ï¼Œè¿˜å¯ä»¥ â€œä¼ªé€ â€`ServletRequest` å’Œ `ServletResponse` ä»¥ä¾¿è®©ä¸‹ä¸€ä¸ª `Filter` å¤„ç†ï¼Œèƒ½å®ç°éå¸¸å¤æ‚çš„åŠŸèƒ½ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å®ç°å®¡æ‰¹

## ğŸ€ å°ç»“

è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§æŠŠå¤šä¸ªå¤„ç†å™¨ç»„åˆåœ¨ä¸€èµ·ï¼Œä¾æ¬¡å¤„ç†è¯·æ±‚çš„æ¨¡å¼ï¼›

è´£ä»»é“¾æ¨¡å¼çš„å¥½å¤„æ˜¯æ·»åŠ æ–°çš„å¤„ç†å™¨æˆ–è€…é‡æ–°æ’åˆ—å¤„ç†å™¨éå¸¸å®¹æ˜“ï¼›

è´£ä»»é“¾æ¨¡å¼ç»å¸¸ç”¨åœ¨æ‹¦æˆªã€é¢„å¤„ç†è¯·æ±‚ç­‰ã€‚





