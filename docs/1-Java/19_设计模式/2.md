---
title: ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼ˆ7 ç§ï¼‰
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

> ç»“æ„å‹æ¨¡å¼ä¸»è¦æ¶‰åŠå¦‚ä½•ç»„åˆå„ç§å¯¹è±¡ä»¥ä¾¿è·å¾—æ›´å¥½ã€æ›´çµæ´»çš„ç»“æ„ã€‚è™½ç„¶é¢å‘å¯¹è±¡çš„ç»§æ‰¿æœºåˆ¶æä¾›äº†æœ€åŸºæœ¬çš„å­ç±»æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ç»“æ„å‹æ¨¡å¼ä¸ä»…ä»…ç®€å•åœ°ä½¿ç”¨ç»§æ‰¿ï¼Œè€Œæ›´å¤šåœ°é€šè¿‡ç»„åˆä¸è¿è¡ŒæœŸçš„åŠ¨æ€ç»„åˆæ¥å®ç°æ›´çµæ´»çš„åŠŸèƒ½ã€‚

:::: tabs

@tab é€‚é…å™¨

## ğŸŒ¸ 1. Adapter

::: tip æ¥å£é€‚é…
:::

### ï¼ˆ1ï¼‰æ„å›¾

å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªç”¨æˆ·éœ€è¦çš„æ¥å£ã€‚

![](./assets/3d5b828e-5c4d-48d8-a440-281e4a8e1c92.png)

Adapter æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äº**æ¥å£ä¸å…¼å®¹**è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

### ï¼ˆ2ï¼‰ç±»å›¾

![é€‚é…å™¨ç±»æ¨¡å¼ï¼ˆäº†è§£ï¼‰](./assets/image-20240430110220613.png)

![é€‚é…å™¨å¯¹è±¡æ¨¡å¼](./assets/image-20240729111546597.png)

å…¶ä¸­ï¼š

- Target å®šä¹‰ Client ä½¿ç”¨çš„ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£ã€‚
- Client ä¸ç¬¦åˆ Target æ¥å£çš„å¯¹è±¡ååŒã€‚
- Adaptee å®šä¹‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£éœ€è¦é€‚é…ã€‚
- Adapter å¯¹ Adaptee çš„æ¥å£ä¸ Target æ¥å£è¿›è¡Œé€‚é…ã€‚

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Adapter æ¨¡å¼é€‚ç”¨äº

- _æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå®ƒçš„æ¥å£ä¸ç¬¦åˆè¦æ±‚ã€‚_
- æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œè¯¥ç±»å¯ä»¥ä¸å…¶ä»–ä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ï¼ˆå³é‚£äº›æ¥å£å¯èƒ½ä¸ä¸€å®šå…¼å®¹çš„ç±»ï¼‰ååŒå·¥ä½œã€‚ï¼ˆäº†è§£ï¼‰
- (ä»…é€‚ç”¨äºå¯¹è±¡ Adapter) æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£ã€‚å¯¹è±¡é€‚é…å™¨å¯ä»¥é€‚é…å®ƒçš„çˆ¶ç±»æ¥å£ã€‚ï¼ˆäº†è§£ï¼‰

```java {14-20}
public class AdapterPattern {
    public static void main(String[] args) {
        Target target = new Adapter();
        target.Request();
    }
}

class Target{
    public void Request(){
        System.out.println("æ™®é€šè¯·æ±‚~");
    }
}

class Adapter extends Target {
    private Adaptee adaptee = new Adaptee();
    @Override
    public void Request() {
        adaptee.SpecificRequest();
    }
}

class Adaptee{
    public void SpecificRequest(){
        System.out.println("ç‰¹æ®Šè¯·æ±‚~");
    }
}
```

@tab æ¡¥æ¥

## ğŸŒ¸ 2. Bridge

::: tip æŠ½è±¡ä¸å®ç°åˆ†ç¦»
:::

### ï¼ˆ1ï¼‰æ„å›¾

å°†æŠ½è±¡éƒ¨åˆ†ä¸å…¶å®ç°éƒ¨åˆ†**åˆ†ç¦»**ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥*ç‹¬ç«‹åœ°å˜åŒ–*ã€‚

### ï¼ˆ2ï¼‰ç±»å›¾

![æ¡¥æ¥](./assets/image-20230414163901596.png)

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

- ä¸å¸Œæœ›åœ¨æŠ½è±¡å’Œå®ƒçš„å®ç°éƒ¨åˆ†ä¹‹é—´æœ‰ä¸€ä¸ªå›ºå®šçš„ç»‘å®šå…³ç³»ã€‚
- ç±»çš„æŠ½è±¡ä»¥åŠå®ƒçš„å®ç°éƒ½åº”è¯¥å¯ä»¥é€šè¿‡ç”Ÿæˆå­ç±»çš„æ–¹æ³•åŠ ä»¥æ‰©å……ã€‚
- å¯¹ä¸€ä¸ªæŠ½è±¡çš„å®ç°éƒ¨åˆ†çš„ä¿®æ”¹åº”å¯¹å®¢æˆ·ä¸äº§ç”Ÿå½±å“ï¼Œå³å®¢æˆ·ä»£ç ä¸å¿…é‡æ–°ç¼–è¯‘ã€‚(C++) æƒ³å¯¹å®¢æˆ·å®Œå…¨éšè—æŠ½è±¡çš„å®ç°éƒ¨åˆ†ã€‚
- æœ‰è®¸å¤šç±»è¦ç”Ÿæˆçš„ç±»å±‚æ¬¡ç»“æ„ã€‚
- æƒ³åœ¨å¤šä¸ªå¯¹è±¡é—´å…±äº«å®ç°ï¼ˆå¯èƒ½ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼‰ï¼Œä½†åŒæ—¶è¦æ±‚å®¢æˆ·å¹¶ä¸çŸ¥é“è¿™ä¸€ç‚¹ã€‚

```java {34,38,44-46}
public class BridgePattern {
    public static void main(String[] args) {
        Product productA = new ProductA();
        Product productB = new ProductA();

        Color red = new Red();
        productA.setName("äº§å“A");
        productA.setColor(red);
        productA.Operation();

        Blue blue = new Blue();
        productB.setName("äº§å“B");
        productB.setColor(blue);
        productB.Operation();
    }
}

abstract class Product{
    private String name;
    protected Color color;

    public void setName(String name){
        this.name = name;
    }

    public String getName(){
        return name;
    }

    public void setColor(Color color){
        this.color = color;
    }

    public abstract void Operation();
}

interface Color{
    void OperationImpl(String name);
}

class ProductA extends Product{

    @Override
    public void Operation() {
        color.OperationImpl(this.getName());
    }
}

class Red implements Color{

    @Override
    public void OperationImpl(String name) {
        System.out.println(name + ": çº¢è‰²" );
    }
}

class Blue implements Color{

    @Override
    public void OperationImpl(String name) {
        System.out.println(name + ": è“è‰²" );
    }
}
```

@tab ç»„åˆ

## ğŸŒ¸ 3. Composite

::: tip éƒ¨åˆ†-æ•´ä½“
:::

### ï¼ˆ1ï¼‰æ„å›¾

å°†å¯¹è±¡ç»„åˆæˆæ ‘å‹ç»“æ„ä»¥è¡¨ç¤º **â€œéƒ¨åˆ†-æ•´ä½“â€** çš„å±‚æ¬¡ç»“æ„ã€‚Composite ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰**ä¸€è‡´æ€§**ã€‚

> ä¾‹å¦‚ï¼Œæ–‡ä»¶-æ–‡ä»¶å¤¹

### ï¼ˆ2ï¼‰ç±»å›¾

![ç»„åˆ](./assets/image-20240430135919199.png)

å…¶ä¸­ï¼š

- _Component_ ä¸ºç»„åˆä¸­çš„å¯¹åƒ _å£°æ˜æ¥å£_ï¼šåœ¨é€‚å½“æƒ…å†µä¸‹å®ç°æ‰€æœ‰ç±»å…±æœ‰æ¥å£çš„é»˜è®¤è¡Œä¸ºï¼šå£°æ˜ä¸€ä¸ªæ¥å£ç”¨äºè®¿é—®å’Œç®¡ç† Component çš„å­ç»„ä»¶ï¼›ï¼ˆå¯é€‰ï¼‰åœ¨é€’å½’ç»“æ„ä¸­å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè®¿é—®ä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œå¹¶åœ¨åˆé€‚çš„æƒ…å†µä¸‹å®ç°å®ƒã€‚
- _Leaf_ åœ¨ç»„åˆä¸­è¡¨ç¤ºå¶ç»“ç‚¹å¯¹è±¡ï¼Œå¶ç»“ç‚¹æ²¡æœ‰å­ç»“ç‚¹ï¼›åœ¨ç»„åˆä¸­ _å®šä¹‰å›¾å…ƒå¯¹è±¡çš„è¡Œä¸º_ã€‚
- _Composite_ _å®šä¹‰æœ‰å­ç»„ä»¶çš„é‚£äº›ç»„ä»¶çš„è¡Œä¸º_ï¼›å­˜å‚¨å­ç»„ä»¶ï¼›åœ¨ Component æ¥å£ä¸­å®ç°ä¸å­ç»„ä»¶æœ‰å…³çš„æ“ä½œã€‚
- _Client é€šè¿‡ Component æ¥å£æ“çºµç»„åˆç»„ä»¶çš„å¯¹è±¡_ã€‚

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Composite æ¨¡å¼ä¸‹é€‚ç”¨äºï¼š

- æƒ³è¡¨ç¤ºå¯¹è±¡çš„ â€œéƒ¨åˆ†-æ•´ä½“â€ å±‚æ¬¡ç»“æ„ã€‚
- å¸Œæœ›ç”¨æˆ·å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç”¨æˆ·å°†ç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚

```java {28-29,33-35,46-48,72}
import java.util.*;

public class CompositePattern {
    public static void main(String[] args) {
        // çˆ¶ç±»å å¯¹è±¡å = new å­ç±»å();
        AbstractFile root = new Folder("root");

        AbstractFile folderA = new Folder("folderA");
        AbstractFile folderB = new Folder("folderB");

        AbstractFile fileC = new File("fileC");
        AbstractFile fileD = new File("fileD");
        AbstractFile fileE = new File("fileE");

        root.Add(folderA);
        root.Add(folderB);
        root.Add(fileC);

        folderA.Add(fileD);
        folderA.Add(fileE);

        print(root);
    }

    static void print(AbstractFile file){
        file.printName();

        List<AbstractFile> childrenList = file.getChildren();
        if (childrenList == null){
            return;
        }

        for (AbstractFile children : childrenList) {
            print(children);
        }
    }
}

abstract class AbstractFile{
    protected String name;

    public void printName(){
        System.out.println(name);
    }

    public abstract boolean Add(AbstractFile file);
    public abstract boolean Remove(AbstractFile file);
    public abstract List<AbstractFile> getChildren();

}

class Folder extends AbstractFile {

    private List<AbstractFile> childrenList = new ArrayList<>();

    public Folder(String name) {
        this.name = name;
    }

    @Override
    public boolean Add(AbstractFile file) {
        return childrenList.add(file);
    }

    @Override
    public boolean Remove(AbstractFile file) {
        return childrenList.remove(file);
    }

    @Override
    public List<AbstractFile> getChildren() {
        return childrenList;
    }
}

class File extends AbstractFile{
    public File(String name) {
        this.name = name;
    }

    @Override
    public boolean Add(AbstractFile filei) {
        return false;
    }

    @Override
    public boolean Remove(AbstractFile file) {
        return false;
    }

    @Override
    public List<AbstractFile> getChildren() {
        return null;
    }
}
```

@tab è£…é¥°å™¨

## 4. Decorator

::: tip ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½
:::

### ï¼ˆ1ï¼‰æ„å›¾

åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›*é¢å¤–çš„èŒè´£*ã€‚å°±å¢åŠ åŠŸèƒ½è€Œè¨€ï¼ŒDecorator æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´åŠ çµæ´»ã€‚

### ï¼ˆ2ï¼‰ç±»å›¾

![è£…é¥°](./assets/image-20240430145021730.png =

å…¶ä¸­ï¼š

- Component å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥å£ï¼Œå¯ä»¥ç»™è¿™äº›å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ èŒè´£ã€‚
- ConcreteComponent å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›èŒè´£ã€‚
- Decorator ç»´æŒä¸€ä¸ªæŒ‡å‘ Component å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶å®šä¹‰ä¸€ä¸ªä¸ Component æ¥å£ä¸€è‡´çš„æ¥å£ã€‚
- ConcreteDecorator å‘ç»„ä»¶æ·»åŠ èŒè´£ã€‚

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Decorator æ¨¡å¼é€‚ç”¨äºï¼š

- åœ¨ä¸å½±å“å…¶ä»–å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä»¥åŠ¨æ€ã€é€æ˜çš„æ–¹å¼ç»™å•ä¸ªå¯¹è±¡æ·»åŠ èŒè´£ã€‚
- å¤„ç†é‚£äº›å¯ä»¥æ’¤é”€çš„èŒè´£ã€‚
- å½“ä¸èƒ½é‡‡ç”¨ç”Ÿæˆå­ç±»çš„æ–¹å¼è¿›è¡Œæ‰©å……æ—¶ã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¯èƒ½æœ‰å¤§é‡ç‹¬ç«‹çš„æ‰©å±•ï¼Œä¸ºæ”¯æŒæ¯ä¸€ç§ç»„åˆå°†äº§ç”Ÿå¤§é‡çš„å­ç±»ï¼Œä½¿å¾—å­ç±»æ•°ç›®å‘ˆçˆ†ç‚¸æ€§å¢é•¿ã€‚å¦ä¸€ç§æƒ…å†µå¯èƒ½æ˜¯ï¼Œç”±äºç±»å®šä¹‰è¢«éšè—ï¼Œæˆ–ç±»å®šä¹‰ä¸èƒ½ç”¨äºç”Ÿæˆå­ç±»ã€‚ï¼ˆäº†è§£ï¼‰

```java {4-5,11,17,21,33}
public class DecoratorPattern {
    public static void main(String[] args) {
        Person zhangsan = new Student("å¼ ä¸‰");
        zhangsan = new DecoratorA(zhangsan);
        zhangsan = new DecoratorB(zhangsan);
        zhangsan.Operation();

        System.out.println("==========åˆ†å‰²çº¿==============");

        // å¯¹åƒé“¾
        Person lisi = new DecoratorB(new DecoratorA(new Student("æå››")));
        lisi.Operation();

    }
}

abstract class Decorator extends Person{
    protected Person person;
}

class DecoratorA extends Decorator{
    public DecoratorA(Person person){
        this.person = person;
    }

    @Override
    public void Operation() { // èŒè´£
        person.Operation(); // åŸæœ¬çš„èŒè´£
        System.out.println("å†™ä½œä¸š~");
    }
}

class DecoratorB extends Decorator{
    public DecoratorB(Person person){
        this.person = person;
    }

    @Override
    public void Operation() { // èŒè´£
        person.Operation(); // åŸæœ¬çš„èŒè´£
        System.out.println("è€ƒè¯•~");
    }
}

abstract class Person{
    protected String name;

    public abstract void Operation(); // èŒè´£

}

class Student extends Person{
    public Student(String name){
        this.name = name;
    }

    @Override
    public void Operation() {
        System.out.println(name + "çš„èŒè´£ï¼šå­¦ä¹ ~");
    }
}
```

@tab å¤–è§‚

## 5. Facade

::: tip æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£
:::

### ï¼ˆ1ï¼‰æ„å›¾

ä¸º**å­ç³»ç»Ÿ**ä¸­çš„**ä¸€ç»„æ¥å£**æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼ŒFacade æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚

### ï¼ˆ2ï¼‰ç±»å›¾

![](./assets/image-20230415135923577.png)

å…¶ä¸­ï¼š

- Facade çŸ¥é“å“ªäº›å­ç³»ç»Ÿç±»è´Ÿè´£å¤„ç†è¯·æ±‚ï¼›å°†å®¢æˆ·çš„è¯·æ±‚ä»£ç†ç»™é€‚å½“çš„å­ç³»ç»Ÿå¯¹è±¡ã€‚
- Subsystem classes å®ç°å­ç³»ç»Ÿçš„åŠŸèƒ½ï¼›å¤„ç†æœ‰ Facade å¯¹è±¡æŒ‡æ´¾çš„ä»»åŠ¡ï¼›æ²¡æœ‰ Facade çš„ä»»ä½•ç›¸å…³ä¿¡æ¯ï¼Œå³æ²¡æœ‰æŒ‡å‘ Facade çš„æŒ‡é’ˆã€‚

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Facade æ¨¡å¼é€‚ç”¨äº

- _è¦ä¸ºä¸€ä¸ªå¤æ‚å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•æ¥å£æ—¶_ã€‚
- å®¢æˆ·ç¨‹åºä¸æŠ½è±¡ç±»çš„å®ç°éƒ¨åˆ†ä¹‹é—´å­˜åœ¨ç€å¾ˆå¤§çš„ä¾èµ–æ€§ã€‚
- å½“éœ€è¦æ„å»ºä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„å­ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨ Facade æ¨¡å¼å®šä¹‰å­ç³»ç»Ÿä¸­æ¯å±‚çš„å…¥å£ç‚¹ã€‚

```java {19-21}
import java.util.Scanner;

public class FacadePattern {
    public static void main(String[] args) {
        Facade facade = new Facade();

        facade.methodA();
        facade.methodB();
        facade.methodC();
    }
}

class Facade{
    SubSystemOne subSystemOne;
    SubSystemTwo subSystemTwo;
    SubSystemThree subSystemThree;

    public Facade(){
        subSystemOne = new SubSystemOne();
        subSystemTwo = new SubSystemTwo();
        subSystemThree = new SubSystemThree();
    }

    public void methodA(){
        subSystemOne.methodOne();
    }

    public void methodB(){
        subSystemTwo.methodTwo();
    }

    public void methodC(){
        subSystemThree.methodThree();
    }
}

class SubSystemOne{
    public void methodOne(){
        System.out.println("æ‰§è¡Œå­ç³»ç»Ÿä¸€çš„åŠŸèƒ½~");
    }
}

class SubSystemTwo{
    public void methodTwo(){
        System.out.println("æ‰§è¡Œå­ç³»ç»ŸäºŒçš„åŠŸèƒ½~");
    }
}

class SubSystemThree{
    public void methodThree(){
        System.out.println("æ‰§è¡Œå­ç³»ç»Ÿä¸‰çš„åŠŸèƒ½~");
    }
}
```

@tab äº«å…ƒ

## 6. Flyweight

::: tip å…±äº«åˆ›å»ºçš„å¯¹è±¡
:::

### ï¼ˆ1ï¼‰æ„å›¾

è¿ç”¨**å…±äº«æŠ€æœ¯**æœ‰æ•ˆåœ°æ”¯æŒ**å¤§é‡**ç»†ç²’åº¦çš„å¯¹è±¡ã€‚

> å‡å°‘åˆ›å»ºçš„å¯¹è±¡çš„æ•°é‡ï¼Œé™ä½å­˜å‚¨å¼€é”€

### ï¼ˆ2ï¼‰ç±»å›¾

![](./assets/image-20240430145130815.png)

å…¶ä¸­ï¼š

- Flyweight æè¿°ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ Flyweight å¯ä»¥æ¥å—å¹¶ä½œç”¨äºå¤–éƒ¨çŠ¶æ€ã€‚
- ConcreteFlyweight å®ç° Flyweight æ¥å£ï¼Œå¹¶ä¸ºå†…éƒ¨çŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰å¢åŠ å­˜å‚¨ç©ºé—´ã€‚
- ConcreteFlyweight å¯¹è±¡å¿…é¡»æ˜¯å¯å…±äº«çš„ã€‚å®ƒæ‰€å­˜å‚¨çš„çŠ¶æ€å¿…é¡»æ˜¯å†…éƒ¨çš„ï¼Œå³å®ƒå¿…é¡»ç‹¬ç«‹äº ConcreteFlyweight å¯¹è±¡çš„åœºæ™¯ã€‚
- å¹¶éæ‰€æœ‰çš„ Flyweight å­ç±»éƒ½éœ€è¦è¢«å…±äº«ã€‚Flyweight æ¥å£ä½¿å…±äº«æˆä¸ºå¯èƒ½ï¼Œä½†å®ƒå¹¶ä¸å¼ºåˆ¶å…±äº«ã€‚åœ¨ Flyweight å¯¹è±¡ç»“æ„çš„æŸäº›å±‚æ¬¡ï¼ŒUnsharedConcreteFlyweight å¯¹è±¡é€šå¸¸å°† ConcreteFlyweight å¯¹è±¡ä½œä¸ºå­ç»“ç‚¹ã€‚
- FlyweightFactory åˆ›å»ºå¹¶ç®¡ç† Flyweight å¯¹è±¡ï¼›ç¡®ä¿åˆç†åœ°å…±äº« Flyweightï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ª Flyweight æ—¶ï¼ŒFlyweightFactory å¯¹è±¡æä¾›ä¸€ä¸ªå·²åˆ›å»ºçš„å®ä¾‹æˆ–è€…åœ¨ä¸å­˜åœ¨æ—¶åˆ›å»ºä¸ªå®ä¾‹ã€‚
- Client ç»´æŒä¸€ä¸ªå¯¹ Flyweight çš„å¼•ç”¨ï¼›è®¡ç®—æˆ–å­˜å‚¨ä¸€ä¸ªæˆ–å¤šä¸ª Flyweight çš„å¤–éƒ¨çŠ¶æ€ã€‚

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Flyweight æ¨¡å¼é€‚ç”¨äºï¼š

- ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¯¹è±¡ã€‚
- å®Œå…¨ç”±äºä½¿ç”¨å¤§é‡çš„å¯¹è±¡ï¼Œé€ æˆå¾ˆå¤§çš„å­˜å‚¨å¼€é”€ã€‚
- å¯¹è±¡çš„å¤§å¤šæ•°çŠ¶æ€éƒ½å¯å˜ä¸ºå¤–éƒ¨çŠ¶æ€ã€‚
- å¦‚æœåˆ é™¤å¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡å–ä»£å¾ˆå¤šç»„å¯¹è±¡ã€‚
- åº”ç”¨ç¨‹åºä¸ä¾èµ–äºå¯¹è±¡æ ‡è¯†ã€‚ç”±äº Flyweight å¯¹è±¡å¯ä»¥è¢«å…±äº«ï¼Œæ‰€ä»¥å¯¹äºæ¦‚å¿µä¸Šæ˜æ˜¾æœ‰åˆ«çš„å¯¹è±¡ï¼Œæ ‡è¯†æµ‹è¯•å°†è¿”å›çœŸå€¼ã€‚

#### ğŸ 1 é»‘ç™½æ£‹

```java {24,27-28}
public class FlyweightPattern {
    public static void main(String[] args) {
        PieceFactory factory = new PieceFactory();

        Piece whitePiece1 = factory.getPiece(0);
        whitePiece1.draw(66,87);
        System.out.println(whitePiece1);

        Piece blackPiece1 = factory.getPiece(1);
        blackPiece1.draw(20,11);
        System.out.println(blackPiece1);

        Piece whitePiece2 = factory.getPiece(0);
        whitePiece1.draw(26ï¼Œ54);
        System.out.println(whitePiece2);

        Piece blackPiece2 = factory.getPiece(1);
        blackPiece2.draw(12ï¼Œ34);
        System.out.println(blackPiece2);
    }
}

class PieceFactory{
    private Piece[] pieces = {new WhitePiece(),new BlackPiece()};

    public Piece getPiece(int key){
        if (key == 0) return pieces[0];
        else return pieces[1];
    }
}

abstract class Piece{
    protected String color;

    public abstract void draw(int x,int y);
}

class WhitePiece extends Piece{
    public WhitePiece(){
        this.color = "white";
    }

    @Override
    public void draw(int xï¼Œint y) {
        System.out.println("draw a color: " + color + " piece x: " + x + " y:ã€€" + y);
    }
}

class BlackPiece extends Piece{
    public BlackPiece(){
        this.color = "black";
    }

    @Override
    public void draw(int xï¼Œint y) {
        System.out.println("draw a color: " + color + " piece x: " + x + " y:ã€€" + y);
    }
}
```

è¿è¡Œ 1

```text
draw a color: white piece x: 66 y:ã€€87
com.lxzz.softdesign.WhitePiece@4c873330
draw a color: black piece x: 20 y:ã€€11
com.lxzz.softdesign.BlackPiece@119d7047
draw a color: white piece x: 26 y:ã€€54
com.lxzz.softdesign.WhitePiece@4c873330
draw a color: black piece x: 12 y:ã€€34
com.lxzz.softdesign.BlackPiece@119d7047
```

#### ğŸ 2 ç”»åœ†

```java {}
public class FlyweightPattern {
    public static void main(String[] args) {
        ShapeFactory factory = new ShapeFactory();

        Random random = new Random();
        String[] colors = {"red","blue","green","white","black"};

        for (int i = 1; i <= 10; i++) {
            int x = random.nextInt(colors.length);
            Shape shape = factory.getShape(colors[x]);
            System.out.print("ç¬¬" + i + "ä¸ªåœ†ï¼š");
            shape.draw(random.nextInt(100),random.nextInt(100));
        }
    }
}

class ShapeFactory{
    private Map<String,Shape> map = new HashMap<>();

    public Shape getShape(String key){
        if (!map.containsKey(key)) {
            map.put(keyï¼Œnew Circle(key));
            System.out.println("create color: " + key + " circle");
        }
        return map.get(key);
    }
}

abstract class Shape {
    protected String color;

    public abstract void draw(int xï¼Œint y);
}

class Circle extends Shape {

    public Circle(String color){
        this.color = color;
    }

    @Override
    public void draw(int xï¼Œint y) {
        System.out.println("draw a color: " + color + " circle xï¼š"+ x + " yï¼š" + y);
    }
}
```

è¿è¡Œ 2

```text
create color: white circle
ç¬¬1ä¸ªåœ†ï¼šdraw a color: white circle xï¼š98 yï¼š99
create color: blue circle
ç¬¬2ä¸ªåœ†ï¼šdraw a color: blue circle xï¼š59 yï¼š14
create color: red circle
ç¬¬3ä¸ªåœ†ï¼šdraw a color: red circle xï¼š21 yï¼š31
create color: black circle
ç¬¬4ä¸ªåœ†ï¼šdraw a color: black circle xï¼š0 yï¼š13
create color: green circle
ç¬¬5ä¸ªåœ†ï¼šdraw a color: green circle xï¼š41 yï¼š66
ç¬¬6ä¸ªåœ†ï¼šdraw a color: black circle xï¼š54 yï¼š11
ç¬¬7ä¸ªåœ†ï¼šdraw a color: white circle xï¼š99 yï¼š68
ç¬¬8ä¸ªåœ†ï¼šdraw a color: white circle xï¼š18 yï¼š52
ç¬¬9ä¸ªåœ†ï¼šdraw a color: red circle xï¼š28 yï¼š60
ç¬¬10ä¸ªåœ†ï¼šdraw a color: white circle xï¼š83 yï¼š66
```

@tab ä»£ç†

## 7. Proxy

::: tip ä»£ç†æ§åˆ¶
:::

### ï¼ˆ1ï¼‰æ„å›¾

ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§**ä»£ç†**ä»¥**æ§åˆ¶**å¯¹è¿™ä¸ªå¯¹è±¡çš„**è®¿é—®**ã€‚

### ï¼ˆ2ï¼‰ç±»å›¾

![](./assets/image-20240430145205532.png)

### ï¼ˆ3ï¼‰é€‚ç”¨æ€§

Proxy æ¨¡å¼é€‚ç”¨äºåœ¨éœ€è¦æ¯”è¾ƒé€šç”¨å’Œå¤æ‚çš„å¯¹è±¡æŒ‡é’ˆä»£æ›¿ç®€å•çš„æŒ‡é’ˆçš„æ—¶å€™ï¼Œå¸¸è§æƒ…å†µæœ‰ï¼š

- è¿œç¨‹ä»£ç† (Remote Proxy) ä¸ºä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒåœ°å€ç©ºé—´æä¾›å±€éƒ¨ä»£è¡¨ã€‚
- è™šä»£ç† (Virtual Proxy) æ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ã€‚
- ä¿æŠ¤ä»£ç† (Protection Proxy) æ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®ï¼Œç”¨äºå¯¹è±¡åº”è¯¥æœ‰ä¸åŒçš„è®¿é—®æƒé™çš„æ—¶å€™ã€‚
- æ™ºèƒ½å¼•ç”¨ (Smart Reference) å–ä»£äº†ç®€å•çš„æŒ‡é’ˆï¼Œå®ƒåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œã€‚

```java {14,18-20,30}
public class ProxyPattern {
    public static void main(String[] args) {
        RealSubject realSubject = new RealSubject();
        Proxy proxy = new Proxy(realSubject);

        proxy.buy();
    }
}

interface Subject{
    void buy();
}

class Proxy implements Subject{

    protected RealSubject realSubject;

    public Proxy(RealSubject realSubject){
        this.realSubject = realSubject;
    }

    @Override
    public void buy() {
        System.out.println("åŠç†è´­ä¹°å‰çš„æ‰‹ç»­~");
        realSubject.buy(); // ä»˜é’±
        System.out.println("åŠç†è´­ä¹°åçš„æ‰‹ç»­~");
    }
}

class RealSubject implements Subject{

    @Override
    public void buy() {
        System.out.println("ä»˜é’±~");
    }
}
```

::::
