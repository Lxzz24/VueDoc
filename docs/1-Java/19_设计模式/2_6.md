---
title: äº«å…ƒ
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚

äº«å…ƒï¼ˆ Flyweight ï¼‰çš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å®ä¾‹ä¸€ç»åˆ›å»ºå°±ä¸å¯å˜ï¼Œé‚£ä¹ˆåå¤åˆ›å»ºç›¸åŒçš„å®ä¾‹å°±æ²¡æœ‰å¿…è¦ï¼Œç›´æ¥å‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªå…±äº«çš„å®ä¾‹å°±è¡Œï¼Œè¿™æ ·å³èŠ‚çœå†…å­˜ï¼Œåˆå¯ä»¥å‡å°‘åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œæé«˜è¿è¡Œé€Ÿåº¦ã€‚

äº«å…ƒæ¨¡å¼åœ¨ Java æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šåº”ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒåŒ…è£…ç±»å‹å¦‚ `Byte`ã€`Integer` éƒ½æ˜¯ä¸å˜ç±»ï¼Œå› æ­¤ï¼Œåå¤åˆ›å»ºåŒä¸€ä¸ªå€¼ç›¸åŒçš„åŒ…è£…ç±»å‹æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ä»¥ `Integer` ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ `Integer.valueOf()` è¿™ä¸ªé™æ€å·¥å‚æ–¹æ³•åˆ›å»º `Integer` å®ä¾‹ï¼Œå½“ä¼ å…¥çš„ `int` èŒƒå›´åœ¨ `-128`~`+127` ä¹‹é—´æ—¶ï¼Œä¼šç›´æ¥è¿”å›ç¼“å­˜çš„ `Integer` å®ä¾‹ï¼š

```java
// äº«å…ƒæ¨¡å¼
public class Main {
    public static void main(String[] args) throws InterruptedException {
        Integer n1 = Integer.valueOf(100);
        Integer n2 = Integer.valueOf(100);
        System.out.println(n1 == n2); // true
    }
}
```


å¯¹äº `Byte` æ¥è¯´ï¼Œå› ä¸ºå®ƒä¸€å…±åªæœ‰ 256 ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡ `Byte.valueOf()` åˆ›å»ºçš„ `Byte` å®ä¾‹ï¼Œå…¨éƒ¨éƒ½æ˜¯ç¼“å­˜å¯¹è±¡ã€‚

å› æ­¤ï¼Œäº«å…ƒæ¨¡å¼å°±æ˜¯é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œåœ¨å·¥å‚æ–¹æ³•å†…éƒ¨ï¼Œå¾ˆå¯èƒ½è¿”å›ç¼“å­˜çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯æ–°åˆ›å»ºå®ä¾‹ï¼Œä»è€Œå®ç°ä¸å¯å˜å®ä¾‹çš„å¤ç”¨ã€‚

> [!tip]
> æ€»æ˜¯ä½¿ç”¨å·¥å‚æ–¹æ³•è€Œä¸æ˜¯ new æ“ä½œç¬¦åˆ›å»ºå®ä¾‹ï¼Œå¯è·å¾—äº«å…ƒæ¨¡å¼çš„å¥½å¤„ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œäº«å…ƒæ¨¡å¼ä¸»è¦åº”ç”¨äºç¼“å­˜ï¼Œå³å®¢æˆ·ç«¯å¦‚æœé‡å¤è¯·æ±‚æŸäº›å¯¹è±¡ï¼Œä¸å¿…æ¯æ¬¡æŸ¥è¯¢æ•°æ®åº“æˆ–è€…è¯»å–æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›å†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®ã€‚

æˆ‘ä»¬ä»¥ `Student` ä¸ºä¾‹ï¼Œè®¾è®¡ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œå®ƒåœ¨å†…éƒ¨å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼š

```java
public class Student {
    // æŒæœ‰ç¼“å­˜:
    private static final Map<String, Student> cache = new HashMap<>();

    // é™æ€å·¥å‚æ–¹æ³•:
    public static Student create(int id, String name) {
        String key = id + "\n" + name;
        // å…ˆæŸ¥æ‰¾ç¼“å­˜:
        Student std = cache.get(key);
        if (std == null) {
            // æœªæ‰¾åˆ°, åˆ›å»ºæ–°å¯¹è±¡:
            System.out.println(String.format("create new Student(%s, %s)", id, name));
            std = new Student(id, name);
            // æ”¾å…¥ç¼“å­˜:
            cache.put(key, std);
        } else {
            // ç¼“å­˜ä¸­å­˜åœ¨:
            System.out.println(String.format("return cached Student(%s, %s)", std.id, std.name));
        }
        return std;
    }

    private final int id;
    private final String name;

    public Student(int id, String name) {
        this.id = id;
        this.name = name;
    }
}
```

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨æˆç†Ÿçš„ç¼“å­˜åº“ï¼Œä¾‹å¦‚ [Guava](https://github.com/google/guava)  çš„ [Cache](https://github.com/google/guava/blob/master/guava/src/com/google/common/cache/Cache.java) ï¼Œå› ä¸ºå®ƒæä¾›äº†æœ€å¤§ç¼“å­˜æ•°é‡é™åˆ¶ã€å®šæ—¶è¿‡æœŸç­‰å®ç”¨åŠŸèƒ½ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨äº«å…ƒæ¨¡å¼å®ç°ç¼“å­˜

## ğŸ€ å°ç»“

äº«å…ƒæ¨¡å¼çš„è®¾è®¡æ€æƒ³æ˜¯å°½é‡å¤ç”¨å·²åˆ›å»ºçš„å¯¹è±¡ï¼Œå¸¸ç”¨äºå·¥å‚æ–¹æ³•å†…éƒ¨çš„ä¼˜åŒ–ã€‚



