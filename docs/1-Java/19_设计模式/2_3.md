---
title: ç»„åˆ
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º `éƒ¨åˆ† - æ•´ä½“` çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰ç»å¸¸ç”¨äºæ ‘å½¢ç»“æ„ï¼Œä¸ºäº†ç®€åŒ–ä»£ç ï¼Œä½¿ç”¨ `Composite` å¯ä»¥æŠŠä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ç»Ÿä¸€èµ·æ¥å¤„ç†ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚åœ¨ XML æˆ– HTML ä¸­ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½åŒ…å«ä»»æ„ä¸ªå…¶ä»–èŠ‚ç‚¹ï¼Œè¿™äº›å±‚å±‚åµŒå¥—çš„èŠ‚ç‚¹å°±æ„æˆäº†ä¸€é¢—æ ‘ã€‚

è¦ä»¥æ ‘çš„ç»“æ„è¡¨ç¤º XML ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠ½è±¡å‡ºèŠ‚ç‚¹ç±»å‹ `Node`ï¼š

```java
public interface Node {
    // æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ä¸ºå­èŠ‚ç‚¹:
    Node add(Node node);
    // è·å–å­èŠ‚ç‚¹:
    List<Node> children();
    // è¾“å‡ºä¸º XML:
    String toXml();
}
```

å¯¹äºä¸€ä¸ª `<abc>` è¿™æ ·çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º `ElementNode` ï¼Œå®ƒå¯ä»¥ä½œä¸ºå®¹å™¨åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹ï¼š

```java
public class ElementNode implements Node {
    private String name;
    private List<Node> list = new ArrayList<>();

    public ElementNode(String name) {
        this.name = name;
    }

    public Node add(Node node) {
        list.add(node);
        return this;
    }

    public List<Node> children() {
        return list;
    }

    public String toXml() {
        String start = "<" + name + ">\n";
        String end = "</" + name + ">\n";
        StringJoiner sj = new StringJoiner("", start, end);
        list.forEach(node -> {
            sj.add(node.toXml() + "\n");
        });
        return sj.toString();
    }
}
```

å¯¹äºæ™®é€šæ–‡æœ¬ï¼Œæˆ‘ä»¬æŠŠå®ƒçœ‹ä½œ `TextNode`ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ï¼š

```java
public class TextNode implements Node {
	private String text;

	public TextNode(String text) {
		this.text = text;
	}

	public Node add(Node node) {
		throw new UnsupportedOperationException();
	}

	public List<Node> children() {
		return List.of();
	}

	public String toXml() {
		return text;
	}
}
```

æ­¤å¤–ï¼Œè¿˜å¯ä»¥æœ‰æ³¨é‡ŠèŠ‚ç‚¹ï¼š

```java
public class CommentNode implements Node {
	private String text;

	public CommentNode(String text) {
		this.text = text;
	}

	public Node add(Node node) {
		throw new UnsupportedOperationException();
	}

	public List<Node> children() {
		return List.of();
	}

	public String toXml() {
		return "<!--" + text + "-->";
	}
}
```

é€šè¿‡ `ElementNode`ã€`TextNode` å’Œ `CommentNode`ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºä¸€é¢—æ ‘ï¼š

```java
Node root = new ElementNode("school");
root.add(new ElementNode("classA")
        .add(new TextNode("Tom"))
        .add(new TextNode("Alice")));
root.add(new ElementNode("classB")
        .add(new TextNode("Bob"))
        .add(new TextNode("Grace"))
        .add(new CommentNode("comment...")));
System.out.println(root.toXml());
```

æœ€åé€šè¿‡ `root` èŠ‚ç‚¹è¾“å‡ºçš„ XML å¦‚ä¸‹ï¼š

```xml
<school>
<classA>
Tom
Alice
</classA>
<classB>
Bob
Grace
<!-- comment... -->
</classB>
</school>
```

å¯è§ï¼Œä½¿ç”¨ Composite æ¨¡å¼æ—¶ï¼Œéœ€è¦å…ˆç»Ÿä¸€å•ä¸ªèŠ‚ç‚¹ä»¥åŠ â€œå®¹å™¨â€ èŠ‚ç‚¹çš„æ¥å£ï¼š

![image-20231220100123711](./assets/image-20231220100123711.png)

ä½œä¸ºå®¹å™¨èŠ‚ç‚¹çš„ `ElementNode` åˆå¯ä»¥æ·»åŠ ä»»æ„ä¸ª `Node`ï¼Œè¿™æ ·å°±å¯ä»¥æ„æˆå±‚çº§ç»“æ„ã€‚

ç±»ä¼¼çš„ï¼Œåƒæ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€GUI çª—å£çš„å„ç§ç»„ä»¶ï¼Œéƒ½ç¬¦åˆ Composite æ¨¡å¼çš„å®šä¹‰ï¼Œå› ä¸ºå®ƒä»¬çš„ç»“æ„å¤©ç”Ÿå°±æ˜¯å±‚çº§ç»“æ„ã€‚

## ğŸ€ ç»ƒä¹ 


## ğŸ€ å°ç»“

Composite æ¨¡å¼ä½¿å¾—å¶å­å¯¹è±¡å’Œå®¹å™¨å¯¹è±¡å…·æœ‰ä¸€è‡´æ€§ï¼Œä»è€Œå½¢æˆç»Ÿä¸€çš„æ ‘å½¢ç»“æ„ï¼Œå¹¶ç”¨ä¸€è‡´çš„æ–¹å¼å»å¤„ç†å®ƒä»¬ã€‚



