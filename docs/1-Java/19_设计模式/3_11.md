---
title: è®¿é—®è€…
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚å®ƒä½¿ä½ å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚

è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰æ˜¯ä¸€ç§æ“ä½œä¸€ç»„å¯¹è±¡çš„æ“ä½œï¼Œå®ƒçš„ç›®çš„æ˜¯ä¸æ”¹å˜å¯¹è±¡çš„å®šä¹‰ï¼Œä½†å…è®¸æ–°å¢ä¸åŒçš„è®¿é—®è€…ï¼Œæ¥å®šä¹‰æ–°çš„æ“ä½œã€‚

è®¿é—®è€…æ¨¡å¼çš„è®¾è®¡æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹ GoF åŸå§‹çš„è®¿é—®è€…æ¨¡å¼ï¼Œå®ƒæ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼š

![image-20231220114511694](./assets/image-20231220114511694.png)

ä¸Šè¿°æ¨¡å¼çš„å¤æ‚ä¹‹å¤„åœ¨äºä¸Šè¿°è®¿é—®è€…æ¨¡å¼ä¸ºäº†å®ç°æ‰€è°“çš„ â€œåŒé‡åˆ†æ´¾â€ï¼Œè®¾è®¡äº†ä¸€ä¸ªå›è°ƒå†å›è°ƒçš„æœºåˆ¶ã€‚å› ä¸º Java åªæ”¯æŒåŸºäºå¤šæ€çš„å•åˆ†æ´¾æ¨¡å¼ï¼Œè¿™é‡Œå¼ºè¡Œæ¨¡æ‹Ÿå‡ºâ€œåŒé‡åˆ†æ´¾â€ åè€ŒåŠ å¤§äº†ä»£ç çš„å¤æ‚æ€§ã€‚

è¿™é‡Œæˆ‘ä»¬åªä»‹ç»ç®€åŒ–çš„è®¿é—®è€…æ¨¡å¼ã€‚å‡è®¾æˆ‘ä»¬è¦é€’å½’éå†æŸä¸ªæ–‡ä»¶å¤¹çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œç„¶åæ‰¾å‡º `.java` æ–‡ä»¶ï¼Œæ­£å¸¸çš„åšæ³•æ˜¯å†™ä¸ªé€’å½’ï¼š

```java
void scan(File dir, List<File> collector) {
    for (File file : dir.listFiles()) {
        if (file.isFile() && file.getName().endsWith(".java")) {
            collector.add(file);
        } else if (file.isDir()) {
            // é€’å½’è°ƒç”¨:
            scan(file, collector);
        }
    }
}
```

ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼Œæ‰«æç›®å½•çš„é€»è¾‘å’Œå¤„ç†. java æ–‡ä»¶çš„é€»è¾‘æ··åœ¨äº†ä¸€èµ·ã€‚å¦‚æœä¸‹æ¬¡éœ€è¦å¢åŠ ä¸€ä¸ªæ¸…ç† `.class` æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå°±å¿…é¡»å†é‡å¤å†™æ‰«æé€»è¾‘ã€‚

å› æ­¤ï¼Œè®¿é—®è€…æ¨¡å¼å…ˆæŠŠæ•°æ®ç»“æ„ï¼ˆè¿™é‡Œæ˜¯æ–‡ä»¶å¤¹å’Œæ–‡ä»¶æ„æˆçš„æ ‘å‹ç»“æ„ï¼‰å’Œå¯¹å…¶çš„æ“ä½œï¼ˆæŸ¥æ‰¾æ–‡ä»¶ï¼‰åˆ†ç¦»å¼€ï¼Œä»¥åå¦‚æœè¦æ–°å¢æ“ä½œï¼ˆä¾‹å¦‚æ¸…ç† `.class` æ–‡ä»¶ï¼‰ï¼Œåªéœ€è¦æ–°å¢è®¿é—®è€…ï¼Œä¸éœ€è¦æ”¹å˜ç°æœ‰é€»è¾‘ã€‚

ç”¨è®¿é—®è€…æ¨¡å¼æ”¹å†™ä¸Šè¿°ä»£ç æ­¥éª¤å¦‚ä¸‹ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è®¿é—®è€…æ¥å£ï¼Œå³è¯¥è®¿é—®è€…èƒ½å¤Ÿå¹²çš„äº‹æƒ…ï¼š

```java
public interface Visitor {
    // è®¿é—®æ–‡ä»¶å¤¹:
    void visitDir(File dir);
    // è®¿é—®æ–‡ä»¶:
    void visitFile(File file);
}
```

ç´§æ¥ç€ï¼Œæˆ‘ä»¬è¦å®šä¹‰èƒ½æŒæœ‰æ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„æ•°æ®ç»“æ„ `FileStructure`ï¼š

```java
public class FileStructure {
    // æ ¹ç›®å½•:
    private File path;
    public FileStructure(File path) {
        this.path = path;
    }
}
```

ç„¶åï¼Œæˆ‘ä»¬ç»™ `FileStructure` å¢åŠ ä¸€ä¸ª `handle()` æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªè®¿é—®è€…ï¼š

```java
public class FileStructure {
    ...

    public void handle(Visitor visitor) {
		scan(this.path, visitor);
	}

	private void scan(File file, Visitor visitor) {
		if (file.isDirectory()) {
            // è®©è®¿é—®è€…å¤„ç†æ–‡ä»¶å¤¹:
			visitor.visitDir(file);
			for (File sub : file.listFiles()) {
                // é€’å½’å¤„ç†å­æ–‡ä»¶å¤¹:
				scan(sub, visitor);
			}
		} else if (file.isFile()) {
            // è®©è®¿é—®è€…å¤„ç†æ–‡ä»¶:
			visitor.visitFile(file);
		}
	}
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠè®¿é—®è€…çš„è¡Œä¸ºæŠ½è±¡å‡ºæ¥äº†ã€‚å¦‚æœæˆ‘ä»¬è¦å®ç°ä¸€ç§æ“ä½œï¼Œä¾‹å¦‚ï¼ŒæŸ¥æ‰¾ `.java` æ–‡ä»¶ï¼Œå°±ä¼ å…¥ `JavaFileVisitor`ï¼š

```java
FileStructure fs = new FileStructure(new File("."));
fs.handle(new JavaFileVisitor());
```

è¿™ä¸ª `JavaFileVisitor` å®ç°å¦‚ä¸‹ï¼š

```java
public class JavaFileVisitor implements Visitor {
    public void visitDir(File dir) {
        System.out.println("Visit dir:" + dir);
    }

    public void visitFile(File file) {
        if (file.getName().endsWith(".java")) {
            System.out.println("Found java file:" + file);
        }
    }
}
```

ç±»ä¼¼çš„ï¼Œå¦‚æœè¦æ¸…ç† `.class` æ–‡ä»¶ï¼Œå¯ä»¥å†å†™ä¸€ä¸ª `ClassFileClearnerVisitor`ï¼š

```java
public class ClassFileCleanerVisitor implements Visitor {
	public void visitDir(File dir) {
	}

	public void visitFile(File file) {
		if (file.getName().endsWith(".class")) {
			System.out.println("Will clean class file:" + file);
		}
	}
}
```

å¯è§ï¼Œè®¿é—®è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºäº†è®¿é—®æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¸å»æ”¹å˜æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯æŠŠå¯¹æ•°æ®çš„æ“ä½œæŠ½è±¡å‡ºæ¥ï¼Œåœ¨ â€œè®¿é—®â€ çš„è¿‡ç¨‹ä¸­ä»¥å›è°ƒå½¢å¼åœ¨è®¿é—®è€…ä¸­å¤„ç†æ“ä½œé€»è¾‘ã€‚å¦‚æœè¦æ–°å¢ä¸€ç»„æ“ä½œï¼Œé‚£ä¹ˆåªéœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€…ã€‚

å®é™…ä¸Šï¼ŒJava æ ‡å‡†åº“æä¾›çš„ `Files.walkFileTree()` å·²ç»å®ç°äº†ä¸€ä¸ªè®¿é—®è€…æ¨¡å¼ï¼š

```java
import java.io.*;
import java.nio.file.*;
import java.nio.file.attribute.*;

public class Main {
    public static void main(String[] args) throws IOException {
        Files.walkFileTree(Paths.get("."), new MyFileVisitor());
    }
}

// å®ç°ä¸€ä¸ª FileVisitor:
class MyFileVisitor extends SimpleFileVisitor<Path> {
    // å¤„ç† Directory:
    public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) throws IOException {
        System.out.println("pre visit dir:" + dir);
        // è¿”å› CONTINUE è¡¨ç¤ºç»§ç»­è®¿é—®:
        return FileVisitResult.CONTINUE;
    }

    // å¤„ç† File:
    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
        System.out.println("visit file:" + file);
        // è¿”å› CONTINUE è¡¨ç¤ºç»§ç»­è®¿é—®:
        return FileVisitResult.CONTINUE;
    }
}
```


`Files.walkFileTree()` å…è®¸è®¿é—®è€…è¿”å› `FileVisitResult.CONTINUE` ä»¥ä¾¿ç»§ç»­è®¿é—®ï¼Œæˆ–è€…è¿”å› `FileVisitResult.TERMINATE` åœæ­¢è®¿é—®ã€‚

ç±»ä¼¼çš„ï¼Œå¯¹ XML çš„ SAX å¤„ç†ä¹Ÿæ˜¯ä¸€ä¸ªè®¿é—®è€…æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ª SAX Handler ä½œä¸ºè®¿é—®è€…å¤„ç† XML çš„å„ä¸ªèŠ‚ç‚¹ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨è®¿é—®è€…æ¨¡å¼é€’å½’éå†æ–‡ä»¶å¤¹

## ğŸ€ å°ç»“

è®¿é—®è€…æ¨¡å¼æ˜¯ä¸ºäº†æŠ½è±¡å‡ºä½œç”¨äºä¸€ç»„å¤æ‚å¯¹è±¡çš„æ“ä½œï¼Œå¹¶ä¸”åç»­å¯ä»¥æ–°å¢æ“ä½œè€Œä¸å¿…å¯¹ç°æœ‰çš„å¯¹è±¡ç»“æ„åšä»»ä½•æ”¹åŠ¨ã€‚






