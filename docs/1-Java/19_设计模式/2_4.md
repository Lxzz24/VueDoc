---
title: è£…é¥°å™¨
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚

è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¨¡å¼ï¼Œæ˜¯ä¸€ç§åœ¨è¿è¡ŒæœŸåŠ¨æ€ç»™æŸä¸ªå¯¹è±¡çš„å®ä¾‹å¢åŠ åŠŸèƒ½çš„æ–¹æ³•ã€‚

æˆ‘ä»¬åœ¨ IO çš„ [Filter æ¨¡å¼](/1-Java/8_IO/4.md) ä¸€èŠ‚ä¸­å…¶å®å·²ç»è®²è¿‡è£…é¥°å™¨æ¨¡å¼äº†ã€‚åœ¨ Java æ ‡å‡†åº“ä¸­ï¼Œ`InputStream` æ˜¯æŠ½è±¡ç±»ï¼Œ`FileInputStream`ã€`ServletInputStream`ã€`Socket.getInputStream()` è¿™äº› `InputStream` éƒ½æ˜¯æœ€ç»ˆæ•°æ®æºã€‚

ç°åœ¨ï¼Œå¦‚æœè¦ç»™ä¸åŒçš„æœ€ç»ˆæ•°æ®æºå¢åŠ ç¼“å†²åŠŸèƒ½ã€è®¡ç®—ç­¾ååŠŸèƒ½ã€åŠ å¯†è§£å¯†åŠŸèƒ½ï¼Œé‚£ä¹ˆï¼Œ3 ä¸ªæœ€ç»ˆæ•°æ®æºã€3 ç§åŠŸèƒ½ä¸€å…±éœ€è¦ 9 ä¸ªå­ç±»ã€‚å¦‚æœç»§ç»­å¢åŠ æœ€ç»ˆæ•°æ®æºï¼Œæˆ–è€…å¢åŠ æ–°åŠŸèƒ½ï¼Œå­ç±»ä¼šçˆ†ç‚¸å¼å¢é•¿ï¼Œè¿™ç§è®¾è®¡æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚

Decorator æ¨¡å¼çš„ç›®çš„å°±æ˜¯æŠŠä¸€ä¸ªä¸€ä¸ªçš„é™„åŠ åŠŸèƒ½ï¼Œç”¨ Decorator çš„æ–¹å¼ç»™ä¸€å±‚ä¸€å±‚åœ°ç´¯åŠ åˆ°åŸå§‹æ•°æ®æºä¸Šï¼Œæœ€ç»ˆï¼Œé€šè¿‡ç»„åˆè·å¾—æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ã€‚

ä¾‹å¦‚ï¼šç»™ `FileInputStream` å¢åŠ ç¼“å†²å’Œè§£å‹ç¼©åŠŸèƒ½ï¼Œç”¨ Decorator æ¨¡å¼å†™å‡ºæ¥å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºåŸå§‹çš„æ•°æ®æº:
InputStream fis = new FileInputStream("test.gz");
// å¢åŠ ç¼“å†²åŠŸèƒ½:
InputStream bis = new BufferedInputStream(fis);
// å¢åŠ è§£å‹ç¼©åŠŸèƒ½:
InputStream gis = new GZIPInputStream(bis);
```

æˆ–è€…ä¸€æ¬¡æ€§å†™æˆè¿™æ ·ï¼š

```java
InputStream input = new GZIPInputStream( // ç¬¬äºŒå±‚è£…é¥°
                        new BufferedInputStream( // ç¬¬ä¸€å±‚è£…é¥°
                            new FileInputStream("test.gz") // æ ¸å¿ƒåŠŸèƒ½
                        ));
```

è§‚å¯Ÿ `BufferedInputStream` å’Œ `GZIPInputStream`ï¼Œå®ƒä»¬å®é™…ä¸Šéƒ½æ˜¯ä» `FilterInputStream` ç»§æ‰¿çš„ï¼Œè¿™ä¸ª `FilterInputStream` å°±æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ Decoratorã€‚æˆ‘ä»¬ç”¨å›¾æŠŠ Decorator æ¨¡å¼ç”»å‡ºæ¥å¦‚ä¸‹ï¼š

![image-20231220100158844](./assets/image-20231220100158844.png)

æœ€é¡¶å±‚çš„ Component æ˜¯æ¥å£ï¼Œå¯¹åº”åˆ° IO çš„å°±æ˜¯ `InputStream` è¿™ä¸ªæŠ½è±¡ç±»ã€‚ComponentAã€ComponentB æ˜¯å®é™…çš„å­ç±»ï¼Œå¯¹åº”åˆ° IO çš„å°±æ˜¯ `FileInputStream`ã€`ServletInputStream` è¿™äº›æ•°æ®æºã€‚Decorator æ˜¯ç”¨äºå®ç°å„ä¸ªé™„åŠ åŠŸèƒ½çš„æŠ½è±¡è£…é¥°å™¨ï¼Œå¯¹åº”åˆ° IO çš„å°±æ˜¯ `FilterInputStream`ã€‚è€Œä» Decorator æ´¾ç”Ÿçš„å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è£…é¥°å™¨ï¼Œå®ƒä»¬æ¯ä¸ªéƒ½æœ‰ç‹¬ç«‹çš„åŠŸèƒ½ï¼Œå¯¹åº”åˆ° IO çš„å°±æ˜¯ `BufferedInputStream`ã€`GZIPInputStream` ç­‰ã€‚

Decorator æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå®ƒå®é™…ä¸ŠæŠŠæ ¸å¿ƒåŠŸèƒ½å’Œé™„åŠ åŠŸèƒ½ç»™åˆ†å¼€äº†ã€‚æ ¸å¿ƒåŠŸèƒ½æŒ‡ `FileInputStream` è¿™äº›çœŸæ­£è¯»æ•°æ®çš„æºå¤´ï¼Œé™„åŠ åŠŸèƒ½æŒ‡åŠ ç¼“å†²ã€å‹ç¼©ã€è§£å¯†è¿™äº›åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬è¦æ–°å¢æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±å¢åŠ  Component çš„å­ç±»ï¼Œä¾‹å¦‚ `ByteInputStream`ã€‚å¦‚æœæˆ‘ä»¬è¦å¢åŠ é™„åŠ åŠŸèƒ½ï¼Œå°±å¢åŠ  Decorator çš„å­ç±»ï¼Œä¾‹å¦‚ `CipherInputStream`ã€‚ä¸¤éƒ¨åˆ†éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ‰©å±•ï¼Œè€Œå…·ä½“å¦‚ä½•é™„åŠ åŠŸèƒ½ï¼Œç”±è°ƒç”¨æ–¹è‡ªç”±ç»„åˆï¼Œä»è€Œæå¤§åœ°å¢å¼ºäº†çµæ´»æ€§ã€‚

å¦‚æœæˆ‘ä»¬è¦è‡ªå·±è®¾è®¡å®Œæ•´çš„ Decorator æ¨¡å¼ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ

æˆ‘ä»¬è¿˜æ˜¯ä¸¾ä¸ªæ —å­ï¼šå‡è®¾æˆ‘ä»¬éœ€è¦æ¸²æŸ“ä¸€ä¸ª HTML çš„æ–‡æœ¬ï¼Œä½†æ˜¯æ–‡æœ¬è¿˜å¯ä»¥é™„åŠ ä¸€äº›æ•ˆæœï¼Œæ¯”å¦‚åŠ ç²—ã€å˜æ–œä½“ã€åŠ ä¸‹åˆ’çº¿ç­‰ã€‚ä¸ºäº†å®ç°åŠ¨æ€é™„åŠ æ•ˆæœï¼Œå¯ä»¥é‡‡ç”¨ Decorator æ¨¡å¼ã€‚

é¦–å…ˆï¼Œä»ç„¶éœ€è¦å®šä¹‰é¡¶å±‚æ¥å£ `TextNode`ï¼š

```java
public interface TextNode {
    // è®¾ç½® text:
    void setText(String text);
    // è·å– text:
    String getText();
}
```

å¯¹äºæ ¸å¿ƒèŠ‚ç‚¹ï¼Œä¾‹å¦‚ `<span>`ï¼Œå®ƒéœ€è¦ä» `TextNode` ç›´æ¥ç»§æ‰¿ï¼š

```java
public class SpanNode implements TextNode {
    private String text;

    public void setText(String text) {
        this.text = text;
    }

    public String getText() {
        return "<span>" + text + "</span>";
    }
}
```

ç´§æ¥ç€ï¼Œä¸ºäº†å®ç° Decorator æ¨¡å¼ï¼Œéœ€è¦æœ‰ä¸€ä¸ªæŠ½è±¡çš„ Decorator ç±»ï¼š

```java
public abstract class NodeDecorator implements TextNode {
    protected final TextNode target;

    protected NodeDecorator(TextNode target) {
        this.target = target;
    }

    public void setText(String text) {
        this.target.setText(text);
    }
}
```

è¿™ä¸ª `NodeDecorator` ç±»çš„æ ¸å¿ƒæ˜¯æŒæœ‰ä¸€ä¸ª `TextNode`ï¼Œå³å°†è¦æŠŠåŠŸèƒ½é™„åŠ åˆ°çš„ `TextNode` å®ä¾‹ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å†™ä¸€ä¸ªåŠ ç²—åŠŸèƒ½ï¼š

```java
public class BoldDecorator extends NodeDecorator {
    public BoldDecorator(TextNode target) {
        super(target);
    }

    public String getText() {
        return "<b>" + target.getText() + "</b>";
    }
}
```

ç±»ä¼¼çš„ï¼Œå¯ä»¥ç»§ç»­åŠ  `ItalicDecorator`ã€`UnderlineDecorator` ç­‰ã€‚å®¢æˆ·ç«¯å¯ä»¥è‡ªç”±ç»„åˆè¿™äº› Decoratorï¼š

```java
TextNode n1 = new SpanNode();
TextNode n2 = new BoldDecorator(new UnderlineDecorator(new SpanNode()));
TextNode n3 = new ItalicDecorator(new BoldDecorator(new SpanNode()));
n1.setText("Hello");
n2.setText("Decorated");
n3.setText("World");
System.out.println(n1.getText());
// è¾“å‡º <span>Hello</span>

System.out.println(n2.getText());
// è¾“å‡º <b><u><span>Decorated</span></u></b>

System.out.println(n3.getText());
// è¾“å‡º <i><b><span>World</span></b></i>
```

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Decorator æ·»åŠ ä¸€ä¸ª `<del>` æ ‡ç­¾è¡¨ç¤ºåˆ é™¤ã€‚


## ğŸ€ å°ç»“

ä½¿ç”¨ Decorator æ¨¡å¼ï¼Œå¯ä»¥ç‹¬ç«‹å¢åŠ æ ¸å¿ƒåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹å¢åŠ é™„åŠ åŠŸèƒ½ï¼ŒäºŒè€…äº’ä¸å½±å“ï¼›

å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åœ°ç»™æ ¸å¿ƒåŠŸèƒ½å¢åŠ ä»»æ„ä¸ªé™„åŠ åŠŸèƒ½ã€‚


