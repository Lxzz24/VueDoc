---
title: å¤‡å¿˜å½•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---


> åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚

å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰ï¼Œä¸»è¦ç”¨äºæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™æ¢å¤æ­¤çŠ¶æ€ã€‚

å…¶å®æˆ‘ä»¬ä½¿ç”¨çš„å‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½ç”¨åˆ°äº†å¤‡å¿˜å½•æ¨¡å¼ã€‚æœ€ç®€å•çš„å¤‡å¿˜å½•æ¨¡å¼å°±æ˜¯ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶ã€‚å¯¹äºæ–‡æœ¬ç¼–è¾‘å™¨æ¥è¯´ï¼Œä¿å­˜å°±æ˜¯æŠŠ `TextEditor` ç±»çš„å­—ç¬¦ä¸²å­˜å‚¨åˆ°æ–‡ä»¶ï¼Œæ‰“å¼€å°±æ˜¯æ¢å¤ `TextEditor` ç±»çš„çŠ¶æ€ã€‚å¯¹äºå›¾åƒç¼–è¾‘å™¨æ¥è¯´ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä¿å­˜å’Œæ¢å¤çš„æ•°æ®æ ¼å¼æ¯”è¾ƒå¤æ‚è€Œå·²ã€‚Java çš„åºåˆ—åŒ–ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å¤‡å¿˜å½•æ¨¡å¼ã€‚

åœ¨ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ç»å¸¸ä½¿ç”¨ Undoã€Redo è¿™äº›åŠŸèƒ½ã€‚è¿™äº›å…¶å®ä¹Ÿå¯ä»¥ç”¨å¤‡å¿˜å½•æ¨¡å¼å®ç°ï¼Œå³ä¸å®šæœŸåœ°æŠŠ `TextEditor` ç±»çš„å­—ç¬¦ä¸²å¤åˆ¶ä¸€ä»½å­˜èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥ Undo æˆ– Redoã€‚

æ ‡å‡†çš„å¤‡å¿˜å½•æ¨¡å¼æœ‰è¿™ä¹ˆå‡ ç§è§’è‰²ï¼š

- Mementoï¼šå­˜å‚¨çš„å†…éƒ¨çŠ¶æ€ï¼›
- Originatorï¼šåˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•å¹¶è®¾ç½®å…¶çŠ¶æ€ï¼›
- Caretakerï¼šè´Ÿè´£ä¿å­˜å¤‡å¿˜å½•ã€‚

å®é™…ä¸Šæˆ‘ä»¬åœ¨ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼çš„æ—¶å€™ï¼Œä¸å¿…è®¾è®¡å¾—è¿™ä¹ˆå¤æ‚ï¼Œåªéœ€è¦å¯¹ç±»ä¼¼ `TextEditor` çš„ç±»ï¼Œå¢åŠ  `getState()` å’Œ `setState()` å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬ä»¥ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ `TextEditor` ä¸ºä¾‹ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨ `StringBuilder` å…è®¸ç”¨æˆ·å¢åˆ å­—ç¬¦ï¼š

```java
public class TextEditor {
    private StringBuilder buffer = new StringBuilder();

    public void add(char ch) {
        buffer.append(ch);
    }

    public void add(String s) {
        buffer.append(s);
    }

    public void delete() {
        if (buffer.length() > 0) {
            buffer.deleteCharAt(buffer.length() - 1);
        }
    }
}
```

ä¸ºäº†æ”¯æŒè¿™ä¸ª `TextEditor` èƒ½ä¿å­˜å’Œæ¢å¤çŠ¶æ€ï¼Œæˆ‘ä»¬å¢åŠ  `getState()` å’Œ `setState()` ä¸¤ä¸ªæ–¹æ³•ï¼š

```java
public class TextEditor {
    ...

    // è·å–çŠ¶æ€:
    public String getState() {
        return buffer.toString();
    }

    // æ¢å¤çŠ¶æ€:
    public void setState(String state) {
        this.buffer.delete(0, this.buffer.length());
        this.buffer.append(state);
    }
}
```

å¯¹è¿™ä¸ªç®€å•çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç”¨ä¸€ä¸ª `String` å°±å¯ä»¥è¡¨ç¤ºå…¶çŠ¶æ€ï¼Œå¯¹äºå¤æ‚çš„å¯¹è±¡æ¨¡å‹ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ JSONã€XML ç­‰å¤æ‚æ ¼å¼ã€‚

## ğŸ€ ç»ƒä¹ 

ç»™ TextEditor æ·»åŠ å¤‡å¿˜å½•æ¨¡å¼


## ğŸ€ å°ç»“

å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸ºäº†ä¿å­˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨å°†æ¥æ¢å¤ï¼Œå¤§å¤šæ•°è½¯ä»¶æä¾›çš„ä¿å­˜ã€æ‰“å¼€ï¼Œä»¥åŠç¼–è¾‘è¿‡ç¨‹ä¸­çš„ Undoã€Redo éƒ½æ˜¯å¤‡å¿˜å½•æ¨¡å¼çš„åº”ç”¨ã€‚





