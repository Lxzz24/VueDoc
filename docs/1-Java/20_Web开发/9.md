---
title: ä½¿ç”¨ Listener
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

é™¤äº† Servlet å’Œ Filter å¤–ï¼ŒJavaEE çš„ Servlet è§„èŒƒè¿˜æä¾›äº†ç¬¬ä¸‰ç§ç»„ä»¶ï¼šListenerã€‚

Listener é¡¾åæ€ä¹‰å°±æ˜¯ç›‘å¬å™¨ï¼Œæœ‰å¥½å‡ ç§ Listenerï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ `ServletContextListener`ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå®ç°äº† `ServletContextListener` æ¥å£çš„ç±»å¦‚ä¸‹ï¼š

```java
@WebListener
public class AppListener implements ServletContextListener {
    // åœ¨æ­¤åˆå§‹åŒ– WebApp, ä¾‹å¦‚æ‰“å¼€æ•°æ®åº“è¿æ¥æ± ç­‰:
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("WebApp initialized.");
    }

    // åœ¨æ­¤æ¸…ç† WebApp, ä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥æ± ç­‰:
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("WebApp destroyed.");
    }
}
```

ä»»ä½•æ ‡æ³¨ä¸º `@WebListener`ï¼Œä¸”å®ç°äº†ç‰¹å®šæ¥å£çš„ç±»ä¼šè¢« Web æœåŠ¡å™¨è‡ªåŠ¨åˆå§‹åŒ–ã€‚ä¸Šè¿° `AppListener` å®ç°äº† `ServletContextListener` æ¥å£ï¼Œå®ƒä¼šåœ¨æ•´ä¸ª Web åº”ç”¨ç¨‹åºåˆå§‹åŒ–å®Œæˆåï¼Œä»¥åŠ Web åº”ç”¨ç¨‹åºå…³é—­åè·å¾—å›è°ƒé€šçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠåˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ç­‰å·¥ä½œæ”¾åˆ° `contextInitialized()` å›è°ƒæ–¹æ³•ä¸­ï¼ŒæŠŠæ¸…ç†èµ„æºçš„å·¥ä½œæ”¾åˆ° `contextDestroyed()` å›è°ƒæ–¹æ³•ä¸­ï¼Œå› ä¸º Web æœåŠ¡å™¨ä¿è¯åœ¨ `contextInitialized()` æ‰§è¡Œåï¼Œæ‰ä¼šæ¥å—ç”¨æˆ·çš„ HTTP è¯·æ±‚ã€‚

å¾ˆå¤šç¬¬ä¸‰æ–¹ Web æ¡†æ¶éƒ½ä¼šé€šè¿‡ä¸€ä¸ª `ServletContextListener` æ¥å£åˆå§‹åŒ–è‡ªå·±ã€‚

é™¤äº† `ServletContextListener` å¤–ï¼Œè¿˜æœ‰å‡ ç§ Listenerï¼š

- HttpSessionListenerï¼šç›‘å¬ HttpSession çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›
- ServletRequestListenerï¼šç›‘å¬ ServletRequest è¯·æ±‚çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›
- ServletRequestAttributeListenerï¼šç›‘å¬ ServletRequest è¯·æ±‚çš„å±æ€§å˜åŒ–äº‹ä»¶ï¼ˆå³è°ƒç”¨ `ServletRequest.setAttribute()` æ–¹æ³•ï¼‰ï¼›
- ServletContextAttributeListenerï¼šç›‘å¬ ServletContext çš„å±æ€§å˜åŒ–äº‹ä»¶ï¼ˆå³è°ƒç”¨ `ServletContext.setAttribute()` æ–¹æ³•ï¼‰ï¼›

## ğŸ€ ServletContext

ä¸€ä¸ª Web æœåŠ¡å™¨å¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ª WebAppï¼Œå¯¹äºæ¯ä¸ª WebAppï¼ŒWeb æœåŠ¡å™¨éƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ `ServletContext` å®ä¾‹ï¼Œæˆ‘ä»¬åœ¨ `AppListener` é‡Œé¢ç¼–å†™çš„ä¸¤ä¸ªå›è°ƒæ–¹æ³•å®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯ `ServletContext` å®ä¾‹çš„åˆ›å»ºå’Œé”€æ¯ï¼š

```java
public void contextInitialized(ServletContextEvent sce) {
    System.out.println("WebApp initialized: ServletContext =" + sce.getServletContext());
}
```

`ServletRequest`ã€`HttpSession` ç­‰å¾ˆå¤šå¯¹è±¡ä¹Ÿæä¾› `getServletContext()` æ–¹æ³•è·å–åˆ°åŒä¸€ä¸ª `ServletContext` å®ä¾‹ã€‚`ServletContext` å®ä¾‹æœ€å¤§çš„ä½œç”¨å°±æ˜¯è®¾ç½®å’Œå…±äº«å…¨å±€ä¿¡æ¯ã€‚

æ­¤å¤–ï¼Œ`ServletContext` è¿˜æä¾›äº†åŠ¨æ€æ·»åŠ  Servletã€Filterã€Listener ç­‰åŠŸèƒ½ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè™½ç„¶è¿™ä¸ªåŠŸèƒ½ä¸æ˜¯å¾ˆå¸¸ç”¨ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Listener ç›‘å¬ WebApp

## ğŸ€ å°ç»“

é€šè¿‡ Listener æˆ‘ä»¬å¯ä»¥ç›‘å¬ Web åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œè·å– `HttpSession` ç­‰åˆ›å»ºå’Œé”€æ¯çš„äº‹ä»¶ï¼›

`ServletContext` æ˜¯ä¸€ä¸ª WebApp è¿è¡ŒæœŸçš„å…¨å±€å”¯ä¸€å®ä¾‹ï¼Œå¯ç”¨äºè®¾ç½®å’Œå…±äº«é…ç½®ä¿¡æ¯ã€‚

