---
title: éƒ¨ç½²
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


å¯¹ä¸€ä¸ª Web åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé™¤äº† Servletã€Filter è¿™äº›é€»è¾‘ç»„ä»¶ï¼Œè¿˜éœ€è¦ JSP è¿™æ ·çš„è§†å›¾æ–‡ä»¶ï¼Œå¤–åŠ ä¸€å †é™æ€èµ„æºæ–‡ä»¶ï¼Œå¦‚ CSSã€JS ç­‰ã€‚

åˆç†ç»„ç»‡æ–‡ä»¶ç»“æ„éå¸¸é‡è¦ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªå…·ä½“çš„ Web åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼š

![image-20231221140740305](./assets/image-20231221140740305.png)

æˆ‘ä»¬æŠŠæ‰€æœ‰çš„é™æ€èµ„æºæ–‡ä»¶æ”¾å…¥ `/static/` ç›®å½•ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œæœ‰äº› Web æœåŠ¡å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åŠ ä¸€ä¸ªä¸“é—¨è´Ÿè´£å¤„ç†é™æ€æ–‡ä»¶çš„ Servletï¼Œä½†å¦‚æœ `IndexServlet` æ˜ å°„è·¯å¾„ä¸º `/`ï¼Œä¼šå±è”½æ‰å¤„ç†é™æ€æ–‡ä»¶çš„ Servlet æ˜ å°„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ªå¤„ç†é™æ€æ–‡ä»¶çš„ `FileServlet`ï¼š

```java
@WebServlet(urlPatterns = "/static/*")
public class FileServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext ctx = req.getServletContext();
        // RequestURI åŒ…å« ContextPath, éœ€è¦å»æ‰:
        String urlPath = req.getRequestURI().substring(ctx.getContextPath().length());
        // è·å–çœŸå®æ–‡ä»¶è·¯å¾„:
        String filepath = ctx.getRealPath(urlPath);
        if (filepath == null) {
            // æ— æ³•è·å–åˆ°è·¯å¾„:
            resp.sendError(HttpServletResponse.SC_NOT_FOUND);
            return;
        }
        Path path = Paths.get(filepath);
        if (!path.toFile().isFile()) {
            // æ–‡ä»¶ä¸å­˜åœ¨:
            resp.sendError(HttpServletResponse.SC_NOT_FOUND);
            return;
        }
        // æ ¹æ®æ–‡ä»¶åçŒœæµ‹ Content-Type:
        String mime = Files.probeContentType(path);
        if (mime == null) {
            mime = "application/octet-stream";
        }
        resp.setContentType(mime);
        // è¯»å–æ–‡ä»¶å¹¶å†™å…¥ Response:
        OutputStream output = resp.getOutputStream();
        try (InputStream input = new BufferedInputStream(new FileInputStream(filepath))) {
            input.transferTo(output);
        }
        output.flush();
    }
}
```

è¿™æ ·ä¸€æ¥ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿åœ°é«˜æ•ˆå¼€å‘ã€‚

ç±»ä¼¼ Tomcat è¿™æ ·çš„ Web æœåŠ¡å™¨ï¼Œè¿è¡Œçš„ Web åº”ç”¨ç¨‹åºé€šå¸¸éƒ½æ˜¯ä¸šåŠ¡ç³»ç»Ÿï¼Œå› æ­¤ï¼Œè¿™ç±»æœåŠ¡å™¨ä¹Ÿè¢«ç§°ä¸ºåº”ç”¨æœåŠ¡å™¨ã€‚åº”ç”¨æœåŠ¡å™¨å¹¶ä¸æ“…é•¿å¤„ç†é™æ€æ–‡ä»¶ï¼Œä¹Ÿä¸é€‚åˆç›´æ¥æš´éœ²ç»™ç”¨æˆ·ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨ç±»ä¼¼ Nginx è¿™æ ·çš„æœåŠ¡å™¨å……å½“åå‘ä»£ç†å’Œé™æ€æœåŠ¡å™¨ï¼Œåªæœ‰åŠ¨æ€è¯·æ±‚æ‰ä¼šæ”¾è¡Œç»™åº”ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥ï¼Œéƒ¨ç½²æ¶æ„å¦‚ä¸‹ï¼š

![image-20231221140837145](./assets/image-20231221140837145.png)

å®ç°ä¸Šè¿°åŠŸèƒ½çš„ Nginx é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```conf
server {
    listen 80;

    server_name www.local.liaoxuefeng.com;

    # é™æ€æ–‡ä»¶æ ¹ç›®å½•:
    root /path/to/src/main/webapp;

    access_log /var/log/nginx/webapp_access_log;
    error_log  /var/log/nginx/webapp_error_log;

    # å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚:
    location /static {
    }

    # å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚:
    location /favicon.ico {
    }

    # ä¸å…è®¸è¯·æ±‚ / WEB-INF:
    location /WEB-INF {
        return 404;
    }

    # å…¶ä»–è¯·æ±‚è½¬å‘ç»™ Tomcat:
    location / {
        proxy_pass       http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

ä½¿ç”¨ Nginx é…åˆ Tomcat æœåŠ¡å™¨ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥ Nginx ä½œä¸ºç½‘å…³çš„ä¼˜åŠ¿ï¼Œæ—¢å¯ä»¥é«˜æ•ˆå¤„ç†é™æ€æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŠŠ httpsã€é˜²ç«å¢™ã€é™é€Ÿã€åçˆ¬è™«ç­‰åŠŸèƒ½æ”¾åˆ° Nginx ä¸­ï¼Œä½¿å¾—æˆ‘ä»¬è‡ªå·±çš„ WebApp èƒ½ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Nginx + Tomcat éƒ¨ç½²

## ğŸ€ å°ç»“

éƒ¨ç½² Web åº”ç”¨ç¨‹åºæ—¶ï¼Œè¦è®¾è®¡åˆç†çš„ç›®å½•ç»“æ„ï¼ŒåŒæ—¶è€ƒè™‘å¼€å‘æ¨¡å¼éœ€è¦ä¾¿æ·æ€§ï¼Œç”Ÿäº§æ¨¡å¼éœ€è¦é«˜æ€§èƒ½ã€‚





