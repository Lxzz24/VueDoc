---
title: ä½¿ç”¨ Condition
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ä½¿ç”¨ `ReentrantLock` æ¯”ç›´æ¥ä½¿ç”¨ `synchronized` æ›´å®‰å…¨ï¼Œå¯ä»¥æ›¿ä»£ `synchronized` è¿›è¡Œçº¿ç¨‹åŒæ­¥ã€‚

ä½†æ˜¯ï¼Œ`synchronized` å¯ä»¥é…åˆ `wait` å’Œ `notify` å®ç°çº¿ç¨‹åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶ç­‰å¾…ï¼Œæ¡ä»¶æ»¡è¶³æ—¶å”¤é†’ï¼Œç”¨ `ReentrantLock` æˆ‘ä»¬æ€ä¹ˆç¼–å†™ `wait` å’Œ `notify` çš„åŠŸèƒ½å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ _ä½¿ç”¨ `Condition` å¯¹è±¡æ¥å®ç° `wait` å’Œ `notify` çš„åŠŸèƒ½_ã€‚

æˆ‘ä»¬ä»ç„¶ä»¥ `TaskQueue` ä¸ºä¾‹ï¼ŒæŠŠå‰é¢ç”¨ `synchronized` å®ç°çš„åŠŸèƒ½é€šè¿‡ `ReentrantLock` å’Œ `Condition` æ¥å®ç°ï¼š

```java {3,10,20}
class TaskQueue {
    private final Lock lock = new ReentrantLock();
    private final Condition condition = lock.newCondition();
    private Queue<String> queue = new LinkedList<>();

    public void addTask(String s) {
        lock.lock();
        try {
            queue.add(s);
            condition.signalAll();
        } finally {
            lock.unlock();
        }
    }

    public String getTask() {
        lock.lock();
        try {
            while (queue.isEmpty()) {
                condition.await();
            }
            return queue.remove();
        } finally {
            lock.unlock();
        }
    }
}
```

å¯è§ï¼Œä½¿ç”¨ `Condition` æ—¶ï¼Œå¼•ç”¨çš„ `Condition` å¯¹è±¡å¿…é¡»ä» `Lock` å®ä¾‹çš„ `newCondition()` è¿”å›ï¼Œè¿™æ ·æ‰èƒ½è·å¾—ä¸€ä¸ªç»‘å®šäº† `Lock` å®ä¾‹çš„ `Condition` å®ä¾‹ã€‚

`Condition` æä¾›çš„ `await()`ã€`signal()`ã€`signalAll()` åŸç†å’Œ `synchronized` é”å¯¹è±¡çš„ `wait()`ã€`notify()`ã€`notifyAll()` æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å…¶è¡Œä¸ºä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š

- `await()` ä¼šé‡Šæ”¾å½“å‰é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›
- `signal()` ä¼šå”¤é†’æŸä¸ªç­‰å¾…çº¿ç¨‹ï¼›
- `signalAll()` ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼›
- å”¤é†’çº¿ç¨‹ä» `await()` è¿”å›åéœ€è¦é‡æ–°è·å¾—é”ã€‚

æ­¤å¤–ï¼Œå’Œ `tryLock()` ç±»ä¼¼ï¼Œ`await()` å¯ä»¥åœ¨ç­‰å¾…æŒ‡å®šæ—¶é—´åï¼Œå¦‚æœè¿˜æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é€šè¿‡ `signal()` æˆ– `signalAll()` å”¤é†’ï¼Œå¯ä»¥è‡ªå·±é†’æ¥ï¼š

```java
if (condition.await(1, TimeUnit.SECOND)) {
    // è¢«å…¶ä»–çº¿ç¨‹å”¤é†’
} else {
    // æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å”¤é†’
}
```

å¯è§ï¼Œä½¿ç”¨ `Condition` é…åˆ `Lock`ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´çµæ´»çš„çº¿ç¨‹åŒæ­¥ã€‚

## ğŸ€ å°ç»“

- `Condition` å¯ä»¥æ›¿ä»£ `wait` å’Œ `notify`ï¼›

- `Condition` å¯¹è±¡å¿…é¡»ä» `Lock` å¯¹è±¡è·å–ã€‚
