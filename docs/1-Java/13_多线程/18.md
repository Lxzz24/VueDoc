---
title: ä½¿ç”¨ Future
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

åœ¨æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä½¿ç”¨ Java æ ‡å‡†åº“æä¾›çš„çº¿ç¨‹æ± æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚æˆ‘ä»¬æäº¤çš„ä»»åŠ¡åªéœ€è¦å®ç° `Runnable` æ¥å£ï¼Œå°±å¯ä»¥è®©çº¿ç¨‹æ± å»æ‰§è¡Œï¼š

```java
class Task implements Runnable {
    public String result;

    public void run() {
        this.result = longTimeCalculation();
    }
}
```

`Runnable` æ¥å£æœ‰ä¸ªé—®é¢˜ï¼Œå®ƒçš„æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚å¦‚æœä»»åŠ¡éœ€è¦ä¸€ä¸ªè¿”å›ç»“æœï¼Œé‚£ä¹ˆåªèƒ½ä¿å­˜åˆ°å˜é‡ï¼Œè¿˜è¦æä¾›é¢å¤–çš„æ–¹æ³•è¯»å–ï¼Œéå¸¸ä¸ä¾¿ã€‚æ‰€ä»¥ï¼ŒJava æ ‡å‡†åº“è¿˜æä¾›äº†ä¸€ä¸ª `Callable` æ¥å£ï¼Œå’Œ `Runnable` æ¥å£æ¯”ï¼Œå®ƒå¤šäº†ä¸€ä¸ªè¿”å›å€¼ï¼š

```java
class Task implements Callable<String> {
    public String call() throws Exception {
        return longTimeCalculation();
    }
}
```

å¹¶ä¸” `Callable` æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå¯ä»¥è¿”å›æŒ‡å®šç±»å‹çš„ç»“æœã€‚

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•è·å¾—å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Ÿ

å¦‚æœä»”ç»†çœ‹ `ExecutorService.submit()` æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ª `Future` ç±»å‹ï¼Œä¸€ä¸ª `Future` ç±»å‹çš„å®ä¾‹ä»£è¡¨ä¸€ä¸ªæœªæ¥èƒ½è·å–ç»“æœçš„å¯¹è±¡ï¼š

```java
ExecutorService executor = Executors.newFixedThreadPool(4);
// å®šä¹‰ä»»åŠ¡:
Callable<String> task = new Task();
// æäº¤ä»»åŠ¡å¹¶è·å¾— Future:
Future<String> future = executor.submit(task);
// ä» Future è·å–å¼‚æ­¥æ‰§è¡Œè¿”å›çš„ç»“æœ:
String result = future.get(); // å¯èƒ½é˜»å¡
```

å½“æˆ‘ä»¬æäº¤ä¸€ä¸ª `Callable` ä»»åŠ¡åï¼Œæˆ‘ä»¬ä¼šåŒæ—¶è·å¾—ä¸€ä¸ª `Future` å¯¹è±¡ï¼Œç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹æŸä¸ªæ—¶åˆ»è°ƒç”¨ `Future` å¯¹è±¡çš„ `get()` æ–¹æ³•ï¼Œå°±å¯ä»¥è·å¾—å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚åœ¨è°ƒç”¨ `get()` æ—¶ï¼Œå¦‚æœå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆï¼Œæˆ‘ä»¬å°±ç›´æ¥è·å¾—ç»“æœã€‚å¦‚æœå¼‚æ­¥ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆ `get()` ä¼šé˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆåæ‰è¿”å›ç»“æœã€‚

ä¸€ä¸ª `Future<V>` æ¥å£è¡¨ç¤ºä¸€ä¸ªæœªæ¥å¯èƒ½ä¼šè¿”å›çš„ç»“æœï¼Œå®ƒå®šä¹‰çš„æ–¹æ³•æœ‰ï¼š

- `get()`ï¼šè·å–ç»“æœï¼ˆå¯èƒ½ä¼šç­‰å¾…ï¼‰
- `get(long timeout, TimeUnit unit)`ï¼šè·å–ç»“æœï¼Œä½†åªç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼›
- `cancel(boolean mayInterruptIfRunning)`ï¼šå–æ¶ˆå½“å‰ä»»åŠ¡ï¼›
- `isDone()`ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å®Œæˆã€‚

## ğŸ€ ç»ƒä¹ 

```java
package com.itranswarp.learnjava;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

public class Main {
	public static void main(String[] args) throws Exception {
		ExecutorService es = Executors.newFixedThreadPool(4);
		Future<BigDecimal> future = es.submit(new Task("601857"));
		System.out.println(future.get());
		es.shutdown();
	}
}

class Task implements Callable<BigDecimal> {

	public Task(String code) {
	}

	@Override
	public BigDecimal call() throws Exception {
		Thread.sleep(1000);
		double d = 5 + Math.random() * 20;
		return new BigDecimal(d).setScale(2, RoundingMode.DOWN);
	}
}
```

## ğŸ€ å°ç»“

å¯¹çº¿ç¨‹æ± æäº¤ä¸€ä¸ª `Callable` ä»»åŠ¡ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ª `Future` å¯¹è±¡ï¼›

å¯ä»¥ç”¨ `Future` åœ¨å°†æ¥æŸä¸ªæ—¶åˆ»è·å–ç»“æœã€‚