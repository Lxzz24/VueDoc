---
title: ä½¿ç”¨ ReentrantLock
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ä» Java 5 å¼€å§‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªé«˜çº§çš„å¤„ç†å¹¶å‘çš„ `java.util.concurrent` åŒ…ï¼Œå®ƒæä¾›äº†å¤§é‡æ›´é«˜çº§çš„å¹¶å‘åŠŸèƒ½ï¼Œèƒ½å¤§å¤§ç®€åŒ–å¤šçº¿ç¨‹ç¨‹åºçš„ç¼–å†™ã€‚

æˆ‘ä»¬çŸ¥é“ Java è¯­è¨€ç›´æ¥æä¾›äº† `synchronized` å…³é”®å­—ç”¨äºåŠ é”ï¼Œä½†è¿™ç§é”ä¸€æ˜¯å¾ˆé‡ï¼ŒäºŒæ˜¯è·å–æ—¶å¿…é¡»ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰é¢å¤–çš„å°è¯•æœºåˆ¶ã€‚

`java.util.concurrent.locks` åŒ…æä¾›çš„ `ReentrantLock` ç”¨äºæ›¿ä»£ `synchronized` åŠ é”ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„ `synchronized` ä»£ç ï¼š

```java
public class Counter {
    private int count;

    public void add(int n) {
        synchronized(this) {
            count += n;
        }
    }
}
```

å¦‚æœç”¨ `ReentrantLock` æ›¿ä»£ï¼Œå¯ä»¥æŠŠä»£ç æ”¹é€ ä¸ºï¼š

```java
public class Counter {
    private final Lock lock = new ReentrantLock();
    private int count;

    public void add(int n) {
        lock.lock();
        try {
            count += n;
        } finally {
            lock.unlock();
        }
    }
}
```

å› ä¸º `synchronized` æ˜¯ Java è¯­è¨€å±‚é¢æä¾›çš„è¯­æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘å¼‚å¸¸ï¼Œè€Œ `ReentrantLock` æ˜¯ Java ä»£ç å®ç°çš„é”ï¼Œæˆ‘ä»¬å°±å¿…é¡»å…ˆè·å–é”ï¼Œç„¶ååœ¨ `finally` ä¸­æ­£ç¡®é‡Šæ”¾é”ã€‚

é¡¾åæ€ä¹‰ï¼Œ`ReentrantLock` æ˜¯å¯é‡å…¥é”ï¼Œå®ƒå’Œ `synchronized` ä¸€æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ã€‚

å’Œ `synchronized` ä¸åŒçš„æ˜¯ï¼Œ`ReentrantLock` å¯ä»¥å°è¯•è·å–é”ï¼š

```java
if (lock.tryLock(1, TimeUnit.SECONDS)) {
    try {
        ...
    } finally {
        lock.unlock();
    }
}
```

ä¸Šè¿°ä»£ç åœ¨å°è¯•è·å–é”çš„æ—¶å€™ï¼Œæœ€å¤šç­‰å¾… 1 ç§’ã€‚å¦‚æœ 1 ç§’åä»æœªè·å–åˆ°é”ï¼Œ`tryLock()` è¿”å› `false`ï¼Œç¨‹åºå°±å¯ä»¥åšä¸€äº›é¢å¤–å¤„ç†ï¼Œè€Œä¸æ˜¯æ— é™ç­‰å¾…ä¸‹å»ã€‚

æ‰€ä»¥ï¼Œä½¿ç”¨ `ReentrantLock` æ¯”ç›´æ¥ä½¿ç”¨ `synchronized` æ›´å®‰å…¨ï¼Œçº¿ç¨‹åœ¨ `tryLock()` å¤±è´¥çš„æ—¶å€™ä¸ä¼šå¯¼è‡´æ­»é”ã€‚

## ğŸ€ å°ç»“

- ReentrantLock å¯ä»¥æ›¿ä»£ synchronized è¿›è¡ŒåŒæ­¥ï¼›

- ReentrantLock è·å–é”æ›´å®‰å…¨ï¼›

- å¿…é¡»å…ˆè·å–åˆ°é”ï¼Œå†è¿›å…¥ `try {...}` ä»£ç å—ï¼Œæœ€åä½¿ç”¨ `finally` ä¿è¯é‡Šæ”¾é”ï¼›

- å¯ä»¥ä½¿ç”¨ `tryLock()` å°è¯•è·å–é”ã€‚
