---
title: ä½¿ç”¨ JSON
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

å‰é¢æˆ‘ä»¬è®¨è®ºäº† XML è¿™ç§æ•°æ®æ ¼å¼ã€‚XML çš„ç‰¹ç‚¹æ˜¯åŠŸèƒ½å…¨é¢ï¼Œä½†æ ‡ç­¾ç¹çï¼Œæ ¼å¼å¤æ‚ã€‚åœ¨ Web ä¸Šä½¿ç”¨ XML ç°åœ¨è¶Šæ¥è¶Šå°‘ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ JSON è¿™ç§æ•°æ®ç»“æ„ã€‚

JSON æ˜¯ JavaScript Object Notation çš„ç¼©å†™ï¼Œå®ƒå»é™¤äº†æ‰€æœ‰ JavaScript æ‰§è¡Œä»£ç ï¼Œåªä¿ç•™ JavaScript çš„å¯¹è±¡æ ¼å¼ã€‚ä¸€ä¸ªå…¸å‹çš„ JSON å¦‚ä¸‹ï¼š

```json
{
    "id": 1,
    "name": "Java æ ¸å¿ƒæŠ€æœ¯",
    "author": {
        "firstName": "Abc",
        "lastName": "Xyz"
    },
    "isbn": "1234567",
    "tags": ["Java", "Network"]
}
```

JSON ä½œä¸ºæ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œæœ‰å‡ ä¸ªæ˜¾è‘—çš„ä¼˜ç‚¹ï¼š

- JSON åªå…è®¸ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œä¸å­˜åœ¨ç¼–ç é—®é¢˜ï¼›
- JSON åªå…è®¸ä½¿ç”¨åŒå¼•å·ä½œä¸º keyï¼Œç‰¹æ®Šå­—ç¬¦ç”¨ `\` è½¬ä¹‰ï¼Œæ ¼å¼ç®€å•ï¼›
- æµè§ˆå™¨å†…ç½® JSON æ”¯æŒï¼Œå¦‚æœæŠŠæ•°æ®ç”¨ JSON å‘é€ç»™æµè§ˆå™¨ï¼Œå¯ä»¥ç”¨ JavaScript ç›´æ¥å¤„ç†ã€‚

å› æ­¤ï¼ŒJSON é€‚åˆè¡¨ç¤ºå±‚æ¬¡ç»“æ„ï¼Œå› ä¸ºå®ƒæ ¼å¼ç®€å•ï¼Œä»…æ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š

- é”®å€¼å¯¹ï¼š`{"key": value}`
- æ•°ç»„ï¼š`[1, 2, 3]`
- å­—ç¬¦ä¸²ï¼š`"abc"`
- æ•°å€¼ï¼ˆæ•´æ•°å’Œæµ®ç‚¹æ•°ï¼‰ï¼š`12.34`
- å¸ƒå°”å€¼ï¼š`true` æˆ– `false`
- ç©ºå€¼ï¼š`null`

æµè§ˆå™¨ç›´æ¥æ”¯æŒä½¿ç”¨ JavaScript å¯¹ JSON è¿›è¡Œè¯»å†™ï¼š

```js
// JSON string to JavaScript object:
jsObj = JSON.parse(jsonStr);

// JavaScript object to JSON string:
jsonStr = JSON.stringify(jsObj);
```

æ‰€ä»¥ï¼Œå¼€å‘ Web åº”ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨ JSON ä½œä¸ºæ•°æ®ä¼ è¾“ï¼Œåœ¨æµè§ˆå™¨ç«¯éå¸¸æ–¹ä¾¿ã€‚å› ä¸º JSON å¤©ç”Ÿé€‚åˆ JavaScript å¤„ç†ï¼Œæ‰€ä»¥ï¼Œç»å¤§å¤šæ•° REST API éƒ½é€‰æ‹© JSON ä½œä¸ºæ•°æ®ä¼ è¾“æ ¼å¼ã€‚

ç°åœ¨é—®é¢˜æ¥äº†ï¼šä½¿ç”¨ Java å¦‚ä½•å¯¹ JSON è¿›è¡Œè¯»å†™ï¼Ÿ

åœ¨ Java ä¸­ï¼Œé’ˆå¯¹ JSON ä¹Ÿæœ‰æ ‡å‡†çš„ JSR 353 APIï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å‰é¢è®² XML çš„æ—¶å€™å‘ç°ï¼Œå¦‚æœèƒ½ç›´æ¥åœ¨ XML å’Œ JavaBean ä¹‹é—´äº’ç›¸è½¬æ¢æ˜¯æœ€å¥½çš„ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœèƒ½ç›´æ¥åœ¨ JSON å’Œ JavaBean ä¹‹é—´è½¬æ¢ï¼Œé‚£ä¹ˆç”¨èµ·æ¥å°±ç®€å•å¤šäº†ã€‚

å¸¸ç”¨çš„ç”¨äºè§£æ JSON çš„ç¬¬ä¸‰æ–¹åº“æœ‰ï¼š

- Jackson
- Gson
- Fastjson
- ...

æ³¨æ„åˆ°ä¸Šä¸€èŠ‚æåˆ°çš„é‚£ä¸ªå¯ä»¥è§£æ XML çš„æµ“çœ‰å¤§çœ¼çš„ Jackson ä¹Ÿå¯ä»¥è§£æ JSONï¼å› æ­¤æˆ‘ä»¬åªéœ€è¦å¼•å…¥ä»¥ä¸‹ Maven ä¾èµ–ï¼š

- com.fasterxml.jackson.core:jackson-databind:2.12.0

å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç è§£æä¸€ä¸ª JSON æ–‡ä»¶ï¼š

```java
InputStream input = Main.class.getResourceAsStream("/book.json");
ObjectMapper mapper = new ObjectMapper();
// ååºåˆ—åŒ–æ—¶å¿½ç•¥ä¸å­˜åœ¨çš„ JavaBean å±æ€§:
mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
Book book = mapper.readValue(input, Book.class);
```

æ ¸å¿ƒä»£ç æ˜¯åˆ›å»ºä¸€ä¸ª `ObjectMapper` å¯¹è±¡ã€‚å…³é—­ `DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES` åŠŸèƒ½ä½¿å¾—è§£ææ—¶å¦‚æœ JavaBean ä¸å­˜åœ¨è¯¥å±æ€§æ—¶è§£æä¸ä¼šæŠ¥é”™ã€‚

æŠŠ JSON è§£æä¸º JavaBean çš„è¿‡ç¨‹ç§°ä¸ºååºåˆ—åŒ–ã€‚å¦‚æœæŠŠ JavaBean å˜ä¸º JSONï¼Œé‚£å°±æ˜¯åºåˆ—åŒ–ã€‚è¦å®ç° JavaBean åˆ° JSON çš„åºåˆ—åŒ–ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼š

```java
String json = mapper.writeValueAsString(book);
```

è¦æŠŠ JSON çš„æŸäº›å€¼è§£æä¸ºç‰¹å®šçš„ Java å¯¹è±¡ï¼Œä¾‹å¦‚ `LocalDate`ï¼Œä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚ä¾‹å¦‚ï¼š

```json
{
    "name": "Java æ ¸å¿ƒæŠ€æœ¯",
    "pubDate": "2016-09-01"
}
```

è¦è§£æä¸ºï¼š

```java
public class Book {
    public String name;
    public LocalDate pubDate;
}
```

åªéœ€è¦å¼•å…¥æ ‡å‡†çš„ JSR 310 å…³äº JavaTime çš„æ•°æ®æ ¼å¼å®šä¹‰è‡³ Mavenï¼š

- com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.12.0

ç„¶åï¼Œåœ¨åˆ›å»º `ObjectMapper` æ—¶ï¼Œæ³¨å†Œä¸€ä¸ªæ–°çš„ `JavaTimeModule`ï¼š

```java
ObjectMapper mapper = new ObjectMapper().registerModule(new JavaTimeModule());
```

æœ‰äº›æ—¶å€™ï¼Œå†…ç½®çš„è§£æè§„åˆ™å’Œæ‰©å±•çš„è§£æè§„åˆ™å¦‚æœéƒ½ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è§£æã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ `Book` ç±»çš„ `isbn` æ˜¯ä¸€ä¸ª `BigInteger`ï¼š

```java
public class Book {
	public String name;
	public BigInteger isbn;
}
```

ä½† JSON æ•°æ®å¹¶ä¸æ˜¯æ ‡å‡†çš„æ•´å½¢æ ¼å¼ï¼š

```json
{
    "name": "Java æ ¸å¿ƒæŠ€æœ¯",
    "isbn": "978-7-111-54742-6"
}
```

ç›´æ¥è§£æï¼Œè‚¯å®šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª `IsbnDeserializer`ï¼Œç”¨äºè§£æå«æœ‰éæ•°å­—çš„å­—ç¬¦ä¸²ï¼š

```java
public class IsbnDeserializer extends JsonDeserializer<BigInteger> {
    public BigInteger deserialize(JsonParser p, DeserializationContext ctxt) throws IOException, JsonProcessingException {
        // è¯»å–åŸå§‹çš„ JSON å­—ç¬¦ä¸²å†…å®¹:
        String s = p.getValueAsString();
        if (s != null) {
            try {
                return new BigInteger(s.replace("-", ""));
            } catch (NumberFormatException e) {
                throw new JsonParseException(p, s, e);
            }
        }
        return null;
    }
}
```

ç„¶åï¼Œåœ¨ `Book` ç±»ä¸­ä½¿ç”¨æ³¨è§£æ ‡æ³¨ï¼š

```java
public class Book {
    public String name;
    // è¡¨ç¤ºååºåˆ—åŒ– isbn æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„ IsbnDeserializer:
    @JsonDeserialize(using = IsbnDeserializer.class)
    public BigInteger isbn;
}
```

ç±»ä¼¼çš„ï¼Œè‡ªå®šä¹‰åºåˆ—åŒ–æ—¶æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª `IsbnSerializer`ï¼Œç„¶ååœ¨ `Book` ç±»ä¸­æ ‡æ³¨ `@JsonSerialize(using = ...)` å³å¯ã€‚

## ğŸ€ ååºåˆ—åŒ–

åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJackson è¦æ±‚ Java ç±»éœ€è¦ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ•°æ„é€ æ–¹æ³•ï¼Œå¦åˆ™ï¼Œæ— æ³•ç›´æ¥å®ä¾‹åŒ–æ­¤ç±»ã€‚å­˜åœ¨å¸¦å‚æ•°æ„é€ æ–¹æ³•çš„ç±»ï¼Œå¦‚æœè¦ååºåˆ—åŒ–ï¼Œæ³¨æ„å†æä¾›ä¸€ä¸ªæ— å‚æ•°æ„é€ æ–¹æ³•ã€‚

å¯¹äº `enum` å­—æ®µï¼ŒJackson æŒ‰ String ç±»å‹å¤„ç†ï¼Œå³ï¼š

```java
class Book {
    public DayOfWeek start = MONDAY;
}
```

åºåˆ—åŒ–ä¸ºï¼š

```json
{
    "start": "MONDAY"
}
```

å¯¹äº `record` ç±»å‹ï¼ŒJackson ä¼šè‡ªåŠ¨æ‰¾å‡ºå®ƒçš„å¸¦å‚æ•°æ„é€ æ–¹æ³•ï¼Œå¹¶æ ¹æ® JSON çš„ key è¿›è¡ŒåŒ¹é…ï¼Œå¯ç›´æ¥ååºåˆ—åŒ–ã€‚å¯¹ `record` ç±»å‹çš„æ”¯æŒéœ€è¦ç‰ˆæœ¬ `2.12.0` ä»¥ä¸Šã€‚

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ Jackson è§£æ JSON

## ğŸ€ å°ç»“

JSON æ˜¯è½»é‡çº§çš„æ•°æ®è¡¨ç¤ºæ–¹å¼ï¼Œå¸¸ç”¨äº Web åº”ç”¨ï¼›

Jackson å¯ä»¥å®ç° JavaBean å’Œ JSON ä¹‹é—´çš„è½¬æ¢ï¼›

å¯ä»¥é€šè¿‡ Module æ‰©å±• Jackson èƒ½å¤„ç†çš„æ•°æ®ç±»å‹ï¼›

å¯ä»¥è‡ªå®šä¹‰ `JsonSerializer` å’Œ `JsonDeserializer` æ¥å®šåˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

