---
title: StringBuilder
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

Java ç¼–è¯‘å™¨å¯¹ `String` åšäº†ç‰¹æ®Šå¤„ç†ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ `+` æ‹¼æ¥å­—ç¬¦ä¸²ã€‚

è€ƒå¯Ÿä¸‹é¢çš„å¾ªç¯ä»£ç ï¼š

```java
String s = "";
for (int i = 0; i < 1000; i++) {
    s = s + "," + i;
}
```

> [!important]
> è™½ç„¶å¯ä»¥ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ï¼Œåœ¨å¾ªç¯ä¸­ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åæ‰”æ‰æ—§çš„å­—ç¬¦ä¸²ã€‚è¿™æ ·ï¼Œç»å¤§éƒ¨åˆ†å­—ç¬¦ä¸²éƒ½æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œä¸ä½†æµªè´¹å†…å­˜ï¼Œè¿˜ä¼šå½±å“ GC æ•ˆç‡ã€‚

ä¸ºäº†èƒ½é«˜æ•ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼ŒJava æ ‡å‡†åº“æä¾›äº† `StringBuilder`ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå¯ä»¥é¢„åˆ†é…ç¼“å†²åŒºï¼Œè¿™æ ·ï¼Œå¾€ `StringBuilder` ä¸­æ–°å¢å­—ç¬¦æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ä¸´æ—¶å¯¹è±¡ï¼š

```java
StringBuilder sb = new StringBuilder(1024);
for (int i = 0; i < 1000; i++) {
    sb.append(',');
    sb.append(i);
}
String s = sb.toString();
```

StringBuilder è¿˜å¯ä»¥è¿›è¡Œé“¾å¼æ“ä½œï¼š

```java
// é“¾å¼æ“ä½œ
public class Main {
    public static void main(String[] args) {
        var sb = new StringBuilder(1024);
        sb.append("Mr")
          .append("Bob")
          .append("!")
          .insert(0, "Hello,");
        System.out.println(sb.toString());
    }
}
```

å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ `StringBuilder` çš„æºç ï¼Œå¯ä»¥å‘ç°ï¼Œè¿›è¡Œé“¾å¼æ“ä½œçš„å…³é”®æ˜¯ï¼Œå®šä¹‰çš„ `append()` æ–¹æ³•ä¼šè¿”å› `this`ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥ä¸æ–­è°ƒç”¨è‡ªèº«çš„å…¶ä»–æ–¹æ³•ã€‚

ä»¿ç…§ `StringBuilder`ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾è®¡æ”¯æŒé“¾å¼æ“ä½œçš„ç±»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯ä»¥ä¸æ–­å¢åŠ çš„è®¡æ•°å™¨ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Adder adder = new Adder();
        adder.add(3)
             .add(5)
             .inc()
             .add(10);
        System.out.println(adder.value());
    }
}

class Adder {
    private int sum = 0;

    public Adder add(int n) {
        sum += n;
        return this;
    }

    public Adder inc() {
        sum ++;
        return this;
    }

    public int value() {
        return sum;
    }
}
```

> [!caution]
> å¯¹äºæ™®é€šçš„å­—ç¬¦ä¸² `+` æ“ä½œï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å°†å…¶æ”¹å†™ä¸º `StringBuilder`ï¼Œå› ä¸º Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±è‡ªåŠ¨æŠŠå¤šä¸ªè¿ç»­çš„ `+` æ“ä½œç¼–ç ä¸º `StringConcatFactory` çš„æ“ä½œã€‚åœ¨è¿è¡ŒæœŸï¼Œ`StringConcatFactory` ä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è¿æ¥æ“ä½œä¼˜åŒ–ä¸ºæ•°ç»„å¤åˆ¶æˆ–è€… `StringBuilder` æ“ä½œã€‚

ä½ å¯èƒ½è¿˜å¬è¯´è¿‡ `StringBuffer`ï¼Œè¿™æ˜¯ Java æ—©æœŸçš„ä¸€ä¸ª `StringBuilder` çš„*çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬*ï¼Œå®ƒé€šè¿‡åŒæ­¥æ¥ **_ä¿è¯å¤šä¸ªçº¿ç¨‹æ“ä½œ `StringBuffer` ä¹Ÿæ˜¯å®‰å…¨çš„_** ï¼Œä½†æ˜¯ **_åŒæ­¥ä¼šå¸¦æ¥æ‰§è¡Œé€Ÿåº¦çš„ä¸‹é™_** ã€‚

`StringBuilder` å’Œ `StringBuffer` æ¥å£å®Œå…¨ç›¸åŒï¼Œç°åœ¨å®Œå…¨æ²¡æœ‰å¿…è¦ä½¿ç”¨ `StringBuffer` ã€‚

## ğŸ€ ç»ƒä¹ 

è¯·ä½¿ç”¨ `StringBuilder` æ„é€ ä¸€ä¸ª `INSERT` è¯­å¥ï¼š

```java
public class Main {
    public static void main(String[] args) {
        String[] fields = { "name", "position", "salary"};
        String table = "employee";
        String insert = buildInsertSql(table, fields);
        System.out.println(insert);
        String s = "INSERT INTO employee (name, position, salary) VALUES (?, ?, ?)";
        System.out.println(s.equals(insert) ? "æµ‹è¯•æˆåŠŸ" : "æµ‹è¯•å¤±è´¥");
    }
    static String buildInsertSql(String table, String[] fields) {
        // TODO:
        StringBuilder sb = new StringBuilder();
        sb.append("INSERT INTO ")
                .append(table + " (")
                .append(String.join(", ",fields))
                .append(") VALUES (?, ?, ?)");
        return sb.toString();
    }
}
```

## ğŸ€ å°ç»“

- `StringBuilder` æ˜¯å¯å˜å¯¹è±¡ï¼Œç”¨æ¥ **_é«˜æ•ˆæ‹¼æ¥å­—ç¬¦ä¸²_** ï¼›
- `StringBuilder` å¯ä»¥æ”¯æŒé“¾å¼æ“ä½œï¼Œå®ç°é“¾å¼æ“ä½œçš„å…³é”®æ˜¯è¿”å›å®ä¾‹æœ¬èº«ï¼›

- `StringBuffer` æ˜¯ `StringBuilder` çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œç°åœ¨å¾ˆå°‘ä½¿ç”¨ã€‚
