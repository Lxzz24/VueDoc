---
title: é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

## ğŸ€ å°è£…æ€§ï¼ˆEncapsulationï¼‰

å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `å¯¹è±¡.å±æ€§` çš„æ–¹å¼ï¼Œå¯¹å¯¹è±¡çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œè¿™é‡Œï¼Œèµ‹å€¼æ“ä½œè¦å—åˆ°å±æ€§çš„æ•°æ®ç±»å‹å’Œå­˜å‚¨èŒƒå›´çš„åˆ¶çº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–åˆ¶çº¦æ¡ä»¶ã€‚

ä½†æ˜¯ï¼Œåœ¨å®é™…é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ç»™å±æ€§èµ‹å€¼ï¼ŒåŠ å…¥é¢å¤–çš„é™åˆ¶æ¡ä»¶ã€‚è¿™ä¸ªæ¡ä»¶å°±ä¸èƒ½åœ¨å±æ€§å£°æ˜æ—¶ä½“ç°ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡æ–¹æ³•è¿›è¡Œé™åˆ¶æ¡ä»¶çš„æ·»åŠ ï¼ˆæ¯”å¦‚ï¼Œ_setLegs_ï¼‰ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦é¿å…ç”¨æˆ·å†ä½¿ç”¨ `å¯¹è±¡.å±æ€§` çš„æ–¹å¼å¯¹å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œåˆ™éœ€è¦å°†å±æ€§å£°æ˜ä¸ºç§æœ‰çš„ï¼ˆ_private_ï¼‰ã€‚

```java
	private int legs;// è…¿çš„ä¸ªæ•°

	// å¯¹å±æ€§çš„è®¾ç½®
	public void setLegs(int l){
		if(l>= 0 && l % 2 == 0){
			legs = l;
		}else{
			legs = 0;
			// æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼ˆæš‚æ—¶æ²¡æœ‰è®²ï¼‰
		}
	}

	// å¯¹å±æ€§çš„è·å–
	public int getLegs(){
		return legs;
	}
```

â†’ æ­¤æ—¶ï¼Œé’ˆå¯¹äºå±æ€§å°±ä½“ç°äº†å°è£…æ€§ã€‚
â€‹

### å°è£…æ€§çš„ä½“ç°

â‘  _æˆ‘ä»¬å°†ç±»çš„å±æ€§ç§æœ‰åŒ– (`private`) ï¼ŒåŒæ—¶ï¼Œæä¾›å…¬å…±çš„ (`public`) æ–¹æ³•æ¥è·å– (`getXxx`) å’Œè®¾ç½® (`setXxx`) æ­¤å±æ€§çš„å€¼ã€‚_
â‘¡ ä¸å¯¹å¤–æš´éœ²çš„ç§æœ‰çš„æ–¹æ³•
â‘¢ å•ä¾‹æ¨¡å¼ï¼ˆå°†æ„é€ å™¨ç§æœ‰åŒ–ï¼‰
â‘£ å¦‚æœä¸å¸Œæœ›ç±»åœ¨åŒ…å¤–è¢«è°ƒç”¨ï¼Œå¯ä»¥å°†ç±»è®¾ç½®ä¸ºç¼ºçœçš„ã€‚
â€‹

> [!warning]
> å°è£…æ€§çš„ä½“ç°ï¼Œéœ€è¦æƒé™ä¿®é¥°ç¬¦æ¥é…åˆ

1. Java è§„å®šçš„ 4 ç§æƒé™ï¼ˆä»å°åˆ°å¤§æ’åˆ—ï¼‰ï¼Œ_private_ â†’ _ç¼ºçœ_ â†’ _protected_ â†’ _public_
2. 4 ç§æƒé™å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»åŠç±»çš„å†…éƒ¨ç»“æ„ï¼šå±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€å†…éƒ¨ç±»

> [!important]
> ä¿®é¥°ç±»çš„è¯ï¼Œåªèƒ½ä½¿ç”¨ï¼šç¼ºçœã€ _public_

Java æä¾›äº† 4 ä¸­æƒé™ä¿®é¥°ç¬¦æ¥ä¿®é¥°ç±»åŠç±»çš„å†…éƒ¨ç»“æ„ï¼Œä½“ç°ç±»åŠç±»çš„å†…éƒ¨ç»“æ„åœ¨è¢«è°ƒç”¨æ—¶çš„å¯è§æ€§çš„å¤§å°ã€‚

![](assets/SE0409.png)

### ä¸ºä»€ä¹ˆéœ€è¦å°è£…ï¼Ÿå°è£…çš„ä½œç”¨å’Œå«ä¹‰ï¼Ÿ

- æˆ‘ä»¬ç¨‹åºè®¾è®¡è¿½æ±‚ **_â€œé«˜å†…èšï¼Œä½è€¦åˆâ€_** ã€‚
  - _é«˜å†…èš_ ï¼šç±»çš„å†…éƒ¨æ•°æ®æ“ä½œç»†èŠ‚è‡ªå·±å®Œæˆï¼Œä¸å…è®¸å¤–éƒ¨å¹²æ¶‰ï¼›
  - _ä½è€¦åˆ_ ï¼šä»…å¯¹å¤–æš´éœ²å°‘é‡çš„æ–¹æ³•ç”¨äºä½¿ç”¨ï¼›
- éšè—å¯¹è±¡å†…éƒ¨çš„å¤æ‚æ€§ï¼Œåªå¯¹å¤–å…¬å¼€ç®€å•çš„æ¥å£ã€‚
- ä¾¿äºå¤–ç•Œè°ƒç”¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚
  - é€šä¿—çš„è¯´ï¼ŒæŠŠè¯¥éšè—çš„éšè—èµ·æ¥ï¼Œè¯¥æš´éœ²çš„æš´éœ²å‡ºæ¥ã€‚è¿™å°±æ˜¯å°è£…æ€§çš„è®¾è®¡æ€æƒ³ã€‚

## ğŸ€ ç»§æ‰¿æ€§ï¼ˆinheritanceï¼‰

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº† `Person` ç±»ï¼š

```java
class Person {
    private String name;
    private int age;

    public String getName() {...}
    public void setName(String name) {...}
    public int getAge() {...}
    public void setAge(int age) {...}
}
```

ç°åœ¨ï¼Œå‡è®¾éœ€è¦å®šä¹‰ä¸€ä¸ª `Student` ç±»ï¼Œå­—æ®µå¦‚ä¸‹ï¼š

```java
class Student {
    private String name;
    private int age;
    private int score;

    public String getName() {...}
    public void setName(String name) {...}
    public int getAge() {...}
    public void setAge(int age) {...}
    public int getScore() {...}
    public void setScore(int score) {...}
}
```

ä»”ç»†è§‚å¯Ÿï¼Œå‘ç° `Student` ç±»åŒ…å«äº† `Person` ç±»å·²æœ‰çš„å­—æ®µå’Œæ–¹æ³•ï¼Œåªæ˜¯å¤šå‡ºäº†ä¸€ä¸ª `score` å­—æ®µå’Œç›¸åº”çš„ `getScore()`ã€`setScore()` æ–¹æ³•ã€‚

èƒ½ä¸èƒ½åœ¨ `Student` ä¸­ä¸è¦å†™é‡å¤çš„ä»£ç ï¼Ÿ

è¿™ä¸ªæ—¶å€™ï¼Œç»§æ‰¿å°±æ´¾ä¸Šç”¨åœºäº†ã€‚

ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­éå¸¸å¼ºå¤§çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒé¦–å…ˆå¯ä»¥ **_å¤ç”¨ä»£ç _** ã€‚å½“æˆ‘ä»¬è®© `Student` ä» `Person` ç»§æ‰¿æ—¶ï¼Œ`Student` å°±è·å¾—äº† `Person` çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸º `Student` ç¼–å†™æ–°å¢çš„åŠŸèƒ½ã€‚

Java ä½¿ç”¨ `extends` å…³é”®å­—æ¥å®ç°ç»§æ‰¿ï¼š

```java
class Person {
    private String name;
    private int age;

    public String getName() {...}
    public void setName(String name) {...}
    public int getAge() {...}
    public void setAge(int age) {...}
}

class Student extends Person {
    // ä¸è¦é‡å¤ name å’Œ age å­—æ®µ / æ–¹æ³•,
    // åªéœ€è¦å®šä¹‰æ–°å¢ score å­—æ®µ / æ–¹æ³•:
    private int score;

    public int getScore() { â€¦}
    public void setScore(int score) { â€¦ }
}
```

å¯è§ï¼Œé€šè¿‡ç»§æ‰¿ï¼Œ`Student` åªéœ€è¦ç¼–å†™é¢å¤–çš„åŠŸèƒ½ï¼Œä¸å†éœ€è¦é‡å¤ä»£ç ã€‚

> [!caution]
> å­ç±»è‡ªåŠ¨è·å¾—äº†çˆ¶ç±»çš„æ‰€æœ‰å­—æ®µï¼Œ_ä¸¥ç¦å®šä¹‰ä¸çˆ¶ç±»é‡åçš„å­—æ®µ_ï¼

åœ¨ OOP çš„æœ¯è¯­ä¸­ï¼Œæˆ‘ä»¬æŠŠ `Person` ç§°ä¸ºè¶…ç±»ï¼ˆ_super class_ï¼‰ï¼Œçˆ¶ç±»ï¼ˆ_parent class_ï¼‰ï¼ŒåŸºç±»ï¼ˆ_base class_ï¼‰ï¼ŒæŠŠ `Student` ç§°ä¸ºå­ç±»ï¼ˆ_subclass_ï¼‰ï¼Œæ‰©å±•ç±»ï¼ˆ_extended class_ï¼‰ã€‚

### ç»§æ‰¿æ ‘

æ³¨æ„åˆ°æˆ‘ä»¬åœ¨å®šä¹‰ `Person` çš„æ—¶å€™ï¼Œæ²¡æœ‰å†™ `extends` ã€‚

1. å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„å£°æ˜ä¸€ä¸ªç±»çš„çˆ¶ç±»çš„è¯ï¼Œåˆ™æ­¤ç±»ç»§æ‰¿äº `java.lang.Object` ç±»
2. æ‰€æœ‰çš„ Java ç±»ï¼ˆé™¤ `java.lang.Object` ç±»ä¹‹å¤–ï¼‰éƒ½ç›´æ¥ / é—´æ¥çš„ç»§æ‰¿äº `java.lang.Object` ç±»
3. æ„å‘³ç€ï¼Œæ‰€æœ‰çš„ Java ç±»å…·æœ‰ `java.lang.Object` ç±»å£°æ˜çš„åŠŸèƒ½ã€‚

åœ¨ Java ä¸­ï¼Œæ²¡æœ‰æ˜ç¡®å†™ `extends` çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Š `extends Object` ã€‚æ‰€ä»¥ï¼Œä»»ä½•ç±»ï¼Œé™¤äº† `Object`ï¼Œéƒ½ä¼šç»§æ‰¿è‡ªæŸä¸ªç±»ã€‚ä¸‹å›¾æ˜¯ `Person`ã€`Student` çš„ç»§æ‰¿æ ‘ï¼š

![](assets/202206081057611.png)

Java åªå…è®¸ä¸€ä¸ª `class` ç»§æ‰¿è‡ªä¸€ä¸ªç±»ï¼Œå› æ­¤ï¼Œä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªçˆ¶ç±»ã€‚åªæœ‰ `Object` ç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰çˆ¶ç±»ã€‚

ç±»ä¼¼çš„ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª `Person` çš„ `Teacher`ï¼Œå®ƒä»¬çš„ç»§æ‰¿æ ‘å…³ç³»å¦‚ä¸‹ï¼š

![](assets/202206081058906.png)

### protected

ç»§æ‰¿æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯ **_å­ç±»æ— æ³•è®¿é—®çˆ¶ç±»çš„ `private` å­—æ®µæˆ–è€… `private` æ–¹æ³•_** ã€‚ä¾‹å¦‚ï¼Œ`Student` ç±»å°±æ— æ³•è®¿é—® `Person` ç±»çš„ `name` å’Œ `age` å­—æ®µï¼š

```java
class Person {
    private String name;
    private int age;
}

class Student extends Person {
    public String hello() {
        return "Hello," + name; // ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•è®¿é—® name å­—æ®µ
    }
}
```

è¿™ä½¿å¾—ç»§æ‰¿çš„ä½œç”¨è¢«å‰Šå¼±äº†ã€‚ä¸ºäº†è®©å­ç±»å¯ä»¥è®¿é—®çˆ¶ç±»çš„å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦æŠŠ `private` æ”¹ä¸º `protected` ã€‚**_ç”¨ `protected` ä¿®é¥°çš„å­—æ®µå¯ä»¥è¢«å­ç±»è®¿é—®_** ï¼š

```java
class Person {
    protected String name;
    protected int age;
}

class Student extends Person {
    public String hello() {
        return "Hello," + name; // OK!
    }
}
```

å› æ­¤ï¼Œ`protected` å…³é”®å­—å¯ä»¥æŠŠå­—æ®µå’Œæ–¹æ³•çš„è®¿é—®æƒé™æ§åˆ¶åœ¨ç»§æ‰¿æ ‘å†…éƒ¨ï¼Œä¸€ä¸ª `protected` å­—æ®µå’Œæ–¹æ³•å¯ä»¥è¢«å…¶å­ç±»ï¼Œä»¥åŠå­ç±»çš„å­ç±»æ‰€è®¿é—®ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šè¯¦ç»†è®²è§£ã€‚

### super

`super` å…³é”®å­—è¡¨ç¤ºçˆ¶ç±»ï¼ˆè¶…ç±»ï¼‰ã€‚å­ç±»å¼•ç”¨çˆ¶ç±»çš„å­—æ®µæ—¶ï¼Œå¯ä»¥ç”¨ `super.fieldName` ã€‚ä¾‹å¦‚ï¼š

```java
class Student extends Person {
    public String hello() {
        return "Hello," + super.name;
    }
}
```

å®é™…ä¸Šï¼Œè¿™é‡Œä½¿ç”¨ `super.name`ï¼Œæˆ–è€… `this.name`ï¼Œæˆ–è€… `name`ï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å®šä½åˆ°çˆ¶ç±»çš„ `name` å­—æ®µã€‚

ä½†æ˜¯ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œå°±å¿…é¡»ä½¿ç”¨ `super` ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Student s = new Student("Xiao Ming", 12, 89);
    }
}

class Person {
    protected String name;
    protected int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
}

class Student extends Person {
    protected int score;

    public Student(String name, int age, int score) {
        this.score = score;
    }
}
```

è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå¤§æ„æ˜¯åœ¨ `Student` çš„æ„é€ æ–¹æ³•ä¸­ï¼Œæ— æ³•è°ƒç”¨ `Person` çš„æ„é€ æ–¹æ³•ã€‚

è¿™æ˜¯å› ä¸ºåœ¨ Java ä¸­ï¼Œä»»ä½• `class` çš„æ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€è¡Œè¯­å¥å¿…é¡»æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®åœ°è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åŠ ä¸€å¥ `super();`ï¼Œæ‰€ä»¥ï¼Œ`Student` ç±»çš„æ„é€ æ–¹æ³•å®é™…ä¸Šæ˜¯è¿™æ ·ï¼š

```java
class Student extends Person {
    protected int score;

    public Student(String name, int age, int score) {
        super(); // è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•
        this.score = score;
    }
}
```

ä½†æ˜¯ï¼Œ`Person` ç±»å¹¶æ²¡æœ‰æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå› æ­¤ï¼Œç¼–è¯‘å¤±è´¥ã€‚

è§£å†³æ–¹æ³•æ˜¯è°ƒç”¨ `Person` ç±»å­˜åœ¨çš„æŸä¸ªæ„é€ æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
class Student extends Person {
    protected int score;

    public Student(String name, int age, int score) {
        super(name, age); // è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³• Person(String, int)
        this.score = score;
    }
}
```

è¿™æ ·å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘äº†ï¼

å› æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼š **_å¦‚æœçˆ¶ç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå­ç±»å°±å¿…é¡»æ˜¾å¼è°ƒç”¨ `super()` å¹¶ç»™å‡ºå‚æ•°ä»¥ä¾¿è®©ç¼–è¯‘å™¨å®šä½åˆ°çˆ¶ç±»çš„ä¸€ä¸ªåˆé€‚çš„æ„é€ æ–¹æ³•_** ã€‚

è¿™é‡Œè¿˜é¡ºå¸¦å¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå³ **_å­ç±»ä¸ä¼šç»§æ‰¿ä»»ä½•çˆ¶ç±»çš„æ„é€ æ–¹æ³•_** ã€‚å­ç±»é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯ç»§æ‰¿çš„ã€‚

### é˜»æ­¢ç»§æ‰¿ \*

æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦æŸä¸ª `class` æ²¡æœ‰ `final` ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆä»»ä½•ç±»éƒ½å¯ä»¥ä»è¯¥ `class` ç»§æ‰¿ã€‚

> [!important]
> ä» Java 15 å¼€å§‹ï¼Œå…è®¸ä½¿ç”¨ `sealed` ä¿®é¥° `class`ï¼Œå¹¶é€šè¿‡ `permits` æ˜ç¡®å†™å‡ºèƒ½å¤Ÿä»è¯¥ `class` ç»§æ‰¿çš„å­ç±»åç§°ã€‚

ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª `Shape` ç±»ï¼š

```java
public sealed class Shape permits Rect, Circle, Triangle {
    ...
}
```

ä¸Šè¿° `Shape` ç±»å°±æ˜¯ä¸€ä¸ª `sealed` ç±»ï¼Œå®ƒåªå…è®¸æŒ‡å®šçš„ 3 ä¸ªç±»ç»§æ‰¿å®ƒã€‚å¦‚æœå†™ï¼š

```java
public final class Rect extends Shape {...}
```

æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸º `Rect` å‡ºç°åœ¨ `Shape` çš„ `permits` åˆ—è¡¨ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®šä¹‰ä¸€ä¸ª `Ellipse` å°±ä¼šæŠ¥é”™ï¼š

```java
public final class Ellipse extends Shape {...}
// Compile error: class is not allowed to extend sealed class: Shape
```

åŸå› æ˜¯ `Ellipse` å¹¶æœªå‡ºç°åœ¨ `Shape` çš„ `permits` åˆ—è¡¨ä¸­ã€‚è¿™ç§ `sealed` ç±»ä¸»è¦ç”¨äºä¸€äº›æ¡†æ¶ï¼Œé˜²æ­¢ç»§æ‰¿è¢«æ»¥ç”¨ã€‚

`sealed` ç±»åœ¨ Java 15 ä¸­ç›®å‰æ˜¯é¢„è§ˆçŠ¶æ€ï¼Œè¦å¯ç”¨å®ƒï¼Œå¿…é¡»ä½¿ç”¨å‚æ•° `--enable-preview` å’Œ `--source 15` ã€‚

### å‘ä¸Šè½¬å‹

å¦‚æœä¸€ä¸ªå¼•ç”¨å˜é‡çš„ç±»å‹æ˜¯ `Student`ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æŒ‡å‘ä¸€ä¸ª `Student` ç±»å‹çš„å®ä¾‹ï¼š

```java
    Student s = new Student();
```

å¦‚æœä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡æ˜¯ `Person`ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æŒ‡å‘ä¸€ä¸ª `Person` ç±»å‹çš„å®ä¾‹ï¼š

```java
    Person p = new Person();
```

ç°åœ¨é—®é¢˜æ¥äº†ï¼šå¦‚æœ `Student` æ˜¯ä» `Person` ç»§æ‰¿ä¸‹æ¥çš„ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªå¼•ç”¨ç±»å‹ä¸º `Person` çš„å˜é‡ï¼Œèƒ½å¦æŒ‡å‘ `Student` ç±»å‹çš„å®ä¾‹ï¼Ÿ

```java
    Person p = new Student(); // ???
```

æµ‹è¯•ä¸€ä¸‹å°±å¯ä»¥å‘ç°ï¼Œè¿™ç§æŒ‡å‘æ˜¯å…è®¸çš„ï¼

è¿™æ˜¯å› ä¸º `Student` ç»§æ‰¿è‡ª `Person`ï¼Œå› æ­¤ï¼Œå®ƒæ‹¥æœ‰ `Person` çš„å…¨éƒ¨åŠŸèƒ½ã€‚`Person` ç±»å‹çš„å˜é‡ï¼Œå¦‚æœæŒ‡å‘ `Student` ç±»å‹çš„å®ä¾‹ï¼Œå¯¹å®ƒè¿›è¡Œæ“ä½œï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼

è¿™ç§ _æŠŠä¸€ä¸ªå­ç±»ç±»å‹å®‰å…¨åœ°å˜ä¸ºçˆ¶ç±»ç±»å‹çš„èµ‹å€¼_ ï¼Œè¢«ç§°ä¸º **_å‘ä¸Šè½¬å‹_** ï¼ˆ_upcasting_ï¼‰ã€‚

å‘ä¸Šè½¬å‹å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ªå­ç±»å‹å®‰å…¨åœ°å˜ä¸ºæ›´åŠ æŠ½è±¡çš„çˆ¶ç±»å‹ï¼š

```java
    Student s = new Student();
    Person p = s; // upcasting, ok
    Object o1 = p; // upcasting, ok
    Object o2 = s; // upcasting, ok
```

æ³¨æ„åˆ°ç»§æ‰¿æ ‘æ˜¯ $Student > Person > Object$ ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥æŠŠ `Student` ç±»å‹è½¬å‹ä¸º `Person`ï¼Œæˆ–è€…æ›´é«˜å±‚æ¬¡çš„ `Object` ã€‚

### å‘ä¸‹è½¬å‹

å’Œå‘ä¸Šè½¬å‹ç›¸åï¼Œå¦‚æœæŠŠä¸€ä¸ªçˆ¶ç±»ç±»å‹å¼ºåˆ¶è½¬å‹ä¸ºå­ç±»ç±»å‹ï¼Œå°±æ˜¯å‘ä¸‹è½¬å‹ï¼ˆ_downcasting_ï¼‰ã€‚ä¾‹å¦‚ï¼š

```java
    Person p1 = new Student(); // upcasting, ok
    Person p2 = new Person();
    Student s1 = (Student) p1; // ok
    Student s2 = (Student) p2; // runtime error! ClassCastException!
```

å¦‚æœæµ‹è¯•ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°ï¼š

`Person` ç±»å‹ `p1` å®é™…æŒ‡å‘ `Student` å®ä¾‹ï¼Œ`Person` ç±»å‹å˜é‡ `p2` å®é™…æŒ‡å‘ `Person` å®ä¾‹ã€‚åœ¨å‘ä¸‹è½¬å‹çš„æ—¶å€™ï¼ŒæŠŠ `p1` è½¬å‹ä¸º `Student` ä¼šæˆåŠŸï¼Œå› ä¸º `p1` ç¡®å®æŒ‡å‘ `Student` å®ä¾‹ï¼ŒæŠŠ `p2` è½¬å‹ä¸º `Student` ä¼šå¤±è´¥ï¼Œå› ä¸º `p2` çš„å®é™…ç±»å‹æ˜¯ `Person`ï¼Œä¸èƒ½æŠŠçˆ¶ç±»å˜ä¸ºå­ç±»ï¼Œå› ä¸ºå­ç±»åŠŸèƒ½æ¯”çˆ¶ç±»å¤šï¼Œå¤šçš„åŠŸèƒ½æ— æ³•å‡­ç©ºå˜å‡ºæ¥ã€‚

å› æ­¤ï¼Œå‘ä¸‹è½¬å‹å¾ˆå¯èƒ½ä¼šå¤±è´¥ã€‚å¤±è´¥çš„æ—¶å€™ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠ¥ `ClassCastException` ã€‚

ä¸ºäº†é¿å…å‘ä¸‹è½¬å‹å‡ºé”™ï¼ŒJava æä¾›äº† `instanceof` æ“ä½œç¬¦ï¼Œå¯ä»¥å…ˆåˆ¤æ–­ä¸€ä¸ªå®ä¾‹ç©¶ç«Ÿæ˜¯ä¸æ˜¯æŸç§ç±»å‹ï¼š

```java
    Person p = new Person();
    System.out.println(p instanceof Person); // true
    System.out.println(p instanceof Student); // false

    Student s = new Student();
    System.out.println(s instanceof Person); // true
    System.out.println(s instanceof Student); // true

    Student n = null;
    System.out.println(n instanceof Student); // false
```

`instanceof` å®é™…ä¸Šåˆ¤æ–­ä¸€ä¸ªå˜é‡æ‰€æŒ‡å‘çš„å®ä¾‹æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹ï¼Œæˆ–è€…è¿™ä¸ªç±»å‹çš„å­ç±»ã€‚å¦‚æœä¸€ä¸ªå¼•ç”¨å˜é‡ä¸º `null`ï¼Œé‚£ä¹ˆå¯¹ä»»ä½• `instanceof` çš„åˆ¤æ–­éƒ½ä¸º `falseã€‚`

åˆ©ç”¨ `instanceof`ï¼Œåœ¨å‘ä¸‹è½¬å‹å‰å¯ä»¥å…ˆåˆ¤æ–­ï¼š

```java
    Person p = new Student();
    if (p instanceof Student) {
        // åªæœ‰åˆ¤æ–­æˆåŠŸæ‰ä¼šå‘ä¸‹è½¬å‹:
        Student s = (Student) p; // ä¸€å®šä¼šæˆåŠŸ
    }
```

> [!important]
> ä» Java 14 å¼€å§‹ï¼Œåˆ¤æ–­ `instanceof` åï¼Œå¯ä»¥ç›´æ¥è½¬å‹ä¸ºæŒ‡å®šå˜é‡ï¼Œé¿å…å†æ¬¡å¼ºåˆ¶è½¬å‹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹ä»£ç ï¼š

```java
    Object obj = "hello";
    if (obj instanceof String) {
        String s = (String) obj;
        System.out.println(s.toUpperCase());
    }
```

å¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Object obj = "hello";
        if (obj instanceof String s) {
            // å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡ s:
            System.out.println(s.toUpperCase());
        }
    }
}
```

è¿™ç§ä½¿ç”¨ `instanceof` çš„å†™æ³•æ›´åŠ ç®€æ´ã€‚

### åŒºåˆ†ç»§æ‰¿å’Œç»„åˆ

åœ¨ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œæˆ‘ä»¬è¦æ³¨æ„é€»è¾‘ä¸€è‡´æ€§ã€‚

è€ƒå¯Ÿä¸‹é¢çš„ `Book` ç±»ï¼š

```java
class Book {
    protected String name;
    public String getName() {...}
    public void setName(String name) {...}
}
```

è¿™ä¸ª `Book` ç±»ä¹Ÿæœ‰ `name` å­—æ®µï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½è®© `Student` ç»§æ‰¿è‡ª `Book` å‘¢ï¼Ÿ

```java
class Student extends Book {
    protected int score;
}
```

æ˜¾ç„¶ï¼Œä»é€»è¾‘ä¸Šè®²ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œ`Student` ä¸åº”è¯¥ä» `Book` ç»§æ‰¿ï¼Œè€Œåº”è¯¥ä» `Person` ç»§æ‰¿ã€‚

ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸º `Student` æ˜¯ `Person` çš„ä¸€ç§ï¼Œå®ƒä»¬æ˜¯ `is` å…³ç³»ï¼Œè€Œ `Student` å¹¶ä¸æ˜¯ `Book` ã€‚å®é™…ä¸Š `Student` å’Œ `Book` çš„å…³ç³»æ˜¯ has å…³ç³»ã€‚

å…·æœ‰ has å…³ç³»ä¸åº”è¯¥ä½¿ç”¨ç»§æ‰¿ï¼Œè€Œæ˜¯ä½¿ç”¨ç»„åˆï¼Œå³ `Student` å¯ä»¥æŒæœ‰ä¸€ä¸ª `Book` å®ä¾‹ï¼š

```java
class Student extends Person {
    protected Book book;
    protected int score;
}
```

å› æ­¤ï¼Œç»§æ‰¿æ˜¯ `is` å…³ç³»ï¼Œç»„åˆæ˜¯ `has` å…³ç³»ã€‚

### ç»ƒä¹ 

å®šä¹‰ `PrimaryStudent`ï¼Œä» `Student` ç»§æ‰¿ï¼Œå¹¶æ–°å¢ä¸€ä¸ª `grade` å­—æ®µï¼š

```java
public class PrimaryStudentTest {
    public static void main(String[] args) {
        PersonD p = new PersonD("å°æ˜", 12);
        StudentD s = new StudentD("å°çº¢", 20, 99);
        // TODO: å®šä¹‰ PrimaryStudentï¼Œä» Student ç»§æ‰¿ï¼Œæ–°å¢ grade å­—æ®µ:
        StudentD ps = new PrimaryStudent("å°å†›", 9, 100, 5);
        System.out.println(ps.getScore());
    }
}

class PersonD {
    protected String name;
    protected int age;

    public PersonD(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() { return name;}
    public void setName(String name) { this.name = name; }

    public int getAge() { return age;}
    public void setAge(int age) { this.age = age; }
}

class StudentD extends PersonD {
    protected int score;

    public StudentD(String name, int age, int score) {
        super(name, age);
        this.score = score;
    }

    public int getScore() { return score;}
}

class PrimaryStudent extends StudentD {
    // TODO
    protected int grade;

    public PrimaryStudent(String name, int age, int score, int grade) {
        super(name, age, score);
        this.grade = grade;
    }
}
```

### å°ç»“

- ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§å¼ºå¤§çš„ä»£ç å¤ç”¨æ–¹å¼ï¼›
- Java åªå…è®¸å•ç»§æ‰¿ï¼Œæ‰€æœ‰ç±»æœ€ç»ˆçš„æ ¹ç±»æ˜¯ `Object` ï¼›
- `protected` å…è®¸å­ç±»è®¿é—®çˆ¶ç±»çš„å­—æ®µå’Œæ–¹æ³•ï¼›
- å­ç±»çš„æ„é€ æ–¹æ³•å¯ä»¥é€šè¿‡ `super()` è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼›
- å¯ä»¥å®‰å…¨åœ°å‘ä¸Šè½¬å‹ä¸ºæ›´æŠ½è±¡çš„ç±»å‹ï¼›
- å¯ä»¥å¼ºåˆ¶å‘ä¸‹è½¬å‹ï¼Œæœ€å¥½å€ŸåŠ© `instanceof` åˆ¤æ–­ï¼›
- å­ç±»å’Œçˆ¶ç±»çš„å…³ç³»æ˜¯ `is`ï¼Œ`has` å…³ç³»ä¸èƒ½ç”¨ç»§æ‰¿ã€‚

#### ç»§æ‰¿æ€§çš„å¥½å¤„ï¼š

â‘  å‡å°‘äº†ä»£ç çš„å†—ä½™ï¼Œæé«˜äº†ä»£ç çš„å¤ç”¨æ€§
â‘¡ ä¾¿äºåŠŸèƒ½çš„æ‰©å±•
â‘¢ ä¸ºä¹‹åå¤šæ€æ€§çš„ä½¿ç”¨ï¼Œæä¾›äº†å‰æ

#### å­ç±»ç»§æ‰¿çˆ¶ç±»åæœ‰å“ªäº›ä¸åŒï¼Ÿ

1. ä½“ç°ï¼šä¸€æ—¦å­ç±» A ç»§æ‰¿çˆ¶ç±» B ä»¥åï¼Œå­ç±» A ä¸­å°±è·å–äº†çˆ¶ç±» B ä¸­å£°æ˜çš„æ‰€æœ‰çš„å±æ€§ã€æ–¹æ³•ã€‚
   - ç‰¹åˆ«çš„ï¼Œçˆ¶ç±»ä¸­å£°æ˜ä¸º `private` çš„å±æ€§æˆ–æ–¹æ³•ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»ä»¥åï¼Œä»ç„¶è®¤ä¸º _è·å–äº†çˆ¶ç±»ä¸­ç§æœ‰çš„ç»“æ„_ ï¼Œåªå› ä¸ºå°è£…æ€§çš„å½±å“ï¼Œä½¿å¾—å­ç±»ä¸èƒ½ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„ç»“æ„è€Œå·²ã€‚
2. å­ç±»ç»§æ‰¿çˆ¶ç±»ä»¥åï¼Œè¿˜å¯ä»¥ _å£°æ˜è‡ªå·±ç‰¹æœ‰çš„å±æ€§æˆ–æ–¹æ³•_ ï¼Œå®ç°åŠŸèƒ½çš„æ‹“å±•ã€‚

#### Java ä¸­å…³äºç»§æ‰¿æ€§çš„è§„å®š

1. ä¸€ä¸ªç±»å¯ä»¥è¢«å¤šä¸ªå­ç±»ç»§æ‰¿ï¼›
2. Java ä¸­ç±»çš„å•ç»§æ‰¿æ€§ï¼šä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼›
3. å­çˆ¶ç±»æ˜¯ç›¸å¯¹çš„æ¦‚å¿µï¼ˆå¤šå±‚ç»§æ‰¿ï¼‰ï¼›
4. å­ç±»ç›´æ¥ç»§æ‰¿çš„çˆ¶ç±»ï¼šç›´æ¥çˆ¶ç±»ï¼›å­ç±»é—´æ¥ç»§æ‰¿çš„çˆ¶ç±»ï¼šé—´æ¥çˆ¶ç±»ï¼›
5. å­ç±»ç»§æ‰¿çˆ¶ç±»ä»¥åï¼Œå°±è·å–äº†ç›´æ¥çˆ¶ç±»ä»¥åŠæ‰€æœ‰é—´æ¥çˆ¶ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚

## ğŸ€ å¤šæ€æ€§(Polymorphic)

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¼•ç”¨å˜é‡çš„å£°æ˜ç±»å‹å¯èƒ½ä¸å…¶å®é™…ç±»å‹ä¸ç¬¦ï¼Œä¾‹å¦‚ï¼š

```java
    Person p = new Student();
```

ç°åœ¨ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Person p = new Student();
        p.run(); // åº”è¯¥æ‰“å° Person.run è¿˜æ˜¯ Student.run?
    }
}

class Person {
    public void run() {
        System.out.println("Person.run");
    }
}

class Student extends Person {
    @Override
    public void run() {
        System.out.println("Student.run");
    }
}
```

é‚£ä¹ˆï¼Œä¸€ä¸ªå®é™…ç±»å‹ä¸º `Student`ï¼Œå¼•ç”¨ç±»å‹ä¸º `Person` çš„å˜é‡ï¼Œè°ƒç”¨å…¶ `run()` æ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯ `Person` è¿˜æ˜¯ `Student` çš„ `run()` æ–¹æ³•ï¼Ÿ

è¿è¡Œä¸€ä¸‹ä¸Šé¢çš„ä»£ç å°±å¯ä»¥çŸ¥é“ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ–¹æ³•æ˜¯ `Student` çš„ `run()` æ–¹æ³•ã€‚å› æ­¤å¯å¾—å‡ºç»“è®ºï¼š

Java çš„å®ä¾‹æ–¹æ³•è°ƒç”¨æ˜¯åŸºäºè¿è¡Œæ—¶çš„å®é™…ç±»å‹çš„åŠ¨æ€è°ƒç”¨ï¼Œè€Œéå˜é‡çš„å£°æ˜ç±»å‹ã€‚

è¿™ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ç§°ä¹‹ä¸ºå¤šæ€ã€‚å®ƒçš„è‹±æ–‡æ‹¼å†™éå¸¸å¤æ‚ï¼š **_Polymorphic_** ã€‚

### å®šä¹‰

å¤šæ€æ˜¯æŒ‡ï¼Œ**_é’ˆå¯¹æŸä¸ªç±»å‹çš„æ–¹æ³•è°ƒç”¨ï¼Œå…¶çœŸæ­£æ‰§è¡Œçš„æ–¹æ³•å–å†³äºè¿è¡Œæ—¶æœŸå®é™…ç±»å‹çš„æ–¹æ³•ã€‚_** ä¾‹å¦‚ï¼š

```java
    Person p = new Student();
    p.run(); // æ— æ³•ç¡®å®šè¿è¡Œæ—¶ç©¶ç«Ÿè°ƒç”¨å“ªä¸ª run() æ–¹æ³•
```

æœ‰ç«¥é‹ä¼šé—®ï¼Œä»ä¸Šé¢çš„ä»£ç ä¸€çœ‹å°±æ˜ç™½ï¼Œè‚¯å®šè°ƒç”¨çš„æ˜¯ Student çš„ run() æ–¹æ³•å•Šã€‚

ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬ç¼–å†™è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼š

```java
public void runTwice(Person p) {
    p.run();
    p.run();
}
```

å®ƒä¼ å…¥çš„å‚æ•°ç±»å‹æ˜¯ `Person`ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•çŸ¥é“ä¼ å…¥çš„å‚æ•°å®é™…ç±»å‹ç©¶ç«Ÿæ˜¯ `Person`ï¼Œè¿˜æ˜¯ `Student`ï¼Œè¿˜æ˜¯ `Person` çš„å…¶ä»–å­ç±»ï¼Œå› æ­¤ï¼Œä¹Ÿæ— æ³•ç¡®å®šè°ƒç”¨çš„æ˜¯ä¸æ˜¯ `Person` ç±»å®šä¹‰çš„ `run()` æ–¹æ³•ã€‚

æ‰€ä»¥ï¼Œå¤šæ€çš„ç‰¹æ€§å°±æ˜¯ï¼Œ**_è¿è¡ŒæœŸæ‰èƒ½åŠ¨æ€å†³å®šè°ƒç”¨çš„å­ç±»æ–¹æ³•_** ã€‚å¯¹æŸä¸ªç±»å‹è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œæ‰§è¡Œçš„å®é™…æ–¹æ³•å¯èƒ½æ˜¯æŸä¸ªå­ç±»çš„é‡å†™æ–¹æ³•ã€‚è¿™ç§ä¸ç¡®å®šæ€§çš„æ–¹æ³•è°ƒç”¨ï¼Œç©¶ç«Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

æˆ‘ä»¬è¿˜æ˜¯æ¥ä¸¾æ —å­ã€‚

å‡è®¾æˆ‘ä»¬å®šä¹‰ä¸€ç§æ”¶å…¥ï¼Œéœ€è¦ç»™å®ƒæŠ¥ç¨ï¼Œé‚£ä¹ˆå…ˆå®šä¹‰ä¸€ä¸ª `Income` ç±»ï¼š

```java
class Income {
    protected double income;
    public double getTax() {
        return income * 0.1; // ç¨ç‡ 10%
    }
}
```

å¯¹äºå·¥èµ„æ”¶å…¥ï¼Œå¯ä»¥å‡å»ä¸€ä¸ªåŸºæ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä» `Income` æ´¾ç”Ÿå‡º `SalaryIncome`ï¼Œå¹¶é‡å†™ `getTax()` ï¼š

```java
class Salary extends Income {
    @Override
    public double getTax() {
        if (income <= 5000) {
            return 0;
        }
        return (income - 5000) * 0.2;
    }
}
```

å¦‚æœä½ äº«å—å›½åŠ¡é™¢ç‰¹æ®Šæ´¥è´´ï¼Œé‚£ä¹ˆæŒ‰ç…§è§„å®šï¼Œå¯ä»¥å…¨éƒ¨å…ç¨ï¼š

```java
class StateCouncilSpecialAllowance extends Income {
    @Override
    public double getTax() {
        return 0;
    }
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæŠ¥ç¨çš„è´¢åŠ¡è½¯ä»¶ï¼Œå¯¹äºä¸€ä¸ªäººçš„æ‰€æœ‰æ”¶å…¥è¿›è¡ŒæŠ¥ç¨ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```java
public double totalTax(Income... incomes) {
    double total = 0;
    for (Income income: incomes) {
        total = total + income.getTax();
    }
    return total;
}
```

æ¥è¯•ä¸€ä¸‹ï¼š

```java
// Polymorphic
public class Main {
    public static void main(String[] args) {
        // ç»™ä¸€ä¸ªæœ‰æ™®é€šæ”¶å…¥ã€å·¥èµ„æ”¶å…¥å’Œäº«å—å›½åŠ¡é™¢ç‰¹æ®Šæ´¥è´´çš„å°ä¼™ä¼´ç®—ç¨:
        Income[] incomes = new Income[] {
            new Income(3000),
            new Salary(7500),
            new StateCouncilSpecialAllowance(15000)
        };
        System.out.println(totalTax(incomes));
    }

    public static double totalTax(Income... incomes) {
        double total = 0;
        for (Income income: incomes) {
            total = total + income.getTax();
        }
        return total;
    }
}

class Income {
    protected double income;

    public Income(double income) {
        this.income = income;
    }

    public double getTax() {
        return income * 0.1; // ç¨ç‡ 10%
    }
}

class Salary extends Income {
    public Salary(double income) {
        super(income);
    }

    @Override
    public double getTax() {
        if (income <= 5000) {
            return 0;
        }
        return (income - 5000) * 0.2;
    }
}

class StateCouncilSpecialAllowance extends Income {
    public StateCouncilSpecialAllowance(double income) {
        super(income);
    }

    @Override
    public double getTax() {
        return 0;
    }
}
```

è§‚å¯Ÿ `totalTax()` æ–¹æ³•ï¼šåˆ©ç”¨å¤šæ€ï¼Œ`totalTax()` æ–¹æ³•åªéœ€è¦å’Œ `Income` æ‰“äº¤é“ï¼Œå®ƒå®Œå…¨ä¸éœ€è¦çŸ¥é“ `Salary` å’Œ `StateCouncilSpecialAllowance` çš„å­˜åœ¨ï¼Œå°±å¯ä»¥æ­£ç¡®è®¡ç®—å‡ºæ€»çš„ç¨ã€‚å¦‚æœæˆ‘ä»¬è¦æ–°å¢ä¸€ç§ç¨¿è´¹æ”¶å…¥ï¼Œåªéœ€è¦ä» `Income` æ´¾ç”Ÿï¼Œç„¶åæ­£ç¡®é‡å†™ `getTax()` æ–¹æ³•å°±å¯ä»¥ã€‚æŠŠæ–°çš„ç±»å‹ä¼ å…¥ `totalTax()`ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç ã€‚

å¯è§ï¼Œå¤šæ€å…·æœ‰ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå°±æ˜¯ **_å…è®¸æ·»åŠ æ›´å¤šç±»å‹çš„å­ç±»å®ç°åŠŸèƒ½æ‰©å±•ï¼Œå´ä¸éœ€è¦ä¿®æ”¹åŸºäºçˆ¶ç±»çš„ä»£ç _** ã€‚

### é‡å†™ Object æ–¹æ³•

å› ä¸ºæ‰€æœ‰çš„ `class` æœ€ç»ˆéƒ½ç»§æ‰¿è‡ª `Object`ï¼Œè€Œ `Object` å®šä¹‰äº†å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼š

- `toString()` ï¼šæŠŠ `instance` è¾“å‡ºä¸º `String` ï¼›
- `equals()` ï¼šåˆ¤æ–­ä¸¤ä¸ª `instance` æ˜¯å¦é€»è¾‘ç›¸ç­‰ï¼›
- `hashCode()` ï¼šè®¡ç®—ä¸€ä¸ª `instance` çš„å“ˆå¸Œå€¼ã€‚

åœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™ `Object` çš„è¿™å‡ ä¸ªæ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
class Person {
    ...
    // æ˜¾ç¤ºæ›´æœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²:
    @Override
    public String toString() {
        return "Person:name=" + name;
    }

    // æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰:
    @Override
    public boolean equals(Object o) {
        // å½“ä¸”ä»…å½“ o ä¸º Person ç±»å‹:
        if (o instanceof Person) {
            Person p = (Person) o;
            // å¹¶ä¸” name å­—æ®µç›¸åŒæ—¶ï¼Œè¿”å› true:
            return this.name.equals(p.name);
        }
        return false;
    }

    // è®¡ç®— hash:
    @Override
    public int hashCode() {
        return this.name.hashCode();
    }
}
```

### è°ƒç”¨ super

åœ¨å­ç±»çš„é‡å†™æ–¹æ³•ä¸­ï¼Œå¦‚æœè¦ **_è°ƒç”¨çˆ¶ç±»çš„è¢«é‡å†™çš„æ–¹æ³•_** ï¼Œå¯ä»¥é€šè¿‡ `super` æ¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š

```java
class Person {
    protected String name;
    public String hello() {
        return "Hello," + name;
    }
}

Student extends Person {
    @Override
    public String hello() {
        // è°ƒç”¨çˆ¶ç±»çš„ hello() æ–¹æ³•:
        return super.hello() + "!";
    }
}
```

### final

ç»§æ‰¿å¯ä»¥å…è®¸å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªçˆ¶ç±»ä¸å…è®¸å­ç±»å¯¹å®ƒçš„æŸä¸ªæ–¹æ³•è¿›è¡Œé‡å†™ï¼Œå¯ä»¥æŠŠè¯¥æ–¹æ³•æ ‡è®°ä¸º `final` ã€‚**_ç”¨ `final` ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢« `Override`_** ï¼š

```java
class Person {
    protected String name;
    public final String hello() {
        return "Hello," + name;
    }
}

Student extends Person {
    // compile error: ä¸å…è®¸é‡å†™
    @Override
    public String hello() {
    }
}
```

å¦‚æœä¸€ä¸ªç±»ä¸å¸Œæœ›ä»»ä½•å…¶ä»–ç±»ç»§æ‰¿è‡ªå®ƒï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªç±»æœ¬èº«æ ‡è®°ä¸º `final` ã€‚**_ç”¨ `final` ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿_** ï¼š

```java
final class Person {
    protected String name;
}

// compile error: ä¸å…è®¸ç»§æ‰¿è‡ª Person
Student extends Person {
}
```

å¯¹äºä¸€ä¸ªç±»çš„å®ä¾‹å­—æ®µï¼ŒåŒæ ·å¯ä»¥ç”¨ `final` ä¿®é¥°ã€‚**_ç”¨ `final` ä¿®é¥°çš„å­—æ®µåœ¨åˆå§‹åŒ–åä¸èƒ½è¢«ä¿®æ”¹ã€‚_** ä¾‹å¦‚ï¼š

```java
class Person {
    public final String name = "Unamed";
}
```

å¯¹ `final` å­—æ®µé‡æ–°èµ‹å€¼ä¼šæŠ¥é”™ï¼š

```java
    Person p = new Person();
    p.name = "New Name"; // compile error!
```

å¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ– `final` å­—æ®µï¼š

```java
class Person {
    public final String name;
    public Person(String name) {
        this.name = name;
    }
}
```

è¿™ç§æ–¹æ³•æ›´ä¸ºå¸¸ç”¨ï¼Œå› ä¸º **_å¯ä»¥ä¿è¯å®ä¾‹ä¸€æ—¦åˆ›å»ºï¼Œå…¶ `final` å­—æ®µå°±ä¸å¯ä¿®æ”¹_** ã€‚

### ç»ƒä¹ 

ç»™ä¸€ä¸ªæœ‰å·¥èµ„æ”¶å…¥å’Œç¨¿è´¹æ”¶å…¥çš„å°ä¼™ä¼´ç®—ç¨ã€‚

```java
public class PolymorphicTest {
    public static void main(String[] args) {
        // ç»™ä¸€ä¸ªæœ‰å·¥èµ„æ”¶å…¥å’Œç¨¿è´¹æ”¶å…¥çš„å°ä¼™ä¼´ç®—ç¨:
        Income[] incomes = new Income[] {
                new Salary(8000),
                new RoyaltyIncome(2000)
        };

        Person p = new Person("Frank");
        p.setIncome(incomes);
        double totalTax = p.getTotalTax();
        System.out.printf("%s's total tax is: %.2f", p.getName(), p.getTotalTax());
    }

    public static double totalTax(Income... incomes) {
        double total = 0;
        for (Income income: incomes) {
            total = total + income.getTax();
        }
        return total;
    }
}

class Person {
    protected Income[] incomes;
    protected String name;

    public Person(String name) {
        this.name = name;
    }

    public String getName() {
        return this.name;
    }

    public void setIncome(Income... incomes) {
        this.incomes = incomes;
    }

    public double getTotalTax() {
        double totalTax = 0;

        for (Income income : this.incomes) {
            totalTax += income.getTax();
        }

        return totalTax;
    }
}

class Income {
    protected double income;

    public Income(double income) {
        this.income = income;
    }

    public double getTax() {
        return income * 0.1; // ç¨ç‡ 10%
    }
}

class Salary extends Income {
    public Salary(double income) {
        super(income);
    }

    @Override
    public double getTax() {
        if (income <= 5000) {
            return 0;
        }
        return (income - 5000) * 0.2;
    }
}

class RoyaltyIncome extends Income {
    public RoyaltyIncome(double income) {
        super(income);
    }

    @Override
    public double getTax() {
        return income * 0.2;//ç¨¿è´¹æ”¶å…¥ç¨ç‡æ˜¯20%
    }
}
```

### å°ç»“

- å­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼ˆ_Override_ï¼‰ï¼Œé‡å†™åœ¨å­ç±»ä¸­æ”¹å˜äº†çˆ¶ç±»æ–¹æ³•çš„è¡Œä¸ºï¼›
- Java çš„æ–¹æ³•è°ƒç”¨æ€»æ˜¯ä½œç”¨äºè¿è¡ŒæœŸå¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè¿™ç§è¡Œä¸ºç§°ä¸ºå¤šæ€ï¼›
- `final` ä¿®é¥°ç¬¦æœ‰å¤šç§ä½œç”¨ï¼š
- `final` ä¿®é¥°çš„æ–¹æ³•å¯ä»¥é˜»æ­¢è¢«é‡å†™ï¼›
- `final` ä¿®é¥°çš„ `class` å¯ä»¥é˜»æ­¢è¢«ç»§æ‰¿ï¼›
- `final` ä¿®é¥°çš„ `field` å¿…é¡»åœ¨åˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–ï¼Œéšåä¸å¯ä¿®æ”¹ã€‚
