---
title: InputStream
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


InputStream å°±æ˜¯ Java æ ‡å‡†åº“æä¾›çš„æœ€åŸºæœ¬çš„è¾“å…¥æµã€‚å®ƒä½äº java.io è¿™ä¸ªåŒ…é‡Œã€‚java.io åŒ…æä¾›äº†æ‰€æœ‰åŒæ­¥ IO çš„åŠŸèƒ½ã€‚

è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒInputStream å¹¶ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ã€‚è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯ int read()ï¼Œç­¾åå¦‚ä¸‹ï¼š

```java
public abstract int read() throws IOException;
```

è¿™ä¸ªæ–¹æ³•ä¼šè¯»å–è¾“å…¥æµçš„ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¿”å›å­—èŠ‚è¡¨ç¤ºçš„ int å€¼ï¼ˆ0~255ï¼‰ã€‚å¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å› - 1 è¡¨ç¤ºä¸èƒ½ç»§ç»­è¯»å–äº†ã€‚

FileInputStream æ˜¯ InputStream çš„ä¸€ä¸ªå­ç±»ã€‚é¡¾åæ€ä¹‰ï¼ŒFileInputStream å°±æ˜¯ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•å®Œæ•´åœ°è¯»å–ä¸€ä¸ª FileInputStream çš„æ‰€æœ‰å­—èŠ‚ï¼š

```java
public void readFile() throws IOException {
    // åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡:
    InputStream input = new FileInputStream("src/readme.txt");
    for (;;) {
        int n = input.read(); // åå¤è°ƒç”¨ read() æ–¹æ³•ï¼Œç›´åˆ°è¿”å› - 1
        if (n == -1) {
            break;
        }
        System.out.println(n); // æ‰“å° byte çš„å€¼
    }
    input.close(); // å…³é—­æµ
}
```

åœ¨è®¡ç®—æœºä¸­ï¼Œç±»ä¼¼æ–‡ä»¶ã€ç½‘ç»œç«¯å£è¿™äº›èµ„æºï¼Œéƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿç»Ÿä¸€ç®¡ç†çš„ã€‚åº”ç”¨ç¨‹åºåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œå®Œæˆåè¦åŠæ—¶åœ°å…³é—­ï¼Œä»¥ä¾¿è®©æ“ä½œç³»ç»ŸæŠŠèµ„æºé‡Šæ”¾æ‰ï¼Œå¦åˆ™ï¼Œåº”ç”¨ç¨‹åºå ç”¨çš„èµ„æºä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸ä½†ç™½ç™½å ç”¨å†…å­˜ï¼Œè¿˜ä¼šå½±å“å…¶ä»–åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚

InputStream å’Œ OutputStream éƒ½æ˜¯é€šè¿‡ close() æ–¹æ³•æ¥å…³é—­æµã€‚å…³é—­æµå°±ä¼šé‡Šæ”¾å¯¹åº”çš„åº•å±‚èµ„æºã€‚

æˆ‘ä»¬è¿˜è¦æ³¨æ„åˆ°åœ¨è¯»å–æˆ–å†™å…¥ IO æµçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚ï¼Œæ–‡ä»¶ä¸å­˜åœ¨å¯¼è‡´æ— æ³•è¯»å–ï¼Œæ²¡æœ‰å†™æƒé™å¯¼è‡´å†™å…¥å¤±è´¥ï¼Œç­‰ç­‰ï¼Œè¿™äº›åº•å±‚é”™è¯¯ç”± Java è™šæ‹Ÿæœºè‡ªåŠ¨å°è£…æˆ IOException å¼‚å¸¸å¹¶æŠ›å‡ºã€‚å› æ­¤ï¼Œæ‰€æœ‰ä¸ IO æ“ä½œç›¸å…³çš„ä»£ç éƒ½å¿…é¡»æ­£ç¡®å¤„ç† IOExceptionã€‚

ä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç ï¼Œä¼šå‘ç°ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼šå¦‚æœè¯»å–è¿‡ç¨‹ä¸­å‘ç”Ÿäº† IO é”™è¯¯ï¼ŒInputStream å°±æ²¡æ³•æ­£ç¡®åœ°å…³é—­ï¼Œèµ„æºä¹Ÿå°±æ²¡æ³•åŠæ—¶é‡Šæ”¾ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ try ... finally æ¥ä¿è¯ InputStream åœ¨æ— è®ºæ˜¯å¦å‘ç”Ÿ IO é”™è¯¯çš„æ—¶å€™éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­ï¼š

```java
public void readFile() throws IOException {
    InputStream input = null;
    try {
        input = new FileInputStream("src/readme.txt");
        int n;
        while ((n = input.read()) != -1) { // åˆ©ç”¨ while åŒæ—¶è¯»å–å¹¶åˆ¤æ–­
            System.out.println(n);
        }
    } finally {
        if (input != null) { input.close(); }
    }
}
```

ç”¨ try ... finally æ¥ç¼–å†™ä¸Šè¿°ä»£ç ä¼šæ„Ÿè§‰æ¯”è¾ƒå¤æ‚ï¼Œæ›´å¥½çš„å†™æ³•æ˜¯åˆ©ç”¨ Java 7 å¼•å…¥çš„æ–°çš„ try(resource) çš„è¯­æ³•ï¼Œåªéœ€è¦ç¼–å†™ try è¯­å¥ï¼Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬å…³é—­èµ„æºã€‚æ¨èçš„å†™æ³•å¦‚ä¸‹ï¼š

```java
public void readFile() throws IOException {
    try (InputStream input = new FileInputStream("src/readme.txt")) {
        int n;
        while ((n = input.read()) != -1) {
            System.out.println(n);
        }
    } // ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥ finally å¹¶è°ƒç”¨ close()
}
```


å®é™…ä¸Šï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šç‰¹åˆ«åœ°ä¸º InputStream åŠ ä¸Šè‡ªåŠ¨å…³é—­ã€‚ç¼–è¯‘å™¨åªçœ‹ try(resource = ...) ä¸­çš„å¯¹è±¡æ˜¯å¦å®ç°äº† java.lang.AutoCloseable æ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°±è‡ªåŠ¨åŠ ä¸Š finally è¯­å¥å¹¶è°ƒç”¨ close() æ–¹æ³•ã€‚InputStream å’Œ OutputStream éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå› æ­¤ï¼Œéƒ½å¯ä»¥ç”¨åœ¨ try(resource) ä¸­ã€‚

## ğŸ€ ç¼“å†²

åœ¨è¯»å–æµçš„æ—¶å€™ï¼Œä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚å¹¶ä¸æ˜¯æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚å¾ˆå¤šæµæ”¯æŒä¸€æ¬¡æ€§è¯»å–å¤šä¸ªå­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œå¯¹äºæ–‡ä»¶å’Œç½‘ç»œæµæ¥è¯´ï¼Œåˆ©ç”¨ç¼“å†²åŒºä¸€æ¬¡æ€§è¯»å–å¤šä¸ªå­—èŠ‚æ•ˆç‡å¾€å¾€è¦é«˜å¾ˆå¤šã€‚InputStream æä¾›äº†ä¸¤ä¸ªé‡è½½æ–¹æ³•æ¥æ”¯æŒè¯»å–å¤šä¸ªå­—èŠ‚ï¼š

```java
int read(byte[] b)ï¼šè¯»å–è‹¥å¹²å­—èŠ‚å¹¶å¡«å……åˆ° byte[] æ•°ç»„ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°
int read(byte[] b, int off, int len)ï¼šæŒ‡å®š byte[] æ•°ç»„çš„åç§»é‡å’Œæœ€å¤§å¡«å……æ•°
```


åˆ©ç”¨ä¸Šè¿°æ–¹æ³•ä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚æ—¶ï¼Œéœ€è¦å…ˆå®šä¹‰ä¸€ä¸ª byte[] æ•°ç»„ä½œä¸ºç¼“å†²åŒºï¼Œread() æ–¹æ³•ä¼šå°½å¯èƒ½å¤šåœ°è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œ ä½†ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºçš„å¤§å°ã€‚read() æ–¹æ³•çš„è¿”å›å€¼ä¸å†æ˜¯å­—èŠ‚çš„ int å€¼ï¼Œè€Œæ˜¯è¿”å›å®é™…è¯»å–äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚å¦‚æœè¿”å› - 1ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº†ã€‚

åˆ©ç”¨ç¼“å†²åŒºä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚çš„ä»£ç å¦‚ä¸‹ï¼š


```java
public void readFile() throws IOException {
    try (InputStream input = new FileInputStream("src/readme.txt")) {
        // å®šä¹‰ 1000 ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒº:
        byte[] buffer = new byte[1000];
        int n;
        while ((n = input.read(buffer)) != -1) { // è¯»å–åˆ°ç¼“å†²åŒº
            System.out.println("read" + n + "bytes.");
        }
    }
}
```

## ğŸ€ é˜»å¡

åœ¨è°ƒç”¨ InputStream çš„ read() æ–¹æ³•è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¯´ read() æ–¹æ³•æ˜¯é˜»å¡ï¼ˆBlockingï¼‰çš„ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¯¹äºä¸‹é¢çš„ä»£ç ï¼š


```java
int n;
n = input.read(); // å¿…é¡»ç­‰å¾… read() æ–¹æ³•è¿”å›æ‰èƒ½æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç 
int m = n;
```


æ‰§è¡Œåˆ°ç¬¬äºŒè¡Œä»£ç æ—¶ï¼Œå¿…é¡»ç­‰ read() æ–¹æ³•è¿”å›åæ‰èƒ½ç»§ç»­ã€‚å› ä¸ºè¯»å– IO æµç›¸æ¯”æ‰§è¡Œæ™®é€šä»£ç ï¼Œé€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼Œå› æ­¤ï¼Œæ— æ³•ç¡®å®š read() æ–¹æ³•è°ƒç”¨åˆ°åº•è¦èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚

## ğŸ€ InputStream å®ç°ç±»

ç”¨ FileInputStream å¯ä»¥ä»æ–‡ä»¶è·å–è¾“å…¥æµï¼Œè¿™æ˜¯ InputStream å¸¸ç”¨çš„ä¸€ä¸ªå®ç°ç±»ã€‚æ­¤å¤–ï¼ŒByteArrayInputStream å¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ª InputStreamï¼š

```java
import java.io.*;

public class Main {
    public static void main(String[] args) throws IOException {
        byte[] data = { 72, 101, 108, 108, 111, 33 };
        try (InputStream input = new ByteArrayInputStream(data)) {
            int n;
            while ((n = input.read()) != -1) {
                System.out.println((char)n);
            }
        }
    }
}
```


ByteArrayInputStream å®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª byte[] æ•°ç»„åœ¨å†…å­˜ä¸­å˜æˆä¸€ä¸ª InputStreamï¼Œè™½ç„¶å®é™…åº”ç”¨ä¸å¤šï¼Œä½†æµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª InputStreamã€‚

ä¸¾ä¸ªæ —å­ï¼šæˆ‘ä»¬æƒ³ä»æ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰å­—èŠ‚ï¼Œå¹¶è½¬æ¢æˆ char ç„¶åæ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š


```java
public class Main {
    public static void main(String[] args) throws IOException {
        String s;
        try (InputStream input = new FileInputStream("C:\\test\\README.txt")) {
            int n;
            StringBuilder sb = new StringBuilder();
            while ((n = input.read()) != -1) {
                sb.append((char) n);
            }
            s = sb.toString();
        }
        System.out.println(s);
    }
}
```


è¦æµ‹è¯•ä¸Šé¢çš„ç¨‹åºï¼Œå°±çœŸçš„éœ€è¦åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šæ”¾ä¸€ä¸ªçœŸå®çš„æ–‡æœ¬æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬æŠŠä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œæå–ä¸€ä¸ª readAsString() çš„æ–¹æ³•ï¼š


```java
public class Main {
    public static void main(String[] args) throws IOException {
        String s;
        try (InputStream input = new FileInputStream("C:\\test\\README.txt")) {
            s = readAsString(input);
        }
        System.out.println(s);
    }

    public static String readAsString(InputStream input) throws IOException {
        int n;
        StringBuilder sb = new StringBuilder();
        while ((n = input.read()) != -1) {
            sb.append((char) n);
        }
        return sb.toString();
    }
}
```


å¯¹è¿™ä¸ª String readAsString(InputStream input) æ–¹æ³•è¿›è¡Œæµ‹è¯•å°±ç›¸å½“ç®€å•ï¼Œå› ä¸ºä¸ä¸€å®šè¦ä¼ å…¥ä¸€ä¸ªçœŸçš„ FileInputStreamï¼š

```java
import java.io.*;

public class Main {
    public static void main(String[] args) throws IOException {
        byte[] data = { 72, 101, 108, 108, 111, 33 };
        try (InputStream input = new ByteArrayInputStream(data)) {
            String s = readAsString(input);
            System.out.println(s);
        }
    }

    public static String readAsString(InputStream input) throws IOException {
        int n;
        StringBuilder sb = new StringBuilder();
        while ((n = input.read()) != -1) {
            sb.append((char) n);
        }
        return sb.toString();
    }
}
```


è¿™å°±æ˜¯é¢å‘æŠ½è±¡ç¼–ç¨‹åŸåˆ™çš„åº”ç”¨ï¼šæ¥å— InputStream æŠ½è±¡ç±»å‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ FileInputStream ç±»å‹ï¼Œä»è€Œä½¿å¾—ä»£ç å¯ä»¥å¤„ç† InputStream çš„ä»»æ„å®ç°ç±»ã€‚

## ğŸ€ å°ç»“

Java æ ‡å‡†åº“çš„ java.io.InputStream å®šä¹‰äº†æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ï¼š

FileInputStream å®ç°äº†æ–‡ä»¶æµè¾“å…¥ï¼›

ByteArrayInputStream åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ªå­—èŠ‚æµè¾“å…¥ã€‚

æ€»æ˜¯ä½¿ç”¨ try(resource) æ¥ä¿è¯ InputStream æ­£ç¡®å…³é—­ã€‚


