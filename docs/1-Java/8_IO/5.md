---
title: æ“ä½œ Zip
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ZipInputStream æ˜¯ä¸€ç§ FilterInputStreamï¼Œå®ƒå¯ä»¥ç›´æ¥è¯»å– zip åŒ…çš„å†…å®¹ï¼š

![](assets/20221123212717.png)

å¦ä¸€ä¸ª JarInputStream æ˜¯ä» ZipInputStream æ´¾ç”Ÿï¼Œå®ƒå¢åŠ çš„ä¸»è¦åŠŸèƒ½æ˜¯ç›´æ¥è¯»å– jar æ–‡ä»¶é‡Œé¢çš„ `MANIFEST.MF` æ–‡ä»¶ã€‚å› ä¸ºæœ¬è´¨ä¸Š jar åŒ…å°±æ˜¯ zip åŒ…ï¼Œåªæ˜¯é¢å¤–é™„åŠ äº†ä¸€äº›å›ºå®šçš„æè¿°æ–‡ä»¶ã€‚

## ğŸ€ è¯»å– zip åŒ…

æˆ‘ä»¬æ¥çœ‹çœ‹ ZipInputStream çš„åŸºæœ¬ç”¨æ³•ã€‚

æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª ZipInputStreamï¼Œé€šå¸¸æ˜¯ä¼ å…¥ä¸€ä¸ª FileInputStream ä½œä¸ºæ•°æ®æºï¼Œç„¶åï¼Œå¾ªç¯è°ƒç”¨ `getNextEntry()`ï¼Œç›´åˆ°è¿”å› `null`ï¼Œè¡¨ç¤º zip æµç»“æŸã€‚

ä¸€ä¸ª ZipEntry è¡¨ç¤ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœæ˜¯å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ç”¨ `read()` æ–¹æ³•ä¸æ–­è¯»å–ï¼Œç›´åˆ°è¿”å› `-1`ï¼š

```java {3,7}
try (ZipInputStream zip = new ZipInputStream(new FileInputStream(...))) {
    ZipEntry entry = null;
    while ((entry = zip.getNextEntry()) != null) {
        String name = entry.getName();
        if (!entry.isDirectory()) {
            int n;
            while ((n = zip.read()) != -1) {
                ...
            }
        }
    }
}
```

## ğŸ€ å†™å…¥ zip åŒ…

ZipOutputStream æ˜¯ä¸€ç§ FilterOutputStreamï¼Œå®ƒå¯ä»¥ç›´æ¥å†™å…¥å†…å®¹åˆ° zip åŒ…ã€‚æˆ‘ä»¬è¦å…ˆåˆ›å»ºä¸€ä¸ª ZipOutputStreamï¼Œé€šå¸¸æ˜¯åŒ…è£…ä¸€ä¸ª FileOutputStreamï¼Œç„¶åï¼Œæ¯å†™å…¥ä¸€ä¸ªæ–‡ä»¶å‰ï¼Œå…ˆè°ƒç”¨ `putNextEntry()`ï¼Œç„¶åç”¨ `write()` å†™å…¥ `byte[]` æ•°æ®ï¼Œå†™å…¥å®Œæ¯•åè°ƒç”¨ `closeEntry()` ç»“æŸè¿™ä¸ªæ–‡ä»¶çš„æ‰“åŒ…ã€‚

```java {4-6}
try (ZipOutputStream zip = new ZipOutputStream(new FileOutputStream(...))) {
    File[] files = ...
    for (File file : files) {
        zip.putNextEntry(new ZipEntry(file.getName()));
        zip.write(Files.readAllBytes(file.toPath()));
        zip.closeEntry();
    }
}
```

ä¸Šé¢çš„ä»£ç æ²¡æœ‰è€ƒè™‘æ–‡ä»¶çš„ç›®å½•ç»“æ„ã€‚å¦‚æœè¦å®ç°ç›®å½•å±‚æ¬¡ç»“æ„ï¼Œ`new ZipEntry(name)` ä¼ å…¥çš„ `name` è¦ç”¨ç›¸å¯¹è·¯å¾„ã€‚

## ğŸ€ å°ç»“

- ZipInputStream å¯ä»¥è¯»å– zip æ ¼å¼çš„æµï¼ŒZipOutputStream å¯ä»¥æŠŠå¤šä»½æ•°æ®å†™å…¥ zip åŒ…ï¼›

- é…åˆ FileInputStream å’Œ FileOutputStream å°±å¯ä»¥è¯»å†™ zip æ–‡ä»¶ã€‚
