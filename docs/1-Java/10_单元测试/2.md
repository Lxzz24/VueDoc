---
title: ä½¿ç”¨ Fixture
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

åœ¨ä¸€ä¸ªå•å…ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç¼–å†™å¤šä¸ª `@Test` æ–¹æ³•ï¼Œæ¥åˆ†ç»„ã€åˆ†ç±»å¯¹ç›®æ ‡ä»£ç è¿›è¡Œæµ‹è¯•ã€‚

åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä¸€ä¸ªå¯¹è±¡éœ€è¦åˆå§‹åŒ–ï¼Œæµ‹è¯•å®Œå¯èƒ½è¿˜éœ€è¦æ¸…ç†çš„æƒ…å†µã€‚å¦‚æœæ¯ä¸ª `@Test` æ–¹æ³•éƒ½å†™ä¸€éè¿™æ ·çš„é‡å¤ä»£ç ï¼Œæ˜¾ç„¶æ¯”è¾ƒéº»çƒ¦ã€‚

JUnit æä¾›äº†ç¼–å†™ _æµ‹è¯•å‰å‡†å¤‡ã€æµ‹è¯•åæ¸…ç†_ çš„å›ºå®šä»£ç ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Fixtureã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ Calculator çš„ä¾‹å­ï¼š

```java
public class Calculator {
    private long n = 0;

    public long add(long x) {
        n = n + x;
        return n;
    }

    public long sub(long x) {
        n = n - x;
        return n;
    }
}
```

è¿™ä¸ªç±»çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆåˆå§‹åŒ–å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¸­éƒ½å†™ä¸Šåˆå§‹åŒ–ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡ `@BeforeEach` æ¥åˆå§‹åŒ–ï¼Œé€šè¿‡ `@AfterEach` æ¥æ¸…ç†èµ„æºï¼š

```java
public class CalculatorTest {

    Calculator calculator;

    @BeforeEach
    public void setUp() {
        this.calculator = new Calculator();
    }

    @AfterEach
    public void tearDown() {
        this.calculator = null;
    }

    @Test
    void testAdd() {
        assertEquals(100, this.calculator.add(100));
        assertEquals(150, this.calculator.add(50));
        assertEquals(130, this.calculator.add(-20));
    }

    @Test
    void testSub() {
        assertEquals(-100, this.calculator.sub(100));
        assertEquals(-150, this.calculator.sub(50));
        assertEquals(-130, this.calculator.sub(-20));
    }
}
```

åœ¨ CalculatorTest æµ‹è¯•ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ ‡è®°ä¸º `@BeforeEach` å’Œ `@AfterEach` çš„æ–¹æ³•ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡Œæ¯ä¸ª `@Test` æ–¹æ³•å‰åè‡ªåŠ¨è¿è¡Œã€‚

ä¸Šé¢çš„æµ‹è¯•ä»£ç åœ¨ JUnit ä¸­è¿è¡Œé¡ºåºå¦‚ä¸‹ï¼š

```java
for (Method testMethod : findTestMethods(CalculatorTest.class)) {
    var test = new CalculatorTest(); // åˆ›å»º Test å®ä¾‹
    invokeBeforeEach(test);
        invokeTestMethod(test, testMethod);
    invokeAfterEach(test);
}
```

å¯è§ï¼Œ`@BeforeEach` å’Œ `@AfterEach` ä¼š â€œç¯ç»•â€ åœ¨æ¯ä¸ª `@Test` æ–¹æ³•å‰åã€‚

è¿˜æœ‰ä¸€äº›èµ„æºåˆå§‹åŒ–å’Œæ¸…ç†å¯èƒ½æ›´åŠ ç¹çï¼Œè€Œä¸”ä¼šè€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œä¾‹å¦‚åˆå§‹åŒ–æ•°æ®åº“ã€‚JUnit è¿˜æä¾›äº† `@BeforeAll` å’Œ `@AfterAll`ï¼Œå®ƒä»¬åœ¨è¿è¡Œæ‰€æœ‰ `@Test` å‰åè¿è¡Œï¼Œé¡ºåºå¦‚ä¸‹ï¼š

```java
invokeBeforeAll(CalculatorTest.class);
for (Method testMethod : findTestMethods(CalculatorTest.class)) {
    var test = new CalculatorTest(); // åˆ›å»º Test å®ä¾‹
    invokeBeforeEach(test);
        invokeTestMethod(test, testMethod);
    invokeAfterEach(test);
}
invokeAfterAll(CalculatorTest.class);
```

å› ä¸º `@BeforeAll` å’Œ `@AfterAll` åœ¨æ‰€æœ‰ `@Test` æ–¹æ³•è¿è¡Œå‰åä»…è¿è¡Œä¸€æ¬¡ï¼Œå› æ­¤ï¼Œå®ƒä»¬åªèƒ½åˆå§‹åŒ–é™æ€å˜é‡ï¼Œä¾‹å¦‚ï¼š

```java
public class DatabaseTest {
    static Database db;

    @BeforeAll
    public static void initDatabase() {
        db = createDb(...);
    }

    @AfterAll
    public static void dropDatabase() {
        ...
    }
}
```

äº‹å®ä¸Šï¼Œ`@BeforeAll` å’Œ `@AfterAll` ä¹Ÿåªèƒ½æ ‡æ³¨åœ¨é™æ€æ–¹æ³•ä¸Šã€‚

å› æ­¤ï¼Œæˆ‘ä»¬æ€»ç»“å‡ºç¼–å†™ Fixture çš„å¥—è·¯å¦‚ä¸‹ï¼š

1. å¯¹äºå®ä¾‹å˜é‡ï¼Œåœ¨ `@BeforeEach` ä¸­åˆå§‹åŒ–ï¼Œåœ¨ `@AfterEach` ä¸­æ¸…ç†ï¼Œå®ƒä»¬åœ¨å„ä¸ª `@Test` æ–¹æ³•ä¸­äº’ä¸å½±å“ï¼Œå› ä¸ºæ˜¯ä¸åŒçš„å®ä¾‹ï¼›

2. å¯¹äºé™æ€å˜é‡ï¼Œåœ¨ `@BeforeAll` ä¸­åˆå§‹åŒ–ï¼Œåœ¨ `@AfterAll` ä¸­æ¸…ç†ï¼Œå®ƒä»¬åœ¨å„ä¸ª `@Test` æ–¹æ³•ä¸­å‡æ˜¯å”¯ä¸€å®ä¾‹ï¼Œä¼šå½±å“å„ä¸ª `@Test` æ–¹æ³•ã€‚

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `@BeforeEach` å’Œ `@AfterEach` å°±è¶³å¤Ÿäº†ã€‚åªæœ‰æŸäº›æµ‹è¯•èµ„æºåˆå§‹åŒ–è€—è´¹æ—¶é—´å¤ªé•¿ï¼Œä»¥è‡³äºæˆ‘ä»¬ä¸å¾—ä¸å°½é‡ â€œå¤ç”¨â€ æ—¶æ‰ä¼šç”¨åˆ° `@BeforeAll` å’Œ `@AfterAll`ã€‚

æœ€åï¼Œæ³¨æ„åˆ°æ¯æ¬¡è¿è¡Œä¸€ä¸ª `@Test` æ–¹æ³•å‰ï¼ŒJUnit é¦–å…ˆåˆ›å»ºä¸€ä¸ª XxxTest å®ä¾‹ï¼Œå› æ­¤ï¼Œæ¯ä¸ª `@Test` æ–¹æ³•å†…éƒ¨çš„æˆå‘˜å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸èƒ½ä¹Ÿæ— æ³•æŠŠæˆå‘˜å˜é‡çš„çŠ¶æ€ä»ä¸€ä¸ª `@Test` æ–¹æ³•å¸¦åˆ°å¦ä¸€ä¸ª `@Test` æ–¹æ³•ã€‚

## ğŸ€ å°ç»“

- ç¼–å†™ Fixture æ˜¯æŒ‡é’ˆå¯¹æ¯ä¸ª `@Test` æ–¹æ³•ï¼Œç¼–å†™ `@BeforeEach` æ–¹æ³•ç”¨äºåˆå§‹åŒ–æµ‹è¯•èµ„æºï¼Œç¼–å†™ `@AfterEach` ç”¨äºæ¸…ç†æµ‹è¯•èµ„æºï¼›

- å¿…è¦æ—¶ï¼Œå¯ä»¥ç¼–å†™ @BeforeAll å’Œ @AfterAllï¼Œä½¿ç”¨é™æ€å˜é‡æ¥åˆå§‹åŒ–è€—æ—¶çš„èµ„æºï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰ `@Test` æ–¹æ³•çš„è¿è¡Œå‰åä»…æ‰§è¡Œä¸€æ¬¡ã€‚
