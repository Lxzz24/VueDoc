---
title: æ¥æ”¶ Email
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

å‘é€ Email çš„è¿‡ç¨‹æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚å·²ç»è®²è¿‡äº†ï¼Œå®¢æˆ·ç«¯æ€»æ˜¯é€šè¿‡ SMTP åè®®æŠŠé‚®ä»¶å‘é€ç»™ MTAã€‚

æ¥æ”¶ Email åˆ™ç›¸åï¼Œå› ä¸ºé‚®ä»¶æœ€ç»ˆåˆ°è¾¾æ”¶ä»¶äººçš„ MDA æœåŠ¡å™¨ï¼Œæ‰€ä»¥ï¼Œæ¥æ”¶é‚®ä»¶æ˜¯æ”¶ä»¶äººç”¨è‡ªå·±çš„å®¢æˆ·ç«¯æŠŠé‚®ä»¶ä» MDA æœåŠ¡å™¨ä¸ŠæŠ“å–åˆ°æœ¬åœ°çš„è¿‡ç¨‹ã€‚

æ¥æ”¶é‚®ä»¶ä½¿ç”¨æœ€å¹¿æ³›çš„åè®®æ˜¯ POP3ï¼šPost Office Protocol version 3ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ TCP è¿æ¥ä¹‹ä¸Šçš„åè®®ã€‚POP3 æœåŠ¡å™¨çš„æ ‡å‡†ç«¯å£æ˜¯ 110ï¼Œå¦‚æœæ•´ä¸ªä¼šè¯éœ€è¦åŠ å¯†ï¼Œé‚£ä¹ˆä½¿ç”¨åŠ å¯†ç«¯å£ 995ã€‚

å¦ä¸€ç§æ¥æ”¶é‚®ä»¶çš„åè®®æ˜¯ IMAPï¼šInternet Mail Access Protocolï¼Œå®ƒä½¿ç”¨æ ‡å‡†ç«¯å£ 143 å’ŒåŠ å¯†ç«¯å£ 993ã€‚IMAP å’Œ POP3 çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒIMAP åè®®åœ¨æœ¬åœ°çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”ï¼ŒIMAP å¯ä»¥å…è®¸ç”¨æˆ·åœ¨é‚®ä»¶æœåŠ¡å™¨çš„æ”¶ä»¶ç®±ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ã€‚

JavaMail ä¹Ÿæä¾›äº† IMAP åè®®çš„æ”¯æŒã€‚å› ä¸º POP3 å’Œ IMAP çš„ä½¿ç”¨æ–¹å¼éå¸¸ç±»ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬åªä»‹ç» POP3 çš„ç”¨æ³•ã€‚

ä½¿ç”¨ POP3 æ”¶å– Email æ—¶ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒ POP3 åè®®åº•å±‚ï¼Œå› ä¸º JavaMail æä¾›äº†é«˜å±‚æ¥å£ã€‚é¦–å…ˆéœ€è¦è¿æ¥åˆ° Store å¯¹è±¡ï¼š

```java
// å‡†å¤‡ç™»å½•ä¿¡æ¯:
String host = "pop3.example.com";
int port = 995;
String username = "bob@example.com";
String password = "password";

Properties props = new Properties();
props.setProperty("mail.store.protocol", "pop3"); // åè®®åç§°
props.setProperty("mail.pop3.host", host);// POP3 ä¸»æœºå
props.setProperty("mail.pop3.port", String.valueOf(port)); // ç«¯å£å·
// å¯åŠ¨ SSL:
props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
props.put("mail.smtp.socketFactory.port", String.valueOf(port));

// è¿æ¥åˆ° Store:
URLName url = new URLName("pop3", host, post, "", username, password);
Session session = Session.getInstance(props, null);
session.setDebug(true); // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
Store store = new POP3SSLStore(session, url);
store.connect();
```

ä¸€ä¸ª `Store` å¯¹è±¡è¡¨ç¤ºæ•´ä¸ªé‚®ç®±çš„å­˜å‚¨ï¼Œè¦æ”¶å–é‚®ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ `Store` è®¿é—®æŒ‡å®šçš„ `Folder`ï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œé€šå¸¸æ˜¯ `INBOX` è¡¨ç¤ºæ”¶ä»¶ç®±ï¼š

```java
// è·å–æ”¶ä»¶ç®±:
Folder folder = store.getFolder("INBOX");
// ä»¥è¯»å†™æ–¹å¼æ‰“å¼€:
folder.open(Folder.READ_WRITE);
// æ‰“å°é‚®ä»¶æ€»æ•° / æ–°é‚®ä»¶æ•°é‡ / æœªè¯»æ•°é‡ / å·²åˆ é™¤æ•°é‡:
System.out.println("Total messages:" + folder.getMessageCount());
System.out.println("New messages:" + folder.getNewMessageCount());
System.out.println("Unread messages:" + folder.getUnreadMessageCount());
System.out.println("Deleted messages:" + folder.getDeletedMessageCount());
// è·å–æ¯ä¸€å°é‚®ä»¶:
Message[] messages = folder.getMessages();
for (Message message : messages) {
    // æ‰“å°æ¯ä¸€å°é‚®ä»¶:
    printMessage((MimeMessage) message);
}
```

å½“æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ª `Message` å¯¹è±¡æ—¶ï¼Œå¯ä»¥å¼ºåˆ¶è½¬å‹ä¸º MimeMessageï¼Œç„¶åæ‰“å°å‡ºé‚®ä»¶ä¸»é¢˜ã€å‘ä»¶äººã€æ”¶ä»¶äººç­‰ä¿¡æ¯ï¼š

```java
void printMessage(MimeMessage msg) throws IOException, MessagingException {
    // é‚®ä»¶ä¸»é¢˜:
    System.out.println("Subject:" + MimeUtility.decodeText(msg.getSubject()));
    // å‘ä»¶äºº:
    Address[] froms = msg.getFrom();
    InternetAddress address = (InternetAddress) froms[0];
    String personal = address.getPersonal();
    String from = personal == null ? address.getAddress() : (MimeUtility.decodeText(personal) + "<" + address.getAddress() + ">");
    System.out.println("From:" + from);
    // ç»§ç»­æ‰“å°æ”¶ä»¶äºº:
    ...
}
```

æ¯”è¾ƒéº»çƒ¦çš„æ˜¯è·å–é‚®ä»¶çš„æ­£æ–‡ã€‚ä¸€ä¸ª `MimeMessage` å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ª `Part` å¯¹è±¡ï¼Œå®ƒå¯èƒ½åªåŒ…å«ä¸€ä¸ªæ–‡æœ¬ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª `Multipart` å¯¹è±¡ï¼Œå³ç”±å‡ ä¸ª `Part` æ„æˆï¼Œå› æ­¤ï¼Œéœ€è¦é€’å½’åœ°è§£æå‡ºå®Œæ•´çš„æ­£æ–‡ï¼š

```java
String getBody(Part part) throws MessagingException, IOException {
    if (part.isMimeType("text/*")) {
        // Part æ˜¯æ–‡æœ¬:
        return part.getContent().toString();
    }
    if (part.isMimeType("multipart/*")) {
        // Part æ˜¯ä¸€ä¸ª Multipart å¯¹è±¡:
        Multipart multipart = (Multipart) part.getContent();
        // å¾ªç¯è§£ææ¯ä¸ªå­ Part:
        for (int i = 0; i < multipart.getCount(); i++) {
            BodyPart bodyPart = multipart.getBodyPart(i);
            String body = getBody(bodyPart);
            if (!body.isEmpty()) {
                return body;
            }
        }
    }
    return "";
}
```

æœ€åè®°å¾—å…³é—­ `Folder` å’Œ `Store`ï¼š

```java
folder.close(true); // ä¼ å…¥ true è¡¨ç¤ºåˆ é™¤æ“ä½œä¼šåŒæ­¥åˆ°æœåŠ¡å™¨ä¸Šï¼ˆå³åˆ é™¤æœåŠ¡å™¨æ”¶ä»¶ç®±çš„é‚®ä»¶ï¼‰
store.close();
```

## ğŸ€ ç»ƒä¹ 

ä½¿ç”¨ POP3 æ¥æ”¶é‚®ä»¶

## ğŸ€ å°ç»“

- ä½¿ç”¨ Java æ¥æ”¶ Email æ—¶ï¼Œå¯ä»¥ç”¨ POP3 åè®®æˆ– IMAP åè®®ã€‚

- ä½¿ç”¨ POP3 åè®®æ—¶ï¼Œéœ€è¦ç”¨ Maven å¼•å…¥ JavaMail ä¾èµ–ï¼Œå¹¶ç¡®å®š POP3 æœåŠ¡å™¨çš„åŸŸåï¼ç«¯å£ï¼æ˜¯å¦ä½¿ç”¨ SSL ç­‰ï¼Œç„¶åï¼Œè°ƒç”¨ç›¸å…³ API æ¥æ”¶ Emailã€‚

- è®¾ç½® debug æ¨¡å¼å¯ä»¥æŸ¥çœ‹é€šä¿¡è¯¦ç»†å†…å®¹ï¼Œä¾¿äºæ’æŸ¥é”™è¯¯ã€‚
