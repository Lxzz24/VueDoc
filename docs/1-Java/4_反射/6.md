---
title: åŠ¨æ€ä»£ç†**
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æˆ‘ä»¬æ¥æ¯”è¾ƒ Java çš„ `class` å’Œ `interface` çš„åŒºåˆ«ï¼š

- ==å¯ä»¥å®ä¾‹åŒ–== `class` ï¼ˆé `abstract` ï¼‰
- ==ä¸èƒ½å®ä¾‹åŒ–== `interface`

æ‰€æœ‰ `interface` ç±»å‹çš„å˜é‡æ€»æ˜¯é€šè¿‡æŸä¸ªå®ä¾‹å‘ä¸Šè½¬å‹å¹¶èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡çš„ï¼š

```java
CharSequence cs = new StringBuilder();
```

æœ‰æ²¡æœ‰å¯èƒ½ä¸ç¼–å†™å®ç°ç±»ï¼Œç›´æ¥åœ¨è¿è¡ŒæœŸåˆ›å»ºæŸä¸ª `interface` çš„å®ä¾‹å‘¢ï¼Ÿ

è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Java æ ‡å‡†åº“æä¾›äº†ä¸€ç§ **åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰** çš„æœºåˆ¶ï¼š_å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ª `interface` çš„å®ä¾‹_ã€‚

ä»€ä¹ˆå«è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºï¼Ÿå¬èµ·æ¥å¥½åƒå¾ˆå¤æ‚ã€‚æ‰€è°“åŠ¨æ€ä»£ç†ï¼Œæ˜¯å’Œé™æ€ç›¸å¯¹åº”çš„ã€‚æˆ‘ä»¬æ¥çœ‹é™æ€ä»£ç æ€ä¹ˆå†™ï¼š

å®šä¹‰æ¥å£ï¼š

```java
public interface Hello {
    void morning(String name);
}
```

ç¼–å†™å®ç°ç±»ï¼š

```java
public class HelloWorld implements Hello {
    public void morning(String name) {
        System.out.println("Good morning," + name);
    }
}
```

åˆ›å»ºå®ä¾‹ï¼Œè½¬å‹ä¸ºæ¥å£å¹¶è°ƒç”¨ï¼š

```java
Hello hello = new HelloWorld();
hello.morning("Bob");
```

è¿™ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬é€šå¸¸ç¼–å†™ä»£ç çš„æ–¹å¼ã€‚

è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯åŠ¨æ€ä»£ç ï¼Œæˆ‘ä»¬ä»ç„¶å…ˆå®šä¹‰äº†æ¥å£ `Hello` ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ç¼–å†™å®ç°ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ JDK æä¾›çš„ä¸€ä¸ª **`Proxy.newProxyInstance()`** åˆ›å»ºäº†ä¸€ä¸ª `Hello` æ¥å£å¯¹è±¡ã€‚è¿™ç§æ²¡æœ‰å®ç°ç±»ä½†æ˜¯åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¸ºåŠ¨æ€ä»£ç ã€‚_JDK æä¾›çš„åŠ¨æ€åˆ›å»ºæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œå°±å«åŠ¨æ€ä»£ç†ã€‚_

ä¸€ä¸ªæœ€ç®€å•çš„åŠ¨æ€ä»£ç†å®ç°å¦‚ä¸‹ï¼š

```java
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

public class Main {
    public static void main(String[] args) {
        InvocationHandler handler = new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                System.out.println(method);
                if (method.getName().equals("morning")) {
                    System.out.println("Good morning, " + args[0]);
                }
                return null;
            }
        };

        Hello hello = (Hello) Proxy.newProxyInstance(
            Hello.class.getClassLoader(), // ä¼ å…¥ ClassLoader
            new Class[] { Hello.class }, // ä¼ å…¥è¦å®ç°çš„æ¥å£
            handler); // ä¼ å…¥å¤„ç†è°ƒç”¨æ–¹æ³•çš„ InvocationHandler
        hello.morning("Bob");
    }
}

interface Hello {
    void morning(String name);
}
```

åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ª `interface` å®ä¾‹çš„æ–¹æ³•å¦‚ä¸‹ï¼š

1. å®šä¹‰ä¸€ä¸ª `InvocationHandler` å®ä¾‹ï¼Œå®ƒè´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼›
2. é€šè¿‡ `Proxy.newProxyInstance()` åˆ›å»º `interface` å®ä¾‹ï¼Œå®ƒéœ€è¦ 3 ä¸ªå‚æ•°ï¼š
   - ä½¿ç”¨çš„ `ClassLoader` ï¼Œé€šå¸¸å°±æ˜¯æ¥å£ç±»çš„ `ClassLoader` ï¼›
   - éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ï¼Œè‡³å°‘éœ€è¦ä¼ å…¥ä¸€ä¸ªæ¥å£è¿›å»ï¼›
   - ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„ `InvocationHandler` å®ä¾‹ã€‚
3. å°†è¿”å›çš„ `Object` å¼ºåˆ¶è½¬å‹ä¸ºæ¥å£ã€‚

åŠ¨æ€ä»£ç†å®é™…ä¸Šæ˜¯ JVM åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»º `class` å­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ï¼Œå®ƒå¹¶æ²¡æœ‰ä»€ä¹ˆé»‘é­”æ³•ï¼ŒæŠŠä¸Šé¢çš„åŠ¨æ€ä»£ç†æ”¹å†™ä¸ºé™æ€å®ç°ç±»å¤§æ¦‚é•¿è¿™æ ·ï¼š

```java
public class HelloDynamicProxy implements Hello {
    InvocationHandler handler;
    public HelloDynamicProxy(InvocationHandler handler) {
        this.handler = handler;
    }
    public void morning(String name) {
        handler.invoke(
           this,
           Hello.class.getMethod("morning", String.class),
           new Object[] { name});
    }
}
```

å…¶å®å°±æ˜¯ JVM å¸®æˆ‘ä»¬è‡ªåŠ¨ç¼–å†™äº†ä¸€ä¸ªä¸Šè¿°ç±»ï¼ˆä¸éœ€è¦æºç ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå­—èŠ‚ç ï¼‰ï¼Œå¹¶ä¸å­˜åœ¨å¯ä»¥ç›´æ¥å®ä¾‹åŒ–æ¥å£çš„é»‘é­”æ³•ã€‚

## ğŸ€ å°ç»“

- Java æ ‡å‡†åº“æä¾›äº†åŠ¨æ€ä»£ç†åŠŸèƒ½ï¼Œå…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ªæ¥å£çš„å®ä¾‹ï¼›
- åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ `Proxy` åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç„¶åå°†æ¥å£æ–¹æ³• â€œä»£ç†â€ ç»™ `InvocationHandler` å®Œæˆçš„ã€‚


