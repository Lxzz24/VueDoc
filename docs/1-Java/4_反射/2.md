---
title: è®¿é—®å­—æ®µ
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

å¯¹ä»»æ„çš„ä¸€ä¸ª `Object` å®ä¾‹ï¼Œåªè¦æˆ‘ä»¬è·å–äº†å®ƒçš„ `Class` ï¼Œå°±å¯ä»¥è·å–å®ƒçš„ä¸€åˆ‡ä¿¡æ¯ã€‚

æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•é€šè¿‡ `Class` å®ä¾‹è·å–å­—æ®µä¿¡æ¯ã€‚ `Class` ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–å­—æ®µï¼š

- `Field getField(name)` ï¼šæ ¹æ®å­—æ®µåè·å–æŸä¸ª `public` çš„ `field`ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Field getDeclaredField(name)` ï¼šæ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ª `field`ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Field[] getFields()` ï¼šè·å–æ‰€æœ‰ `public` çš„ `field`ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Field[] getDeclaredFields()` ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰ `field`ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼š

```java
// reflection
public class Main {
    public static void main(String[] args) throws Exception {
        Class stdClass = Student.class;
        // è·å– public å­—æ®µ "score":
        System.out.println(stdClass.getField("score"));
        // è·å–ç»§æ‰¿çš„ public å­—æ®µ"name":
        System.out.println(stdClass.getField("name"));
        // è·å– private å­—æ®µ "grade":
        System.out.println(stdClass.getDeclaredField("grade"));
    }
}

class Student extends Person {
    public int score;
    private int grade;
}

class Person {
    public String name;
}
```

ä¸Šè¿°ä»£ç é¦–å…ˆè·å– `Student` çš„ `Class` å®ä¾‹ï¼Œç„¶åï¼Œåˆ†åˆ«è·å– `public` å­—æ®µã€ç»§æ‰¿çš„ `public` å­—æ®µä»¥åŠ `private` å­—æ®µï¼Œæ‰“å°å‡ºçš„ `Field` ç±»ä¼¼ï¼š

```java
public int Student.score
public java.lang.String Person.name
private int Student.grade
```

ä¸€ä¸ª `Field` å¯¹è±¡åŒ…å«äº†ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ï¼š

- `getName()` ï¼šè¿”å›å­—æ®µåç§°ï¼Œä¾‹å¦‚ï¼Œ`"name"`ï¼›
- `getType()` ï¼šè¿”å›å­—æ®µç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª `Class` å®ä¾‹ï¼Œä¾‹å¦‚ï¼Œ`String.class`ï¼›
- `getModifiers()` ï¼šè¿”å›å­—æ®µçš„ä¿®é¥°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ª `int`ï¼Œä¸åŒçš„ `bit` è¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚

ä»¥ `String` ç±»çš„ `value` å­—æ®µä¸ºä¾‹ï¼Œå®ƒçš„å®šä¹‰æ˜¯ï¼š

```java
public final class String {
    private final byte[] value;
}
```

æˆ‘ä»¬ç”¨åå°„è·å–è¯¥å­—æ®µçš„ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
Field f = String.class.getDeclaredField("value");
f.getName(); // "value"
f.getType(); // class [B è¡¨ç¤º byte[] ç±»å‹

int m = f.getModifiers();
Modifier.isFinal(m); // true
Modifier.isPublic(m); // false
Modifier.isProtected(m); // false
Modifier.isPrivate(m); // true
Modifier.isStatic(m); // false
```

## ğŸ€ è·å–å­—æ®µå€¼

åˆ©ç”¨åå°„æ‹¿åˆ°å­—æ®µçš„ä¸€ä¸ª `Field` å®ä¾‹åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå®ä¾‹å¯¹åº”çš„è¯¥å­—æ®µçš„å€¼ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª `Person` å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‹¿åˆ° `name` å­—æ®µå¯¹åº”çš„ `Field` ï¼Œå†è·å–è¿™ä¸ªå®ä¾‹çš„ `name` å­—æ®µçš„å€¼ï¼š

```java
// reflection
import java.lang.reflect.Field;
public class Main {
    public static void main(String[] args) throws Exception {
        Object p = new Person("Xiao Ming");
        Class c = p.getClass();
        Field f = c.getDeclaredField("name");
        Object value = f.get(p);
        System.out.println(value); // "Xiao Ming"
    }
}

class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }
}
```

ä¸Šè¿°ä»£ç å…ˆè·å– `Class` å®ä¾‹ï¼Œå†è·å– `Field` å®ä¾‹ï¼Œç„¶åï¼Œç”¨ `Field.get(Object)` è·å–æŒ‡å®šå®ä¾‹çš„æŒ‡å®šå­—æ®µçš„å€¼ã€‚

è¿è¡Œä»£ç ï¼Œå¦‚æœä¸å‡ºæ„å¤–ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª `IllegalAccessException` ï¼Œè¿™æ˜¯å› ä¸º `name` è¢«å®šä¹‰ä¸ºä¸€ä¸ª `private` å­—æ®µï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œ `Main` ç±»æ— æ³•è®¿é—® `Person` ç±»çš„ `private` å­—æ®µã€‚è¦ä¿®å¤é”™è¯¯ï¼Œå¯ä»¥å°† `private` æ”¹ä¸º `public` ï¼Œæˆ–è€…ï¼Œåœ¨è°ƒç”¨ `Object value = f.get(p);` å‰ï¼Œå…ˆå†™ä¸€å¥ï¼š

```java
f.setAccessible(true);
```

è°ƒç”¨ `Field.setAccessible(true)` çš„æ„æ€æ˜¯ï¼Œåˆ«ç®¡è¿™ä¸ªå­—æ®µæ˜¯ä¸æ˜¯ `public` ï¼Œä¸€å¾‹å…è®¸è®¿é—®ã€‚

å¯ä»¥è¯•ç€åŠ ä¸Šä¸Šè¿°è¯­å¥ï¼Œå†è¿è¡Œä»£ç ï¼Œå°±å¯ä»¥æ‰“å°å‡º `private` å­—æ®µçš„å€¼ã€‚

> æœ‰ç«¥é‹ä¼šé—®ï¼š_å¦‚æœä½¿ç”¨åå°„å¯ä»¥è·å– `private` å­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆç±»çš„å°è£…è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ_

ç­”æ¡ˆæ˜¯æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€»æ˜¯é€šè¿‡ `p.name` æ¥è®¿é—® `Person` çš„ `name` å­—æ®µï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ® `public` ã€ `protected` å’Œ `private` å†³å®šæ˜¯å¦å…è®¸è®¿é—®å­—æ®µï¼Œè¿™æ ·å°±è¾¾åˆ°äº†æ•°æ®å°è£…çš„ç›®çš„ã€‚

è€Œåå°„æ˜¯ä¸€ç§éå¸¸è§„çš„ç”¨æ³•ï¼Œä½¿ç”¨åå°„ï¼Œé¦–å…ˆä»£ç éå¸¸ç¹çï¼Œå…¶æ¬¡ï¼Œå®ƒæ›´å¤šåœ°æ˜¯ç»™å·¥å…·æˆ–è€…åº•å±‚æ¡†æ¶æ¥ä½¿ç”¨ï¼Œç›®çš„æ˜¯åœ¨ä¸çŸ¥é“ç›®æ ‡å®ä¾‹ä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œè·å–ç‰¹å®šå­—æ®µçš„å€¼ã€‚

æ­¤å¤–ï¼Œ `setAccessible(true)` å¯èƒ½ä¼šå¤±è´¥ã€‚å¦‚æœ JVM è¿è¡ŒæœŸå­˜åœ¨ `SecurityManager` ï¼Œé‚£ä¹ˆå®ƒä¼šæ ¹æ®è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰å¯èƒ½é˜»æ­¢ `setAccessible(true)` ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ª `SecurityManager` å¯èƒ½ä¸å…è®¸å¯¹ `java` å’Œ `javax` å¼€å¤´çš„ `package` çš„ç±»è°ƒç”¨ `setAccessible(true)` ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ JVM æ ¸å¿ƒåº“çš„å®‰å…¨ã€‚

## ğŸ€ è®¾ç½®å­—æ®µå€¼

é€šè¿‡ `Field` å®ä¾‹æ—¢ç„¶å¯ä»¥è·å–åˆ°æŒ‡å®šå®ä¾‹çš„å­—æ®µå€¼ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥è®¾ç½®å­—æ®µçš„å€¼ã€‚

è®¾ç½®å­—æ®µå€¼æ˜¯é€šè¿‡ `Field.set(Object, Object)` å®ç°çš„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª `Object` å‚æ•°æ˜¯æŒ‡å®šçš„å®ä¾‹ï¼Œç¬¬äºŒä¸ª `Object` å‚æ•°æ˜¯å¾…ä¿®æ”¹çš„å€¼ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
// reflection
import java.lang.reflect.Field;
public class Main {

    public static void main(String[] args) throws Exception {
        Person p = new Person("Xiao Ming");
        System.out.println(p.getName()); // "Xiao Ming"
        Class c = p.getClass();
        Field f = c.getDeclaredField("name");
        f.setAccessible(true);
        f.set(p, "Xiao Hong");
        System.out.println(p.getName()); // "Xiao Hong"
    }
}

class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    public String getName() {
        return this.name;
    }
}
```

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ‰“å°çš„ `name` å­—æ®µä» `Xiao Ming` å˜æˆäº† `Xiao Hong` ï¼Œè¯´æ˜é€šè¿‡åå°„å¯ä»¥ç›´æ¥ä¿®æ”¹å­—æ®µçš„å€¼ã€‚

åŒæ ·çš„ï¼Œä¿®æ”¹é `public` å­—æ®µï¼Œéœ€è¦é¦–å…ˆè°ƒç”¨ `setAccessible(true)` ã€‚

## ğŸ€ ç»ƒä¹ 

åˆ©ç”¨åå°„ç»™å­—æ®µèµ‹å€¼ï¼š

```java
public class Main {
    public static void main(String[] args) {
        String name = "Xiao Ming";
        int age = 20;
        Person p = new Person();

        // TODO: åˆ©ç”¨åå°„ç»™ name å’Œ age å­—æ®µèµ‹å€¼:
        Class c = p.getClass();
        Field f1 = c.getDeclaredField("name");
        Field f2 = c.getDeclaredField("age");
        f1.setAccessible(true);
        f2.setAccessible(true);
        f1.set(p,name);
        f2.set(p,age);

        System.out.println(p.getName()); // "Xiao Ming"
        System.out.println(p.getAge()); // 20
    }
}
class Person {

    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}
```

## ğŸ€ å°ç»“

Java çš„åå°„ API æä¾›çš„ `Field` ç±»å°è£…äº†å­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ï¼š

- é€šè¿‡ `Class` å®ä¾‹çš„æ–¹æ³•å¯ä»¥è·å– `Field` å®ä¾‹ï¼š `getField()` ï¼Œ `getFields()` ï¼Œ `getDeclaredField()` ï¼Œ `getDeclaredFields()` ï¼›
- é€šè¿‡ `Field` å®ä¾‹å¯ä»¥è·å–å­—æ®µä¿¡æ¯ï¼š `getName()` ï¼Œ`getType()` ï¼Œ `getModifiers()` ï¼›
- é€šè¿‡ Field å®ä¾‹å¯ä»¥è¯»å–æˆ–è®¾ç½®æŸä¸ªå¯¹è±¡çš„å­—æ®µï¼Œå¦‚æœå­˜åœ¨è®¿é—®é™åˆ¶ï¼Œè¦é¦–å…ˆè°ƒç”¨ `setAccessible(true)` æ¥è®¿é—®é `public` å­—æ®µã€‚
- é€šè¿‡åå°„è¯»å†™å­—æ®µæ˜¯ä¸€ç§éå¸¸è§„æ–¹æ³•ï¼Œå®ƒ **ä¼šç ´åå¯¹è±¡çš„å°è£…**ã€‚
