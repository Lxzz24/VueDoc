---
title: è°ƒç”¨æ–¹æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::


## ğŸ€ ç¤ºä¾‹

æˆ‘ä»¬å·²ç»èƒ½é€šè¿‡ `Class` å®ä¾‹è·å–æ‰€æœ‰ `Field` å¯¹è±¡ï¼ŒåŒæ ·çš„ï¼Œå¯ä»¥é€šè¿‡ `Class` å®ä¾‹è·å–æ‰€æœ‰ `Method` ä¿¡æ¯ã€‚ `Class` ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å– `Method` ï¼š

- `Method getMethod(name, Class...)` ï¼šè·å–æŸä¸ª `public` çš„ `Method` ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Method getDeclaredMethod(name, Class...)` ï¼šè·å–å½“å‰ç±»çš„æŸä¸ª `Method` ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Method[] getMethods()` ï¼šè·å–æ‰€æœ‰ `public` çš„ `Method` ï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰
- `Method[] getDeclaredMethods()` ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰ `Method` ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰


æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼š

```java
// reflection
public class Main {
    public static void main(String[] args) throws Exception {
        Class stdClass = Student.class;
        // è·å–publicæ–¹æ³•getScoreï¼Œå‚æ•°ä¸ºString:
        System.out.println(stdClass.getMethod("getScore", String.class));
        // è·å–ç»§æ‰¿çš„publicæ–¹æ³•getNameï¼Œæ— å‚æ•°:
        System.out.println(stdClass.getMethod("getName"));
        // è·å–privateæ–¹æ³•getGradeï¼Œå‚æ•°ä¸ºint:
        System.out.println(stdClass.getDeclaredMethod("getGrade", int.class));
    }
}

class Student extends Person {
    public int getScore(String type) {
        return 99;
    }
    private int getGrade(int year) {
        return 1;
    }
}

class Person {
    public String getName() {
        return "Person";
    }
}
```

ä¸Šè¿°ä»£ç é¦–å…ˆè·å– `Student` çš„ `Class` å®ä¾‹ï¼Œç„¶åï¼Œåˆ†åˆ«è·å– `public` æ–¹æ³•ã€ç»§æ‰¿çš„ `public` æ–¹æ³•ä»¥åŠ `private` æ–¹æ³•ï¼Œæ‰“å°å‡ºçš„ `Method` ç±»ä¼¼ï¼š

```java
public int Student.getScore(java.lang.String)
public java.lang.String Person.getName()
private int Student.getGrade(int)
```

ä¸€ä¸ª `Method` å¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼š

- `getName()` ï¼šè¿”å›æ–¹æ³•åç§°ï¼Œä¾‹å¦‚ï¼š`"getScore"` ï¼›
- `getReturnType()` ï¼šè¿”å›æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª `Class` å®ä¾‹ï¼Œä¾‹å¦‚ï¼š `String.class` ï¼›
- `getParameterTypes()` ï¼šè¿”å›æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œæ˜¯ä¸€ä¸ª `Class` æ•°ç»„ï¼Œä¾‹å¦‚ï¼š`{String.class, int.class}` ï¼›
- `getModifiers()` ï¼šè¿”å›æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ª `int` ï¼Œä¸åŒçš„ bit è¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚



## ğŸ€ è°ƒç”¨æ–¹æ³•

å½“æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ª `Method` å¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥å¯¹å®ƒè¿›è¡Œè°ƒç”¨ã€‚æˆ‘ä»¬ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š

```java
String s = "Hello world";
String r = s.substring(6); // "world"
```

å¦‚æœç”¨åå°„æ¥è°ƒç”¨ `substring` æ–¹æ³•ï¼Œéœ€è¦ä»¥ä¸‹ä»£ç ï¼š

```java
// reflection
import java.lang.reflect.Method;
public class Main {
    public static void main(String[] args) throws Exception {
        // Stringå¯¹è±¡:
        String s = "Hello world";
        // è·å–String substring(int)æ–¹æ³•ï¼Œå‚æ•°ä¸ºint:
        Method m = String.class.getMethod("substring", int.class);
        // åœ¨så¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•å¹¶è·å–ç»“æœ:
        String r = (String) m.invoke(s, 6);
        // æ‰“å°è°ƒç”¨ç»“æœ:
        System.out.println(r);
    }
}
```

æ³¨æ„åˆ° `substring()` æœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–çš„æ˜¯ `String substring(int)` è¿™ä¸ªæ–¹æ³•ã€‚æ€è€ƒä¸€ä¸‹å¦‚ä½•è·å– `String substring(int, int)` æ–¹æ³•ã€‚

å¯¹ `Method` å®ä¾‹è°ƒç”¨ `invoke` å°±ç›¸å½“äºè°ƒç”¨è¯¥æ–¹æ³•ï¼Œ `invoke` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ï¼Œå³åœ¨å“ªä¸ªå®ä¾‹ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œåé¢çš„å¯å˜å‚æ•°è¦ä¸æ–¹æ³•å‚æ•°ä¸€è‡´ï¼Œå¦åˆ™å°†æŠ¥é”™ã€‚

## ğŸ€ è°ƒç”¨é™æ€æ–¹æ³•

å¦‚æœè·å–åˆ°çš„ `Method` è¡¨ç¤ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œç”±äºæ— éœ€æŒ‡å®šå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥ `invoke` æ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œä¸º `null` ã€‚æˆ‘ä»¬ä»¥ `Integer.parseInt(String)` ä¸ºä¾‹ï¼š

```java
// reflection
import java.lang.reflect.Method;
public class Main {
    public static void main(String[] args) throws Exception {
        // è·å–Integer.parseInt(String)æ–¹æ³•ï¼Œå‚æ•°ä¸ºString:
        Method m = Integer.class.getMethod("parseInt", String.class);
        // è°ƒç”¨è¯¥é™æ€æ–¹æ³•å¹¶è·å–ç»“æœ:
        Integer n = (Integer) m.invoke(null, "12345");
        // æ‰“å°è°ƒç”¨ç»“æœ:
        System.out.println(n);
    }
}
```


## ğŸ€ è°ƒç”¨é public æ–¹æ³•

å’Œ `Field` ç±»ä¼¼ï¼Œå¯¹äºé `public` æ–¹æ³•ï¼Œæˆ‘ä»¬è™½ç„¶å¯ä»¥é€šè¿‡ `Class.getDeclaredMethod()` è·å–è¯¥æ–¹æ³•å®ä¾‹ï¼Œä½†ç›´æ¥å¯¹å…¶è°ƒç”¨å°†å¾—åˆ°ä¸€ä¸ª `IllegalAccessException` ã€‚ä¸ºäº†è°ƒç”¨é `public` æ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡ `Method.setAccessible(true)` å…è®¸å…¶è°ƒç”¨ï¼š

```java
// reflection
import java.lang.reflect.Method;
public class Main {
    public static void main(String[] args) throws Exception {
        Person p = new Person();
        Method m = p.getClass().getDeclaredMethod("setName", String.class);
        m.setAccessible(true);
        m.invoke(p, "Bob");
        System.out.println(p.name);
    }
}

class Person {
    String name;
    private void setName(String name) {
        this.name = name;
    }
}
```

æ­¤å¤–ï¼Œ `setAccessible(true)` å¯èƒ½ä¼šå¤±è´¥ã€‚å¦‚æœ JVM è¿è¡ŒæœŸå­˜åœ¨ `SecurityManager` ï¼Œé‚£ä¹ˆå®ƒä¼šæ ¹æ®è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰å¯èƒ½é˜»æ­¢ `setAccessible(true)` ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ª `SecurityManager` å¯èƒ½ä¸å…è®¸å¯¹ `java` å’Œ `javax` å¼€å¤´çš„ `package` çš„ç±»è°ƒç”¨ `setAccessible(true)` ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ JVM æ ¸å¿ƒåº“çš„å®‰å…¨ã€‚

## ğŸ€ å¤šæ€

æˆ‘ä»¬æ¥è€ƒå¯Ÿè¿™æ ·ä¸€ç§æƒ…å†µï¼šä¸€ä¸ª `Person` ç±»å®šä¹‰äº† `hello()` æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒçš„å­ç±» `Student` ä¹Ÿè¦†å†™äº† `hello()` æ–¹æ³•ï¼Œé‚£ä¹ˆï¼Œä» `Person.class` è·å–çš„ `Method` ï¼Œä½œç”¨äº `Student` å®ä¾‹æ—¶ï¼Œè°ƒç”¨çš„æ–¹æ³•åˆ°åº•æ˜¯å“ªä¸ªï¼Ÿ

```java
// reflection
import java.lang.reflect.Method;
public class Main {
    public static void main(String[] args) throws Exception {
        // è·å–Personçš„helloæ–¹æ³•:
        Method h = Person.class.getMethod("hello");
        // å¯¹Studentå®ä¾‹è°ƒç”¨helloæ–¹æ³•:
        h.invoke(new Student());
    }
}

class Person {
    public void hello() {
        System.out.println("Person:hello");
    }
}

class Student extends Person {
    public void hello() {
        System.out.println("Student:hello");
    }
}
```

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå‘ç°æ‰“å°å‡ºçš„æ˜¯ `Student:hello` ï¼Œå› æ­¤ï¼Œä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»ç„¶éµå¾ªå¤šæ€åŸåˆ™ï¼šå³æ€»æ˜¯è°ƒç”¨å®é™…ç±»å‹çš„è¦†å†™æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ä¸Šè¿°çš„åå°„ä»£ç ï¼š

```java
Method m = Person.class.getMethod("hello");
m.invoke(new Student());
```

å®é™…ä¸Šç›¸å½“äºï¼š

```java
Person p = new Student();
p.hello();
```

## ğŸ€ ç»ƒä¹ 

åˆ©ç”¨åå°„è°ƒç”¨æ–¹æ³•ï¼š

```java
public class Main {

	public static void main(String[] args) throws Exception {
		String name = "Xiao Ming";
		int age = 20;
		Person p = new Person();
		// TODO: åˆ©ç”¨åå°„è°ƒç”¨setNameå’ŒsetAgeæ–¹æ³•:
        Method m1 = p.getClass().getDeclaredMethod("setName", String.class);
        Method m2 = p.getClass().getDeclaredMethod("setAge", int.class);
        m1.setAccessible(true);
        m2.setAccessible(true);
        m1.invoke(p, name);
        m2.invoke(p, age);

		System.out.println(p.getName()); // "Xiao Ming"
		System.out.println(p.getAge()); // 20
	}
}

public class Person {

	private String name;
	private int age;

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public int getAge() {
		return age;
	}

	public void setAge(int age) {
		this.age = age;
	}

}

```

## ğŸ€ å°ç»“

Java çš„åå°„ API æä¾›çš„ `Method` å¯¹è±¡å°è£…äº†æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼š

- é€šè¿‡ `Class` å®ä¾‹çš„æ–¹æ³•å¯ä»¥è·å– `Method` å®ä¾‹ï¼š `getMethod()` ï¼Œ `getMethods()` ï¼Œ `getDeclaredMethod()` ï¼Œ `getDeclaredMethods()` ï¼›
- é€šè¿‡ `Method` å®ä¾‹å¯ä»¥è·å–æ–¹æ³•ä¿¡æ¯ï¼š`getName()` ï¼Œ `getReturnType()` ï¼Œ `getParameterTypes()` ï¼Œ `getModifiers()` ï¼›
- é€šè¿‡ `Method` å®ä¾‹å¯ä»¥è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼š `Object invoke(Object instance, Object... parameters)` ï¼›
- é€šè¿‡è®¾ç½® `setAccessible(true)` æ¥è®¿é—®é `public` æ–¹æ³•ï¼›
- é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»ç„¶éµå¾ªå¤šæ€åŸåˆ™ã€‚


