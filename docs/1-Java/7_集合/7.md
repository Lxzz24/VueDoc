---
title: ä½¿ç”¨ TreeMap
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ`HashMap` æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ˜ å°„è¡¨ï¼Œå®ƒçš„å®ç°åŸç†å†³å®šäº†å†…éƒ¨çš„ Key æ˜¯æ— åºçš„ï¼Œå³éå† `HashMap` çš„ Key æ—¶ï¼Œå…¶é¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„ï¼ˆä½†æ¯ä¸ª Key éƒ½ä¼šéå†ä¸€æ¬¡ä¸”ä»…éå†ä¸€æ¬¡ï¼‰ã€‚

è¿˜æœ‰ä¸€ç§ `Map`ï¼Œå®ƒ _åœ¨å†…éƒ¨ä¼šå¯¹ Key è¿›è¡Œæ’åº_ï¼Œè¿™ç§ `Map` å°±æ˜¯ `SortedMap` ã€‚æ³¨æ„åˆ° `SortedMap` æ˜¯æ¥å£ï¼Œå®ƒçš„å®ç°ç±»æ˜¯ `TreeMap` ã€‚

![](assets/20221122113033.png)

`SortedMap` ä¿è¯éå†æ—¶ä»¥ Key çš„é¡ºåºæ¥è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼Œæ”¾å…¥çš„ Key æ˜¯ `"apple"`ã€`"pear"`ã€`"orange"`ï¼Œéå†çš„é¡ºåºä¸€å®šæ˜¯ `"apple"`ã€`"orange"`ã€`"pear"`ï¼Œå› ä¸º `String` é»˜è®¤æŒ‰å­—æ¯æ’åºï¼š

```java
import java.util.*;
public class Main {
    public static void main(String[] args) {
        Map<String, Integer> map = new TreeMap<>();
        map.put("orange", 1);
        map.put("apple", 2);
        map.put("pear", 3);
        for (String key : map.keySet()) {
            System.out.println(key);
        }
        // apple, orange, pear
    }
}
```

ä½¿ç”¨ `TreeMap` æ—¶ï¼Œæ”¾å…¥çš„ Key å¿…é¡»å®ç° `Comparable` æ¥å£ã€‚`String`ã€`Integer` è¿™äº›ç±»å·²ç»å®ç°äº† `Comparable` æ¥å£ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½œä¸º Key ä½¿ç”¨ã€‚ä½œä¸º Value çš„å¯¹è±¡åˆ™æ²¡æœ‰ä»»ä½•è¦æ±‚ã€‚

å¦‚æœä½œä¸º Key çš„ class æ²¡æœ‰å®ç° `Comparable` æ¥å£ï¼Œé‚£ä¹ˆï¼Œå¿…é¡»åœ¨åˆ›å»º `TreeMap` æ—¶åŒæ—¶æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰æ’åºç®—æ³•ï¼š

```java {5-9}
import java.util.*;

public class Main {
    public static void main(String[] args) {
        Map<Person, Integer> map = new TreeMap<>(new Comparator<Person>() {
            public int compare(Person p1, Person p2) {
                return p1.name.compareTo(p2.name);
            }
        });
        map.put(new Person("Tom"), 1);
        map.put(new Person("Bob"), 2);
        map.put(new Person("Lily"), 3);
        for (Person key : map.keySet()) {
            System.out.println(key);
        }
        // {Person: Bob}, {Person: Lily}, {Person: Tom}
        System.out.println(map.get(new Person("Bob"))); // 2
    }
}

class Person {
    public String name;
    Person(String name) {
        this.name = name;
    }
    public String toString() {
        return "{Person: " + name + "}";
    }
}
```

æ³¨æ„åˆ° `Comparator` æ¥å£è¦æ±‚å®ç°ä¸€ä¸ªæ¯”è¾ƒæ–¹æ³•ï¼Œå®ƒè´Ÿè´£æ¯”è¾ƒä¼ å…¥çš„ä¸¤ä¸ªå…ƒç´  `a` å’Œ `b`ï¼Œå¦‚æœ `a < b`ï¼Œåˆ™è¿”å›è´Ÿæ•°ï¼Œé€šå¸¸æ˜¯ `-1`ï¼Œå¦‚æœ `a == b`ï¼Œåˆ™è¿”å› `0`ï¼Œå¦‚æœ `a > b`ï¼Œåˆ™è¿”å›æ­£æ•°ï¼Œé€šå¸¸æ˜¯ `1` ã€‚`TreeMap` å†…éƒ¨æ ¹æ®æ¯”è¾ƒç»“æœå¯¹ Key è¿›è¡Œæ’åºã€‚

ä»ä¸Šè¿°ä»£ç æ‰§è¡Œç»“æœå¯çŸ¥ï¼Œæ‰“å°çš„ Key ç¡®å®æ˜¯æŒ‰ç…§ `Comparator` å®šä¹‰çš„é¡ºåºæ’åºçš„ã€‚å¦‚æœè¦æ ¹æ® Key æŸ¥æ‰¾ Valueï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ª `new Person("Bob")` ä½œä¸º Keyï¼Œå®ƒä¼šè¿”å›å¯¹åº”çš„ `Integer` å€¼ `2` ã€‚

å¦å¤–ï¼Œæ³¨æ„åˆ° `Person` ç±»å¹¶æœªè¦†å†™ `equals()` å’Œ `hashCode()`ï¼Œå› ä¸º _`TreeMap` ä¸ä½¿ç”¨ `equals()` å’Œ `hashCode()`_ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼šè¿™æ¬¡æˆ‘ä»¬å®šä¹‰äº† `Student` ç±»ï¼Œå¹¶ç”¨åˆ†æ•° `score` è¿›è¡Œæ’åºï¼Œé«˜åˆ†åœ¨å‰ï¼š

```java {5-9}
import java.util.*;

public class Main {
    public static void main(String[] args) {
        Map<Student, Integer> map = new TreeMap<>(new Comparator<Student>() {
            public int compare(Student p1, Student p2) {
                return p1.score > p2.score ? -1 : 1;
            }
        });
        map.put(new Student("Tom", 77), 1);
        map.put(new Student("Bob", 66), 2);
        map.put(new Student("Lily", 99), 3);
        for (Student key : map.keySet()) {
            System.out.println(key);
        }
        System.out.println(map.get(new Student("Bob", 66))); // null?
    }
}

class Student {
    public String name;
    public int score;
    Student(String name, int score) {
        this.name = name;
        this.score = score;
    }
    public String toString() {
        return String.format("{%s: score=%d}", name, score);
    }
}
```

åœ¨ `for` å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ç¡®å®å¾—åˆ°äº†æ­£ç¡®çš„é¡ºåºã€‚ä½†æ˜¯ï¼Œä¸”æ…¢ï¼æ ¹æ®ç›¸åŒçš„ Keyï¼š `new Student("Bob", 66)` è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œç»“æœä¸º `null` ï¼

è¿™æ˜¯æ€ä¹ˆè‚¥å››ï¼Ÿéš¾é“ `TreeMap` æœ‰é—®é¢˜ï¼Ÿé‡åˆ° `TreeMap` å·¥ä½œä¸æ­£å¸¸æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆå›é¡¾ Java ç¼–ç¨‹åŸºæœ¬è§„åˆ™ï¼šå‡ºç°é—®é¢˜ï¼Œä¸è¦æ€€ç–‘ Java æ ‡å‡†åº“ï¼Œè¦ä»è‡ªèº«ä»£ç æ‰¾åŸå› ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`TreeMap` å‡ºç°é—®é¢˜ï¼ŒåŸå› å…¶å®å‡ºåœ¨è¿™ä¸ª `Comparator` ä¸Šï¼š

```java
public int compare(Student p1, Student p2) {
    return p1.score > p2.score ? -1 : 1;
}
```

åœ¨ `p1.score` å’Œ `p2.score` ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ï¼Œåœ¨ `p1.score` å’Œ `p2.score` ç›¸ç­‰çš„æ—¶å€™ï¼Œå®ƒå¹¶æ²¡æœ‰è¿”å› `0` ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `TreeMap` å·¥ä½œä¸æ­£å¸¸çš„åŸå› ï¼š `TreeMap` åœ¨æ¯”è¾ƒä¸¤ä¸ª Key æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œä¾èµ– Key çš„ `compareTo()` æ–¹æ³•æˆ–è€… `Comparator.compare()` æ–¹æ³•ã€‚åœ¨ä¸¤ä¸ª Key ç›¸ç­‰æ—¶ï¼Œå¿…é¡»è¿”å› `0` ã€‚å› æ­¤ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š

```java
public int compare(Student p1, Student p2) {
    if (p1.score == p2.score) {
        return 0;
    }
    return p1.score > p2.score ? -1 : 1;
}
```

æˆ–è€…ç›´æ¥å€ŸåŠ© `Integer.compare(int, int)` ä¹Ÿå¯ä»¥è¿”å›æ­£ç¡®çš„æ¯”è¾ƒç»“æœã€‚

## ğŸ€ å°ç»“

- `SortedMap` åœ¨éå†æ—¶ä¸¥æ ¼æŒ‰ç…§ Key çš„é¡ºåºéå†ï¼Œæœ€å¸¸ç”¨çš„å®ç°ç±»æ˜¯ `TreeMap` ï¼›

- ä½œä¸º `SortedMap` çš„ Key å¿…é¡»å®ç° `Comparable` æ¥å£ï¼Œæˆ–è€…ä¼ å…¥ `Comparator` ï¼›

- è¦ä¸¥æ ¼æŒ‰ç…§ `compare()` è§„èŒƒå®ç°æ¯”è¾ƒé€»è¾‘ï¼Œå¦åˆ™ï¼Œ`TreeMap` å°†ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚
