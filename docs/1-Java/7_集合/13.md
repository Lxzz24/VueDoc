---
title: ä½¿ç”¨ Stack
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æ ˆï¼ˆStackï¼‰æ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼šLast In First Outï¼‰çš„æ•°æ®ç»“æ„ã€‚

ä»€ä¹ˆæ˜¯ LIFO å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ Queue çš„ç‰¹ç‚¹ FIFOï¼š

![FIFO](assets/20221123092327.png)

æ‰€è°“ FIFOï¼Œæ˜¯æœ€å…ˆè¿›é˜Ÿåˆ—çš„å…ƒç´ ä¸€å®šæœ€æ—©å‡ºé˜Ÿåˆ—ï¼Œè€Œ LIFO æ˜¯æœ€åè¿› Stack çš„å…ƒç´ ä¸€å®šæœ€æ—©å‡º Stackã€‚å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿåªéœ€è¦æŠŠé˜Ÿåˆ—çš„ä¸€ç«¯å°æ­»ï¼š

![LIFO](assets/20221123092345.png)

å› æ­¤ï¼ŒStack æ˜¯è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼šåªèƒ½ä¸æ–­åœ°å¾€ Stack ä¸­å‹å…¥ï¼ˆpushï¼‰å…ƒç´ ï¼Œæœ€åè¿›å»çš„å¿…é¡»æœ€æ—©å¼¹å‡ºï¼ˆpopï¼‰æ¥ï¼š

![donuts-stack](assets/donuts-stack.png)

Stack åªæœ‰å…¥æ ˆå’Œå‡ºæ ˆçš„æ“ä½œï¼š

- æŠŠå…ƒç´ å‹æ ˆï¼š`push(E)`ï¼›
- æŠŠæ ˆé¡¶çš„å…ƒç´  â€œå¼¹å‡ºâ€ï¼š`pop()`ï¼›
- å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡ºï¼š`peek()`ã€‚

åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ _ç”¨ Deque å¯ä»¥å®ç° Stack_ çš„åŠŸèƒ½ï¼š

- æŠŠå…ƒç´ å‹æ ˆï¼š`push(E)` / `addFirst(E)`ï¼›
- æŠŠæ ˆé¡¶çš„å…ƒç´  â€œå¼¹å‡ºâ€ï¼š`pop()` / `removeFirst()`ï¼›
- å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡ºï¼š`peek()` / `peekFirst()`ã€‚

> ä¸ºä»€ä¹ˆ Java çš„é›†åˆç±»æ²¡æœ‰å•ç‹¬çš„ Stack æ¥å£å‘¢ï¼Ÿ

å› ä¸ºæœ‰ä¸ªé—ç•™ç±»åå­—å°±å« Stackï¼Œå‡ºäºå…¼å®¹æ€§è€ƒè™‘ï¼Œæ‰€ä»¥æ²¡åŠæ³•åˆ›å»º Stack æ¥å£ï¼Œåªèƒ½ç”¨ Deque æ¥å£æ¥ â€œæ¨¡æ‹Ÿâ€ ä¸€ä¸ª Stack äº†ã€‚

::: warning
å½“æˆ‘ä»¬æŠŠ Deque ä½œä¸º Stack ä½¿ç”¨æ—¶ï¼Œæ³¨æ„åªè°ƒç”¨ `push()` / `pop()` / `peek()` æ–¹æ³•ï¼Œä¸è¦è°ƒç”¨ `addFirst()` / `removeFirst()` / `peekFirst()` æ–¹æ³•ï¼Œè¿™æ ·ä»£ç æ›´åŠ æ¸…æ™°ã€‚

:::

## ğŸ€ Stack çš„ä½œç”¨

Stack åœ¨è®¡ç®—æœºä¸­ä½¿ç”¨éå¸¸å¹¿æ³›ï¼ŒJVM åœ¨å¤„ç† Java æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å°±ä¼šé€šè¿‡æ ˆè¿™ç§æ•°æ®ç»“æ„ç»´æŠ¤æ–¹æ³•è°ƒç”¨çš„å±‚æ¬¡ã€‚ä¾‹å¦‚ï¼š

```java
static void main(String[] args) {
    foo(123);
}

static String foo(x) {
    return "F-" + bar(x + 1);
}

static int bar(int x) {
    return x << 2;
}
```

JVM ä¼šåˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆï¼Œæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå…ˆå°†å‚æ•°å‹æ ˆï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼›å½“æ–¹æ³•è¿”å›æ—¶ï¼Œè¿”å›å€¼å‹æ ˆï¼Œè°ƒç”¨æ–¹æ³•é€šè¿‡å‡ºæ ˆæ“ä½œè·å¾—æ–¹æ³•è¿”å›å€¼ã€‚

å› ä¸ºæ–¹æ³•è°ƒç”¨æ ˆæœ‰å®¹é‡é™åˆ¶ï¼ŒåµŒå¥—è°ƒç”¨è¿‡å¤šä¼šé€ æˆæ ˆæº¢å‡ºï¼Œå³å¼•å‘ StackOverflowErrorï¼š

```java
// æµ‹è¯•æ— é™é€’å½’è°ƒç”¨
public class Main {
    public static void main(String[] args) {
        increase(1);
    }

    static int increase(int x) {
        return increase(x) + 1;
    }
}
```

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ª Stack çš„ç”¨é€”ï¼š_å¯¹æ•´æ•°è¿›è¡Œè¿›åˆ¶çš„è½¬æ¢å°±å¯ä»¥åˆ©ç”¨æ ˆ_ã€‚

> ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æŠŠä¸€ä¸ª int æ•´æ•° 12500 è½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼Œå¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªç©ºæ ˆï¼š

![](assets/20221123092537.png)

ç„¶åè®¡ç®— $12500 Ã· 16 = 781 Â·Â·Â·Â·Â·Â· 4$ï¼Œä½™æ•°æ˜¯ 4ï¼ŒæŠŠä½™æ•° 4 å‹æ ˆï¼š

![](assets/20221123092553.png)

ç„¶åè®¡ç®— $781 Ã· 16 = 48 Â·Â·Â·Â·Â·Â· 13$ï¼Œä½™æ•°æ˜¯ 13ï¼Œ13 çš„åå…­è¿›åˆ¶ç”¨å­—æ¯ D è¡¨ç¤ºï¼ŒæŠŠä½™æ•° D å‹æ ˆï¼š

![](assets/20221123092610.png)

ç„¶åè®¡ç®— $48 Ã· 16 = 3 Â·Â·Â·Â·Â·Â· 0$ï¼Œä½™æ•°æ˜¯ 0ï¼ŒæŠŠä½™æ•° 0 å‹æ ˆï¼š

![](assets/20221123092625.png)

æœ€åè®¡ç®— $3 Ã· 16 = 0 Â·Â·Â·Â·Â·Â· 3$ï¼Œä½™æ•°æ˜¯ 3ï¼ŒæŠŠä½™æ•° 3 å‹æ ˆï¼š

![](assets/20221123092644.png)

å½“å•†æ˜¯ 0 çš„æ—¶å€™ï¼Œè®¡ç®—ç»“æŸï¼Œæˆ‘ä»¬æŠŠæ ˆçš„æ‰€æœ‰å…ƒç´ ä¾æ¬¡å¼¹å‡ºï¼Œç»„æˆå­—ç¬¦ä¸² $30D4$ï¼Œè¿™å°±æ˜¯åè¿›åˆ¶æ•´æ•° 12500 çš„åå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚

## ğŸ€ è®¡ç®—ä¸­ç¼€è¡¨è¾¾å¼

åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å¸¦æ‹¬å·çš„æ•°å­¦è¡¨è¾¾å¼å®é™…ä¸Šæ˜¯ä¸­ç¼€è¡¨è¾¾å¼ï¼Œå³è¿ç®—ç¬¦åœ¨ä¸­é—´ï¼Œä¾‹å¦‚ï¼š $1 + 2 \times (9 - 5)$ ã€‚

ä½†æ˜¯è®¡ç®—æœºæ‰§è¡Œè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå®ƒå¹¶ **ä¸èƒ½** ç›´æ¥è®¡ç®—ä¸­ç¼€è¡¨è¾¾å¼ï¼Œè€Œæ˜¯é€šè¿‡ç¼–è¯‘å™¨æŠŠä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸º **åç¼€è¡¨è¾¾å¼**ï¼Œä¾‹å¦‚ï¼š `1 2 9 5 - Ã— +` ã€‚

è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹å°±ä¼šç”¨åˆ°æ ˆã€‚æˆ‘ä»¬å…ˆè·³è¿‡ç¼–è¯‘è¿™ä¸€æ­¥ï¼ˆæ¶‰åŠè¿ç®—ä¼˜å…ˆçº§ï¼Œä»£ç æ¯”è¾ƒå¤æ‚ï¼‰ï¼Œçœ‹çœ‹å¦‚ä½•é€šè¿‡æ ˆè®¡ç®—åç¼€è¡¨è¾¾å¼ã€‚

è®¡ç®—åç¼€è¡¨è¾¾å¼ä¸è€ƒè™‘ä¼˜å…ˆçº§ï¼Œç›´æ¥ä»å·¦åˆ°å³ä¾æ¬¡è®¡ç®—ï¼Œå› æ­¤è®¡ç®—èµ·æ¥ç®€å•ã€‚é¦–å…ˆå‡†å¤‡ä¸€ä¸ªç©ºçš„æ ˆï¼š

![](assets/20221123092537.png)

ç„¶åæˆ‘ä»¬ä¾æ¬¡æ‰«æåç¼€è¡¨è¾¾å¼ `1 2 9 5 - Ã— +`ï¼Œé‡åˆ°æ•°å­— 1ï¼Œå°±ç›´æ¥æ‰”åˆ°æ ˆé‡Œï¼š

![](assets/20221123092955.png)

ç´§æ¥ç€ï¼Œé‡åˆ°æ•°å­— `2 9 5`ï¼Œä¹Ÿæ‰”åˆ°æ ˆé‡Œï¼š

![](assets/20221123093015.png)

æ¥ä¸‹æ¥é‡åˆ°å‡å·æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶è®¡ç®— $9 - 5 = 4$ï¼ŒæŠŠç»“æœ 4 å‹æ ˆï¼š

![](assets/20221123093037.png)

æ¥ä¸‹æ¥é‡åˆ° $\times$ å·æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶è®¡ç®— $2\times 4=8$ï¼ŒæŠŠç»“æœ 8 å‹æ ˆï¼š

![](assets/20221123093057.png)

æ¥ä¸‹æ¥é‡åˆ° $+$ å·æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶è®¡ç®— $1 + 8 = 9$ï¼ŒæŠŠç»“æœ 9 å‹æ ˆï¼š

![](assets/20221123093112.png)

æ‰«æç»“æŸåï¼Œæ²¡æœ‰æ›´å¤šçš„è®¡ç®—äº†ï¼Œå¼¹å‡ºæ ˆçš„å”¯ä¸€ä¸€ä¸ªå…ƒç´ ï¼Œå¾—åˆ°è®¡ç®—ç»“æœ 9ã€‚

## ğŸ€ ç»ƒä¹ 

::: code-tabs

@tab åå…­è¿›åˆ¶è½¬æ¢

```java
// è¯·åˆ©ç”¨ Stack æŠŠä¸€ä¸ªç»™å®šçš„æ•´æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼š
import java.util.*;

public class Main {
    public static void main(String[] args) {
        String hex = toHex(12500);
        if (hex.equalsIgnoreCase("30D4")) {
            System.out.println("æµ‹è¯•é€šè¿‡");
        } else {
            System.out.println("æµ‹è¯•å¤±è´¥");
        }
    }

    static String toHex(int n) {
        // æ–¹æ³• 1
        // Deque<String> deque = new LinkedList<>();
        // String result = "";
        // int hex = 0;
        // while (n > 0){
        //     hex = n % 16;
        //     if (hex >= 10){
        //         switch (hex){
        //             case 10:
        //                 deque.push("A");
        //                 break;
        //             case 11:
        //                 deque.push("B");
        //                 break;
        //             case 12:
        //                 deque.push("C");
        //                 break;
        //             case 13:
        //                 deque.push("D");
        //                 break;
        //             case 14:
        //                 deque.push("E");
        //                 break;
        //             case 15:
        //                 deque.push("F");
        //                 break;
        //         }
        //     }else {
        //         deque.push("" + hex);
        //     }
        //     n = n / 16;
        // }
        // while(!deque.isEmpty()){
        //     result += deque.pop();
        // }
        // return result;

        // æ–¹æ³• 2
        List<String> hexList = Arrays.asList("0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F");
        Deque<String> stack = new LinkedList<>();
        while (n != 0) {
            stack.push(hexList.get(n % 16));
            n = n / 16;
        }
        StringBuilder sb = new StringBuilder();
        while (stack.peek() != null) {
            sb.append(stack.pop());
        }
        return sb.toString();
    }
}
```

@tab è¿›é˜¶ç»ƒä¹  1

```java
// è¯·åˆ©ç”¨ Stack æŠŠå­—ç¬¦ä¸²ä¸­ç¼€è¡¨è¾¾å¼ç¼–è¯‘ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œ
// ç„¶åå†åˆ©ç”¨æ ˆæ‰§è¡Œåç¼€è¡¨è¾¾å¼è·å¾—è®¡ç®—ç»“æœï¼š
// é«˜éš¾åº¦ç»ƒä¹ ï¼Œæ…é‡é€‰æ‹©ï¼
import java.util.*;

public class Main {
    public static void main(String[] args) {
        String exp = "1 + 2 * (9 - 5)";
        SuffixExpression se = compile(exp);
        int result = se.execute();
        System.out.println(exp + " = " + result + " " + (result == 1 + 2 * (9 - 5) ? "âœ“" : "âœ—"));
    }

    static SuffixExpression compile(String exp) {
        // TODO:
        rDeque<String> stack = new LinkedList<>();
        char[] expCharArr = exp.toCharArray();
        String numStr = "0123456789";
        // æ“ä½œç¬¦ï¼Œä¼˜å…ˆçº§
        Map<String, Integer> operationMap = new HashMap() {
            {
                put("+", 1);
                put("-", 1);
                put("*", 2);
                put("/", 2);
                put("(", 3);
                put(")", 3);
            }
        };
        StringBuilder sb = new StringBuilder();
        for (char c : expCharArr) {
            if (c == ' ') {
                continue;
            }
            if (numStr.indexOf(c) > 0) {
                // æ“ä½œæ•°ç›´æ¥è¿”å›
                sb.append(String.valueOf(c));
            } else {
                // æ“ä½œç¬¦ï¼š
                if (stack.peek() == null) {
                    stack.push(String.valueOf(c));
                } else if (")".equals(String.valueOf(c))) {
                    while (stack.peek() != null && !"(".equals(stack.peek())) {
                        sb.append(stack.pop());
                    }
                    if ("(".equals(stack.peek())) {
                        stack.pop();
                    }
                } else if (operationMap.get(String.valueOf(c)) > operationMap.get(stack.peek())) {
                    stack.push(String.valueOf(c));
                } else {
                    while (stack.peek() != null && operationMap.get(String.valueOf(c)) <= operationMap.get(stack.peek())) {
                        if ("(".equals(stack.peek())) {
                            break;
                        } else {
                            sb.append(stack.pop());
                        }
                    }
                    if ("(".equals(stack.peek())) {
                        stack.pop();
                    }
                    stack.push(String.valueOf(c));
                }
            }
        }
        while (stack.peek() != null) {
            sb.append(stack.pop());
        }
        return new SuffixExpression(sb.toString());
    }
}

class SuffixExpression {
    private String executeExpression;

    public SuffixExpression(String executeExpression) {
        this.executeExpression = executeExpression;
    }

    int execute() {
        // TODO:
        Deque<String> stack = new LinkedList<>();
        char[] expCharArr = this.executeExpression.toCharArray();
        String numStr = "0123456789";
        Integer result = 0;
        Integer intA;
        Integer intB;
        for (char c : expCharArr) {
            if (numStr.indexOf(c) > 0) {
                stack.push(String.valueOf(c));
            } else {
                intA = Integer.valueOf(stack.pop());
                intB = Integer.valueOf(stack.pop());
                if ('+' == c) {
                    result = intB + intA;
                } else if ('-' == c) {
                    result = intB - intA;
                } else if ('*' == c) {
                    result = intB * intA;
                } else if ('/' == c) {
                    result = intB / intA;
                }
                stack.push(String.valueOf(result));
            }
        }
        return Integer.valueOf(stack.pop());
    }
}
```

@tab è¿›é˜¶ç»ƒä¹  2

```java
// è¯·æŠŠå¸¦å˜é‡çš„ä¸­ç¼€è¡¨è¾¾å¼ç¼–è¯‘ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œ
// æ‰§è¡Œåç¼€è¡¨è¾¾å¼æ—¶ï¼Œä¼ å…¥å˜é‡çš„å€¼å¹¶è·å¾—è®¡ç®—ç»“æœï¼š
// è¶…é«˜éš¾åº¦ç»ƒä¹ ï¼Œæ…é‡é€‰æ‹©ï¼
import java.util.*;

public class Main {
    public static void main(String[] args) {
        String exp = "x + 2 * (y - 5)";
        SuffixExpression se = compile(exp);
        Map<String, Integer> env = Map.of("x", 1, "y", 9);
        int result = se.execute(env);
        System.out.println(exp + " = " + result + " " + (result == 1 + 2 * (9 - 5) ? "âœ“" : "âœ—"));
    }

    public static boolean isOperator(String str){
        if(str!=null && "\\+-*/\\(\\)".indexOf(str)>0){
            return true;
        }else{
            return false;
        }
    }

    static SuffixExpression compile(String exp) {
        // TODO:
        Deque<String> stack = new LinkedList<>();
        char[] expCharArr = exp.toCharArray();
        String numStr = "0123456789";
        Map<String,Integer> operationMap = new HashMap(){
            {
                put("+", 1);
                put("-", 1);
                put("*", 2);
                put("/", 2);
                put("(", 3);
                put(")", 3);
            }
        };
        StringBuilder sb = new StringBuilder();
        for(char c : expCharArr){
            if(c==' '){
                continue;
            }
            if(!isOperator(String.valueOf(c))){
                //æ“ä½œæ•°ç›´æ¥è¿”å›
                sb.append(String.valueOf(c));
            }else{
                //æ“ä½œç¬¦ï¼š
                if(stack.peek()==null ){
                    stack.push(String.valueOf(c));
                }else if(")".equals(String.valueOf(c))){
                    while(stack.peek()!=null && !"(".equals(stack.peek())){
                        sb.append(stack.pop());
                    }
                    if("(".equals(stack.peek())){
                        stack.pop();
                    }
                }else if(operationMap.get(String.valueOf(c))>operationMap.get(stack.peek())){
                    stack.push(String.valueOf(c));
                }else{
                    while(stack.peek()!=null && operationMap.get(String.valueOf(c))<=operationMap.get(stack.peek())){
                        if("(".equals(stack.peek())){
                            break;
                        }else{
                            sb.append(stack.pop());
                        }
                    }
                    if("(".equals(stack.peek())){
                        stack.pop();
                    }
                    stack.push(String.valueOf(c));
                }
            }
        }
        while(stack.peek()!=null){
            sb.append(stack.pop());
        }

        return new SuffixExpression(sb.toString());
    }
}

class SuffixExpression {
    private String executeExpression;
    public SuffixExpression(String executeExpression){
        this.executeExpression = executeExpression;
    }
    int execute(Map<String, Integer> env){
        Deque<String> stack = new LinkedList<>();
        char[] expCharArr = this.executeExpression.toCharArray();
        Integer result=0;
        Integer intA;
        Integer intB;
        String A;
        String B;
        for(char c : expCharArr){
            if(!Main.isOperator(String.valueOf(c))){
                stack.push(String.valueOf(c));
            }else{
                A = stack.pop();
                B = stack.pop();
                A = env.get(A)==null? A:env.get(A).toString();
                B = env.get(B)==null? B:env.get(B).toString();
                intA = Integer.valueOf(A);
                intB = Integer.valueOf(B);
                if('+'==c){
                    result = intB + intA;
                }else if('-'==c){
                    result = intB - intA;
                }else if('*'==c){
                    result = intB * intA;
                }else if('/'==c){
                    result = intB / intA;
                }
                stack.push(String.valueOf(result));
            }
        }
        return Integer.valueOf(stack.pop());
    }
}
```

:::

## ğŸ€ å°ç»“

1. æ ˆï¼ˆStackï¼‰æ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œæ“ä½œæ ˆçš„å…ƒç´ çš„æ–¹æ³•æœ‰ï¼š

   - æŠŠå…ƒç´ å‹æ ˆï¼š`push(E)`ï¼›
   - æŠŠæ ˆé¡¶çš„å…ƒç´  â€œå¼¹å‡ºâ€ï¼š`pop(E)`ï¼›
   - å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡ºï¼š`peek(E)`ã€‚

2. åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ç”¨ Deque å¯ä»¥å®ç° Stack çš„åŠŸèƒ½ï¼Œæ³¨æ„åªè°ƒç”¨ `push()` / `pop()` / `peek()` æ–¹æ³•ï¼Œé¿å…è°ƒç”¨ Deque çš„å…¶ä»–æ–¹æ³•ã€‚

3. æœ€åï¼Œ**ä¸è¦** ä½¿ç”¨é—ç•™ç±» Stackã€‚
