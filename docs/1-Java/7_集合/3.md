---
title: ç¼–å†™ equals æ–¹æ³•
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

æˆ‘ä»¬çŸ¥é“ `List` æ˜¯ä¸€ç§æœ‰åºé“¾è¡¨ï¼š `List` å†…éƒ¨æŒ‰ç…§æ”¾å…¥å…ƒç´ çš„å…ˆåé¡ºåºå­˜æ”¾ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥é€šè¿‡ç´¢å¼•ç¡®å®šè‡ªå·±çš„ä½ç½®ã€‚

`List` è¿˜æä¾›äº† `boolean contains(Object o)` æ–¹æ³•æ¥åˆ¤æ–­ `List` æ˜¯å¦åŒ…å«æŸä¸ªæŒ‡å®šå…ƒç´ ã€‚æ­¤å¤–ï¼Œ `int indexOf(Object o)` æ–¹æ³•å¯ä»¥è¿”å›æŸä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œå°±è¿”å› `-1` ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```java
import java.util.List;
public class Main {
    public static void main(String[] args) {
        List<String> list = List.of("A", "B", "C");
        System.out.println(list.contains("C")); // true
        System.out.println(list.contains("X")); // false
        System.out.println(list.indexOf("C")); // 2
        System.out.println(list.indexOf("X")); // -1
    }
}
```

è¿™é‡Œæˆ‘ä»¬æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾€ `List` ä¸­æ·»åŠ çš„ `"C"` å’Œè°ƒç”¨ `contains("C")` ä¼ å…¥çš„ `"C"` æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Ÿ

å¦‚æœè¿™ä¸¤ä¸ª `"C"` ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ®µä»£ç æ˜¯å¦è¿˜èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Ÿæˆ‘ä»¬å¯ä»¥æ”¹å†™ä¸€ä¸‹ä»£ç æµ‹è¯•ä¸€ä¸‹ï¼š

```java
import java.util.List;
public class Main {
    public static void main(String[] args) {
        List<String> list = List.of("A", "B", "C");
        System.out.println(list.contains(new String("C"))); // true or false?
        System.out.println(list.indexOf(new String("C"))); // 2 or -1?
    }
}
```

å› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„æ˜¯ `new String("C")` ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯ä¸åŒçš„å®ä¾‹ã€‚ç»“æœä»ç„¶ç¬¦åˆé¢„æœŸï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸º `List` å†…éƒ¨å¹¶ä¸æ˜¯é€šè¿‡ `==` åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨ `equals()` æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œä¾‹å¦‚ `contains()` æ–¹æ³•å¯ä»¥å®ç°å¦‚ä¸‹ï¼š

```java
public class ArrayList {
    Object[] elementData;
    public boolean contains(Object o) {
        for (int i = 0; i < elementData.length; i++) {
            if (o.equals(elementData[i])) {
                return true;
            }
        }
        return false;
    }
}
```

å› æ­¤ï¼Œè¦æ­£ç¡®ä½¿ç”¨ `List` çš„ `contains()` ã€ `indexOf()` è¿™äº›æ–¹æ³•ï¼Œæ”¾å…¥çš„å®ä¾‹å¿…é¡»æ­£ç¡®è¦†å†™ `equals()` æ–¹æ³•ï¼Œå¦åˆ™ï¼Œæ”¾è¿›å»çš„å®ä¾‹ï¼ŒæŸ¥æ‰¾ä¸åˆ°ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½æ­£å¸¸æ”¾å…¥ `String` ã€ `Integer` è¿™äº›å¯¹è±¡ï¼Œæ˜¯å› ä¸º Java æ ‡å‡†åº“å®šä¹‰çš„è¿™äº›ç±»å·²ç»æ­£ç¡®å®ç°äº† `equals()` æ–¹æ³•ã€‚

æˆ‘ä»¬ä»¥ `Person` å¯¹è±¡ä¸ºä¾‹ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼š

```java
import java.util.List;
public class Main {
    public static void main(String[] args) {
        List<Person> list = List.of(
            new Person("Xiao Ming"),
            new Person("Xiao Hong"),
            new Person("Bob")
        );
        System.out.println(list.contains(new Person("Bob"))); // false
    }
}

class Person {
    String name;
    public Person(String name) {
        this.name = name;
    }
}
```

ä¸å‡ºæ„å¤–ï¼Œè™½ç„¶æ”¾å…¥äº† `new Person("Bob")` ï¼Œä½†æ˜¯ç”¨å¦ä¸€ä¸ª `new Person("Bob")` æŸ¥è¯¢ä¸åˆ°ï¼ŒåŸå› å°±æ˜¯ `Person` ç±»æ²¡æœ‰è¦†å†™ `equals()` æ–¹æ³•ã€‚

## ğŸ€ ç¼–å†™ equals

å¦‚ä½•æ­£ç¡®ç¼–å†™ `equals()` æ–¹æ³•ï¼Ÿ `equals()` æ–¹æ³•è¦æ±‚æˆ‘ä»¬å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- è‡ªåæ€§ï¼ˆReflexiveï¼‰ï¼šå¯¹äºé `null` çš„ `x` æ¥è¯´ï¼Œ `x.equals(x)` å¿…é¡»è¿”å› `true` ï¼›
- å¯¹ç§°æ€§ï¼ˆSymmetricï¼‰ï¼šå¯¹äºé `null` çš„ `x` å’Œ `y` æ¥è¯´ï¼Œå¦‚æœ `x.equals(y)` ä¸º `true` ï¼Œåˆ™ `y.equals(x)` ä¹Ÿå¿…é¡»ä¸º `true` ï¼›
- ä¼ é€’æ€§ï¼ˆTransitiveï¼‰ï¼šå¯¹äºé `null` çš„ `x` ã€ `y` å’Œ `z` æ¥è¯´ï¼Œå¦‚æœ `x.equals(y)` ä¸º `true` ï¼Œ `y.equals(z)` ä¹Ÿä¸º `true` ï¼Œé‚£ä¹ˆ `x.equals(z)` ä¹Ÿå¿…é¡»ä¸º `true` ï¼›
- ä¸€è‡´æ€§ï¼ˆConsistentï¼‰ï¼šå¯¹äºé `null` çš„ `x` å’Œ `y` æ¥è¯´ï¼Œåªè¦ `x` å’Œ `y` çŠ¶æ€ä¸å˜ï¼Œåˆ™ `x.equals(y)` æ€»æ˜¯ä¸€è‡´åœ°è¿”å› `true` æˆ–è€… `false` ï¼›
- å¯¹ `null` çš„æ¯”è¾ƒï¼šå³ `x.equals(null)` æ°¸è¿œè¿”å› `false` ã€‚

ä¸Šè¿°è§„åˆ™çœ‹ä¸Šå»ä¼¼ä¹éå¸¸å¤æ‚ï¼Œä½†å…¶å®ä»£ç å®ç° `equals()` æ–¹æ³•æ˜¯å¾ˆç®€å•çš„ï¼Œæˆ‘ä»¬ä»¥ `Person` ç±»ä¸ºä¾‹ï¼š

```java
public class Person {
    public String name;
    public int age;
}
```

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰ â€œç›¸ç­‰â€ çš„é€»è¾‘å«ä¹‰ã€‚å¯¹äº `Person` ç±»ï¼Œå¦‚æœ `name` ç›¸ç­‰ï¼Œå¹¶ä¸” `age` ç›¸ç­‰ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºä¸¤ä¸ª `Person` å®ä¾‹ç›¸ç­‰ã€‚

å› æ­¤ï¼Œç¼–å†™ `equals()` æ–¹æ³•å¦‚ä¸‹ï¼š

```java
public boolean equals(Object o) {
    if (o instanceof Person) {
        Person p = (Person) o;
        return this.name.equals(p.name) && this.age == p.age;
    }
    return false;
}
```

å¯¹äºå¼•ç”¨å­—æ®µæ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨ `equals()` ï¼Œå¯¹äºåŸºæœ¬ç±»å‹å­—æ®µçš„æ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨ `==` ã€‚

å¦‚æœ `this.name` ä¸º `null` ï¼Œé‚£ä¹ˆ `equals()` æ–¹æ³•ä¼šæŠ¥é”™ï¼Œå› æ­¤ï¼Œéœ€è¦ç»§ç»­æ”¹å†™å¦‚ä¸‹ï¼š

```java
public boolean equals(Object o) {
    if (o instanceof Person) {
        Person p = (Person) o;
        boolean nameEquals = false;
        if (this.name == null && p.name == null) {
            nameEquals = true;
        }
        if (this.name != null) {
            nameEquals = this.name.equals(p.name);
        }
        return nameEquals && this.age == p.age;
    }
    return false;
}
```

å¦‚æœ `Person` æœ‰å¥½å‡ ä¸ªå¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œä¸Šé¢çš„å†™æ³•å°±å¤ªå¤æ‚äº†ã€‚è¦ç®€åŒ–å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨ `Objects.equals()` é™æ€æ–¹æ³•ï¼š

```java
public boolean equals(Object o) {
    if (o instanceof Person) {
        Person p = (Person) o;
        return Objects.equals(this.name, p.name) && this.age == p.age;
    }
    return false;
}
```

å› æ­¤ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ `equals()` æ–¹æ³•çš„æ­£ç¡®ç¼–å†™æ–¹æ³•ï¼š

1. å…ˆç¡®å®šå®ä¾‹ â€œç›¸ç­‰â€ çš„é€»è¾‘ï¼Œå³å“ªäº›å­—æ®µç›¸ç­‰ï¼Œå°±è®¤ä¸ºå®ä¾‹ç›¸ç­‰ï¼›
2. ç”¨ `instanceof` åˆ¤æ–­ä¼ å…¥çš„å¾…æ¯”è¾ƒçš„ `Object` æ˜¯ä¸æ˜¯å½“å‰ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œç»§ç»­æ¯”è¾ƒï¼Œå¦åˆ™ï¼Œè¿”å› `false` ï¼›
3. å¯¹å¼•ç”¨ç±»å‹ç”¨ `Objects.equals()` æ¯”è¾ƒï¼Œå¯¹åŸºæœ¬ç±»å‹ç›´æ¥ç”¨ `==` æ¯”è¾ƒã€‚

ä½¿ç”¨ `Objects.equals()` æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨ç±»å‹æ˜¯å¦ç›¸ç­‰çš„ç›®çš„æ˜¯çœå»äº†åˆ¤æ–­ `null` çš„éº»çƒ¦ã€‚ä¸¤ä¸ªå¼•ç”¨ç±»å‹éƒ½æ˜¯ `null` æ—¶å®ƒä»¬ä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚

å¦‚æœä¸è°ƒç”¨ `List` çš„ `contains()` ã€ `indexOf()` è¿™äº›æ–¹æ³•ï¼Œé‚£ä¹ˆæ”¾å…¥çš„å…ƒç´ å°±ä¸éœ€è¦å®ç° `equals()` æ–¹æ³•ã€‚

## ğŸ€ ç»ƒä¹ 

ç»™ Person ç±»å¢åŠ  equals æ–¹æ³•ï¼Œä½¿å¾—è°ƒç”¨ indexOf() æ–¹æ³•è¿”å›æ­£å¸¸ï¼š

```java
import java.util.List;
import java.util.Objects;

public class Main {
    public static void main(String[] args) {
        List<Person> list = List.of(
            new Person("Xiao", "Ming", 18),
            new Person("Xiao", "Hong", 25),
            new Person("Bob", "Smith", 20)
        );
        boolean exist = list.contains(new Person("Bob", "Smith", 20));
        System.out.println(exist ? "æµ‹è¯•æˆåŠŸ!" : "æµ‹è¯•å¤±è´¥!");
    }
}

class Person {
    String firstName;
    String lastName;
    int age;
    public Person(String firstName, String lastName, int age) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.age = age;
    }
    /**
	 * TODO: è¦†å†™equalsæ–¹æ³•
	 */
}
```

## ğŸ€ å°ç»“

- åœ¨ `List` ä¸­æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œ `List` çš„å®ç°ç±»é€šè¿‡å…ƒç´ çš„ `equals()` æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå› æ­¤ï¼Œæ”¾å…¥çš„å…ƒç´ å¿…é¡»æ­£ç¡®è¦†å†™ `equals()` æ–¹æ³•ï¼ŒJava æ ‡å‡†åº“æä¾›çš„ `String` ã€ `Integer` ç­‰å·²ç»è¦†å†™äº† `equals()` æ–¹æ³•ï¼›

- ç¼–å†™ `equals()` æ–¹æ³•å¯å€ŸåŠ© `Objects.equals()` åˆ¤æ–­ã€‚

- å¦‚æœä¸åœ¨ `List` ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œå°±ä¸å¿…è¦†å†™ `equals()` æ–¹æ³•ã€‚


