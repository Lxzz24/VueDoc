---
title: æœ€ä½³å®è·µ
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

ç”±äº Java æä¾›äº†æ–°æ—§ä¸¤å¥—æ—¥æœŸå’Œæ—¶é—´çš„ APIï¼Œé™¤éæ¶‰åŠåˆ°é—ç•™ä»£ç ï¼Œå¦åˆ™æˆ‘ä»¬åº”è¯¥åšæŒä½¿ç”¨æ–°çš„ APIã€‚

å¦‚æœéœ€è¦ä¸é—ç•™ä»£ç æ‰“äº¤é“ï¼Œå¦‚ä½•åœ¨æ–°æ—§ API ä¹‹é—´äº’ç›¸è½¬æ¢å‘¢ï¼Ÿ

## ğŸ€ æ—§ API è½¬æ–° API

å¦‚æœè¦æŠŠæ—§å¼çš„ `Date` æˆ– `Calendar` è½¬æ¢ä¸ºæ–° API å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ `toInstant()` æ–¹æ³•è½¬æ¢ä¸º `Instant` å¯¹è±¡ï¼Œå†ç»§ç»­è½¬æ¢ä¸º `ZonedDateTime` ï¼š

```java
// Date -> Instant:
Instant ins1 = new Date().toInstant();

// Calendar -> Instant -> ZonedDateTime:
Calendar calendar = Calendar.getInstance();
Instant ins2 = calendar.toInstant();
ZonedDateTime zdt = ins2.atZone(calendar.getTimeZone().toZoneId());
```

ä»ä¸Šé¢çš„ä»£ç è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæ—§çš„ `TimeZone` æä¾›äº†ä¸€ä¸ª `toZoneId()`ï¼Œå¯ä»¥æŠŠè‡ªå·±å˜æˆæ–°çš„ `ZoneId` ã€‚

## ğŸ€ æ–° API è½¬æ—§ API

å¦‚æœè¦æŠŠæ–°çš„ `ZonedDateTime` è½¬æ¢ä¸ºæ—§çš„ API å¯¹è±¡ï¼Œåªèƒ½å€ŸåŠ© `long` å‹æ—¶é—´æˆ³åšä¸€ä¸ª â€œä¸­è½¬â€ï¼š

```java
// ZonedDateTime -> long:
ZonedDateTime zdt = ZonedDateTime.now();
long ts = zdt.toEpochSecond() * 1000;

// long -> Date:
Date date = new Date(ts);

// long -> Calendar:
Calendar calendar = Calendar.getInstance();
calendar.clear();
calendar.setTimeZone(TimeZone.getTimeZone(zdt.getZone().getId()));
calendar.setTimeInMillis(zdt.toEpochSecond() * 1000);
```

ä»ä¸Šé¢çš„ä»£ç è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„ `ZoneId` è½¬æ¢ä¸ºæ—§çš„ `TimeZone`ï¼Œéœ€è¦å€ŸåŠ© `ZoneId.getId()` è¿”å›çš„ `String` å®Œæˆã€‚

## ğŸ€ åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´

é™¤äº†æ—§å¼çš„ java.util.Date ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‰¾åˆ°å¦ä¸€ä¸ª java.sql.Date ï¼Œå®ƒç»§æ‰¿è‡ª java.util.Date ï¼Œä½†ä¼šè‡ªåŠ¨å¿½ç•¥æ‰€æœ‰æ—¶é—´ç›¸å…³ä¿¡æ¯ã€‚è¿™ä¸ªå¥‡è‘©çš„è®¾è®¡åŸå› è¦è¿½æº¯åˆ°æ•°æ®åº“çš„æ—¥æœŸä¸æ—¶é—´ç±»å‹ã€‚

åœ¨æ•°æ®åº“ä¸­ï¼Œä¹Ÿå­˜åœ¨å‡ ç§æ—¥æœŸå’Œæ—¶é—´ç±»å‹ï¼š

- `DATETIME` ï¼šè¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼›
- `DATE` ï¼šä»…è¡¨ç¤ºæ—¥æœŸï¼›
- `TIME` ï¼šä»…è¡¨ç¤ºæ—¶é—´ï¼›
- `TIMESTAMP` ï¼šå’Œ `DATETIME` ç±»ä¼¼ï¼Œä½†æ˜¯æ•°æ®åº“ä¼šåœ¨åˆ›å»ºæˆ–è€…æ›´æ–°è®°å½•çš„æ—¶å€™åŒæ—¶ä¿®æ”¹ `TIMESTAMP` ã€‚

åœ¨ä½¿ç”¨ Java ç¨‹åºæ“ä½œæ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®åº“ç±»å‹ä¸ Java ç±»å‹æ˜ å°„èµ·æ¥ã€‚ä¸‹è¡¨æ˜¯æ•°æ®åº“ç±»å‹ä¸ Java æ–°æ—§ API çš„æ˜ å°„å…³ç³»ï¼š

| æ•°æ®åº“    | å¯¹åº” Java ç±»ï¼ˆæ—§ï¼‰ | å¯¹åº” Java ç±»ï¼ˆæ–°ï¼‰ |
| --------- | ------------------ | ------------------ |
| DATETIME  | java.util.Date     | LocalDateTime      |
| DATE      | java.sql.Date      | LocalDate          |
| TIME      | java.sql.Time      | LocalTime          |
| TIMESTAMP | java.sql.Timestamp | LocalDateTime      |

å®é™…ä¸Šï¼Œåœ¨æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨çš„æœ€å¸¸ç”¨çš„æ˜¯æ—¶åˆ»ï¼ˆ `Instant` ï¼‰ï¼Œå› ä¸ºæœ‰äº†æ—¶åˆ»ä¿¡æ¯ï¼Œå°±å¯ä»¥æ ¹æ®ç”¨æˆ·è‡ªå·±é€‰æ‹©çš„æ—¶åŒºï¼Œæ˜¾ç¤ºå‡ºæ­£ç¡®çš„æœ¬åœ°æ—¶é—´ã€‚æ‰€ä»¥ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ç›´æ¥ç”¨é•¿æ•´æ•° `long` è¡¨ç¤ºï¼Œåœ¨æ•°æ®åº“ä¸­å­˜å‚¨ä¸º `BIGINT` ç±»å‹ã€‚

é€šè¿‡å­˜å‚¨ä¸€ä¸ª `long` å‹æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª `timestampToString()` çš„æ–¹æ³•ï¼Œéå¸¸ç®€å•åœ°ä¸ºä¸åŒç”¨æˆ·ä»¥ä¸åŒçš„åå¥½æ¥æ˜¾ç¤ºä¸åŒçš„æœ¬åœ°æ—¶é—´ï¼š

```java
import java.time.*;
import java.time.format.*;
import java.util.Locale;

public class Main {
    public static void main(String[] args) {
        long ts = 1574208900000L;
        System.out.println(timestampToString(ts, Locale.CHINA, "Asia/Shanghai"));
        System.out.println(timestampToString(ts, Locale.US, "America/New_York"));
    }

    static String timestampToString(long epochMilli, Locale lo, String zoneId) {
        Instant ins = Instant.ofEpochMilli(epochMilli);
        DateTimeFormatter f = DateTimeFormatter.ofLocalizedDateTime(FormatStyle.MEDIUM, FormatStyle.SHORT);
        return f.withLocale(lo).format(ZonedDateTime.ofInstant(ins, ZoneId.of(zoneId)));
    }
}
```

å¯¹ä¸Šè¿°æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œç»“æœå¦‚ä¸‹ï¼š

```
2019 å¹´ 11 æœˆ 20 æ—¥ ä¸Šåˆ 8:15
Nov 19, 2019, 7:15 PM
```

## ğŸ€ å°ç»“

å¤„ç†æ—¥æœŸå’Œæ—¶é—´æ—¶ï¼Œå°½é‡ä½¿ç”¨æ–°çš„ java.time åŒ…ï¼›

åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ—¶é—´æˆ³æ—¶ï¼Œå°½é‡ä½¿ç”¨ `long` å‹æ—¶é—´æˆ³ï¼Œå®ƒå…·æœ‰çœç©ºé—´ï¼Œæ•ˆç‡é«˜ï¼Œä¸ä¾èµ–æ•°æ®åº“çš„ä¼˜ç‚¹ã€‚
