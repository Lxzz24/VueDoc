---
title: æŠ›å‡ºå¼‚å¸¸
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

## ğŸ€ å¼‚å¸¸çš„ä¼ æ’­

å½“æŸä¸ªæ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸æ—¶ï¼Œå¦‚æœå½“å‰æ–¹æ³•æ²¡æœ‰æ•è·å¼‚å¸¸ï¼Œå¼‚å¸¸å°±ä¼šè¢«æŠ›åˆ°ä¸Šå±‚è°ƒç”¨æ–¹æ³•ï¼Œç›´åˆ°é‡åˆ°æŸä¸ª `try ... catch` è¢«æ•è·ä¸ºæ­¢ï¼š

```java
public class Main {
    public static void main(String[] args) {
        try {
            process1();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    static void process1() {
        process2();
    }

    static void process2() {
        Integer.parseInt(null); // ä¼šæŠ›å‡º NumberFormatException
    }
}
```

**_é€šè¿‡ `printStackTrace()` å¯ä»¥æ‰“å°å‡ºæ–¹æ³•çš„è°ƒç”¨æ ˆ_** ï¼Œç±»ä¼¼ï¼š

```
java.lang.NumberFormatException: null
    at java.base/java.lang.Integer.parseInt(Integer.java:614)
    at java.base/java.lang.Integer.parseInt(Integer.java:770)
    at Main.process2(Main.java:16)
    at Main.process1(Main.java:12)
    at Main.main(Main.java:5)
```

`printStackTrace()` å¯¹äºè°ƒè¯•é”™è¯¯éå¸¸æœ‰ç”¨ï¼Œä¸Šè¿°ä¿¡æ¯è¡¨ç¤ºï¼š `NumberFormatException` æ˜¯åœ¨ `java.lang.Integer.parseInt` æ–¹æ³•ä¸­è¢«æŠ›å‡ºçš„ï¼Œä»ä¸‹å¾€ä¸Šçœ‹ï¼Œè°ƒç”¨å±‚æ¬¡ä¾æ¬¡æ˜¯ï¼š

1. `main()` è°ƒç”¨ `process1()` ï¼›
2. `process1()` è°ƒç”¨ `process2()` ï¼›
3. `process2()` è°ƒç”¨ `Integer.parseInt(String)` ï¼›
4. `Integer.parseInt(String)` è°ƒç”¨ `Integer.parseInt(String,int)` ã€‚

æŸ¥çœ‹ `Integer.java` æºç å¯çŸ¥ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š

```java
public static int parseInt(String s, int radix) throws NumberFormatException {
    if (s == null) {
        throw new NumberFormatException("null");
    }
    ...
}
```

å¹¶ä¸”ï¼Œæ¯å±‚è°ƒç”¨å‡ç»™å‡ºäº†æºä»£ç çš„è¡Œå·ï¼Œå¯ç›´æ¥å®šä½ã€‚

## ğŸ€ æŠ›å‡ºå¼‚å¸¸

å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥äº†éæ³•çš„å­—ç¬¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚

å¦‚ä½•æŠ›å‡ºå¼‚å¸¸ï¼Ÿå‚è€ƒ `Integer.parseInt()` æ–¹æ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸åˆ†ä¸¤æ­¥ï¼š

1. åˆ›å»ºæŸä¸ª `Exception` çš„å®ä¾‹ï¼›
2. ç”¨ `throw` è¯­å¥æŠ›å‡ºã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```java
void process2(String s) {
    if (s == null) {
        NullPointerException e = new NullPointerException();
        throw e;
    }
}
```

å®é™…ä¸Šï¼Œç»å¤§éƒ¨åˆ†æŠ›å‡ºå¼‚å¸¸çš„ä»£ç éƒ½ä¼šåˆå¹¶å†™æˆä¸€è¡Œï¼š

```java
void process2(String s) {
    if (s == null) {
        throw new NullPointerException();
    }
}
```

å¦‚æœä¸€ä¸ªæ–¹æ³•æ•è·äº†æŸä¸ªå¼‚å¸¸åï¼Œåˆåœ¨ `catch` å­å¥ä¸­æŠ›å‡ºæ–°çš„å¼‚å¸¸ï¼Œå°±ç›¸å½“äºæŠŠæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ â€œè½¬æ¢â€ äº†ï¼š

```java
void process1(String s) {
    try {
        process2();
    } catch (NullPointerException e) {
        throw new IllegalArgumentException();
    }
}

void process2(String s) {
    if (s == null) {
        throw new NullPointerException();
    }
}
```

å½“ `process2()` æŠ›å‡º `NullPointerException` åï¼Œè¢« `process1()` æ•è·ï¼Œç„¶åæŠ›å‡º `IllegalArgumentException()` ã€‚

å¦‚æœåœ¨ `main()` ä¸­æ•è· `IllegalArgumentException`ï¼Œæˆ‘ä»¬çœ‹çœ‹æ‰“å°çš„å¼‚å¸¸æ ˆï¼š

```java
public class Main {
    public static void main(String[] args) {
        try {
            process1();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    static void process1() {
        try {
            process2();
        } catch (NullPointerException e) {
            throw new IllegalArgumentException();
        }
    }

    static void process2() {
        throw new NullPointerException();
    }
}
```

æ‰“å°å‡ºçš„å¼‚å¸¸æ ˆç±»ä¼¼ï¼š

```
java.lang.IllegalArgumentException
    at Main.process1(Main.java:15)
    at Main.main(Main.java:5)
```

è¿™è¯´æ˜æ–°çš„å¼‚å¸¸ä¸¢å¤±äº†åŸå§‹å¼‚å¸¸ä¿¡æ¯ï¼Œæˆ‘ä»¬å·²ç»çœ‹ä¸åˆ°åŸå§‹å¼‚å¸¸ `NullPointerException` çš„ä¿¡æ¯äº†ã€‚

ä¸ºäº†èƒ½è¿½è¸ªåˆ°å®Œæ•´çš„å¼‚å¸¸æ ˆï¼Œåœ¨æ„é€ å¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹çš„ `Exception` å®ä¾‹ä¼ è¿›å»ï¼Œæ–°çš„ `Exception` å°±å¯ä»¥æŒæœ‰åŸå§‹ `Exception` ä¿¡æ¯ã€‚å¯¹ä¸Šè¿°ä»£ç æ”¹è¿›å¦‚ä¸‹ï¼š

```java
public class Main {
    public static void main(String[] args) {
        try {
            process1();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    static void process1() {
        try {
            process2();
        } catch (NullPointerException e) {
            throw new IllegalArgumentException(e);
        }
    }

    static void process2() {
        throw new NullPointerException();
    }
}
```

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ‰“å°å‡ºçš„å¼‚å¸¸æ ˆç±»ä¼¼ï¼š

```
java.lang.IllegalArgumentException: java.lang.NullPointerException
    at Main.process1(Main.java:15)
    at Main.main(Main.java:5)
Caused by: java.lang.NullPointerException
    at Main.process2(Main.java:20)
    at Main.process1(Main.java:13)
```

æ³¨æ„åˆ° `Caused by: Xxx`ï¼Œè¯´æ˜æ•è·çš„ `IllegalArgumentException` å¹¶ä¸æ˜¯é€ æˆé—®é¢˜çš„æ ¹æºï¼Œæ ¹æºåœ¨äº `NullPointerException`ï¼Œæ˜¯åœ¨ `Main.process2()` æ–¹æ³•æŠ›å‡ºçš„ã€‚

åœ¨ä»£ç ä¸­è·å–åŸå§‹å¼‚å¸¸å¯ä»¥ä½¿ç”¨ `Throwable.getCause()` æ–¹æ³•ã€‚å¦‚æœè¿”å› `null`ï¼Œè¯´æ˜å·²ç»æ˜¯ â€œæ ¹å¼‚å¸¸â€ äº†ã€‚

æœ‰äº†å®Œæ•´çš„å¼‚å¸¸æ ˆçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ‰èƒ½å¿«é€Ÿå®šä½å¹¶ä¿®å¤ä»£ç çš„é—®é¢˜ã€‚

> [!caution]
> æ•è·åˆ°å¼‚å¸¸å¹¶å†æ¬¡æŠ›å‡ºæ—¶ï¼Œ**ä¸€å®šè¦ç•™ä½åŸå§‹å¼‚å¸¸**ï¼Œå¦åˆ™å¾ˆéš¾å®šä½ç¬¬ä¸€æ¡ˆå‘ç°åœºï¼

å¦‚æœæˆ‘ä»¬åœ¨ `try` æˆ–è€… `catch` è¯­å¥å—ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œ`finally` è¯­å¥æ˜¯å¦ä¼šæ‰§è¡Œï¼Ÿä¾‹å¦‚ï¼š

```java
public class Main {
    public static void main(String[] args) {
        try {
            Integer.parseInt("abc");
        } catch (Exception e) {
            System.out.println("catched");
            throw new RuntimeException(e);
        } finally {
            System.out.println("finally");
        }
    }
}
```

ä¸Šè¿°ä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

```
catched
finally
Exception in thread "main" java.lang.RuntimeException: java.lang.NumberFormatException: For input string: "abc"
    at Main.main(Main.java:8)
Caused by: java.lang.NumberFormatException: For input string: "abc"
    at ...
```

ç¬¬ä¸€è¡Œæ‰“å°äº† `catched`ï¼Œè¯´æ˜è¿›å…¥äº† `catch` è¯­å¥å—ã€‚ç¬¬äºŒè¡Œæ‰“å°äº† `finally`ï¼Œè¯´æ˜æ‰§è¡Œäº† `finally` è¯­å¥å—ã€‚

å› æ­¤ï¼Œ**_åœ¨ `catch` ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šå½±å“ `finally` çš„æ‰§è¡Œã€‚_** JVM ä¼šå…ˆæ‰§è¡Œ `finally`ï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸ã€‚

## ğŸ€ å¼‚å¸¸å±è”½

å¦‚æœåœ¨æ‰§è¡Œ `finally` è¯­å¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆï¼Œ`catch` è¯­å¥çš„å¼‚å¸¸è¿˜èƒ½å¦ç»§ç»­æŠ›å‡ºï¼Ÿä¾‹å¦‚ï¼š

```java
public class Main {
    public static void main(String[] args) {
        try {
            Integer.parseInt("abc");
        } catch (Exception e) {
            System.out.println("catched");
            throw new RuntimeException(e);
        } finally {
            System.out.println("finally");
            throw new IllegalArgumentException();
        }
    }
}
```

æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå‘ç°å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š

```
catched
finally
Exception in thread "main" java.lang.IllegalArgumentException
    at Main.main(Main.java:11)
```

è¿™è¯´æ˜ `finally` æŠ›å‡ºå¼‚å¸¸åï¼ŒåŸæ¥åœ¨ `catch` ä¸­å‡†å¤‡æŠ›å‡ºçš„å¼‚å¸¸å°± â€œæ¶ˆå¤±â€ äº†ï¼Œå› ä¸ºåªèƒ½æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚æ²¡æœ‰è¢«æŠ›å‡ºçš„å¼‚å¸¸ç§°ä¸º â€œè¢«å±è”½â€ çš„å¼‚å¸¸ï¼ˆSuppressed Exceptionï¼‰ã€‚

åœ¨æå°‘æ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è·çŸ¥æ‰€æœ‰çš„å¼‚å¸¸ã€‚

### å¦‚ä½•ä¿å­˜æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯ï¼Ÿ

æ–¹æ³•æ˜¯å…ˆç”¨ `origin` å˜é‡ä¿å­˜åŸå§‹å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨ `Throwable.addSuppressed()`ï¼ŒæŠŠåŸå§‹å¼‚å¸¸æ·»åŠ è¿›æ¥ï¼Œæœ€ååœ¨ `finally` æŠ›å‡ºï¼š

```java
public class Main {
    public static void main(String[] args) throws Exception {
        Exception origin = null;
        try {
            System.out.println(Integer.parseInt("abc"));
        } catch (Exception e) {
            origin = e;//ä¿å­˜åŸå§‹å¼‚å¸¸
            throw e;
        } finally {
            Exception e = new IllegalArgumentException();
            if (origin != null) {
                e.addSuppressed(origin);//æŠŠåŸå§‹å¼‚å¸¸æ·»åŠ è¿›æ¥
            }
            throw e;
        }
    }
}
```

å½“ `catch` å’Œ `finally` éƒ½æŠ›å‡ºäº†å¼‚å¸¸æ—¶ï¼Œè™½ç„¶ `catch` çš„å¼‚å¸¸è¢«å±è”½äº†ï¼Œä½†æ˜¯ï¼Œ`finally` æŠ›å‡ºçš„å¼‚å¸¸ä»ç„¶åŒ…å«äº†å®ƒï¼š

```
Exception in thread "main" java.lang.IllegalArgumentException
    at Main.main(Main.java:11)
Suppressed: java.lang.NumberFormatException: For input string: "abc"
    at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
    at java.base/java.lang.Integer.parseInt(Integer.java:652)
    at java.base/java.lang.Integer.parseInt(Integer.java:770)
    at Main.main(Main.java:6)
```

é€šè¿‡ `Throwable.getSuppressed()` å¯ä»¥è·å–æ‰€æœ‰çš„ `Suppressed Exception` ã€‚

**_ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨ `finally` ä¸­ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚_** å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦å…³å¿ƒ `Suppressed Exception` ã€‚

## ğŸ€ æé—®æ—¶è´´å‡ºå¼‚å¸¸

å¼‚å¸¸æ‰“å°çš„è¯¦ç»†çš„æ ˆä¿¡æ¯æ˜¯æ‰¾å‡ºé—®é¢˜çš„å…³é”®ï¼Œè®¸å¤šåˆå­¦è€…åœ¨æé—®æ—¶åªè´´ä»£ç ï¼Œä¸è´´å¼‚å¸¸ï¼Œç›¸å½“äºåªæŠ¥æ¡ˆä¸ç»™çº¿ç´¢ï¼Œç¦å°”æ‘©æ–¯ä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚

![](assets/20220623141707.png)

è¿˜æœ‰çš„ç«¥é‹åªè´´éƒ¨åˆ†å¼‚å¸¸ä¿¡æ¯ï¼Œæœ€å…³é”®çš„ `Caused by: xxx` ç»™çœç•¥äº†ï¼Œè¿™éƒ½å±äºä¸æ­£ç¡®çš„æé—®æ–¹å¼ï¼Œå¾—æ”¹ã€‚

## ğŸ€ ç»ƒä¹ 

å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºè´Ÿï¼Œåˆ™æŠ›å‡º `IllegalArgumentException` ã€‚

```java
public class ThrowExceptionTest {
    public static void main(String[] args) {
        System.out.println(tax(2000, 0.1));
        System.out.println(tax(-200, 0.1));
        System.out.println(tax(2000, -0.1));
    }

    static double tax(int salary, double rate) {
        // TODO: å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºè´Ÿï¼Œåˆ™æŠ›å‡ºIllegalArgumentException
        if (salary < 0 || rate < 0) {
            throw new IllegalArgumentException();
        }
        return salary * rate;
    }
}
```

## ğŸ€ å°ç»“

- è°ƒç”¨ `printStackTrace()` å¯ä»¥æ‰“å°å¼‚å¸¸çš„ä¼ æ’­æ ˆï¼Œå¯¹äºè°ƒè¯•éå¸¸æœ‰ç”¨ï¼›
- æ•è·å¼‚å¸¸å¹¶å†æ¬¡æŠ›å‡ºæ–°çš„å¼‚å¸¸æ—¶ï¼Œåº”è¯¥æŒæœ‰åŸå§‹å¼‚å¸¸ä¿¡æ¯ï¼›
- é€šå¸¸ä¸è¦åœ¨ `finally` ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœåœ¨ `finally` ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œåº”è¯¥åŸå§‹å¼‚å¸¸åŠ å…¥åˆ°åŸæœ‰å¼‚å¸¸ä¸­ã€‚è°ƒç”¨æ–¹å¯é€šè¿‡ `Throwable.getSuppressed()` è·å–æ‰€æœ‰æ·»åŠ çš„ `Suppressed Exception` ã€‚
