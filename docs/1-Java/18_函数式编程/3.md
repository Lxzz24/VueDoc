---
title: ä½¿ç”¨ Stream
sidebarDepth: 1
category: Java æ•™ç¨‹
tag: Java
---

::: details ç›®å½•
[[toc]]
:::

## ğŸ€ äº†è§£ Stream

Java ä» 8 å¼€å§‹ï¼Œä¸ä½†å¼•å…¥äº† Lambda è¡¨è¾¾å¼ï¼Œè¿˜å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„æµå¼ APIï¼šStream APIã€‚å®ƒä½äº `java.util.stream` åŒ…ä¸­ã€‚

_åˆ’é‡ç‚¹_ï¼šè¿™ä¸ª `Stream` ä¸åŒäº `java.io` çš„ `InputStream` å’Œ `OutputStream`ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä»»æ„ Java å¯¹è±¡çš„åºåˆ—ã€‚ä¸¤è€…å¯¹æ¯”å¦‚ä¸‹ï¼š

|      | java.io                     | java.util.stream             |
| :--- | :-------------------------- | :--------------------------- |
| å­˜å‚¨ | é¡ºåºè¯»å†™çš„ `byte` æˆ– `char` | é¡ºåºè¾“å‡ºçš„ä»»æ„ Java å¯¹è±¡å®ä¾‹ |
| ç”¨é€” | åºåˆ—åŒ–è‡³æ–‡ä»¶æˆ–ç½‘ç»œ          | å†…å­˜è®¡ç®—ï¼ä¸šåŠ¡é€»è¾‘           |

> æœ‰åŒå­¦ä¼šé—®ï¼šä¸€ä¸ªé¡ºåºè¾“å‡ºçš„ Java å¯¹è±¡åºåˆ—ï¼Œä¸å°±æ˜¯ä¸€ä¸ª `List` å®¹å™¨å—ï¼Ÿ

_å†æ¬¡åˆ’é‡ç‚¹_ï¼šè¿™ä¸ª `Stream` å’Œ `List` ä¹Ÿä¸ä¸€æ ·ï¼Œ`List` å­˜å‚¨çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å·²ç»å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸä¸ª Java å¯¹è±¡ï¼Œè€Œ `Stream` è¾“å‡ºçš„å…ƒç´ å¯èƒ½å¹¶æ²¡æœ‰é¢„å…ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯å®æ—¶è®¡ç®—å‡ºæ¥çš„ã€‚

æ¢å¥è¯è¯´ï¼Œ`List` çš„ç”¨é€”æ˜¯æ“ä½œä¸€ç»„å·²å­˜åœ¨çš„ Java å¯¹è±¡ï¼Œè€Œ `Stream` å®ç°çš„æ˜¯æƒ°æ€§è®¡ç®—ï¼Œä¸¤è€…å¯¹æ¯”å¦‚ä¸‹ï¼š

|      | java.util.List             | java.util.stream     |
| :--- | :------------------------- | :------------------- |
| å…ƒç´  | å·²åˆ†é…å¹¶å­˜å‚¨åœ¨å†…å­˜         | å¯èƒ½æœªåˆ†é…ï¼Œå®æ—¶è®¡ç®— |
| ç”¨é€” | æ“ä½œä¸€ç»„å·²å­˜åœ¨çš„ Java å¯¹è±¡ | æƒ°æ€§è®¡ç®—             |

---

`Stream` çœ‹ä¸Šå»æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œä½†æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­å°±æ˜ç™½äº†ã€‚

å¦‚æœæˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ªå…¨ä½“è‡ªç„¶æ•°çš„é›†åˆï¼Œæ˜¾ç„¶ï¼Œç”¨ `List` æ˜¯ä¸å¯èƒ½å†™å‡ºæ¥çš„ï¼Œå› ä¸ºè‡ªç„¶æ•°æ˜¯æ— é™çš„ï¼Œå†…å­˜å†å¤§ä¹Ÿæ²¡æ³•æ”¾åˆ° `List` ä¸­ï¼š

```java
List<BigInteger> list = ??? // å…¨ä½“è‡ªç„¶æ•°?
```

ä½†æ˜¯ï¼Œç”¨ `Stream` å¯ä»¥åšåˆ°ã€‚å†™æ³•å¦‚ä¸‹ï¼š

```java
Stream<BigInteger> naturals = createNaturalStream(); // å…¨ä½“è‡ªç„¶æ•°
```

æˆ‘ä»¬å…ˆä¸è€ƒè™‘ `createNaturalStream()` è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ª `Stream`ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªè‡ªç„¶æ•°åšä¸€ä¸ªå¹³æ–¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±æŠŠè¿™ä¸ª `Stream` è½¬æ¢æˆäº†å¦ä¸€ä¸ª `Stream`ï¼š

```java
Stream<BigInteger> naturals = createNaturalStream(); // å…¨ä½“è‡ªç„¶æ•°
Stream<BigInteger> streamNxN = naturals.map(n -> n.multiply(n)); // å…¨ä½“è‡ªç„¶æ•°çš„å¹³æ–¹
```

å› ä¸ºè¿™ä¸ª `streamNxN` ä¹Ÿæœ‰æ— é™å¤šä¸ªå…ƒç´ ï¼Œè¦æ‰“å°å®ƒï¼Œå¿…é¡»é¦–å…ˆæŠŠæ— é™å¤šä¸ªå…ƒç´ å˜æˆæœ‰é™ä¸ªå…ƒç´ ï¼Œå¯ä»¥ç”¨ `limit()` æ–¹æ³•æˆªå–å‰ 100 ä¸ªå…ƒç´ ï¼Œæœ€åç”¨ `forEach()` å¤„ç†æ¯ä¸ªå…ƒç´ ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±æ‰“å°å‡ºäº†å‰ 100 ä¸ªè‡ªç„¶æ•°çš„å¹³æ–¹ï¼š

```java
Stream<BigInteger> naturals = createNaturalStream();
naturals.map(n -> n.multiply(n)) // 1, 4, 9, 16, 25...
        .limit(100)
        .forEach(System.out::println);
```

æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ `Stream` çš„ç‰¹ç‚¹ï¼š_å®ƒå¯ä»¥ **â€œå­˜å‚¨â€** æœ‰é™ä¸ªæˆ–æ— é™ä¸ªå…ƒç´ _ã€‚è¿™é‡Œçš„å­˜å‚¨æ‰“äº†ä¸ªå¼•å·ï¼Œæ˜¯å› ä¸ºå…ƒç´ æœ‰å¯èƒ½å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ ¹æ®éœ€è¦å®æ—¶è®¡ç®—å‡ºæ¥çš„ã€‚

`Stream` çš„å¦ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œ_ä¸€ä¸ª `Stream` å¯ä»¥è½»æ˜“åœ°è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Stream`ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸ `Stream` æœ¬èº«_ã€‚

æœ€åï¼Œ_çœŸæ­£çš„è®¡ç®—é€šå¸¸å‘ç”Ÿåœ¨æœ€åç»“æœçš„è·å–_ï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§è®¡ç®—ã€‚

```java
Stream<BigInteger> naturals = createNaturalStream(); // ä¸è®¡ç®—
Stream<BigInteger> s2 = naturals.map(BigInteger::multiply); // ä¸è®¡ç®—
Stream<BigInteger> s3 = s2.limit(100); // ä¸è®¡ç®—
s3.forEach(System.out::println); // è®¡ç®—
```

æƒ°æ€§è®¡ç®—çš„ç‰¹ç‚¹æ˜¯ï¼š_ä¸€ä¸ª `Stream` è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Stream` æ—¶ï¼Œå®é™…ä¸Šåªå­˜å‚¨äº†è½¬æ¢è§„åˆ™ï¼Œå¹¶æ²¡æœ‰ä»»ä½•è®¡ç®—å‘ç”Ÿ_ã€‚

ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªå…¨ä½“è‡ªç„¶æ•°çš„ `Stream`ï¼Œä¸ä¼šè¿›è¡Œè®¡ç®—ï¼ŒæŠŠå®ƒè½¬æ¢ä¸ºä¸Šè¿° `s2` è¿™ä¸ª `Stream`ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œè®¡ç®—ã€‚å†æŠŠ `s2` è¿™ä¸ªæ— é™ `Stream` è½¬æ¢ä¸º `s3` è¿™ä¸ªæœ‰é™çš„ `Stream`ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œè®¡ç®—ã€‚åªæœ‰æœ€åï¼Œè°ƒç”¨ `forEach` ç¡®å®éœ€è¦ `Stream` è¾“å‡ºçš„å…ƒç´ æ—¶ï¼Œæ‰è¿›è¡Œè®¡ç®—ã€‚æˆ‘ä»¬é€šå¸¸æŠŠ `Stream` çš„æ“ä½œå†™æˆé“¾å¼æ“ä½œï¼Œä»£ç æ›´ç®€æ´ï¼š

```java
createNaturalStream()
    .map(BigInteger::multiply)
    .limit(100)
    .forEach(System.out::println);
```

å› æ­¤ï¼ŒStream API çš„**åŸºæœ¬ç”¨æ³•**å°±æ˜¯ï¼š_åˆ›å»ºä¸€ä¸ª `Stream`ï¼Œç„¶ååšè‹¥å¹²æ¬¡è½¬æ¢ï¼Œæœ€åè°ƒç”¨ä¸€ä¸ªæ±‚å€¼æ–¹æ³•è·å–çœŸæ­£è®¡ç®—çš„ç»“æœ_ï¼š

```java
int result = createNaturalStream() // åˆ›å»º Stream
             .filter(n -> n % 2 == 0) // ä»»æ„ä¸ªè½¬æ¢
             .map(n -> n * n) // ä»»æ„ä¸ªè½¬æ¢
             .limit(100) // ä»»æ„ä¸ªè½¬æ¢
             .sum(); // æœ€ç»ˆè®¡ç®—ç»“æœ
```

**Stream API çš„ç‰¹ç‚¹æ˜¯ï¼š**

- Stream API æä¾›äº†ä¸€å¥—æ–°çš„æµå¼å¤„ç†çš„æŠ½è±¡åºåˆ—ï¼›
- Stream API æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹å’Œé“¾å¼æ“ä½œï¼›
- Stream å¯ä»¥è¡¨ç¤ºæ— é™åºåˆ—ï¼Œå¹¶ä¸”å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æƒ°æ€§æ±‚å€¼çš„ã€‚

## ğŸ€ åˆ›å»º Stream

è¦ä½¿ç”¨ `Stream`ï¼Œå°±å¿…é¡»å…ˆåˆ›å»ºå®ƒã€‚åˆ›å»º `Stream` æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€ä»‹ç»ã€‚

### Stream.of()

åˆ›å»º `Stream` æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥ç”¨ `Stream.of()` é™æ€æ–¹æ³•ï¼Œä¼ å…¥å¯å˜å‚æ•°å³åˆ›å»ºäº†ä¸€ä¸ªèƒ½è¾“å‡ºç¡®å®šå…ƒç´ çš„ `Stream`ï¼š

```java
import java.util.stream.Stream;

public class Main {
    public static void main(String[] args) {
        Stream<String> stream = Stream.of("A", "B", "C", "D");
        // forEach() æ–¹æ³•ç›¸å½“äºå†…éƒ¨å¾ªç¯è°ƒç”¨ï¼Œ
        // å¯ä¼ å…¥ç¬¦åˆ Consumer æ¥å£çš„ void accept(T t) çš„æ–¹æ³•å¼•ç”¨ï¼š
        stream.forEach(System.out::println);
    }
}
```

è™½ç„¶è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ²¡å•¥å®è´¨æ€§ç”¨é€”ï¼Œä½†æµ‹è¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿ã€‚

### åŸºäºæ•°ç»„æˆ– Collection

ç¬¬äºŒç§åˆ›å»º `Stream` çš„æ–¹æ³•æ˜¯åŸºäºä¸€ä¸ªæ•°ç»„æˆ–è€… `Collection`ï¼Œè¿™æ ·è¯¥ `Stream` è¾“å‡ºçš„å…ƒç´ å°±æ˜¯æ•°ç»„æˆ–è€… `Collection` æŒæœ‰çš„å…ƒç´ ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        Stream<String> stream1 = Arrays.stream(new String[] { "A", "B", "C" });
        Stream<String> stream2 = List.of("X", "Y", "Z").stream();
        stream1.forEach(System.out::println);
        stream2.forEach(System.out::println);
    }
}
```

æŠŠæ•°ç»„å˜æˆ `Stream` ä½¿ç”¨ `Arrays.stream()` æ–¹æ³•ã€‚å¯¹äº `Collection`ï¼ˆ`List`ã€`Set`ã€`Queue` ç­‰ï¼‰ï¼Œç›´æ¥è°ƒç”¨ `stream()` æ–¹æ³•å°±å¯ä»¥è·å¾— `Stream`ã€‚

ä¸Šè¿°åˆ›å»º `Stream` çš„æ–¹æ³•éƒ½æ˜¯æŠŠä¸€ä¸ªç°æœ‰çš„åºåˆ—å˜ä¸º `Stream`ï¼Œå®ƒçš„å…ƒç´ æ˜¯å›ºå®šçš„ã€‚

### åŸºäº Supplier

åˆ›å»º `Stream` è¿˜å¯ä»¥é€šè¿‡ `Stream.generate()` æ–¹æ³•ï¼Œå®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ª `Supplier` å¯¹è±¡ï¼š

```java
Stream<String> s = Stream.generate(Supplier<String> sp);
```

åŸºäº `Supplier` åˆ›å»ºçš„ `Stream` ä¼šä¸æ–­è°ƒç”¨ `Supplier.get()` æ–¹æ³•æ¥ä¸æ–­äº§ç”Ÿä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ç§ `Stream` ä¿å­˜çš„ä¸æ˜¯å…ƒç´ ï¼Œè€Œæ˜¯ç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨æ¥è¡¨ç¤ºæ— é™åºåˆ—ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªèƒ½ä¸æ–­ç”Ÿæˆè‡ªç„¶æ•°çš„ `Supplier`ï¼Œå®ƒçš„ä»£ç éå¸¸ç®€å•ï¼Œæ¯æ¬¡è°ƒç”¨ `get()` æ–¹æ³•ï¼Œå°±ç”Ÿæˆä¸‹ä¸€ä¸ªè‡ªç„¶æ•°ï¼š

```java
import java.util.function.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        Stream<Integer> natual = Stream.generate(new NatualSupplier());
        // æ³¨æ„ï¼šæ— é™åºåˆ—å¿…é¡»å…ˆå˜æˆæœ‰é™åºåˆ—å†æ‰“å°:
        natual.limit(20).forEach(System.out::println);
    }
}

class NatualSupplier implements Supplier<Integer> {
    int n = 0;
    public Integer get() {
        n++;
        return n;
    }
}
```

ä¸Šè¿°ä»£ç æˆ‘ä»¬ç”¨ä¸€ä¸ª `Supplier<Integer>` æ¨¡æ‹Ÿäº†ä¸€ä¸ªæ— é™åºåˆ—ï¼ˆå½“ç„¶å— `int` èŒƒå›´é™åˆ¶ä¸æ˜¯çœŸçš„æ— é™å¤§ï¼‰ã€‚å¦‚æœç”¨ `List` è¡¨ç¤ºï¼Œå³ä¾¿åœ¨ `int` èŒƒå›´å†…ï¼Œä¹Ÿä¼šå ç”¨å·¨å¤§çš„å†…å­˜ï¼Œè€Œ `Stream` å‡ ä¹ä¸å ç”¨ç©ºé—´ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ éƒ½æ˜¯å®æ—¶è®¡ç®—å‡ºæ¥çš„ï¼Œç”¨çš„æ—¶å€™å†ç®—ã€‚

å¯¹äºæ— é™åºåˆ—ï¼Œå¦‚æœç›´æ¥è°ƒç”¨ `forEach()` æˆ–è€… `count()` è¿™äº›æœ€ç»ˆæ±‚å€¼æ“ä½œï¼Œä¼šè¿›å…¥æ­»å¾ªç¯ï¼Œå› ä¸ºæ°¸è¿œæ— æ³•è®¡ç®—å®Œè¿™ä¸ªåºåˆ—ï¼Œæ‰€ä»¥æ­£ç¡®çš„æ–¹æ³•æ˜¯å…ˆæŠŠæ— é™åºåˆ—å˜æˆæœ‰é™åºåˆ—ï¼Œä¾‹å¦‚ï¼Œç”¨ `limit()` æ–¹æ³•å¯ä»¥æˆªå–å‰é¢è‹¥å¹²ä¸ªå…ƒç´ ï¼Œè¿™æ ·å°±å˜æˆäº†ä¸€ä¸ªæœ‰é™åºåˆ—ï¼Œå¯¹è¿™ä¸ªæœ‰é™åºåˆ—è°ƒç”¨ `forEach()` æˆ–è€… `count()` æ“ä½œå°±æ²¡æœ‰é—®é¢˜ã€‚

### å…¶ä»–æ–¹æ³•

åˆ›å»º `Stream` çš„ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯é€šè¿‡ä¸€äº› API æä¾›çš„æ¥å£ï¼Œç›´æ¥è·å¾— `Stream`ã€‚

ä¾‹å¦‚ï¼Œ`Files` ç±»çš„ `lines()` æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶å˜æˆä¸€ä¸ª `Stream`ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨æ–‡ä»¶çš„ä¸€è¡Œå†…å®¹ï¼š

```java
try (Stream<String> lines = Files.lines(Paths.get("/path/to/file.txt"))) {
    ...
}
```

æ­¤æ–¹æ³•å¯¹äºæŒ‰è¡Œéå†æ–‡æœ¬æ–‡ä»¶ååˆ†æœ‰ç”¨ã€‚

å¦å¤–ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„ `Pattern` å¯¹è±¡æœ‰ä¸€ä¸ª `splitAsStream()` æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªé•¿å­—ç¬¦ä¸²åˆ†å‰²æˆ `Stream` åºåˆ—è€Œä¸æ˜¯æ•°ç»„ï¼š

```java
Pattern p = Pattern.compile("\\s+");
Stream<String> s = p.splitAsStream("The quick brown fox jumps over the lazy dog");
s.forEach(System.out::println);
```

### åŸºæœ¬ç±»å‹

å› ä¸º Java çš„æ³›å‹ä¸æ”¯æŒåŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç”¨ `Stream<int>` è¿™æ ·çš„ç±»å‹ï¼Œä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ã€‚ä¸ºäº†ä¿å­˜ `int`ï¼Œåªèƒ½ä½¿ç”¨ `Stream<Integer>`ï¼Œä½†è¿™æ ·ä¼šäº§ç”Ÿé¢‘ç¹çš„è£…ç®±ã€æ‹†ç®±æ“ä½œã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒJava æ ‡å‡†åº“æä¾›äº† `IntStream`ã€`LongStream` å’Œ `DoubleStream` è¿™ä¸‰ç§ä½¿ç”¨åŸºæœ¬ç±»å‹çš„ `Stream`ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•å’ŒèŒƒå‹ `Stream` æ²¡æœ‰å¤§çš„åŒºåˆ«ï¼Œè®¾è®¡è¿™ä¸‰ä¸ª `Stream` çš„ç›®çš„æ˜¯æé«˜è¿è¡Œæ•ˆç‡ï¼š

```java
// å°† int[] æ•°ç»„å˜ä¸º IntStream:
IntStream is = Arrays.stream(new int[] { 1, 2, 3 });
// å°† Stream<String> è½¬æ¢ä¸º LongStream:
LongStream ls = List.of("1", "2", "3").stream().mapToLong(Long::parseLong);
```

### ç»ƒä¹ 

ç¼–å†™ä¸€ä¸ªèƒ½è¾“å‡ºæ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼ˆFibonacciï¼‰çš„ `LongStream`ï¼š

```
1, 1, 2, 3, 5, 8, 13, 21, 34, ...
```

### å°ç»“

åˆ›å»º `Stream` çš„æ–¹æ³•æœ‰ ï¼š

- é€šè¿‡æŒ‡å®šå…ƒç´ ã€æŒ‡å®šæ•°ç»„ã€æŒ‡å®š `Collection` åˆ›å»º `Stream`ï¼›
- é€šè¿‡ `Supplier` åˆ›å»º `Stream`ï¼Œå¯ä»¥æ˜¯æ— é™åºåˆ—ï¼›
- é€šè¿‡å…¶ä»–ç±»çš„ç›¸å…³æ–¹æ³•åˆ›å»ºã€‚

åŸºæœ¬ç±»å‹çš„ `Stream` æœ‰ `IntStream`ã€`LongStream` å’Œ `DoubleStream`ã€‚

---

## ğŸ€ ä½¿ç”¨ map

`Stream.map()` æ˜¯ `Stream` æœ€å¸¸ç”¨çš„ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå®ƒæŠŠä¸€ä¸ª `Stream` è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Stream`ã€‚

æ‰€è°“ `map` æ“ä½œï¼Œå°±æ˜¯æŠŠä¸€ç§æ“ä½œè¿ç®—ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªåºåˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šã€‚ä¾‹å¦‚ï¼Œå¯¹ `x` è®¡ç®—å®ƒçš„å¹³æ–¹ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•° `f(x) = x * x`ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°æ˜ å°„åˆ°ä¸€ä¸ªåºåˆ— `1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5` ä¸Šï¼Œå°±å¾—åˆ°äº†å¦ä¸€ä¸ªåºåˆ— `1ï¼Œ4ï¼Œ9ï¼Œ16ï¼Œ25`ï¼š

![](./assets/image-20231219165412170.png =400x)

å¯è§ï¼Œ`map` æ“ä½œï¼ŒæŠŠä¸€ä¸ª `Stream` çš„æ¯ä¸ªå…ƒç´ ä¸€ä¸€å¯¹åº”åˆ°åº”ç”¨äº†ç›®æ ‡å‡½æ•°çš„ç»“æœä¸Šã€‚

```java
Stream<Integer> s = Stream.of(1, 2, 3, 4, 5);
Stream<Integer> s2 = s.map(n -> n * n);
```

å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ `Stream` çš„æºç ï¼Œä¼šå‘ç° `map()` æ–¹æ³•æ¥æ”¶çš„å¯¹è±¡æ˜¯ `Function` æ¥å£å¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª `apply()` æ–¹æ³•ï¼Œè´Ÿè´£æŠŠä¸€ä¸ª `T` ç±»å‹è½¬æ¢æˆ `R` ç±»å‹ï¼š

```java
<R> Stream<R> map(Function<? super T, ? extends R> mapper);
```

å…¶ä¸­ï¼Œ`Function` çš„å®šä¹‰æ˜¯ï¼š

```java
@FunctionalInterface
public interface Function<T, R> {
    // å°† T ç±»å‹è½¬æ¢ä¸º R:
    R apply(T t);
}
```

åˆ©ç”¨ `map()`ï¼Œä¸ä½†èƒ½å®Œæˆæ•°å­¦è®¡ç®—ï¼Œå¯¹äºå­—ç¬¦ä¸²æ“ä½œï¼Œä»¥åŠä»»ä½• Java å¯¹è±¡éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        List.of("Apple", "pear", "ORANGE", "BaNaNa")
                .stream()
                .map(String::trim) // å»ç©ºæ ¼
                .map(String::toLowerCase) // å˜å°å†™
                .forEach(System.out::println); // æ‰“å°
    }
}
```

é€šè¿‡è‹¥å¹²æ­¥ `map` è½¬æ¢ï¼Œå¯ä»¥å†™å‡ºé€»è¾‘ç®€å•ã€æ¸…æ™°çš„ä»£ç ã€‚

### ç»ƒä¹ 

ä½¿ç”¨ `map()` æŠŠä¸€ç»„ `String` è½¬æ¢ä¸º `LocalDate` å¹¶æ‰“å°ã€‚

### å°ç»“

- `map()` æ–¹æ³•ç”¨äºå°†ä¸€ä¸ª `Stream` çš„æ¯ä¸ªå…ƒç´ æ˜ å°„æˆå¦ä¸€ä¸ªå…ƒç´ å¹¶è½¬æ¢æˆä¸€ä¸ªæ–°çš„ `Stream`ï¼›

- å¯ä»¥å°†ä¸€ç§å…ƒç´ ç±»å‹è½¬æ¢æˆå¦ä¸€ç§å…ƒç´ ç±»å‹ã€‚

---

## ğŸ€ ä½¿ç”¨ filter

`Stream.filter()` æ˜¯ `Stream` çš„å¦ä¸€ä¸ªå¸¸ç”¨è½¬æ¢æ–¹æ³•ã€‚

æ‰€è°“ `filter()` æ“ä½œï¼Œå°±æ˜¯å¯¹ä¸€ä¸ª `Stream` çš„æ‰€æœ‰å…ƒç´ ä¸€ä¸€è¿›è¡Œæµ‹è¯•ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„å°±è¢« â€œæ»¤æ‰â€ äº†ï¼Œå‰©ä¸‹çš„æ»¡è¶³æ¡ä»¶çš„å…ƒç´ å°±æ„æˆäº†ä¸€ä¸ªæ–°çš„ `Stream`ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 è¿™ä¸ª `Stream` è°ƒç”¨ `filter()`ï¼Œä¼ å…¥çš„æµ‹è¯•å‡½æ•° `f(x) = x % 2 != 0` ç”¨æ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯å¥‡æ•°ï¼Œè¿™æ ·å°±è¿‡æ»¤æ‰å¶æ•°ï¼Œåªå‰©ä¸‹å¥‡æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†å¦ä¸€ä¸ªåºåˆ— 1ï¼Œ3ï¼Œ5ï¼š

![](./assets/image-20231219165553434.png =400x)

ç”¨ IntStream å†™å‡ºä¸Šè¿°é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
import java.util.stream.IntStream;

public class Main {
    public static void main(String[] args) {
        IntStream.of(1, 2, 3, 4, 5, 6, 7, 8, 9)
                .filter(n -> n % 2 != 0)
                .forEach(System.out::println);
    }
}
```

ä»ç»“æœå¯çŸ¥ï¼Œç»è¿‡ `filter()` åç”Ÿæˆçš„ `Stream` å…ƒç´ å¯èƒ½å˜å°‘ã€‚

`filter()` æ–¹æ³•æ¥æ”¶çš„å¯¹è±¡æ˜¯ `Predicate` æ¥å£å¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª `test()` æ–¹æ³•ï¼Œè´Ÿè´£åˆ¤æ–­å…ƒç´ æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼š

```java
@FunctionalInterface
public interface Predicate<T> {
    // åˆ¤æ–­å…ƒç´  t æ˜¯å¦ç¬¦åˆæ¡ä»¶:
    boolean test(T t);
}
```

`filter()` é™¤äº†å¸¸ç”¨äºæ•°å€¼å¤–ï¼Œä¹Ÿå¯åº”ç”¨äºä»»ä½• Java å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œä»ä¸€ç»„ç»™å®šçš„ `LocalDate` ä¸­è¿‡æ»¤æ‰å·¥ä½œæ—¥ï¼Œä»¥ä¾¿å¾—åˆ°ä¼‘æ¯æ—¥ï¼š

```java
import java.time.*;
import java.util.function.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        Stream.generate(new LocalDateSupplier())
                .limit(31)
                .filter(ldt -> ldt.getDayOfWeek() == DayOfWeek.SATURDAY || ldt.getDayOfWeek() == DayOfWeek.SUNDAY)
                .forEach(System.out::println);
    }
}

class LocalDateSupplier implements Supplier<LocalDate> {
    LocalDate start = LocalDate.of(2020, 1, 1);
    int n = -1;
    public LocalDate get() {
        n++;
        return start.plusDays(n);
    }
}
```

### ç»ƒä¹ 

è¯·ä½¿ç”¨ `filter()` è¿‡æ»¤å‡ºæˆç»©åŠæ ¼çš„åŒå­¦ï¼Œå¹¶æ‰“å°å‡ºåå­—ã€‚

### å°ç»“

ä½¿ç”¨ `filter()` æ–¹æ³•å¯ä»¥å¯¹ä¸€ä¸ª `Stream` çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæµ‹è¯•ï¼Œé€šè¿‡æµ‹è¯•çš„å…ƒç´ è¢«è¿‡æ»¤åç”Ÿæˆä¸€ä¸ªæ–°çš„ `Stream`ã€‚

---

## ğŸ€ ä½¿ç”¨ reduce

`map()` å’Œ `filter()` éƒ½æ˜¯ `Stream` çš„è½¬æ¢æ–¹æ³•ï¼Œè€Œ `Stream.reduce()` åˆ™æ˜¯ `Stream` çš„ä¸€ä¸ªèšåˆæ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ª `Stream` çš„æ‰€æœ‰å…ƒç´ æŒ‰ç…§èšåˆå‡½æ•°èšåˆæˆä¸€ä¸ªç»“æœã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„èšåˆæ–¹æ³•ï¼š

```java
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        int sum = Stream.of(1, 2, 3, 4, 5, 6, 7, 8, 9).reduce(0, (acc, n) -> acc + n);
        System.out.println(sum); // 45
    }
}
```

`reduce()` æ–¹æ³•ä¼ å…¥çš„å¯¹è±¡æ˜¯ `BinaryOperator` æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª `apply()` æ–¹æ³•ï¼Œè´Ÿè´£æŠŠä¸Šæ¬¡ç´¯åŠ çš„ç»“æœå’Œæœ¬æ¬¡çš„å…ƒç´ è¿›è¡Œè¿ç®—ï¼Œå¹¶è¿”å›ç´¯åŠ çš„ç»“æœï¼š

```java
@FunctionalInterface
public interface BinaryOperator<T> {
    // Bi æ“ä½œï¼šä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡º
    T apply(T t, T u);
}
```

ä¸Šè¿°ä»£ç çœ‹ä¸Šå»ä¸å¥½ç†è§£ï¼Œä½†æˆ‘ä»¬ç”¨ `for` å¾ªç¯æ”¹å†™ä¸€ä¸‹ï¼Œå°±å®¹æ˜“ç†è§£äº†ï¼š

```java
Stream<Integer> stream = ...
int sum = 0;
for (n : stream) {
    sum = (sum, n) -> sum + n;
}
```

å¯è§ï¼Œ`reduce()` æ“ä½œé¦–å…ˆåˆå§‹åŒ–ç»“æœä¸ºæŒ‡å®šå€¼ï¼ˆè¿™é‡Œæ˜¯ 0ï¼‰ï¼Œç´§æ¥ç€ï¼Œ`reduce()` å¯¹æ¯ä¸ªå…ƒç´ ä¾æ¬¡è°ƒç”¨ `(acc, n) -> acc + n`ï¼Œå…¶ä¸­ï¼Œ`acc` æ˜¯ä¸Šæ¬¡è®¡ç®—çš„ç»“æœï¼š

```java
// è®¡ç®—è¿‡ç¨‹:
acc = 0 // åˆå§‹åŒ–ä¸ºæŒ‡å®šå€¼
acc = acc + n = 0 + 1 = 1 // n = 1
acc = acc + n = 1 + 2 = 3 // n = 2
acc = acc + n = 3 + 3 = 6 // n = 3
acc = acc + n = 6 + 4 = 10 // n = 4
acc = acc + n = 10 + 5 = 15 // n = 5
acc = acc + n = 15 + 6 = 21 // n = 6
acc = acc + n = 21 + 7 = 28 // n = 7
acc = acc + n = 28 + 8 = 36 // n = 8
acc = acc + n = 36 + 9 = 45 // n = 9
```

å› æ­¤ï¼Œå®é™…ä¸Šè¿™ä¸ª `reduce()` æ“ä½œæ˜¯ä¸€ä¸ªæ±‚å’Œã€‚

å¦‚æœå»æ‰åˆå§‹å€¼ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª `Optional<Integer>`ï¼š

```java
Optional<Integer> opt = stream.reduce((acc, n) -> acc + n);
if (opt.isPresent()) {
    System.out.println(opt.get());
}
```

è¿™æ˜¯å› ä¸º `Stream` çš„å…ƒç´ æœ‰å¯èƒ½æ˜¯ 0 ä¸ªï¼Œè¿™æ ·å°±æ²¡æ³•è°ƒç”¨ `reduce()` çš„èšåˆå‡½æ•°äº†ï¼Œå› æ­¤è¿”å› `Optional` å¯¹è±¡ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ç»“æœæ˜¯å¦å­˜åœ¨ã€‚

åˆ©ç”¨ `reduce()`ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ±‚å’Œæ”¹æˆæ±‚ç§¯ï¼Œä»£ç ä¹Ÿååˆ†ç®€å•ï¼š

```java
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        int s = Stream.of(1, 2, 3, 4, 5, 6, 7, 8, 9).reduce(1, (acc, n) -> acc * n);
        System.out.println(s); // 362880
    }
}
```

::: warning
è®¡ç®—æ±‚ç§¯æ—¶ï¼Œåˆå§‹å€¼å¿…é¡»è®¾ç½®ä¸º `1`ã€‚

:::

é™¤äº†å¯ä»¥å¯¹æ•°å€¼è¿›è¡Œç´¯ç§¯è®¡ç®—å¤–ï¼Œçµæ´»è¿ç”¨ `reduce()` ä¹Ÿå¯ä»¥å¯¹ Java å¯¹è±¡è¿›è¡Œæ“ä½œã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•å°†é…ç½®æ–‡ä»¶çš„æ¯ä¸€è¡Œé…ç½®é€šè¿‡ `map()` å’Œ `reduce()` æ“ä½œèšåˆæˆä¸€ä¸ª `Map<String, String>`ï¼š

```java
import java.util.*;

public class Main {
    public static void main(String[] args) {
        // æŒ‰è¡Œè¯»å–é…ç½®æ–‡ä»¶:
        List<String> props = List.of("profile=native", "debug=true", "logging=warn", "interval=500");
        Map<String, String> map = props.stream()
                // æŠŠ k=v è½¬æ¢ä¸º Map[k]=v:
                .map(kv -> {
                    String[] ss = kv.split("\\=", 2);
                    return Map.of(ss[0], ss[1]);
                })
                // æŠŠæ‰€æœ‰ Map èšåˆåˆ°ä¸€ä¸ª Map:
                .reduce(new HashMap<String, String>(), (m, kv) -> {
                    m.putAll(kv);
                    return m;
                });
        // æ‰“å°ç»“æœ:
        map.forEach((k, v) -> {
            System.out.println(k + "=" + v);
        });
    }
}
```

### å°ç»“

- `reduce()` æ–¹æ³•å°†ä¸€ä¸ª `Stream` çš„æ¯ä¸ªå…ƒç´ ä¾æ¬¡ä½œç”¨äº `BinaryOperator`ï¼Œå¹¶å°†ç»“æœåˆå¹¶ã€‚

- `reduce()` æ˜¯èšåˆæ–¹æ³•ï¼Œèšåˆæ–¹æ³•ä¼šç«‹åˆ»å¯¹ `Stream` è¿›è¡Œè®¡ç®—ã€‚

---

## ğŸ€ è¾“å‡ºé›†åˆ

æˆ‘ä»¬ä»‹ç»äº† `Stream` çš„å‡ ä¸ªå¸¸è§æ“ä½œï¼š`map()`ã€`filter()`ã€`reduce()`ã€‚è¿™äº›æ“ä½œå¯¹ `Stream` æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯è½¬æ¢æ“ä½œï¼Œå³æŠŠä¸€ä¸ª `Stream` è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Stream`ï¼Œä¾‹å¦‚ `map()` å’Œ `filter()`ï¼Œå¦ä¸€ç±»æ˜¯èšåˆæ“ä½œï¼Œå³å¯¹ `Stream` çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªç¡®å®šçš„ç»“æœï¼Œä¾‹å¦‚ `reduce()`ã€‚

åŒºåˆ†è¿™ä¸¤ç§æ“ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå¯¹äº `Stream` æ¥è¯´ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢æ“ä½œ **_å¹¶ä¸ä¼šè§¦å‘ä»»ä½•è®¡ç®—_** ï¼æˆ‘ä»¬å¯ä»¥åšä¸ªå®éªŒï¼š

```java
import java.util.function.Supplier;
import java.util.stream.Stream;

public class Main {
    public static void main(String[] args)     {
        Stream<Long> s1 = Stream.generate(new NatualSupplier());
        Stream<Long> s2 = s1.map(n -> n * n);
        Stream<Long> s3 = s2.map(n -> n - 1);
        System.out.println(s3); // java.util.stream.ReferencePipeline$3@49476842
    }
}

class NatualSupplier implements Supplier<Long> {
    long n = 0;
    public Long get() {
        n++;
        return n;
    }
}
```

å› ä¸º `s1` æ˜¯ä¸€ä¸ª `Long` ç±»å‹çš„åºåˆ—ï¼Œå®ƒçš„å…ƒç´ é«˜è¾¾ 922 äº¿äº¿ä¸ªï¼Œä½†æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œæ—¢ä¸ä¼šæœ‰ä»»ä½•å†…å­˜å¢é•¿ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è®¡ç®—ï¼Œå› ä¸º _è½¬æ¢æ“ä½œåªæ˜¯ä¿å­˜äº†è½¬æ¢è§„åˆ™_ï¼Œæ— è®ºæˆ‘ä»¬å¯¹ä¸€ä¸ª `Stream` è½¬æ¢å¤šå°‘æ¬¡ï¼Œéƒ½ä¸ä¼šæœ‰ä»»ä½•å®é™…è®¡ç®—å‘ç”Ÿã€‚

è€Œèšåˆæ“ä½œåˆ™ä¸ä¸€æ ·ï¼Œ_èšåˆæ“ä½œä¼šç«‹åˆ»ä¿ƒä½¿ `Stream` è¾“å‡ºå®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¾æ¬¡çº³å…¥è®¡ç®—ï¼Œä»¥è·å¾—æœ€ç»ˆç»“æœ_ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ª `Stream` è¿›è¡Œèšåˆæ“ä½œï¼Œä¼šè§¦å‘ä¸€ç³»åˆ—è¿é”ååº”ï¼š

```java
Stream<Long> s1 = Stream.generate(new NatualSupplier());
Stream<Long> s2 = s1.map(n -> n * n);
Stream<Long> s3 = s2.map(n -> n - 1);
Stream<Long> s4 = s3.limit(10);
s4.reduce(0, (acc, n) -> acc + n);
```

æˆ‘ä»¬å¯¹ `s4` è¿›è¡Œ `reduce()` èšåˆè®¡ç®—ï¼Œä¼šä¸æ–­è¯·æ±‚ `s4` è¾“å‡ºå®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚å› ä¸º `s4` çš„ä¸Šæ¸¸æ˜¯ `s3`ï¼Œå®ƒåˆä¼šå‘ `s3` è¯·æ±‚å…ƒç´ ï¼Œå¯¼è‡´ `s3` å‘ `s2` è¯·æ±‚å…ƒç´ ï¼Œ`s2` å‘ `s1` è¯·æ±‚å…ƒç´ ï¼Œæœ€ç»ˆï¼Œ`s1` ä» `Supplier` å®ä¾‹ä¸­è¯·æ±‚åˆ°çœŸæ­£çš„å…ƒç´ ï¼Œå¹¶ç»è¿‡ä¸€ç³»åˆ—è½¬æ¢ï¼Œæœ€ç»ˆè¢« `reduce()` èšåˆå‡ºç»“æœã€‚

å¯è§ï¼Œèšåˆæ“ä½œæ˜¯çœŸæ­£éœ€è¦ä» `Stream` è¯·æ±‚æ•°æ®çš„ï¼Œå¯¹ä¸€ä¸ª `Stream` åšèšåˆè®¡ç®—åï¼Œç»“æœå°±ä¸æ˜¯ä¸€ä¸ª `Stream`ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¶ä»–çš„ Java å¯¹è±¡ã€‚

### è¾“å‡ºä¸º List

`reduce()` åªæ˜¯ä¸€ç§èšåˆæ“ä½œï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠ `Stream` çš„å…ƒç´ ä¿å­˜åˆ°é›†åˆï¼Œä¾‹å¦‚ `List`ï¼Œå› ä¸º `List` çš„å…ƒç´ æ˜¯ç¡®å®šçš„ Java å¯¹è±¡ï¼Œå› æ­¤ï¼ŒæŠŠ `Stream` å˜ä¸º `List` ä¸æ˜¯ä¸€ä¸ªè½¬æ¢æ“ä½œï¼Œè€Œæ˜¯ä¸€ä¸ªèšåˆæ“ä½œï¼Œå®ƒä¼šå¼ºåˆ¶ `Stream` è¾“å‡ºæ¯ä¸ªå…ƒç´ ã€‚

ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•å°†ä¸€ç»„ `String` å…ˆè¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ï¼Œç„¶åæŠŠéç©ºå­—ç¬¦ä¸²ä¿å­˜åˆ° `List` ä¸­ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        Stream<String> stream = Stream.of("Apple", "", null,"Pear","  ","Orange");
        List<String> list = stream.filter(s -> s != null && !s.isBlank()).collect(Collectors.toList());
        System.out.println(list);
    }
}
```

æŠŠ `Stream` çš„æ¯ä¸ªå…ƒç´ æ”¶é›†åˆ° `List` çš„æ–¹æ³•æ˜¯è°ƒç”¨ `collect()` å¹¶ä¼ å…¥ `Collectors.toList()` å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª `Collector` å®ä¾‹ï¼Œé€šè¿‡ç±»ä¼¼ `reduce()` çš„æ“ä½œï¼ŒæŠŠæ¯ä¸ªå…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªæ”¶é›†å™¨ä¸­ï¼ˆå®é™…ä¸Šæ˜¯ `ArrayList`ï¼‰ã€‚

ç±»ä¼¼çš„ï¼Œ`collect(Collectors.toSet())` å¯ä»¥æŠŠ `Stream` çš„æ¯ä¸ªå…ƒç´ æ”¶é›†åˆ° `Set` ä¸­ã€‚

### è¾“å‡ºä¸ºæ•°ç»„

æŠŠ Stream çš„å…ƒç´ è¾“å‡ºä¸ºæ•°ç»„å’Œè¾“å‡ºä¸º List ç±»ä¼¼ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ `toArray()` æ–¹æ³•ï¼Œå¹¶ä¼ å…¥æ•°ç»„çš„ â€œæ„é€ æ–¹æ³•â€ï¼š

```java
List<String> list = List.of("Apple", "Banana", "Orange");
String[] array = list.stream().toArray(String[]::new);
```

æ³¨æ„åˆ°ä¼ å…¥çš„ â€œæ„é€ æ–¹æ³•â€ æ˜¯ `String[]::new`ï¼Œå®ƒçš„ç­¾åå®é™…ä¸Šæ˜¯ `IntFunction<String[]>` å®šä¹‰çš„ `String[] apply(int)`ï¼Œå³ä¼ å…¥ `int` å‚æ•°ï¼Œè·å¾— `String[]` æ•°ç»„çš„è¿”å›å€¼ã€‚

### è¾“å‡ºä¸º Map

å¦‚æœæˆ‘ä»¬è¦æŠŠ Stream çš„å…ƒç´ æ”¶é›†åˆ° Map ä¸­ï¼Œå°±ç¨å¾®éº»çƒ¦ä¸€ç‚¹ã€‚å› ä¸ºå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæ·»åŠ åˆ° Map æ—¶éœ€è¦ key å’Œ valueï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¦æŒ‡å®šä¸¤ä¸ªæ˜ å°„å‡½æ•°ï¼Œåˆ†åˆ«æŠŠå…ƒç´ æ˜ å°„ä¸º key å’Œ valueï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        Stream<String> stream = Stream.of("APPL:Apple", "MSFT:Microsoft");
        Map<String, String> map = stream
                .collect(Collectors.toMap(
                        // æŠŠå…ƒç´  s æ˜ å°„ä¸º key:
                        s -> s.substring(0, s.indexOf(':')),
                        // æŠŠå…ƒç´  s æ˜ å°„ä¸º value:
                        s -> s.substring(s.indexOf(':') + 1)));
        System.out.println(map);
    }
}
```

### åˆ†ç»„è¾“å‡º

`Stream` è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åˆ†ç»„åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç»„è¾“å‡ºã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        List<String> list = List.of("Apple", "Banana", "Blackberry", "Coconut", "Avocado", "Cherry", "Apricots");
        Map<String, List<String>> groups = list.stream()
                .collect(Collectors.groupingBy(s -> s.substring(0, 1), Collectors.toList()));
        System.out.println(groups);
    }
}
```

åˆ†ç»„è¾“å‡ºä½¿ç”¨ `Collectors.groupingBy()`ï¼Œå®ƒéœ€è¦æä¾›ä¸¤ä¸ªå‡½æ•°ï¼šä¸€ä¸ªæ˜¯åˆ†ç»„çš„ keyï¼Œè¿™é‡Œä½¿ç”¨ `s -> s.substring(0, 1)`ï¼Œè¡¨ç¤ºåªè¦é¦–å­—æ¯ç›¸åŒçš„ `String` åˆ†åˆ°ä¸€ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ†ç»„çš„ valueï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ `Collectors.toList()`ï¼Œè¡¨ç¤ºè¾“å‡ºä¸º `List`ï¼Œä¸Šè¿°ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```sh
{
    A=[Apple, Avocado, Apricots],
    B=[Banana, Blackberry],
    C=[Coconut, Cherry]
}
```

å¯è§ï¼Œç»“æœä¸€å…±æœ‰ 3 ç»„ï¼ŒæŒ‰ `"A"`ï¼Œ`"B"`ï¼Œ`"C"` åˆ†ç»„ï¼Œæ¯ä¸€ç»„éƒ½æ˜¯ä¸€ä¸ª `List`ã€‚

å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ª `Student` ç±»ï¼ŒåŒ…å«å­¦ç”Ÿå§“åã€ç­çº§å’Œæˆç»©ï¼š

```java
class Student {
    int gradeId; // å¹´çº§
    int classId; // ç­çº§
    String name; // åå­—
    int score; // åˆ†æ•°
}
```

å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª `Stream<Student>`ï¼Œåˆ©ç”¨åˆ†ç»„è¾“å‡ºï¼Œå¯ä»¥éå¸¸ç®€å•åœ°æŒ‰å¹´çº§æˆ–ç­çº§æŠŠ `Student` å½’ç±»ã€‚

### å°ç»“

- `Stream` å¯ä»¥è¾“å‡ºä¸ºé›†åˆï¼š

- `Stream` é€šè¿‡ `collect()` æ–¹æ³•å¯ä»¥æ–¹ä¾¿åœ°è¾“å‡ºä¸º `List`ã€`Set`ã€`Map`ï¼Œè¿˜å¯ä»¥åˆ†ç»„è¾“å‡ºã€‚

---

## ğŸ€ å…¶ä»–æ“ä½œ

æˆ‘ä»¬æŠŠ `Stream` æä¾›çš„æ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼šè½¬æ¢æ“ä½œå’Œèšåˆæ“ä½œã€‚é™¤äº†å‰é¢ä»‹ç»çš„å¸¸ç”¨æ“ä½œå¤–ï¼Œ`Stream` è¿˜æä¾›äº†ä¸€ç³»åˆ—éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚

### æ’åº

å¯¹ `Stream` çš„å…ƒç´ è¿›è¡Œæ’åºååˆ†ç®€å•ï¼Œåªéœ€è°ƒç”¨ `sorted()` æ–¹æ³•ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        List<String> list = List.of("Orange", "apple", "Banana")
            .stream()
            .sorted()
            .collect(Collectors.toList());
        System.out.println(list);
    }
}
```

æ­¤æ–¹æ³•è¦æ±‚ `Stream` çš„æ¯ä¸ªå…ƒç´ å¿…é¡»å®ç° `Comparable` æ¥å£ã€‚å¦‚æœè¦è‡ªå®šä¹‰æ’åºï¼Œä¼ å…¥æŒ‡å®šçš„ `Comparator` å³å¯ï¼š

```java
List<String> list = List.of("Orange", "apple", "Banana")
    .stream()
    .sorted(String::compareToIgnoreCase)
    .collect(Collectors.toList());
```

æ³¨æ„ `sorted()` åªæ˜¯ä¸€ä¸ªè½¬æ¢æ“ä½œï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„ `Stream`ã€‚

### å»é‡

å¯¹ä¸€ä¸ª `Stream` çš„å…ƒç´ è¿›è¡Œå»é‡ï¼Œæ²¡å¿…è¦å…ˆè½¬æ¢ä¸º `Set`ï¼Œå¯ä»¥ç›´æ¥ç”¨ `distinct()`ï¼š

```java
List.of("A", "B", "A", "C", "B", "D")
    .stream()
    .distinct()
    .collect(Collectors.toList()); // [A, B, C, D]
```

### æˆªå–

æˆªå–æ“ä½œå¸¸ç”¨äºæŠŠä¸€ä¸ªæ— é™çš„ `Stream` è½¬æ¢æˆæœ‰é™çš„ `Stream`ï¼Œ`skip()` ç”¨äºè·³è¿‡å½“å‰ `Stream` çš„å‰ N ä¸ªå…ƒç´ ï¼Œ`limit()` ç”¨äºæˆªå–å½“å‰ `Stream` æœ€å¤šå‰ N ä¸ªå…ƒç´ ï¼š

```java
List.of("A", "B", "C", "D", "E", "F")
    .stream()
    .skip(2) // è·³è¿‡ A, B
    .limit(3) // æˆªå– C, D, E
    .collect(Collectors.toList()); // [C, D, E]
```

æˆªå–æ“ä½œä¹Ÿæ˜¯ä¸€ä¸ªè½¬æ¢æ“ä½œï¼Œå°†è¿”å›æ–°çš„ `Stream`ã€‚

### åˆå¹¶

å°†ä¸¤ä¸ª `Stream` åˆå¹¶ä¸ºä¸€ä¸ª `Stream` å¯ä»¥ä½¿ç”¨ `Stream` çš„é™æ€æ–¹æ³• `concat()`ï¼š

```java
Stream<String> s1 = List.of("A", "B", "C").stream();
Stream<String> s2 = List.of("D", "E").stream();
// åˆå¹¶:
Stream<String> s = Stream.concat(s1, s2);
System.out.println(s.collect(Collectors.toList())); // [A, B, C, D, E]
```

### flatMap

å¦‚æœ `Stream` çš„å…ƒç´ æ˜¯é›†åˆï¼š

```java
Stream<List<Integer>> s = Stream.of(
        Arrays.asList(1, 2, 3),
        Arrays.asList(4, 5, 6),
        Arrays.asList(7, 8, 9));
```

è€Œæˆ‘ä»¬å¸Œæœ›æŠŠä¸Šè¿° `Stream` è½¬æ¢ä¸º `Stream<Integer>`ï¼Œå°±å¯ä»¥ä½¿ç”¨ `flatMap()`ï¼š

```java
Stream<Integer> i = s.flatMap(list -> list.stream());
```

å› æ­¤ï¼Œæ‰€è°“ `flatMap()`ï¼Œæ˜¯æŒ‡æŠŠ `Stream` çš„æ¯ä¸ªå…ƒç´ ï¼ˆè¿™é‡Œæ˜¯ `List`ï¼‰æ˜ å°„ä¸º `Stream`ï¼Œç„¶ååˆå¹¶æˆä¸€ä¸ªæ–°çš„ `Stream`ï¼š

![](./assets/image-20231219170426989.png =400x)

### å¹¶è¡Œ

é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹ `Stream` çš„å…ƒç´ è¿›è¡Œå¤„ç†æ˜¯å•çº¿ç¨‹çš„ï¼Œå³ä¸€ä¸ªä¸€ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å¹¶è¡Œå¤„ç† `Stream` çš„å…ƒç´ ï¼Œå› ä¸ºåœ¨å…ƒç´ æ•°é‡éå¸¸å¤§çš„æƒ…å†µï¼Œå¹¶è¡Œå¤„ç†å¯ä»¥å¤§å¤§åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚

æŠŠä¸€ä¸ªæ™®é€š `Stream` è½¬æ¢ä¸ºå¯ä»¥å¹¶è¡Œå¤„ç†çš„ `Stream` éå¸¸ç®€å•ï¼Œåªéœ€è¦ç”¨ `parallel()` è¿›è¡Œè½¬æ¢ï¼š

```java
Stream<String> s = ...
String[] result = s.parallel() // å˜æˆä¸€ä¸ªå¯ä»¥å¹¶è¡Œå¤„ç†çš„ Stream
                   .sorted() // å¯ä»¥è¿›è¡Œå¹¶è¡Œæ’åº
                   .toArray(String[]::new);
```

ç»è¿‡ `parallel()` è½¬æ¢åçš„ `Stream` åªè¦å¯èƒ½ï¼Œå°±ä¼šå¯¹åç»­æ“ä½œè¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚æˆ‘ä»¬ä¸éœ€è¦ç¼–å†™ä»»ä½•å¤šçº¿ç¨‹ä»£ç å°±å¯ä»¥äº«å—åˆ°å¹¶è¡Œå¤„ç†å¸¦æ¥çš„æ‰§è¡Œæ•ˆç‡çš„æå‡ã€‚

### å…¶ä»–èšåˆæ–¹æ³•

é™¤äº† `reduce()` å’Œ `collect()` å¤–ï¼Œ`Stream` è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„èšåˆæ–¹æ³•ï¼š

- `count()`ï¼šç”¨äºè¿”å›å…ƒç´ ä¸ªæ•°ï¼›
- `max(Comparator<? super T> cp)`ï¼šæ‰¾å‡ºæœ€å¤§å…ƒç´ ï¼›
- `min(Comparator<? super T> cp)`ï¼šæ‰¾å‡ºæœ€å°å…ƒç´ ã€‚

é’ˆå¯¹ `IntStream`ã€`LongStream` å’Œ `DoubleStream`ï¼Œè¿˜é¢å¤–æä¾›äº†ä»¥ä¸‹èšåˆæ–¹æ³•ï¼š

- `sum()`ï¼šå¯¹æ‰€æœ‰å…ƒç´ æ±‚å’Œï¼›
- `average()`ï¼šå¯¹æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡æ•°ã€‚

è¿˜æœ‰ä¸€äº›æ–¹æ³•ï¼Œç”¨æ¥æµ‹è¯• `Stream` çš„å…ƒç´ æ˜¯å¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- `boolean allMatch(Predicate<? super T>)`ï¼šæµ‹è¯•æ˜¯å¦æ‰€æœ‰å…ƒç´ å‡æ»¡è¶³æµ‹è¯•æ¡ä»¶ï¼›
- `boolean anyMatch(Predicate<? super T>)`ï¼šæµ‹è¯•æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æµ‹è¯•æ¡ä»¶ã€‚

æœ€åä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯ `forEach()`ï¼Œå®ƒå¯ä»¥å¾ªç¯å¤„ç† `Stream` çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ç»å¸¸ä¼ å…¥ `System.out::println` æ¥æ‰“å° `Stream` çš„å…ƒç´ ï¼š

```java
Stream<String> s = ...
s.forEach(str -> {
    System.out.println("Hello," + str);
});
```

### å°ç»“

`Stream` æä¾›çš„å¸¸ç”¨æ“ä½œæœ‰ï¼š

- è½¬æ¢æ“ä½œï¼š`map()`ï¼Œ`filter()`ï¼Œ`sorted()`ï¼Œ`distinct()`ï¼›
- åˆå¹¶æ“ä½œï¼š`concat()`ï¼Œ`flatMap()`ï¼›
- å¹¶è¡Œå¤„ç†ï¼š`parallel()`ï¼›
- èšåˆæ“ä½œï¼š`reduce()`ï¼Œ`collect()`ï¼Œ`count()`ï¼Œ`max()`ï¼Œ`min()`ï¼Œ`sum()`ï¼Œ`average()`ï¼›
- å…¶ä»–æ“ä½œï¼š`allMatch()`, `anyMatch()`, `forEach()`ã€‚
